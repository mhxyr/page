(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function makeMap(r){const e=Object.create(null);for(const i of r.split(","))e[i]=1;return i=>i in e}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,isOn=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),isModelListener=r=>r.startsWith("onUpdate:"),extend=Object.assign,remove=(r,e)=>{const i=r.indexOf(e);i>-1&&r.splice(i,1)},hasOwnProperty$4=Object.prototype.hasOwnProperty,hasOwn$1=(r,e)=>hasOwnProperty$4.call(r,e),isArray$3=Array.isArray,isMap=r=>toTypeString$1(r)==="[object Map]",isSet=r=>toTypeString$1(r)==="[object Set]",isFunction$2=r=>typeof r=="function",isString$2=r=>typeof r=="string",isSymbol=r=>typeof r=="symbol",isObject$3=r=>r!==null&&typeof r=="object",isPromise$1=r=>(isObject$3(r)||isFunction$2(r))&&isFunction$2(r.then)&&isFunction$2(r.catch),objectToString$1=Object.prototype.toString,toTypeString$1=r=>objectToString$1.call(r),toRawType=r=>toTypeString$1(r).slice(8,-1),isPlainObject$2=r=>toTypeString$1(r)==="[object Object]",isIntegerKey=r=>isString$2(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=r=>{const e=Object.create(null);return i=>e[i]||(e[i]=r(i))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(r=>r.replace(camelizeRE,(e,i)=>i?i.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(r=>r.replace(hyphenateRE,"-$1").toLowerCase()),capitalize$1=cacheStringFunction(r=>r.charAt(0).toUpperCase()+r.slice(1)),toHandlerKey=cacheStringFunction(r=>r?`on${capitalize$1(r)}`:""),hasChanged=(r,e)=>!Object.is(r,e),invokeArrayFns=(r,...e)=>{for(let i=0;i<r.length;i++)r[i](...e)},def=(r,e,i,n=!1)=>{Object.defineProperty(r,e,{configurable:!0,enumerable:!1,writable:n,value:i})},looseToNumber=r=>{const e=parseFloat(r);return isNaN(e)?r:e};let _globalThis$1;const getGlobalThis$1=()=>_globalThis$1||(_globalThis$1=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function normalizeStyle(r){if(isArray$3(r)){const e={};for(let i=0;i<r.length;i++){const n=r[i],o=isString$2(n)?parseStringStyle(n):normalizeStyle(n);if(o)for(const l in o)e[l]=o[l]}return e}else if(isString$2(r)||isObject$3(r))return r}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*[^]*?\*\//g;function parseStringStyle(r){const e={};return r.replace(styleCommentRE,"").split(listDelimiterRE).forEach(i=>{if(i){const n=i.split(propertyDelimiterRE);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function normalizeClass(r){let e="";if(isString$2(r))e=r;else if(isArray$3(r))for(let i=0;i<r.length;i++){const n=normalizeClass(r[i]);n&&(e+=n+" ")}else if(isObject$3(r))for(const i in r)r[i]&&(e+=i+" ");return e.trim()}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(r){return!!r||r===""}const isRef$1=r=>!!(r&&r.__v_isRef===!0),toDisplayString$1=r=>isString$2(r)?r:r==null?"":isArray$3(r)||isObject$3(r)&&(r.toString===objectToString$1||!isFunction$2(r.toString))?isRef$1(r)?toDisplayString$1(r.value):JSON.stringify(r,replacer,2):String(r),replacer=(r,e)=>isRef$1(e)?replacer(r,e.value):isMap(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((i,[n,o],l)=>(i[stringifySymbol(n,l)+" =>"]=o,i),{})}:isSet(e)?{[`Set(${e.size})`]:[...e.values()].map(i=>stringifySymbol(i))}:isSymbol(e)?stringifySymbol(e):isObject$3(e)&&!isArray$3(e)&&!isPlainObject$2(e)?String(e):e,stringifySymbol=(r,e="")=>{var i;return isSymbol(r)?`Symbol(${(i=r.description)!=null?i:e})`:r};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let activeEffectScope;class EffectScope{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=activeEffectScope,!e&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,i;if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].pause();for(e=0,i=this.effects.length;e<i;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,i;if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].resume();for(e=0,i=this.effects.length;e<i;e++)this.effects[e].resume()}}run(e){if(this._active){const i=activeEffectScope;try{return activeEffectScope=this,e()}finally{activeEffectScope=i}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(e){if(this._active){this._active=!1;let i,n;for(i=0,n=this.effects.length;i<n;i++)this.effects[i].stop();for(this.effects.length=0,i=0,n=this.cleanups.length;i<n;i++)this.cleanups[i]();if(this.cleanups.length=0,this.scopes){for(i=0,n=this.scopes.length;i<n;i++)this.scopes[i].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function effectScope(r){return new EffectScope(r)}function getCurrentScope(){return activeEffectScope}let activeSub;const pausedQueueEffects=new WeakSet;class ReactiveEffect{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,activeEffectScope&&activeEffectScope.active&&activeEffectScope.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,pausedQueueEffects.has(this)&&(pausedQueueEffects.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||batch(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,cleanupEffect(this),prepareDeps(this);const e=activeSub,i=shouldTrack;activeSub=this,shouldTrack=!0;try{return this.fn()}finally{cleanupDeps(this),activeSub=e,shouldTrack=i,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)removeSub(e);this.deps=this.depsTail=void 0,cleanupEffect(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?pausedQueueEffects.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){isDirty(this)&&this.run()}get dirty(){return isDirty(this)}}let batchDepth=0,batchedSub,batchedComputed;function batch(r,e=!1){if(r.flags|=8,e){r.next=batchedComputed,batchedComputed=r;return}r.next=batchedSub,batchedSub=r}function startBatch(){batchDepth++}function endBatch(){if(--batchDepth>0)return;if(batchedComputed){let e=batchedComputed;for(batchedComputed=void 0;e;){const i=e.next;e.next=void 0,e.flags&=-9,e=i}}let r;for(;batchedSub;){let e=batchedSub;for(batchedSub=void 0;e;){const i=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){r||(r=n)}e=i}}if(r)throw r}function prepareDeps(r){for(let e=r.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function cleanupDeps(r){let e,i=r.depsTail,n=i;for(;n;){const o=n.prevDep;n.version===-1?(n===i&&(i=o),removeSub(n),removeDep(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=o}r.deps=e,r.depsTail=i}function isDirty(r){for(let e=r.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(refreshComputed(e.dep.computed)||e.dep.version!==e.version))return!0;return!!r._dirty}function refreshComputed(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===globalVersion))return;r.globalVersion=globalVersion;const e=r.dep;if(r.flags|=2,e.version>0&&!r.isSSR&&r.deps&&!isDirty(r)){r.flags&=-3;return}const i=activeSub,n=shouldTrack;activeSub=r,shouldTrack=!0;try{prepareDeps(r);const o=r.fn(r._value);(e.version===0||hasChanged(o,r._value))&&(r._value=o,e.version++)}catch(o){throw e.version++,o}finally{activeSub=i,shouldTrack=n,cleanupDeps(r),r.flags&=-3}}function removeSub(r,e=!1){const{dep:i,prevSub:n,nextSub:o}=r;if(n&&(n.nextSub=o,r.prevSub=void 0),o&&(o.prevSub=n,r.nextSub=void 0),i.subs===r&&(i.subs=n,!n&&i.computed)){i.computed.flags&=-5;for(let l=i.computed.deps;l;l=l.nextDep)removeSub(l,!0)}!e&&!--i.sc&&i.map&&i.map.delete(i.key)}function removeDep(r){const{prevDep:e,nextDep:i}=r;e&&(e.nextDep=i,r.prevDep=void 0),i&&(i.prevDep=e,r.nextDep=void 0)}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const r=trackStack.pop();shouldTrack=r===void 0?!0:r}function cleanupEffect(r){const{cleanup:e}=r;if(r.cleanup=void 0,e){const i=activeSub;activeSub=void 0;try{e()}finally{activeSub=i}}}let globalVersion=0;class Link{constructor(e,i){this.sub=e,this.dep=i,this.version=i.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Dep{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!activeSub||!shouldTrack||activeSub===this.computed)return;let i=this.activeLink;if(i===void 0||i.sub!==activeSub)i=this.activeLink=new Link(activeSub,this),activeSub.deps?(i.prevDep=activeSub.depsTail,activeSub.depsTail.nextDep=i,activeSub.depsTail=i):activeSub.deps=activeSub.depsTail=i,addSub(i);else if(i.version===-1&&(i.version=this.version,i.nextDep)){const n=i.nextDep;n.prevDep=i.prevDep,i.prevDep&&(i.prevDep.nextDep=n),i.prevDep=activeSub.depsTail,i.nextDep=void 0,activeSub.depsTail.nextDep=i,activeSub.depsTail=i,activeSub.deps===i&&(activeSub.deps=n)}return i}trigger(e){this.version++,globalVersion++,this.notify(e)}notify(e){startBatch();try{for(let i=this.subs;i;i=i.prevSub)i.sub.notify()&&i.sub.dep.notify()}finally{endBatch()}}}function addSub(r){if(r.dep.sc++,r.sub.flags&4){const e=r.dep.computed;if(e&&!r.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)addSub(n)}const i=r.dep.subs;i!==r&&(r.prevSub=i,i&&(i.nextSub=r)),r.dep.subs=r}}const targetMap=new WeakMap,ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol(""),ARRAY_ITERATE_KEY=Symbol("");function track(r,e,i){if(shouldTrack&&activeSub){let n=targetMap.get(r);n||targetMap.set(r,n=new Map);let o=n.get(i);o||(n.set(i,o=new Dep),o.map=n,o.key=i),o.track()}}function trigger(r,e,i,n,o,l){const u=targetMap.get(r);if(!u){globalVersion++;return}const d=f=>{f&&f.trigger()};if(startBatch(),e==="clear")u.forEach(d);else{const f=isArray$3(r),g=f&&isIntegerKey(i);if(f&&i==="length"){const _=Number(n);u.forEach((y,b)=>{(b==="length"||b===ARRAY_ITERATE_KEY||!isSymbol(b)&&b>=_)&&d(y)})}else switch((i!==void 0||u.has(void 0))&&d(u.get(i)),g&&d(u.get(ARRAY_ITERATE_KEY)),e){case"add":f?g&&d(u.get("length")):(d(u.get(ITERATE_KEY)),isMap(r)&&d(u.get(MAP_KEY_ITERATE_KEY)));break;case"delete":f||(d(u.get(ITERATE_KEY)),isMap(r)&&d(u.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(r)&&d(u.get(ITERATE_KEY));break}}endBatch()}function reactiveReadArray(r){const e=toRaw(r);return e===r?e:(track(e,"iterate",ARRAY_ITERATE_KEY),isShallow(r)?e:e.map(toReactive))}function shallowReadArray(r){return track(r=toRaw(r),"iterate",ARRAY_ITERATE_KEY),r}const arrayInstrumentations={__proto__:null,[Symbol.iterator](){return iterator(this,Symbol.iterator,toReactive)},concat(...r){return reactiveReadArray(this).concat(...r.map(e=>isArray$3(e)?reactiveReadArray(e):e))},entries(){return iterator(this,"entries",r=>(r[1]=toReactive(r[1]),r))},every(r,e){return apply$1(this,"every",r,e,void 0,arguments)},filter(r,e){return apply$1(this,"filter",r,e,i=>i.map(toReactive),arguments)},find(r,e){return apply$1(this,"find",r,e,toReactive,arguments)},findIndex(r,e){return apply$1(this,"findIndex",r,e,void 0,arguments)},findLast(r,e){return apply$1(this,"findLast",r,e,toReactive,arguments)},findLastIndex(r,e){return apply$1(this,"findLastIndex",r,e,void 0,arguments)},forEach(r,e){return apply$1(this,"forEach",r,e,void 0,arguments)},includes(...r){return searchProxy(this,"includes",r)},indexOf(...r){return searchProxy(this,"indexOf",r)},join(r){return reactiveReadArray(this).join(r)},lastIndexOf(...r){return searchProxy(this,"lastIndexOf",r)},map(r,e){return apply$1(this,"map",r,e,void 0,arguments)},pop(){return noTracking(this,"pop")},push(...r){return noTracking(this,"push",r)},reduce(r,...e){return reduce(this,"reduce",r,e)},reduceRight(r,...e){return reduce(this,"reduceRight",r,e)},shift(){return noTracking(this,"shift")},some(r,e){return apply$1(this,"some",r,e,void 0,arguments)},splice(...r){return noTracking(this,"splice",r)},toReversed(){return reactiveReadArray(this).toReversed()},toSorted(r){return reactiveReadArray(this).toSorted(r)},toSpliced(...r){return reactiveReadArray(this).toSpliced(...r)},unshift(...r){return noTracking(this,"unshift",r)},values(){return iterator(this,"values",toReactive)}};function iterator(r,e,i){const n=shallowReadArray(r),o=n[e]();return n!==r&&!isShallow(r)&&(o._next=o.next,o.next=()=>{const l=o._next();return l.value&&(l.value=i(l.value)),l}),o}const arrayProto=Array.prototype;function apply$1(r,e,i,n,o,l){const u=shallowReadArray(r),d=u!==r&&!isShallow(r),f=u[e];if(f!==arrayProto[e]){const y=f.apply(r,l);return d?toReactive(y):y}let g=i;u!==r&&(d?g=function(y,b){return i.call(this,toReactive(y),b,r)}:i.length>2&&(g=function(y,b){return i.call(this,y,b,r)}));const _=f.call(u,g,n);return d&&o?o(_):_}function reduce(r,e,i,n){const o=shallowReadArray(r);let l=i;return o!==r&&(isShallow(r)?i.length>3&&(l=function(u,d,f){return i.call(this,u,d,f,r)}):l=function(u,d,f){return i.call(this,u,toReactive(d),f,r)}),o[e](l,...n)}function searchProxy(r,e,i){const n=toRaw(r);track(n,"iterate",ARRAY_ITERATE_KEY);const o=n[e](...i);return(o===-1||o===!1)&&isProxy(i[0])?(i[0]=toRaw(i[0]),n[e](...i)):o}function noTracking(r,e,i=[]){pauseTracking(),startBatch();const n=toRaw(r)[e].apply(r,i);return endBatch(),resetTracking(),n}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(isSymbol));function hasOwnProperty$3(r){isSymbol(r)||(r=String(r));const e=toRaw(this);return track(e,"has",r),e.hasOwnProperty(r)}class BaseReactiveHandler{constructor(e=!1,i=!1){this._isReadonly=e,this._isShallow=i}get(e,i,n){if(i==="__v_skip")return e.__v_skip;const o=this._isReadonly,l=this._isShallow;if(i==="__v_isReactive")return!o;if(i==="__v_isReadonly")return o;if(i==="__v_isShallow")return l;if(i==="__v_raw")return n===(o?l?shallowReadonlyMap:readonlyMap:l?shallowReactiveMap:reactiveMap).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const u=isArray$3(e);if(!o){let f;if(u&&(f=arrayInstrumentations[i]))return f;if(i==="hasOwnProperty")return hasOwnProperty$3}const d=Reflect.get(e,i,isRef(e)?e:n);return(isSymbol(i)?builtInSymbols.has(i):isNonTrackableKeys(i))||(o||track(e,"get",i),l)?d:isRef(d)?u&&isIntegerKey(i)?d:d.value:isObject$3(d)?o?readonly(d):reactive(d):d}}class MutableReactiveHandler extends BaseReactiveHandler{constructor(e=!1){super(!1,e)}set(e,i,n,o){let l=e[i];if(!this._isShallow){const f=isReadonly(l);if(!isShallow(n)&&!isReadonly(n)&&(l=toRaw(l),n=toRaw(n)),!isArray$3(e)&&isRef(l)&&!isRef(n))return f?!1:(l.value=n,!0)}const u=isArray$3(e)&&isIntegerKey(i)?Number(i)<e.length:hasOwn$1(e,i),d=Reflect.set(e,i,n,isRef(e)?e:o);return e===toRaw(o)&&(u?hasChanged(n,l)&&trigger(e,"set",i,n):trigger(e,"add",i,n)),d}deleteProperty(e,i){const n=hasOwn$1(e,i);e[i];const o=Reflect.deleteProperty(e,i);return o&&n&&trigger(e,"delete",i,void 0),o}has(e,i){const n=Reflect.has(e,i);return(!isSymbol(i)||!builtInSymbols.has(i))&&track(e,"has",i),n}ownKeys(e){return track(e,"iterate",isArray$3(e)?"length":ITERATE_KEY),Reflect.ownKeys(e)}}class ReadonlyReactiveHandler extends BaseReactiveHandler{constructor(e=!1){super(!0,e)}set(e,i){return!0}deleteProperty(e,i){return!0}}const mutableHandlers=new MutableReactiveHandler,readonlyHandlers=new ReadonlyReactiveHandler,shallowReactiveHandlers=new MutableReactiveHandler(!0),shallowReadonlyHandlers=new ReadonlyReactiveHandler(!0),toShallow=r=>r,getProto=r=>Reflect.getPrototypeOf(r);function createIterableMethod(r,e,i){return function(...n){const o=this.__v_raw,l=toRaw(o),u=isMap(l),d=r==="entries"||r===Symbol.iterator&&u,f=r==="keys"&&u,g=o[r](...n),_=i?toShallow:e?toReadonly:toReactive;return!e&&track(l,"iterate",f?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:y,done:b}=g.next();return b?{value:y,done:b}:{value:d?[_(y[0]),_(y[1])]:_(y),done:b}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(r){return function(...e){return r==="delete"?!1:r==="clear"?void 0:this}}function createInstrumentations(r,e){const i={get(o){const l=this.__v_raw,u=toRaw(l),d=toRaw(o);r||(hasChanged(o,d)&&track(u,"get",o),track(u,"get",d));const{has:f}=getProto(u),g=e?toShallow:r?toReadonly:toReactive;if(f.call(u,o))return g(l.get(o));if(f.call(u,d))return g(l.get(d));l!==u&&l.get(o)},get size(){const o=this.__v_raw;return!r&&track(toRaw(o),"iterate",ITERATE_KEY),Reflect.get(o,"size",o)},has(o){const l=this.__v_raw,u=toRaw(l),d=toRaw(o);return r||(hasChanged(o,d)&&track(u,"has",o),track(u,"has",d)),o===d?l.has(o):l.has(o)||l.has(d)},forEach(o,l){const u=this,d=u.__v_raw,f=toRaw(d),g=e?toShallow:r?toReadonly:toReactive;return!r&&track(f,"iterate",ITERATE_KEY),d.forEach((_,y)=>o.call(l,g(_),g(y),u))}};return extend(i,r?{add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear")}:{add(o){!e&&!isShallow(o)&&!isReadonly(o)&&(o=toRaw(o));const l=toRaw(this);return getProto(l).has.call(l,o)||(l.add(o),trigger(l,"add",o,o)),this},set(o,l){!e&&!isShallow(l)&&!isReadonly(l)&&(l=toRaw(l));const u=toRaw(this),{has:d,get:f}=getProto(u);let g=d.call(u,o);g||(o=toRaw(o),g=d.call(u,o));const _=f.call(u,o);return u.set(o,l),g?hasChanged(l,_)&&trigger(u,"set",o,l):trigger(u,"add",o,l),this},delete(o){const l=toRaw(this),{has:u,get:d}=getProto(l);let f=u.call(l,o);f||(o=toRaw(o),f=u.call(l,o)),d&&d.call(l,o);const g=l.delete(o);return f&&trigger(l,"delete",o,void 0),g},clear(){const o=toRaw(this),l=o.size!==0,u=o.clear();return l&&trigger(o,"clear",void 0,void 0),u}}),["keys","values","entries",Symbol.iterator].forEach(o=>{i[o]=createIterableMethod(o,r,e)}),i}function createInstrumentationGetter(r,e){const i=createInstrumentations(r,e);return(n,o,l)=>o==="__v_isReactive"?!r:o==="__v_isReadonly"?r:o==="__v_raw"?n:Reflect.get(hasOwn$1(i,o)&&o in n?i:n,o,l)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},shallowReadonlyCollectionHandlers={get:createInstrumentationGetter(!0,!0)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(r){return r.__v_skip||!Object.isExtensible(r)?0:targetTypeMap(toRawType(r))}function reactive(r){return isReadonly(r)?r:createReactiveObject(r,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(r){return createReactiveObject(r,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(r){return createReactiveObject(r,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function shallowReadonly(r){return createReactiveObject(r,!0,shallowReadonlyHandlers,shallowReadonlyCollectionHandlers,shallowReadonlyMap)}function createReactiveObject(r,e,i,n,o){if(!isObject$3(r)||r.__v_raw&&!(e&&r.__v_isReactive))return r;const l=o.get(r);if(l)return l;const u=getTargetType(r);if(u===0)return r;const d=new Proxy(r,u===2?n:i);return o.set(r,d),d}function isReactive(r){return isReadonly(r)?isReactive(r.__v_raw):!!(r&&r.__v_isReactive)}function isReadonly(r){return!!(r&&r.__v_isReadonly)}function isShallow(r){return!!(r&&r.__v_isShallow)}function isProxy(r){return r?!!r.__v_raw:!1}function toRaw(r){const e=r&&r.__v_raw;return e?toRaw(e):r}function markRaw(r){return!hasOwn$1(r,"__v_skip")&&Object.isExtensible(r)&&def(r,"__v_skip",!0),r}const toReactive=r=>isObject$3(r)?reactive(r):r,toReadonly=r=>isObject$3(r)?readonly(r):r;function isRef(r){return r?r.__v_isRef===!0:!1}function ref(r){return createRef(r,!1)}function shallowRef(r){return createRef(r,!0)}function createRef(r,e){return isRef(r)?r:new RefImpl(r,e)}class RefImpl{constructor(e,i){this.dep=new Dep,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=i?e:toRaw(e),this._value=i?e:toReactive(e),this.__v_isShallow=i}get value(){return this.dep.track(),this._value}set value(e){const i=this._rawValue,n=this.__v_isShallow||isShallow(e)||isReadonly(e);e=n?e:toRaw(e),hasChanged(e,i)&&(this._rawValue=e,this._value=n?e:toReactive(e),this.dep.trigger())}}function unref(r){return isRef(r)?r.value:r}const shallowUnwrapHandlers={get:(r,e,i)=>e==="__v_raw"?r:unref(Reflect.get(r,e,i)),set:(r,e,i,n)=>{const o=r[e];return isRef(o)&&!isRef(i)?(o.value=i,!0):Reflect.set(r,e,i,n)}};function proxyRefs(r){return isReactive(r)?r:new Proxy(r,shallowUnwrapHandlers)}class ComputedRefImpl{constructor(e,i,n){this.fn=e,this.setter=i,this._value=void 0,this.dep=new Dep(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=globalVersion-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!i,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&activeSub!==this)return batch(this,!0),!0}get value(){const e=this.dep.track();return refreshComputed(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function computed$1(r,e,i=!1){let n,o;return isFunction$2(r)?n=r:(n=r.get,o=r.set),new ComputedRefImpl(n,o,i)}const INITIAL_WATCHER_VALUE={},cleanupMap=new WeakMap;let activeWatcher;function onWatcherCleanup(r,e=!1,i=activeWatcher){if(i){let n=cleanupMap.get(i);n||cleanupMap.set(i,n=[]),n.push(r)}}function watch$1(r,e,i=EMPTY_OBJ){const{immediate:n,deep:o,once:l,scheduler:u,augmentJob:d,call:f}=i,g=P=>o?P:isShallow(P)||o===!1||o===0?traverse(P,1):traverse(P);let _,y,b,S,v=!1,A=!1;if(isRef(r)?(y=()=>r.value,v=isShallow(r)):isReactive(r)?(y=()=>g(r),v=!0):isArray$3(r)?(A=!0,v=r.some(P=>isReactive(P)||isShallow(P)),y=()=>r.map(P=>{if(isRef(P))return P.value;if(isReactive(P))return g(P);if(isFunction$2(P))return f?f(P,2):P()})):isFunction$2(r)?e?y=f?()=>f(r,2):r:y=()=>{if(b){pauseTracking();try{b()}finally{resetTracking()}}const P=activeWatcher;activeWatcher=_;try{return f?f(r,3,[S]):r(S)}finally{activeWatcher=P}}:y=NOOP,e&&o){const P=y,L=o===!0?1/0:o;y=()=>traverse(P(),L)}const x=getCurrentScope(),T=()=>{_.stop(),x&&x.active&&remove(x.effects,_)};if(l&&e){const P=e;e=(...L)=>{P(...L),T()}}let C=A?new Array(r.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const E=P=>{if(!(!(_.flags&1)||!_.dirty&&!P))if(e){const L=_.run();if(o||v||(A?L.some((R,w)=>hasChanged(R,C[w])):hasChanged(L,C))){b&&b();const R=activeWatcher;activeWatcher=_;try{const w=[L,C===INITIAL_WATCHER_VALUE?void 0:A&&C[0]===INITIAL_WATCHER_VALUE?[]:C,S];f?f(e,3,w):e(...w),C=L}finally{activeWatcher=R}}}else _.run()};return d&&d(E),_=new ReactiveEffect(y),_.scheduler=u?()=>u(E,!1):E,S=P=>onWatcherCleanup(P,!1,_),b=_.onStop=()=>{const P=cleanupMap.get(_);if(P){if(f)f(P,4);else for(const L of P)L();cleanupMap.delete(_)}},e?n?E(!0):C=_.run():u?u(E.bind(null,!0),!0):_.run(),T.pause=_.pause.bind(_),T.resume=_.resume.bind(_),T.stop=T,T}function traverse(r,e=1/0,i){if(e<=0||!isObject$3(r)||r.__v_skip||(i=i||new Set,i.has(r)))return r;if(i.add(r),e--,isRef(r))traverse(r.value,e,i);else if(isArray$3(r))for(let n=0;n<r.length;n++)traverse(r[n],e,i);else if(isSet(r)||isMap(r))r.forEach(n=>{traverse(n,e,i)});else if(isPlainObject$2(r)){for(const n in r)traverse(r[n],e,i);for(const n of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,n)&&traverse(r[n],e,i)}return r}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const stack$1=[];let isWarning=!1;function warn$1$1(r,...e){if(isWarning)return;isWarning=!0,pauseTracking();const i=stack$1.length?stack$1[stack$1.length-1].component:null,n=i&&i.appContext.config.warnHandler,o=getComponentTrace();if(n)callWithErrorHandling(n,i,11,[r+e.map(l=>{var u,d;return(d=(u=l.toString)==null?void 0:u.call(l))!=null?d:JSON.stringify(l)}).join(""),i&&i.proxy,o.map(({vnode:l})=>`at <${formatComponentName(i,l.type)}>`).join(`
`),o]);else{const l=[`[Vue warn]: ${r}`,...e];o.length&&l.push(`
`,...formatTrace(o)),console.warn(...l)}resetTracking(),isWarning=!1}function getComponentTrace(){let r=stack$1[stack$1.length-1];if(!r)return[];const e=[];for(;r;){const i=e[0];i&&i.vnode===r?i.recurseCount++:e.push({vnode:r,recurseCount:0});const n=r.component&&r.component.parent;r=n&&n.vnode}return e}function formatTrace(r){const e=[];return r.forEach((i,n)=>{e.push(...n===0?[]:[`
`],...formatTraceEntry(i))}),e}function formatTraceEntry({vnode:r,recurseCount:e}){const i=e>0?`... (${e} recursive calls)`:"",n=r.component?r.component.parent==null:!1,o=` at <${formatComponentName(r.component,r.type,n)}`,l=">"+i;return r.props?[o,...formatProps(r.props),l]:[o+l]}function formatProps(r){const e=[],i=Object.keys(r);return i.slice(0,3).forEach(n=>{e.push(...formatProp(n,r[n]))}),i.length>3&&e.push(" ..."),e}function formatProp(r,e,i){return isString$2(e)?(e=JSON.stringify(e),i?e:[`${r}=${e}`]):typeof e=="number"||typeof e=="boolean"||e==null?i?e:[`${r}=${e}`]:isRef(e)?(e=formatProp(r,toRaw(e.value),!0),i?e:[`${r}=Ref<`,e,">"]):isFunction$2(e)?[`${r}=fn${e.name?`<${e.name}>`:""}`]:(e=toRaw(e),i?e:[`${r}=`,e])}function callWithErrorHandling(r,e,i,n){try{return n?r(...n):r()}catch(o){handleError(o,e,i)}}function callWithAsyncErrorHandling(r,e,i,n){if(isFunction$2(r)){const o=callWithErrorHandling(r,e,i,n);return o&&isPromise$1(o)&&o.catch(l=>{handleError(l,e,i)}),o}if(isArray$3(r)){const o=[];for(let l=0;l<r.length;l++)o.push(callWithAsyncErrorHandling(r[l],e,i,n));return o}}function handleError(r,e,i,n=!0){const o=e?e.vnode:null,{errorHandler:l,throwUnhandledErrorInProduction:u}=e&&e.appContext.config||EMPTY_OBJ;if(e){let d=e.parent;const f=e.proxy,g=`https://vuejs.org/error-reference/#runtime-${i}`;for(;d;){const _=d.ec;if(_){for(let y=0;y<_.length;y++)if(_[y](r,f,g)===!1)return}d=d.parent}if(l){pauseTracking(),callWithErrorHandling(l,null,10,[r,f,g]),resetTracking();return}}logError(r,i,o,n,u)}function logError(r,e,i,n=!0,o=!1){if(o)throw r;console.error(r)}const queue=[];let flushIndex=-1;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(r){const e=currentFlushPromise||resolvedPromise;return r?e.then(this?r.bind(this):r):e}function findInsertionIndex$1(r){let e=flushIndex+1,i=queue.length;for(;e<i;){const n=e+i>>>1,o=queue[n],l=getId(o);l<r||l===r&&o.flags&2?e=n+1:i=n}return e}function queueJob(r){if(!(r.flags&1)){const e=getId(r),i=queue[queue.length-1];!i||!(r.flags&2)&&e>=getId(i)?queue.push(r):queue.splice(findInsertionIndex$1(e),0,r),r.flags|=1,queueFlush()}}function queueFlush(){currentFlushPromise||(currentFlushPromise=resolvedPromise.then(flushJobs))}function queuePostFlushCb(r){isArray$3(r)?pendingPostFlushCbs.push(...r):activePostFlushCbs&&r.id===-1?activePostFlushCbs.splice(postFlushIndex+1,0,r):r.flags&1||(pendingPostFlushCbs.push(r),r.flags|=1),queueFlush()}function flushPreFlushCbs(r,e,i=flushIndex+1){for(;i<queue.length;i++){const n=queue[i];if(n&&n.flags&2){if(r&&n.id!==r.uid)continue;queue.splice(i,1),i--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function flushPostFlushCbs(r){if(pendingPostFlushCbs.length){const e=[...new Set(pendingPostFlushCbs)].sort((i,n)=>getId(i)-getId(n));if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...e);return}for(activePostFlushCbs=e,postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++){const i=activePostFlushCbs[postFlushIndex];i.flags&4&&(i.flags&=-2),i.flags&8||i(),i.flags&=-2}activePostFlushCbs=null,postFlushIndex=0}}const getId=r=>r.id==null?r.flags&2?-1:1/0:r.id;function flushJobs(r){try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const e=queue[flushIndex];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),callWithErrorHandling(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;flushIndex<queue.length;flushIndex++){const e=queue[flushIndex];e&&(e.flags&=-2)}flushIndex=-1,queue.length=0,flushPostFlushCbs(),currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(r){const e=currentRenderingInstance;return currentRenderingInstance=r,currentScopeId=r&&r.type.__scopeId||null,e}function withCtx(r,e=currentRenderingInstance,i){if(!e||r._n)return r;const n=(...o)=>{n._d&&setBlockTracking(-1);const l=setCurrentRenderingInstance(e);let u;try{u=r(...o)}finally{setCurrentRenderingInstance(l),n._d&&setBlockTracking(1)}return u};return n._n=!0,n._c=!0,n._d=!0,n}function invokeDirectiveHook(r,e,i,n){const o=r.dirs,l=e&&e.dirs;for(let u=0;u<o.length;u++){const d=o[u];l&&(d.oldValue=l[u].value);let f=d.dir[n];f&&(pauseTracking(),callWithAsyncErrorHandling(f,i,8,[r.el,d,r,e]),resetTracking())}}const TeleportEndKey=Symbol("_vte"),isTeleport=r=>r.__isTeleport;function setTransitionHooks(r,e){r.shapeFlag&6&&r.component?(r.transition=e,setTransitionHooks(r.component.subTree,e)):r.shapeFlag&128?(r.ssContent.transition=e.clone(r.ssContent),r.ssFallback.transition=e.clone(r.ssFallback)):r.transition=e}/*! #__NO_SIDE_EFFECTS__ */function defineComponent(r,e){return isFunction$2(r)?extend({name:r.name},e,{setup:r}):r}function markAsyncBoundary(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}function setRef(r,e,i,n,o=!1){if(isArray$3(r)){r.forEach((v,A)=>setRef(v,e&&(isArray$3(e)?e[A]:e),i,n,o));return}if(isAsyncWrapper(n)&&!o){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&setRef(r,e,i,n.component.subTree);return}const l=n.shapeFlag&4?getComponentPublicInstance(n.component):n.el,u=o?null:l,{i:d,r:f}=r,g=e&&e.r,_=d.refs===EMPTY_OBJ?d.refs={}:d.refs,y=d.setupState,b=toRaw(y),S=y===EMPTY_OBJ?()=>!1:v=>hasOwn$1(b,v);if(g!=null&&g!==f&&(isString$2(g)?(_[g]=null,S(g)&&(y[g]=null)):isRef(g)&&(g.value=null)),isFunction$2(f))callWithErrorHandling(f,d,12,[u,_]);else{const v=isString$2(f),A=isRef(f);if(v||A){const x=()=>{if(r.f){const T=v?S(f)?y[f]:_[f]:f.value;o?isArray$3(T)&&remove(T,l):isArray$3(T)?T.includes(l)||T.push(l):v?(_[f]=[l],S(f)&&(y[f]=_[f])):(f.value=[l],r.k&&(_[r.k]=f.value))}else v?(_[f]=u,S(f)&&(y[f]=u)):A&&(f.value=u,r.k&&(_[r.k]=u))};u?(x.id=-1,queuePostRenderEffect(x,i)):x()}}}getGlobalThis$1().requestIdleCallback;getGlobalThis$1().cancelIdleCallback;const isAsyncWrapper=r=>!!r.type.__asyncLoader,isKeepAlive=r=>r.type.__isKeepAlive;function onActivated(r,e){registerKeepAliveHook(r,"a",e)}function onDeactivated(r,e){registerKeepAliveHook(r,"da",e)}function registerKeepAliveHook(r,e,i=currentInstance){const n=r.__wdc||(r.__wdc=()=>{let o=i;for(;o;){if(o.isDeactivated)return;o=o.parent}return r()});if(injectHook(e,n,i),i){let o=i.parent;for(;o&&o.parent;)isKeepAlive(o.parent.vnode)&&injectToKeepAliveRoot(n,e,i,o),o=o.parent}}function injectToKeepAliveRoot(r,e,i,n){const o=injectHook(e,r,n,!0);onUnmounted(()=>{remove(n[e],o)},i)}function injectHook(r,e,i=currentInstance,n=!1){if(i){const o=i[r]||(i[r]=[]),l=e.__weh||(e.__weh=(...u)=>{pauseTracking();const d=setCurrentInstance(i),f=callWithAsyncErrorHandling(e,i,r,u);return d(),resetTracking(),f});return n?o.unshift(l):o.push(l),l}}const createHook=r=>(e,i=currentInstance)=>{(!isInSSRComponentSetup||r==="sp")&&injectHook(r,(...n)=>e(...n),i)},onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(r,e=currentInstance){injectHook("ec",r,e)}const COMPONENTS="components";function resolveComponent(r,e){return resolveAsset(COMPONENTS,r,!0,e)||r}const NULL_DYNAMIC_COMPONENT=Symbol.for("v-ndc");function resolveAsset(r,e,i=!0,n=!1){const o=currentRenderingInstance||currentInstance;if(o){const l=o.type;{const d=getComponentName(l,!1);if(d&&(d===e||d===camelize(e)||d===capitalize$1(camelize(e))))return l}const u=resolve(o[r]||l[r],e)||resolve(o.appContext[r],e);return!u&&n?l:u}}function resolve(r,e){return r&&(r[e]||r[camelize(e)]||r[capitalize$1(camelize(e))])}const getPublicInstance=r=>r?isStatefulComponent(r)?getComponentPublicInstance(r):getPublicInstance(r.parent):null,publicPropertiesMap=extend(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>getPublicInstance(r.parent),$root:r=>getPublicInstance(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>resolveMergedOptions(r),$forceUpdate:r=>r.f||(r.f=()=>{queueJob(r.update)}),$nextTick:r=>r.n||(r.n=nextTick.bind(r.proxy)),$watch:r=>instanceWatch.bind(r)}),hasSetupBinding=(r,e)=>r!==EMPTY_OBJ&&!r.__isScriptSetup&&hasOwn$1(r,e),PublicInstanceProxyHandlers={get({_:r},e){if(e==="__v_skip")return!0;const{ctx:i,setupState:n,data:o,props:l,accessCache:u,type:d,appContext:f}=r;let g;if(e[0]!=="$"){const S=u[e];if(S!==void 0)switch(S){case 1:return n[e];case 2:return o[e];case 4:return i[e];case 3:return l[e]}else{if(hasSetupBinding(n,e))return u[e]=1,n[e];if(o!==EMPTY_OBJ&&hasOwn$1(o,e))return u[e]=2,o[e];if((g=r.propsOptions[0])&&hasOwn$1(g,e))return u[e]=3,l[e];if(i!==EMPTY_OBJ&&hasOwn$1(i,e))return u[e]=4,i[e];shouldCacheAccess&&(u[e]=0)}}const _=publicPropertiesMap[e];let y,b;if(_)return e==="$attrs"&&track(r.attrs,"get",""),_(r);if((y=d.__cssModules)&&(y=y[e]))return y;if(i!==EMPTY_OBJ&&hasOwn$1(i,e))return u[e]=4,i[e];if(b=f.config.globalProperties,hasOwn$1(b,e))return b[e]},set({_:r},e,i){const{data:n,setupState:o,ctx:l}=r;return hasSetupBinding(o,e)?(o[e]=i,!0):n!==EMPTY_OBJ&&hasOwn$1(n,e)?(n[e]=i,!0):hasOwn$1(r.props,e)||e[0]==="$"&&e.slice(1)in r?!1:(l[e]=i,!0)},has({_:{data:r,setupState:e,accessCache:i,ctx:n,appContext:o,propsOptions:l}},u){let d;return!!i[u]||r!==EMPTY_OBJ&&hasOwn$1(r,u)||hasSetupBinding(e,u)||(d=l[0])&&hasOwn$1(d,u)||hasOwn$1(n,u)||hasOwn$1(publicPropertiesMap,u)||hasOwn$1(o.config.globalProperties,u)},defineProperty(r,e,i){return i.get!=null?r._.accessCache[e]=0:hasOwn$1(i,"value")&&this.set(r,e,i.value,null),Reflect.defineProperty(r,e,i)}};function normalizePropsOrEmits(r){return isArray$3(r)?r.reduce((e,i)=>(e[i]=null,e),{}):r}let shouldCacheAccess=!0;function applyOptions(r){const e=resolveMergedOptions(r),i=r.proxy,n=r.ctx;shouldCacheAccess=!1,e.beforeCreate&&callHook(e.beforeCreate,r,"bc");const{data:o,computed:l,methods:u,watch:d,provide:f,inject:g,created:_,beforeMount:y,mounted:b,beforeUpdate:S,updated:v,activated:A,deactivated:x,beforeDestroy:T,beforeUnmount:C,destroyed:E,unmounted:P,render:L,renderTracked:R,renderTriggered:w,errorCaptured:D,serverPrefetch:I,expose:O,inheritAttrs:B,components:N,directives:$,filters:H}=e;if(g&&resolveInjections(g,n,null),u)for(const G in u){const Y=u[G];isFunction$2(Y)&&(n[G]=Y.bind(i))}if(o){const G=o.call(i,i);isObject$3(G)&&(r.data=reactive(G))}if(shouldCacheAccess=!0,l)for(const G in l){const Y=l[G],J=isFunction$2(Y)?Y.bind(i,i):isFunction$2(Y.get)?Y.get.bind(i,i):NOOP,q=!isFunction$2(Y)&&isFunction$2(Y.set)?Y.set.bind(i):NOOP,te=computed({get:J,set:q});Object.defineProperty(n,G,{enumerable:!0,configurable:!0,get:()=>te.value,set:de=>te.value=de})}if(d)for(const G in d)createWatcher(d[G],n,i,G);if(f){const G=isFunction$2(f)?f.call(i):f;Reflect.ownKeys(G).forEach(Y=>{provide(Y,G[Y])})}_&&callHook(_,r,"c");function V(G,Y){isArray$3(Y)?Y.forEach(J=>G(J.bind(i))):Y&&G(Y.bind(i))}if(V(onBeforeMount,y),V(onMounted,b),V(onBeforeUpdate,S),V(onUpdated,v),V(onActivated,A),V(onDeactivated,x),V(onErrorCaptured,D),V(onRenderTracked,R),V(onRenderTriggered,w),V(onBeforeUnmount,C),V(onUnmounted,P),V(onServerPrefetch,I),isArray$3(O))if(O.length){const G=r.exposed||(r.exposed={});O.forEach(Y=>{Object.defineProperty(G,Y,{get:()=>i[Y],set:J=>i[Y]=J})})}else r.exposed||(r.exposed={});L&&r.render===NOOP&&(r.render=L),B!=null&&(r.inheritAttrs=B),N&&(r.components=N),$&&(r.directives=$),I&&markAsyncBoundary(r)}function resolveInjections(r,e,i=NOOP){isArray$3(r)&&(r=normalizeInject(r));for(const n in r){const o=r[n];let l;isObject$3(o)?"default"in o?l=inject$1(o.from||n,o.default,!0):l=inject$1(o.from||n):l=inject$1(o),isRef(l)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>l.value,set:u=>l.value=u}):e[n]=l}}function callHook(r,e,i){callWithAsyncErrorHandling(isArray$3(r)?r.map(n=>n.bind(e.proxy)):r.bind(e.proxy),e,i)}function createWatcher(r,e,i,n){let o=n.includes(".")?createPathGetter(i,n):()=>i[n];if(isString$2(r)){const l=e[r];isFunction$2(l)&&watch(o,l)}else if(isFunction$2(r))watch(o,r.bind(i));else if(isObject$3(r))if(isArray$3(r))r.forEach(l=>createWatcher(l,e,i,n));else{const l=isFunction$2(r.handler)?r.handler.bind(i):e[r.handler];isFunction$2(l)&&watch(o,l,r)}}function resolveMergedOptions(r){const e=r.type,{mixins:i,extends:n}=e,{mixins:o,optionsCache:l,config:{optionMergeStrategies:u}}=r.appContext,d=l.get(e);let f;return d?f=d:!o.length&&!i&&!n?f=e:(f={},o.length&&o.forEach(g=>mergeOptions$1(f,g,u,!0)),mergeOptions$1(f,e,u)),isObject$3(e)&&l.set(e,f),f}function mergeOptions$1(r,e,i,n=!1){const{mixins:o,extends:l}=e;l&&mergeOptions$1(r,l,i,!0),o&&o.forEach(u=>mergeOptions$1(r,u,i,!0));for(const u in e)if(!(n&&u==="expose")){const d=internalOptionMergeStrats[u]||i&&i[u];r[u]=d?d(r[u],e[u]):e[u]}return r}const internalOptionMergeStrats={data:mergeDataFn,props:mergeEmitsOrPropsOptions,emits:mergeEmitsOrPropsOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(r,e){return e?r?function(){return extend(isFunction$2(r)?r.call(this,this):r,isFunction$2(e)?e.call(this,this):e)}:e:r}function mergeInject(r,e){return mergeObjectOptions(normalizeInject(r),normalizeInject(e))}function normalizeInject(r){if(isArray$3(r)){const e={};for(let i=0;i<r.length;i++)e[r[i]]=r[i];return e}return r}function mergeAsArray(r,e){return r?[...new Set([].concat(r,e))]:e}function mergeObjectOptions(r,e){return r?extend(Object.create(null),r,e):e}function mergeEmitsOrPropsOptions(r,e){return r?isArray$3(r)&&isArray$3(e)?[...new Set([...r,...e])]:extend(Object.create(null),normalizePropsOrEmits(r),normalizePropsOrEmits(e??{})):e}function mergeWatchOptions(r,e){if(!r)return e;if(!e)return r;const i=extend(Object.create(null),r);for(const n in e)i[n]=mergeAsArray(r[n],e[n]);return i}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(r,e){return function(n,o=null){isFunction$2(n)||(n=extend({},n)),o!=null&&!isObject$3(o)&&(o=null);const l=createAppContext(),u=new WeakSet,d=[];let f=!1;const g=l.app={_uid:uid$1++,_component:n,_props:o,_container:null,_context:l,_instance:null,version,get config(){return l.config},set config(_){},use(_,...y){return u.has(_)||(_&&isFunction$2(_.install)?(u.add(_),_.install(g,...y)):isFunction$2(_)&&(u.add(_),_(g,...y))),g},mixin(_){return l.mixins.includes(_)||l.mixins.push(_),g},component(_,y){return y?(l.components[_]=y,g):l.components[_]},directive(_,y){return y?(l.directives[_]=y,g):l.directives[_]},mount(_,y,b){if(!f){const S=g._ceVNode||createVNode(n,o);return S.appContext=l,b===!0?b="svg":b===!1&&(b=void 0),r(S,_,b),f=!0,g._container=_,_.__vue_app__=g,getComponentPublicInstance(S.component)}},onUnmount(_){d.push(_)},unmount(){f&&(callWithAsyncErrorHandling(d,g._instance,16),r(null,g._container),delete g._container.__vue_app__)},provide(_,y){return l.provides[_]=y,g},runWithContext(_){const y=currentApp;currentApp=g;try{return _()}finally{currentApp=y}}};return g}}let currentApp=null;function provide(r,e){if(currentInstance){let i=currentInstance.provides;const n=currentInstance.parent&&currentInstance.parent.provides;n===i&&(i=currentInstance.provides=Object.create(n)),i[r]=e}}function inject$1(r,e,i=!1){const n=currentInstance||currentRenderingInstance;if(n||currentApp){const o=currentApp?currentApp._context.provides:n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(o&&r in o)return o[r];if(arguments.length>1)return i&&isFunction$2(e)?e.call(n&&n.proxy):e}}const internalObjectProto={},createInternalObject=()=>Object.create(internalObjectProto),isInternalObject=r=>Object.getPrototypeOf(r)===internalObjectProto;function initProps(r,e,i,n=!1){const o={},l=createInternalObject();r.propsDefaults=Object.create(null),setFullProps(r,e,o,l);for(const u in r.propsOptions[0])u in o||(o[u]=void 0);i?r.props=n?o:shallowReactive(o):r.type.props?r.props=o:r.props=l,r.attrs=l}function updateProps(r,e,i,n){const{props:o,attrs:l,vnode:{patchFlag:u}}=r,d=toRaw(o),[f]=r.propsOptions;let g=!1;if((n||u>0)&&!(u&16)){if(u&8){const _=r.vnode.dynamicProps;for(let y=0;y<_.length;y++){let b=_[y];if(isEmitListener(r.emitsOptions,b))continue;const S=e[b];if(f)if(hasOwn$1(l,b))S!==l[b]&&(l[b]=S,g=!0);else{const v=camelize(b);o[v]=resolvePropValue(f,d,v,S,r,!1)}else S!==l[b]&&(l[b]=S,g=!0)}}}else{setFullProps(r,e,o,l)&&(g=!0);let _;for(const y in d)(!e||!hasOwn$1(e,y)&&((_=hyphenate(y))===y||!hasOwn$1(e,_)))&&(f?i&&(i[y]!==void 0||i[_]!==void 0)&&(o[y]=resolvePropValue(f,d,y,void 0,r,!0)):delete o[y]);if(l!==d)for(const y in l)(!e||!hasOwn$1(e,y))&&(delete l[y],g=!0)}g&&trigger(r.attrs,"set","")}function setFullProps(r,e,i,n){const[o,l]=r.propsOptions;let u=!1,d;if(e)for(let f in e){if(isReservedProp(f))continue;const g=e[f];let _;o&&hasOwn$1(o,_=camelize(f))?!l||!l.includes(_)?i[_]=g:(d||(d={}))[_]=g:isEmitListener(r.emitsOptions,f)||(!(f in n)||g!==n[f])&&(n[f]=g,u=!0)}if(l){const f=toRaw(i),g=d||EMPTY_OBJ;for(let _=0;_<l.length;_++){const y=l[_];i[y]=resolvePropValue(o,f,y,g[y],r,!hasOwn$1(g,y))}}return u}function resolvePropValue(r,e,i,n,o,l){const u=r[i];if(u!=null){const d=hasOwn$1(u,"default");if(d&&n===void 0){const f=u.default;if(u.type!==Function&&!u.skipFactory&&isFunction$2(f)){const{propsDefaults:g}=o;if(i in g)n=g[i];else{const _=setCurrentInstance(o);n=g[i]=f.call(null,e),_()}}else n=f;o.ce&&o.ce._setProp(i,n)}u[0]&&(l&&!d?n=!1:u[1]&&(n===""||n===hyphenate(i))&&(n=!0))}return n}const mixinPropsCache=new WeakMap;function normalizePropsOptions(r,e,i=!1){const n=i?mixinPropsCache:e.propsCache,o=n.get(r);if(o)return o;const l=r.props,u={},d=[];let f=!1;if(!isFunction$2(r)){const _=y=>{f=!0;const[b,S]=normalizePropsOptions(y,e,!0);extend(u,b),S&&d.push(...S)};!i&&e.mixins.length&&e.mixins.forEach(_),r.extends&&_(r.extends),r.mixins&&r.mixins.forEach(_)}if(!l&&!f)return isObject$3(r)&&n.set(r,EMPTY_ARR),EMPTY_ARR;if(isArray$3(l))for(let _=0;_<l.length;_++){const y=camelize(l[_]);validatePropName(y)&&(u[y]=EMPTY_OBJ)}else if(l)for(const _ in l){const y=camelize(_);if(validatePropName(y)){const b=l[_],S=u[y]=isArray$3(b)||isFunction$2(b)?{type:b}:extend({},b),v=S.type;let A=!1,x=!0;if(isArray$3(v))for(let T=0;T<v.length;++T){const C=v[T],E=isFunction$2(C)&&C.name;if(E==="Boolean"){A=!0;break}else E==="String"&&(x=!1)}else A=isFunction$2(v)&&v.name==="Boolean";S[0]=A,S[1]=x,(A||hasOwn$1(S,"default"))&&d.push(y)}}const g=[u,d];return isObject$3(r)&&n.set(r,g),g}function validatePropName(r){return r[0]!=="$"&&!isReservedProp(r)}const isInternalKey=r=>r[0]==="_"||r==="$stable",normalizeSlotValue=r=>isArray$3(r)?r.map(normalizeVNode):[normalizeVNode(r)],normalizeSlot$1=(r,e,i)=>{if(e._n)return e;const n=withCtx((...o)=>normalizeSlotValue(e(...o)),i);return n._c=!1,n},normalizeObjectSlots=(r,e,i)=>{const n=r._ctx;for(const o in r){if(isInternalKey(o))continue;const l=r[o];if(isFunction$2(l))e[o]=normalizeSlot$1(o,l,n);else if(l!=null){const u=normalizeSlotValue(l);e[o]=()=>u}}},normalizeVNodeSlots=(r,e)=>{const i=normalizeSlotValue(e);r.slots.default=()=>i},assignSlots=(r,e,i)=>{for(const n in e)(i||n!=="_")&&(r[n]=e[n])},initSlots=(r,e,i)=>{const n=r.slots=createInternalObject();if(r.vnode.shapeFlag&32){const o=e._;o?(assignSlots(n,e,i),i&&def(n,"_",o,!0)):normalizeObjectSlots(e,n)}else e&&normalizeVNodeSlots(r,e)},updateSlots=(r,e,i)=>{const{vnode:n,slots:o}=r;let l=!0,u=EMPTY_OBJ;if(n.shapeFlag&32){const d=e._;d?i&&d===1?l=!1:assignSlots(o,e,i):(l=!e.$stable,normalizeObjectSlots(e,o)),u=e}else e&&(normalizeVNodeSlots(r,e),u={default:1});if(l)for(const d in o)!isInternalKey(d)&&u[d]==null&&delete o[d]},queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(r){return baseCreateRenderer(r)}function baseCreateRenderer(r,e){const i=getGlobalThis$1();i.__VUE__=!0;const{insert:n,remove:o,patchProp:l,createElement:u,createText:d,createComment:f,setText:g,setElementText:_,parentNode:y,nextSibling:b,setScopeId:S=NOOP,insertStaticContent:v}=r,A=(z,W,K,ne=null,se=null,ae=null,j=void 0,U=null,X=!!W.dynamicChildren)=>{if(z===W)return;z&&!isSameVNodeType(z,W)&&(ne=ee(z),de(z,se,ae,!0),z=null),W.patchFlag===-2&&(X=!1,W.dynamicChildren=null);const{type:re,ref:ge,shapeFlag:ue}=W;switch(re){case Text$2:x(z,W,K,ne);break;case Comment:T(z,W,K,ne);break;case Static:z==null&&C(W,K,ne,j);break;case Fragment:N(z,W,K,ne,se,ae,j,U,X);break;default:ue&1?L(z,W,K,ne,se,ae,j,U,X):ue&6?$(z,W,K,ne,se,ae,j,U,X):(ue&64||ue&128)&&re.process(z,W,K,ne,se,ae,j,U,X,le)}ge!=null&&se&&setRef(ge,z&&z.ref,ae,W||z,!W)},x=(z,W,K,ne)=>{if(z==null)n(W.el=d(W.children),K,ne);else{const se=W.el=z.el;W.children!==z.children&&g(se,W.children)}},T=(z,W,K,ne)=>{z==null?n(W.el=f(W.children||""),K,ne):W.el=z.el},C=(z,W,K,ne)=>{[z.el,z.anchor]=v(z.children,W,K,ne,z.el,z.anchor)},E=({el:z,anchor:W},K,ne)=>{let se;for(;z&&z!==W;)se=b(z),n(z,K,ne),z=se;n(W,K,ne)},P=({el:z,anchor:W})=>{let K;for(;z&&z!==W;)K=b(z),o(z),z=K;o(W)},L=(z,W,K,ne,se,ae,j,U,X)=>{W.type==="svg"?j="svg":W.type==="math"&&(j="mathml"),z==null?R(W,K,ne,se,ae,j,U,X):I(z,W,se,ae,j,U,X)},R=(z,W,K,ne,se,ae,j,U)=>{let X,re;const{props:ge,shapeFlag:ue,transition:Z,dirs:oe}=z;if(X=z.el=u(z.type,ae,ge&&ge.is,ge),ue&8?_(X,z.children):ue&16&&D(z.children,X,null,ne,se,resolveChildrenNamespace(z,ae),j,U),oe&&invokeDirectiveHook(z,null,ne,"created"),w(X,z,z.scopeId,j,ne),ge){for(const ye in ge)ye!=="value"&&!isReservedProp(ye)&&l(X,ye,null,ge[ye],ae,ne);"value"in ge&&l(X,"value",null,ge.value,ae),(re=ge.onVnodeBeforeMount)&&invokeVNodeHook(re,ne,z)}oe&&invokeDirectiveHook(z,null,ne,"beforeMount");const _e=needTransition(se,Z);_e&&Z.beforeEnter(X),n(X,W,K),((re=ge&&ge.onVnodeMounted)||_e||oe)&&queuePostRenderEffect(()=>{re&&invokeVNodeHook(re,ne,z),_e&&Z.enter(X),oe&&invokeDirectiveHook(z,null,ne,"mounted")},se)},w=(z,W,K,ne,se)=>{if(K&&S(z,K),ne)for(let ae=0;ae<ne.length;ae++)S(z,ne[ae]);if(se){let ae=se.subTree;if(W===ae||isSuspense(ae.type)&&(ae.ssContent===W||ae.ssFallback===W)){const j=se.vnode;w(z,j,j.scopeId,j.slotScopeIds,se.parent)}}},D=(z,W,K,ne,se,ae,j,U,X=0)=>{for(let re=X;re<z.length;re++){const ge=z[re]=U?cloneIfMounted(z[re]):normalizeVNode(z[re]);A(null,ge,W,K,ne,se,ae,j,U)}},I=(z,W,K,ne,se,ae,j)=>{const U=W.el=z.el;let{patchFlag:X,dynamicChildren:re,dirs:ge}=W;X|=z.patchFlag&16;const ue=z.props||EMPTY_OBJ,Z=W.props||EMPTY_OBJ;let oe;if(K&&toggleRecurse(K,!1),(oe=Z.onVnodeBeforeUpdate)&&invokeVNodeHook(oe,K,W,z),ge&&invokeDirectiveHook(W,z,K,"beforeUpdate"),K&&toggleRecurse(K,!0),(ue.innerHTML&&Z.innerHTML==null||ue.textContent&&Z.textContent==null)&&_(U,""),re?O(z.dynamicChildren,re,U,K,ne,resolveChildrenNamespace(W,se),ae):j||Y(z,W,U,null,K,ne,resolveChildrenNamespace(W,se),ae,!1),X>0){if(X&16)B(U,ue,Z,K,se);else if(X&2&&ue.class!==Z.class&&l(U,"class",null,Z.class,se),X&4&&l(U,"style",ue.style,Z.style,se),X&8){const _e=W.dynamicProps;for(let ye=0;ye<_e.length;ye++){const Se=_e[ye],Ae=ue[Se],ve=Z[Se];(ve!==Ae||Se==="value")&&l(U,Se,Ae,ve,se,K)}}X&1&&z.children!==W.children&&_(U,W.children)}else!j&&re==null&&B(U,ue,Z,K,se);((oe=Z.onVnodeUpdated)||ge)&&queuePostRenderEffect(()=>{oe&&invokeVNodeHook(oe,K,W,z),ge&&invokeDirectiveHook(W,z,K,"updated")},ne)},O=(z,W,K,ne,se,ae,j)=>{for(let U=0;U<W.length;U++){const X=z[U],re=W[U],ge=X.el&&(X.type===Fragment||!isSameVNodeType(X,re)||X.shapeFlag&70)?y(X.el):K;A(X,re,ge,null,ne,se,ae,j,!0)}},B=(z,W,K,ne,se)=>{if(W!==K){if(W!==EMPTY_OBJ)for(const ae in W)!isReservedProp(ae)&&!(ae in K)&&l(z,ae,W[ae],null,se,ne);for(const ae in K){if(isReservedProp(ae))continue;const j=K[ae],U=W[ae];j!==U&&ae!=="value"&&l(z,ae,U,j,se,ne)}"value"in K&&l(z,"value",W.value,K.value,se)}},N=(z,W,K,ne,se,ae,j,U,X)=>{const re=W.el=z?z.el:d(""),ge=W.anchor=z?z.anchor:d("");let{patchFlag:ue,dynamicChildren:Z,slotScopeIds:oe}=W;oe&&(U=U?U.concat(oe):oe),z==null?(n(re,K,ne),n(ge,K,ne),D(W.children||[],K,ge,se,ae,j,U,X)):ue>0&&ue&64&&Z&&z.dynamicChildren?(O(z.dynamicChildren,Z,K,se,ae,j,U),(W.key!=null||se&&W===se.subTree)&&traverseStaticChildren(z,W,!0)):Y(z,W,K,ge,se,ae,j,U,X)},$=(z,W,K,ne,se,ae,j,U,X)=>{W.slotScopeIds=U,z==null?W.shapeFlag&512?se.ctx.activate(W,K,ne,j,X):H(W,K,ne,se,ae,j,X):F(z,W,X)},H=(z,W,K,ne,se,ae,j)=>{const U=z.component=createComponentInstance(z,ne,se);if(isKeepAlive(z)&&(U.ctx.renderer=le),setupComponent(U,!1,j),U.asyncDep){if(se&&se.registerDep(U,V,j),!z.el){const X=U.subTree=createVNode(Comment);T(null,X,W,K)}}else V(U,z,W,K,se,ae,j)},F=(z,W,K)=>{const ne=W.component=z.component;if(shouldUpdateComponent(z,W,K))if(ne.asyncDep&&!ne.asyncResolved){G(ne,W,K);return}else ne.next=W,ne.update();else W.el=z.el,ne.vnode=W},V=(z,W,K,ne,se,ae,j)=>{const U=()=>{if(z.isMounted){let{next:ue,bu:Z,u:oe,parent:_e,vnode:ye}=z;{const Te=locateNonHydratedAsyncRoot(z);if(Te){ue&&(ue.el=ye.el,G(z,ue,j)),Te.asyncDep.then(()=>{z.isUnmounted||U()});return}}let Se=ue,Ae;toggleRecurse(z,!1),ue?(ue.el=ye.el,G(z,ue,j)):ue=ye,Z&&invokeArrayFns(Z),(Ae=ue.props&&ue.props.onVnodeBeforeUpdate)&&invokeVNodeHook(Ae,_e,ue,ye),toggleRecurse(z,!0);const ve=renderComponentRoot(z),xe=z.subTree;z.subTree=ve,A(xe,ve,y(xe.el),ee(xe),z,se,ae),ue.el=ve.el,Se===null&&updateHOCHostEl(z,ve.el),oe&&queuePostRenderEffect(oe,se),(Ae=ue.props&&ue.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(Ae,_e,ue,ye),se)}else{let ue;const{el:Z,props:oe}=W,{bm:_e,m:ye,parent:Se,root:Ae,type:ve}=z,xe=isAsyncWrapper(W);toggleRecurse(z,!1),_e&&invokeArrayFns(_e),!xe&&(ue=oe&&oe.onVnodeBeforeMount)&&invokeVNodeHook(ue,Se,W),toggleRecurse(z,!0);{Ae.ce&&Ae.ce._injectChildStyle(ve);const Te=z.subTree=renderComponentRoot(z);A(null,Te,K,ne,z,se,ae),W.el=Te.el}if(ye&&queuePostRenderEffect(ye,se),!xe&&(ue=oe&&oe.onVnodeMounted)){const Te=W;queuePostRenderEffect(()=>invokeVNodeHook(ue,Se,Te),se)}(W.shapeFlag&256||Se&&isAsyncWrapper(Se.vnode)&&Se.vnode.shapeFlag&256)&&z.a&&queuePostRenderEffect(z.a,se),z.isMounted=!0,W=K=ne=null}};z.scope.on();const X=z.effect=new ReactiveEffect(U);z.scope.off();const re=z.update=X.run.bind(X),ge=z.job=X.runIfDirty.bind(X);ge.i=z,ge.id=z.uid,X.scheduler=()=>queueJob(ge),toggleRecurse(z,!0),re()},G=(z,W,K)=>{W.component=z;const ne=z.vnode.props;z.vnode=W,z.next=null,updateProps(z,W.props,ne,K),updateSlots(z,W.children,K),pauseTracking(),flushPreFlushCbs(z),resetTracking()},Y=(z,W,K,ne,se,ae,j,U,X=!1)=>{const re=z&&z.children,ge=z?z.shapeFlag:0,ue=W.children,{patchFlag:Z,shapeFlag:oe}=W;if(Z>0){if(Z&128){q(re,ue,K,ne,se,ae,j,U,X);return}else if(Z&256){J(re,ue,K,ne,se,ae,j,U,X);return}}oe&8?(ge&16&&me(re,se,ae),ue!==re&&_(K,ue)):ge&16?oe&16?q(re,ue,K,ne,se,ae,j,U,X):me(re,se,ae,!0):(ge&8&&_(K,""),oe&16&&D(ue,K,ne,se,ae,j,U,X))},J=(z,W,K,ne,se,ae,j,U,X)=>{z=z||EMPTY_ARR,W=W||EMPTY_ARR;const re=z.length,ge=W.length,ue=Math.min(re,ge);let Z;for(Z=0;Z<ue;Z++){const oe=W[Z]=X?cloneIfMounted(W[Z]):normalizeVNode(W[Z]);A(z[Z],oe,K,null,se,ae,j,U,X)}re>ge?me(z,se,ae,!0,!1,ue):D(W,K,ne,se,ae,j,U,X,ue)},q=(z,W,K,ne,se,ae,j,U,X)=>{let re=0;const ge=W.length;let ue=z.length-1,Z=ge-1;for(;re<=ue&&re<=Z;){const oe=z[re],_e=W[re]=X?cloneIfMounted(W[re]):normalizeVNode(W[re]);if(isSameVNodeType(oe,_e))A(oe,_e,K,null,se,ae,j,U,X);else break;re++}for(;re<=ue&&re<=Z;){const oe=z[ue],_e=W[Z]=X?cloneIfMounted(W[Z]):normalizeVNode(W[Z]);if(isSameVNodeType(oe,_e))A(oe,_e,K,null,se,ae,j,U,X);else break;ue--,Z--}if(re>ue){if(re<=Z){const oe=Z+1,_e=oe<ge?W[oe].el:ne;for(;re<=Z;)A(null,W[re]=X?cloneIfMounted(W[re]):normalizeVNode(W[re]),K,_e,se,ae,j,U,X),re++}}else if(re>Z)for(;re<=ue;)de(z[re],se,ae,!0),re++;else{const oe=re,_e=re,ye=new Map;for(re=_e;re<=Z;re++){const Ce=W[re]=X?cloneIfMounted(W[re]):normalizeVNode(W[re]);Ce.key!=null&&ye.set(Ce.key,re)}let Se,Ae=0;const ve=Z-_e+1;let xe=!1,Te=0;const Me=new Array(ve);for(re=0;re<ve;re++)Me[re]=0;for(re=oe;re<=ue;re++){const Ce=z[re];if(Ae>=ve){de(Ce,se,ae,!0);continue}let ke;if(Ce.key!=null)ke=ye.get(Ce.key);else for(Se=_e;Se<=Z;Se++)if(Me[Se-_e]===0&&isSameVNodeType(Ce,W[Se])){ke=Se;break}ke===void 0?de(Ce,se,ae,!0):(Me[ke-_e]=re+1,ke>=Te?Te=ke:xe=!0,A(Ce,W[ke],K,null,se,ae,j,U,X),Ae++)}const Be=xe?getSequence(Me):EMPTY_ARR;for(Se=Be.length-1,re=ve-1;re>=0;re--){const Ce=_e+re,ke=W[Ce],Fe=Ce+1<ge?W[Ce+1].el:ne;Me[re]===0?A(null,ke,K,Fe,se,ae,j,U,X):xe&&(Se<0||re!==Be[Se]?te(ke,K,Fe,2):Se--)}}},te=(z,W,K,ne,se=null)=>{const{el:ae,type:j,transition:U,children:X,shapeFlag:re}=z;if(re&6){te(z.component.subTree,W,K,ne);return}if(re&128){z.suspense.move(W,K,ne);return}if(re&64){j.move(z,W,K,le);return}if(j===Fragment){n(ae,W,K);for(let ue=0;ue<X.length;ue++)te(X[ue],W,K,ne);n(z.anchor,W,K);return}if(j===Static){E(z,W,K);return}if(ne!==2&&re&1&&U)if(ne===0)U.beforeEnter(ae),n(ae,W,K),queuePostRenderEffect(()=>U.enter(ae),se);else{const{leave:ue,delayLeave:Z,afterLeave:oe}=U,_e=()=>n(ae,W,K),ye=()=>{ue(ae,()=>{_e(),oe&&oe()})};Z?Z(ae,_e,ye):ye()}else n(ae,W,K)},de=(z,W,K,ne=!1,se=!1)=>{const{type:ae,props:j,ref:U,children:X,dynamicChildren:re,shapeFlag:ge,patchFlag:ue,dirs:Z,cacheIndex:oe}=z;if(ue===-2&&(se=!1),U!=null&&setRef(U,null,K,z,!0),oe!=null&&(W.renderCache[oe]=void 0),ge&256){W.ctx.deactivate(z);return}const _e=ge&1&&Z,ye=!isAsyncWrapper(z);let Se;if(ye&&(Se=j&&j.onVnodeBeforeUnmount)&&invokeVNodeHook(Se,W,z),ge&6)pe(z.component,K,ne);else{if(ge&128){z.suspense.unmount(K,ne);return}_e&&invokeDirectiveHook(z,null,W,"beforeUnmount"),ge&64?z.type.remove(z,W,K,le,ne):re&&!re.hasOnce&&(ae!==Fragment||ue>0&&ue&64)?me(re,W,K,!1,!0):(ae===Fragment&&ue&384||!se&&ge&16)&&me(X,W,K),ne&&he(z)}(ye&&(Se=j&&j.onVnodeUnmounted)||_e)&&queuePostRenderEffect(()=>{Se&&invokeVNodeHook(Se,W,z),_e&&invokeDirectiveHook(z,null,W,"unmounted")},K)},he=z=>{const{type:W,el:K,anchor:ne,transition:se}=z;if(W===Fragment){fe(K,ne);return}if(W===Static){P(z);return}const ae=()=>{o(K),se&&!se.persisted&&se.afterLeave&&se.afterLeave()};if(z.shapeFlag&1&&se&&!se.persisted){const{leave:j,delayLeave:U}=se,X=()=>j(K,ae);U?U(z.el,ae,X):X()}else ae()},fe=(z,W)=>{let K;for(;z!==W;)K=b(z),o(z),z=K;o(W)},pe=(z,W,K)=>{const{bum:ne,scope:se,job:ae,subTree:j,um:U,m:X,a:re}=z;invalidateMount(X),invalidateMount(re),ne&&invokeArrayFns(ne),se.stop(),ae&&(ae.flags|=8,de(j,z,W,K)),U&&queuePostRenderEffect(U,W),queuePostRenderEffect(()=>{z.isUnmounted=!0},W),W&&W.pendingBranch&&!W.isUnmounted&&z.asyncDep&&!z.asyncResolved&&z.suspenseId===W.pendingId&&(W.deps--,W.deps===0&&W.resolve())},me=(z,W,K,ne=!1,se=!1,ae=0)=>{for(let j=ae;j<z.length;j++)de(z[j],W,K,ne,se)},ee=z=>{if(z.shapeFlag&6)return ee(z.component.subTree);if(z.shapeFlag&128)return z.suspense.next();const W=b(z.anchor||z.el),K=W&&W[TeleportEndKey];return K?b(K):W};let Q=!1;const ie=(z,W,K)=>{z==null?W._vnode&&de(W._vnode,null,null,!0):A(W._vnode||null,z,W,null,null,null,K),W._vnode=z,Q||(Q=!0,flushPreFlushCbs(),flushPostFlushCbs(),Q=!1)},le={p:A,um:de,m:te,r:he,mt:H,mc:D,pc:Y,pbc:O,n:ee,o:r};return{render:ie,hydrate:void 0,createApp:createAppAPI(ie)}}function resolveChildrenNamespace({type:r,props:e},i){return i==="svg"&&r==="foreignObject"||i==="mathml"&&r==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:i}function toggleRecurse({effect:r,job:e},i){i?(r.flags|=32,e.flags|=4):(r.flags&=-33,e.flags&=-5)}function needTransition(r,e){return(!r||r&&!r.pendingBranch)&&e&&!e.persisted}function traverseStaticChildren(r,e,i=!1){const n=r.children,o=e.children;if(isArray$3(n)&&isArray$3(o))for(let l=0;l<n.length;l++){const u=n[l];let d=o[l];d.shapeFlag&1&&!d.dynamicChildren&&((d.patchFlag<=0||d.patchFlag===32)&&(d=o[l]=cloneIfMounted(o[l]),d.el=u.el),!i&&d.patchFlag!==-2&&traverseStaticChildren(u,d)),d.type===Text$2&&(d.el=u.el)}}function getSequence(r){const e=r.slice(),i=[0];let n,o,l,u,d;const f=r.length;for(n=0;n<f;n++){const g=r[n];if(g!==0){if(o=i[i.length-1],r[o]<g){e[n]=o,i.push(n);continue}for(l=0,u=i.length-1;l<u;)d=l+u>>1,r[i[d]]<g?l=d+1:u=d;g<r[i[l]]&&(l>0&&(e[n]=i[l-1]),i[l]=n)}}for(l=i.length,u=i[l-1];l-- >0;)i[l]=u,u=e[u];return i}function locateNonHydratedAsyncRoot(r){const e=r.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:locateNonHydratedAsyncRoot(e)}function invalidateMount(r){if(r)for(let e=0;e<r.length;e++)r[e].flags|=8}const ssrContextKey=Symbol.for("v-scx"),useSSRContext=()=>inject$1(ssrContextKey);function watch(r,e,i){return doWatch(r,e,i)}function doWatch(r,e,i=EMPTY_OBJ){const{immediate:n,deep:o,flush:l,once:u}=i,d=extend({},i),f=e&&n||!e&&l!=="post";let g;if(isInSSRComponentSetup){if(l==="sync"){const S=useSSRContext();g=S.__watcherHandles||(S.__watcherHandles=[])}else if(!f){const S=()=>{};return S.stop=NOOP,S.resume=NOOP,S.pause=NOOP,S}}const _=currentInstance;d.call=(S,v,A)=>callWithAsyncErrorHandling(S,_,v,A);let y=!1;l==="post"?d.scheduler=S=>{queuePostRenderEffect(S,_&&_.suspense)}:l!=="sync"&&(y=!0,d.scheduler=(S,v)=>{v?S():queueJob(S)}),d.augmentJob=S=>{e&&(S.flags|=4),y&&(S.flags|=2,_&&(S.id=_.uid,S.i=_))};const b=watch$1(r,e,d);return isInSSRComponentSetup&&(g?g.push(b):f&&b()),b}function instanceWatch(r,e,i){const n=this.proxy,o=isString$2(r)?r.includes(".")?createPathGetter(n,r):()=>n[r]:r.bind(n,n);let l;isFunction$2(e)?l=e:(l=e.handler,i=e);const u=setCurrentInstance(this),d=doWatch(o,l.bind(n),i);return u(),d}function createPathGetter(r,e){const i=e.split(".");return()=>{let n=r;for(let o=0;o<i.length&&n;o++)n=n[i[o]];return n}}const getModelModifiers=(r,e)=>e==="modelValue"||e==="model-value"?r.modelModifiers:r[`${e}Modifiers`]||r[`${camelize(e)}Modifiers`]||r[`${hyphenate(e)}Modifiers`];function emit(r,e,...i){if(r.isUnmounted)return;const n=r.vnode.props||EMPTY_OBJ;let o=i;const l=e.startsWith("update:"),u=l&&getModelModifiers(n,e.slice(7));u&&(u.trim&&(o=i.map(_=>isString$2(_)?_.trim():_)),u.number&&(o=i.map(looseToNumber)));let d,f=n[d=toHandlerKey(e)]||n[d=toHandlerKey(camelize(e))];!f&&l&&(f=n[d=toHandlerKey(hyphenate(e))]),f&&callWithAsyncErrorHandling(f,r,6,o);const g=n[d+"Once"];if(g){if(!r.emitted)r.emitted={};else if(r.emitted[d])return;r.emitted[d]=!0,callWithAsyncErrorHandling(g,r,6,o)}}function normalizeEmitsOptions(r,e,i=!1){const n=e.emitsCache,o=n.get(r);if(o!==void 0)return o;const l=r.emits;let u={},d=!1;if(!isFunction$2(r)){const f=g=>{const _=normalizeEmitsOptions(g,e,!0);_&&(d=!0,extend(u,_))};!i&&e.mixins.length&&e.mixins.forEach(f),r.extends&&f(r.extends),r.mixins&&r.mixins.forEach(f)}return!l&&!d?(isObject$3(r)&&n.set(r,null),null):(isArray$3(l)?l.forEach(f=>u[f]=null):extend(u,l),isObject$3(r)&&n.set(r,u),u)}function isEmitListener(r,e){return!r||!isOn(e)?!1:(e=e.slice(2).replace(/Once$/,""),hasOwn$1(r,e[0].toLowerCase()+e.slice(1))||hasOwn$1(r,hyphenate(e))||hasOwn$1(r,e))}function markAttrsAccessed(){}function renderComponentRoot(r){const{type:e,vnode:i,proxy:n,withProxy:o,propsOptions:[l],slots:u,attrs:d,emit:f,render:g,renderCache:_,props:y,data:b,setupState:S,ctx:v,inheritAttrs:A}=r,x=setCurrentRenderingInstance(r);let T,C;try{if(i.shapeFlag&4){const P=o||n,L=P;T=normalizeVNode(g.call(L,P,_,y,S,b,v)),C=d}else{const P=e;T=normalizeVNode(P.length>1?P(y,{attrs:d,slots:u,emit:f}):P(y,null)),C=e.props?d:getFunctionalFallthrough(d)}}catch(P){blockStack.length=0,handleError(P,r,1),T=createVNode(Comment)}let E=T;if(C&&A!==!1){const P=Object.keys(C),{shapeFlag:L}=E;P.length&&L&7&&(l&&P.some(isModelListener)&&(C=filterModelListeners(C,l)),E=cloneVNode(E,C,!1,!0))}return i.dirs&&(E=cloneVNode(E,null,!1,!0),E.dirs=E.dirs?E.dirs.concat(i.dirs):i.dirs),i.transition&&setTransitionHooks(E,i.transition),T=E,setCurrentRenderingInstance(x),T}const getFunctionalFallthrough=r=>{let e;for(const i in r)(i==="class"||i==="style"||isOn(i))&&((e||(e={}))[i]=r[i]);return e},filterModelListeners=(r,e)=>{const i={};for(const n in r)(!isModelListener(n)||!(n.slice(9)in e))&&(i[n]=r[n]);return i};function shouldUpdateComponent(r,e,i){const{props:n,children:o,component:l}=r,{props:u,children:d,patchFlag:f}=e,g=l.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&f>=0){if(f&1024)return!0;if(f&16)return n?hasPropsChanged(n,u,g):!!u;if(f&8){const _=e.dynamicProps;for(let y=0;y<_.length;y++){const b=_[y];if(u[b]!==n[b]&&!isEmitListener(g,b))return!0}}}else return(o||d)&&(!d||!d.$stable)?!0:n===u?!1:n?u?hasPropsChanged(n,u,g):!0:!!u;return!1}function hasPropsChanged(r,e,i){const n=Object.keys(e);if(n.length!==Object.keys(r).length)return!0;for(let o=0;o<n.length;o++){const l=n[o];if(e[l]!==r[l]&&!isEmitListener(i,l))return!0}return!1}function updateHOCHostEl({vnode:r,parent:e},i){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===r&&(n.el=r.el),n===r)(r=e.vnode).el=i,e=e.parent;else break}}const isSuspense=r=>r.__isSuspense;function queueEffectWithSuspense(r,e){e&&e.pendingBranch?isArray$3(r)?e.effects.push(...r):e.effects.push(r):queuePostFlushCb(r)}const Fragment=Symbol.for("v-fgt"),Text$2=Symbol.for("v-txt"),Comment=Symbol.for("v-cmt"),Static=Symbol.for("v-stc"),blockStack=[];let currentBlock=null;function openBlock(r=!1){blockStack.push(currentBlock=r?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(r,e=!1){isBlockTreeEnabled+=r,r<0&&currentBlock&&e&&(currentBlock.hasOnce=!0)}function setupBlock(r){return r.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(r),r}function createElementBlock(r,e,i,n,o,l){return setupBlock(createBaseVNode(r,e,i,n,o,l,!0))}function isVNode$1(r){return r?r.__v_isVNode===!0:!1}function isSameVNodeType(r,e){return r.type===e.type&&r.key===e.key}const normalizeKey=({key:r})=>r??null,normalizeRef=({ref:r,ref_key:e,ref_for:i})=>(typeof r=="number"&&(r=""+r),r!=null?isString$2(r)||isRef(r)||isFunction$2(r)?{i:currentRenderingInstance,r,k:e,f:!!i}:r:null);function createBaseVNode(r,e=null,i=null,n=0,o=null,l=r===Fragment?0:1,u=!1,d=!1){const f={__v_isVNode:!0,__v_skip:!0,type:r,props:e,key:e&&normalizeKey(e),ref:e&&normalizeRef(e),scopeId:currentScopeId,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:l,patchFlag:n,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return d?(normalizeChildren(f,i),l&128&&r.normalize(f)):i&&(f.shapeFlag|=isString$2(i)?8:16),isBlockTreeEnabled>0&&!u&&currentBlock&&(f.patchFlag>0||l&6)&&f.patchFlag!==32&&currentBlock.push(f),f}const createVNode=_createVNode;function _createVNode(r,e=null,i=null,n=0,o=null,l=!1){if((!r||r===NULL_DYNAMIC_COMPONENT)&&(r=Comment),isVNode$1(r)){const d=cloneVNode(r,e,!0);return i&&normalizeChildren(d,i),isBlockTreeEnabled>0&&!l&&currentBlock&&(d.shapeFlag&6?currentBlock[currentBlock.indexOf(r)]=d:currentBlock.push(d)),d.patchFlag=-2,d}if(isClassComponent(r)&&(r=r.__vccOpts),e){e=guardReactiveProps(e);let{class:d,style:f}=e;d&&!isString$2(d)&&(e.class=normalizeClass(d)),isObject$3(f)&&(isProxy(f)&&!isArray$3(f)&&(f=extend({},f)),e.style=normalizeStyle(f))}const u=isString$2(r)?1:isSuspense(r)?128:isTeleport(r)?64:isObject$3(r)?4:isFunction$2(r)?2:0;return createBaseVNode(r,e,i,n,o,u,l,!0)}function guardReactiveProps(r){return r?isProxy(r)||isInternalObject(r)?extend({},r):r:null}function cloneVNode(r,e,i=!1,n=!1){const{props:o,ref:l,patchFlag:u,children:d,transition:f}=r,g=e?mergeProps(o||{},e):o,_={__v_isVNode:!0,__v_skip:!0,type:r.type,props:g,key:g&&normalizeKey(g),ref:e&&e.ref?i&&l?isArray$3(l)?l.concat(normalizeRef(e)):[l,normalizeRef(e)]:normalizeRef(e):l,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:d,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:e&&r.type!==Fragment?u===-1?16:u|16:u,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:f,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&cloneVNode(r.ssContent),ssFallback:r.ssFallback&&cloneVNode(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return f&&n&&setTransitionHooks(_,f.clone(_)),_}function createTextVNode(r=" ",e=0){return createVNode(Text$2,null,r,e)}function createStaticVNode(r,e){const i=createVNode(Static,null,r);return i.staticCount=e,i}function normalizeVNode(r){return r==null||typeof r=="boolean"?createVNode(Comment):isArray$3(r)?createVNode(Fragment,null,r.slice()):isVNode$1(r)?cloneIfMounted(r):createVNode(Text$2,null,String(r))}function cloneIfMounted(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:cloneVNode(r)}function normalizeChildren(r,e){let i=0;const{shapeFlag:n}=r;if(e==null)e=null;else if(isArray$3(e))i=16;else if(typeof e=="object")if(n&65){const o=e.default;o&&(o._c&&(o._d=!1),normalizeChildren(r,o()),o._c&&(o._d=!0));return}else{i=32;const o=e._;!o&&!isInternalObject(e)?e._ctx=currentRenderingInstance:o===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?e._=1:(e._=2,r.patchFlag|=1024))}else isFunction$2(e)?(e={default:e,_ctx:currentRenderingInstance},i=32):(e=String(e),n&64?(i=16,e=[createTextVNode(e)]):i=8);r.children=e,r.shapeFlag|=i}function mergeProps(...r){const e={};for(let i=0;i<r.length;i++){const n=r[i];for(const o in n)if(o==="class")e.class!==n.class&&(e.class=normalizeClass([e.class,n.class]));else if(o==="style")e.style=normalizeStyle([e.style,n.style]);else if(isOn(o)){const l=e[o],u=n[o];u&&l!==u&&!(isArray$3(l)&&l.includes(u))&&(e[o]=l?[].concat(l,u):u)}else o!==""&&(e[o]=n[o])}return e}function invokeVNodeHook(r,e,i,n=null){callWithAsyncErrorHandling(r,e,7,[i,n])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(r,e,i){const n=r.type,o=(e?e.appContext:r.appContext)||emptyAppContext,l={uid:uid++,vnode:r,type:n,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(n,o),emitsOptions:normalizeEmitsOptions(n,o),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:n.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return l.ctx={_:l},l.root=e?e.root:l,l.emit=emit.bind(null,l),r.ce&&r.ce(l),l}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance;let internalSetCurrentInstance,setInSSRSetupState;{const r=getGlobalThis$1(),e=(i,n)=>{let o;return(o=r[i])||(o=r[i]=[]),o.push(n),l=>{o.length>1?o.forEach(u=>u(l)):o[0](l)}};internalSetCurrentInstance=e("__VUE_INSTANCE_SETTERS__",i=>currentInstance=i),setInSSRSetupState=e("__VUE_SSR_SETTERS__",i=>isInSSRComponentSetup=i)}const setCurrentInstance=r=>{const e=currentInstance;return internalSetCurrentInstance(r),r.scope.on(),()=>{r.scope.off(),internalSetCurrentInstance(e)}},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),internalSetCurrentInstance(null)};function isStatefulComponent(r){return r.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(r,e=!1,i=!1){e&&setInSSRSetupState(e);const{props:n,children:o}=r.vnode,l=isStatefulComponent(r);initProps(r,n,l,e),initSlots(r,o,i);const u=l?setupStatefulComponent(r,e):void 0;return e&&setInSSRSetupState(!1),u}function setupStatefulComponent(r,e){const i=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,PublicInstanceProxyHandlers);const{setup:n}=i;if(n){pauseTracking();const o=r.setupContext=n.length>1?createSetupContext(r):null,l=setCurrentInstance(r),u=callWithErrorHandling(n,r,0,[r.props,o]),d=isPromise$1(u);if(resetTracking(),l(),(d||r.sp)&&!isAsyncWrapper(r)&&markAsyncBoundary(r),d){if(u.then(unsetCurrentInstance,unsetCurrentInstance),e)return u.then(f=>{handleSetupResult(r,f)}).catch(f=>{handleError(f,r,0)});r.asyncDep=u}else handleSetupResult(r,u)}else finishComponentSetup(r)}function handleSetupResult(r,e,i){isFunction$2(e)?r.type.__ssrInlineRender?r.ssrRender=e:r.render=e:isObject$3(e)&&(r.setupState=proxyRefs(e)),finishComponentSetup(r)}function finishComponentSetup(r,e,i){const n=r.type;r.render||(r.render=n.render||NOOP);{const o=setCurrentInstance(r);pauseTracking();try{applyOptions(r)}finally{resetTracking(),o()}}}const attrsProxyHandlers={get(r,e){return track(r,"get",""),r[e]}};function createSetupContext(r){const e=i=>{r.exposed=i||{}};return{attrs:new Proxy(r.attrs,attrsProxyHandlers),slots:r.slots,emit:r.emit,expose:e}}function getComponentPublicInstance(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(proxyRefs(markRaw(r.exposed)),{get(e,i){if(i in e)return e[i];if(i in publicPropertiesMap)return publicPropertiesMap[i](r)},has(e,i){return i in e||i in publicPropertiesMap}})):r.proxy}const classifyRE=/(?:^|[-_])(\w)/g,classify=r=>r.replace(classifyRE,e=>e.toUpperCase()).replace(/[-_]/g,"");function getComponentName(r,e=!0){return isFunction$2(r)?r.displayName||r.name:r.name||e&&r.__name}function formatComponentName(r,e,i=!1){let n=getComponentName(e);if(!n&&e.__file){const o=e.__file.match(/([^/\\]+)\.\w+$/);o&&(n=o[1])}if(!n&&r&&r.parent){const o=l=>{for(const u in l)if(l[u]===e)return u};n=o(r.components||r.parent.type.components)||o(r.appContext.components)}return n?classify(n):i?"App":"Anonymous"}function isClassComponent(r){return isFunction$2(r)&&"__vccOpts"in r}const computed=(r,e)=>computed$1(r,e,isInSSRComponentSetup);function h(r,e,i){const n=arguments.length;return n===2?isObject$3(e)&&!isArray$3(e)?isVNode$1(e)?createVNode(r,null,[e]):createVNode(r,e):createVNode(r,null,e):(n>3?i=Array.prototype.slice.call(arguments,2):n===3&&isVNode$1(i)&&(i=[i]),createVNode(r,e,i))}const version="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let policy;const tt=typeof window<"u"&&window.trustedTypes;if(tt)try{policy=tt.createPolicy("vue",{createHTML:r=>r})}catch{}const unsafeToTrustedHTML=policy?r=>policy.createHTML(r):r=>r,svgNS="http://www.w3.org/2000/svg",mathmlNS="http://www.w3.org/1998/Math/MathML",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(r,e,i)=>{e.insertBefore(r,i||null)},remove:r=>{const e=r.parentNode;e&&e.removeChild(r)},createElement:(r,e,i,n)=>{const o=e==="svg"?doc.createElementNS(svgNS,r):e==="mathml"?doc.createElementNS(mathmlNS,r):i?doc.createElement(r,{is:i}):doc.createElement(r);return r==="select"&&n&&n.multiple!=null&&o.setAttribute("multiple",n.multiple),o},createText:r=>doc.createTextNode(r),createComment:r=>doc.createComment(r),setText:(r,e)=>{r.nodeValue=e},setElementText:(r,e)=>{r.textContent=e},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>doc.querySelector(r),setScopeId(r,e){r.setAttribute(e,"")},insertStaticContent(r,e,i,n,o,l){const u=i?i.previousSibling:e.lastChild;if(o&&(o===l||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),i),!(o===l||!(o=o.nextSibling)););else{templateContainer.innerHTML=unsafeToTrustedHTML(n==="svg"?`<svg>${r}</svg>`:n==="mathml"?`<math>${r}</math>`:r);const d=templateContainer.content;if(n==="svg"||n==="mathml"){const f=d.firstChild;for(;f.firstChild;)d.appendChild(f.firstChild);d.removeChild(f)}e.insertBefore(d,i)}return[u?u.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}},vtcKey=Symbol("_vtc");function patchClass(r,e,i){const n=r[vtcKey];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?r.removeAttribute("class"):i?r.setAttribute("class",e):r.className=e}const vShowOriginalDisplay=Symbol("_vod"),vShowHidden=Symbol("_vsh"),CSS_VAR_TEXT=Symbol(""),displayRE=/(^|;)\s*display\s*:/;function patchStyle(r,e,i){const n=r.style,o=isString$2(i);let l=!1;if(i&&!o){if(e)if(isString$2(e))for(const u of e.split(";")){const d=u.slice(0,u.indexOf(":")).trim();i[d]==null&&setStyle(n,d,"")}else for(const u in e)i[u]==null&&setStyle(n,u,"");for(const u in i)u==="display"&&(l=!0),setStyle(n,u,i[u])}else if(o){if(e!==i){const u=n[CSS_VAR_TEXT];u&&(i+=";"+u),n.cssText=i,l=displayRE.test(i)}}else e&&r.removeAttribute("style");vShowOriginalDisplay in r&&(r[vShowOriginalDisplay]=l?n.display:"",r[vShowHidden]&&(n.display="none"))}const importantRE=/\s*!important$/;function setStyle(r,e,i){if(isArray$3(i))i.forEach(n=>setStyle(r,e,n));else if(i==null&&(i=""),e.startsWith("--"))r.setProperty(e,i);else{const n=autoPrefix(r,e);importantRE.test(i)?r.setProperty(hyphenate(n),i.replace(importantRE,""),"important"):r[n]=i}}const prefixes$1=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(r,e){const i=prefixCache[e];if(i)return i;let n=camelize(e);if(n!=="filter"&&n in r)return prefixCache[e]=n;n=capitalize$1(n);for(let o=0;o<prefixes$1.length;o++){const l=prefixes$1[o]+n;if(l in r)return prefixCache[e]=l}return e}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(r,e,i,n,o,l=isSpecialBooleanAttr(e)){n&&e.startsWith("xlink:")?i==null?r.removeAttributeNS(xlinkNS,e.slice(6,e.length)):r.setAttributeNS(xlinkNS,e,i):i==null||l&&!includeBooleanAttr(i)?r.removeAttribute(e):r.setAttribute(e,l?"":isSymbol(i)?String(i):i)}function patchDOMProp(r,e,i,n,o){if(e==="innerHTML"||e==="textContent"){i!=null&&(r[e]=e==="innerHTML"?unsafeToTrustedHTML(i):i);return}const l=r.tagName;if(e==="value"&&l!=="PROGRESS"&&!l.includes("-")){const d=l==="OPTION"?r.getAttribute("value")||"":r.value,f=i==null?r.type==="checkbox"?"on":"":String(i);(d!==f||!("_value"in r))&&(r.value=f),i==null&&r.removeAttribute(e),r._value=i;return}let u=!1;if(i===""||i==null){const d=typeof r[e];d==="boolean"?i=includeBooleanAttr(i):i==null&&d==="string"?(i="",u=!0):d==="number"&&(i=0,u=!0)}try{r[e]=i}catch{}u&&r.removeAttribute(o||e)}function addEventListener(r,e,i,n){r.addEventListener(e,i,n)}function removeEventListener(r,e,i,n){r.removeEventListener(e,i,n)}const veiKey=Symbol("_vei");function patchEvent(r,e,i,n,o=null){const l=r[veiKey]||(r[veiKey]={}),u=l[e];if(n&&u)u.value=n;else{const[d,f]=parseName(e);if(n){const g=l[e]=createInvoker(n,o);addEventListener(r,d,g,f)}else u&&(removeEventListener(r,d,u,f),l[e]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(r){let e;if(optionsModifierRE.test(r)){e={};let n;for(;n=r.match(optionsModifierRE);)r=r.slice(0,r.length-n[0].length),e[n[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):hyphenate(r.slice(2)),e]}let cachedNow=0;const p=Promise.resolve(),getNow=()=>cachedNow||(p.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(r,e){const i=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=i.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(n,i.value),e,5,[n])};return i.value=r,i.attached=getNow(),i}function patchStopImmediatePropagation(r,e){if(isArray$3(e)){const i=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{i.call(r),r._stopped=!0},e.map(n=>o=>!o._stopped&&n&&n(o))}else return e}const isNativeOn=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,patchProp=(r,e,i,n,o,l)=>{const u=o==="svg";e==="class"?patchClass(r,n,u):e==="style"?patchStyle(r,i,n):isOn(e)?isModelListener(e)||patchEvent(r,e,i,n,l):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):shouldSetAsProp(r,e,n,u))?(patchDOMProp(r,e,n),!r.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&patchAttr(r,e,n,u,l,e!=="value")):r._isVueCE&&(/[A-Z]/.test(e)||!isString$2(n))?patchDOMProp(r,camelize(e),n,l,e):(e==="true-value"?r._trueValue=n:e==="false-value"&&(r._falseValue=n),patchAttr(r,e,n,u))};function shouldSetAsProp(r,e,i,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in r&&isNativeOn(e)&&isFunction$2(i));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&r.tagName==="INPUT"||e==="type"&&r.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const o=r.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return isNativeOn(e)&&isString$2(i)?!1:e in r}const rendererOptions=extend({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=(...r)=>{const e=ensureRenderer().createApp(...r),{mount:i}=e;return e.mount=n=>{const o=normalizeContainer(n);if(!o)return;const l=e._component;!isFunction$2(l)&&!l.render&&!l.template&&(l.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const u=i(o,!1,resolveRootNamespace(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),u},e};function resolveRootNamespace(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function normalizeContainer(r){return isString$2(r)?document.querySelector(r):r}const _imports_0$4=""+new URL("logo-D8wqlOEt.png",import.meta.url).href;/*!
  * shared v11.0.0-rc.1
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */const inBrowser=typeof window<"u",makeSymbol=(r,e=!1)=>e?Symbol.for(r):Symbol(r),generateFormatCacheKey=(r,e,i)=>friendlyJSONstringify({l:r,k:e,s:i}),friendlyJSONstringify=r=>JSON.stringify(r).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),isNumber$1=r=>typeof r=="number"&&isFinite(r),isDate$1=r=>toTypeString(r)==="[object Date]",isRegExp=r=>toTypeString(r)==="[object RegExp]",isEmptyObject=r=>isPlainObject$1(r)&&Object.keys(r).length===0,assign$1=Object.assign,_create=Object.create,create$2=(r=null)=>_create(r);let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:create$2());function escapeHtml(r){return r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const hasOwnProperty$2=Object.prototype.hasOwnProperty;function hasOwn(r,e){return hasOwnProperty$2.call(r,e)}const isArray$2=Array.isArray,isFunction$1=r=>typeof r=="function",isString$1=r=>typeof r=="string",isBoolean$1=r=>typeof r=="boolean",isObject$2=r=>r!==null&&typeof r=="object",isPromise=r=>isObject$2(r)&&isFunction$1(r.then)&&isFunction$1(r.catch),objectToString=Object.prototype.toString,toTypeString=r=>objectToString.call(r),isPlainObject$1=r=>toTypeString(r)==="[object Object]",toDisplayString=r=>r==null?"":isArray$2(r)||isPlainObject$1(r)&&r.toString===objectToString?JSON.stringify(r,null,2):String(r);function join(r,e=""){return r.reduce((i,n,o)=>o===0?i+n:i+e+n,"")}function warn$1(r,e){typeof console<"u"&&(console.warn("[intlify] "+r),e&&console.warn(e.stack))}const isNotObjectOrIsArray=r=>!isObject$2(r)||isArray$2(r);function deepCopy(r,e){if(isNotObjectOrIsArray(r)||isNotObjectOrIsArray(e))throw new Error("Invalid value");const i=[{src:r,des:e}];for(;i.length;){const{src:n,des:o}=i.pop();Object.keys(n).forEach(l=>{l!=="__proto__"&&(isObject$2(n[l])&&!isObject$2(o[l])&&(o[l]=Array.isArray(n[l])?[]:create$2()),isNotObjectOrIsArray(o[l])||isNotObjectOrIsArray(n[l])?o[l]=n[l]:i.push({src:n[l],des:o[l]}))})}}/*!
  * message-compiler v11.0.0-rc.1
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */function createPosition(r,e,i){return{line:r,column:e,offset:i}}function createLocation(r,e,i){return{start:r,end:e}}const CompileErrorCodes={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14},COMPILE_ERROR_CODES_EXTEND_POINT=17;function createCompileError(r,e,i={}){const{domain:n,messages:o,args:l}=i,u=r,d=new SyntaxError(String(u));return d.code=r,e&&(d.location=e),d.domain=n,d}function defaultOnError(r){throw r}const CHAR_SP=" ",CHAR_CR="\r",CHAR_LF=`
`,CHAR_LS="\u2028",CHAR_PS="\u2029";function createScanner(r){const e=r;let i=0,n=1,o=1,l=0;const u=w=>e[w]===CHAR_CR&&e[w+1]===CHAR_LF,d=w=>e[w]===CHAR_LF,f=w=>e[w]===CHAR_PS,g=w=>e[w]===CHAR_LS,_=w=>u(w)||d(w)||f(w)||g(w),y=()=>i,b=()=>n,S=()=>o,v=()=>l,A=w=>u(w)||f(w)||g(w)?CHAR_LF:e[w],x=()=>A(i),T=()=>A(i+l);function C(){return l=0,_(i)&&(n++,o=0),u(i)&&i++,i++,o++,e[i]}function E(){return u(i+l)&&l++,l++,e[i+l]}function P(){i=0,n=1,o=1,l=0}function L(w=0){l=w}function R(){const w=i+l;for(;w!==i;)C();l=0}return{index:y,line:b,column:S,peekOffset:v,charAt:A,currentChar:x,currentPeek:T,next:C,peek:E,reset:P,resetPeek:L,skipToPeek:R}}const EOF$1=void 0,DOT=".",LITERAL_DELIMITER="'",ERROR_DOMAIN$3="tokenizer";function createTokenizer(r,e={}){const i=e.location!==!1,n=createScanner(r),o=()=>n.index(),l=()=>createPosition(n.line(),n.column(),n.index()),u=l(),d=o(),f={currentType:13,offset:d,startLoc:u,endLoc:u,lastType:13,lastOffset:d,lastStartLoc:u,lastEndLoc:u,braceNest:0,inLinked:!1,text:""},g=()=>f,{onError:_}=e;function y(j,U,X,...re){const ge=g();if(U.column+=X,U.offset+=X,_){const ue=i?createLocation(ge.startLoc,U):null,Z=createCompileError(j,ue,{domain:ERROR_DOMAIN$3,args:re});_(Z)}}function b(j,U,X){j.endLoc=l(),j.currentType=U;const re={type:U};return i&&(re.loc=createLocation(j.startLoc,j.endLoc)),X!=null&&(re.value=X),re}const S=j=>b(j,13);function v(j,U){return j.currentChar()===U?(j.next(),U):(y(CompileErrorCodes.EXPECTED_TOKEN,l(),0,U),"")}function A(j){let U="";for(;j.currentPeek()===CHAR_SP||j.currentPeek()===CHAR_LF;)U+=j.currentPeek(),j.peek();return U}function x(j){const U=A(j);return j.skipToPeek(),U}function T(j){if(j===EOF$1)return!1;const U=j.charCodeAt(0);return U>=97&&U<=122||U>=65&&U<=90||U===95}function C(j){if(j===EOF$1)return!1;const U=j.charCodeAt(0);return U>=48&&U<=57}function E(j,U){const{currentType:X}=U;if(X!==2)return!1;A(j);const re=T(j.currentPeek());return j.resetPeek(),re}function P(j,U){const{currentType:X}=U;if(X!==2)return!1;A(j);const re=j.currentPeek()==="-"?j.peek():j.currentPeek(),ge=C(re);return j.resetPeek(),ge}function L(j,U){const{currentType:X}=U;if(X!==2)return!1;A(j);const re=j.currentPeek()===LITERAL_DELIMITER;return j.resetPeek(),re}function R(j,U){const{currentType:X}=U;if(X!==7)return!1;A(j);const re=j.currentPeek()===".";return j.resetPeek(),re}function w(j,U){const{currentType:X}=U;if(X!==8)return!1;A(j);const re=T(j.currentPeek());return j.resetPeek(),re}function D(j,U){const{currentType:X}=U;if(!(X===7||X===11))return!1;A(j);const re=j.currentPeek()===":";return j.resetPeek(),re}function I(j,U){const{currentType:X}=U;if(X!==9)return!1;const re=()=>{const ue=j.currentPeek();return ue==="{"?T(j.peek()):ue==="@"||ue==="|"||ue===":"||ue==="."||ue===CHAR_SP||!ue?!1:ue===CHAR_LF?(j.peek(),re()):B(j,!1)},ge=re();return j.resetPeek(),ge}function O(j){A(j);const U=j.currentPeek()==="|";return j.resetPeek(),U}function B(j,U=!0){const X=(ge=!1,ue="")=>{const Z=j.currentPeek();return Z==="{"||Z==="@"||!Z?ge:Z==="|"?!(ue===CHAR_SP||ue===CHAR_LF):Z===CHAR_SP?(j.peek(),X(!0,CHAR_SP)):Z===CHAR_LF?(j.peek(),X(!0,CHAR_LF)):!0},re=X();return U&&j.resetPeek(),re}function N(j,U){const X=j.currentChar();return X===EOF$1?EOF$1:U(X)?(j.next(),X):null}function $(j){const U=j.charCodeAt(0);return U>=97&&U<=122||U>=65&&U<=90||U>=48&&U<=57||U===95||U===36}function H(j){return N(j,$)}function F(j){const U=j.charCodeAt(0);return U>=97&&U<=122||U>=65&&U<=90||U>=48&&U<=57||U===95||U===36||U===45}function V(j){return N(j,F)}function G(j){const U=j.charCodeAt(0);return U>=48&&U<=57}function Y(j){return N(j,G)}function J(j){const U=j.charCodeAt(0);return U>=48&&U<=57||U>=65&&U<=70||U>=97&&U<=102}function q(j){return N(j,J)}function te(j){let U="",X="";for(;U=Y(j);)X+=U;return X}function de(j){let U="";for(;;){const X=j.currentChar();if(X==="{"||X==="}"||X==="@"||X==="|"||!X)break;if(X===CHAR_SP||X===CHAR_LF)if(B(j))U+=X,j.next();else{if(O(j))break;U+=X,j.next()}else U+=X,j.next()}return U}function he(j){x(j);let U="",X="";for(;U=V(j);)X+=U;return j.currentChar()===EOF$1&&y(CompileErrorCodes.UNTERMINATED_CLOSING_BRACE,l(),0),X}function fe(j){x(j);let U="";return j.currentChar()==="-"?(j.next(),U+=`-${te(j)}`):U+=te(j),j.currentChar()===EOF$1&&y(CompileErrorCodes.UNTERMINATED_CLOSING_BRACE,l(),0),U}function pe(j){return j!==LITERAL_DELIMITER&&j!==CHAR_LF}function me(j){x(j),v(j,"'");let U="",X="";for(;U=N(j,pe);)U==="\\"?X+=ee(j):X+=U;const re=j.currentChar();return re===CHAR_LF||re===EOF$1?(y(CompileErrorCodes.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,l(),0),re===CHAR_LF&&(j.next(),v(j,"'")),X):(v(j,"'"),X)}function ee(j){const U=j.currentChar();switch(U){case"\\":case"'":return j.next(),`\\${U}`;case"u":return Q(j,U,4);case"U":return Q(j,U,6);default:return y(CompileErrorCodes.UNKNOWN_ESCAPE_SEQUENCE,l(),0,U),""}}function Q(j,U,X){v(j,U);let re="";for(let ge=0;ge<X;ge++){const ue=q(j);if(!ue){y(CompileErrorCodes.INVALID_UNICODE_ESCAPE_SEQUENCE,l(),0,`\\${U}${re}${j.currentChar()}`);break}re+=ue}return`\\${U}${re}`}function ie(j){return j!=="{"&&j!=="}"&&j!==CHAR_SP&&j!==CHAR_LF}function le(j){x(j);let U="",X="";for(;U=N(j,ie);)X+=U;return X}function ce(j){let U="",X="";for(;U=H(j);)X+=U;return X}function z(j){const U=X=>{const re=j.currentChar();return re==="{"||re==="@"||re==="|"||re==="("||re===")"||!re||re===CHAR_SP?X:(X+=re,j.next(),U(X))};return U("")}function W(j){x(j);const U=v(j,"|");return x(j),U}function K(j,U){let X=null;switch(j.currentChar()){case"{":return U.braceNest>=1&&y(CompileErrorCodes.NOT_ALLOW_NEST_PLACEHOLDER,l(),0),j.next(),X=b(U,2,"{"),x(j),U.braceNest++,X;case"}":return U.braceNest>0&&U.currentType===2&&y(CompileErrorCodes.EMPTY_PLACEHOLDER,l(),0),j.next(),X=b(U,3,"}"),U.braceNest--,U.braceNest>0&&x(j),U.inLinked&&U.braceNest===0&&(U.inLinked=!1),X;case"@":return U.braceNest>0&&y(CompileErrorCodes.UNTERMINATED_CLOSING_BRACE,l(),0),X=ne(j,U)||S(U),U.braceNest=0,X;default:{let ge=!0,ue=!0,Z=!0;if(O(j))return U.braceNest>0&&y(CompileErrorCodes.UNTERMINATED_CLOSING_BRACE,l(),0),X=b(U,1,W(j)),U.braceNest=0,U.inLinked=!1,X;if(U.braceNest>0&&(U.currentType===4||U.currentType===5||U.currentType===6))return y(CompileErrorCodes.UNTERMINATED_CLOSING_BRACE,l(),0),U.braceNest=0,se(j,U);if(ge=E(j,U))return X=b(U,4,he(j)),x(j),X;if(ue=P(j,U))return X=b(U,5,fe(j)),x(j),X;if(Z=L(j,U))return X=b(U,6,me(j)),x(j),X;if(!ge&&!ue&&!Z)return X=b(U,12,le(j)),y(CompileErrorCodes.INVALID_TOKEN_IN_PLACEHOLDER,l(),0,X.value),x(j),X;break}}return X}function ne(j,U){const{currentType:X}=U;let re=null;const ge=j.currentChar();switch((X===7||X===8||X===11||X===9)&&(ge===CHAR_LF||ge===CHAR_SP)&&y(CompileErrorCodes.INVALID_LINKED_FORMAT,l(),0),ge){case"@":return j.next(),re=b(U,7,"@"),U.inLinked=!0,re;case".":return x(j),j.next(),b(U,8,".");case":":return x(j),j.next(),b(U,9,":");default:return O(j)?(re=b(U,1,W(j)),U.braceNest=0,U.inLinked=!1,re):R(j,U)||D(j,U)?(x(j),ne(j,U)):w(j,U)?(x(j),b(U,11,ce(j))):I(j,U)?(x(j),ge==="{"?K(j,U)||re:b(U,10,z(j))):(X===7&&y(CompileErrorCodes.INVALID_LINKED_FORMAT,l(),0),U.braceNest=0,U.inLinked=!1,se(j,U))}}function se(j,U){let X={type:13};if(U.braceNest>0)return K(j,U)||S(U);if(U.inLinked)return ne(j,U)||S(U);switch(j.currentChar()){case"{":return K(j,U)||S(U);case"}":return y(CompileErrorCodes.UNBALANCED_CLOSING_BRACE,l(),0),j.next(),b(U,3,"}");case"@":return ne(j,U)||S(U);default:{if(O(j))return X=b(U,1,W(j)),U.braceNest=0,U.inLinked=!1,X;if(B(j))return b(U,0,de(j));break}}return X}function ae(){const{currentType:j,offset:U,startLoc:X,endLoc:re}=f;return f.lastType=j,f.lastOffset=U,f.lastStartLoc=X,f.lastEndLoc=re,f.offset=o(),f.startLoc=l(),n.currentChar()===EOF$1?b(f,13):se(n,f)}return{nextToken:ae,currentOffset:o,currentPosition:l,context:g}}const ERROR_DOMAIN$2="parser",KNOWN_ESCAPES=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function fromEscapeSequence(r,e,i){switch(r){case"\\\\":return"\\";case"\\'":return"'";default:{const n=parseInt(e||i,16);return n<=55295||n>=57344?String.fromCodePoint(n):""}}}function createParser(r={}){const e=r.location!==!1,{onError:i}=r;function n(T,C,E,P,...L){const R=T.currentPosition();if(R.offset+=P,R.column+=P,i){const w=e?createLocation(E,R):null,D=createCompileError(C,w,{domain:ERROR_DOMAIN$2,args:L});i(D)}}function o(T,C,E){const P={type:T};return e&&(P.start=C,P.end=C,P.loc={start:E,end:E}),P}function l(T,C,E,P){e&&(T.end=C,T.loc&&(T.loc.end=E))}function u(T,C){const E=T.context(),P=o(3,E.offset,E.startLoc);return P.value=C,l(P,T.currentOffset(),T.currentPosition()),P}function d(T,C){const E=T.context(),{lastOffset:P,lastStartLoc:L}=E,R=o(5,P,L);return R.index=parseInt(C,10),T.nextToken(),l(R,T.currentOffset(),T.currentPosition()),R}function f(T,C){const E=T.context(),{lastOffset:P,lastStartLoc:L}=E,R=o(4,P,L);return R.key=C,T.nextToken(),l(R,T.currentOffset(),T.currentPosition()),R}function g(T,C){const E=T.context(),{lastOffset:P,lastStartLoc:L}=E,R=o(9,P,L);return R.value=C.replace(KNOWN_ESCAPES,fromEscapeSequence),T.nextToken(),l(R,T.currentOffset(),T.currentPosition()),R}function _(T){const C=T.nextToken(),E=T.context(),{lastOffset:P,lastStartLoc:L}=E,R=o(8,P,L);return C.type!==11?(n(T,CompileErrorCodes.UNEXPECTED_EMPTY_LINKED_MODIFIER,E.lastStartLoc,0),R.value="",l(R,P,L),{nextConsumeToken:C,node:R}):(C.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,E.lastStartLoc,0,getTokenCaption(C)),R.value=C.value||"",l(R,T.currentOffset(),T.currentPosition()),{node:R})}function y(T,C){const E=T.context(),P=o(7,E.offset,E.startLoc);return P.value=C,l(P,T.currentOffset(),T.currentPosition()),P}function b(T){const C=T.context(),E=o(6,C.offset,C.startLoc);let P=T.nextToken();if(P.type===8){const L=_(T);E.modifier=L.node,P=L.nextConsumeToken||T.nextToken()}switch(P.type!==9&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(P)),P=T.nextToken(),P.type===2&&(P=T.nextToken()),P.type){case 10:P.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(P)),E.key=y(T,P.value||"");break;case 4:P.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(P)),E.key=f(T,P.value||"");break;case 5:P.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(P)),E.key=d(T,P.value||"");break;case 6:P.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(P)),E.key=g(T,P.value||"");break;default:{n(T,CompileErrorCodes.UNEXPECTED_EMPTY_LINKED_KEY,C.lastStartLoc,0);const L=T.context(),R=o(7,L.offset,L.startLoc);return R.value="",l(R,L.offset,L.startLoc),E.key=R,l(E,L.offset,L.startLoc),{nextConsumeToken:P,node:E}}}return l(E,T.currentOffset(),T.currentPosition()),{node:E}}function S(T){const C=T.context(),E=C.currentType===1?T.currentOffset():C.offset,P=C.currentType===1?C.endLoc:C.startLoc,L=o(2,E,P);L.items=[];let R=null;do{const I=R||T.nextToken();switch(R=null,I.type){case 0:I.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(I)),L.items.push(u(T,I.value||""));break;case 5:I.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(I)),L.items.push(d(T,I.value||""));break;case 4:I.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(I)),L.items.push(f(T,I.value||""));break;case 6:I.value==null&&n(T,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,C.lastStartLoc,0,getTokenCaption(I)),L.items.push(g(T,I.value||""));break;case 7:{const O=b(T);L.items.push(O.node),R=O.nextConsumeToken||null;break}}}while(C.currentType!==13&&C.currentType!==1);const w=C.currentType===1?C.lastOffset:T.currentOffset(),D=C.currentType===1?C.lastEndLoc:T.currentPosition();return l(L,w,D),L}function v(T,C,E,P){const L=T.context();let R=P.items.length===0;const w=o(1,C,E);w.cases=[],w.cases.push(P);do{const D=S(T);R||(R=D.items.length===0),w.cases.push(D)}while(L.currentType!==13);return R&&n(T,CompileErrorCodes.MUST_HAVE_MESSAGES_IN_PLURAL,E,0),l(w,T.currentOffset(),T.currentPosition()),w}function A(T){const C=T.context(),{offset:E,startLoc:P}=C,L=S(T);return C.currentType===13?L:v(T,E,P,L)}function x(T){const C=createTokenizer(T,assign$1({},r)),E=C.context(),P=o(0,E.offset,E.startLoc);return e&&P.loc&&(P.loc.source=T),P.body=A(C),r.onCacheKey&&(P.cacheKey=r.onCacheKey(T)),E.currentType!==13&&n(C,CompileErrorCodes.UNEXPECTED_LEXICAL_ANALYSIS,E.lastStartLoc,0,T[E.offset]||""),l(P,C.currentOffset(),C.currentPosition()),P}return{parse:x}}function getTokenCaption(r){if(r.type===13)return"EOF";const e=(r.value||"").replace(/\r?\n/gu,"\\n");return e.length>10?e.slice(0,9)+"":e}function createTransformer(r,e={}){const i={ast:r,helpers:new Set};return{context:()=>i,helper:l=>(i.helpers.add(l),l)}}function traverseNodes(r,e){for(let i=0;i<r.length;i++)traverseNode(r[i],e)}function traverseNode(r,e){switch(r.type){case 1:traverseNodes(r.cases,e),e.helper("plural");break;case 2:traverseNodes(r.items,e);break;case 6:{traverseNode(r.key,e),e.helper("linked"),e.helper("type");break}case 5:e.helper("interpolate"),e.helper("list");break;case 4:e.helper("interpolate"),e.helper("named");break}}function transform$9(r,e={}){const i=createTransformer(r);i.helper("normalize"),r.body&&traverseNode(r.body,i);const n=i.context();r.helpers=Array.from(n.helpers)}function optimize(r){const e=r.body;return e.type===2?optimizeMessageNode(e):e.cases.forEach(i=>optimizeMessageNode(i)),r}function optimizeMessageNode(r){if(r.items.length===1){const e=r.items[0];(e.type===3||e.type===9)&&(r.static=e.value,delete e.value)}else{const e=[];for(let i=0;i<r.items.length;i++){const n=r.items[i];if(!(n.type===3||n.type===9)||n.value==null)break;e.push(n.value)}if(e.length===r.items.length){r.static=join(e);for(let i=0;i<r.items.length;i++){const n=r.items[i];(n.type===3||n.type===9)&&delete n.value}}}}function minify(r){switch(r.t=r.type,r.type){case 0:{const e=r;minify(e.body),e.b=e.body,delete e.body;break}case 1:{const e=r,i=e.cases;for(let n=0;n<i.length;n++)minify(i[n]);e.c=i,delete e.cases;break}case 2:{const e=r,i=e.items;for(let n=0;n<i.length;n++)minify(i[n]);e.i=i,delete e.items,e.static&&(e.s=e.static,delete e.static);break}case 3:case 9:case 8:case 7:{const e=r;e.value&&(e.v=e.value,delete e.value);break}case 6:{const e=r;minify(e.key),e.k=e.key,delete e.key,e.modifier&&(minify(e.modifier),e.m=e.modifier,delete e.modifier);break}case 5:{const e=r;e.i=e.index,delete e.index;break}case 4:{const e=r;e.k=e.key,delete e.key;break}}delete r.type}function createCodeGenerator(r,e){const{filename:i,breakLineCode:n,needIndent:o}=e,l=e.location!==!1,u={filename:i,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:n,needIndent:o,indentLevel:0};l&&r.loc&&(u.source=r.loc.source);const d=()=>u;function f(A,x){u.code+=A}function g(A,x=!0){const T=x?n:"";f(o?T+"  ".repeat(A):T)}function _(A=!0){const x=++u.indentLevel;A&&g(x)}function y(A=!0){const x=--u.indentLevel;A&&g(x)}function b(){g(u.indentLevel)}return{context:d,push:f,indent:_,deindent:y,newline:b,helper:A=>`_${A}`,needIndent:()=>u.needIndent}}function generateLinkedNode(r,e){const{helper:i}=r;r.push(`${i("linked")}(`),generateNode(r,e.key),e.modifier?(r.push(", "),generateNode(r,e.modifier),r.push(", _type")):r.push(", undefined, _type"),r.push(")")}function generateMessageNode(r,e){const{helper:i,needIndent:n}=r;r.push(`${i("normalize")}([`),r.indent(n());const o=e.items.length;for(let l=0;l<o&&(generateNode(r,e.items[l]),l!==o-1);l++)r.push(", ");r.deindent(n()),r.push("])")}function generatePluralNode(r,e){const{helper:i,needIndent:n}=r;if(e.cases.length>1){r.push(`${i("plural")}([`),r.indent(n());const o=e.cases.length;for(let l=0;l<o&&(generateNode(r,e.cases[l]),l!==o-1);l++)r.push(", ");r.deindent(n()),r.push("])")}}function generateResource(r,e){e.body?generateNode(r,e.body):r.push("null")}function generateNode(r,e){const{helper:i}=r;switch(e.type){case 0:generateResource(r,e);break;case 1:generatePluralNode(r,e);break;case 2:generateMessageNode(r,e);break;case 6:generateLinkedNode(r,e);break;case 8:r.push(JSON.stringify(e.value),e);break;case 7:r.push(JSON.stringify(e.value),e);break;case 5:r.push(`${i("interpolate")}(${i("list")}(${e.index}))`,e);break;case 4:r.push(`${i("interpolate")}(${i("named")}(${JSON.stringify(e.key)}))`,e);break;case 9:r.push(JSON.stringify(e.value),e);break;case 3:r.push(JSON.stringify(e.value),e);break}}const generate=(r,e={})=>{const i=isString$1(e.mode)?e.mode:"normal",n=isString$1(e.filename)?e.filename:"message.intl";e.sourceMap;const o=e.breakLineCode!=null?e.breakLineCode:i==="arrow"?";":`
`,l=e.needIndent?e.needIndent:i!=="arrow",u=r.helpers||[],d=createCodeGenerator(r,{filename:n,breakLineCode:o,needIndent:l});d.push(i==="normal"?"function __msg__ (ctx) {":"(ctx) => {"),d.indent(l),u.length>0&&(d.push(`const { ${join(u.map(_=>`${_}: _${_}`),", ")} } = ctx`),d.newline()),d.push("return "),generateNode(d,r),d.deindent(l),d.push("}"),delete r.helpers;const{code:f,map:g}=d.context();return{ast:r,code:f,map:g?g.toJSON():void 0}};function baseCompile$1(r,e={}){const i=assign$1({},e),n=!!i.jit,o=!!i.minify,l=i.optimize==null?!0:i.optimize,d=createParser(i).parse(r);return n?(l&&optimize(d),o&&minify(d),{ast:d,code:""}):(transform$9(d,i),generate(d,i))}/*!
  * core-base v11.0.0-rc.1
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */function initFeatureFlags$1(){typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(getGlobalThis().__INTLIFY_PROD_DEVTOOLS__=!1),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(getGlobalThis().__INTLIFY_DROP_MESSAGE_COMPILER__=!1)}function format(r){return i=>formatParts(i,r)}function formatParts(r,e){const i=resolveBody(e);if(i==null)throw createUnhandleNodeError(0);if(resolveType(i)===1){const l=resolveCases(i);return r.plural(l.reduce((u,d)=>[...u,formatMessageParts(r,d)],[]))}else return formatMessageParts(r,i)}const PROPS_BODY=["b","body"];function resolveBody(r){return resolveProps(r,PROPS_BODY)}const PROPS_CASES=["c","cases"];function resolveCases(r){return resolveProps(r,PROPS_CASES,[])}function formatMessageParts(r,e){const i=resolveStatic(e);if(i!=null)return r.type==="text"?i:r.normalize([i]);{const n=resolveItems(e).reduce((o,l)=>[...o,formatMessagePart(r,l)],[]);return r.normalize(n)}}const PROPS_STATIC=["s","static"];function resolveStatic(r){return resolveProps(r,PROPS_STATIC)}const PROPS_ITEMS=["i","items"];function resolveItems(r){return resolveProps(r,PROPS_ITEMS,[])}function formatMessagePart(r,e){const i=resolveType(e);switch(i){case 3:return resolveValue$1(e,i);case 9:return resolveValue$1(e,i);case 4:{const n=e;if(hasOwn(n,"k")&&n.k)return r.interpolate(r.named(n.k));if(hasOwn(n,"key")&&n.key)return r.interpolate(r.named(n.key));throw createUnhandleNodeError(i)}case 5:{const n=e;if(hasOwn(n,"i")&&isNumber$1(n.i))return r.interpolate(r.list(n.i));if(hasOwn(n,"index")&&isNumber$1(n.index))return r.interpolate(r.list(n.index));throw createUnhandleNodeError(i)}case 6:{const n=e,o=resolveLinkedModifier(n),l=resolveLinkedKey(n);return r.linked(formatMessagePart(r,l),o?formatMessagePart(r,o):void 0,r.type)}case 7:return resolveValue$1(e,i);case 8:return resolveValue$1(e,i);default:throw new Error(`unhandled node on format message part: ${i}`)}}const PROPS_TYPE=["t","type"];function resolveType(r){return resolveProps(r,PROPS_TYPE)}const PROPS_VALUE=["v","value"];function resolveValue$1(r,e){const i=resolveProps(r,PROPS_VALUE);if(i)return i;throw createUnhandleNodeError(e)}const PROPS_MODIFIER=["m","modifier"];function resolveLinkedModifier(r){return resolveProps(r,PROPS_MODIFIER)}const PROPS_KEY=["k","key"];function resolveLinkedKey(r){const e=resolveProps(r,PROPS_KEY);if(e)return e;throw createUnhandleNodeError(6)}function resolveProps(r,e,i){for(let n=0;n<e.length;n++){const o=e[n];if(hasOwn(r,o)&&r[o]!=null)return r[o]}return i}function createUnhandleNodeError(r){return new Error(`unhandled node type: ${r}`)}const defaultOnCacheKey=r=>r;let compileCache=create$2();function isMessageAST(r){return isObject$2(r)&&resolveType(r)===0&&(hasOwn(r,"b")||hasOwn(r,"body"))}function baseCompile(r,e={}){let i=!1;const n=e.onError||defaultOnError;return e.onError=o=>{i=!0,n(o)},{...baseCompile$1(r,e),detectError:i}}function compile(r,e){if(!__INTLIFY_DROP_MESSAGE_COMPILER__&&isString$1(r)){isBoolean$1(e.warnHtmlMessage)&&e.warnHtmlMessage;const n=(e.onCacheKey||defaultOnCacheKey)(r),o=compileCache[n];if(o)return o;const{ast:l,detectError:u}=baseCompile(r,{...e,location:!1,jit:!0}),d=format(l);return u?d:compileCache[n]=d}else{const i=r.cacheKey;if(i){const n=compileCache[i];return n||(compileCache[i]=format(r))}else return format(r)}}let devtools=null;function setDevToolsHook(r){devtools=r}function initI18nDevTools(r,e,i){devtools&&devtools.emit("i18n:init",{timestamp:Date.now(),i18n:r,version:e,meta:i})}const translateDevTools=createDevToolsHook("function:translate");function createDevToolsHook(r){return e=>devtools&&devtools.emit(r,e)}const CoreErrorCodes={INVALID_ARGUMENT:COMPILE_ERROR_CODES_EXTEND_POINT,INVALID_DATE_ARGUMENT:18,INVALID_ISO_DATE_ARGUMENT:19,NOT_SUPPORT_LOCALE_PROMISE_VALUE:21,NOT_SUPPORT_LOCALE_ASYNC_FUNCTION:22,NOT_SUPPORT_LOCALE_TYPE:23},CORE_ERROR_CODES_EXTEND_POINT=24;function createCoreError(r){return createCompileError(r,null,void 0)}function getLocale(r,e){return e.locale!=null?resolveLocale(e.locale):resolveLocale(r.locale)}let _resolveLocale;function resolveLocale(r){if(isString$1(r))return r;if(isFunction$1(r)){if(r.resolvedOnce&&_resolveLocale!=null)return _resolveLocale;if(r.constructor.name==="Function"){const e=r();if(isPromise(e))throw createCoreError(CoreErrorCodes.NOT_SUPPORT_LOCALE_PROMISE_VALUE);return _resolveLocale=e}else throw createCoreError(CoreErrorCodes.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION)}else throw createCoreError(CoreErrorCodes.NOT_SUPPORT_LOCALE_TYPE)}function fallbackWithSimple(r,e,i){return[...new Set([i,...isArray$2(e)?e:isObject$2(e)?Object.keys(e):isString$1(e)?[e]:[i]])]}function fallbackWithLocaleChain(r,e,i){const n=isString$1(i)?i:DEFAULT_LOCALE,o=r;o.__localeChainCache||(o.__localeChainCache=new Map);let l=o.__localeChainCache.get(n);if(!l){l=[];let u=[i];for(;isArray$2(u);)u=appendBlockToChain(l,u,e);const d=isArray$2(e)||!isPlainObject$1(e)?e:e.default?e.default:null;u=isString$1(d)?[d]:d,isArray$2(u)&&appendBlockToChain(l,u,!1),o.__localeChainCache.set(n,l)}return l}function appendBlockToChain(r,e,i){let n=!0;for(let o=0;o<e.length&&isBoolean$1(n);o++){const l=e[o];isString$1(l)&&(n=appendLocaleToChain(r,e[o],i))}return n}function appendLocaleToChain(r,e,i){let n;const o=e.split("-");do{const l=o.join("-");n=appendItemToChain(r,l,i),o.splice(-1,1)}while(o.length&&n===!0);return n}function appendItemToChain(r,e,i){let n=!1;if(!r.includes(e)&&(n=!0,e)){n=e[e.length-1]!=="!";const o=e.replace(/!/g,"");r.push(o),(isArray$2(i)||isPlainObject$1(i))&&i[o]&&(n=i[o])}return n}const pathStateMachine=[];pathStateMachine[0]={w:[0],i:[3,0],"[":[4],o:[7]};pathStateMachine[1]={w:[1],".":[2],"[":[4],o:[7]};pathStateMachine[2]={w:[2],i:[3,0],0:[3,0]};pathStateMachine[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]};pathStateMachine[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]};pathStateMachine[5]={"'":[4,0],o:8,l:[5,0]};pathStateMachine[6]={'"':[4,0],o:8,l:[6,0]};const literalValueRE=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function isLiteral(r){return literalValueRE.test(r)}function stripQuotes(r){const e=r.charCodeAt(0),i=r.charCodeAt(r.length-1);return e===i&&(e===34||e===39)?r.slice(1,-1):r}function getPathCharType(r){if(r==null)return"o";switch(r.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return r;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function formatSubPath(r){const e=r.trim();return r.charAt(0)==="0"&&isNaN(parseInt(r))?!1:isLiteral(e)?stripQuotes(e):"*"+e}function parse$1(r){const e=[];let i=-1,n=0,o=0,l,u,d,f,g,_,y;const b=[];b[0]=()=>{u===void 0?u=d:u+=d},b[1]=()=>{u!==void 0&&(e.push(u),u=void 0)},b[2]=()=>{b[0](),o++},b[3]=()=>{if(o>0)o--,n=4,b[0]();else{if(o=0,u===void 0||(u=formatSubPath(u),u===!1))return!1;b[1]()}};function S(){const v=r[i+1];if(n===5&&v==="'"||n===6&&v==='"')return i++,d="\\"+v,b[0](),!0}for(;n!==null;)if(i++,l=r[i],!(l==="\\"&&S())){if(f=getPathCharType(l),y=pathStateMachine[n],g=y[f]||y.l||8,g===8||(n=g[0],g[1]!==void 0&&(_=b[g[1]],_&&(d=l,_()===!1))))return;if(n===7)return e}}const cache=new Map;function resolveWithKeyValue(r,e){return isObject$2(r)?r[e]:null}function resolveValue(r,e){if(!isObject$2(r))return null;let i=cache.get(e);if(i||(i=parse$1(e),i&&cache.set(e,i)),!i)return null;const n=i.length;let o=r,l=0;for(;l<n;){const u=o[i[l]];if(u===void 0||isFunction$1(o))return null;o=u,l++}return o}const VERSION$1="11.0.0-rc.1",NOT_REOSLVED=-1,DEFAULT_LOCALE="en-US",MISSING_RESOLVE_VALUE="",capitalize=r=>`${r.charAt(0).toLocaleUpperCase()}${r.substr(1)}`;function getDefaultLinkedModifiers(){return{upper:(r,e)=>e==="text"&&isString$1(r)?r.toUpperCase():e==="vnode"&&isObject$2(r)&&"__v_isVNode"in r?r.children.toUpperCase():r,lower:(r,e)=>e==="text"&&isString$1(r)?r.toLowerCase():e==="vnode"&&isObject$2(r)&&"__v_isVNode"in r?r.children.toLowerCase():r,capitalize:(r,e)=>e==="text"&&isString$1(r)?capitalize(r):e==="vnode"&&isObject$2(r)&&"__v_isVNode"in r?capitalize(r.children):r}}let _compiler;function registerMessageCompiler(r){_compiler=r}let _resolver;function registerMessageResolver(r){_resolver=r}let _fallbacker;function registerLocaleFallbacker(r){_fallbacker=r}let _additionalMeta=null;const setAdditionalMeta=r=>{_additionalMeta=r},getAdditionalMeta=()=>_additionalMeta;let _fallbackContext=null;const setFallbackContext=r=>{_fallbackContext=r},getFallbackContext=()=>_fallbackContext;let _cid=0;function createCoreContext(r={}){const e=isFunction$1(r.onWarn)?r.onWarn:warn$1,i=isString$1(r.version)?r.version:VERSION$1,n=isString$1(r.locale)||isFunction$1(r.locale)?r.locale:DEFAULT_LOCALE,o=isFunction$1(n)?DEFAULT_LOCALE:n,l=isArray$2(r.fallbackLocale)||isPlainObject$1(r.fallbackLocale)||isString$1(r.fallbackLocale)||r.fallbackLocale===!1?r.fallbackLocale:o,u=isPlainObject$1(r.messages)?r.messages:createResources(o),d=isPlainObject$1(r.datetimeFormats)?r.datetimeFormats:createResources(o),f=isPlainObject$1(r.numberFormats)?r.numberFormats:createResources(o),g=assign$1(create$2(),r.modifiers,getDefaultLinkedModifiers()),_=r.pluralRules||create$2(),y=isFunction$1(r.missing)?r.missing:null,b=isBoolean$1(r.missingWarn)||isRegExp(r.missingWarn)?r.missingWarn:!0,S=isBoolean$1(r.fallbackWarn)||isRegExp(r.fallbackWarn)?r.fallbackWarn:!0,v=!!r.fallbackFormat,A=!!r.unresolving,x=isFunction$1(r.postTranslation)?r.postTranslation:null,T=isPlainObject$1(r.processor)?r.processor:null,C=isBoolean$1(r.warnHtmlMessage)?r.warnHtmlMessage:!0,E=!!r.escapeParameter,P=isFunction$1(r.messageCompiler)?r.messageCompiler:_compiler,L=isFunction$1(r.messageResolver)?r.messageResolver:_resolver||resolveWithKeyValue,R=isFunction$1(r.localeFallbacker)?r.localeFallbacker:_fallbacker||fallbackWithSimple,w=isObject$2(r.fallbackContext)?r.fallbackContext:void 0,D=r,I=isObject$2(D.__datetimeFormatters)?D.__datetimeFormatters:new Map,O=isObject$2(D.__numberFormatters)?D.__numberFormatters:new Map,B=isObject$2(D.__meta)?D.__meta:{};_cid++;const N={version:i,cid:_cid,locale:n,fallbackLocale:l,messages:u,modifiers:g,pluralRules:_,missing:y,missingWarn:b,fallbackWarn:S,fallbackFormat:v,unresolving:A,postTranslation:x,processor:T,warnHtmlMessage:C,escapeParameter:E,messageCompiler:P,messageResolver:L,localeFallbacker:R,fallbackContext:w,onWarn:e,__meta:B};return N.datetimeFormats=d,N.numberFormats=f,N.__datetimeFormatters=I,N.__numberFormatters=O,__INTLIFY_PROD_DEVTOOLS__&&initI18nDevTools(N,i,B),N}const createResources=r=>({[r]:create$2()});function handleMissing(r,e,i,n,o){const{missing:l,onWarn:u}=r;if(l!==null){const d=l(r,i,e,o);return isString$1(d)?d:e}else return e}function updateFallbackLocale(r,e,i){const n=r;n.__localeChainCache=new Map,r.localeFallbacker(r,i,e)}function isAlmostSameLocale(r,e){return r===e?!1:r.split("-")[0]===e.split("-")[0]}function isImplicitFallback(r,e){const i=e.indexOf(r);if(i===-1)return!1;for(let n=i+1;n<e.length;n++)if(isAlmostSameLocale(r,e[n]))return!0;return!1}function datetime(r,...e){const{datetimeFormats:i,unresolving:n,fallbackLocale:o,onWarn:l,localeFallbacker:u}=r,{__datetimeFormatters:d}=r,[f,g,_,y]=parseDateTimeArgs(...e),b=isBoolean$1(_.missingWarn)?_.missingWarn:r.missingWarn;isBoolean$1(_.fallbackWarn)?_.fallbackWarn:r.fallbackWarn;const S=!!_.part,v=getLocale(r,_),A=u(r,o,v);if(!isString$1(f)||f==="")return new Intl.DateTimeFormat(v,y).format(g);let x={},T,C=null;const E="datetime format";for(let R=0;R<A.length&&(T=A[R],x=i[T]||{},C=x[f],!isPlainObject$1(C));R++)handleMissing(r,f,T,b,E);if(!isPlainObject$1(C)||!isString$1(T))return n?NOT_REOSLVED:f;let P=`${T}__${f}`;isEmptyObject(y)||(P=`${P}__${JSON.stringify(y)}`);let L=d.get(P);return L||(L=new Intl.DateTimeFormat(T,assign$1({},C,y)),d.set(P,L)),S?L.formatToParts(g):L.format(g)}const DATETIME_FORMAT_OPTIONS_KEYS=["localeMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName","formatMatcher","hour12","timeZone","dateStyle","timeStyle","calendar","dayPeriod","numberingSystem","hourCycle","fractionalSecondDigits"];function parseDateTimeArgs(...r){const[e,i,n,o]=r,l=create$2();let u=create$2(),d;if(isString$1(e)){const f=e.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!f)throw createCoreError(CoreErrorCodes.INVALID_ISO_DATE_ARGUMENT);const g=f[3]?f[3].trim().startsWith("T")?`${f[1].trim()}${f[3].trim()}`:`${f[1].trim()}T${f[3].trim()}`:f[1].trim();d=new Date(g);try{d.toISOString()}catch{throw createCoreError(CoreErrorCodes.INVALID_ISO_DATE_ARGUMENT)}}else if(isDate$1(e)){if(isNaN(e.getTime()))throw createCoreError(CoreErrorCodes.INVALID_DATE_ARGUMENT);d=e}else if(isNumber$1(e))d=e;else throw createCoreError(CoreErrorCodes.INVALID_ARGUMENT);return isString$1(i)?l.key=i:isPlainObject$1(i)&&Object.keys(i).forEach(f=>{DATETIME_FORMAT_OPTIONS_KEYS.includes(f)?u[f]=i[f]:l[f]=i[f]}),isString$1(n)?l.locale=n:isPlainObject$1(n)&&(u=n),isPlainObject$1(o)&&(u=o),[l.key||"",d,l,u]}function clearDateTimeFormat(r,e,i){const n=r;for(const o in i){const l=`${e}__${o}`;n.__datetimeFormatters.has(l)&&n.__datetimeFormatters.delete(l)}}function number(r,...e){const{numberFormats:i,unresolving:n,fallbackLocale:o,onWarn:l,localeFallbacker:u}=r,{__numberFormatters:d}=r,[f,g,_,y]=parseNumberArgs(...e),b=isBoolean$1(_.missingWarn)?_.missingWarn:r.missingWarn;isBoolean$1(_.fallbackWarn)?_.fallbackWarn:r.fallbackWarn;const S=!!_.part,v=getLocale(r,_),A=u(r,o,v);if(!isString$1(f)||f==="")return new Intl.NumberFormat(v,y).format(g);let x={},T,C=null;const E="number format";for(let R=0;R<A.length&&(T=A[R],x=i[T]||{},C=x[f],!isPlainObject$1(C));R++)handleMissing(r,f,T,b,E);if(!isPlainObject$1(C)||!isString$1(T))return n?NOT_REOSLVED:f;let P=`${T}__${f}`;isEmptyObject(y)||(P=`${P}__${JSON.stringify(y)}`);let L=d.get(P);return L||(L=new Intl.NumberFormat(T,assign$1({},C,y)),d.set(P,L)),S?L.formatToParts(g):L.format(g)}const NUMBER_FORMAT_OPTIONS_KEYS=["localeMatcher","style","currency","currencyDisplay","currencySign","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","notation","signDisplay","unit","unitDisplay","roundingMode","roundingPriority","roundingIncrement","trailingZeroDisplay"];function parseNumberArgs(...r){const[e,i,n,o]=r,l=create$2();let u=create$2();if(!isNumber$1(e))throw createCoreError(CoreErrorCodes.INVALID_ARGUMENT);const d=e;return isString$1(i)?l.key=i:isPlainObject$1(i)&&Object.keys(i).forEach(f=>{NUMBER_FORMAT_OPTIONS_KEYS.includes(f)?u[f]=i[f]:l[f]=i[f]}),isString$1(n)?l.locale=n:isPlainObject$1(n)&&(u=n),isPlainObject$1(o)&&(u=o),[l.key||"",d,l,u]}function clearNumberFormat(r,e,i){const n=r;for(const o in i){const l=`${e}__${o}`;n.__numberFormatters.has(l)&&n.__numberFormatters.delete(l)}}const DEFAULT_MODIFIER=r=>r,DEFAULT_MESSAGE=r=>"",DEFAULT_MESSAGE_DATA_TYPE="text",DEFAULT_NORMALIZE=r=>r.length===0?"":join(r),DEFAULT_INTERPOLATE=toDisplayString;function pluralDefault(r,e){return r=Math.abs(r),e===2?r?r>1?1:0:1:r?Math.min(r,2):0}function getPluralIndex(r){const e=isNumber$1(r.pluralIndex)?r.pluralIndex:-1;return r.named&&(isNumber$1(r.named.count)||isNumber$1(r.named.n))?isNumber$1(r.named.count)?r.named.count:isNumber$1(r.named.n)?r.named.n:e:e}function normalizeNamed(r,e){e.count||(e.count=r),e.n||(e.n=r)}function createMessageContext(r={}){const e=r.locale,i=getPluralIndex(r),n=isObject$2(r.pluralRules)&&isString$1(e)&&isFunction$1(r.pluralRules[e])?r.pluralRules[e]:pluralDefault,o=isObject$2(r.pluralRules)&&isString$1(e)&&isFunction$1(r.pluralRules[e])?pluralDefault:void 0,l=T=>T[n(i,T.length,o)],u=r.list||[],d=T=>u[T],f=r.named||create$2();isNumber$1(r.pluralIndex)&&normalizeNamed(i,f);const g=T=>f[T];function _(T,C){const E=isFunction$1(r.messages)?r.messages(T,!!C):isObject$2(r.messages)?r.messages[T]:!1;return E||(r.parent?r.parent.message(T):DEFAULT_MESSAGE)}const y=T=>r.modifiers?r.modifiers[T]:DEFAULT_MODIFIER,b=isPlainObject$1(r.processor)&&isFunction$1(r.processor.normalize)?r.processor.normalize:DEFAULT_NORMALIZE,S=isPlainObject$1(r.processor)&&isFunction$1(r.processor.interpolate)?r.processor.interpolate:DEFAULT_INTERPOLATE,v=isPlainObject$1(r.processor)&&isString$1(r.processor.type)?r.processor.type:DEFAULT_MESSAGE_DATA_TYPE,x={list:d,named:g,plural:l,linked:(T,...C)=>{const[E,P]=C;let L="text",R="";C.length===1?isObject$2(E)?(R=E.modifier||R,L=E.type||L):isString$1(E)&&(R=E||R):C.length===2&&(isString$1(E)&&(R=E||R),isString$1(P)&&(L=P||L));const w=_(T,!0)(x),D=L==="vnode"&&isArray$2(w)&&R?w[0]:w;return R?y(R)(D,L):D},message:_,type:v,interpolate:S,normalize:b,values:assign$1(create$2(),u,f)};return x}const NOOP_MESSAGE_FUNCTION=()=>"",isMessageFunction=r=>isFunction$1(r);function translate$1(r,...e){const{fallbackFormat:i,postTranslation:n,unresolving:o,messageCompiler:l,fallbackLocale:u,messages:d}=r,[f,g]=parseTranslateArgs(...e),_=isBoolean$1(g.missingWarn)?g.missingWarn:r.missingWarn,y=isBoolean$1(g.fallbackWarn)?g.fallbackWarn:r.fallbackWarn,b=isBoolean$1(g.escapeParameter)?g.escapeParameter:r.escapeParameter,S=!!g.resolvedMessage,v=isString$1(g.default)||isBoolean$1(g.default)?isBoolean$1(g.default)?l?f:()=>f:g.default:i?l?f:()=>f:null,A=i||v!=null&&(isString$1(v)||isFunction$1(v)),x=getLocale(r,g);b&&escapeParams(g);let[T,C,E]=S?[f,x,d[x]||create$2()]:resolveMessageFormat(r,f,x,u,y,_),P=T,L=f;if(!S&&!(isString$1(P)||isMessageAST(P)||isMessageFunction(P))&&A&&(P=v,L=P),!S&&(!(isString$1(P)||isMessageAST(P)||isMessageFunction(P))||!isString$1(C)))return o?NOT_REOSLVED:f;let R=!1;const w=()=>{R=!0},D=isMessageFunction(P)?P:compileMessageFormat(r,f,C,P,L,w);if(R)return P;const I=getMessageContextOptions(r,C,E,g),O=createMessageContext(I),B=evaluateMessage(r,D,O),N=n?n(B,f):B;if(__INTLIFY_PROD_DEVTOOLS__){const $={timestamp:Date.now(),key:isString$1(f)?f:isMessageFunction(P)?P.key:"",locale:C||(isMessageFunction(P)?P.locale:""),format:isString$1(P)?P:isMessageFunction(P)?P.source:"",message:N};$.meta=assign$1({},r.__meta,getAdditionalMeta()||{}),translateDevTools($)}return N}function escapeParams(r){isArray$2(r.list)?r.list=r.list.map(e=>isString$1(e)?escapeHtml(e):e):isObject$2(r.named)&&Object.keys(r.named).forEach(e=>{isString$1(r.named[e])&&(r.named[e]=escapeHtml(r.named[e]))})}function resolveMessageFormat(r,e,i,n,o,l){const{messages:u,onWarn:d,messageResolver:f,localeFallbacker:g}=r,_=g(r,n,i);let y=create$2(),b,S=null;const v="translate";for(let A=0;A<_.length&&(b=_[A],y=u[b]||create$2(),(S=f(y,e))===null&&(S=y[e]),!(isString$1(S)||isMessageAST(S)||isMessageFunction(S)));A++)if(!isImplicitFallback(b,_)){const x=handleMissing(r,e,b,l,v);x!==e&&(S=x)}return[S,b,y]}function compileMessageFormat(r,e,i,n,o,l){const{messageCompiler:u,warnHtmlMessage:d}=r;if(isMessageFunction(n)){const g=n;return g.locale=g.locale||i,g.key=g.key||e,g}if(u==null){const g=()=>n;return g.locale=i,g.key=e,g}const f=u(n,getCompileContext(r,i,o,n,d,l));return f.locale=i,f.key=e,f.source=n,f}function evaluateMessage(r,e,i){return e(i)}function parseTranslateArgs(...r){const[e,i,n]=r,o=create$2();if(!isString$1(e)&&!isNumber$1(e)&&!isMessageFunction(e)&&!isMessageAST(e))throw createCoreError(CoreErrorCodes.INVALID_ARGUMENT);const l=isNumber$1(e)?String(e):(isMessageFunction(e),e);return isNumber$1(i)?o.plural=i:isString$1(i)?o.default=i:isPlainObject$1(i)&&!isEmptyObject(i)?o.named=i:isArray$2(i)&&(o.list=i),isNumber$1(n)?o.plural=n:isString$1(n)?o.default=n:isPlainObject$1(n)&&assign$1(o,n),[l,o]}function getCompileContext(r,e,i,n,o,l){return{locale:e,key:i,warnHtmlMessage:o,onError:u=>{throw l&&l(u),u},onCacheKey:u=>generateFormatCacheKey(e,i,u)}}function getMessageContextOptions(r,e,i,n){const{modifiers:o,pluralRules:l,messageResolver:u,fallbackLocale:d,fallbackWarn:f,missingWarn:g,fallbackContext:_}=r,b={locale:e,modifiers:o,pluralRules:l,messages:(S,v)=>{let A=u(i,S);if(A==null&&(_||v)){const[,,x]=resolveMessageFormat(_||r,S,e,d,f,g);A=u(x,S)}if(isString$1(A)||isMessageAST(A)){let x=!1;const C=compileMessageFormat(r,S,e,A,S,()=>{x=!0});return x?NOOP_MESSAGE_FUNCTION:C}else return isMessageFunction(A)?A:NOOP_MESSAGE_FUNCTION}};return r.processor&&(b.processor=r.processor),n.list&&(b.list=n.list),n.named&&(b.named=n.named),isNumber$1(n.plural)&&(b.pluralIndex=n.plural),b}initFeatureFlags$1();/*!
  * vue-i18n v11.0.0-rc.1
  * (c) 2024 kazuya kawaguchi
  * Released under the MIT License.
  */const VERSION="11.0.0-rc.1";function initFeatureFlags(){typeof __VUE_I18N_FULL_INSTALL__!="boolean"&&(getGlobalThis().__VUE_I18N_FULL_INSTALL__=!0),typeof __VUE_I18N_LEGACY_API__!="boolean"&&(getGlobalThis().__VUE_I18N_LEGACY_API__=!0),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(getGlobalThis().__INTLIFY_DROP_MESSAGE_COMPILER__=!1),typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(getGlobalThis().__INTLIFY_PROD_DEVTOOLS__=!1)}const I18nErrorCodes={UNEXPECTED_RETURN_TYPE:CORE_ERROR_CODES_EXTEND_POINT,INVALID_ARGUMENT:25,MUST_BE_CALL_SETUP_TOP:26,NOT_INSTALLED:27,REQUIRED_VALUE:28,INVALID_VALUE:29,NOT_INSTALLED_WITH_PROVIDE:31,UNEXPECTED_ERROR:32};function createI18nError(r,...e){return createCompileError(r,null,void 0)}const TranslateVNodeSymbol=makeSymbol("__translateVNode"),DatetimePartsSymbol=makeSymbol("__datetimeParts"),NumberPartsSymbol=makeSymbol("__numberParts"),SetPluralRulesSymbol=makeSymbol("__setPluralRules"),InejctWithOptionSymbol=makeSymbol("__injectWithOption"),DisposeSymbol=makeSymbol("__dispose");function handleFlatJson(r){if(!isObject$2(r))return r;for(const e in r)if(hasOwn(r,e))if(!e.includes("."))isObject$2(r[e])&&handleFlatJson(r[e]);else{const i=e.split("."),n=i.length-1;let o=r,l=!1;for(let u=0;u<n;u++){if(i[u]in o||(o[i[u]]=create$2()),!isObject$2(o[i[u]])){l=!0;break}o=o[i[u]]}l||(o[i[n]]=r[e],delete r[e]),isObject$2(o[i[n]])&&handleFlatJson(o[i[n]])}return r}function getLocaleMessages(r,e){const{messages:i,__i18n:n,messageResolver:o,flatJson:l}=e,u=isPlainObject$1(i)?i:isArray$2(n)?create$2():{[r]:create$2()};if(isArray$2(n)&&n.forEach(d=>{if("locale"in d&&"resource"in d){const{locale:f,resource:g}=d;f?(u[f]=u[f]||create$2(),deepCopy(g,u[f])):deepCopy(g,u)}else isString$1(d)&&deepCopy(JSON.parse(d),u)}),o==null&&l)for(const d in u)hasOwn(u,d)&&handleFlatJson(u[d]);return u}function getComponentOptions(r){return r.type}function adjustI18nResources(r,e,i){let n=isObject$2(e.messages)?e.messages:create$2();"__i18nGlobal"in i&&(n=getLocaleMessages(r.locale.value,{messages:n,__i18n:i.__i18nGlobal}));const o=Object.keys(n);o.length&&o.forEach(l=>{r.mergeLocaleMessage(l,n[l])});{if(isObject$2(e.datetimeFormats)){const l=Object.keys(e.datetimeFormats);l.length&&l.forEach(u=>{r.mergeDateTimeFormat(u,e.datetimeFormats[u])})}if(isObject$2(e.numberFormats)){const l=Object.keys(e.numberFormats);l.length&&l.forEach(u=>{r.mergeNumberFormat(u,e.numberFormats[u])})}}}function createTextNode(r){return createVNode(Text$2,null,r,0)}const DEVTOOLS_META="__INTLIFY_META__",NOOP_RETURN_ARRAY=()=>[],NOOP_RETURN_FALSE=()=>!1;let composerID=0;function defineCoreMissingHandler(r){return(e,i,n,o)=>r(i,n,getCurrentInstance()||void 0,o)}const getMetaInfo=()=>{const r=getCurrentInstance();let e=null;return r&&(e=getComponentOptions(r)[DEVTOOLS_META])?{[DEVTOOLS_META]:e}:null};function createComposer(r={}){const{__root:e,__injectWithOption:i}=r,n=e===void 0,o=r.flatJson,l=inBrowser?ref:shallowRef;let u=isBoolean$1(r.inheritLocale)?r.inheritLocale:!0;const d=l(e&&u?e.locale.value:isString$1(r.locale)?r.locale:DEFAULT_LOCALE),f=l(e&&u?e.fallbackLocale.value:isString$1(r.fallbackLocale)||isArray$2(r.fallbackLocale)||isPlainObject$1(r.fallbackLocale)||r.fallbackLocale===!1?r.fallbackLocale:d.value),g=l(getLocaleMessages(d.value,r)),_=l(isPlainObject$1(r.datetimeFormats)?r.datetimeFormats:{[d.value]:{}}),y=l(isPlainObject$1(r.numberFormats)?r.numberFormats:{[d.value]:{}});let b=e?e.missingWarn:isBoolean$1(r.missingWarn)||isRegExp(r.missingWarn)?r.missingWarn:!0,S=e?e.fallbackWarn:isBoolean$1(r.fallbackWarn)||isRegExp(r.fallbackWarn)?r.fallbackWarn:!0,v=e?e.fallbackRoot:isBoolean$1(r.fallbackRoot)?r.fallbackRoot:!0,A=!!r.fallbackFormat,x=isFunction$1(r.missing)?r.missing:null,T=isFunction$1(r.missing)?defineCoreMissingHandler(r.missing):null,C=isFunction$1(r.postTranslation)?r.postTranslation:null,E=e?e.warnHtmlMessage:isBoolean$1(r.warnHtmlMessage)?r.warnHtmlMessage:!0,P=!!r.escapeParameter;const L=e?e.modifiers:isPlainObject$1(r.modifiers)?r.modifiers:{};let R=r.pluralRules||e&&e.pluralRules,w;w=(()=>{n&&setFallbackContext(null);const Z={version:VERSION,locale:d.value,fallbackLocale:f.value,messages:g.value,modifiers:L,pluralRules:R,missing:T===null?void 0:T,missingWarn:b,fallbackWarn:S,fallbackFormat:A,unresolving:!0,postTranslation:C===null?void 0:C,warnHtmlMessage:E,escapeParameter:P,messageResolver:r.messageResolver,messageCompiler:r.messageCompiler,__meta:{framework:"vue"}};Z.datetimeFormats=_.value,Z.numberFormats=y.value,Z.__datetimeFormatters=isPlainObject$1(w)?w.__datetimeFormatters:void 0,Z.__numberFormatters=isPlainObject$1(w)?w.__numberFormatters:void 0;const oe=createCoreContext(Z);return n&&setFallbackContext(oe),oe})(),updateFallbackLocale(w,d.value,f.value);function I(){return[d.value,f.value,g.value,_.value,y.value]}const O=computed({get:()=>d.value,set:Z=>{d.value=Z,w.locale=d.value}}),B=computed({get:()=>f.value,set:Z=>{f.value=Z,w.fallbackLocale=f.value,updateFallbackLocale(w,d.value,Z)}}),N=computed(()=>g.value),$=computed(()=>_.value),H=computed(()=>y.value);function F(){return isFunction$1(C)?C:null}function V(Z){C=Z,w.postTranslation=Z}function G(){return x}function Y(Z){Z!==null&&(T=defineCoreMissingHandler(Z)),x=Z,w.missing=T}const J=(Z,oe,_e,ye,Se,Ae)=>{I();let ve;try{__INTLIFY_PROD_DEVTOOLS__,n||(w.fallbackContext=e?getFallbackContext():void 0),ve=Z(w)}finally{__INTLIFY_PROD_DEVTOOLS__,n||(w.fallbackContext=void 0)}if(_e!=="translate exists"&&isNumber$1(ve)&&ve===NOT_REOSLVED||_e==="translate exists"&&!ve){const[xe,Te]=oe();return e&&v?ye(e):Se(xe)}else{if(Ae(ve))return ve;throw createI18nError(I18nErrorCodes.UNEXPECTED_RETURN_TYPE)}};function q(...Z){return J(oe=>Reflect.apply(translate$1,null,[oe,...Z]),()=>parseTranslateArgs(...Z),"translate",oe=>Reflect.apply(oe.t,oe,[...Z]),oe=>oe,oe=>isString$1(oe))}function te(...Z){const[oe,_e,ye]=Z;if(ye&&!isObject$2(ye))throw createI18nError(I18nErrorCodes.INVALID_ARGUMENT);return q(oe,_e,assign$1({resolvedMessage:!0},ye||{}))}function de(...Z){return J(oe=>Reflect.apply(datetime,null,[oe,...Z]),()=>parseDateTimeArgs(...Z),"datetime format",oe=>Reflect.apply(oe.d,oe,[...Z]),()=>MISSING_RESOLVE_VALUE,oe=>isString$1(oe))}function he(...Z){return J(oe=>Reflect.apply(number,null,[oe,...Z]),()=>parseNumberArgs(...Z),"number format",oe=>Reflect.apply(oe.n,oe,[...Z]),()=>MISSING_RESOLVE_VALUE,oe=>isString$1(oe))}function fe(Z){return Z.map(oe=>isString$1(oe)||isNumber$1(oe)||isBoolean$1(oe)?createTextNode(String(oe)):oe)}const me={normalize:fe,interpolate:Z=>Z,type:"vnode"};function ee(...Z){return J(oe=>{let _e;const ye=oe;try{ye.processor=me,_e=Reflect.apply(translate$1,null,[ye,...Z])}finally{ye.processor=null}return _e},()=>parseTranslateArgs(...Z),"translate",oe=>oe[TranslateVNodeSymbol](...Z),oe=>[createTextNode(oe)],oe=>isArray$2(oe))}function Q(...Z){return J(oe=>Reflect.apply(number,null,[oe,...Z]),()=>parseNumberArgs(...Z),"number format",oe=>oe[NumberPartsSymbol](...Z),NOOP_RETURN_ARRAY,oe=>isString$1(oe)||isArray$2(oe))}function ie(...Z){return J(oe=>Reflect.apply(datetime,null,[oe,...Z]),()=>parseDateTimeArgs(...Z),"datetime format",oe=>oe[DatetimePartsSymbol](...Z),NOOP_RETURN_ARRAY,oe=>isString$1(oe)||isArray$2(oe))}function le(Z){R=Z,w.pluralRules=R}function ce(Z,oe){return J(()=>{if(!Z)return!1;const _e=isString$1(oe)?oe:d.value,ye=K(_e),Se=w.messageResolver(ye,Z);return isMessageAST(Se)||isMessageFunction(Se)||isString$1(Se)},()=>[Z],"translate exists",_e=>Reflect.apply(_e.te,_e,[Z,oe]),NOOP_RETURN_FALSE,_e=>isBoolean$1(_e))}function z(Z){let oe=null;const _e=fallbackWithLocaleChain(w,f.value,d.value);for(let ye=0;ye<_e.length;ye++){const Se=g.value[_e[ye]]||{},Ae=w.messageResolver(Se,Z);if(Ae!=null){oe=Ae;break}}return oe}function W(Z){const oe=z(Z);return oe??(e?e.tm(Z)||{}:{})}function K(Z){return g.value[Z]||{}}function ne(Z,oe){if(o){const _e={[Z]:oe};for(const ye in _e)hasOwn(_e,ye)&&handleFlatJson(_e[ye]);oe=_e[Z]}g.value[Z]=oe,w.messages=g.value}function se(Z,oe){g.value[Z]=g.value[Z]||{};const _e={[Z]:oe};if(o)for(const ye in _e)hasOwn(_e,ye)&&handleFlatJson(_e[ye]);oe=_e[Z],deepCopy(oe,g.value[Z]),w.messages=g.value}function ae(Z){return _.value[Z]||{}}function j(Z,oe){_.value[Z]=oe,w.datetimeFormats=_.value,clearDateTimeFormat(w,Z,oe)}function U(Z,oe){_.value[Z]=assign$1(_.value[Z]||{},oe),w.datetimeFormats=_.value,clearDateTimeFormat(w,Z,oe)}function X(Z){return y.value[Z]||{}}function re(Z,oe){y.value[Z]=oe,w.numberFormats=y.value,clearNumberFormat(w,Z,oe)}function ge(Z,oe){y.value[Z]=assign$1(y.value[Z]||{},oe),w.numberFormats=y.value,clearNumberFormat(w,Z,oe)}composerID++,e&&inBrowser&&(watch(e.locale,Z=>{u&&(d.value=Z,w.locale=Z,updateFallbackLocale(w,d.value,f.value))}),watch(e.fallbackLocale,Z=>{u&&(f.value=Z,w.fallbackLocale=Z,updateFallbackLocale(w,d.value,f.value))}));const ue={id:composerID,locale:O,fallbackLocale:B,get inheritLocale(){return u},set inheritLocale(Z){u=Z,Z&&e&&(d.value=e.locale.value,f.value=e.fallbackLocale.value,updateFallbackLocale(w,d.value,f.value))},get availableLocales(){return Object.keys(g.value).sort()},messages:N,get modifiers(){return L},get pluralRules(){return R||{}},get isGlobal(){return n},get missingWarn(){return b},set missingWarn(Z){b=Z,w.missingWarn=b},get fallbackWarn(){return S},set fallbackWarn(Z){S=Z,w.fallbackWarn=S},get fallbackRoot(){return v},set fallbackRoot(Z){v=Z},get fallbackFormat(){return A},set fallbackFormat(Z){A=Z,w.fallbackFormat=A},get warnHtmlMessage(){return E},set warnHtmlMessage(Z){E=Z,w.warnHtmlMessage=Z},get escapeParameter(){return P},set escapeParameter(Z){P=Z,w.escapeParameter=Z},t:q,getLocaleMessage:K,setLocaleMessage:ne,mergeLocaleMessage:se,getPostTranslationHandler:F,setPostTranslationHandler:V,getMissingHandler:G,setMissingHandler:Y,[SetPluralRulesSymbol]:le};return ue.datetimeFormats=$,ue.numberFormats=H,ue.rt=te,ue.te=ce,ue.tm=W,ue.d=de,ue.n=he,ue.getDateTimeFormat=ae,ue.setDateTimeFormat=j,ue.mergeDateTimeFormat=U,ue.getNumberFormat=X,ue.setNumberFormat=re,ue.mergeNumberFormat=ge,ue[InejctWithOptionSymbol]=i,ue[TranslateVNodeSymbol]=ee,ue[DatetimePartsSymbol]=ie,ue[NumberPartsSymbol]=Q,ue}function convertComposerOptions(r){const e=isString$1(r.locale)?r.locale:DEFAULT_LOCALE,i=isString$1(r.fallbackLocale)||isArray$2(r.fallbackLocale)||isPlainObject$1(r.fallbackLocale)||r.fallbackLocale===!1?r.fallbackLocale:e,n=isFunction$1(r.missing)?r.missing:void 0,o=isBoolean$1(r.silentTranslationWarn)||isRegExp(r.silentTranslationWarn)?!r.silentTranslationWarn:!0,l=isBoolean$1(r.silentFallbackWarn)||isRegExp(r.silentFallbackWarn)?!r.silentFallbackWarn:!0,u=isBoolean$1(r.fallbackRoot)?r.fallbackRoot:!0,d=!!r.formatFallbackMessages,f=isPlainObject$1(r.modifiers)?r.modifiers:{},g=r.pluralizationRules,_=isFunction$1(r.postTranslation)?r.postTranslation:void 0,y=isString$1(r.warnHtmlInMessage)?r.warnHtmlInMessage!=="off":!0,b=!!r.escapeParameterHtml,S=isBoolean$1(r.sync)?r.sync:!0;let v=r.messages;if(isPlainObject$1(r.sharedMessages)){const L=r.sharedMessages;v=Object.keys(L).reduce((w,D)=>{const I=w[D]||(w[D]={});return assign$1(I,L[D]),w},v||{})}const{__i18n:A,__root:x,__injectWithOption:T}=r,C=r.datetimeFormats,E=r.numberFormats,P=r.flatJson;return{locale:e,fallbackLocale:i,messages:v,flatJson:P,datetimeFormats:C,numberFormats:E,missing:n,missingWarn:o,fallbackWarn:l,fallbackRoot:u,fallbackFormat:d,modifiers:f,pluralRules:g,postTranslation:_,warnHtmlMessage:y,escapeParameter:b,messageResolver:r.messageResolver,inheritLocale:S,__i18n:A,__root:x,__injectWithOption:T}}function createVueI18n(r={}){const e=createComposer(convertComposerOptions(r)),{__extender:i}=r,n={id:e.id,get locale(){return e.locale.value},set locale(o){e.locale.value=o},get fallbackLocale(){return e.fallbackLocale.value},set fallbackLocale(o){e.fallbackLocale.value=o},get messages(){return e.messages.value},get datetimeFormats(){return e.datetimeFormats.value},get numberFormats(){return e.numberFormats.value},get availableLocales(){return e.availableLocales},get missing(){return e.getMissingHandler()},set missing(o){e.setMissingHandler(o)},get silentTranslationWarn(){return isBoolean$1(e.missingWarn)?!e.missingWarn:e.missingWarn},set silentTranslationWarn(o){e.missingWarn=isBoolean$1(o)?!o:o},get silentFallbackWarn(){return isBoolean$1(e.fallbackWarn)?!e.fallbackWarn:e.fallbackWarn},set silentFallbackWarn(o){e.fallbackWarn=isBoolean$1(o)?!o:o},get modifiers(){return e.modifiers},get formatFallbackMessages(){return e.fallbackFormat},set formatFallbackMessages(o){e.fallbackFormat=o},get postTranslation(){return e.getPostTranslationHandler()},set postTranslation(o){e.setPostTranslationHandler(o)},get sync(){return e.inheritLocale},set sync(o){e.inheritLocale=o},get warnHtmlInMessage(){return e.warnHtmlMessage?"warn":"off"},set warnHtmlInMessage(o){e.warnHtmlMessage=o!=="off"},get escapeParameterHtml(){return e.escapeParameter},set escapeParameterHtml(o){e.escapeParameter=o},get pluralizationRules(){return e.pluralRules||{}},__composer:e,t(...o){return Reflect.apply(e.t,e,[...o])},rt(...o){return Reflect.apply(e.rt,e,[...o])},te(o,l){return e.te(o,l)},tm(o){return e.tm(o)},getLocaleMessage(o){return e.getLocaleMessage(o)},setLocaleMessage(o,l){e.setLocaleMessage(o,l)},mergeLocaleMessage(o,l){e.mergeLocaleMessage(o,l)},d(...o){return Reflect.apply(e.d,e,[...o])},getDateTimeFormat(o){return e.getDateTimeFormat(o)},setDateTimeFormat(o,l){e.setDateTimeFormat(o,l)},mergeDateTimeFormat(o,l){e.mergeDateTimeFormat(o,l)},n(...o){return Reflect.apply(e.n,e,[...o])},getNumberFormat(o){return e.getNumberFormat(o)},setNumberFormat(o,l){e.setNumberFormat(o,l)},mergeNumberFormat(o,l){e.mergeNumberFormat(o,l)}};return n.__extender=i,n}function defineMixin(r,e,i){return{beforeCreate(){const n=getCurrentInstance();if(!n)throw createI18nError(I18nErrorCodes.UNEXPECTED_ERROR);const o=this.$options;if(o.i18n){const l=o.i18n;if(o.__i18n&&(l.__i18n=o.__i18n),l.__root=e,this===this.$root)this.$i18n=mergeToGlobal(r,l);else{l.__injectWithOption=!0,l.__extender=i.__vueI18nExtend,this.$i18n=createVueI18n(l);const u=this.$i18n;u.__extender&&(u.__disposer=u.__extender(this.$i18n))}}else if(o.__i18n)if(this===this.$root)this.$i18n=mergeToGlobal(r,o);else{this.$i18n=createVueI18n({__i18n:o.__i18n,__injectWithOption:!0,__extender:i.__vueI18nExtend,__root:e});const l=this.$i18n;l.__extender&&(l.__disposer=l.__extender(this.$i18n))}else this.$i18n=r;o.__i18nGlobal&&adjustI18nResources(e,o,o),this.$t=(...l)=>this.$i18n.t(...l),this.$rt=(...l)=>this.$i18n.rt(...l),this.$te=(l,u)=>this.$i18n.te(l,u),this.$d=(...l)=>this.$i18n.d(...l),this.$n=(...l)=>this.$i18n.n(...l),this.$tm=l=>this.$i18n.tm(l),i.__setInstance(n,this.$i18n)},mounted(){},unmounted(){const n=getCurrentInstance();if(!n)throw createI18nError(I18nErrorCodes.UNEXPECTED_ERROR);const o=this.$i18n;delete this.$t,delete this.$rt,delete this.$te,delete this.$d,delete this.$n,delete this.$tm,o.__disposer&&(o.__disposer(),delete o.__disposer,delete o.__extender),i.__deleteInstance(n),delete this.$i18n}}}function mergeToGlobal(r,e){r.locale=e.locale||r.locale,r.fallbackLocale=e.fallbackLocale||r.fallbackLocale,r.missing=e.missing||r.missing,r.silentTranslationWarn=e.silentTranslationWarn||r.silentFallbackWarn,r.silentFallbackWarn=e.silentFallbackWarn||r.silentFallbackWarn,r.formatFallbackMessages=e.formatFallbackMessages||r.formatFallbackMessages,r.postTranslation=e.postTranslation||r.postTranslation,r.warnHtmlInMessage=e.warnHtmlInMessage||r.warnHtmlInMessage,r.escapeParameterHtml=e.escapeParameterHtml||r.escapeParameterHtml,r.sync=e.sync||r.sync,r.__composer[SetPluralRulesSymbol](e.pluralizationRules||r.pluralizationRules);const i=getLocaleMessages(r.locale,{messages:e.messages,__i18n:e.__i18n});return Object.keys(i).forEach(n=>r.mergeLocaleMessage(n,i[n])),e.datetimeFormats&&Object.keys(e.datetimeFormats).forEach(n=>r.mergeDateTimeFormat(n,e.datetimeFormats[n])),e.numberFormats&&Object.keys(e.numberFormats).forEach(n=>r.mergeNumberFormat(n,e.numberFormats[n])),r}const baseFormatProps={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:r=>r==="parent"||r==="global",default:"parent"},i18n:{type:Object}};function getInterpolateArg({slots:r},e){return e.length===1&&e[0]==="default"?(r.default?r.default():[]).reduce((n,o)=>[...n,...o.type===Fragment?o.children:[o]],[]):e.reduce((i,n)=>{const o=r[n];return o&&(i[n]=o()),i},create$2())}function getFragmentableTag(){return Fragment}const TranslationImpl=defineComponent({name:"i18n-t",props:assign$1({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:r=>isNumber$1(r)||!isNaN(r)}},baseFormatProps),setup(r,e){const{slots:i,attrs:n}=e,o=r.i18n||useI18n({useScope:r.scope,__useComponent:!0});return()=>{const l=Object.keys(i).filter(y=>y!=="_"),u=create$2();r.locale&&(u.locale=r.locale),r.plural!==void 0&&(u.plural=isString$1(r.plural)?+r.plural:r.plural);const d=getInterpolateArg(e,l),f=o[TranslateVNodeSymbol](r.keypath,d,u),g=assign$1(create$2(),n),_=isString$1(r.tag)||isObject$2(r.tag)?r.tag:getFragmentableTag();return h(_,g,f)}}}),Translation=TranslationImpl;function isVNode(r){return isArray$2(r)&&!isString$1(r[0])}function renderFormatter(r,e,i,n){const{slots:o,attrs:l}=e;return()=>{const u={part:!0};let d=create$2();r.locale&&(u.locale=r.locale),isString$1(r.format)?u.key=r.format:isObject$2(r.format)&&(isString$1(r.format.key)&&(u.key=r.format.key),d=Object.keys(r.format).reduce((b,S)=>i.includes(S)?assign$1(create$2(),b,{[S]:r.format[S]}):b,create$2()));const f=n(r.value,u,d);let g=[u.key];isArray$2(f)?g=f.map((b,S)=>{const v=o[b.type],A=v?v({[b.type]:b.value,index:S,parts:f}):[b.value];return isVNode(A)&&(A[0].key=`${b.type}-${S}`),A}):isString$1(f)&&(g=[f]);const _=assign$1(create$2(),l),y=isString$1(r.tag)||isObject$2(r.tag)?r.tag:getFragmentableTag();return h(y,_,g)}}const NumberFormatImpl=defineComponent({name:"i18n-n",props:assign$1({value:{type:Number,required:!0},format:{type:[String,Object]}},baseFormatProps),setup(r,e){const i=r.i18n||useI18n({useScope:r.scope,__useComponent:!0});return renderFormatter(r,e,NUMBER_FORMAT_OPTIONS_KEYS,(...n)=>i[NumberPartsSymbol](...n))}}),NumberFormat=NumberFormatImpl;function getComposer$1(r,e){const i=r;if(r.mode==="composition")return i.__getInstance(e)||r.global;{const n=i.__getInstance(e);return n!=null?n.__composer:r.global.__composer}}function vTDirective(r){const e=u=>{const{instance:d,value:f}=u;if(!d||!d.$)throw createI18nError(I18nErrorCodes.UNEXPECTED_ERROR);const g=getComposer$1(r,d.$),_=parseValue(f);return[Reflect.apply(g.t,g,[...makeParams(_)]),g]};return{created:(u,d)=>{const[f,g]=e(d);inBrowser&&r.global===g&&(u.__i18nWatcher=watch(g.locale,()=>{d.instance&&d.instance.$forceUpdate()})),u.__composer=g,u.textContent=f},unmounted:u=>{inBrowser&&u.__i18nWatcher&&(u.__i18nWatcher(),u.__i18nWatcher=void 0,delete u.__i18nWatcher),u.__composer&&(u.__composer=void 0,delete u.__composer)},beforeUpdate:(u,{value:d})=>{if(u.__composer){const f=u.__composer,g=parseValue(d);u.textContent=Reflect.apply(f.t,f,[...makeParams(g)])}},getSSRProps:u=>{const[d]=e(u);return{textContent:d}}}}function parseValue(r){if(isString$1(r))return{path:r};if(isPlainObject$1(r)){if(!("path"in r))throw createI18nError(I18nErrorCodes.REQUIRED_VALUE,"path");return r}else throw createI18nError(I18nErrorCodes.INVALID_VALUE)}function makeParams(r){const{path:e,locale:i,args:n,choice:o,plural:l}=r,u={},d=n||{};return isString$1(i)&&(u.locale=i),isNumber$1(o)&&(u.plural=o),isNumber$1(l)&&(u.plural=l),[e,d,u]}function apply(r,e,...i){const n=isPlainObject$1(i[0])?i[0]:{};(isBoolean$1(n.globalInstall)?n.globalInstall:!0)&&([Translation.name,"I18nT"].forEach(l=>r.component(l,Translation)),[NumberFormat.name,"I18nN"].forEach(l=>r.component(l,NumberFormat)),[DatetimeFormat.name,"I18nD"].forEach(l=>r.component(l,DatetimeFormat))),r.directive("t",vTDirective(e))}const I18nInjectionKey=makeSymbol("global-vue-i18n");function createI18n(r={}){const e=__VUE_I18N_LEGACY_API__&&isBoolean$1(r.legacy)?r.legacy:__VUE_I18N_LEGACY_API__,i=isBoolean$1(r.globalInjection)?r.globalInjection:!0,n=new Map,[o,l]=createGlobal(r,e),u=makeSymbol("");function d(y){return n.get(y)||null}function f(y,b){n.set(y,b)}function g(y){n.delete(y)}const _={get mode(){return __VUE_I18N_LEGACY_API__&&e?"legacy":"composition"},async install(y,...b){if(y.__VUE_I18N_SYMBOL__=u,y.provide(y.__VUE_I18N_SYMBOL__,_),isPlainObject$1(b[0])){const A=b[0];_.__composerExtend=A.__composerExtend,_.__vueI18nExtend=A.__vueI18nExtend}let S=null;!e&&i&&(S=injectGlobalFields(y,_.global)),__VUE_I18N_FULL_INSTALL__&&apply(y,_,...b),__VUE_I18N_LEGACY_API__&&e&&y.mixin(defineMixin(l,l.__composer,_));const v=y.unmount;y.unmount=()=>{S&&S(),_.dispose(),v()}},get global(){return l},dispose(){o.stop()},__instances:n,__getInstance:d,__setInstance:f,__deleteInstance:g};return _}function useI18n(r={}){const e=getCurrentInstance();if(e==null)throw createI18nError(I18nErrorCodes.MUST_BE_CALL_SETUP_TOP);if(!e.isCE&&e.appContext.app!=null&&!e.appContext.app.__VUE_I18N_SYMBOL__)throw createI18nError(I18nErrorCodes.NOT_INSTALLED);const i=getI18nInstance(e),n=getGlobalComposer(i),o=getComponentOptions(e),l=getScope(r,o);if(l==="global")return adjustI18nResources(n,r,o),n;if(l==="parent"){let f=getComposer(i,e,r.__useComponent);return f==null&&(f=n),f}const u=i;let d=u.__getInstance(e);if(d==null){const f=assign$1({},r);"__i18n"in o&&(f.__i18n=o.__i18n),n&&(f.__root=n),d=createComposer(f),u.__composerExtend&&(d[DisposeSymbol]=u.__composerExtend(d)),setupLifeCycle(u,e,d),u.__setInstance(e,d)}return d}function createGlobal(r,e){const i=effectScope(),n=__VUE_I18N_LEGACY_API__&&e?i.run(()=>createVueI18n(r)):i.run(()=>createComposer(r));if(n==null)throw createI18nError(I18nErrorCodes.UNEXPECTED_ERROR);return[i,n]}function getI18nInstance(r){const e=inject$1(r.isCE?I18nInjectionKey:r.appContext.app.__VUE_I18N_SYMBOL__);if(!e)throw createI18nError(r.isCE?I18nErrorCodes.NOT_INSTALLED_WITH_PROVIDE:I18nErrorCodes.UNEXPECTED_ERROR);return e}function getScope(r,e){return isEmptyObject(r)?"__i18n"in e?"local":"global":r.useScope?r.useScope:"local"}function getGlobalComposer(r){return r.mode==="composition"?r.global:r.global.__composer}function getComposer(r,e,i=!1){let n=null;const o=e.root;let l=getParentComponentInstance(e,i);for(;l!=null;){const u=r;if(r.mode==="composition")n=u.__getInstance(l);else if(__VUE_I18N_LEGACY_API__){const d=u.__getInstance(l);d!=null&&(n=d.__composer,i&&n&&!n[InejctWithOptionSymbol]&&(n=null))}if(n!=null||o===l)break;l=l.parent}return n}function getParentComponentInstance(r,e=!1){return r==null?null:e&&r.vnode.ctx||r.parent}function setupLifeCycle(r,e,i){onMounted(()=>{},e),onUnmounted(()=>{const n=i;r.__deleteInstance(e);const o=n[DisposeSymbol];o&&(o(),delete n[DisposeSymbol])},e)}const globalExportProps=["locale","fallbackLocale","availableLocales"],globalExportMethods=["t","rt","d","n","tm","te"];function injectGlobalFields(r,e){const i=Object.create(null);return globalExportProps.forEach(o=>{const l=Object.getOwnPropertyDescriptor(e,o);if(!l)throw createI18nError(I18nErrorCodes.UNEXPECTED_ERROR);const u=isRef(l.value)?{get(){return l.value.value},set(d){l.value.value=d}}:{get(){return l.get&&l.get()}};Object.defineProperty(i,o,u)}),r.config.globalProperties.$i18n=i,globalExportMethods.forEach(o=>{const l=Object.getOwnPropertyDescriptor(e,o);if(!l||!l.value)throw createI18nError(I18nErrorCodes.UNEXPECTED_ERROR);Object.defineProperty(r.config.globalProperties,`$${o}`,l)}),()=>{delete r.config.globalProperties.$i18n,globalExportMethods.forEach(o=>{delete r.config.globalProperties[`$${o}`]})}}const DatetimeFormatImpl=defineComponent({name:"i18n-d",props:assign$1({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},baseFormatProps),setup(r,e){const i=r.i18n||useI18n({useScope:r.scope,__useComponent:!0});return renderFormatter(r,e,DATETIME_FORMAT_OPTIONS_KEYS,(...n)=>i[DatetimePartsSymbol](...n))}}),DatetimeFormat=DatetimeFormatImpl;initFeatureFlags();registerMessageCompiler(compile);registerMessageResolver(resolveValue);registerLocaleFallbacker(fallbackWithLocaleChain);if(__INTLIFY_PROD_DEVTOOLS__){const r=getGlobalThis();r.__INTLIFY__=!0,setDevToolsHook(r.__INTLIFY_DEVTOOLS_GLOBAL_HOOK__)}const _export_sfc=(r,e)=>{const i=r.__vccOpts||r;for(const[n,o]of e)i[n]=o;return i},_sfc_main$9={__name:"LoginButton",setup(r){ref(!1);const{locale:e}=useI18n(),i=n=>{e.value=n};return(n,o)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("button",{onClick:o[0]||(o[0]=l=>i("en")),class:"b22"},"English"),o[2]||(o[2]=createBaseVNode("span",null,"|",-1)),createBaseVNode("button",{onClick:o[1]||(o[1]=l=>i("zh")),class:"b22"},"")],64))}},LoginButton=_export_sfc(_sfc_main$9,[["__scopeId","data-v-03defb2d"]]);/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const isBrowser$1=typeof document<"u";function isRouteComponent(r){return typeof r=="object"||"displayName"in r||"props"in r||"__vccOpts"in r}function isESModule(r){return r.__esModule||r[Symbol.toStringTag]==="Module"||r.default&&isRouteComponent(r.default)}const assign=Object.assign;function applyToParams(r,e){const i={};for(const n in e){const o=e[n];i[n]=isArray$1(o)?o.map(r):r(o)}return i}const noop$1=()=>{},isArray$1=Array.isArray,HASH_RE=/#/g,AMPERSAND_RE=/&/g,SLASH_RE=/\//g,EQUAL_RE=/=/g,IM_RE=/\?/g,PLUS_RE=/\+/g,ENC_BRACKET_OPEN_RE=/%5B/g,ENC_BRACKET_CLOSE_RE=/%5D/g,ENC_CARET_RE=/%5E/g,ENC_BACKTICK_RE=/%60/g,ENC_CURLY_OPEN_RE=/%7B/g,ENC_PIPE_RE=/%7C/g,ENC_CURLY_CLOSE_RE=/%7D/g,ENC_SPACE_RE=/%20/g;function commonEncode(r){return encodeURI(""+r).replace(ENC_PIPE_RE,"|").replace(ENC_BRACKET_OPEN_RE,"[").replace(ENC_BRACKET_CLOSE_RE,"]")}function encodeHash(r){return commonEncode(r).replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryValue(r){return commonEncode(r).replace(PLUS_RE,"%2B").replace(ENC_SPACE_RE,"+").replace(HASH_RE,"%23").replace(AMPERSAND_RE,"%26").replace(ENC_BACKTICK_RE,"`").replace(ENC_CURLY_OPEN_RE,"{").replace(ENC_CURLY_CLOSE_RE,"}").replace(ENC_CARET_RE,"^")}function encodeQueryKey(r){return encodeQueryValue(r).replace(EQUAL_RE,"%3D")}function encodePath(r){return commonEncode(r).replace(HASH_RE,"%23").replace(IM_RE,"%3F")}function encodeParam(r){return r==null?"":encodePath(r).replace(SLASH_RE,"%2F")}function decode(r){try{return decodeURIComponent(""+r)}catch{}return""+r}const TRAILING_SLASH_RE=/\/$/,removeTrailingSlash=r=>r.replace(TRAILING_SLASH_RE,"");function parseURL(r,e,i="/"){let n,o={},l="",u="";const d=e.indexOf("#");let f=e.indexOf("?");return d<f&&d>=0&&(f=-1),f>-1&&(n=e.slice(0,f),l=e.slice(f+1,d>-1?d:e.length),o=r(l)),d>-1&&(n=n||e.slice(0,d),u=e.slice(d,e.length)),n=resolveRelativePath(n??e,i),{fullPath:n+(l&&"?")+l+u,path:n,query:o,hash:decode(u)}}function stringifyURL(r,e){const i=e.query?r(e.query):"";return e.path+(i&&"?")+i+(e.hash||"")}function stripBase(r,e){return!e||!r.toLowerCase().startsWith(e.toLowerCase())?r:r.slice(e.length)||"/"}function isSameRouteLocation(r,e,i){const n=e.matched.length-1,o=i.matched.length-1;return n>-1&&n===o&&isSameRouteRecord(e.matched[n],i.matched[o])&&isSameRouteLocationParams(e.params,i.params)&&r(e.query)===r(i.query)&&e.hash===i.hash}function isSameRouteRecord(r,e){return(r.aliasOf||r)===(e.aliasOf||e)}function isSameRouteLocationParams(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!isSameRouteLocationParamsValue(r[i],e[i]))return!1;return!0}function isSameRouteLocationParamsValue(r,e){return isArray$1(r)?isEquivalentArray(r,e):isArray$1(e)?isEquivalentArray(e,r):r===e}function isEquivalentArray(r,e){return isArray$1(e)?r.length===e.length&&r.every((i,n)=>i===e[n]):r.length===1&&r[0]===e}function resolveRelativePath(r,e){if(r.startsWith("/"))return r;if(!r)return e;const i=e.split("/"),n=r.split("/"),o=n[n.length-1];(o===".."||o===".")&&n.push("");let l=i.length-1,u,d;for(u=0;u<n.length;u++)if(d=n[u],d!==".")if(d==="..")l>1&&l--;else break;return i.slice(0,l).join("/")+"/"+n.slice(u).join("/")}const START_LOCATION_NORMALIZED={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var NavigationType;(function(r){r.pop="pop",r.push="push"})(NavigationType||(NavigationType={}));var NavigationDirection;(function(r){r.back="back",r.forward="forward",r.unknown=""})(NavigationDirection||(NavigationDirection={}));function normalizeBase(r){if(!r)if(isBrowser$1){const e=document.querySelector("base");r=e&&e.getAttribute("href")||"/",r=r.replace(/^\w+:\/\/[^\/]+/,"")}else r="/";return r[0]!=="/"&&r[0]!=="#"&&(r="/"+r),removeTrailingSlash(r)}const BEFORE_HASH_RE=/^[^#]+#/;function createHref(r,e){return r.replace(BEFORE_HASH_RE,"#")+e}function getElementPosition(r,e){const i=document.documentElement.getBoundingClientRect(),n=r.getBoundingClientRect();return{behavior:e.behavior,left:n.left-i.left-(e.left||0),top:n.top-i.top-(e.top||0)}}const computeScrollPosition=()=>({left:window.scrollX,top:window.scrollY});function scrollToPosition(r){let e;if("el"in r){const i=r.el,n=typeof i=="string"&&i.startsWith("#"),o=typeof i=="string"?n?document.getElementById(i.slice(1)):document.querySelector(i):i;if(!o)return;e=getElementPosition(o,r)}else e=r;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function getScrollKey(r,e){return(history.state?history.state.position-e:-1)+r}const scrollPositions=new Map;function saveScrollPosition(r,e){scrollPositions.set(r,e)}function getSavedScrollPosition(r){const e=scrollPositions.get(r);return scrollPositions.delete(r),e}let createBaseLocation=()=>location.protocol+"//"+location.host;function createCurrentLocation(r,e){const{pathname:i,search:n,hash:o}=e,l=r.indexOf("#");if(l>-1){let d=o.includes(r.slice(l))?r.slice(l).length:1,f=o.slice(d);return f[0]!=="/"&&(f="/"+f),stripBase(f,"")}return stripBase(i,r)+n+o}function useHistoryListeners(r,e,i,n){let o=[],l=[],u=null;const d=({state:b})=>{const S=createCurrentLocation(r,location),v=i.value,A=e.value;let x=0;if(b){if(i.value=S,e.value=b,u&&u===v){u=null;return}x=A?b.position-A.position:0}else n(S);o.forEach(T=>{T(i.value,v,{delta:x,type:NavigationType.pop,direction:x?x>0?NavigationDirection.forward:NavigationDirection.back:NavigationDirection.unknown})})};function f(){u=i.value}function g(b){o.push(b);const S=()=>{const v=o.indexOf(b);v>-1&&o.splice(v,1)};return l.push(S),S}function _(){const{history:b}=window;b.state&&b.replaceState(assign({},b.state,{scroll:computeScrollPosition()}),"")}function y(){for(const b of l)b();l=[],window.removeEventListener("popstate",d),window.removeEventListener("beforeunload",_)}return window.addEventListener("popstate",d),window.addEventListener("beforeunload",_,{passive:!0}),{pauseListeners:f,listen:g,destroy:y}}function buildState(r,e,i,n=!1,o=!1){return{back:r,current:e,forward:i,replaced:n,position:window.history.length,scroll:o?computeScrollPosition():null}}function useHistoryStateNavigation(r){const{history:e,location:i}=window,n={value:createCurrentLocation(r,i)},o={value:e.state};o.value||l(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function l(f,g,_){const y=r.indexOf("#"),b=y>-1?(i.host&&document.querySelector("base")?r:r.slice(y))+f:createBaseLocation()+r+f;try{e[_?"replaceState":"pushState"](g,"",b),o.value=g}catch(S){console.error(S),i[_?"replace":"assign"](b)}}function u(f,g){const _=assign({},e.state,buildState(o.value.back,f,o.value.forward,!0),g,{position:o.value.position});l(f,_,!0),n.value=f}function d(f,g){const _=assign({},o.value,e.state,{forward:f,scroll:computeScrollPosition()});l(_.current,_,!0);const y=assign({},buildState(n.value,f,null),{position:_.position+1},g);l(f,y,!1),n.value=f}return{location:n,state:o,push:d,replace:u}}function createWebHistory(r){r=normalizeBase(r);const e=useHistoryStateNavigation(r),i=useHistoryListeners(r,e.state,e.location,e.replace);function n(l,u=!0){u||i.pauseListeners(),history.go(l)}const o=assign({location:"",base:r,go:n,createHref:createHref.bind(null,r)},e,i);return Object.defineProperty(o,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(o,"state",{enumerable:!0,get:()=>e.state.value}),o}function createWebHashHistory(r){return r=location.host?r||location.pathname+location.search:"",r.includes("#")||(r+="#"),createWebHistory(r)}function isRouteLocation(r){return typeof r=="string"||r&&typeof r=="object"}function isRouteName(r){return typeof r=="string"||typeof r=="symbol"}const NavigationFailureSymbol=Symbol("");var NavigationFailureType;(function(r){r[r.aborted=4]="aborted",r[r.cancelled=8]="cancelled",r[r.duplicated=16]="duplicated"})(NavigationFailureType||(NavigationFailureType={}));function createRouterError(r,e){return assign(new Error,{type:r,[NavigationFailureSymbol]:!0},e)}function isNavigationFailure(r,e){return r instanceof Error&&NavigationFailureSymbol in r&&(e==null||!!(r.type&e))}const BASE_PARAM_PATTERN="[^/]+?",BASE_PATH_PARSER_OPTIONS={sensitive:!1,strict:!1,start:!0,end:!0},REGEX_CHARS_RE=/[.+*?^${}()[\]/\\]/g;function tokensToParser(r,e){const i=assign({},BASE_PATH_PARSER_OPTIONS,e),n=[];let o=i.start?"^":"";const l=[];for(const g of r){const _=g.length?[]:[90];i.strict&&!g.length&&(o+="/");for(let y=0;y<g.length;y++){const b=g[y];let S=40+(i.sensitive?.25:0);if(b.type===0)y||(o+="/"),o+=b.value.replace(REGEX_CHARS_RE,"\\$&"),S+=40;else if(b.type===1){const{value:v,repeatable:A,optional:x,regexp:T}=b;l.push({name:v,repeatable:A,optional:x});const C=T||BASE_PARAM_PATTERN;if(C!==BASE_PARAM_PATTERN){S+=10;try{new RegExp(`(${C})`)}catch(P){throw new Error(`Invalid custom RegExp for param "${v}" (${C}): `+P.message)}}let E=A?`((?:${C})(?:/(?:${C}))*)`:`(${C})`;y||(E=x&&g.length<2?`(?:/${E})`:"/"+E),x&&(E+="?"),o+=E,S+=20,x&&(S+=-8),A&&(S+=-20),C===".*"&&(S+=-50)}_.push(S)}n.push(_)}if(i.strict&&i.end){const g=n.length-1;n[g][n[g].length-1]+=.7000000000000001}i.strict||(o+="/?"),i.end?o+="$":i.strict&&!o.endsWith("/")&&(o+="(?:/|$)");const u=new RegExp(o,i.sensitive?"":"i");function d(g){const _=g.match(u),y={};if(!_)return null;for(let b=1;b<_.length;b++){const S=_[b]||"",v=l[b-1];y[v.name]=S&&v.repeatable?S.split("/"):S}return y}function f(g){let _="",y=!1;for(const b of r){(!y||!_.endsWith("/"))&&(_+="/"),y=!1;for(const S of b)if(S.type===0)_+=S.value;else if(S.type===1){const{value:v,repeatable:A,optional:x}=S,T=v in g?g[v]:"";if(isArray$1(T)&&!A)throw new Error(`Provided param "${v}" is an array but it is not repeatable (* or + modifiers)`);const C=isArray$1(T)?T.join("/"):T;if(!C)if(x)b.length<2&&(_.endsWith("/")?_=_.slice(0,-1):y=!0);else throw new Error(`Missing required param "${v}"`);_+=C}}return _||"/"}return{re:u,score:n,keys:l,parse:d,stringify:f}}function compareScoreArray(r,e){let i=0;for(;i<r.length&&i<e.length;){const n=e[i]-r[i];if(n)return n;i++}return r.length<e.length?r.length===1&&r[0]===80?-1:1:r.length>e.length?e.length===1&&e[0]===80?1:-1:0}function comparePathParserScore(r,e){let i=0;const n=r.score,o=e.score;for(;i<n.length&&i<o.length;){const l=compareScoreArray(n[i],o[i]);if(l)return l;i++}if(Math.abs(o.length-n.length)===1){if(isLastScoreNegative(n))return 1;if(isLastScoreNegative(o))return-1}return o.length-n.length}function isLastScoreNegative(r){const e=r[r.length-1];return r.length>0&&e[e.length-1]<0}const ROOT_TOKEN={type:0,value:""},VALID_PARAM_RE=/[a-zA-Z0-9_]/;function tokenizePath(r){if(!r)return[[]];if(r==="/")return[[ROOT_TOKEN]];if(!r.startsWith("/"))throw new Error(`Invalid path "${r}"`);function e(S){throw new Error(`ERR (${i})/"${g}": ${S}`)}let i=0,n=i;const o=[];let l;function u(){l&&o.push(l),l=[]}let d=0,f,g="",_="";function y(){g&&(i===0?l.push({type:0,value:g}):i===1||i===2||i===3?(l.length>1&&(f==="*"||f==="+")&&e(`A repeatable param (${g}) must be alone in its segment. eg: '/:ids+.`),l.push({type:1,value:g,regexp:_,repeatable:f==="*"||f==="+",optional:f==="*"||f==="?"})):e("Invalid state to consume buffer"),g="")}function b(){g+=f}for(;d<r.length;){if(f=r[d++],f==="\\"&&i!==2){n=i,i=4;continue}switch(i){case 0:f==="/"?(g&&y(),u()):f===":"?(y(),i=1):b();break;case 4:b(),i=n;break;case 1:f==="("?i=2:VALID_PARAM_RE.test(f)?b():(y(),i=0,f!=="*"&&f!=="?"&&f!=="+"&&d--);break;case 2:f===")"?_[_.length-1]=="\\"?_=_.slice(0,-1)+f:i=3:_+=f;break;case 3:y(),i=0,f!=="*"&&f!=="?"&&f!=="+"&&d--,_="";break;default:e("Unknown state");break}}return i===2&&e(`Unfinished custom RegExp for param "${g}"`),y(),u(),o}function createRouteRecordMatcher(r,e,i){const n=tokensToParser(tokenizePath(r.path),i),o=assign(n,{record:r,parent:e,children:[],alias:[]});return e&&!o.record.aliasOf==!e.record.aliasOf&&e.children.push(o),o}function createRouterMatcher(r,e){const i=[],n=new Map;e=mergeOptions({strict:!1,end:!0,sensitive:!1},e);function o(y){return n.get(y)}function l(y,b,S){const v=!S,A=normalizeRouteRecord(y);A.aliasOf=S&&S.record;const x=mergeOptions(e,y),T=[A];if("alias"in y){const P=typeof y.alias=="string"?[y.alias]:y.alias;for(const L of P)T.push(normalizeRouteRecord(assign({},A,{components:S?S.record.components:A.components,path:L,aliasOf:S?S.record:A})))}let C,E;for(const P of T){const{path:L}=P;if(b&&L[0]!=="/"){const R=b.record.path,w=R[R.length-1]==="/"?"":"/";P.path=b.record.path+(L&&w+L)}if(C=createRouteRecordMatcher(P,b,x),S?S.alias.push(C):(E=E||C,E!==C&&E.alias.push(C),v&&y.name&&!isAliasRecord(C)&&u(y.name)),isMatchable(C)&&f(C),A.children){const R=A.children;for(let w=0;w<R.length;w++)l(R[w],C,S&&S.children[w])}S=S||C}return E?()=>{u(E)}:noop$1}function u(y){if(isRouteName(y)){const b=n.get(y);b&&(n.delete(y),i.splice(i.indexOf(b),1),b.children.forEach(u),b.alias.forEach(u))}else{const b=i.indexOf(y);b>-1&&(i.splice(b,1),y.record.name&&n.delete(y.record.name),y.children.forEach(u),y.alias.forEach(u))}}function d(){return i}function f(y){const b=findInsertionIndex(y,i);i.splice(b,0,y),y.record.name&&!isAliasRecord(y)&&n.set(y.record.name,y)}function g(y,b){let S,v={},A,x;if("name"in y&&y.name){if(S=n.get(y.name),!S)throw createRouterError(1,{location:y});x=S.record.name,v=assign(paramsFromLocation(b.params,S.keys.filter(E=>!E.optional).concat(S.parent?S.parent.keys.filter(E=>E.optional):[]).map(E=>E.name)),y.params&&paramsFromLocation(y.params,S.keys.map(E=>E.name))),A=S.stringify(v)}else if(y.path!=null)A=y.path,S=i.find(E=>E.re.test(A)),S&&(v=S.parse(A),x=S.record.name);else{if(S=b.name?n.get(b.name):i.find(E=>E.re.test(b.path)),!S)throw createRouterError(1,{location:y,currentLocation:b});x=S.record.name,v=assign({},b.params,y.params),A=S.stringify(v)}const T=[];let C=S;for(;C;)T.unshift(C.record),C=C.parent;return{name:x,path:A,params:v,matched:T,meta:mergeMetaFields(T)}}r.forEach(y=>l(y));function _(){i.length=0,n.clear()}return{addRoute:l,resolve:g,removeRoute:u,clearRoutes:_,getRoutes:d,getRecordMatcher:o}}function paramsFromLocation(r,e){const i={};for(const n of e)n in r&&(i[n]=r[n]);return i}function normalizeRouteRecord(r){const e={path:r.path,redirect:r.redirect,name:r.name,meta:r.meta||{},aliasOf:r.aliasOf,beforeEnter:r.beforeEnter,props:normalizeRecordProps(r),children:r.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in r?r.components||null:r.component&&{default:r.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function normalizeRecordProps(r){const e={},i=r.props||!1;if("component"in r)e.default=i;else for(const n in r.components)e[n]=typeof i=="object"?i[n]:i;return e}function isAliasRecord(r){for(;r;){if(r.record.aliasOf)return!0;r=r.parent}return!1}function mergeMetaFields(r){return r.reduce((e,i)=>assign(e,i.meta),{})}function mergeOptions(r,e){const i={};for(const n in r)i[n]=n in e?e[n]:r[n];return i}function findInsertionIndex(r,e){let i=0,n=e.length;for(;i!==n;){const l=i+n>>1;comparePathParserScore(r,e[l])<0?n=l:i=l+1}const o=getInsertionAncestor(r);return o&&(n=e.lastIndexOf(o,n-1)),n}function getInsertionAncestor(r){let e=r;for(;e=e.parent;)if(isMatchable(e)&&comparePathParserScore(r,e)===0)return e}function isMatchable({record:r}){return!!(r.name||r.components&&Object.keys(r.components).length||r.redirect)}function parseQuery(r){const e={};if(r===""||r==="?")return e;const n=(r[0]==="?"?r.slice(1):r).split("&");for(let o=0;o<n.length;++o){const l=n[o].replace(PLUS_RE," "),u=l.indexOf("="),d=decode(u<0?l:l.slice(0,u)),f=u<0?null:decode(l.slice(u+1));if(d in e){let g=e[d];isArray$1(g)||(g=e[d]=[g]),g.push(f)}else e[d]=f}return e}function stringifyQuery(r){let e="";for(let i in r){const n=r[i];if(i=encodeQueryKey(i),n==null){n!==void 0&&(e+=(e.length?"&":"")+i);continue}(isArray$1(n)?n.map(l=>l&&encodeQueryValue(l)):[n&&encodeQueryValue(n)]).forEach(l=>{l!==void 0&&(e+=(e.length?"&":"")+i,l!=null&&(e+="="+l))})}return e}function normalizeQuery(r){const e={};for(const i in r){const n=r[i];n!==void 0&&(e[i]=isArray$1(n)?n.map(o=>o==null?null:""+o):n==null?n:""+n)}return e}const matchedRouteKey=Symbol(""),viewDepthKey=Symbol(""),routerKey=Symbol(""),routeLocationKey=Symbol(""),routerViewLocationKey=Symbol("");function useCallbacks(){let r=[];function e(n){return r.push(n),()=>{const o=r.indexOf(n);o>-1&&r.splice(o,1)}}function i(){r=[]}return{add:e,list:()=>r.slice(),reset:i}}function guardToPromiseFn(r,e,i,n,o,l=u=>u()){const u=n&&(n.enterCallbacks[o]=n.enterCallbacks[o]||[]);return()=>new Promise((d,f)=>{const g=b=>{b===!1?f(createRouterError(4,{from:i,to:e})):b instanceof Error?f(b):isRouteLocation(b)?f(createRouterError(2,{from:e,to:b})):(u&&n.enterCallbacks[o]===u&&typeof b=="function"&&u.push(b),d())},_=l(()=>r.call(n&&n.instances[o],e,i,g));let y=Promise.resolve(_);r.length<3&&(y=y.then(g)),y.catch(b=>f(b))})}function extractComponentsGuards(r,e,i,n,o=l=>l()){const l=[];for(const u of r)for(const d in u.components){let f=u.components[d];if(!(e!=="beforeRouteEnter"&&!u.instances[d]))if(isRouteComponent(f)){const _=(f.__vccOpts||f)[e];_&&l.push(guardToPromiseFn(_,i,n,u,d,o))}else{let g=f();l.push(()=>g.then(_=>{if(!_)throw new Error(`Couldn't resolve component "${d}" at "${u.path}"`);const y=isESModule(_)?_.default:_;u.mods[d]=_,u.components[d]=y;const S=(y.__vccOpts||y)[e];return S&&guardToPromiseFn(S,i,n,u,d,o)()}))}}return l}function useLink(r){const e=inject$1(routerKey),i=inject$1(routeLocationKey),n=computed(()=>{const f=unref(r.to);return e.resolve(f)}),o=computed(()=>{const{matched:f}=n.value,{length:g}=f,_=f[g-1],y=i.matched;if(!_||!y.length)return-1;const b=y.findIndex(isSameRouteRecord.bind(null,_));if(b>-1)return b;const S=getOriginalPath(f[g-2]);return g>1&&getOriginalPath(_)===S&&y[y.length-1].path!==S?y.findIndex(isSameRouteRecord.bind(null,f[g-2])):b}),l=computed(()=>o.value>-1&&includesParams(i.params,n.value.params)),u=computed(()=>o.value>-1&&o.value===i.matched.length-1&&isSameRouteLocationParams(i.params,n.value.params));function d(f={}){if(guardEvent(f)){const g=e[unref(r.replace)?"replace":"push"](unref(r.to)).catch(noop$1);return r.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>g),g}return Promise.resolve()}return{route:n,href:computed(()=>n.value.href),isActive:l,isExactActive:u,navigate:d}}function preferSingleVNode(r){return r.length===1?r[0]:r}const RouterLinkImpl=defineComponent({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink,setup(r,{slots:e}){const i=reactive(useLink(r)),{options:n}=inject$1(routerKey),o=computed(()=>({[getLinkClass(r.activeClass,n.linkActiveClass,"router-link-active")]:i.isActive,[getLinkClass(r.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:i.isExactActive}));return()=>{const l=e.default&&preferSingleVNode(e.default(i));return r.custom?l:h("a",{"aria-current":i.isExactActive?r.ariaCurrentValue:null,href:i.href,onClick:i.navigate,class:o.value},l)}}}),RouterLink=RouterLinkImpl;function guardEvent(r){if(!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)&&!r.defaultPrevented&&!(r.button!==void 0&&r.button!==0)){if(r.currentTarget&&r.currentTarget.getAttribute){const e=r.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return r.preventDefault&&r.preventDefault(),!0}}function includesParams(r,e){for(const i in e){const n=e[i],o=r[i];if(typeof n=="string"){if(n!==o)return!1}else if(!isArray$1(o)||o.length!==n.length||n.some((l,u)=>l!==o[u]))return!1}return!0}function getOriginalPath(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}const getLinkClass=(r,e,i)=>r??e??i,RouterViewImpl=defineComponent({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(r,{attrs:e,slots:i}){const n=inject$1(routerViewLocationKey),o=computed(()=>r.route||n.value),l=inject$1(viewDepthKey,0),u=computed(()=>{let g=unref(l);const{matched:_}=o.value;let y;for(;(y=_[g])&&!y.components;)g++;return g}),d=computed(()=>o.value.matched[u.value]);provide(viewDepthKey,computed(()=>u.value+1)),provide(matchedRouteKey,d),provide(routerViewLocationKey,o);const f=ref();return watch(()=>[f.value,d.value,r.name],([g,_,y],[b,S,v])=>{_&&(_.instances[y]=g,S&&S!==_&&g&&g===b&&(_.leaveGuards.size||(_.leaveGuards=S.leaveGuards),_.updateGuards.size||(_.updateGuards=S.updateGuards))),g&&_&&(!S||!isSameRouteRecord(_,S)||!b)&&(_.enterCallbacks[y]||[]).forEach(A=>A(g))},{flush:"post"}),()=>{const g=o.value,_=r.name,y=d.value,b=y&&y.components[_];if(!b)return normalizeSlot(i.default,{Component:b,route:g});const S=y.props[_],v=S?S===!0?g.params:typeof S=="function"?S(g):S:null,x=h(b,assign({},v,e,{onVnodeUnmounted:T=>{T.component.isUnmounted&&(y.instances[_]=null)},ref:f}));return normalizeSlot(i.default,{Component:x,route:g})||x}}});function normalizeSlot(r,e){if(!r)return null;const i=r(e);return i.length===1?i[0]:i}const RouterView=RouterViewImpl;function createRouter(r){const e=createRouterMatcher(r.routes,r),i=r.parseQuery||parseQuery,n=r.stringifyQuery||stringifyQuery,o=r.history,l=useCallbacks(),u=useCallbacks(),d=useCallbacks(),f=shallowRef(START_LOCATION_NORMALIZED);let g=START_LOCATION_NORMALIZED;isBrowser$1&&r.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const _=applyToParams.bind(null,ee=>""+ee),y=applyToParams.bind(null,encodeParam),b=applyToParams.bind(null,decode);function S(ee,Q){let ie,le;return isRouteName(ee)?(ie=e.getRecordMatcher(ee),le=Q):le=ee,e.addRoute(le,ie)}function v(ee){const Q=e.getRecordMatcher(ee);Q&&e.removeRoute(Q)}function A(){return e.getRoutes().map(ee=>ee.record)}function x(ee){return!!e.getRecordMatcher(ee)}function T(ee,Q){if(Q=assign({},Q||f.value),typeof ee=="string"){const K=parseURL(i,ee,Q.path),ne=e.resolve({path:K.path},Q),se=o.createHref(K.fullPath);return assign(K,ne,{params:b(ne.params),hash:decode(K.hash),redirectedFrom:void 0,href:se})}let ie;if(ee.path!=null)ie=assign({},ee,{path:parseURL(i,ee.path,Q.path).path});else{const K=assign({},ee.params);for(const ne in K)K[ne]==null&&delete K[ne];ie=assign({},ee,{params:y(K)}),Q.params=y(Q.params)}const le=e.resolve(ie,Q),ce=ee.hash||"";le.params=_(b(le.params));const z=stringifyURL(n,assign({},ee,{hash:encodeHash(ce),path:le.path})),W=o.createHref(z);return assign({fullPath:z,hash:ce,query:n===stringifyQuery?normalizeQuery(ee.query):ee.query||{}},le,{redirectedFrom:void 0,href:W})}function C(ee){return typeof ee=="string"?parseURL(i,ee,f.value.path):assign({},ee)}function E(ee,Q){if(g!==ee)return createRouterError(8,{from:Q,to:ee})}function P(ee){return w(ee)}function L(ee){return P(assign(C(ee),{replace:!0}))}function R(ee){const Q=ee.matched[ee.matched.length-1];if(Q&&Q.redirect){const{redirect:ie}=Q;let le=typeof ie=="function"?ie(ee):ie;return typeof le=="string"&&(le=le.includes("?")||le.includes("#")?le=C(le):{path:le},le.params={}),assign({query:ee.query,hash:ee.hash,params:le.path!=null?{}:ee.params},le)}}function w(ee,Q){const ie=g=T(ee),le=f.value,ce=ee.state,z=ee.force,W=ee.replace===!0,K=R(ie);if(K)return w(assign(C(K),{state:typeof K=="object"?assign({},ce,K.state):ce,force:z,replace:W}),Q||ie);const ne=ie;ne.redirectedFrom=Q;let se;return!z&&isSameRouteLocation(n,le,ie)&&(se=createRouterError(16,{to:ne,from:le}),te(le,le,!0,!1)),(se?Promise.resolve(se):O(ne,le)).catch(ae=>isNavigationFailure(ae)?isNavigationFailure(ae,2)?ae:q(ae):Y(ae,ne,le)).then(ae=>{if(ae){if(isNavigationFailure(ae,2))return w(assign({replace:W},C(ae.to),{state:typeof ae.to=="object"?assign({},ce,ae.to.state):ce,force:z}),Q||ne)}else ae=N(ne,le,!0,W,ce);return B(ne,le,ae),ae})}function D(ee,Q){const ie=E(ee,Q);return ie?Promise.reject(ie):Promise.resolve()}function I(ee){const Q=fe.values().next().value;return Q&&typeof Q.runWithContext=="function"?Q.runWithContext(ee):ee()}function O(ee,Q){let ie;const[le,ce,z]=extractChangingRecords(ee,Q);ie=extractComponentsGuards(le.reverse(),"beforeRouteLeave",ee,Q);for(const K of le)K.leaveGuards.forEach(ne=>{ie.push(guardToPromiseFn(ne,ee,Q))});const W=D.bind(null,ee,Q);return ie.push(W),me(ie).then(()=>{ie=[];for(const K of l.list())ie.push(guardToPromiseFn(K,ee,Q));return ie.push(W),me(ie)}).then(()=>{ie=extractComponentsGuards(ce,"beforeRouteUpdate",ee,Q);for(const K of ce)K.updateGuards.forEach(ne=>{ie.push(guardToPromiseFn(ne,ee,Q))});return ie.push(W),me(ie)}).then(()=>{ie=[];for(const K of z)if(K.beforeEnter)if(isArray$1(K.beforeEnter))for(const ne of K.beforeEnter)ie.push(guardToPromiseFn(ne,ee,Q));else ie.push(guardToPromiseFn(K.beforeEnter,ee,Q));return ie.push(W),me(ie)}).then(()=>(ee.matched.forEach(K=>K.enterCallbacks={}),ie=extractComponentsGuards(z,"beforeRouteEnter",ee,Q,I),ie.push(W),me(ie))).then(()=>{ie=[];for(const K of u.list())ie.push(guardToPromiseFn(K,ee,Q));return ie.push(W),me(ie)}).catch(K=>isNavigationFailure(K,8)?K:Promise.reject(K))}function B(ee,Q,ie){d.list().forEach(le=>I(()=>le(ee,Q,ie)))}function N(ee,Q,ie,le,ce){const z=E(ee,Q);if(z)return z;const W=Q===START_LOCATION_NORMALIZED,K=isBrowser$1?history.state:{};ie&&(le||W?o.replace(ee.fullPath,assign({scroll:W&&K&&K.scroll},ce)):o.push(ee.fullPath,ce)),f.value=ee,te(ee,Q,ie,W),q()}let $;function H(){$||($=o.listen((ee,Q,ie)=>{if(!pe.listening)return;const le=T(ee),ce=R(le);if(ce){w(assign(ce,{replace:!0,force:!0}),le).catch(noop$1);return}g=le;const z=f.value;isBrowser$1&&saveScrollPosition(getScrollKey(z.fullPath,ie.delta),computeScrollPosition()),O(le,z).catch(W=>isNavigationFailure(W,12)?W:isNavigationFailure(W,2)?(w(assign(C(W.to),{force:!0}),le).then(K=>{isNavigationFailure(K,20)&&!ie.delta&&ie.type===NavigationType.pop&&o.go(-1,!1)}).catch(noop$1),Promise.reject()):(ie.delta&&o.go(-ie.delta,!1),Y(W,le,z))).then(W=>{W=W||N(le,z,!1),W&&(ie.delta&&!isNavigationFailure(W,8)?o.go(-ie.delta,!1):ie.type===NavigationType.pop&&isNavigationFailure(W,20)&&o.go(-1,!1)),B(le,z,W)}).catch(noop$1)}))}let F=useCallbacks(),V=useCallbacks(),G;function Y(ee,Q,ie){q(ee);const le=V.list();return le.length?le.forEach(ce=>ce(ee,Q,ie)):console.error(ee),Promise.reject(ee)}function J(){return G&&f.value!==START_LOCATION_NORMALIZED?Promise.resolve():new Promise((ee,Q)=>{F.add([ee,Q])})}function q(ee){return G||(G=!ee,H(),F.list().forEach(([Q,ie])=>ee?ie(ee):Q()),F.reset()),ee}function te(ee,Q,ie,le){const{scrollBehavior:ce}=r;if(!isBrowser$1||!ce)return Promise.resolve();const z=!ie&&getSavedScrollPosition(getScrollKey(ee.fullPath,0))||(le||!ie)&&history.state&&history.state.scroll||null;return nextTick().then(()=>ce(ee,Q,z)).then(W=>W&&scrollToPosition(W)).catch(W=>Y(W,ee,Q))}const de=ee=>o.go(ee);let he;const fe=new Set,pe={currentRoute:f,listening:!0,addRoute:S,removeRoute:v,clearRoutes:e.clearRoutes,hasRoute:x,getRoutes:A,resolve:T,options:r,push:P,replace:L,go:de,back:()=>de(-1),forward:()=>de(1),beforeEach:l.add,beforeResolve:u.add,afterEach:d.add,onError:V.add,isReady:J,install(ee){const Q=this;ee.component("RouterLink",RouterLink),ee.component("RouterView",RouterView),ee.config.globalProperties.$router=Q,Object.defineProperty(ee.config.globalProperties,"$route",{enumerable:!0,get:()=>unref(f)}),isBrowser$1&&!he&&f.value===START_LOCATION_NORMALIZED&&(he=!0,P(o.location).catch(ce=>{}));const ie={};for(const ce in START_LOCATION_NORMALIZED)Object.defineProperty(ie,ce,{get:()=>f.value[ce],enumerable:!0});ee.provide(routerKey,Q),ee.provide(routeLocationKey,shallowReactive(ie)),ee.provide(routerViewLocationKey,f);const le=ee.unmount;fe.add(ee),ee.unmount=function(){fe.delete(ee),fe.size<1&&(g=START_LOCATION_NORMALIZED,$&&$(),$=null,f.value=START_LOCATION_NORMALIZED,he=!1,G=!1),le()}}};function me(ee){return ee.reduce((Q,ie)=>Q.then(()=>I(ie)),Promise.resolve())}return pe}function extractChangingRecords(r,e){const i=[],n=[],o=[],l=Math.max(e.matched.length,r.matched.length);for(let u=0;u<l;u++){const d=e.matched[u];d&&(r.matched.find(g=>isSameRouteRecord(g,d))?n.push(d):i.push(d));const f=r.matched[u];f&&(e.matched.find(g=>isSameRouteRecord(g,f))||o.push(f))}return[i,n,o]}function useRouter(){return inject$1(routerKey)}const _hoisted_1$6={class:"header"},_hoisted_2$6={class:"logo"},_hoisted_3$6={class:"nav"},_sfc_main$8={__name:"Header",setup(r){const e=useRouter(),i=()=>{e.push("/")},{t:n,locale:o}=useI18n();return(l,u)=>{const d=resolveComponent("router-link");return openBlock(),createElementBlock("header",_hoisted_1$6,[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("img",{onClick:i,src:_imports_0$4,alt:"Logo"}),createBaseVNode("h3",{onClick:i},toDisplayString$1(l.$t("honetitle3")),1)]),createBaseVNode("nav",_hoisted_3$6,[createVNode(d,{to:"/service"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(l.$t("nav3")),1)]),_:1}),createVNode(d,{to:"/about"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(l.$t("nav2")),1)]),_:1}),createVNode(d,{to:"/choose"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(l.$t("nav4")),1)]),_:1}),createVNode(d,{to:"/manager"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(l.$t("nav5")),1)]),_:1})]),createVNode(LoginButton,{class:"vbvbaaa"})])}}},Header=_export_sfc(_sfc_main$8,[["__scopeId","data-v-e0a5396c"]]),_hoisted_1$5={class:"footer"},_hoisted_2$5={class:"ftitle"},_hoisted_3$5={class:"nav"},_sfc_main$7={__name:"footer",setup(r){const{t:e,locale:i}=useI18n();return(n,o)=>{const l=resolveComponent("router-link");return openBlock(),createElementBlock("footer",_hoisted_1$5,[createBaseVNode("div",_hoisted_2$5,"  2025"+toDisplayString$1(n.$t("honetitle3")),1),createBaseVNode("nav",_hoisted_3$5,[createVNode(l,{to:"/"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(n.$t("nav1")),1)]),_:1}),createVNode(l,{to:"/about"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(n.$t("nav2")),1)]),_:1}),createVNode(l,{to:"/service"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(n.$t("nav3")),1)]),_:1}),createVNode(l,{to:"/choose"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(n.$t("nav4")),1)]),_:1}),createVNode(l,{to:"/manager"},{default:withCtx(()=>[createTextVNode(toDisplayString$1(n.$t("nav5")),1)]),_:1})])])}}},Footer=_export_sfc(_sfc_main$7,[["__scopeId","data-v-1193e40f"]]),_sfc_main$6={__name:"App",setup(r){return(e,i)=>{const n=resolveComponent("router-view");return openBlock(),createElementBlock("div",null,[createVNode(Header,{class:"headerbox"}),createVNode(n),createVNode(Footer,{class:"Footerbox"})])}}},_imports_0$3="data:image/svg+xml,%3csvg%20data-v-7a837531=''%20viewBox='0%200%201024%201024'%20class='icon'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20fill='%23000000'%20winth='30'%20height='30'%3e%3cg%20data-v-7a837531=''%20id='SVGRepo_bgCarrier'%20stroke-width='0'%3e%3c/g%3e%3cg%20data-v-7a837531=''%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3c/g%3e%3cg%20data-v-7a837531=''%20id='SVGRepo_iconCarrier'%3e%3cpath%20data-v-7a837531=''%20d='M512%20192m-128%200a128%20128%200%201%200%20256%200%20128%20128%200%201%200-256%200Z'%20fill='%23fff'%3e%3c/path%3e%3cpath%20data-v-7a837531=''%20d='M110.021808%20743.473457a128%20128%200%201%200%20221.702503-128%20128%20128%200%201%200-221.702503%20128Z'%20fill='%23fff'%3e%3c/path%3e%3cpath%20data-v-7a837531=''%20d='M739.582127%20791.504295a128%20128%200%201%200%20128-221.702504%20128%20128%200%201%200-128%20221.702504Z'%20fill='%23fff'%3e%3c/path%3e%3cpath%20data-v-7a837531=''%20d='M181.7%20509.3c-4.2%200-8.4-0.4-12.7-1.3-34.7-7-57.1-40.7-50.2-75.3%209.1-45.2%2025.4-87.6%2048.6-125.8%2022.9-37.7%2051.9-70.7%2086.3-98.1%2034.3-27.3%2073.2-48.5%20115.6-62.9C412.2%20131.4%20457.8%20124%20505%20124c35.3%200%2064%2028.7%2064%2064s-28.7%2064-64%2064c-133.2%200-235.5%2080.8-260.7%20205.9-6.1%2030.4-32.8%2051.4-62.6%2051.4zM512%20913c-71.5%200-140.8-18.3-200.5-53.1-58.2-33.8-107.2-83.2-141.9-142.8-17.8-30.6-7.4-69.7%2023.1-87.5%2030.6-17.8%2069.7-7.4%2087.5%2023.1C329.2%20736.8%20413.6%20785%20512%20785c27.7%200%2054.9-4.1%2081-12.2%2033.8-10.5%2069.6%208.4%2080.1%2042.2%2010.5%2033.8-8.4%2069.6-42.2%2080.1C592.5%20907%20552.5%20913%20512%20913zM807.9%20738c-10.9%200-21.9-2.8-32-8.6-30.6-17.7-41-56.9-23.3-87.5C775%20603.3%20785%20563.2%20785%20512c0-72.9-28.4-141.5-80-193-25-25-25-65.5%200-90.5s65.5-25%2090.5%200c36.8%2036.8%2065.7%2079.7%2085.9%20127.4%2020.9%2049.5%2031.5%20102%2031.5%20156.1%200%2074-15.8%20135.7-49.6%20194.1-11.8%2020.5-33.3%2031.9-55.4%2031.9z'%20fill='%23fff'%3e%3c/path%3e%3c/g%3e%3c/svg%3e",_imports_1$1="data:image/svg+xml,%3csvg%20data-v-7a837531=''%20winth='30'%20height='30'%20viewBox='0%200%201024%201024'%20class='icon'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20fill='%23000000'%20stroke='%23000000'%3e%3cg%20data-v-7a837531=''%20id='SVGRepo_bgCarrier'%20stroke-width='0'%3e%3c/g%3e%3cg%20data-v-7a837531=''%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3c/g%3e%3cg%20data-v-7a837531=''%20id='SVGRepo_iconCarrier'%3e%3cpath%20data-v-7a837531=''%20d='M523.9%20788.3H166.4V169c0-4.3%203.4-7.7%207.6-7.7h490.8c4.2%200%207.6%203.5%207.6%207.7v190h45.8V169c0-29.9-24-54.2-53.4-54.2H174c-29.5%200-53.4%2024.3-53.4%2054.2v689c0%2029.9%2024%2054.2%2053.4%2054.2h359.1c-5.9-11.6-9.3-24.8-9.3-38.7v-85.2z%20m-102.6%2096.2c-17%200-30.9-14-30.9-31.3s13.8-31.3%2030.9-31.3c17%200%2030.9%2014%2030.9%2031.3-0.1%2017.3-13.9%2031.3-30.9%2031.3z%20m442.9-479H607.9c-21.1%200-38.2%2017.4-38.2%2038.7v429.3c0%2021.3%2017.1%2038.7%2038.2%2038.7h256.3c21.1%200%2038.2-17.4%2038.2-38.7V444.2c0-21.4-17.1-38.7-38.2-38.7zM736.1%20888.9c-12.7%200-22.9-10.4-22.9-23.2%200-12.8%2010.3-23.2%2022.9-23.2%2012.6%200%2022.9%2010.4%2022.9%2023.2%200%2012.8-10.3%2023.2-22.9%2023.2z%20m120.5-69.7H615.5V451.9h241.1v367.3z'%20fill='%23FFF'%3e%3c/path%3e%3c/g%3e%3c/svg%3e",_imports_2$1="data:image/svg+xml,%3csvg%20width='30'%20height='30'%20viewBox='0%200%2024%2024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20fill='%23000000'%20data-v-7a837531=''%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'%20data-v-7a837531=''%3e%3c/g%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/g%3e%3cg%20id='SVGRepo_iconCarrier'%20data-v-7a837531=''%3e%3ctitle%20data-v-7a837531=''%3e/svg/ic-shuffle%3c/title%3e%3cdesc%20data-v-7a837531=''%3eCreated%20with%20Sketch.%3c/desc%3e%3cdefs%20data-v-7a837531=''%3e%3c/defs%3e%3cg%20id='Page-1'%20stroke='none'%20stroke-width='1'%20fill='none'%20fill-rule='evenodd'%20data-v-7a837531=''%3e%3cg%20id='ic-shuffle'%20stroke='%23ffffff'%20stroke-width='2'%20data-v-7a837531=''%3e%3cpath%20d='M2,17.9999998%20C2,19.1082887%202.89479504,19.9999998%204.0093689,19.9999998%20L5.9906311,19.9999998%20C6.8646376,19.9999998%207.8774291,19.4961382%208.39914483,18.7962726%20L10.5549209,15.9043651%20L11.0034256,15.3027099%20L10.5510882,14.7039309%20L9.28791415,13.0318115%20L8.48166843,11.9645484%20L7.68611114,13.0398025%20L5.78620656,15.607663%20C5.64814673,15.794261%205.23905036,15.9999998%205.00104344,15.9999998%20L3.99895656,15.9999998%20C2.8939935,15.9999998%202,16.8925469%202,17.9999998%20Z%20M17,7.99999982%20L17,9.00104326%20C17,10.4426117%2018.3902669,11.0239464%2019.4130188,10.0011945%20L22.0011947,7.41301865%20C22.7819993,6.6322141%2022.7833444,5.36913063%2022.0011947,4.58698098%20L19.4130188,1.99880509%20C18.393426,0.979212222%2017,1.5514083%2017,2.99895638%20L17,3.99999982%20L15.9989566,3.99999982%20C15.1354804,3.99999982%2014.1173241,4.51067434%2013.6048397,5.19673291%20L11.4612982,8.06627426%20L11.0137506,8.66540254%20L11.4619396,9.26405117%20L12.6968029,10.9134652%20L13.4938682,11.97811%20L14.2953367,10.916776%20L16.1921918,8.40489069%20C16.3390468,8.2104199%2016.7595316,7.99999982%2017,7.99999982%20Z%20M17.0007853,20%20C17.0004763,20.0002262%2017,20.0014156%2017,20.0066442%20L17,21.4736462%20C17,22.9303154%2018.4207045,23.510591%2019.4064778,22.4064533%20L22.0854405,19.4058206%20C22.8003941,18.6050206%2022.7640332,17.3498197%2022.0011947,16.5869812%20L19.4130188,13.9988053%20C18.3902669,12.9760534%2017,13.5573881%2017,14.9989566%20L17,16%20C16.760894,16%2016.3418715,15.789162%2016.1955096,15.5940128%20L8.40449038,5.20598718%20C7.88075638,4.50767518%206.86328205,4%205.9906311,4%20L4.0093689,4%20C2.89479504,4%202,4.89171112%202,6%20C2,7.1074529%202.8939935,8%203.99895656,8%20L5.00104344,8%20C5.23990997,8%205.65788701,8.21051601%205.80449038,8.40598718%20L13.5955096,18.7940128%20C14.1186685,19.4915579%2015.1311017,20%2015.9989566,20%20L17.0004762,20%20L17.0007853,20%20Z'%20id='Combined-Shape'%20data-v-7a837531=''%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",_imports_3$1="data:image/svg+xml,%3csvg%20width='30'%20height='30'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20data-v-7a837531=''%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'%20data-v-7a837531=''%3e%3c/g%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/g%3e%3cg%20id='SVGRepo_iconCarrier'%20data-v-7a837531=''%3e%3cpath%20d='M5%2019V6.2C5%205.0799%205%204.51984%205.21799%204.09202C5.40973%203.71569%205.71569%203.40973%206.09202%203.21799C6.51984%203%207.0799%203%208.2%203H15.8C16.9201%203%2017.4802%203%2017.908%203.21799C18.2843%203.40973%2018.5903%203.71569%2018.782%204.09202C19%204.51984%2019%205.0799%2019%206.2V17H7C5.89543%2017%205%2017.8954%205%2019ZM5%2019C5%2020.1046%205.89543%2021%207%2021H19M18%2017V21M14.5%208V7.91667C14.5%206.85812%2013.6419%206%2012.5833%206H11.5C10.3954%206%209.5%206.89543%209.5%208C9.5%209.10457%2010.3954%2010%2011.5%2010H12.5C13.6046%2010%2014.5%2010.8954%2014.5%2012C14.5%2013.1046%2013.6046%2014%2012.5%2014H11.4583C10.3768%2014%209.5%2013.1232%209.5%2012.0417V12'%20stroke='%23ffffff'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3c/g%3e%3c/svg%3e",_imports_4$1="data:image/svg+xml,%3csvg%20width='30'%20height='30'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20data-v-7a837531=''%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'%20data-v-7a837531=''%3e%3c/g%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/g%3e%3cg%20id='SVGRepo_iconCarrier'%20data-v-7a837531=''%3e%3cpath%20opacity='0.4'%20d='M22%2015C22%2018.87%2018.87%2022%2015%2022L16.05%2020.25'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3cpath%20opacity='0.4'%20d='M2%209C2%205.13%205.13%202%209%202L7.95%203.75'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3cpath%20d='M13.6992%204.4502L17.6792%206.75018L21.6192%204.46021'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3cpath%20d='M17.6797%2010.8203V6.74023'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3cpath%20d='M16.7396%202.21L14.3396%203.53996C13.7996%203.83996%2013.3496%204.59995%2013.3496%205.21995V7.75999C13.3496%208.37999%2013.7896%209.13998%2014.3396%209.43998L16.7396%2010.77C17.2496%2011.06%2018.0896%2011.06%2018.6096%2010.77L21.0096%209.43998C21.5496%209.13998%2021.9996%208.37999%2021.9996%207.75999V5.21995C21.9996%204.59995%2021.5596%203.83996%2021.0096%203.53996L18.6096%202.21C18.0996%201.93%2017.2596%201.93%2016.7396%202.21Z'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3cpath%20d='M2.34961%2015.4502L6.31961%2017.7502L10.2696%2015.4602'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3cpath%20d='M6.32031%2021.8203V17.7402'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3cpath%20d='M5.39%2013.21L2.99001%2014.54C2.45001%2014.84%202%2015.5999%202%2016.2199V18.76C2%2019.38%202.44001%2020.14%202.99001%2020.44L5.39%2021.77C5.9%2022.06%206.73999%2022.06%207.25999%2021.77L9.66%2020.44C10.2%2020.14%2010.65%2019.38%2010.65%2018.76V16.2199C10.65%2015.5999%2010.21%2014.84%209.66%2014.54L7.25999%2013.21C6.73999%2012.93%205.9%2012.93%205.39%2013.21Z'%20stroke='%23ffffff'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'%20data-v-7a837531=''%3e%3c/path%3e%3c/g%3e%3c/svg%3e",_imports_5$1=""+new URL("ppt1-B8SdpJ29.png",import.meta.url).href,_imports_6$1=""+new URL("ppt3-DY0u58L8.png",import.meta.url).href,_imports_7$1=""+new URL("ppt4-CvX_T-YM.png",import.meta.url).href,_imports_8=""+new URL("ppt5-BFZVpvBE.png",import.meta.url).href,_imports_9=""+new URL("ppt6-BycnUmQg.png",import.meta.url).href,_imports_10=""+new URL("ppt2-ARB35sc2.png",import.meta.url).href,_hoisted_1$4={class:"banner_1"},_hoisted_2$4={class:"title_1"},_hoisted_3$4={class:"txt_1"},_hoisted_4$3={class:"txt_2"},_hoisted_5$3={class:"txt_3"},_hoisted_6$2={class:"banner_2"},_hoisted_7$2={class:"b2b"},_hoisted_8$2={class:"b5dom"},_hoisted_9$2={class:"b5dom"},_hoisted_10$2={class:"b5dom"},_hoisted_11$2={class:"b5dom"},_hoisted_12$2={class:"b5dom"},_sfc_main$5={__name:"Home",setup(r){const{t:e,locale:i}=useI18n();return(n,o)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$4,[createBaseVNode("div",_hoisted_2$4,[createBaseVNode("div",_hoisted_3$4,toDisplayString$1(n.$t("honetitle1")),1),createBaseVNode("div",_hoisted_4$3,toDisplayString$1(n.$t("honetitle2")),1),createBaseVNode("div",_hoisted_5$3,toDisplayString$1(n.$t("honetitle3")),1)])]),createBaseVNode("div",_hoisted_6$2,[o[9]||(o[9]=createBaseVNode("div",{class:"b2t"},[createBaseVNode("div",{class:"tt1"}," 10  + "),createBaseVNode("div",{class:"tt2"},"")],-1)),createBaseVNode("div",_hoisted_7$2,[createBaseVNode("div",_hoisted_8$2,[o[0]||(o[0]=createBaseVNode("div",{class:"fdfdfzz"},[createBaseVNode("img",{src:_imports_0$3,alt:""})],-1)),createBaseVNode("span",null,toDisplayString$1(n.$t("tb1")),1)]),createBaseVNode("div",_hoisted_9$2,[o[1]||(o[1]=createBaseVNode("div",{class:"fdfdfzz"},[createBaseVNode("img",{src:_imports_1$1,alt:""})],-1)),o[2]||(o[2]=createTextVNode()),createBaseVNode("span",null,toDisplayString$1(n.$t("tb2")),1)]),createBaseVNode("div",_hoisted_10$2,[o[3]||(o[3]=createBaseVNode("div",{class:"fdfdfzz"},[createBaseVNode("img",{src:_imports_2$1,alt:""})],-1)),o[4]||(o[4]=createTextVNode()),createBaseVNode("span",null,toDisplayString$1(n.$t("tb3")),1)]),createBaseVNode("div",_hoisted_11$2,[o[5]||(o[5]=createBaseVNode("div",{class:"fdfdfzz"},[createBaseVNode("img",{src:_imports_3$1,alt:""})],-1)),o[6]||(o[6]=createTextVNode()),createBaseVNode("span",null,toDisplayString$1(n.$t("tb4")),1)]),createBaseVNode("div",_hoisted_12$2,[o[7]||(o[7]=createBaseVNode("div",{class:"fdfdfzz"},[createBaseVNode("img",{src:_imports_4$1,alt:""})],-1)),o[8]||(o[8]=createTextVNode()),createBaseVNode("span",null,toDisplayString$1(n.$t("tb5")),1)])]),o[10]||(o[10]=createBaseVNode("div",{class:"bppt"},[createBaseVNode("img",{src:_imports_5$1,alt:""})],-1))]),o[11]||(o[11]=createStaticVNode('<div class="banner_3" data-v-7380627a><div class="b3t" data-v-7380627a><div class="tt1" data-v-7380627a></div><div class="hzppt" data-v-7380627a><img src="'+_imports_6$1+'" alt="" data-v-7380627a><img src="'+_imports_7$1+'" alt="" data-v-7380627a><img src="'+_imports_8+'" alt="" data-v-7380627a><img src="'+_imports_9+'" alt="" data-v-7380627a></div><img src="'+_imports_10+'" alt="" data-v-7380627a></div></div>',1))],64))}},Home=_export_sfc(_sfc_main$5,[["__scopeId","data-v-7380627a"]]),_imports_0$2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIEAAACMCAYAAABbPsqOAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAMyElEQVR4nO2dy6slRx3HP7+6986MSSYzmcQQYjKjiJIEJAtFxI3gwo0gg3li0IWaxI0L3QiCf4ILxfiKAR+MRkxioguFiOBO8LGI+AAfmUkCUZK5N4+J8eae0z8X1X1Pnzpd3dXn9POc+kAzc7urq6urvudXv3q2qCqROST3f03/rptJUnBusBlt+k7AwHEFIMCfgReASe4469w32AIvQqIlmMP9Becz5ziwB0iiarKrIoIICbALvLlGfIMhWgI/boH9CzBJogadXVVVUlGcAq6riGOQbPedgAHh+gIupxJVAfvr99y/VXA+8yuyMIMTRrQEdVCvANKrfKDD1DRGFEFDqM1Lr0KGTBRBDUqsQMYo83OUiY40SxRBJIogpcu6fHB+Q50m4uASP2K6zsvSZmmVCGLBrwelfSC+6kCIAlhXFsq1yBKUFf7gersGhu9H1We+FZVndk5hXgS+wo8FP27cUVCcv9V4LmY3RwGsF0XlKduMbALEEMh3HDoj8WNocucHtIDiREcBlOD2HFf3JA+SuTIWTYdHiy5mYYCjwB+YjZefbCVpw6aqxaTOv33zEvAk8Dng3/jLdk4EbiADPAXcnN2gutnNxrJf/fAmaCkikuROnAPuB153Aoo5vGOee4AD4BZVTHpEAaxwvXuEWdmpwZbpJeBOJ6AWzTF8DDirIIMxbAMgpJCHZw0cBBX7g/87cFN22nUMHwHOqkYBrCWKqGKAdwA/zE7nLcENwIU0kL3obwptJOPyCcpJZ0hfC1zMi2AXOJnV/e4Lj+0lI+WItfUvAtdmv/rrgRM+AUTWj7SsrwauycYOvkzgqGGqoOz4aSspHC9JdZA56vQwhsT9IeBKQAIdewH+kVUHe6qzDqDCqkAg9SwfBe4ITHikHz4FPBgiBBFezkQwzTuEnsAK3As81FBCI+1ihVDRvyMy6ycIEcErwInm0rhxVHXPt8Gewsmyp4nMhpLLscn/VROp2jC2gIvAlPlVzBPg1g6efx8Bgqsz0fSJ5dOysfwPMImmi1hTxIgK/BE4ghVIW+yFBKrjnfoSK/EorHfvAtt3L0i6hN0ezOrpcw3mZxFBAhvDJIgxUGRyP1rmZ6XXbg+Mq00CfYLIkoyjm7WN/QnG8earEdin2ljXq3dCSBM0bQk2QQDQ7Xv6ntVYGmJ1EIkiWHOCyjeKIBJFEIkiiLBeW9i5TaZNaamszDqIwNde9q2niDiMWQShnSWbLIagmU5jFUHIIlo3jBSEiTBOxzBEAL5zcQptAWMTQagAyq5FITiMSQR1BVAWJgohx1hEsKwAysJGIaSMRQQubqHeDjybOx4Fbqu4J5IyhtZBVSfQAWAUZvP4hBvEfpLmZezHKPL35uOLLQb6tQQhc+Rc3AI7RzqPb+6KHk7fOgG8pSKOjacPEfgKveh81Vz9D1eslxDgqwXny7Z12zi6FEHoL76OZbii7OKm764SSlc+wbI9fJEO6MISrNLDF+mAtkXQRA9fpGXaFEGTPXyRFunSMVy1hy/SEm2JoKqD5/vYdXL5YwK8p+SeSEt00Too+tzsGVU1+c2w0pW6vwWuwW7Jmt3bRyth1bGKUdGGJSjr4DHAmcQRAIAmKun1F5x7usz8sj6KOv0Xo6LrsYPjgPdzs4mqGJEiYbYthDqFu3ZC6FoEN1KWiX0Z/0U2aui587GDEVSsrS8AHRq9jCIGfHO4L6oKei2F0KYIijJsyJNYQgt47YQwqELp0UL4fABfi2CthDAoEfSEW6BfwG72fRG7+9du+u/vKu4bLWOYXtYmbkG+G/jiwSQ5djBJdvLhLju2/U7gT8C7nPsH6+CEssmWoOiX/GSS6M5kmhwxRiQ7RDCv70+uYHGqmi+eUbHpliCPAOwfTI9tGYPJ/TySRJgmSd5HGH3B54kimMfYDSfnnVQRhTXuNt7k6sDHQiNluN0azRBFMI+3uM0aKyGKIBJ9Ah/5X/50zb8CFi1BJIogEqsDL8maVwF5oggKyPsDmyCFKIIC8h0FBR8UXzuiTxCJIohEEUQYmAg2of4dIm06hqMdcp0myZAnwzbOoCxBpB+6FsEoLcO604sliHX/sIjVQSBLdCPrWAxf0yIYvTdVZKXaMFy6ukAay+uuu40TsXkqqlowj6vhp9n46uR2AmiSIMbMbktFoDXjspMTPdvopSdfDYml1jOXoOvq4K/A4Wup6twhdkZn0dc6fJM8fyLi/7qH2Lge9sTnogDbW+ZgmiRMpso0PVSVY0e2/4tfCEXxPSyg7jvm3jUBfhkY17IM4ruI7gslwHkjksxZAQFjdypJgFtL4nDj+xigIiRKmsFpOaXiSIBHPPEVZfaXdrbN68eObL82zaYTCWxvm6kIB8B1Je/oxvc4oMZIIs4bGCMJVkz3lLxrE3QmAq04XN4O3CZCYozYw/4qpsDVwF8q4nevHQEuGJnFJSJT4EfADouUpe1rwE0ivHH5m7ZfOnpka//oztb+lpEJ8BXgjZrxbQPnJEvb7F1303S7VqwqL+vkM8CW5/wckjpC09I9ggUEHmNx+/jIsLlT4WGfXwIggoaJwAaeEucfjI2XFE6UubMi6GHBBzRZDHBHI0mLdMEtwJUh7ZlDEVR5JGqD/Bj4xCopi3TCp7ErqAHSZXWzwyWrDr4LfLyqSkh9g8wReQX4RUGooA8yrkjfPZ1dvGMRvvfOHMD3A9cDoiB2l7jFwIedX7Y8n89EcAXwcqUIFqOrF7xR+uycHGJ3cHF+lIlABAXulFw36QSQ+kKIDBlXBI4VSICtvLd/EvvhqFFRNfdjbuvcBozHmAdA5/LCmrO7YL6OuQT8oKwbdmiEFGoWpqmJQmObcKQ6OzLSauBx0t5UKRg1OwfcrflPzA2U0AJRj4O0LKO1BjPH/jngdHbasOhR3APcLZBkffKR8SNCNjbzSXICAGsJMhEU7Uj+H9KPS6bDvyIDmjIQLcEMdSp8ABFRmZXrI9gBt6lzq+RFAP5dSN+HrSZOF1zvCymakuCSCqCxreZy8Q1QCgs8B3we+9ngIgTmLUHG0F9uDziRffOwTAROgTXW9M3F+yjj7Uo/zLmijBmOvV9kl+UE8EHSaYI+U57NHgr5BYidHiXYUdUL4ckfDHM5ZxjP3v4XgZNVAsgKOhVAgu3/+E1ZxLmS/7XUF8KNwPmAW4bCQs5llsAnhKGIYQJcFSKA9HpeAAvz+PJtZ6fEXwXuXUIIpxm+ELybdeerg7L5c30K4gD7ZfQ6Aphiv5h+qeazJsBDwP1rJARv4ZPNq/Rc9BV420Jw8/0A2FpCACeB15Z4fvaEB4Etga+HtC4zIYhwGusjnPHEOxTm8tnnMffRBOpbAC7fBD67pI/gOotDaXEVlmtVs6lqImNT5OM3LC+AozQjgIwHqCGENE2ZEC66lxpMV11Ky7DOnMEmXsI73z/FAPssJ4BjtDPZ4wFgIvCNqqohtQZZ1XAV8CL2Y5+HyaY6Dzqny7kDbQvA7Q5tkm8Bn8ksQplZyNKcvsMprFXLM7gmeVciqBLA5TQnAG+GrjgY9m3gPgEVsV31PjE4Qthi4ELoQgRVArgM+23kVgXQEN/BzuLVNA1rIYSul6HB/Msfx85mGoMAMv4G3ECAEDKGLoQ2RRAigF3GIQA3/uexS9ySMiHk32fIQmhLBG0K4Cj9WAD3OQnpesKxC6ENEbQpgB3mm4Fdm86lhJBniELoYqcSVwB71BfAHosrjNvIoKDOQefvVYQwYb4MehFCkyIIFUDdwaA97JL1qmd1SZAQcsPaC0vA0jww2OXuvQqhKRGEVgFtCaCPHjd3dG5BCIU3FQthnx6F0IQIqgrlZparAp6hewEsE1cTQtiiRyGsKoKqQrkFuzq2rgV4BnhrzWdVkZppX+8OCvw8NJ6Fu2ck2DGZZXyEfSeuTixc046hK4Cn6E4A+b+Lwp9Pt4pZ3EjKbuWhFO8mVlQoIb/SZYSQjaCWWYTGrUHRCqTge52/8xFdCeyqXcV0GC5gheyqFqAsTYLNYElUTTaeJ5DtJKYsjqqWxReatrlh8SrSZYBVaWnUQjRlCdxE/RNHAIU3NV8FlBWSYuvrp43I1BiZGpFpusnV96gvAN85974dYFrmI+RJ9HDK3/GSZzVqDZa1BFWqnCaqxl2t5DhE2bmmfYAmnMe6cTRmEVQVY0SB9wK/L3lOY9agvbGDgiS6M3xTATxLs07gql71Ms9u1CJ03d5tTwQV2Z5mxs8Im5RZN1+WFULb4gsSgnSsg9aqA7WNrsKMzwngbEm8ZfGHsopTueyzQ+J5GjjjVg2qisx2dt0puG9Q1UGVk/IRyY23HwaUw3NP0L4AfPcXPafJZ4c8823ABZGsCamAZlv7KjZvOhEAwP8BLx8Z2JkRoKgAAAAASUVORK5CYII=",_imports_0$1=""+new URL("of2-K8oP6cAL.jpg",import.meta.url).href,_imports_1=""+new URL("office1-BCig7Gvm.webp",import.meta.url).href,_imports_2=""+new URL("of3-CsdFTyUd.jpg",import.meta.url).href,_hoisted_1$3={class:"about_banner_1"},_hoisted_2$3={class:"about_title_1"},_hoisted_3$3={class:"txt_3 animated-text"},_hoisted_4$2={class:"txt_2 animated-text"},_hoisted_5$2={class:"about_title_2"},_hoisted_6$1={class:"rightbox"},_hoisted_7$1={class:"rb_2"},_hoisted_8$1={class:"rbtxt_1 animated-number"},_hoisted_9$1={class:"rbtxt_2"},_hoisted_10$1={class:"rightbox"},_hoisted_11$1={class:"rb_2"},_hoisted_12$1={class:"rbtxt_1 animated-number"},_hoisted_13$1={class:"rbtxt_2"},_hoisted_14$1={class:"rightbox"},_hoisted_15$1={class:"rb_2"},_hoisted_16$1={class:"rbtxt_1 animated-number"},_hoisted_17$1={class:"rbtxt_2"},_hoisted_18$1={class:"rightbox"},_hoisted_19$1={class:"rb_2"},_hoisted_20$1={class:"rbtxt_1 animated-number"},_hoisted_21$1={class:"rbtxt_2"},_hoisted_22$1={class:"about_banner_2"},_hoisted_23$1={class:"abbbox"},_hoisted_24$1={class:"abb_1"},_hoisted_25$1={class:"abb_1txt1"},_hoisted_26$1={class:"abb_1txt2"},_hoisted_27$1={class:"abbbox"},_hoisted_28$1={class:"abb_1"},_hoisted_29$1={class:"abb_1txt1"},_hoisted_30$1={class:"abb_1txt2"},_hoisted_31$1={class:"abbbox"},_hoisted_32$1={class:"abb_1"},_hoisted_33$1={class:"abb_1txt1"},_hoisted_34$1={class:"abb_1txt2"},_sfc_main$4={__name:"About",setup(r){const{t:e,locale:i}=useI18n(),n=ref([{value:1,target:1e4,isCompleted:!1,interval:10,steps:100},{value:1,target:50,isCompleted:!1,interval:70,steps:10},{value:1,target:1e5,isCompleted:!1,interval:10,steps:100},{value:1,target:10,isCompleted:!1,interval:100,steps:10}]);return onMounted(()=>{n.value.forEach(o=>{let l=o.target/o.steps,u=setInterval(()=>{o.value<o.target?o.value=Math.min(o.value+l,o.target):(clearInterval(u),o.isCompleted=!0)},o.interval)})}),(o,l)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,toDisplayString$1(o.$t("honetitle3")),1),createBaseVNode("div",_hoisted_4$2,toDisplayString$1(o.$t("about_t1")),1)]),createBaseVNode("div",_hoisted_5$2,[createBaseVNode("div",_hoisted_6$1,[l[0]||(l[0]=createBaseVNode("div",{class:"rb_1"},[createBaseVNode("img",{src:_imports_0$2,alt:""})],-1)),createBaseVNode("div",_hoisted_7$1,[createBaseVNode("div",_hoisted_8$1,toDisplayString$1(n.value[0].value)+toDisplayString$1(n.value[0].isCompleted?"+":""),1),createBaseVNode("div",_hoisted_9$1,toDisplayString$1(o.$t("ppt1")),1)])]),createBaseVNode("div",_hoisted_10$1,[l[1]||(l[1]=createBaseVNode("div",{class:"rb_1"},[createBaseVNode("img",{src:_imports_0$2,alt:""})],-1)),createBaseVNode("div",_hoisted_11$1,[createBaseVNode("div",_hoisted_12$1,toDisplayString$1(n.value[1].value)+toDisplayString$1(n.value[1].isCompleted?"+":""),1),createBaseVNode("div",_hoisted_13$1,toDisplayString$1(o.$t("ppt2")),1)])]),createBaseVNode("div",_hoisted_14$1,[l[2]||(l[2]=createBaseVNode("div",{class:"rb_1"},[createBaseVNode("img",{src:_imports_0$2,alt:""})],-1)),createBaseVNode("div",_hoisted_15$1,[createBaseVNode("div",_hoisted_16$1,toDisplayString$1(n.value[2].value)+toDisplayString$1(n.value[2].isCompleted?"+":""),1),createBaseVNode("div",_hoisted_17$1,toDisplayString$1(o.$t("ppt3")),1)])]),createBaseVNode("div",_hoisted_18$1,[l[3]||(l[3]=createBaseVNode("div",{class:"rb_1"},[createBaseVNode("img",{src:_imports_0$2,alt:""})],-1)),createBaseVNode("div",_hoisted_19$1,[createBaseVNode("div",_hoisted_20$1,toDisplayString$1(n.value[3].value)+toDisplayString$1(n.value[3].isCompleted?"years+":""),1),createBaseVNode("div",_hoisted_21$1,toDisplayString$1(o.$t("ppt4")),1)])])])]),createBaseVNode("div",_hoisted_22$1,[createBaseVNode("h2",null,toDisplayString$1(o.$t("about_Us")),1),createBaseVNode("div",_hoisted_23$1,[createBaseVNode("div",_hoisted_24$1,[createBaseVNode("div",_hoisted_25$1,toDisplayString$1(o.$t("abouttitle1")),1),createBaseVNode("div",_hoisted_26$1,toDisplayString$1(o.$t("abouttitle2")),1)]),l[4]||(l[4]=createBaseVNode("div",{class:"abb_2"},[createBaseVNode("img",{src:_imports_0$1,alt:""})],-1))]),createBaseVNode("div",_hoisted_27$1,[l[5]||(l[5]=createBaseVNode("div",{class:"abb_2"},[createBaseVNode("img",{src:_imports_1,alt:""})],-1)),createBaseVNode("div",_hoisted_28$1,[createBaseVNode("div",_hoisted_29$1,toDisplayString$1(o.$t("abouttitle3")),1),createBaseVNode("div",_hoisted_30$1,toDisplayString$1(o.$t("abouttitle4")),1)])]),createBaseVNode("div",_hoisted_31$1,[createBaseVNode("div",_hoisted_32$1,[createBaseVNode("div",_hoisted_33$1,toDisplayString$1(o.$t("abouttitle5")),1),createBaseVNode("div",_hoisted_34$1,toDisplayString$1(o.$t("abouttitle6")),1)]),l[6]||(l[6]=createBaseVNode("div",{class:"abb_2"},[createBaseVNode("img",{src:_imports_2,alt:""})],-1))])])],64))}},About=_export_sfc(_sfc_main$4,[["__scopeId","data-v-f53fd7de"]]),_hoisted_1$2={class:"banner_1"},_hoisted_2$2={class:"title_1"},_hoisted_3$2={class:"txt_1"},_hoisted_4$1={class:"txt_2"},_hoisted_5$1={class:"txt_3"},_sfc_main$3={__name:"Choose",setup(r){const{t:e,locale:i}=useI18n();return(n,o)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,toDisplayString$1(n.$t("touyzi1")),1),createBaseVNode("div",_hoisted_4$1,toDisplayString$1(n.$t("touyzi2")),1),createBaseVNode("div",_hoisted_5$1,toDisplayString$1(n.$t("honetitle3")),1)])]))}},Choose=_export_sfc(_sfc_main$3,[["__scopeId","data-v-ef3c7a6c"]]),_imports_3=""+new URL("d1-B9DwKaB4.png",import.meta.url).href,_imports_4=""+new URL("d2-CRcvtxv8.png",import.meta.url).href,_imports_5=""+new URL("d3-Ko8GDPn_.png",import.meta.url).href,_imports_6=""+new URL("d4-DEsKZAix.png",import.meta.url).href,_imports_7=""+new URL("d5-DzELU86R.png",import.meta.url).href,arrayParser=r=>r;var RenderModeEnum;(function(r){r["desktop-browser"]="desktop-browser",r["mobile-browser"]="mobile-browser",r.node="node",r.worker="worker",r.miniApp="miniApp",r.wx="wx",r.tt="tt",r.harmony="harmony",r["desktop-miniApp"]="desktop-miniApp",r.lynx="lynx"})(RenderModeEnum||(RenderModeEnum={}));var ComponentTypeEnum;(function(r){r.cartesianAxis="cartesianAxis",r.cartesianBandAxis="cartesianAxis-band",r.cartesianLinearAxis="cartesianAxis-linear",r.cartesianTimeAxis="cartesianAxis-time",r.cartesianLogAxis="cartesianAxis-log",r.cartesianSymlogAxis="cartesianAxis-symlog",r.polarAxis="polarAxis",r.polarBandAxis="polarAxis-band",r.polarLinearAxis="polarAxis-linear",r.crosshair="crosshair",r.cartesianCrosshair="cartesianCrosshair",r.polarCrosshair="polarCrosshair",r.dataZoom="dataZoom",r.geoCoordinate="geoCoordinate",r.indicator="indicator",r.discreteLegend="discreteLegend",r.continuousLegend="continuousLegend",r.colorLegend="colorLegend",r.sizeLegend="sizeLegend",r.mapLabel="mapLabel",r.markLine="markLine",r.markArea="markArea",r.markPoint="markPoint",r.polarMarkLine="polarMarkLine",r.polarMarkArea="polarMarkArea",r.polarMarkPoint="polarMarkPoint",r.geoMarkPoint="geoMarkPoint",r.tooltip="tooltip",r.title="title",r.player="player",r.scrollBar="scrollBar",r.label="label",r.totalLabel="totalLabel",r.brush="brush",r.poptip="poptip",r.customMark="customMark"})(ComponentTypeEnum||(ComponentTypeEnum={}));function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var eventemitter3={exports:{}},hasRequiredEventemitter3;function requireEventemitter3(){return hasRequiredEventemitter3||(hasRequiredEventemitter3=1,function(r){var e=Object.prototype.hasOwnProperty,i="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1));function o(f,g,_){this.fn=f,this.context=g,this.once=_||!1}function l(f,g,_,y,b){if(typeof _!="function")throw new TypeError("The listener must be a function");var S=new o(_,y||f,b),v=i?i+g:g;return f._events[v]?f._events[v].fn?f._events[v]=[f._events[v],S]:f._events[v].push(S):(f._events[v]=S,f._eventsCount++),f}function u(f,g){--f._eventsCount===0?f._events=new n:delete f._events[g]}function d(){this._events=new n,this._eventsCount=0}d.prototype.eventNames=function(){var g=[],_,y;if(this._eventsCount===0)return g;for(y in _=this._events)e.call(_,y)&&g.push(i?y.slice(1):y);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(_)):g},d.prototype.listeners=function(g){var _=i?i+g:g,y=this._events[_];if(!y)return[];if(y.fn)return[y.fn];for(var b=0,S=y.length,v=new Array(S);b<S;b++)v[b]=y[b].fn;return v},d.prototype.listenerCount=function(g){var _=i?i+g:g,y=this._events[_];return y?y.fn?1:y.length:0},d.prototype.emit=function(g,_,y,b,S,v){var A=i?i+g:g;if(!this._events[A])return!1;var x=this._events[A],T=arguments.length,C,E;if(x.fn){switch(x.once&&this.removeListener(g,x.fn,void 0,!0),T){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,_),!0;case 3:return x.fn.call(x.context,_,y),!0;case 4:return x.fn.call(x.context,_,y,b),!0;case 5:return x.fn.call(x.context,_,y,b,S),!0;case 6:return x.fn.call(x.context,_,y,b,S,v),!0}for(E=1,C=new Array(T-1);E<T;E++)C[E-1]=arguments[E];x.fn.apply(x.context,C)}else{var P=x.length,L;for(E=0;E<P;E++)switch(x[E].once&&this.removeListener(g,x[E].fn,void 0,!0),T){case 1:x[E].fn.call(x[E].context);break;case 2:x[E].fn.call(x[E].context,_);break;case 3:x[E].fn.call(x[E].context,_,y);break;case 4:x[E].fn.call(x[E].context,_,y,b);break;default:if(!C)for(L=1,C=new Array(T-1);L<T;L++)C[L-1]=arguments[L];x[E].fn.apply(x[E].context,C)}}return!0},d.prototype.on=function(g,_,y){return l(this,g,_,y,!1)},d.prototype.once=function(g,_,y){return l(this,g,_,y,!0)},d.prototype.removeListener=function(g,_,y,b){var S=i?i+g:g;if(!this._events[S])return this;if(!_)return u(this,S),this;var v=this._events[S];if(v.fn)v.fn===_&&(!b||v.once)&&(!y||v.context===y)&&u(this,S);else{for(var A=0,x=[],T=v.length;A<T;A++)(v[A].fn!==_||b&&!v[A].once||y&&v[A].context!==y)&&x.push(v[A]);x.length?this._events[S]=x.length===1?x[0]:x:u(this,S)}return this},d.prototype.removeAllListeners=function(g){var _;return g?(_=i?i+g:g,this._events[_]&&u(this,_)):(this._events=new n,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=i,d.EventEmitter=d,r.exports=d}(eventemitter3)),eventemitter3.exports}var eventemitter3Exports=requireEventemitter3();const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports),isType=(r,e)=>Object.prototype.toString.call(r)===`[object ${e}]`,isBoolean=(r,e=!1)=>e?typeof r=="boolean":r===!0||r===!1||isType(r,"Boolean"),isFunction=r=>typeof r=="function",isNil=r=>r==null,isValid=r=>r!=null,isObject$1=r=>{const e=typeof r;return r!==null&&e==="object"||e==="function"},isObjectLike=r=>typeof r=="object"&&r!==null,isPlainObject=function(r){if(!isObjectLike(r)||!isType(r,"Object"))return!1;if(Object.getPrototypeOf(r)===null)return!0;let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e},isUndefined=r=>r===void 0,isString=(r,e=!1)=>{const i=typeof r;return e?i==="string":i==="string"||isType(r,"String")},isArray=r=>Array.isArray?Array.isArray(r):isType(r,"Array"),isArrayLike=function(r){return r!==null&&typeof r!="function"&&Number.isFinite(r.length)},isDate=r=>isType(r,"Date"),isNumber=(r,e=!1)=>{const i=typeof r;return e?i==="number":i==="number"||isType(r,"Number")},isNumeric=r=>typeof r=="string"&&!isNaN(Number(r))&&!isNaN(parseFloat(r)),isValidNumber=r=>isNumber(r)&&Number.isFinite(r),isValidUrl=r=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(r),isBase64=r=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(r),getType=r=>({}).toString.call(r).replace(/^\[object /,"").replace(/]$/,""),objectProto=Object.prototype,isPrototype=function(r){const e=r&&r.constructor;return r===(typeof e=="function"&&e.prototype||objectProto)},hasOwnProperty$1=Object.prototype.hasOwnProperty;function isEmpty(r){if(isNil(r))return!0;if(isArrayLike(r))return!r.length;const e=getType(r);if(e==="Map"||e==="Set")return!r.size;if(isPrototype(r))return!Object.keys(r).length;for(const i in r)if(hasOwnProperty$1.call(r,i))return!1;return!0}const get=(r,e,i)=>{const n=isString(e)?e.split("."):e;for(let o=0;o<n.length;o++)r=r?r[n[o]]:void 0;return r===void 0?i:r},hasOwnProperty=Object.prototype.hasOwnProperty,has=(r,e)=>r!=null&&hasOwnProperty.call(r,e);function cloneDeep(r,e,i){let n;if(!isValid(r)||typeof r!="object"||e&&e(r))return r;const o=isArray(r),l=r.length;n=o?new Array(l):typeof r=="object"?{}:isBoolean(r)||isNumber(r)||isString(r)?r:isDate(r)?new Date(+r):void 0;const u=o?void 0:Object.keys(Object(r));let d=-1;if(n)for(;++d<(u||r).length;){const f=u?u[d]:d,g=r[f];i&&i.includes(f.toString())?n[f]=g:n[f]=cloneDeep(g,e,i)}return n}function baseMerge(r,e,i=!1,n=!1){if(e){if(r===e)return;if(isValid(e)&&typeof e=="object"){const o=Object(e),l=[];for(const f in o)l.push(f);let{length:u}=l,d=-1;for(;u--;){const f=l[++d];!isValid(o[f])||typeof o[f]!="object"||n&&isArray(r[f])?assignMergeValue(r,f,o[f]):baseMergeDeep(r,e,f,i,n)}}}}function baseMergeDeep(r,e,i,n=!1,o=!1){const l=r[i],u=e[i];let d=e[i],f=!0;if(isArray(u)){if(n)d=[];else if(isArray(l))d=l;else if(isArrayLike(l)){d=new Array(l.length);let g=-1;const _=l.length;for(;++g<_;)d[g]=l[g]}}else isPlainObject(u)?(d=l??{},typeof l!="function"&&typeof l=="object"||(d={})):f=!1;f&&baseMerge(d,u,n,o),assignMergeValue(r,i,d)}function assignMergeValue(r,e,i){(i!==void 0&&!eq(r[e],i)||i===void 0&&!(e in r))&&(r[e]=i)}function eq(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function merge$1(r,...e){let i=-1;const n=e.length;for(;++i<n;)baseMerge(r,e[i],!0);return r}function pickWithout(r,e){if(!r||!isPlainObject(r))return r;const i={};return Object.keys(r).forEach(n=>{const o=r[n];let l=!1;e.forEach(u=>{(isString(u)&&u===n||u instanceof RegExp&&n.match(u))&&(l=!0)}),l||(i[n]=o)}),i}function objToString(r){return Object.prototype.toString.call(r)}function objectKeys(r){return Object.keys(r)}function isEqual(r,e,i){if(r===e)return!0;if(typeof r!=typeof e||r==null||e==null)return!1;if(Number.isNaN(r)&&Number.isNaN(e))return!0;if(objToString(r)!==objToString(e)||isFunction(r)||typeof r!="object")return!1;if(isArray(r)){if(r.length!==e.length)return!1;for(let l=r.length-1;l>=0;l--)if(!isEqual(r[l],e[l]))return!1;return!0}if(!isPlainObject(r))return!1;const n=objectKeys(r),o=objectKeys(e);if(n.length!==o.length)return!1;n.sort(),o.sort();for(let l=n.length-1;l>=0;l--)if(n[l]!=o[l])return!1;for(let l=n.length-1;l>=0;l--){const u=n[l];if(!isEqual(r[u],e[u]))return!1}return!0}function keys(r){if(!r)return[];if(Object.keys)return Object.keys(r);const e=[];for(const i in r)r.hasOwnProperty(i)&&e.push(i);return e}function defaults(r,e,i){const n=keys(e);for(let o=0;o<n.length;o++){const l=n[o];(i?e[l]!=null:r[l]==null)&&(r[l]=e[l])}return r}function mixin(r,e,i=!0){if(r="prototype"in r?r.prototype:r,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const n=Object.getOwnPropertyNames(e);for(let o=0;o<n.length;o++){const l=n[o];l!=="constructor"&&(i?e[l]!=null:r[l]==null)&&(r[l]=e[l])}}else defaults(r,e,i)}function array(r){return isValid(r)?isArray(r)?r:[r]:[]}function last(r){if(isArrayLike(r))return r[r.length-1]}const maxInArray=(r,e)=>{var i;if(r.length===0)return;let n=r[0];for(let o=1;o<r.length;o++){const l=r[o];((i=e==null?void 0:e(l,n))!==null&&i!==void 0?i:l-n)>0&&(n=l)}return n},minInArray=(r,e)=>{var i;if(r.length===0)return;let n=r[0];for(let o=1;o<r.length;o++){const l=r[o];((i=e==null?void 0:e(l,n))!==null&&i!==void 0?i:l-n)<0&&(n=l)}return n};function arrayEqual(r,e){if(!isArray(r)||!isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0}function uniqArray(r){return r&&isArray(r)?Array.from(new Set(array(r))):r}function shuffleArray(r,e=Math.random){let i,n,o=r.length;for(;o;)i=Math.floor(e()*o),n=r[--o],r[o]=r[i],r[i]=n;return r}function flattenArray(r){if(!isArray(r))return[r];const e=[];for(const i of r)e.push(...flattenArray(i));return e}function range(r,e,i){isValid(e)||(e=r,r=0),isValid(i)||(i=1);let n=-1;const o=0|Math.max(0,Math.ceil((e-r)/i)),l=new Array(o);for(;++n<o;)l[n]=r+n*i;return l}function ascending$1(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function toNumber(r){return Number(r)}function quantileSorted(r,e,i=toNumber){const n=r.length;if(!n)return;if(n<2)return i(r[0],0,r);const o=(n-1)*e,l=Math.floor(o),u=i(r[l],l,r);return u+(i(r[l+1],l+1,r)-u)*(o-l)}const hasConsole=typeof console<"u";function log$1(r,e,i){const n=[e].concat([].slice.call(i));hasConsole&&console[r].apply(console,n)}var LoggerLevel;(function(r){r[r.None=0]="None",r[r.Error=1]="Error",r[r.Warn=2]="Warn",r[r.Info=3]="Info",r[r.Debug=4]="Debug"})(LoggerLevel||(LoggerLevel={}));class Logger{static getInstance(e,i){return Logger._instance&&isNumber(e)?Logger._instance.level(e):Logger._instance||(Logger._instance=new Logger(e,i)),Logger._instance}static setInstance(e){return Logger._instance=e}static setInstanceLevel(e){Logger._instance?Logger._instance.level(e):Logger._instance=new Logger(e)}static clearInstance(){Logger._instance=null}constructor(e=LoggerLevel.None,i){this._onErrorHandler=[],this._level=e,this._method=i}addErrorHandler(e){this._onErrorHandler.find(i=>i===e)||this._onErrorHandler.push(e)}removeErrorHandler(e){const i=this._onErrorHandler.findIndex(n=>n===e);i<0||this._onErrorHandler.splice(i,1)}callErrorHandler(...e){this._onErrorHandler.forEach(i=>i(...e))}canLogInfo(){return this._level>=LoggerLevel.Info}canLogDebug(){return this._level>=LoggerLevel.Debug}canLogError(){return this._level>=LoggerLevel.Error}canLogWarn(){return this._level>=LoggerLevel.Warn}level(e){return arguments.length?(this._level=+e,this):this._level}error(...e){var i;return this._level>=LoggerLevel.Error&&(this._onErrorHandler.length?this.callErrorHandler(...e):log$1((i=this._method)!==null&&i!==void 0?i:"error","ERROR",e)),this}warn(...e){return this._level>=LoggerLevel.Warn&&log$1(this._method||"warn","WARN",e),this}info(...e){return this._level>=LoggerLevel.Info&&log$1(this._method||"log","INFO",e),this}debug(...e){return this._level>=LoggerLevel.Debug&&log$1(this._method||"log","DEBUG",e),this}}Logger._instance=null;function bisect(r,e,i=0,n){for(isNil(n)&&(n=r.length);i<n;){const o=i+n>>>1;ascending$1(r[o],e)>0?n=o:i=o+1}return i}const binaryFuzzySearch=(r,e)=>binaryFuzzySearchInNumberRange(0,r.length,i=>e(r[i])),binaryFuzzySearchInNumberRange=(r,e,i)=>{let n=r,o=e;for(;n<o;){const l=Math.floor((n+o)/2);i(l)>=0?o=l:n=l+1}return n},median$1=(r,e)=>{let i=r;return i=r.sort(ascending$1),quantileSorted(i,.5)},DEFAULT_ABSOLUTE_TOLERATE=1e-10,DEFAULT_RELATIVE_TOLERATE=1e-10;function isNumberClose(r,e,i=DEFAULT_RELATIVE_TOLERATE,n=DEFAULT_ABSOLUTE_TOLERATE){const o=n,l=i*Math.max(r,e);return Math.abs(r-e)<=Math.max(o,l)}function isGreater(r,e,i,n){return r>e&&!isNumberClose(r,e,i,n)}function isLess(r,e,i,n){return r<e&&!isNumberClose(r,e,i,n)}const memoize=r=>{let e=null,i=null;return(...n)=>(e&&n.every((o,l)=>o===e[l])||(e=n,i=r(...n)),i)},clamp=function(r,e,i){return r<e?e:r>i?i:r},clampRange=(r,e,i)=>{let[n,o]=r;o<n&&(n=r[1],o=r[0]);const l=o-n;return l>=i-e?[e,i]:(n=Math.min(Math.max(n,e),i-l),[n,n+l])};function clamper(r,e){let i;return r>e&&(i=r,r=e,e=i),n=>Math.max(r,Math.min(e,n))}let hasRaf=!1;try{hasRaf=typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"}catch{hasRaf=!1}function debounce(r,e,i){let n,o,l,u,d,f,g=0,_=!1,y=!1,b=!0;const S=!e&&e!==0&&hasRaf;if(typeof r!="function")throw new TypeError("Expected a function");function v(P){const L=n,R=o;return n=o=void 0,g=P,u=r.apply(R,L),u}function A(P,L){return S?(cancelAnimationFrame(d),requestAnimationFrame(P)):setTimeout(P,L)}function x(P){const L=P-f;return f===void 0||L>=e||L<0||y&&P-g>=l}function T(){const P=Date.now();if(x(P))return C(P);d=A(T,function(L){const R=L-g,w=e-(L-f);return y?Math.min(w,l-R):w}(P))}function C(P){return d=void 0,b&&n?v(P):(n=o=void 0,u)}function E(...P){const L=Date.now(),R=x(L);if(n=P,o=this,f=L,R){if(d===void 0)return function(w){return g=w,d=A(T,e),_?v(w):u}(f);if(y)return d=A(T,e),v(f)}return d===void 0&&(d=A(T,e)),u}return e=+e||0,isObject$1(i)&&(_=!!i.leading,y="maxWait"in i,y&&(l=Math.max(isValidNumber(i.maxWait)?i.maxWait:0,e)),b="trailing"in i?!!i.trailing:b),E.cancel=function(){d!==void 0&&function(P){if(S)return cancelAnimationFrame(P);clearTimeout(P)}(d),g=0,n=f=o=d=void 0},E.flush=function(){return d===void 0?u:C(Date.now())},E.pending=function(){return d!==void 0},E}hasRaf=!1;function throttle(r,e,i){let n=!0,o=!0;if(typeof r!="function")throw new TypeError("Expected a function");return isObject$1(i)&&(n="leading"in i?!!i.leading:n,o="trailing"in i?!!i.trailing:o),debounce(r,e,{leading:n,trailing:o,maxWait:e})}function interpolateNumber(r,e){return i=>r*(1-i)+e*i}function interpolateNumberRound(r,e){return function(i){return Math.round(r*(1-i)+e*i)}}function interpolateDate(r,e){const i=r.valueOf(),n=e.valueOf(),o=new Date;return l=>(o.setTime(i*(1-l)+n*l),o)}const reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero$1(r){return function(){return r}}function one(r){return function(e){return r(e)+""}}function interpolateString(r,e){let i,n,o,l=reA.lastIndex=reB.lastIndex=0,u=-1;const d=[],f=[];for(r+="",e+="";(i=reA.exec(r))&&(n=reB.exec(e));)(o=n.index)>l&&(o=e.slice(l,o),d[u]?d[u]+=o:d[++u]=o),(i=i[0])===(n=n[0])?d[u]?d[u]+=n:d[++u]=n:(d[++u]=null,f.push({i:u,x:interpolateNumber(i,n)})),l=reB.lastIndex;return l<e.length&&(o=e.slice(l),d[u]?d[u]+=o:d[++u]=o),d.length<2?f[0]?one(f[0].x):zero$1(e):(e=f.length,function(g){for(let _,y=0;y<e;++y)d[(_=f[y]).i]=_.x(g);return d.join("")})}function toValidNumber$1(r){if(isValidNumber(r))return r;const e=+r;return isValidNumber(e)?e:0}function seedRandom(r){return parseFloat("0."+Math.sin(r).toString().substring(6))}const epsilon$1=1e-12,pi$1=Math.PI,halfPi$2=pi$1/2,tau$1=2*pi$1,pi2=2*Math.PI,abs$1=Math.abs,atan2$1=Math.atan2,cos$1=Math.cos,max$1=Math.max,min$1=Math.min,sin$1=Math.sin,sqrt$3=Math.sqrt,pow$1=Math.pow;function acos$1(r){return r>1?0:r<-1?pi$1:Math.acos(r)}function asin$1(r){return r>=1?halfPi$2:r<=-1?-halfPi$2:Math.asin(r)}function pointAt(r,e,i,n,o){let l=i,u=n;return typeof r=="number"&&typeof i=="number"&&(l=(1-o)*r+o*i),typeof e=="number"&&typeof n=="number"&&(u=(1-o)*e+o*n),{x:l,y:u}}function crossProduct(r,e){return r[0]*e[1]-r[1]*e[0]}function fuzzyEqualVec(r,e){return abs$1(r[0]-e[0])+abs$1(r[1]-e[1])<1e-12}function fixPrecision$1(r,e=10){return Math.round(r*e)/e}function getDecimalPlaces(r){const e=r.toString().split(/[eE]/),i=(e[0].split(".")[1]||"").length-(+e[1]||0);return i>0?i:0}function precisionAdd(r,e){return fixPrecision$1(r+e,10**Math.max(getDecimalPlaces(r),getDecimalPlaces(e)))}function precisionSub(r,e){return fixPrecision$1(r-e,10**Math.max(getDecimalPlaces(r),getDecimalPlaces(e)))}class Point{constructor(e=0,i=0,n,o){this.x=0,this.y=0,this.x=e,this.y=i,this.x1=n,this.y1=o}clone(){return new Point(this.x,this.y)}copyFrom(e){return this.x=e.x,this.y=e.y,this.x1=e.x1,this.y1=e.y1,this.defined=e.defined,this.context=e.context,this}set(e,i){return this.x=e,this.y=i,this}add(e){return isNumber(e)?(this.x+=e,void(this.y+=e)):(this.x+=e.x,this.y+=e.y,this)}sub(e){return isNumber(e)?(this.x-=e,void(this.y-=e)):(this.x-=e.x,this.y-=e.y,this)}multi(e){throw new Error("")}div(e){throw new Error("")}}class PointService{static distancePP(e,i){return sqrt$3(pow$1(e.x-i.x,2)+pow$1(e.y-i.y,2))}static distanceNN(e,i,n,o){return sqrt$3(pow$1(e-n,2)+pow$1(i-o,2))}static distancePN(e,i,n){return sqrt$3(pow$1(i-e.x,2)+pow$1(n-e.y,2))}static pointAtPP(e,i,n){return new Point((i.x-e.x)*n+e.x,(i.y-e.y)*n+e.y)}}function degreeToRadian(r){return r*(Math.PI/180)}function radianToDegree(r){return 180*r/Math.PI}const clampRadian=(r=0)=>{if(r<0)for(;r<-tau$1;)r+=tau$1;else if(r>0)for(;r>tau$1;)r-=tau$1;return r},clampAngleByRadian=clampRadian;function polarToCartesian(r,e,i){return e?{x:r.x+e*Math.cos(i),y:r.y+e*Math.sin(i)}:{x:r.x,y:r.y}}function cartesianToPolar(r,e={x:0,y:0},i=0,n=2*Math.PI){const{x:o,y:l}=r,{x:u,y:d}=e;let f=o-u,g=l-d;const _=Math.sqrt(f*f+g*g);if(_===0)return{radius:0,angle:0};f/=_,g/=_;let y=Math.atan2(g,f);if(y<i)for(;y<=i;)y+=2*Math.PI;if(y>n)for(;y>=n;)y-=2*Math.PI;return{radius:_,angle:y}}function getAngleByPoint(r,e){return Math.atan2(e.y-r.y,e.x-r.x)}function normalizeAngle(r){for(;r<0;)r+=2*Math.PI;for(;r>=2*Math.PI;)r-=2*Math.PI;return r}function findBoundaryAngles(r,e){const i=Math.abs(e-r);if(i>=2*Math.PI||2*Math.PI-i<1e-6)return[0,Math.PI/2,Math.PI,1.5*Math.PI];const n=normalizeAngle(Math.min(r,e)),o=n+i,l=[n,o];let u=Math.floor(n/Math.PI)*Math.PI/2;for(;u<o;)u>n&&l.push(u),u+=Math.PI/2;return l}function calculateMaxRadius(r,e,i,n){const{x:o,y:l}=e,u=findBoundaryAngles(i,n),{width:d,height:f}=r,g=[];return u.forEach(_=>{const y=Math.sin(_),b=Math.cos(_);y===1?g.push(f-l):y===-1?g.push(l):b===1?g.push(d-o):b===-1?g.push(o):(y>0?g.push(Math.abs((f-l)/y)):g.push(Math.abs(l/y)),b>0?g.push(Math.abs((d-o)/b)):g.push(Math.abs(o/b)))}),Math.min.apply(null,g)}function computeQuadrant(r){return(r=normalizeAngle(r))>0&&r<=Math.PI/2?2:r>Math.PI/2&&r<=Math.PI?3:r>Math.PI&&r<=3*Math.PI/2?4:1}function sub(r,e,i){r[0]=e[0]-i[0],r[1]=e[1]-i[1]}function isIntersect$1(r,e,i,n){let o=r[0],l=e[0],u=i[0],d=n[0];return l<o&&([o,l]=[l,o]),d<u&&([d,u]=[u,d]),!(l<u||d<o)&&(o=r[1],l=e[1],u=i[1],d=n[1],l<o&&([o,l]=[l,o]),d<u&&([d,u]=[u,d]),!(l<u||d<o))}function getIntersectPoint(r,e,i,n){if(!isIntersect$1(r,e,i,n))return!1;const o=[0,0],l=[0,0],u=[0,0];if(sub(o,e,r),sub(l,n,i),fuzzyEqualVec(o,l))return!0;sub(u,i,r);const d=crossProduct(u,l)/crossProduct(o,l);return d>=0&&d<=1&&[r[0]+o[0]*d,r[1]+o[1]*d]}function getRectIntersect(r,e,i){if(r===null)return e;if(e===null)return r;const{x11:n,x12:o,y11:l,y12:u,x21:d,x22:f,y21:g,y22:_}=formatTwoBBox(r,e,i);return n>=f||o<=d||l>=_||u<=g?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(n,d),y1:Math.max(l,g),x2:Math.min(o,f),y2:Math.min(u,_)}}var InnerBBox;(function(r){r[r.NONE=0]="NONE",r[r.BBOX1=1]="BBOX1",r[r.BBOX2=2]="BBOX2"})(InnerBBox||(InnerBBox={}));const formatTwoBBox=(r,e,i)=>{let n=r.x1,o=r.x2,l=r.y1,u=r.y2,d=e.x1,f=e.x2,g=e.y1,_=e.y2;return i&&(n>o&&([n,o]=[o,n]),l>u&&([l,u]=[u,l]),d>f&&([d,f]=[f,d]),g>_&&([g,_]=[_,g])),{x11:n,x12:o,y11:l,y12:u,x21:d,x22:f,y21:g,y22:_}};function rectInsideAnotherRect(r,e,i){if(!r||!e)return InnerBBox.NONE;const{x11:n,x12:o,y11:l,y12:u,x21:d,x22:f,y21:g,y22:_}=formatTwoBBox(r,e,i);return n>d&&o<f&&l>g&&u<_?InnerBBox.BBOX1:d>n&&f<o&&g>l&&_<u?InnerBBox.BBOX2:InnerBBox.NONE}function isRectIntersect(r,e,i){if(r&&e){if(!i)return!(r.x1>e.x2||r.x2<e.x1||r.y1>e.y2||r.y2<e.y1);const{x11:n,x12:o,y11:l,y12:u,x21:d,x22:f,y21:g,y22:_}=formatTwoBBox(r,e,!0);return!(n>f||o<d||l>_||u<g)}return!0}function pointInRect(r,e,i){if(!e)return!0;if(!i)return r.x>=e.x1&&r.x<=e.x2&&r.y>=e.y1&&r.y<=e.y2;let n=e.x1,o=e.x2,l=e.y1,u=e.y2;return n>o&&([n,o]=[o,n]),l>u&&([l,u]=[u,l]),r.x>=n&&r.x<=o&&r.y>=l&&r.y<=u}function getProjectionRadius(r,e){return Math.abs(e[0]*r[0]+e[1]*r[1])}function rotatePoint({x:r,y:e},i,n={x:0,y:0}){return{x:(r-n.x)*Math.cos(i)-(e-n.y)*Math.sin(i)+n.x,y:(r-n.x)*Math.sin(i)+(e-n.y)*Math.cos(i)+n.y}}function getCenterPoint(r){return{x:(r.x1+r.x2)/2,y:(r.y1+r.y2)/2}}function toRect$1(r,e){const i=e?degreeToRadian(r.angle):r.angle,n=getCenterPoint(r);return[rotatePoint({x:r.x1,y:r.y1},i,n),rotatePoint({x:r.x2,y:r.y1},i,n),rotatePoint({x:r.x2,y:r.y2},i,n),rotatePoint({x:r.x1,y:r.y2},i,n)]}function isRotateAABBIntersect(r,e,i=!1){const n=toRect$1(r,i),o=toRect$1(e,i),l=(x,T)=>[T.x-x.x,T.y-x.y],u=l(getCenterPoint(r),getCenterPoint(e)),d=l(n[0],n[1]),f=l(n[1],n[2]),g=l(o[0],o[1]),_=l(o[1],o[2]),y=i?degreeToRadian(r.angle):r.angle;let b=i?degreeToRadian(90-r.angle):r.angle+halfPi$2;const S=i?degreeToRadian(e.angle):e.angle;let v=i?degreeToRadian(90-e.angle):e.angle+halfPi$2;b>pi2&&(b-=pi2),v>pi2&&(v-=pi2);const A=(x,T,C,E)=>{const P=[Math.cos(T),Math.sin(T)];return x+(getProjectionRadius(P,C)+getProjectionRadius(P,E))/2>getProjectionRadius(P,u)};return A((r.x2-r.x1)/2,y,g,_)&&A((r.y2-r.y1)/2,b,g,_)&&A((e.x2-e.x1)/2,S,d,f)&&A((e.y2-e.y1)/2,v,d,f)}let x1$1,y1$1,x2,y2;function getAABBFromPoints(r){return x1$1=1/0,y1$1=1/0,x2=-1/0,y2=-1/0,r.forEach(e=>{x1$1>e.x&&(x1$1=e.x),x2<e.x&&(x2=e.x),y1$1>e.y&&(y1$1=e.y),y2<e.y&&(y2=e.y)}),{x1:x1$1,y1:y1$1,x2,y2}}const EPSILON=1e-8;function lineIntersectPolygon(r,e,i,n,o){for(let l=0,u=o[o.length-1];l<o.length;l++){const d=o[l];if(isIntersect$1([r,e],[i,n],[d.x,d.y],[u.x,u.y]))return!0;u=d}return!1}function polygonContainPoint(r,e,i){let n=0,o=r[0];if(!o)return!1;for(let u=1;u<r.length;u++){const d=r[u];n+=isPointInLine(o.x,o.y,d.x,d.y,e,i),o=d}const l=r[0];return isAroundEqual(o.x,l.x)&&isAroundEqual(o.y,l.y)||(n+=isPointInLine(o.x,o.y,l.x,l.y,e,i)),n!==0}function isPointInLine(r,e,i,n,o,l){if(l>e&&l>n||l<e&&l<n||n===e)return 0;const u=(l-e)/(n-e);let d=n<e?1:-1;u!==1&&u!==0||(d=n<e?.5:-.5);const f=u*(i-r)+r;return f===o?1/0:f>o?d:0}function isAroundEqual(r,e){return Math.abs(r-e)<EPSILON}function polygonIntersectPolygon(r,e){for(let i=0;i<e.length;i++)if(polygonContainPoint(r,e[i].x,e[i].y)||i>0&&lineIntersectPolygon(e[i-1].x,e[i-1].y,e[i].x,e[i].y,r))return!0;return!1}const eastAsianCharacterInfo=r=>{let e=r.charCodeAt(0),i=r.length===2?r.charCodeAt(1):0,n=e;return 55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e&=1023,i&=1023,n=e<<10|i,n+=65536),n===12288||65281<=n&&n<=65376||65504<=n&&n<=65510?"F":n===8361||65377<=n&&n<=65470||65474<=n&&n<=65479||65482<=n&&n<=65487||65490<=n&&n<=65495||65498<=n&&n<=65500||65512<=n&&n<=65518?"H":4352<=n&&n<=4447||4515<=n&&n<=4519||4602<=n&&n<=4607||9001<=n&&n<=9002||11904<=n&&n<=11929||11931<=n&&n<=12019||12032<=n&&n<=12245||12272<=n&&n<=12283||12289<=n&&n<=12350||12353<=n&&n<=12438||12441<=n&&n<=12543||12549<=n&&n<=12589||12593<=n&&n<=12686||12688<=n&&n<=12730||12736<=n&&n<=12771||12784<=n&&n<=12830||12832<=n&&n<=12871||12880<=n&&n<=13054||13056<=n&&n<=19903||19968<=n&&n<=42124||42128<=n&&n<=42182||43360<=n&&n<=43388||44032<=n&&n<=55203||55216<=n&&n<=55238||55243<=n&&n<=55291||63744<=n&&n<=64255||65040<=n&&n<=65049||65072<=n&&n<=65106||65108<=n&&n<=65126||65128<=n&&n<=65131||110592<=n&&n<=110593||127488<=n&&n<=127490||127504<=n&&n<=127546||127552<=n&&n<=127560||127568<=n&&n<=127569||131072<=n&&n<=194367||177984<=n&&n<=196605||196608<=n&&n<=262141?"W":32<=n&&n<=126||162<=n&&n<=163||165<=n&&n<=166||n===172||n===175||10214<=n&&n<=10221||10629<=n&&n<=10630?"Na":n===161||n===164||167<=n&&n<=168||n===170||173<=n&&n<=174||176<=n&&n<=180||182<=n&&n<=186||188<=n&&n<=191||n===198||n===208||215<=n&&n<=216||222<=n&&n<=225||n===230||232<=n&&n<=234||236<=n&&n<=237||n===240||242<=n&&n<=243||247<=n&&n<=250||n===252||n===254||n===257||n===273||n===275||n===283||294<=n&&n<=295||n===299||305<=n&&n<=307||n===312||319<=n&&n<=322||n===324||328<=n&&n<=331||n===333||338<=n&&n<=339||358<=n&&n<=359||n===363||n===462||n===464||n===466||n===468||n===470||n===472||n===474||n===476||n===593||n===609||n===708||n===711||713<=n&&n<=715||n===717||n===720||728<=n&&n<=731||n===733||n===735||768<=n&&n<=879||913<=n&&n<=929||931<=n&&n<=937||945<=n&&n<=961||963<=n&&n<=969||n===1025||1040<=n&&n<=1103||n===1105||n===8208||8211<=n&&n<=8214||8216<=n&&n<=8217||8220<=n&&n<=8221||8224<=n&&n<=8226||8228<=n&&n<=8231||n===8240||8242<=n&&n<=8243||n===8245||n===8251||n===8254||n===8308||n===8319||8321<=n&&n<=8324||n===8364||n===8451||n===8453||n===8457||n===8467||n===8470||8481<=n&&n<=8482||n===8486||n===8491||8531<=n&&n<=8532||8539<=n&&n<=8542||8544<=n&&n<=8555||8560<=n&&n<=8569||n===8585||8592<=n&&n<=8601||8632<=n&&n<=8633||n===8658||n===8660||n===8679||n===8704||8706<=n&&n<=8707||8711<=n&&n<=8712||n===8715||n===8719||n===8721||n===8725||n===8730||8733<=n&&n<=8736||n===8739||n===8741||8743<=n&&n<=8748||n===8750||8756<=n&&n<=8759||8764<=n&&n<=8765||n===8776||n===8780||n===8786||8800<=n&&n<=8801||8804<=n&&n<=8807||8810<=n&&n<=8811||8814<=n&&n<=8815||8834<=n&&n<=8835||8838<=n&&n<=8839||n===8853||n===8857||n===8869||n===8895||n===8978||9312<=n&&n<=9449||9451<=n&&n<=9547||9552<=n&&n<=9587||9600<=n&&n<=9615||9618<=n&&n<=9621||9632<=n&&n<=9633||9635<=n&&n<=9641||9650<=n&&n<=9651||9654<=n&&n<=9655||9660<=n&&n<=9661||9664<=n&&n<=9665||9670<=n&&n<=9672||n===9675||9678<=n&&n<=9681||9698<=n&&n<=9701||n===9711||9733<=n&&n<=9734||n===9737||9742<=n&&n<=9743||9748<=n&&n<=9749||n===9756||n===9758||n===9792||n===9794||9824<=n&&n<=9825||9827<=n&&n<=9829||9831<=n&&n<=9834||9836<=n&&n<=9837||n===9839||9886<=n&&n<=9887||9918<=n&&n<=9919||9924<=n&&n<=9933||9935<=n&&n<=9953||n===9955||9960<=n&&n<=9983||n===10045||n===10071||10102<=n&&n<=10111||11093<=n&&n<=11097||12872<=n&&n<=12879||57344<=n&&n<=63743||65024<=n&&n<=65039||n===65533||127232<=n&&n<=127242||127248<=n&&n<=127277||127280<=n&&n<=127337||127344<=n&&n<=127386||917760<=n&&n<=917999||983040<=n&&n<=1048573||1048576<=n&&n<=1114109?"A":"N"};function getContextFont(r,e={},i){i||(i=1);const{fontStyle:n=e.fontStyle,fontVariant:o=e.fontVariant,fontWeight:l=e.fontWeight,fontSize:u=e.fontSize,fontFamily:d=e.fontFamily}=r;return(n?n+" ":"")+(o?o+" ":"")+(l?l+" ":"")+u*i+"px "+(d||"sans-serif")}class TextMeasure{constructor(e,i){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=e,this._userSpec=i??{},this.textSpec=this._initSpec(),isValid(e.specialCharSet)&&(this.specialCharSet=e.specialCharSet),this._standardMethod=isValid(e.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(isNil(this._canvas)&&(isValid(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),isNil(this._canvas)&&typeof window<"u"&&window.document!==void 0&&globalThis&&isValid(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),isNil(this._context)&&isValid(this._canvas)){const e=this._canvas.getContext("2d");isValid(e)&&(e.save(),e.font=getContextFont(this.textSpec),this._contextSaved=!0,this._context=e)}return!isNil(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var e,i,n;const{defaultFontParams:o={}}=this._option,{fontStyle:l=o.fontStyle,fontVariant:u=o.fontVariant,fontWeight:d=(e=o.fontWeight)!==null&&e!==void 0?e:"normal",fontSize:f=(i=o.fontSize)!==null&&i!==void 0?i:12,fontFamily:g=(n=o.fontFamily)!==null&&n!==void 0?n:"sans-serif",align:_,textAlign:y=_??"center",baseline:b,textBaseline:S=b??"middle",ellipsis:v,limit:A}=this._userSpec;let{lineHeight:x=f}=this._userSpec;if(isString(x)&&x[x.length-1]==="%"){const T=Number.parseFloat(x.substring(0,x.length-1))/100;x=f*T}return{fontStyle:l,fontVariant:u,fontFamily:g,fontSize:f,fontWeight:d,textAlign:y,textBaseline:S,ellipsis:v,limit:A,lineHeight:x}}measure(e,i){switch(i){case"vrender":case"canopus":return this.fullMeasure(e);case"canvas":return this.measureWithNaiveCanvas(e);case"simple":return this.quickMeasureWithoutCanvas(e);default:return this.quickMeasure(e)}}fullMeasure(e){if(isNil(e))return{width:0,height:0};if(isNil(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(e);const{fontFamily:i,fontSize:n,fontWeight:o,textAlign:l,textBaseline:u,ellipsis:d,limit:f,lineHeight:g}=this.textSpec;let _;try{const y=this._option.getTextBounds({text:e,fontFamily:i,fontSize:n,fontWeight:o,textAlign:l,textBaseline:u,ellipsis:!!d,maxLineWidth:f||1/0,lineHeight:g});_={width:y.width(),height:y.height()}}catch{this._notSupportVRender=!0,_=this.measureWithNaiveCanvas(e)}return _}measureWithNaiveCanvas(e){return this._measureReduce(e,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(e){var i;if(!this.initContext())return this._quickMeasureWithoutCanvas(e);const n=this._context.measureText(e),{fontSize:o,lineHeight:l}=this.textSpec;return{width:n.width,height:(i=l)!==null&&i!==void 0?i:o,fontBoundingBoxAscent:n.fontBoundingBoxAscent,fontBoundingBoxDescent:n.fontBoundingBoxDescent}}quickMeasure(e){return this._measureReduce(e,this._quickMeasure.bind(this))}_quickMeasure(e){const i={width:0,height:0};for(let n=0;n<e.length;n++){const o=e[n];let l=this._measureSpecialChar(o);isNil(l)&&TextMeasure.NUMBERS_CHAR_SET.includes(o)&&(l=this._measureNumberChar()),isNil(l)&&["F","W"].includes(eastAsianCharacterInfo(o))&&(l=this._measureFullSizeChar()),isNil(l)&&(l=this._measureLetterChar()),i.width+=l.width,i.height=Math.max(i.height,l.height),!isNil(l.fontBoundingBoxAscent)&&(i.fontBoundingBoxAscent=l.fontBoundingBoxAscent),!isNil(l.fontBoundingBoxDescent)&&(i.fontBoundingBoxDescent=l.fontBoundingBoxDescent)}return i}quickMeasureWithoutCanvas(e){return this._measureReduce(e,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(e){var i;const n={width:0,height:0},{fontSize:o,lineHeight:l}=this.textSpec;for(let u=0;u<e.length;u++){const d=e[u],f=["F","W"].includes(eastAsianCharacterInfo(d))?1:.53;n.width+=f*o}return n.height=(i=l)!==null&&i!==void 0?i:o,n}_measureReduce(e,i){var n;const{fontSize:o,lineHeight:l}=this.textSpec,u={width:0,height:0};if(isNil(e))return u;if(isArray(e)){const d=e.filter(isValid).map(f=>f.toString());return d.length===0?u:d.length===1?i(d[0]):{width:d.reduce((f,g)=>Math.max(f,i(g).width),0),height:d.length*(((n=l)!==null&&n!==void 0?n:o)+1)+1}}return i(e.toString())}_measureNumberChar(){if(isNil(this._numberCharSize)){const e=this._standardMethod(TextMeasure.NUMBERS_CHAR_SET);this._numberCharSize={width:e.width/TextMeasure.NUMBERS_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return isNil(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(TextMeasure.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(isNil(this._letterCharSize)){const e=this._standardMethod(TextMeasure.ALPHABET_CHAR_SET);this._letterCharSize={width:e.width/TextMeasure.ALPHABET_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(e){return isValid(this._specialCharSizeMap[e])?this._specialCharSizeMap[e]:this.specialCharSet.includes(e)?(this._specialCharSizeMap[e]=this._standardMethod(e),this._specialCharSizeMap[e]):null}release(){isValid(this._canvas)&&(this._canvas=null),isValid(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}TextMeasure.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",TextMeasure.NUMBERS_CHAR_SET="0123456789",TextMeasure.FULL_SIZE_CHAR="";const calculateAnchorOfBounds=(r,e)=>{const{x1:i,x2:n,y1:o,y2:l}=r,u=Math.abs(n-i),d=Math.abs(l-o);let f=(i+n)/2,g=(o+l)/2,_=0,y=0;switch(e){case"top":case"inside-top":y=-.5;break;case"bottom":case"inside-bottom":y=.5;break;case"left":case"inside-left":_=-.5;break;case"right":case"inside-right":_=.5;break;case"top-right":_=.5,y=-.5;break;case"top-left":_=-.5,y=-.5;break;case"bottom-right":_=.5,y=.5;break;case"bottom-left":_=-.5,y=.5}return f+=_*u,g+=y*d,{x:f,y:g}};function transformBoundsWithMatrix(r,e,i){const{x1:n,y1:o,x2:l,y2:u}=e;return i.onlyTranslate()?(r!==e&&r.setValue(e.x1,e.y1,e.x2,e.y2),r.translate(i.e,i.f),e):(r.clear(),r.add(i.a*n+i.c*o+i.e,i.b*n+i.d*o+i.f),r.add(i.a*l+i.c*o+i.e,i.b*l+i.d*o+i.f),r.add(i.a*l+i.c*u+i.e,i.b*l+i.d*u+i.f),r.add(i.a*n+i.c*u+i.e,i.b*n+i.d*u+i.f),e)}class Bounds{constructor(e){e?this.setValue(e.x1,e.y1,e.x2,e.y2):this.clear()}clone(){return new Bounds(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2}setValue(e=0,i=0,n=0,o=0){return this.x1=e,this.y1=i,this.x2=n,this.y2=o,this}set(e=0,i=0,n=0,o=0){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),o<i?(this.y2=i,this.y1=o):(this.y1=i,this.y2=o),this}add(e=0,i=0){return e<this.x1&&(this.x1=e),i<this.y1&&(this.y1=i),e>this.x2&&(this.x2=e),i>this.y2&&(this.y2=i),this}expand(e=0){return isArray(e)?(this.y1-=e[0],this.x2+=e[1],this.y2+=e[2],this.x1-=e[3]):(this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(e=0,i=0){return this.x1+=e,this.x2+=e,this.y1+=i,this.y2+=i,this}rotate(e=0,i=0,n=0){const o=this.rotatedPoints(e,i,n);return this.clear().add(o[0],o[1]).add(o[2],o[3]).add(o[4],o[5]).add(o[6],o[7])}scale(e=0,i=0,n=0,o=0){const l=this.scalePoints(e,i,n,o);return this.clear().add(l[0],l[1]).add(l[2],l[3])}union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this}intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this}encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2}alignsWith(e){return e&&(this.x1===e.x1||this.x2===e.x2||this.y1===e.y1||this.y2===e.y2)}intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)}contains(e=0,i=0){return!(e<this.x1||e>this.x2||i<this.y1||i>this.y2)}containsPoint(e){return!(e.x<this.x1||e.x>this.x2||e.y<this.y1||e.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(e=0){return this.x1*=e,this.x2*=e,this}scaleY(e=0){return this.y1*=e,this.y2*=e,this}transformWithMatrix(e){return transformBoundsWithMatrix(this,this,e),this}copy(e){return this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this}rotatedPoints(e,i,n){const{x1:o,y1:l,x2:u,y2:d}=this,f=Math.cos(e),g=Math.sin(e),_=i-i*f+n*g,y=n-i*g-n*f;return[f*o-g*l+_,g*o+f*l+y,f*o-g*d+_,g*o+f*d+y,f*u-g*l+_,g*u+f*l+y,f*u-g*d+_,g*u+f*d+y]}scalePoints(e,i,n,o){const{x1:l,y1:u,x2:d,y2:f}=this;return[e*l+(1-e)*n,i*u+(1-i)*o,e*d+(1-e)*n,i*f+(1-i)*o]}}class AABBBounds extends Bounds{}class OBBBounds extends Bounds{constructor(e,i=0){var n;super(e),e&&(this.angle=(n=e.angle)!==null&&n!==void 0?n:i)}intersects(e){return isRotateAABBIntersect(this,e)}setValue(e=0,i=0,n=0,o=0,l=0){return super.setValue(e,i,n,o),this.angle=l,this}clone(){return new OBBBounds(this)}}class Matrix{constructor(e=1,i=0,n=0,o=1,l=0,u=0){this.a=e,this.b=i,this.c=n,this.d=o,this.e=l,this.f=u}equalToMatrix(e){return!(this.e!==e.e||this.f!==e.f||this.a!==e.a||this.d!==e.d||this.b!==e.b||this.c!==e.c)}equalTo(e,i,n,o,l,u){return!(this.e!==l||this.f!==u||this.a!==e||this.d!==o||this.b!==i||this.c!==n)}setValue(e,i,n,o,l,u){return this.a=e,this.b=i,this.c=n,this.d=o,this.e=l,this.f=u,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const e=this.a,i=this.b,n=this.c,o=this.d,l=this.e,u=this.f,d=new Matrix,f=e*o-i*n;return d.a=o/f,d.b=-i/f,d.c=-n/f,d.d=e/f,d.e=(n*u-o*l)/f,d.f=-(e*u-i*l)/f,d}rotate(e){const i=Math.cos(e),n=Math.sin(e),o=this.a*i+this.c*n,l=this.b*i+this.d*n,u=this.a*-n+this.c*i,d=this.b*-n+this.d*i;return this.a=o,this.b=l,this.c=u,this.d=d,this}rotateByCenter(e,i,n){const o=Math.cos(e),l=Math.sin(e),u=(1-o)*i+l*n,d=(1-o)*n-l*i,f=o*this.a-l*this.b,g=l*this.a+o*this.b,_=o*this.c-l*this.d,y=l*this.c+o*this.d,b=o*this.e-l*this.f+u,S=l*this.e+o*this.f+d;return this.a=f,this.b=g,this.c=_,this.d=y,this.e=b,this.f=S,this}scale(e,i){return this.a*=e,this.b*=e,this.c*=i,this.d*=i,this}setScale(e,i){return this.b=this.b/this.a*e,this.c=this.c/this.d*i,this.a=e,this.d=i,this}transform(e,i,n,o,l,u){return this.multiply(e,i,n,o,l,u),this}translate(e,i){return this.e+=this.a*e+this.c*i,this.f+=this.b*e+this.d*i,this}transpose(){const{a:e,b:i,c:n,d:o,e:l,f:u}=this;return this.a=i,this.b=e,this.c=o,this.d=n,this.e=u,this.f=l,this}multiply(e,i,n,o,l,u){const d=this.a,f=this.b,g=this.c,_=this.d,y=d*e+g*i,b=f*e+_*i,S=d*n+g*o,v=f*n+_*o,A=d*l+g*u+this.e,x=f*l+_*u+this.f;return this.a=y,this.b=b,this.c=S,this.d=v,this.e=A,this.f=x,this}interpolate(e,i){const n=new Matrix;return n.a=this.a+(e.a-this.a)*i,n.b=this.b+(e.b-this.b)*i,n.c=this.c+(e.c-this.c)*i,n.d=this.d+(e.d-this.d)*i,n.e=this.e+(e.e-this.e)*i,n.f=this.f+(e.f-this.f)*i,n}transformPoint(e,i){const{a:n,b:o,c:l,d:u,e:d,f}=this,g=n*u-o*l,_=u/g,y=-o/g,b=-l/g,S=n/g,v=(l*f-u*d)/g,A=-(n*f-o*d)/g,{x,y:T}=e;i.x=x*_+T*b+v,i.y=x*y+T*S+A}onlyTranslate(e=1){return this.a===e&&this.b===0&&this.c===0&&this.d===e}clone(){return new Matrix(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const e=this.a,i=this.b,n=this.c,o=this.d,l=e*o-i*n,u={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!==0||i!==0){const d=Math.sqrt(e*e+i*i);u.rotateDeg=i>0?Math.acos(e/d):-Math.acos(e/d),u.scaleX=d,u.scaleY=l/d,u.skewX=(e*n+i*o)/l,u.skewY=0}else if(n!==0||o!==0){const d=Math.sqrt(n*n+o*o);u.rotateDeg=Math.PI/2-(o>0?Math.acos(-n/d):-Math.acos(n/d)),u.scaleX=l/d,u.scaleY=d,u.skewX=0,u.skewY=(e*n+i*o)/l}return u.rotateDeg=radianToDegree(u.rotateDeg),u}}function normalTransform(r,e,i,n,o,l,u,d){const f=e.a,g=e.b,_=e.c,y=e.d,b=e.e,S=e.f,v=cos$1(u),A=sin$1(u);let x,T;d?(x=d[0],T=d[1]):(x=i,T=n);const C=x-i,E=T-n,P=f*v+_*A,L=g*v+y*A,R=_*v-f*A,w=y*v-g*A;r.a=o*P,r.b=o*L,r.c=l*R,r.d=l*w,r.e=b+f*x+_*T-P*C-R*E,r.f=S+g*x+y*T-L*C-w*E}class LRU{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(e,i){const{CLEAN_THRESHOLD:n=this.CLEAN_THRESHOLD,L_TIME:o=this.L_TIME,R_COUNT:l=this.R_COUNT}=i;if(e.size<n)return 0;let u=0;const d=g=>{u++,e.delete(g)},f=Date.now();return e.forEach((g,_)=>{if(g.timestamp.length<l)return d(_);let y=0;for(;f-g.timestamp[g.timestamp.length-1-y]<o&&(y++,!(y>=l)););if(y<l)return d(_);for(;f-g.timestamp[0]>o;)g.timestamp.shift()}),u}addLimitedTimestamp(e,i,n){const{R_TIMESTAMP_MAX_SIZE:o=this.R_TIMESTAMP_MAX_SIZE}=n;e.timestamp.length>o&&e.timestamp.shift(),e.timestamp.push(i)}clearTimeStamp(e,i){const{L_TIME:n=this.L_TIME}=i,o=Date.now();e.forEach(l=>{for(;o-l.timestamp[0]>n;)l.timestamp.shift()})}clearItemTimestamp(e,i){const{L_TIME:n=this.L_TIME}=i,o=Date.now();for(;o-e.timestamp[0]>n;)e.timestamp.shift()}}function hslToRgb(r,e,i){e/=100,i/=100;const n=(1-Math.abs(2*i-1))*e,o=n*(1-Math.abs(r/60%2-1)),l=i-n/2;let u=0,d=0,f=0;return 0<=r&&r<60?(u=n,d=o,f=0):60<=r&&r<120?(u=o,d=n,f=0):120<=r&&r<180?(u=0,d=n,f=o):180<=r&&r<240?(u=0,d=o,f=n):240<=r&&r<300?(u=o,d=0,f=n):300<=r&&r<360&&(u=n,d=0,f=o),u=Math.round(255*(u+l)),d=Math.round(255*(d+l)),f=Math.round(255*(f+l)),{r:u,g:d,b:f}}function rgbToHsl(r,e,i){r/=255,e/=255,i/=255;const n=Math.min(r,e,i),o=Math.max(r,e,i),l=o-n;let u=0,d=0,f=0;return u=l===0?0:o===r?(e-i)/l%6:o===e?(i-r)/l+2:(r-e)/l+4,u=Math.round(60*u),u<0&&(u+=360),f=(o+n)/2,d=l===0?0:l/(1-Math.abs(2*f-1)),d=+(100*d).toFixed(1),f=+(100*f).toFixed(1),{h:u,s:d,l:f}}const REG_HEX=/^#([0-9a-f]{3,8})$/,DEFAULT_COLORS_OPACITY={transparent:4294967040},DEFAULT_COLORS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function hex(r){return((r=Math.max(0,Math.min(255,Math.round(r)||0)))<16?"0":"")+r.toString(16)}function rgb(r){return isNumber(r)?new RGB(r>>16,r>>8&255,255&r,1):isArray(r)?new RGB(r[0],r[1],r[2]):new RGB(255,255,255)}function rgba(r){return isNumber(r)?new RGB(r>>>24,r>>>16&255,r>>>8&255,255&r):isArray(r)?new RGB(r[0],r[1],r[2],r[3]):new RGB(255,255,255,1)}function SRGBToLinear(r){return r<.04045?.0773993808*r:Math.pow(.9478672986*r+.0521327014,2.4)}function LinearToSRGB(r){return r<.0031308?12.92*r:1.055*Math.pow(r,.41666)-.055}const setHex=(r,e)=>{const i=REG_HEX.exec(r);if(e||i){const n=parseInt(i[1],16),o=i[1].length;return o===3?new RGB((n>>8&15)+((n>>8&15)<<4),(n>>4&15)+((n>>4&15)<<4),(15&n)+((15&n)<<4),1):o===6?rgb(n):o===8?new RGB(n>>24&255,n>>16&255,n>>8&255,(255&n)/255):null}};class Color{static Brighter(e,i=1){return i===1?e:new Color(e).brighter(i).toRGBA()}static SetOpacity(e,i=1){return i===1?e:new Color(e).setOpacity(i).toRGBA()}static getColorBrightness(e,i="hsl"){const n=e instanceof Color?e:new Color(e);switch(i){case"hsv":default:return n.getHSVBrightness();case"hsl":return n.getHSLBrightness();case"lum":return n.getLuminance();case"lum2":return n.getLuminance2();case"lum3":return n.getLuminance3();case"wcag":return n.getLuminanceWCAG()}}static parseColorString(e){if(isValid(DEFAULT_COLORS_OPACITY[e]))return rgba(DEFAULT_COLORS_OPACITY[e]);if(isValid(DEFAULT_COLORS[e]))return rgb(DEFAULT_COLORS[e]);const i=`${e}`.trim().toLowerCase(),n=setHex(i);if(n!==void 0)return n;if(/^(rgb|RGB|rgba|RGBA)/.test(i)){const o=i.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new RGB(parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10),parseFloat(o[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(i)){const o=i.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),l=hslToRgb(parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10));return new RGB(l.r,l.g,l.b,parseFloat(o[3]))}}constructor(e){const i=Color.parseColorString(e);i?this.color=i:(console.warn(`Warn: ${e}Color`),this.color=new RGB(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(e){const{r:i,g:n,b:o}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(i*e))),this.color.g=Math.max(0,Math.min(255,Math.floor(n*e))),this.color.b=Math.max(0,Math.min(255,Math.floor(o*e))),this}add(e){const{r:i,g:n,b:o}=this.color;return this.color.r+=Math.min(255,i+e.color.r),this.color.g+=Math.min(255,n+e.color.g),this.color.b+=Math.min(255,o+e.color.b),this}sub(e){return this.color.r=Math.max(0,this.color.r-e.color.r),this.color.g=Math.max(0,this.color.g-e.color.g),this.color.b=Math.max(0,this.color.b-e.color.b),this}multiply(e){const{r:i,g:n,b:o}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(i*e.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(n*e.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(o*e.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(e,i,n){const o=this.color.opacity,l=rgbToHsl(this.color.r,this.color.g,this.color.b),u=hslToRgb(isNil(e)?l.h:clamp(e,0,360),isNil(i)?l.s:i>=0&&i<=1?100*i:i,isNil(n)?l.l:n<=1&&n>=0?100*n:n);return this.color=new RGB(u.r,u.g,u.b,o),this}setRGB(e,i,n){return!isNil(e)&&(this.color.r=e),!isNil(i)&&(this.color.g=i),!isNil(n)&&(this.color.b=n),this}setHex(e){const i=`${e}`.trim().toLowerCase(),n=setHex(i,!0);return n??this}setColorName(e){const i=DEFAULT_COLORS[e.toLowerCase()];return i!==void 0?this.setHex(i):console.warn("THREE.Color: Unknown color "+e),this}setScalar(e){return this.color.r=e,this.color.g=e,this.color.b=e,this}setOpacity(e=1){return this.color.opacity=e,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const e=this.color.r/255,i=this.color.g/255,n=this.color.b/255;let o,l,u;return o=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),l=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),u=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),.2126*o+.7152*l+.0722*u}clone(){return new Color(this.color.toString())}copyGammaToLinear(e,i=2){return this.color.r=Math.pow(e.color.r,i),this.color.g=Math.pow(e.color.g,i),this.color.b=Math.pow(e.color.b,i),this}copyLinearToGamma(e,i=2){const n=i>0?1/i:1;return this.color.r=Math.pow(e.color.r,n),this.color.g=Math.pow(e.color.g,n),this.color.b=Math.pow(e.color.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.color.r=SRGBToLinear(e.color.r),this.color.g=SRGBToLinear(e.color.g),this.color.b=SRGBToLinear(e.color.b),this}copyLinearToSRGB(e){return this.color.r=LinearToSRGB(e.color.r),this.color.g=LinearToSRGB(e.color.g),this.color.b=LinearToSRGB(e.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class RGB{constructor(e,i,n,o){this.r=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.g=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),this.b=isNaN(+n)?255:Math.max(0,Math.min(255,+n)),isValid(o)?this.opacity=isNaN(+o)?1:Math.max(0,Math.min(1,+o)):this.opacity=1}formatHex(){return`#${hex(this.r)+hex(this.g)+hex(this.b)+(this.opacity===1?"":hex(255*this.opacity))}`}formatRgb(){const e=this.opacity;return`${e===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${e===1?")":`,${e})`}`}formatHsl(){const e=this.opacity,{h:i,s:n,l:o}=rgbToHsl(this.r,this.g,this.b);return`${e===1?"hsl(":"hsla("}${i},${n}%,${o}%${e===1?")":`,${e})`}`}toString(){return this.formatHex()}}function hexToRgb(r){let e="",i="",n="";const o=r[0]==="#"?1:0;for(let l=o;l<r.length;l++)r[l]!=="#"&&(l<o+2?e+=r[l]:l<o+4?i+=r[l]:l<o+6&&(n+=r[l]));return[parseInt(e,16),parseInt(i,16),parseInt(n,16)]}function rgbToHex(r,e,i){return Number((1<<24)+(r<<16)+(e<<8)+i).toString(16).slice(1)}function interpolateRgb$1(r,e){const i=r.r,n=e.r,o=r.g,l=e.g,u=r.b,d=e.b,f=r.opacity,g=e.opacity;return _=>{const y=Math.round(i*(1-_)+n*_),b=Math.round(o*(1-_)+l*_),S=Math.round(u*(1-_)+d*_);return new RGB(y,b,S,f*(1-_)+g*_)}}const ColorUtil=Object.freeze(Object.defineProperty({__proto__:null,Color,DEFAULT_COLORS,RGB,hexToRgb,hslToRgb,interpolateRgb:interpolateRgb$1,rgbToHex,rgbToHsl},Symbol.toStringTag,{value:"Module"}));function normalizePadding$1(r){if(isValidNumber(r))return[r,r,r,r];if(isArray(r)){const e=r.length;if(e===1){const i=r[0];return[i,i,i,i]}if(e===2){const[i,n]=r;return[i,n,i,n]}if(e===3){const[i,n,o]=r;return[i,n,o,n]}if(e===4)return r}if(isObject$1(r)){const{top:e=0,right:i=0,bottom:n=0,left:o=0}=r;return[e,i,n,o]}return[0,0,0,0]}function getContainerSize(r,e=0,i=0){if(!r)return{width:e,height:i};let n;try{n=window==null?void 0:window.getComputedStyle}catch{n=()=>({})}const o=n(r);if(/^(\d*\.?\d+)(px)$/.exec(o.width)){const l=parseFloat(o.width)-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)||r.clientWidth-1,u=parseFloat(o.height)-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)||r.clientHeight-1;return{width:l<=0?e:l,height:u<=0?i:u}}return{width:e,height:i}}function getElementAbsolutePosition(r){const{x:e,y:i}=r.getBoundingClientRect();return{x:e,y:i}}const styleStringToObject=(r="")=>{const e={};return r.split(";").forEach(i=>{if(i){const n=i.split(":");if(n.length===2){const o=n[0].trim(),l=n[1].trim();o&&l&&(e[o]=l)}}}),e},lowerCamelCaseToMiddle=r=>r.replace(/([A-Z])/g,"-$1").toLowerCase();var earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:earthRadius/111325,feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936};function feature$2(r,e,i){i===void 0&&(i={});var n={type:"Feature"};return(i.id===0||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=r,n}function featureCollection(r,e){e===void 0&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=r,i}function lengthToRadians(r,e){e===void 0&&(e="kilometers");var i=factors[e];if(!i)throw new Error(e+" units is invalid");return r/i}function isObject(r){return!!r&&r.constructor===Object}function getGeom(r){return r.type==="Feature"?r.geometry:r}function isPointInPolygon(r,e){if(!r||!e)return!1;const i=getGeom(e),n=i.type,o=e.bbox;let l=i.coordinates;if(o&&pointInRect(r,{x1:o[0],x2:o[1],y1:o[1],y2:o[3]},!0)===!0)return!1;n==="Polygon"&&(l=[l]);let u=!1;for(let d=0;d<l.length;++d)for(let f=0;f<l[d].length;++f)if(polygonContainPoint(l[d][f].map(g=>({x:g[0],y:g[1]})),r.x,r.y))return u=!0,u;return u}function destination(r,e,i,n={}){const o=degreeToRadian(r[0]),l=degreeToRadian(r[1]),u=degreeToRadian(i),d=lengthToRadians(e,n.units),f=Math.asin(Math.sin(l)*Math.cos(d)+Math.cos(l)*Math.sin(d)*Math.cos(u)),g=o+Math.atan2(Math.sin(u)*Math.sin(d)*Math.cos(l),Math.cos(d)-Math.sin(l)*Math.sin(f));return{x:radianToDegree(g),y:radianToDegree(f)}}class TimeUtil{static getInstance(){return TimeUtil.instance||(TimeUtil.instance=new TimeUtil),TimeUtil.instance}constructor(){this.locale_shortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.locale_periods=["AM","PM"],this.locale_weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.locale_shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.numberRe=/^\s*\d+/,this.pads={"-":"",_:" ",0:"0"},this.requoteRe=/[\\^$*+?|[\]().{}]/g,this.locale_months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.formatShortWeekday=e=>this.locale_shortWeekdays[e.getDay()],this.formatWeekday=e=>this.locale_weekdays[e.getDay()],this.formatShortMonth=e=>this.locale_shortMonths[e.getMonth()],this.formatMonth=e=>this.locale_months[e.getMonth()],this.formatDayOfMonth=(e,i)=>this.pad(e.getDate(),i,2),this.formatHour24=(e,i)=>this.pad(e.getHours(),i,2),this.formatHour12=(e,i)=>this.pad(e.getHours()%12||12,i,2),this.formatMilliseconds=(e,i)=>this.pad(e.getMilliseconds(),i,3),this.formatMonthNumber=(e,i)=>this.pad(e.getMonth()+1,i,2),this.formatMinutes=(e,i)=>this.pad(e.getMinutes(),i,2),this.formatPeriod=e=>this.locale_periods[+(e.getHours()>=12)],this.formatSeconds=(e,i)=>this.pad(e.getSeconds(),i,2),this.formatFullYear=(e,i)=>this.pad(e.getFullYear()%1e4,i,4),this.formatUTCShortWeekday=e=>this.locale_shortWeekdays[e.getUTCDay()],this.formatUTCWeekday=e=>this.locale_weekdays[e.getUTCDay()],this.formatUTCShortMonth=e=>this.locale_shortMonths[e.getUTCMonth()],this.formatUTCMonth=e=>this.locale_months[e.getUTCMonth()],this.formatUTCDayOfMonth=(e,i)=>this.pad(e.getUTCDate(),i,2),this.formatUTCHour24=(e,i)=>this.pad(e.getUTCHours(),i,2),this.formatUTCHour12=(e,i)=>this.pad(e.getUTCHours()%12||12,i,2),this.formatUTCMilliseconds=(e,i)=>this.pad(e.getUTCMilliseconds(),i,3),this.formatUTCMonthNumber=(e,i)=>this.pad(e.getUTCMonth()+1,i,2),this.formatUTCMinutes=(e,i)=>this.pad(e.getUTCMinutes(),i,2),this.formatUTCPeriod=e=>this.locale_periods[+(e.getUTCHours()>=12)],this.formatUTCSeconds=(e,i)=>this.pad(e.getUTCSeconds(),i,2),this.formatUTCFullYear=(e,i)=>this.pad(e.getUTCFullYear()%1e4,i,4),this.formats={a:this.formatShortWeekday,A:this.formatWeekday,b:this.formatShortMonth,B:this.formatMonth,d:this.formatDayOfMonth,e:this.formatDayOfMonth,H:this.formatHour24,I:this.formatHour12,L:this.formatMilliseconds,m:this.formatMonthNumber,M:this.formatMinutes,p:this.formatPeriod,S:this.formatSeconds,Y:this.formatFullYear},this.utcFormats={a:this.formatUTCShortWeekday,A:this.formatUTCWeekday,b:this.formatUTCShortMonth,B:this.formatUTCMonth,d:this.formatUTCDayOfMonth,e:this.formatUTCDayOfMonth,H:this.formatUTCHour24,I:this.formatUTCHour12,L:this.formatUTCMilliseconds,m:this.formatUTCMonthNumber,M:this.formatUTCMinutes,p:this.formatUTCPeriod,S:this.formatUTCSeconds,Y:this.formatUTCFullYear},this.parseShortWeekday=(e,i,n)=>{const o=this.shortWeekdayRe.exec(i.slice(n));return o?(e.w=this.shortWeekdayLookup.get(o[0].toLowerCase()),n+o[0].length):-1},this.parseWeekday=(e,i,n)=>{const o=this.weekdayRe.exec(i.slice(n));return o?(e.w=this.weekdayLookup.get(o[0].toLowerCase()),n+o[0].length):-1},this.parseShortMonth=(e,i,n)=>{const o=this.shortMonthRe.exec(i.slice(n));return o?(e.m=this.shortMonthLookup.get(o[0].toLowerCase()),n+o[0].length):-1},this.parseMonth=(e,i,n)=>{const o=this.monthRe.exec(i.slice(n));return o?(e.m=this.monthLookup.get(o[0].toLowerCase()),n+o[0].length):-1},this.parseDayOfMonth=(e,i,n)=>{const o=this.numberRe.exec(i.slice(n,n+2));return o?(e.d=+o[0],n+o[0].length):-1},this.parseHour24=(e,i,n)=>{const o=this.numberRe.exec(i.slice(n,n+2));return o?(e.H=+o[0],n+o[0].length):-1},this.parseMilliseconds=(e,i,n)=>{const o=this.numberRe.exec(i.slice(n,n+3));return o?(e.L=+o[0],n+o[0].length):-1},this.parseMonthNumber=(e,i,n)=>{const o=this.numberRe.exec(i.slice(n,n+2));return o?(e.m=o-1,n+o[0].length):-1},this.parseMinutes=(e,i,n)=>{const o=this.numberRe.exec(i.slice(n,n+2));return o?(e.M=+o[0],n+o[0].length):-1},this.parsePeriod=(e,i,n)=>{const o=this.periodRe.exec(i.slice(n));return o?(e.p=this.periodLookup.get(o[0].toLowerCase()),n+o[0].length):-1},this.parseSeconds=(e,i,n)=>{const o=this.numberRe.exec(i.slice(n,n+2));return o?(e.S=+o[0],n+o[0].length):-1},this.parseFullYear=(e,i,n)=>{const o=this.numberRe.exec(i.slice(n,n+4));return o?(e.y=+o[0],n+o[0].length):-1},this.parses={a:this.parseShortWeekday,A:this.parseWeekday,b:this.parseShortMonth,B:this.parseMonth,d:this.parseDayOfMonth,e:this.parseDayOfMonth,H:this.parseHour24,I:this.parseHour24,L:this.parseMilliseconds,m:this.parseMonthNumber,M:this.parseMinutes,p:this.parsePeriod,S:this.parseSeconds,Y:this.parseFullYear},this.timeFormat=(e,i)=>this.newFormat(e,this.formats)(new Date(this.getFullTimeStamp(i))),this.timeUTCFormat=(e,i)=>this.newFormat(e,this.utcFormats)(new Date(this.getFullTimeStamp(i))),this.timeParse=(e,i)=>this.newParse(e,!1)(i+""),this.requoteF=this.requote.bind(this),this.periodRe=this.formatRe(this.locale_periods),this.periodLookup=this.formatLookup(this.locale_periods),this.weekdayRe=this.formatRe(this.locale_weekdays),this.weekdayLookup=this.formatLookup(this.locale_weekdays),this.shortWeekdayRe=this.formatRe(this.locale_shortWeekdays),this.shortWeekdayLookup=this.formatLookup(this.locale_shortWeekdays),this.monthRe=this.formatRe(this.locale_months),this.monthLookup=this.formatLookup(this.locale_months),this.shortMonthRe=this.formatRe(this.locale_shortMonths),this.shortMonthLookup=this.formatLookup(this.locale_shortMonths)}requote(e){return e.replace(this.requoteRe,"\\$&")}localDate(e){if(0<=e.y&&e.y<100){const i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}utcDate(e){if(0<=e.y&&e.y<100){const i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}newDate(e,i,n){return{y:e,m:i,d:n,H:0,M:0,S:0,L:0}}formatRe(e){return new RegExp("^(?:"+e.map(this.requoteF).join("|")+")","i")}formatLookup(e){return new Map(e.map((i,n)=>[i.toLowerCase(),n]))}pad(e,i,n){const o=e<0?"-":"",l=(o?-e:e)+"",u=l.length;return o+(u<n?new Array(n-u+1).join(i)+l:l)}parseSpecifier(e,i,n,o){let l=0;const u=i.length,d=n.length;let f,g;for(;l<u;){if(o>=d)return-1;if(f=i.charCodeAt(l++),f===37){if(f=i.charAt(l++),g=this.parses[f in this.pads?i.charAt(l++):f],!g||(o=g(e,n,o))<0)return-1}else if(f!==n.charCodeAt(o++))return-1}return o}newParse(e,i){const n=this;return function(o){const l=n.newDate(1900,void 0,1);return n.parseSpecifier(l,e,o+="",0)!==o.length?null:"Q"in l?new Date(l.Q):"s"in l?new Date(1e3*l.s+("L"in l?l.L:0)):(i&&!("Z"in l)&&(l.Z=0),"p"in l&&(l.H=l.H%12+12*l.p),l.m===void 0&&(l.m="q"in l?l.q:0),"Z"in l?(l.H+=l.Z/100|0,l.M+=l.Z%100,n.utcDate(l)):n.localDate(l))}}newFormat(e,i){const n=this;return function(o){const l=[];let u=-1,d=0;const f=e.length;let g,_,y;for(o instanceof Date||(o=new Date(+o));++u<f;)e.charCodeAt(u)===37&&(l.push(e.slice(d,u)),(_=n.pads[g=e.charAt(++u)])?g=e.charAt(++u):_=g==="e"?" ":"0",y=i[g],g=y(o,_),l.push(g),d=u+1);return l.push(e.slice(d,u)),l.join("")}}getFullTimeStamp(e){const i=parseInt(e+"",10);return String(i).length===10?1e3*i:i}}function formatDecimal(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function formatDecimalParts(r,e){const i=e?r.toExponential(e-1):r.toExponential(),n=i.indexOf("e");if(n<0)return null;const o=i.slice(0,n);return[o.length>1?o[0]+o.slice(2):o,+i.slice(n+1)]}function formatGroup(r,e){return function(i,n){let o=i.length;const l=[];let u=0,d=r[0],f=0;for(;o>0&&d>0&&(f+d+1>n&&(d=Math.max(1,n-f)),l.push(i.substring(o-=d,o+d)),!((f+=d+1)>n));)d=r[u=(u+1)%r.length];return l.reverse().join(e)}}let prefixExponent;function formatPrefixAuto(r,e){const i=formatDecimalParts(r,e);if(!i)return r+"";const n=i[0],o=i[1],l=o-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(o/3))))+1,u=n.length;return l===u?n:l>u?n+new Array(l-u+1).join("0"):l>0?n.slice(0,l)+"."+n.slice(l):"0."+new Array(1-l).join("0")+formatDecimalParts(r,Math.max(0,e+l-1))[0]}function formatRounded(r,e){const i=formatDecimalParts(r,e);if(!i)return r+"";const n=i[0],o=i[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}function formatTrim(r){const e=r.length;let i,n=-1;e:for(let o=1;o<e;++o)switch(r[o]){case".":n=i=o;break;case"0":n===0&&(n=o),i=o;break;default:if(!+r[o])break e;n>0&&(n=0)}return n>0?r.slice(0,n)+r.slice(i+1):r}class FormatSpecifier{constructor(e={}){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}toString(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type}}const numberSpecifierReg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(r){let e;if(e=numberSpecifierReg.exec(r))return new FormatSpecifier({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]});Logger.getInstance().error("invalid format: "+r)}const prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];class NumberUtil{constructor(){this.locale={thousands:",",grouping:[3],currency:["$",""]},this.group=this.locale.grouping===void 0||this.locale.thousands===void 0?e=>e:formatGroup([...this.locale.grouping].map(Number),`${this.locale.thousands}`),this.currencyPrefix=this.locale.currency===void 0?"":this.locale.currency[0]+"",this.currencySuffix=this.locale.currency===void 0?"":this.locale.currency[1]+"",this.decimal=this.locale.decimal===void 0?".":this.locale.decimal+"",this.numerals=this.locale.numerals===void 0?e=>e:formatNumerals([...this.locale.numerals].map(String)),this.percent=this.locale.percent===void 0?"%":this.locale.percent+"",this.minus=this.locale.minus===void 0?"":this.locale.minus+"",this.nan=this.locale.nan===void 0?"NaN":this.locale.nan+"",this.formatter=e=>this.newFormat(e),this.format=(e,i)=>this.formatter(e)(i),this.formatPrefix=(e,i)=>this._formatPrefix(e,i)}static getInstance(){return NumberUtil.instance||(NumberUtil.instance=new NumberUtil),NumberUtil.instance}newFormat(e){const i=formatSpecifier(e);let n=i.fill,o=i.align;const l=i.sign,u=i.symbol;let d=i.zero;const f=i.width;let g=i.comma,_=i.precision,y=i.trim,b=i.type;b==="n"?(g=!0,b="g"):formatTypes[b]||(_===void 0&&(_=12),y=!0,b="g"),(d||n==="0"&&o==="=")&&(d=!0,n="0",o="=");const S=u==="$"?this.currencyPrefix:u==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",v=u==="$"?this.currencySuffix:/[%p]/.test(b)?this.percent:"",A=formatTypes[b],x=/[defgprstz%]/.test(b);_=_===void 0?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_));const{nan:T,minus:C,decimal:E,group:P,numerals:L}=this;function R(w){let D,I,O,B=S,N=v,$=w;if(b==="c")N=A($)+N,$="";else{$=+$;let V=$<0||1/$<0;if($=isNaN($)?T:A(Math.abs($),_),y&&($=formatTrim($)),V&&+$==0&&l!=="+"&&(V=!1),B=(V?l==="("?l:C:l==="-"||l==="("?"":l)+B,N=(b==="s"?prefixes[8+prefixExponent/3]:"")+N+(V&&l==="("?")":""),x){for(D=-1,I=$.length;++D<I;)if(O=$.charCodeAt(D),48>O||O>57){N=(O===46?E+$.slice(D+1):$.slice(D))+N,$=$.slice(0,D);break}}}g&&!d&&($=P($,1/0));let H=B.length+$.length+N.length,F=H<f?new Array(f-H+1).join(n):"";switch(g&&d&&($=P(F+$,F.length?f-N.length:1/0),F=""),o){case"<":$=B+$+N+F;break;case"=":$=B+F+$+N;break;case"^":$=F.slice(0,H=F.length>>1)+B+$+N+F.slice(H);break;default:$=F+B+$+N}return L($)}return R.toString=function(){return e+""},R}_formatPrefix(e,i){const n=formatSpecifier(e);n.type="f";const o=this.newFormat(n.toString()),l=3*Math.max(-8,Math.min(8,Math.floor(exponent(i)/3))),u=Math.pow(10,-l),d=prefixes[8+l/3];return function(f){return o(u*f)+d}}}const formatTypes={"%":(r,e)=>(100*r).toFixed(e),b:r=>Math.round(r).toString(2),c:r=>r+"",d:formatDecimal,f:(r,e)=>r.toFixed(e),e:(r,e)=>r.toExponential(e),g:(r,e)=>r.toPrecision(e),o:r=>Math.round(r).toString(8),p:(r,e)=>formatRounded(100*r,e),r:formatRounded,s:formatPrefixAuto,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16),t:(r,e)=>Number.isInteger(r)?r.toFixed(2):Math.floor(r*Math.pow(10,e))/Math.pow(10,e)+"",z:(r,e)=>r%1==0?r+"":r.toFixed(e)};function exponent(r){const e=formatDecimalParts(Math.abs(r));return e?e[1]:NaN}function formatNumerals(r){return function(e){return e.replace(/[0-9]/g,i=>r[+i])}}const filter=(r,e)=>{const{callback:i}=e;return i&&(r=r.filter(i)),r};function adder(){return new Adder}function Adder(){this.reset()}Adder.prototype={constructor:Adder,reset:function(){this.s=this.t=0},add:function(r){add(temp$1,r,this.t),add(this,temp$1.s,this.s),this.s?this.t+=temp$1.t:this.s=temp$1.t},valueOf:function(){return this.s}};var temp$1=new Adder;function add(r,e,i){var n=r.s=e+i,o=n-e,l=n-o;r.t=e-l+(i-o)}var epsilon=1e-6,epsilon2=1e-12,pi=Math.PI,halfPi$1=pi/2,quarterPi=pi/4,tau=pi*2,degrees=180/pi,radians=pi/180,abs=Math.abs,atan=Math.atan,atan2=Math.atan2,cos=Math.cos,exp=Math.exp,log=Math.log,pow=Math.pow,sin=Math.sin,sign$1=Math.sign||function(r){return r>0?1:r<0?-1:0},sqrt$2=Math.sqrt,tan=Math.tan;function acos(r){return r>1?0:r<-1?pi:Math.acos(r)}function asin(r){return r>1?halfPi$1:r<-1?-halfPi$1:Math.asin(r)}function noop(){}function streamGeometry(r,e){r&&streamGeometryType.hasOwnProperty(r.type)&&streamGeometryType[r.type](r,e)}var streamObjectType={Feature:function(r,e){streamGeometry(r.geometry,e)},FeatureCollection:function(r,e){for(var i=r.features,n=-1,o=i.length;++n<o;)streamGeometry(i[n].geometry,e)}},streamGeometryType={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var i=r.coordinates,n=-1,o=i.length;++n<o;)r=i[n],e.point(r[0],r[1],r[2])},LineString:function(r,e){streamLine(r.coordinates,e,0)},MultiLineString:function(r,e){for(var i=r.coordinates,n=-1,o=i.length;++n<o;)streamLine(i[n],e,0)},Polygon:function(r,e){streamPolygon(r.coordinates,e)},MultiPolygon:function(r,e){for(var i=r.coordinates,n=-1,o=i.length;++n<o;)streamPolygon(i[n],e)},GeometryCollection:function(r,e){for(var i=r.geometries,n=-1,o=i.length;++n<o;)streamGeometry(i[n],e)}};function streamLine(r,e,i){var n=-1,o=r.length-i,l;for(e.lineStart();++n<o;)l=r[n],e.point(l[0],l[1],l[2]);e.lineEnd()}function streamPolygon(r,e){var i=-1,n=r.length;for(e.polygonStart();++i<n;)streamLine(r[i],e,1);e.polygonEnd()}function geoStream(r,e){r&&streamObjectType.hasOwnProperty(r.type)?streamObjectType[r.type](r,e):streamGeometry(r,e)}function spherical(r){return[atan2(r[1],r[0]),asin(r[2])]}function cartesian(r){var e=r[0],i=r[1],n=cos(i);return[n*cos(e),n*sin(e),sin(i)]}function cartesianDot(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function cartesianCross(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function cartesianAddInPlace(r,e){r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]}function cartesianScale(r,e){return[r[0]*e,r[1]*e,r[2]*e]}function cartesianNormalizeInPlace(r){var e=sqrt$2(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=e,r[1]/=e,r[2]/=e}function compose(r,e){function i(n,o){return n=r(n,o),e(n[0],n[1])}return r.invert&&e.invert&&(i.invert=function(n,o){return n=e.invert(n,o),n&&r.invert(n[0],n[1])}),i}function rotationIdentity(r,e){return[abs(r)>pi?r+Math.round(-r/tau)*tau:r,e]}rotationIdentity.invert=rotationIdentity;function rotateRadians(r,e,i){return(r%=tau)?e||i?compose(rotationLambda(r),rotationPhiGamma(e,i)):rotationLambda(r):e||i?rotationPhiGamma(e,i):rotationIdentity}function forwardRotationLambda(r){return function(e,i){return e+=r,[e>pi?e-tau:e<-pi?e+tau:e,i]}}function rotationLambda(r){var e=forwardRotationLambda(r);return e.invert=forwardRotationLambda(-r),e}function rotationPhiGamma(r,e){var i=cos(r),n=sin(r),o=cos(e),l=sin(e);function u(d,f){var g=cos(f),_=cos(d)*g,y=sin(d)*g,b=sin(f),S=b*i+_*n;return[atan2(y*o-S*l,_*i-b*n),asin(S*o+y*l)]}return u.invert=function(d,f){var g=cos(f),_=cos(d)*g,y=sin(d)*g,b=sin(f),S=b*o-y*l;return[atan2(y*o+b*l,_*i+S*n),asin(S*i-_*n)]},u}function rotation(r){r=rotateRadians(r[0]*radians,r[1]*radians,r.length>2?r[2]*radians:0);function e(i){return i=r(i[0]*radians,i[1]*radians),i[0]*=degrees,i[1]*=degrees,i}return e.invert=function(i){return i=r.invert(i[0]*radians,i[1]*radians),i[0]*=degrees,i[1]*=degrees,i},e}function circleStream(r,e,i,n,o,l){if(i){var u=cos(e),d=sin(e),f=n*i;o==null?(o=e+n*tau,l=e-f/2):(o=circleRadius(u,o),l=circleRadius(u,l),(n>0?o<l:o>l)&&(o+=n*tau));for(var g,_=o;n>0?_>l:_<l;_-=f)g=spherical([u,-d*cos(_),-d*sin(_)]),r.point(g[0],g[1])}}function circleRadius(r,e){e=cartesian(e),e[0]-=r,cartesianNormalizeInPlace(e);var i=acos(-e[1]);return((-e[2]<0?-i:i)+tau-epsilon)%tau}function clipBuffer(){var r=[],e;return{point:function(i,n,o){e.push([i,n,o])},lineStart:function(){r.push(e=[])},lineEnd:noop,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var i=r;return r=[],e=null,i}}}function pointEqual(r,e){return abs(r[0]-e[0])<epsilon&&abs(r[1]-e[1])<epsilon}function Intersection(r,e,i,n){this.x=r,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function clipRejoin(r,e,i,n,o){var l=[],u=[],d,f;if(r.forEach(function(v){if(!((A=v.length-1)<=0)){var A,x=v[0],T=v[A],C;if(pointEqual(x,T)){if(!x[2]&&!T[2]){for(o.lineStart(),d=0;d<A;++d)o.point((x=v[d])[0],x[1]);o.lineEnd();return}T[0]+=2*epsilon}l.push(C=new Intersection(x,v,null,!0)),u.push(C.o=new Intersection(x,null,C,!1)),l.push(C=new Intersection(T,v,null,!1)),u.push(C.o=new Intersection(T,null,C,!0))}}),!!l.length){for(u.sort(e),link$1(l),link$1(u),d=0,f=u.length;d<f;++d)u[d].e=i=!i;for(var g=l[0],_,y;;){for(var b=g,S=!0;b.v;)if((b=b.n)===g)return;_=b.z,o.lineStart();do{if(b.v=b.o.v=!0,b.e){if(S)for(d=0,f=_.length;d<f;++d)o.point((y=_[d])[0],y[1]);else n(b.x,b.n.x,1,o);b=b.n}else{if(S)for(_=b.p.z,d=_.length-1;d>=0;--d)o.point((y=_[d])[0],y[1]);else n(b.x,b.p.x,-1,o);b=b.p}b=b.o,_=b.z,S=!S}while(!b.v);o.lineEnd()}}}function link$1(r){if(e=r.length){for(var e,i=0,n=r[0],o;++i<e;)n.n=o=r[i],o.p=n,n=o;n.n=o=r[0],o.p=n}}var sum$2=adder();function longitude(r){return abs(r[0])<=pi?r[0]:sign$1(r[0])*((abs(r[0])+pi)%tau-pi)}function polygonContains(r,e){var i=longitude(e),n=e[1],o=sin(n),l=[sin(i),-cos(i),0],u=0,d=0;sum$2.reset(),o===1?n=halfPi$1+epsilon:o===-1&&(n=-halfPi$1-epsilon);for(var f=0,g=r.length;f<g;++f)if(y=(_=r[f]).length)for(var _,y,b=_[y-1],S=longitude(b),v=b[1]/2+quarterPi,A=sin(v),x=cos(v),T=0;T<y;++T,S=E,A=L,x=R,b=C){var C=_[T],E=longitude(C),P=C[1]/2+quarterPi,L=sin(P),R=cos(P),w=E-S,D=w>=0?1:-1,I=D*w,O=I>pi,B=A*L;if(sum$2.add(atan2(B*D*sin(I),x*R+B*cos(I))),u+=O?w+D*tau:w,O^S>=i^E>=i){var N=cartesianCross(cartesian(b),cartesian(C));cartesianNormalizeInPlace(N);var $=cartesianCross(l,N);cartesianNormalizeInPlace($);var H=(O^w>=0?-1:1)*asin($[2]);(n>H||n===H&&(N[0]||N[1]))&&(d+=O^w>=0?1:-1)}}return(u<-1e-6||u<epsilon&&sum$2<-1e-6)^d&1}function ascending(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function bisector(r){return r.length===1&&(r=ascendingComparator(r)),{left:function(e,i,n,o){for(n==null&&(n=0),o==null&&(o=e.length);n<o;){var l=n+o>>>1;r(e[l],i)<0?n=l+1:o=l}return n},right:function(e,i,n,o){for(n==null&&(n=0),o==null&&(o=e.length);n<o;){var l=n+o>>>1;r(e[l],i)>0?o=l:n=l+1}return n}}}function ascendingComparator(r){return function(e,i){return ascending(r(e),i)}}bisector(ascending);function merge(r){for(var e=r.length,i,n=-1,o=0,l,u;++n<e;)o+=r[n].length;for(l=new Array(o);--e>=0;)for(u=r[e],i=u.length;--i>=0;)l[--o]=u[i];return l}function clip(r,e,i,n){return function(o){var l=e(o),u=clipBuffer(),d=e(u),f=!1,g,_,y,b={point:S,lineStart:A,lineEnd:x,polygonStart:function(){b.point=T,b.lineStart=C,b.lineEnd=E,_=[],g=[]},polygonEnd:function(){b.point=S,b.lineStart=A,b.lineEnd=x,_=merge(_);var P=polygonContains(g,n);_.length?(f||(o.polygonStart(),f=!0),clipRejoin(_,compareIntersection,P,i,o)):P&&(f||(o.polygonStart(),f=!0),o.lineStart(),i(null,null,1,o),o.lineEnd()),f&&(o.polygonEnd(),f=!1),_=g=null},sphere:function(){o.polygonStart(),o.lineStart(),i(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function S(P,L){r(P,L)&&o.point(P,L)}function v(P,L){l.point(P,L)}function A(){b.point=v,l.lineStart()}function x(){b.point=S,l.lineEnd()}function T(P,L){y.push([P,L]),d.point(P,L)}function C(){d.lineStart(),y=[]}function E(){T(y[0][0],y[0][1]),d.lineEnd();var P=d.clean(),L=u.result(),R,w=L.length,D,I,O;if(y.pop(),g.push(y),y=null,!!w){if(P&1){if(I=L[0],(D=I.length-1)>0){for(f||(o.polygonStart(),f=!0),o.lineStart(),R=0;R<D;++R)o.point((O=I[R])[0],O[1]);o.lineEnd()}return}w>1&&P&2&&L.push(L.pop().concat(L.shift())),_.push(L.filter(validSegment))}}return b}}function validSegment(r){return r.length>1}function compareIntersection(r,e){return((r=r.x)[0]<0?r[1]-halfPi$1-epsilon:halfPi$1-r[1])-((e=e.x)[0]<0?e[1]-halfPi$1-epsilon:halfPi$1-e[1])}const clipAntimeridian=clip(function(){return!0},clipAntimeridianLine,clipAntimeridianInterpolate,[-pi,-halfPi$1]);function clipAntimeridianLine(r){var e=NaN,i=NaN,n=NaN,o;return{lineStart:function(){r.lineStart(),o=1},point:function(l,u){var d=l>0?pi:-pi,f=abs(l-e);abs(f-pi)<epsilon?(r.point(e,i=(i+u)/2>0?halfPi$1:-halfPi$1),r.point(n,i),r.lineEnd(),r.lineStart(),r.point(d,i),r.point(l,i),o=0):n!==d&&f>=pi&&(abs(e-n)<epsilon&&(e-=n*epsilon),abs(l-d)<epsilon&&(l-=d*epsilon),i=clipAntimeridianIntersect(e,i,l,u),r.point(n,i),r.lineEnd(),r.lineStart(),r.point(d,i),o=0),r.point(e=l,i=u),n=d},lineEnd:function(){r.lineEnd(),e=i=NaN},clean:function(){return 2-o}}}function clipAntimeridianIntersect(r,e,i,n){var o,l,u=sin(r-i);return abs(u)>epsilon?atan((sin(e)*(l=cos(n))*sin(i)-sin(n)*(o=cos(e))*sin(r))/(o*l*u)):(e+n)/2}function clipAntimeridianInterpolate(r,e,i,n){var o;if(r==null)o=i*halfPi$1,n.point(-pi,o),n.point(0,o),n.point(pi,o),n.point(pi,0),n.point(pi,-o),n.point(0,-o),n.point(-pi,-o),n.point(-pi,0),n.point(-pi,o);else if(abs(r[0]-e[0])>epsilon){var l=r[0]<e[0]?pi:-pi;o=i*l/2,n.point(-l,o),n.point(0,o),n.point(l,o)}else n.point(e[0],e[1])}function clipCircle(r){var e=cos(r),i=6*radians,n=e>0,o=abs(e)>epsilon;function l(_,y,b,S){circleStream(S,r,i,b,_,y)}function u(_,y){return cos(_)*cos(y)>e}function d(_){var y,b,S,v,A;return{lineStart:function(){v=S=!1,A=1},point:function(x,T){var C=[x,T],E,P=u(x,T),L=n?P?0:g(x,T):P?g(x+(x<0?pi:-pi),T):0;if(!y&&(v=S=P)&&_.lineStart(),P!==S&&(E=f(y,C),(!E||pointEqual(y,E)||pointEqual(C,E))&&(C[2]=1)),P!==S)A=0,P?(_.lineStart(),E=f(C,y),_.point(E[0],E[1])):(E=f(y,C),_.point(E[0],E[1],2),_.lineEnd()),y=E;else if(o&&y&&n^P){var R;!(L&b)&&(R=f(C,y,!0))&&(A=0,n?(_.lineStart(),_.point(R[0][0],R[0][1]),_.point(R[1][0],R[1][1]),_.lineEnd()):(_.point(R[1][0],R[1][1]),_.lineEnd(),_.lineStart(),_.point(R[0][0],R[0][1],3)))}P&&(!y||!pointEqual(y,C))&&_.point(C[0],C[1]),y=C,S=P,b=L},lineEnd:function(){S&&_.lineEnd(),y=null},clean:function(){return A|(v&&S)<<1}}}function f(_,y,b){var S=cartesian(_),v=cartesian(y),A=[1,0,0],x=cartesianCross(S,v),T=cartesianDot(x,x),C=x[0],E=T-C*C;if(!E)return!b&&_;var P=e*T/E,L=-e*C/E,R=cartesianCross(A,x),w=cartesianScale(A,P),D=cartesianScale(x,L);cartesianAddInPlace(w,D);var I=R,O=cartesianDot(w,I),B=cartesianDot(I,I),N=O*O-B*(cartesianDot(w,w)-1);if(!(N<0)){var $=sqrt$2(N),H=cartesianScale(I,(-O-$)/B);if(cartesianAddInPlace(H,w),H=spherical(H),!b)return H;var F=_[0],V=y[0],G=_[1],Y=y[1],J;V<F&&(J=F,F=V,V=J);var q=V-F,te=abs(q-pi)<epsilon,de=te||q<epsilon;if(!te&&Y<G&&(J=G,G=Y,Y=J),de?te?G+Y>0^H[1]<(abs(H[0]-F)<epsilon?G:Y):G<=H[1]&&H[1]<=Y:q>pi^(F<=H[0]&&H[0]<=V)){var he=cartesianScale(I,(-O+$)/B);return cartesianAddInPlace(he,w),[H,spherical(he)]}}}function g(_,y){var b=n?r:pi-r,S=0;return _<-b?S|=1:_>b&&(S|=2),y<-b?S|=4:y>b&&(S|=8),S}return clip(u,d,l,n?[0,-r]:[-pi,r-pi])}function clipLine(r,e,i,n,o,l){var u=r[0],d=r[1],f=e[0],g=e[1],_=0,y=1,b=f-u,S=g-d,v;if(v=i-u,!(!b&&v>0)){if(v/=b,b<0){if(v<_)return;v<y&&(y=v)}else if(b>0){if(v>y)return;v>_&&(_=v)}if(v=o-u,!(!b&&v<0)){if(v/=b,b<0){if(v>y)return;v>_&&(_=v)}else if(b>0){if(v<_)return;v<y&&(y=v)}if(v=n-d,!(!S&&v>0)){if(v/=S,S<0){if(v<_)return;v<y&&(y=v)}else if(S>0){if(v>y)return;v>_&&(_=v)}if(v=l-d,!(!S&&v<0)){if(v/=S,S<0){if(v>y)return;v>_&&(_=v)}else if(S>0){if(v<_)return;v<y&&(y=v)}return _>0&&(r[0]=u+_*b,r[1]=d+_*S),y<1&&(e[0]=u+y*b,e[1]=d+y*S),!0}}}}}var clipMax=1e9,clipMin=-1e9;function clipRectangle(r,e,i,n){function o(g,_){return r<=g&&g<=i&&e<=_&&_<=n}function l(g,_,y,b){var S=0,v=0;if(g==null||(S=u(g,y))!==(v=u(_,y))||f(g,_)<0^y>0)do b.point(S===0||S===3?r:i,S>1?n:e);while((S=(S+y+4)%4)!==v);else b.point(_[0],_[1])}function u(g,_){return abs(g[0]-r)<epsilon?_>0?0:3:abs(g[0]-i)<epsilon?_>0?2:1:abs(g[1]-e)<epsilon?_>0?1:0:_>0?3:2}function d(g,_){return f(g.x,_.x)}function f(g,_){var y=u(g,1),b=u(_,1);return y!==b?y-b:y===0?_[1]-g[1]:y===1?g[0]-_[0]:y===2?g[1]-_[1]:_[0]-g[0]}return function(g){var _=g,y=clipBuffer(),b,S,v,A,x,T,C,E,P,L,R,w={point:D,lineStart:N,lineEnd:$,polygonStart:O,polygonEnd:B};function D(F,V){o(F,V)&&_.point(F,V)}function I(){for(var F=0,V=0,G=S.length;V<G;++V)for(var Y=S[V],J=1,q=Y.length,te=Y[0],de,he,fe=te[0],pe=te[1];J<q;++J)de=fe,he=pe,te=Y[J],fe=te[0],pe=te[1],he<=n?pe>n&&(fe-de)*(n-he)>(pe-he)*(r-de)&&++F:pe<=n&&(fe-de)*(n-he)<(pe-he)*(r-de)&&--F;return F}function O(){_=y,b=[],S=[],R=!0}function B(){var F=I(),V=R&&F,G=(b=merge(b)).length;(V||G)&&(g.polygonStart(),V&&(g.lineStart(),l(null,null,1,g),g.lineEnd()),G&&clipRejoin(b,d,F,l,g),g.polygonEnd()),_=g,b=S=v=null}function N(){w.point=H,S&&S.push(v=[]),L=!0,P=!1,C=E=NaN}function $(){b&&(H(A,x),T&&P&&y.rejoin(),b.push(y.result())),w.point=D,P&&_.lineEnd()}function H(F,V){var G=o(F,V);if(S&&v.push([F,V]),L)A=F,x=V,T=G,L=!1,G&&(_.lineStart(),_.point(F,V));else if(G&&P)_.point(F,V);else{var Y=[C=Math.max(clipMin,Math.min(clipMax,C)),E=Math.max(clipMin,Math.min(clipMax,E))],J=[F=Math.max(clipMin,Math.min(clipMax,F)),V=Math.max(clipMin,Math.min(clipMax,V))];clipLine(Y,J,r,e,i,n)?(P||(_.lineStart(),_.point(Y[0],Y[1])),_.point(J[0],J[1]),G||_.lineEnd(),R=!1):G&&(_.lineStart(),_.point(F,V),R=!1)}C=F,E=V,P=G}return w}}function identity$3(r){return r}var areaSum=adder(),areaRingSum=adder(),x00$2,y00$2,x0$3,y0$3,areaStream={point:noop,lineStart:noop,lineEnd:noop,polygonStart:function(){areaStream.lineStart=areaRingStart,areaStream.lineEnd=areaRingEnd},polygonEnd:function(){areaStream.lineStart=areaStream.lineEnd=areaStream.point=noop,areaSum.add(abs(areaRingSum)),areaRingSum.reset()},result:function(){var r=areaSum/2;return areaSum.reset(),r}};function areaRingStart(){areaStream.point=areaPointFirst}function areaPointFirst(r,e){areaStream.point=areaPoint,x00$2=x0$3=r,y00$2=y0$3=e}function areaPoint(r,e){areaRingSum.add(y0$3*r-x0$3*e),x0$3=r,y0$3=e}function areaRingEnd(){areaPoint(x00$2,y00$2)}var x0$2=1/0,y0$2=x0$2,x1=-x0$2,y1=x1,boundsStream={point:boundsPoint,lineStart:noop,lineEnd:noop,polygonStart:noop,polygonEnd:noop,result:function(){var r=[[x0$2,y0$2],[x1,y1]];return x1=y1=-(y0$2=x0$2=1/0),r}};function boundsPoint(r,e){r<x0$2&&(x0$2=r),r>x1&&(x1=r),e<y0$2&&(y0$2=e),e>y1&&(y1=e)}var X0=0,Y0=0,Z0=0,X1=0,Y1=0,Z1=0,X2=0,Y2=0,Z2=0,x00$1,y00$1,x0$1,y0$1,centroidStream={point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart,centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.point=centroidPoint,centroidStream.lineStart=centroidLineStart,centroidStream.lineEnd=centroidLineEnd},result:function(){var r=Z2?[X2/Z2,Y2/Z2]:Z1?[X1/Z1,Y1/Z1]:Z0?[X0/Z0,Y0/Z0]:[NaN,NaN];return X0=Y0=Z0=X1=Y1=Z1=X2=Y2=Z2=0,r}};function centroidPoint(r,e){X0+=r,Y0+=e,++Z0}function centroidLineStart(){centroidStream.point=centroidPointFirstLine}function centroidPointFirstLine(r,e){centroidStream.point=centroidPointLine,centroidPoint(x0$1=r,y0$1=e)}function centroidPointLine(r,e){var i=r-x0$1,n=e-y0$1,o=sqrt$2(i*i+n*n);X1+=o*(x0$1+r)/2,Y1+=o*(y0$1+e)/2,Z1+=o,centroidPoint(x0$1=r,y0$1=e)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidPointFirstRing}function centroidRingEnd(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(r,e){centroidStream.point=centroidPointRing,centroidPoint(x00$1=x0$1=r,y00$1=y0$1=e)}function centroidPointRing(r,e){var i=r-x0$1,n=e-y0$1,o=sqrt$2(i*i+n*n);X1+=o*(x0$1+r)/2,Y1+=o*(y0$1+e)/2,Z1+=o,o=y0$1*r-x0$1*e,X2+=o*(x0$1+r),Y2+=o*(y0$1+e),Z2+=o*3,centroidPoint(x0$1=r,y0$1=e)}function PathContext(r){this._context=r}PathContext.prototype={_radius:4.5,pointRadius:function(r){return this._radius=r,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(r,e){switch(this._point){case 0:{this._context.moveTo(r,e),this._point=1;break}case 1:{this._context.lineTo(r,e);break}default:{this._context.moveTo(r+this._radius,e),this._context.arc(r,e,this._radius,0,tau);break}}},result:noop};var lengthSum=adder(),lengthRing,x00,y00,x0,y0,lengthStream={point:noop,lineStart:function(){lengthStream.point=lengthPointFirst},lineEnd:function(){lengthRing&&lengthPoint(x00,y00),lengthStream.point=noop},polygonStart:function(){lengthRing=!0},polygonEnd:function(){lengthRing=null},result:function(){var r=+lengthSum;return lengthSum.reset(),r}};function lengthPointFirst(r,e){lengthStream.point=lengthPoint,x00=x0=r,y00=y0=e}function lengthPoint(r,e){x0-=r,y0-=e,lengthSum.add(sqrt$2(x0*x0+y0*y0)),x0=r,y0=e}function PathString(){this._string=[]}PathString.prototype={_radius:4.5,_circle:circle$3(4.5),pointRadius:function(r){return(r=+r)!==this._radius&&(this._radius=r,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(r,e){switch(this._point){case 0:{this._string.push("M",r,",",e),this._point=1;break}case 1:{this._string.push("L",r,",",e);break}default:{this._circle==null&&(this._circle=circle$3(this._radius)),this._string.push("M",r,",",e,this._circle);break}}},result:function(){if(this._string.length){var r=this._string.join("");return this._string=[],r}else return null}};function circle$3(r){return"m0,"+r+"a"+r+","+r+" 0 1,1 0,"+-2*r+"a"+r+","+r+" 0 1,1 0,"+2*r+"z"}function geoPath(r,e){var i=4.5,n,o;function l(u){return u&&(typeof i=="function"&&o.pointRadius(+i.apply(this,arguments)),geoStream(u,n(o))),o.result()}return l.area=function(u){return geoStream(u,n(areaStream)),areaStream.result()},l.measure=function(u){return geoStream(u,n(lengthStream)),lengthStream.result()},l.bounds=function(u){return geoStream(u,n(boundsStream)),boundsStream.result()},l.centroid=function(u){return geoStream(u,n(centroidStream)),centroidStream.result()},l.projection=function(u){return arguments.length?(n=u==null?(r=null,identity$3):(r=u).stream,l):r},l.context=function(u){return arguments.length?(o=u==null?(e=null,new PathString):new PathContext(e=u),typeof i!="function"&&o.pointRadius(i),l):e},l.pointRadius=function(u){return arguments.length?(i=typeof u=="function"?u:(o.pointRadius(+u),+u),l):i},l.projection(r).context(e)}function transformer(r){return function(e){var i=new TransformStream;for(var n in r)i[n]=r[n];return i.stream=e,i}}function TransformStream(){}TransformStream.prototype={constructor:TransformStream,point:function(r,e){this.stream.point(r,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function fit(r,e,i){var n=r.clipExtent&&r.clipExtent();return r.scale(150).translate([0,0]),n!=null&&r.clipExtent(null),geoStream(i,r.stream(boundsStream)),e(boundsStream.result()),n!=null&&r.clipExtent(n),r}function fitExtent(r,e,i){return fit(r,function(n){var o=e[1][0]-e[0][0],l=e[1][1]-e[0][1],u=Math.min(o/(n[1][0]-n[0][0]),l/(n[1][1]-n[0][1])),d=+e[0][0]+(o-u*(n[1][0]+n[0][0]))/2,f=+e[0][1]+(l-u*(n[1][1]+n[0][1]))/2;r.scale(150*u).translate([d,f])},i)}function fitSize(r,e,i){return fitExtent(r,[[0,0],e],i)}function fitWidth(r,e,i){return fit(r,function(n){var o=+e,l=o/(n[1][0]-n[0][0]),u=(o-l*(n[1][0]+n[0][0]))/2,d=-l*n[0][1];r.scale(150*l).translate([u,d])},i)}function fitHeight(r,e,i){return fit(r,function(n){var o=+e,l=o/(n[1][1]-n[0][1]),u=-l*n[0][0],d=(o-l*(n[1][1]+n[0][1]))/2;r.scale(150*l).translate([u,d])},i)}var maxDepth=16,cosMinDistance=cos(30*radians);function resample(r,e){return+e?resample$1(r,e):resampleNone(r)}function resampleNone(r){return transformer({point:function(e,i){e=r(e,i),this.stream.point(e[0],e[1])}})}function resample$1(r,e){function i(n,o,l,u,d,f,g,_,y,b,S,v,A,x){var T=g-n,C=_-o,E=T*T+C*C;if(E>4*e&&A--){var P=u+b,L=d+S,R=f+v,w=sqrt$2(P*P+L*L+R*R),D=asin(R/=w),I=abs(abs(R)-1)<epsilon||abs(l-y)<epsilon?(l+y)/2:atan2(L,P),O=r(I,D),B=O[0],N=O[1],$=B-n,H=N-o,F=C*$-T*H;(F*F/E>e||abs((T*$+C*H)/E-.5)>.3||u*b+d*S+f*v<cosMinDistance)&&(i(n,o,l,u,d,f,B,N,I,P/=w,L/=w,R,A,x),x.point(B,N),i(B,N,I,P,L,R,g,_,y,b,S,v,A,x))}}return function(n){var o,l,u,d,f,g,_,y,b,S,v,A,x={point:T,lineStart:C,lineEnd:P,polygonStart:function(){n.polygonStart(),x.lineStart=L},polygonEnd:function(){n.polygonEnd(),x.lineStart=C}};function T(D,I){D=r(D,I),n.point(D[0],D[1])}function C(){y=NaN,x.point=E,n.lineStart()}function E(D,I){var O=cartesian([D,I]),B=r(D,I);i(y,b,_,S,v,A,y=B[0],b=B[1],_=D,S=O[0],v=O[1],A=O[2],maxDepth,n),n.point(y,b)}function P(){x.point=T,n.lineEnd()}function L(){C(),x.point=R,x.lineEnd=w}function R(D,I){E(o=D,I),l=y,u=b,d=S,f=v,g=A,x.point=E}function w(){i(y,b,_,S,v,A,l,u,o,d,f,g,maxDepth,n),x.lineEnd=P,P()}return x}}var transformRadians=transformer({point:function(r,e){this.stream.point(r*radians,e*radians)}});function transformRotate(r){return transformer({point:function(e,i){var n=r(e,i);return this.stream.point(n[0],n[1])}})}function scaleTranslate(r,e,i,n,o){function l(u,d){return u*=n,d*=o,[e+r*u,i-r*d]}return l.invert=function(u,d){return[(u-e)/r*n,(i-d)/r*o]},l}function scaleTranslateRotate(r,e,i,n,o,l){var u=cos(l),d=sin(l),f=u*r,g=d*r,_=u/r,y=d/r,b=(d*i-u*e)/r,S=(d*e+u*i)/r;function v(A,x){return A*=n,x*=o,[f*A-g*x+e,i-g*A-f*x]}return v.invert=function(A,x){return[n*(_*A-y*x+b),o*(S-y*A-_*x)]},v}function projection$1(r){return projectionMutator(function(){return r})()}function projectionMutator(r){var e,i=150,n=480,o=250,l=0,u=0,d=0,f=0,g=0,_,y=0,b=1,S=1,v=null,A=clipAntimeridian,x=null,T,C,E,P=identity$3,L=.5,R,w,D,I,O;function B(F){return D(F[0]*radians,F[1]*radians)}function N(F){return F=D.invert(F[0],F[1]),F&&[F[0]*degrees,F[1]*degrees]}B.stream=function(F){return I&&O===F?I:I=transformRadians(transformRotate(_)(A(R(P(O=F)))))},B.preclip=function(F){return arguments.length?(A=F,v=void 0,H()):A},B.postclip=function(F){return arguments.length?(P=F,x=T=C=E=null,H()):P},B.clipAngle=function(F){return arguments.length?(A=+F?clipCircle(v=F*radians):(v=null,clipAntimeridian),H()):v*degrees},B.clipExtent=function(F){return arguments.length?(P=F==null?(x=T=C=E=null,identity$3):clipRectangle(x=+F[0][0],T=+F[0][1],C=+F[1][0],E=+F[1][1]),H()):x==null?null:[[x,T],[C,E]]},B.scale=function(F){return arguments.length?(i=+F,$()):i},B.translate=function(F){return arguments.length?(n=+F[0],o=+F[1],$()):[n,o]},B.center=function(F){return arguments.length?(l=F[0]%360*radians,u=F[1]%360*radians,$()):[l*degrees,u*degrees]},B.rotate=function(F){return arguments.length?(d=F[0]%360*radians,f=F[1]%360*radians,g=F.length>2?F[2]%360*radians:0,$()):[d*degrees,f*degrees,g*degrees]},B.angle=function(F){return arguments.length?(y=F%360*radians,$()):y*degrees},B.reflectX=function(F){return arguments.length?(b=F?-1:1,$()):b<0},B.reflectY=function(F){return arguments.length?(S=F?-1:1,$()):S<0},B.precision=function(F){return arguments.length?(R=resample(w,L=F*F),H()):sqrt$2(L)},B.fitExtent=function(F,V){return fitExtent(B,F,V)},B.fitSize=function(F,V){return fitSize(B,F,V)},B.fitWidth=function(F,V){return fitWidth(B,F,V)},B.fitHeight=function(F,V){return fitHeight(B,F,V)};function $(){var F=scaleTranslateRotate(i,0,0,b,S,y).apply(null,e(l,u)),V=(y?scaleTranslateRotate:scaleTranslate)(i,n-F[0],o-F[1],b,S,y);return _=rotateRadians(d,f,g),w=compose(e,V),D=compose(_,w),R=resample(w,L),H()}function H(){return I=O=null,B}return function(){return e=r.apply(this,arguments),B.invert=e.invert&&N,$()}}function conicProjection(r){var e=0,i=pi/3,n=projectionMutator(r),o=n(e,i);return o.parallels=function(l){return arguments.length?n(e=l[0]*radians,i=l[1]*radians):[e*degrees,i*degrees]},o}function cylindricalEqualAreaRaw(r){var e=cos(r);function i(n,o){return[n*e,sin(o)/e]}return i.invert=function(n,o){return[n/e,asin(o*e)]},i}function conicEqualAreaRaw(r,e){var i=sin(r),n=(i+sin(e))/2;if(abs(n)<epsilon)return cylindricalEqualAreaRaw(r);var o=1+i*(2*n-i),l=sqrt$2(o)/n;function u(d,f){var g=sqrt$2(o-2*n*sin(f))/n;return[g*sin(d*=n),l-g*cos(d)]}return u.invert=function(d,f){var g=l-f,_=atan2(d,abs(g))*sign$1(g);return g*n<0&&(_-=pi*sign$1(d)*sign$1(g)),[_/n,asin((o-(d*d+g*g)*n*n)/(2*n))]},u}function geoConicEqualArea(){return conicProjection(conicEqualAreaRaw).scale(155.424).center([0,33.6442])}function geoAlbers(){return geoConicEqualArea().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function multiplex(r){var e=r.length;return{point:function(i,n){for(var o=-1;++o<e;)r[o].point(i,n)},sphere:function(){for(var i=-1;++i<e;)r[i].sphere()},lineStart:function(){for(var i=-1;++i<e;)r[i].lineStart()},lineEnd:function(){for(var i=-1;++i<e;)r[i].lineEnd()},polygonStart:function(){for(var i=-1;++i<e;)r[i].polygonStart()},polygonEnd:function(){for(var i=-1;++i<e;)r[i].polygonEnd()}}}function geoAlbersUsa(){var r,e,i=geoAlbers(),n,o=geoConicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l,u=geoConicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),d,f,g={point:function(b,S){f=[b,S]}};function _(b){var S=b[0],v=b[1];return f=null,n.point(S,v),f||(l.point(S,v),f)||(d.point(S,v),f)}_.invert=function(b){var S=i.scale(),v=i.translate(),A=(b[0]-v[0])/S,x=(b[1]-v[1])/S;return(x>=.12&&x<.234&&A>=-.425&&A<-.214?o:x>=.166&&x<.234&&A>=-.214&&A<-.115?u:i).invert(b)},_.stream=function(b){return r&&e===b?r:r=multiplex([i.stream(e=b),o.stream(b),u.stream(b)])},_.precision=function(b){return arguments.length?(i.precision(b),o.precision(b),u.precision(b),y()):i.precision()},_.scale=function(b){return arguments.length?(i.scale(b),o.scale(b*.35),u.scale(b),_.translate(i.translate())):i.scale()},_.translate=function(b){if(!arguments.length)return i.translate();var S=i.scale(),v=+b[0],A=+b[1];return n=i.translate(b).clipExtent([[v-.455*S,A-.238*S],[v+.455*S,A+.238*S]]).stream(g),l=o.translate([v-.307*S,A+.201*S]).clipExtent([[v-.425*S+epsilon,A+.12*S+epsilon],[v-.214*S-epsilon,A+.234*S-epsilon]]).stream(g),d=u.translate([v-.205*S,A+.212*S]).clipExtent([[v-.214*S+epsilon,A+.166*S+epsilon],[v-.115*S-epsilon,A+.234*S-epsilon]]).stream(g),y()},_.fitExtent=function(b,S){return fitExtent(_,b,S)},_.fitSize=function(b,S){return fitSize(_,b,S)},_.fitWidth=function(b,S){return fitWidth(_,b,S)},_.fitHeight=function(b,S){return fitHeight(_,b,S)};function y(){return r=e=null,_}return _.scale(1070)}function azimuthalRaw(r){return function(e,i){var n=cos(e),o=cos(i),l=r(n*o);return[l*o*sin(e),l*sin(i)]}}function azimuthalInvert(r){return function(e,i){var n=sqrt$2(e*e+i*i),o=r(n),l=sin(o),u=cos(o);return[atan2(e*l,n*u),asin(n&&i*l/n)]}}var azimuthalEqualAreaRaw=azimuthalRaw(function(r){return sqrt$2(2/(1+r))});azimuthalEqualAreaRaw.invert=azimuthalInvert(function(r){return 2*asin(r/2)});function geoAzimuthalEqualArea(){return projection$1(azimuthalEqualAreaRaw).scale(124.75).clipAngle(180-.001)}var azimuthalEquidistantRaw=azimuthalRaw(function(r){return(r=acos(r))&&r/sin(r)});azimuthalEquidistantRaw.invert=azimuthalInvert(function(r){return r});function geoAzimuthalEquidistant(){return projection$1(azimuthalEquidistantRaw).scale(79.4188).clipAngle(180-.001)}function mercatorRaw(r,e){return[r,log(tan((halfPi$1+e)/2))]}mercatorRaw.invert=function(r,e){return[r,2*atan(exp(e))-halfPi$1]};function geoMercator(){return mercatorProjection(mercatorRaw).scale(961/tau)}function mercatorProjection(r){var e=projection$1(r),i=e.center,n=e.scale,o=e.translate,l=e.clipExtent,u=null,d,f,g;e.scale=function(y){return arguments.length?(n(y),_()):n()},e.translate=function(y){return arguments.length?(o(y),_()):o()},e.center=function(y){return arguments.length?(i(y),_()):i()},e.clipExtent=function(y){return arguments.length?(y==null?u=d=f=g=null:(u=+y[0][0],d=+y[0][1],f=+y[1][0],g=+y[1][1]),_()):u==null?null:[[u,d],[f,g]]};function _(){var y=pi*n(),b=e(rotation(e.rotate()).invert([0,0]));return l(u==null?[[b[0]-y,b[1]-y],[b[0]+y,b[1]+y]]:r===mercatorRaw?[[Math.max(b[0]-y,u),d],[Math.min(b[0]+y,f),g]]:[[u,Math.max(b[1]-y,d)],[f,Math.min(b[1]+y,g)]])}return _()}function tany(r){return tan((halfPi$1+r)/2)}function conicConformalRaw(r,e){var i=cos(r),n=r===e?sin(r):log(i/cos(e))/log(tany(e)/tany(r)),o=i*pow(tany(r),n)/n;if(!n)return mercatorRaw;function l(u,d){o>0?d<-halfPi$1+epsilon&&(d=-halfPi$1+epsilon):d>halfPi$1-epsilon&&(d=halfPi$1-epsilon);var f=o/pow(tany(d),n);return[f*sin(n*u),o-f*cos(n*u)]}return l.invert=function(u,d){var f=o-d,g=sign$1(n)*sqrt$2(u*u+f*f),_=atan2(u,abs(f))*sign$1(f);return f*n<0&&(_-=pi*sign$1(u)*sign$1(f)),[_/n,2*atan(pow(o/g,1/n))-halfPi$1]},l}function geoConicConformal(){return conicProjection(conicConformalRaw).scale(109.5).parallels([30,30])}function equirectangularRaw(r,e){return[r,e]}equirectangularRaw.invert=equirectangularRaw;function geoEquirectangular(){return projection$1(equirectangularRaw).scale(152.63)}function conicEquidistantRaw(r,e){var i=cos(r),n=r===e?sin(r):(i-cos(e))/(e-r),o=i/n+r;if(abs(n)<epsilon)return equirectangularRaw;function l(u,d){var f=o-d,g=n*u;return[f*sin(g),o-f*cos(g)]}return l.invert=function(u,d){var f=o-d,g=atan2(u,abs(f))*sign$1(f);return f*n<0&&(g-=pi*sign$1(u)*sign$1(f)),[g/n,o-sign$1(n)*sqrt$2(u*u+f*f)]},l}function geoConicEquidistant(){return conicProjection(conicEquidistantRaw).scale(131.154).center([0,13.9389])}var A1=1.340264,A2=-.081106,A3=893e-6,A4=.003796,M=sqrt$2(3)/2,iterations=12;function equalEarthRaw(r,e){var i=asin(M*sin(e)),n=i*i,o=n*n*n;return[r*cos(i)/(M*(A1+3*A2*n+o*(7*A3+9*A4*n))),i*(A1+A2*n+o*(A3+A4*n))]}equalEarthRaw.invert=function(r,e){for(var i=e,n=i*i,o=n*n*n,l=0,u,d,f;l<iterations&&(d=i*(A1+A2*n+o*(A3+A4*n))-e,f=A1+3*A2*n+o*(7*A3+9*A4*n),i-=u=d/f,n=i*i,o=n*n*n,!(abs(u)<epsilon2));++l);return[M*r*(A1+3*A2*n+o*(7*A3+9*A4*n))/cos(i),asin(sin(i)/M)]};function geoEqualEarth(){return projection$1(equalEarthRaw).scale(177.158)}function gnomonicRaw(r,e){var i=cos(e),n=cos(r)*i;return[i*sin(r)/n,sin(e)/n]}gnomonicRaw.invert=azimuthalInvert(atan);function geoGnomonic(){return projection$1(gnomonicRaw).scale(144.049).clipAngle(60)}function geoIdentity(){var r=1,e=0,i=0,n=1,o=1,l=0,u,d,f=null,g,_,y,b=1,S=1,v=transformer({point:function(P,L){var R=E([P,L]);this.stream.point(R[0],R[1])}}),A=identity$3,x,T;function C(){return b=r*n,S=r*o,x=T=null,E}function E(P){var L=P[0]*b,R=P[1]*S;if(l){var w=R*u-L*d;L=L*u+R*d,R=w}return[L+e,R+i]}return E.invert=function(P){var L=P[0]-e,R=P[1]-i;if(l){var w=R*u+L*d;L=L*u-R*d,R=w}return[L/b,R/S]},E.stream=function(P){return x&&T===P?x:x=v(A(T=P))},E.postclip=function(P){return arguments.length?(A=P,f=g=_=y=null,C()):A},E.clipExtent=function(P){return arguments.length?(A=P==null?(f=g=_=y=null,identity$3):clipRectangle(f=+P[0][0],g=+P[0][1],_=+P[1][0],y=+P[1][1]),C()):f==null?null:[[f,g],[_,y]]},E.scale=function(P){return arguments.length?(r=+P,C()):r},E.translate=function(P){return arguments.length?(e=+P[0],i=+P[1],C()):[e,i]},E.angle=function(P){return arguments.length?(l=P%360*radians,d=sin(l),u=cos(l),C()):l*degrees},E.reflectX=function(P){return arguments.length?(n=P?-1:1,C()):n<0},E.reflectY=function(P){return arguments.length?(o=P?-1:1,C()):o<0},E.fitExtent=function(P,L){return fitExtent(E,P,L)},E.fitSize=function(P,L){return fitSize(E,P,L)},E.fitWidth=function(P,L){return fitWidth(E,P,L)},E.fitHeight=function(P,L){return fitHeight(E,P,L)},E}function naturalEarth1Raw(r,e){var i=e*e,n=i*i;return[r*(.8707-.131979*i+n*(-.013791+n*(.003971*i-.001529*n))),e*(1.007226+i*(.015085+n*(-.044475+.028874*i-.005916*n)))]}naturalEarth1Raw.invert=function(r,e){var i=e,n=25,o;do{var l=i*i,u=l*l;i-=o=(i*(1.007226+l*(.015085+u*(-.044475+.028874*l-.005916*u)))-e)/(1.007226+l*(.015085*3+u*(-.044475*7+.028874*9*l-.005916*11*u)))}while(abs(o)>epsilon&&--n>0);return[r/(.8707+(l=i*i)*(-.131979+l*(-.013791+l*l*l*(.003971-.001529*l)))),i]};function geoNaturalEarth1(){return projection$1(naturalEarth1Raw).scale(175.295)}function orthographicRaw(r,e){return[cos(e)*sin(r),sin(e)]}orthographicRaw.invert=azimuthalInvert(asin);function geoOrthographic(){return projection$1(orthographicRaw).scale(249.5).clipAngle(90+epsilon)}function stereographicRaw(r,e){var i=cos(e),n=1+cos(r)*i;return[i*sin(r)/n,sin(e)/n]}stereographicRaw.invert=azimuthalInvert(function(r){return 2*atan(r)});function geoStereographic(){return projection$1(stereographicRaw).scale(250).clipAngle(142)}function transverseMercatorRaw(r,e){return[log(tan((halfPi$1+e)/2)),-r]}transverseMercatorRaw.invert=function(r,e){return[-e,2*atan(exp(r))-halfPi$1]};function geoTransverseMercator(){var r=mercatorProjection(transverseMercatorRaw),e=r.center,i=r.rotate;return r.center=function(n){return arguments.length?e([-n[1],n[0]]):(n=e(),[n[1],-n[0]])},r.rotate=function(n){return arguments.length?i([n[0],n[1],n.length>2?n[2]+90:90]):(n=i(),[n[0],n[1],n[2]-90])},i([0,0,90]).scale(159.155)}function identity$2(r){return r}function transform$8(r){if(r==null)return identity$2;var e,i,n=r.scale[0],o=r.scale[1],l=r.translate[0],u=r.translate[1];return function(d,f){f||(e=i=0);var g=2,_=d.length,y=new Array(_);for(y[0]=(e+=d[0])*n+l,y[1]=(i+=d[1])*o+u;g<_;)y[g]=d[g],++g;return y}}function reverse(r,e){for(var i,n=r.length,o=n-e;o<--n;)i=r[o],r[o++]=r[n],r[n]=i}function feature(r,e){return typeof e=="string"&&(e=r.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(i){return feature$1(r,i)})}:feature$1(r,e)}function feature$1(r,e){var i=e.id,n=e.bbox,o=e.properties==null?{}:e.properties,l=object(r,e);return i==null&&n==null?{type:"Feature",properties:o,geometry:l}:n==null?{type:"Feature",id:i,properties:o,geometry:l}:{type:"Feature",id:i,bbox:n,properties:o,geometry:l}}function object(r,e){var i=transform$8(r.transform),n=r.arcs;function o(_,y){y.length&&y.pop();for(var b=n[_<0?~_:_],S=0,v=b.length;S<v;++S)y.push(i(b[S],S));_<0&&reverse(y,v)}function l(_){return i(_)}function u(_){for(var y=[],b=0,S=_.length;b<S;++b)o(_[b],y);return y.length<2&&y.push(y[0]),y}function d(_){for(var y=u(_);y.length<4;)y.push(y[0]);return y}function f(_){return _.map(d)}function g(_){var y=_.type,b;switch(y){case"GeometryCollection":return{type:y,geometries:_.geometries.map(g)};case"Point":b=l(_.coordinates);break;case"MultiPoint":b=_.coordinates.map(l);break;case"LineString":b=u(_.arcs);break;case"MultiLineString":b=_.arcs.map(u);break;case"Polygon":b=f(_.arcs);break;case"MultiPolygon":b=_.arcs.map(f);break;default:return null}return{type:y,coordinates:b}}return g(e)}var simplifyGeojson={exports:{}},line$1,hasRequiredLine;function requireLine(){if(hasRequiredLine)return line$1;hasRequiredLine=1;var r=function(e,i){this.p1=e,this.p2=i};return r.prototype.rise=function(){return this.p2[1]-this.p1[1]},r.prototype.run=function(){return this.p2[0]-this.p1[0]},r.prototype.slope=function(){return this.rise()/this.run()},r.prototype.yIntercept=function(){return this.p1[1]-this.p1[0]*this.slope(this.p1,this.p2)},r.prototype.isVertical=function(){return!isFinite(this.slope())},r.prototype.isHorizontal=function(){return this.p1[1]==this.p2[1]},r.prototype._perpendicularDistanceHorizontal=function(e){return Math.abs(this.p1[1]-e[1])},r.prototype._perpendicularDistanceVertical=function(e){return Math.abs(this.p1[0]-e[0])},r.prototype._perpendicularDistanceHasSlope=function(e){var i=this.slope(),n=this.yIntercept();return Math.abs(i*e[0]-e[1]+n)/Math.sqrt(Math.pow(i,2)+1)},r.prototype.perpendicularDistance=function(e){return this.isVertical()?this._perpendicularDistanceVertical(e):this.isHorizontal()?this._perpendicularDistanceHorizontal(e):this._perpendicularDistanceHasSlope(e)},line$1=r,line$1}var lib,hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib;hasRequiredLib=1;var r=requireLine(),e=function(i,n){for(var o=0,l=0,u=1;u<=i.length-2;u++){var d=new r(i[0],i[i.length-1]).perpendicularDistance(i[u]);d>o&&(l=u,o=d)}if(o>n)var f=e(i.slice(0,l),n),g=e(i.slice(l,i.length),n),_=f.concat(g);else i.length>1?_=[i[0],i[i.length-1]]:_=[i[0]];return _};return lib=e,lib}var hasRequiredSimplifyGeojson;function requireSimplifyGeojson(){return hasRequiredSimplifyGeojson||(hasRequiredSimplifyGeojson=1,function(r){var e=requireLib();r.exports=function(o,l,u){return u||(o=JSON.parse(JSON.stringify(o))),o.features?n(o,l):o.type&&o.type==="Feature"?i(o,l):new Error("FeatureCollection or individual Feature required")},r.exports.simplify=function(o,l){return e(o,l)};function i(o,l){var u=o.geometry,d=u.type;if(d==="LineString")u.coordinates=r.exports.simplify(u.coordinates,l);else if(d==="Polygon"||d==="MultiLineString")for(var f=0;f<u.coordinates.length;f++)u.coordinates[f]=r.exports.simplify(u.coordinates[f],l);else if(d==="MultiPolygon")for(var g=0;g<u.coordinates.length;g++)for(var _=0;_<u.coordinates[g].length;_++)u.coordinates[g][_]=r.exports.simplify(u.coordinates[g][_],l);return o}function n(o,l){for(var u=0;u<o.features.length;u++)o.features[u]=i(o.features[u],l);return o}}(simplifyGeojson)),simplifyGeojson.exports}var simplifyGeojsonExports=requireSimplifyGeojson();const geoSimplify=getDefaultExportFromCjs(simplifyGeojsonExports),mergeDeepImmer=function(r,...e){return mergeOption(cloneDeep(r),...e)};function _mergeOptionDeep(r,e,i){const n=e[i];if(n===void 0)r[i]=null;else if(isObject$1(n)){isObject$1(r[i])||(r[i]={});for(const o in n)_mergeOptionDeep(r[i],n,o)}else r[i]=n}function _mergeOptionBase(r,e){if(isObject$1(e)&&r!==e)for(const i in e)_mergeOptionDeep(r,e,i)}function mergeOption(r,...e){r||(r={});let i=-1;const n=e.length;for(;++i<n;)_mergeOptionBase(r,e[i]);return r}const DEFAULT_SIMPLIFY_OPTIONS={tolerance:.01},simplify=(r,e)=>{const i=mergeDeepImmer(DEFAULT_SIMPLIFY_OPTIONS,e),{tolerance:n}=i;return geoSimplify(r,n)};var DATAVIEW_TYPE;(function(r){r.DSV="dsv",r.TREE="tree",r.GEO="geo",r.BYTE="bytejson",r.HEX="hex",r.GRAPH="graph",r.TABLE="table",r.GEO_GRATICULE="geo-graticule"})(DATAVIEW_TYPE||(DATAVIEW_TYPE={}));const fold=(r,e)=>{const{fields:i,key:n,value:o,retains:l}=e,u=[];for(let d=0;d<r.length;d++)i.forEach(f=>{const g={};if(g[n]=f,g[o]=r[d][f],l)l.forEach(_=>{g[_]=r[d][_]});else for(const _ in r[d])i.indexOf(_)===-1&&(g[_]=r[d][_]);u.push(g)});return u},fields=(r,e)=>{var i,n;if(!(e!=null&&e.fields)||r.length===0)return r;const o=e.fields,l=r[0],u={},d=[];for(const f in o)if(Object.prototype.hasOwnProperty.call(o,f)){const g=o[f];if(!g.type){let y=l;f in l||(y=(i=r.find(b=>f in b))!==null&&i!==void 0?i:l),g.type=typeof y[f]=="number"?"linear":"ordinal"}let _;if(typeof g.sortIndex=="number"&&(_={key:f,type:g.type,index:g.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:g.sortReverse===!0},d.push(_)),((n=g.domain)===null||n===void 0?void 0:n.length)>0)if(g.type==="ordinal"){g._domainCache={},u[f]=g;const y={};g.domain.forEach((b,S)=>{y[b]=S,g._domainCache[b]=S}),_&&(_.sortIndex=y,_.sortIndexCount=g.domain.length)}else g.domain.length>=2&&(u[f]=g)}return Object.keys(u).length>0&&(r=r.filter(f=>{for(const g in u){const _=u[g];if(_.type==="ordinal"){if(!(f[g]in _._domainCache))return!1}else if(_.domain[0]>f[g]||_.domain[1]<f[g])return!1}return!0})),d.sort((f,g)=>f.index-g.index),r.sort((f,g)=>sortData(f,g,d)),r};function sortData(r,e,i){for(let n=0;n<i.length;n++){const o=i[n];let l=0;if(o.type==="ordinal"?(o.sortIndex[e[o.key]]===void 0&&(o.sortIndex[e[o.key]]=o.sortIndexCount++),o.sortIndex[r[o.key]]===void 0&&(o.sortIndex[r[o.key]]=o.sortIndexCount++),l=o.sortIndex[r[o.key]]-o.sortIndex[e[o.key]]):o.type==="linear"&&(l=r[o.key]-e[o.key]),o.sortReverse&&(l=-l),l!==0)return l}return 0}var EOL={},EOF={},QUOTE=34,NEWLINE=10,RETURN=13;function objectConverter(r){return new Function("d","return {"+r.map(function(e,i){return JSON.stringify(e)+": d["+i+'] || ""'}).join(",")+"}")}function customConverter(r,e){var i=objectConverter(r);return function(n,o){return e(i(n),o,r)}}function inferColumns(r){var e=Object.create(null),i=[];return r.forEach(function(n){for(var o in n)o in e||i.push(e[o]=o)}),i}function pad(r,e){var i=r+"",n=i.length;return n<e?new Array(e-n+1).join(0)+i:i}function formatYear(r){return r<0?"-"+pad(-r,6):r>9999?"+"+pad(r,6):pad(r,4)}function formatDate(r){var e=r.getUTCHours(),i=r.getUTCMinutes(),n=r.getUTCSeconds(),o=r.getUTCMilliseconds();return isNaN(r)?"Invalid Date":formatYear(r.getUTCFullYear())+"-"+pad(r.getUTCMonth()+1,2)+"-"+pad(r.getUTCDate(),2)+(o?"T"+pad(e,2)+":"+pad(i,2)+":"+pad(n,2)+"."+pad(o,3)+"Z":n?"T"+pad(e,2)+":"+pad(i,2)+":"+pad(n,2)+"Z":i||e?"T"+pad(e,2)+":"+pad(i,2)+"Z":"")}function dsvFormat(r){var e=new RegExp('["'+r+`
\r]`),i=r.charCodeAt(0);function n(y,b){var S,v,A=o(y,function(x,T){if(S)return S(x,T-1);v=x,S=b?customConverter(x,b):objectConverter(x)});return A.columns=v||[],A}function o(y,b){var S=[],v=y.length,A=0,x=0,T,C=v<=0,E=!1;y.charCodeAt(v-1)===NEWLINE&&--v,y.charCodeAt(v-1)===RETURN&&--v;function P(){if(C)return EOF;if(E)return E=!1,EOL;var R,w=A,D;if(y.charCodeAt(w)===QUOTE){for(;A++<v&&y.charCodeAt(A)!==QUOTE||y.charCodeAt(++A)===QUOTE;);return(R=A)>=v?C=!0:(D=y.charCodeAt(A++))===NEWLINE?E=!0:D===RETURN&&(E=!0,y.charCodeAt(A)===NEWLINE&&++A),y.slice(w+1,R-1).replace(/""/g,'"')}for(;A<v;){if((D=y.charCodeAt(R=A++))===NEWLINE)E=!0;else if(D===RETURN)E=!0,y.charCodeAt(A)===NEWLINE&&++A;else if(D!==i)continue;return y.slice(w,R)}return C=!0,y.slice(w,v)}for(;(T=P())!==EOF;){for(var L=[];T!==EOL&&T!==EOF;)L.push(T),T=P();b&&(L=b(L,x++))==null||S.push(L)}return S}function l(y,b){return y.map(function(S){return b.map(function(v){return _(S[v])}).join(r)})}function u(y,b){return b==null&&(b=inferColumns(y)),[b.map(_).join(r)].concat(l(y,b)).join(`
`)}function d(y,b){return b==null&&(b=inferColumns(y)),l(y,b).join(`
`)}function f(y){return y.map(g).join(`
`)}function g(y){return y.map(_).join(r)}function _(y){return y==null?"":y instanceof Date?formatDate(y):e.test(y+="")?'"'+y.replace(/"/g,'""')+'"':y}return{parse:n,parseRows:o,format:u,formatBody:d,formatRows:f,formatRow:g,formatValue:_}}var csv=dsvFormat(","),csvParse=csv.parse,tsv=dsvFormat("	"),tsvParse=tsv.parse;const DEFAULT_DSV_PARSER_OPTIONS={delimiter:","},dsvParser=(r,e={},i)=>{i.type=DATAVIEW_TYPE.DSV;const n=mergeDeepImmer(DEFAULT_DSV_PARSER_OPTIONS,e),{delimiter:o}=n;if(!isString(o))throw new TypeError("Invalid delimiter: must be a string!");return dsvFormat(o).parse(r)},csvParser=(r,e={},i)=>(i.type=DATAVIEW_TYPE.DSV,csvParse(r)),tsvParser=(r,e={},i)=>(i.type=DATAVIEW_TYPE.DSV,tsvParse(r));function clone(r){if(!r)throw new Error("geojson is required");switch(r.type){case"Feature":return cloneFeature(r);case"FeatureCollection":return cloneFeatureCollection(r);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return cloneGeometry(r);default:throw new Error("unknown GeoJSON type")}}function cloneFeature(r){var e={type:"Feature"};return Object.keys(r).forEach(function(i){switch(i){case"type":case"properties":case"geometry":return;default:e[i]=r[i]}}),e.properties=cloneProperties(r.properties),e.geometry=cloneGeometry(r.geometry),e}function cloneProperties(r){var e={};return r&&Object.keys(r).forEach(function(i){var n=r[i];typeof n=="object"?n===null?e[i]=null:Array.isArray(n)?e[i]=n.map(function(o){return o}):e[i]=cloneProperties(n):e[i]=n}),e}function cloneFeatureCollection(r){var e={type:"FeatureCollection"};return Object.keys(r).forEach(function(i){switch(i){case"type":case"features":return;default:e[i]=r[i]}}),e.features=r.features.map(function(i){return cloneFeature(i)}),e}function cloneGeometry(r){var e={type:r.type};return r.bbox&&(e.bbox=r.bbox),r.type==="GeometryCollection"?(e.geometries=r.geometries.map(function(i){return cloneGeometry(i)}),e):(e.coordinates=deepSlice(r.coordinates),e)}function deepSlice(r){var e=r;return typeof e[0]!="object"?e.slice():e.map(function(i){return deepSlice(i)})}function getCoords(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function booleanClockwise(r){for(var e=getCoords(r),i=0,n=1,o,l;n<e.length;)o=l||e[0],l=e[n],i+=(l[0]-o[0])*(l[1]+o[1]),n++;return i>0}function featureEach(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var i=0;i<r.features.length&&e(r.features[i],i)!==!1;i++);}function geomEach(r,e){var i,n,o,l,u,d,f,g,_,y,b=0,S=r.type==="FeatureCollection",v=r.type==="Feature",A=S?r.features.length:1;for(i=0;i<A;i++){for(d=S?r.features[i].geometry:v?r.geometry:r,g=S?r.features[i].properties:v?r.properties:{},_=S?r.features[i].bbox:v?r.bbox:void 0,y=S?r.features[i].id:v?r.id:void 0,f=d?d.type==="GeometryCollection":!1,u=f?d.geometries.length:1,o=0;o<u;o++){if(l=f?d.geometries[o]:d,l===null){if(e(null,b,g,_,y)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,b,g,_,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(e(l.geometries[n],b,g,_,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}b++}}function flattenEach(r,e){geomEach(r,function(i,n,o,l,u){var d=i===null?null:i.type;switch(d){case null:case"Point":case"LineString":case"Polygon":return e(feature$2(i,o,{bbox:l,id:u}),n,0)===!1?!1:void 0}var f;switch(d){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var g=0;g<i.coordinates.length;g++){var _=i.coordinates[g],y={type:f,coordinates:_};if(e(feature$2(y,o),n,g)===!1)return!1}})}function rewind(r,e){if(e=e||{},!isObject(e))throw new Error("options is invalid");var i=e.reverse||!1,n=e.mutate||!1;if(!r)throw new Error("<geojson> is required");if(typeof i!="boolean")throw new Error("<reverse> must be a boolean");if(typeof n!="boolean")throw new Error("<mutate> must be a boolean");n===!1&&(r=clone(r));var o=[];switch(r.type){case"GeometryCollection":return geomEach(r,function(l){rewindFeature(l,i)}),r;case"FeatureCollection":return featureEach(r,function(l){featureEach(rewindFeature(l,i),function(u){o.push(u)})}),featureCollection(o)}return rewindFeature(r,i)}function rewindFeature(r,e){var i=r.type==="Feature"?r.geometry.type:r.type;switch(i){case"GeometryCollection":return geomEach(r,function(n){rewindFeature(n,e)}),r;case"LineString":return rewindLineString(getCoords(r),e),r;case"Polygon":return rewindPolygon(getCoords(r),e),r;case"MultiLineString":return getCoords(r).forEach(function(n){rewindLineString(n,e)}),r;case"MultiPolygon":return getCoords(r).forEach(function(n){rewindPolygon(n,e)}),r;case"Point":case"MultiPoint":return r}}function rewindLineString(r,e){booleanClockwise(r)===e&&r.reverse()}function rewindPolygon(r,e){booleanClockwise(r[0])!==e&&r[0].reverse();for(var i=1;i<r.length;i++)booleanClockwise(r[i])===e&&r[i].reverse()}function flatten$1(r){if(!r)throw new Error("geojson is required");var e=[];return flattenEach(r,function(i){e.push(i)}),featureCollection(e)}const geoPathInstance=geoPath(),DEFAULT_GEOJSON_OPTIONS={centroid:!1,name:!1,bbox:!1,rewind:!1},MultiToSingle=r=>{if(r.geometry.type.startsWith("Multi")){const e=flatten$1(r).features[0];return Object.assign(Object.assign({},e),e.properties)}return Object.assign(Object.assign({},r),r.properties)},flattenFeature=r=>{const e=[];return r.forEach(i=>{i.type==="FeatureCollection"?i.features.forEach(n=>{e.push(MultiToSingle(n))}):e.push(MultiToSingle(i))}),e},geoJSONParser=(r,e={},i)=>{i.type=DATAVIEW_TYPE.GEO;const n=mergeDeepImmer(DEFAULT_GEOJSON_OPTIONS,e),{centroid:o,name:l,bbox:u,rewind:d}=n;if(Array.isArray(r))return flattenFeature(r);let f=r.features;return d&&(f=rewind(r,{reverse:!isObject$1(d)||d.reverse}).features),f.forEach(g=>{if(o){const _=geoPathInstance.centroid(g);g.centroidX=_[0],g.centroidY=_[1]}if(l&&(g.name=g.properties.name),u){const _=geoPathInstance.bounds(g);g.bbox=_}}),r.features=f,r},DEFAULT_TOPOJSON_OPTIONS={},topoJSONParser=(r,e,i)=>{i.type=DATAVIEW_TYPE.GEO;const n=mergeDeepImmer(DEFAULT_GEOJSON_OPTIONS,DEFAULT_TOPOJSON_OPTIONS,e),{object:o}=n;if(!isString(o))throw new TypeError("Invalid object: must be a string!");const l=feature(r,r.objects[o]);return geoJSONParser(l,n,i)},dataViewParser=(r,e,i)=>{const n=!isBoolean(e==null?void 0:e.dependencyUpdate)||(e==null?void 0:e.dependencyUpdate);if(!r||!isArray(r))throw new TypeError("Invalid data: must be DataView array!");return isArray(i.rawData)&&i.rawData.forEach(o=>{o.target&&(o.target.removeListener("change",i.reRunAllTransform),o.target.removeListener("markRunning",i.markRunning))}),n&&r.forEach(o=>{o.target.addListener("change",i.reRunAllTransform),o.target.addListener("markRunning",i.markRunning)}),r};let idIndex=0;const maxId=1e8;function getUUID(r="dataset"){return idIndex>maxId&&(idIndex=0),r+"_"+idIndex++}class DataSet{constructor(e){var i;let n;this.options=e,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new EventEmitter,n=e!=null&&e.name?e.name:getUUID("dataset"),this.name=n,this._logger=(i=e==null?void 0:e.logger)!==null&&i!==void 0?i:Logger.getInstance()}setLogger(e){this._logger=e}getDataView(e){return this.dataViewMap[e]}setDataView(e,i){var n;this.dataViewMap[e]&&((n=this._logger)===null||n===void 0||n.error(`Error: dataView ${e} `)),this.dataViewMap[e]=i}removeDataView(e){this.dataViewMap[e]=null,delete this.dataViewMap[e]}registerParser(e,i){var n;this.parserMap[e]&&((n=this._logger)===null||n===void 0||n.warn(`Warn: transform ${e} `)),this.parserMap[e]=i}removeParser(e){this.parserMap[e]=null,delete this.parserMap[e]}getParser(e){return this.parserMap[e]||this.parserMap.default}registerTransform(e,i){var n;this.transformMap[e]&&((n=this._logger)===null||n===void 0||n.warn(`Warn: transform ${e} `)),this.transformMap[e]=i}removeTransform(e){this.transformMap[e]=null,delete this.transformMap[e]}getTransform(e){return this.transformMap[e]}multipleDataViewAddListener(e,i,n){this._callMap||(this._callMap=new Map);let o=this._callMap.get(n);o||(o=()=>{e.some(l=>l.isRunning)||n()}),e.forEach(l=>{l.target.addListener(i,o)}),this._callMap.set(n,o)}allDataViewAddListener(e,i){this.multipleDataViewAddListener(Object.values(this.dataViewMap),e,i)}multipleDataViewRemoveListener(e,i,n){if(this._callMap){const o=this._callMap.get(n);o&&e.forEach(l=>{l.target.removeListener(i,o)}),this._callMap.delete(n)}}multipleDataViewUpdateInParse(e){e.forEach(i=>{var n;return(n=this.getDataView(i.name))===null||n===void 0?void 0:n.markRunning()}),e.forEach(i=>{var n;return(n=this.getDataView(i.name))===null||n===void 0?void 0:n.parseNewData(i.data,i.options)})}multipleDataViewUpdateInRawData(e){e.forEach(i=>{var n;return(n=this.getDataView(i.name))===null||n===void 0?void 0:n.markRunning()}),e.forEach(i=>{var n;return(n=this.getDataView(i.name))===null||n===void 0?void 0:n.updateRawData(i.data,i.options)})}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const DataViewDiffRank="_data-view-diff-rank";class DataView{constructor(e,i){let n;this.dataSet=e,this.options=i,this.isDataView=!0,this.target=new EventEmitter,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(o={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach(l=>{this.executeTransform(l,{pushHistory:o.pushHistory,emitMessage:!1}),this.isLastTransform(l)&&this.diffLastData()}),this.isRunning=!1,o.emitMessage!==!1&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},n=i!=null&&i.name?i.name:getUUID("dataview"),this.name=n,i!=null&&i.history&&(this.history=i.history,this.historyData=[]),this.dataSet.setDataView(n,this),this.setFields(i==null?void 0:i.fields)}parse(e,i,n=!1){var o;this.isRunning=!0,n&&this.target.emit("beforeParse",[]),i&&(this.parseOption=i);const l=this.cloneParseData(e,i);if(i!=null&&i.type){const u=((o=this.dataSet.getParser(i.type))!==null&&o!==void 0?o:this.dataSet.getParser("bytejson"))(l,i.options,this);this.rawData=l,this.parserData=u,this.history&&this.historyData.push(l,u),this.latestData=u}else this.parserData=l,this.rawData=l,this.history&&this.historyData.push(l),this.latestData=l;return this.isRunning=!1,n&&this.target.emit("afterParse",[]),this}transform(e,i=!0){if(this.isRunning=!0,e&&e.type){let n=!0;if(e.type==="fields"){this._fields=e.options.fields;const o=this.transformsArr.findIndex(l=>l.type===e.type);o>=0&&(n=!1,this.transformsArr[o].options.fields=this._fields)}if(n&&this.transformsArr.push(e),i){const o=this.isLastTransform(e);this.executeTransform(e),o&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(e){return this.transformsArr[this.transformsArr.length-1]===e}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort((e,i)=>{var n,o;return((n=e.level)!==null&&n!==void 0?n:0)-((o=i.level)!==null&&o!==void 0?o:0)})}executeTransform(e,i={pushHistory:!0,emitMessage:!0}){const{pushHistory:n,emitMessage:o}=i,l=this.dataSet.getTransform(e.type)(this.latestData,e.options);this.history&&n!==!1&&this.historyData.push(l),this.latestData=l,o!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(e){this._diffData=!0,this._diffKeys=e,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var e;if(!this._diffData||!this.latestData.forEach||!(!((e=this._diffKeys)===null||e===void 0)&&e.length))return;const i=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach(n=>{n[DataViewDiffRank]=i,this._diffMap.set(this._diffKeys.reduce((o,l)=>o+n[l],""),n)}),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let n;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach(o=>{o[DataViewDiffRank]=i,n=this._diffKeys.reduce((l,u)=>l+o[u],""),this._diffMap.get(n)?this.latestDataAUD.update.push(o):this.latestDataAUD.add.push(o),this._diffMap.set(n,o)}),this._diffMap.forEach((o,l)=>{o[DataViewDiffRank]<i&&(this.latestDataAUD.del.push(o),this._diffMap.delete(l))})}this._diffRank=i}cloneParseData(e,i){let n=!1;return e instanceof DataView||(i==null?void 0:i.clone)!==!0||(n=!0),n?cloneDeep(e):e}parseNewData(e,i){this.parse(e,i||this.parseOption),this.reRunAllTransform()}updateRawData(e,i){const n=this.cloneParseData(e,i);this.rawData=n,this.parserData=n,this.latestData=n,this.reRunAllTransform()}getFields(){var e;return this._fields?this._fields:((e=this.parseOption)===null||e===void 0?void 0:e.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(e,i=!1){this._fields=e&&i?merge$1({},this._fields,e):e;const n=this.transformsArr.find(o=>o.type==="fields");!isNil(this._fields)&&isNil(n)?(this.dataSet.registerTransform("fields",fields),this.transform({type:"fields",options:{fields:this._fields}},!1)):n&&(n.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}class Generator{static GenAutoIncrementId(){return Generator.auto_increment_id++}}Generator.auto_increment_id=0;class ContainerModule{constructor(e){this.id=Generator.GenAutoIncrementId(),this.registry=e}}const NAMED_TAG="named",INJECT_TAG="inject",MULTI_INJECT_TAG="multi_inject",TAGGED="inversify:tagged",PARAM_TYPES="inversify:paramtypes";class Metadata{constructor(e,i){this.key=e,this.value=i}toString(){return this.key===NAMED_TAG?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}const Reflect$1=function(r){var e;return function(i){const n=typeof Symbol=="function",o=n&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",l=Object.getPrototypeOf(Function),u=Map,d=new WeakMap;function f(F,V,G,Y){if(!R(G))throw new TypeError;return T(F,V,G,Y)}function g(F,V,G){if(!R(V))throw new TypeError;return E(G)||(G=B(G)),S(F,V,G)}function _(F,V,G){if(!R(V))throw new TypeError;return E(G)||(G=B(G)),v(F,V,G)}function y(F,V,G){if(!R(V))throw new TypeError;return E(G)||(G=B(G)),A(F,V,G)}function b(F,V,G){let Y=d.get(F);if(E(Y)){if(!G)return;Y=new u,d.set(F,Y)}let J=Y.get(V);if(E(J)){if(!G)return;J=new u,Y.set(V,J)}return J}function S(F,V,G){if(v(F,V,G))return!0;const Y=H(V);return!P(Y)&&S(F,Y,G)}function v(F,V,G){const Y=b(V,G,!1);return!E(Y)&&I(Y.has(F))}function A(F,V,G){if(v(F,V,G))return x(F,V,G);const Y=H(V);return P(Y)?void 0:A(F,Y,G)}function x(F,V,G){const Y=b(V,G,!1);if(!E(Y))return Y.get(F)}function T(F,V,G,Y){b(G,Y,!0).set(F,V)}function C(F){if(F===null)return 1;switch(typeof F){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return F===null?1:6;default:return 6}}function E(F){return F===void 0}function P(F){return F===null}function L(F){return typeof F=="symbol"}function R(F){return typeof F=="object"?F!==null:typeof F=="function"}function w(F,V){switch(C(F)){case 0:case 1:case 2:case 3:case 4:case 5:return F}const G="string",Y=$(F,o);if(Y!==void 0){const J=Y.call(F,G);if(R(J))throw new TypeError;return J}return D(F)}function D(F,V){{const G=F.toString;if(N(G)){const J=G.call(F);if(!R(J))return J}const Y=F.valueOf;if(N(Y)){const J=Y.call(F);if(!R(J))return J}}throw new TypeError}function I(F){return!!F}function O(F){return""+F}function B(F){const V=w(F);return L(V)?V:O(V)}function N(F){return typeof F=="function"}function $(F,V){const G=F[V];if(G!=null){if(!N(G))throw new TypeError;return G}}function H(F){const V=Object.getPrototypeOf(F);if(typeof F!="function"||F===l||V!==l)return V;const G=F.prototype,Y=G&&Object.getPrototypeOf(G);if(Y==null||Y===Object.prototype)return V;const J=Y.constructor;return typeof J!="function"||J===F?V:J}i("defineMetadata",f),i("hasMetadata",g),i("hasOwnMetadata",_),i("getMetadata",y)}((e=r,function(i,n){typeof e[i]!="function"&&Object.defineProperty(e,i,{configurable:!0,writable:!0,value:n})})),r}({});function _tagParameterOrProperty(r,e,i,n){const o=[n];let l={};Reflect$1.hasOwnMetadata(r,e)&&(l=Reflect$1.getMetadata(r,e));let u=l[i];u===void 0&&(u=[]),u.push(...o),l[i]=u,Reflect$1.defineMetadata(r,l,e)}function tagParameter(r,e,i,n){_tagParameterOrProperty(TAGGED,r,i.toString(),n)}function createTaggedDecorator(r){return(e,i,n)=>{tagParameter(e,i,n,r)}}function injectBase(r){return e=>(i,n,o)=>createTaggedDecorator(new Metadata(r,e))(i,n,o)}const inject=injectBase(INJECT_TAG),multiInject=injectBase(MULTI_INJECT_TAG);function injectable(){return function(r){return Reflect$1.defineMetadata(PARAM_TYPES,null,r),r}}function named(r){return createTaggedDecorator(new Metadata(NAMED_TAG,r))}const BindingScopeEnum={Singleton:"Singleton",Transient:"Transient"},BindingTypeEnum={ConstantValue:"ConstantValue",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid"};class Binding{constructor(e,i){this.id=Generator.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=e,this.scope=i,this.type=BindingTypeEnum.Invalid,this.constraint=n=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const e=new Binding(this.serviceIdentifier,this.scope);return e.activated=e.scope===BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.provider=this.provider,e.constraint=this.constraint,e.cache=this.cache,e}}class MetadataReader{getConstructorMetadata(e){return{compilerGeneratedMetadata:Reflect$1.getMetadata(PARAM_TYPES,e),userGeneratedMetadata:Reflect$1.getMetadata(TAGGED,e)||{}}}getPropertiesMetadata(e){throw new Error("")}}const taggedConstraint=r=>e=>{const i=n=>{if(n==null)return!1;if(n.key===r&&n.value===e)return!0;if(n.constructorArgsMetadata==null)return!1;const o=n.constructorArgsMetadata;for(let l=0;l<o.length;l++)if(o[l].key===r&&o[l].value===e)return!0;return!1};return i.metaData=new Metadata(r,e),i},namedConstraint=taggedConstraint(NAMED_TAG);class BindingInSyntax{constructor(e){this._binding=e}inRequestScope(){throw new Error("")}inSingletonScope(){return this._binding.scope=BindingScopeEnum.Singleton,this}inTransientScope(){return this._binding.scope=BindingScopeEnum.Transient,this}whenTargetNamed(e){return this._binding.constraint=namedConstraint(e),this}}class BindingToSyntax{constructor(e){this._binding=e}to(e){return this._binding.type=BindingTypeEnum.Instance,this._binding.implementationType=e,new BindingInSyntax(this._binding)}toSelf(){const e=this._binding.serviceIdentifier;return this.to(e)}toDynamicValue(e){return this._binding.type=BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new BindingInSyntax(this._binding)}toConstantValue(e){return this._binding.type=BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=BindingScopeEnum.Singleton,new BindingInSyntax(this._binding)}toFactory(e){return this._binding.type=BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=BindingScopeEnum.Singleton,new BindingInSyntax(this._binding)}toService(e){this.toDynamicValue(i=>i.container.get(e))}}class Container{constructor(e){const i=e||{};i.defaultScope=i.defaultScope||BindingScopeEnum.Transient,this.options=i,this.id=Generator.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new MetadataReader}load(e){const i=this._getContainerModuleHelpersFactory()(e.id);e.registry(i.bindFunction,i.unbindFunction,i.isboundFunction,i.rebindFunction)}get(e){const i=this._getNotAllArgs(e,!1);return this._get(i)}getAll(e){const i=this._getAllArgs(e);return this._get(i)}getTagged(e,i,n){const o=this._getNotAllArgs(e,!1,i,n);return this._get(o)}getNamed(e,i){return this.getTagged(e,NAMED_TAG,i)}isBound(e){return this._bindingDictionary.has(e)}bind(e){const i=this.options.defaultScope,n=new Binding(e,i),o=this._bindingDictionary.get(e)||[];return o.push(n),this._bindingDictionary.set(e,o),new BindingToSyntax(n)}unbind(e){this._bindingDictionary.delete(e)}rebind(e){return this.unbind(e),this.bind(e)}_getContainerModuleHelpersFactory(){const e=(u,d)=>{u._binding.moduleId=d},i=u=>d=>{const f=this.bind(d);return e(f,u),f},n=()=>u=>this.unbind(u),o=()=>u=>this.isBound(u),l=u=>d=>{const f=this.rebind(d);return e(f,u),f};return u=>({bindFunction:i(u),isboundFunction:o(),rebindFunction:l(u),unbindFunction:n(),unbindAsyncFunction:d=>null})}_getNotAllArgs(e,i,n,o){return{avoidConstraints:!1,isMultiInject:i,serviceIdentifier:e,key:n,value:o}}_getAllArgs(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}}_get(e){const i=[];return this._bindingDictionary.get(e.serviceIdentifier).filter(n=>n.constraint(e)).forEach(n=>{i.push(this._resolveFromBinding(n))}),e.isMultiInject||i.length!==1?i:i[0]}_getChildRequest(e){const i=e.implementationType,{userGeneratedMetadata:n}=this._metadataReader.getConstructorMetadata(i),o=Object.keys(n),l=[];for(let u=0;u<o.length;u++){const d=n[u],f={};d.forEach(S=>{f[S.key]=S.value});const g={inject:f[INJECT_TAG],multiInject:f[MULTI_INJECT_TAG]},_=g.inject||g.multiInject,y={serviceIdentifier:_,constructorArgsMetadata:d},b={injectIdentifier:_,metadata:d,bindings:this._bindingDictionary.get(_).filter(S=>S.constraint(y))};l.push(b)}return l}_resolveFromBinding(e){const i=this._getResolvedFromBinding(e);return this._saveToScope(e,i),i}_getResolvedFromBinding(e){let i;switch(e.type){case BindingTypeEnum.ConstantValue:case BindingTypeEnum.Function:i=e.cache;break;case BindingTypeEnum.Instance:i=this._resolveInstance(e,e.implementationType);break;default:i=e.dynamicValue({container:this})}return i}_resolveInstance(e,i){if(e.activated)return e.cache;const n=this._getChildRequest(e);return this._createInstance(i,n)}_createInstance(e,i){return i.length?new e(...this._resolveRequests(i)):new e}_resolveRequests(e){return e.map(i=>i.bindings.length>1?i.bindings.map(n=>this._resolveFromBinding(n)):this._resolveFromBinding(i.bindings[0]))}_saveToScope(e,i){e.scope===BindingScopeEnum.Singleton&&(e.cache=i,e.activated=!0)}}const ContributionProvider=Symbol("ContributionProvider");class ContributionProviderCache{constructor(e,i){this.serviceIdentifier=e,this.container=i}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function bindContributionProvider(r,e){r(ContributionProvider).toDynamicValue(({container:i})=>new ContributionProviderCache(e,i)).inSingletonScope().whenTargetNamed(e)}function bindContributionProviderNoSingletonScope(r,e){r(ContributionProvider).toDynamicValue(({container:i})=>new ContributionProviderCache(e,i)).whenTargetNamed(e)}class Hook{constructor(e,i){this._args=e,this.name=i,this.taps=[]}tap(e,i){this._tap("sync",e,i)}unTap(e,i){const n=typeof e=="string"?e.trim():e.name;n&&(this.taps=this.taps.filter(o=>!(o.name===n&&(!i||o.fn===i))))}_parseOptions(e,i,n){let o;if(typeof i=="string")o={name:i.trim()};else if(typeof i!="object"||i===null)throw new Error("Invalid tap options");if(typeof o.name!="string"||o.name==="")throw new Error("Missing name for tap");return o=Object.assign({type:e,fn:n},o),o}_tap(e,i,n){this._insert(this._parseOptions(e,i,n))}_insert(e){let i;typeof e.before=="string"?i=new Set([e.before]):Array.isArray(e.before)&&(i=new Set(e.before));let n=0;typeof e.stage=="number"&&(n=e.stage);let o=this.taps.length;for(;o>0;){o--;const l=this.taps[o];this.taps[o+1]=l;const u=l.stage||0;if(i){if(i.has(l.name)){i.delete(l.name);continue}if(i.size>0)continue}if(!(u>n)){o++;break}}this.taps[o]=e}}class SyncHook extends Hook{call(...e){this.taps.map(i=>i.fn).forEach(i=>i(...e))}}const EnvContribution=Symbol.for("EnvContribution"),VGlobal=Symbol.for("VGlobal");var __decorate$1b=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$T=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$H=function(r,e){return function(i,n){e(i,n,r)}},__awaiter$9=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};let DefaultGlobal=class{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(r){this._isImageAnonymous=r}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(r){this._env||this.setEnv("browser"),this.envContribution.supportEvent=r}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(r){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=r}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(r){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=r}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(r){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=r}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(r){this._env||this.setEnv("browser"),this.envContribution.applyStyles=r}constructor(r){this.contributions=r,this._isImageAnonymous=!0,this.id=Generator.GenAutoIncrementId(),this.hooks={onSetEnv:new SyncHook(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(r){const e=[];if(this.contributions.getContributions().forEach(i=>{const n=i.configure(this,r);n&&n.then&&e.push(n)}),e.length)return Promise.all(e)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(r,e){if(e&&e.force===!0||this._env!==r)return this.deactiveCurrentEnv(),this.activeEnv(r,e)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(r,e){const i=this._env;this._env=r;const n=this.bindContribution(e);if(n&&n.then)return n.then(()=>{this.envParams=e,this.hooks.onSetEnv.call(i,r,this)});this.envParams=e,this.hooks.onSetEnv.call(i,r,this)}setActiveEnvContribution(r){this.envContribution=r}createCanvas(r){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(r)}createOffscreenCanvas(r){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(r)}releaseCanvas(r){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(r)}addEventListener(r,e,i){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(r,e,i)}removeEventListener(r,e,i){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(r,e,i)}dispatchEvent(r){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(r)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(r){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(r):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(r,e){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(r,e):null}loadImage(r){return this._env||this.setEnv("browser"),this.envContribution.loadImage(r)}loadSvg(r){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(r)}loadJson(r){return this._env||this.setEnv("browser"),this.envContribution.loadJson(r)}loadArrayBuffer(r){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(r)}loadBlob(r){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(r)}loadFont(r,e,i){return __awaiter$9(this,void 0,void 0,function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(r,e,i)})}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(r){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(r)}removeDom(r){return this._env||this.setEnv("browser"),this.envContribution.removeDom(r)}createDom(r){return this._env||this.setEnv("browser"),this.envContribution.createDom(r)}updateDom(r,e){return this._env||this.setEnv("browser"),this.envContribution.updateDom(r,e)}getElementTop(r,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(r,e)}getElementLeft(r,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(r,e)}getElementTopLeft(r,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(r,e)}};DefaultGlobal=__decorate$1b([injectable(),__param$H(0,inject(ContributionProvider)),__param$H(0,named(EnvContribution)),__metadata$T("design:paramtypes",[Object])],DefaultGlobal);var MeasureModeEnum;(function(r){r[r.estimate=0]="estimate",r[r.actualBounding=1]="actualBounding",r[r.fontBounding=2]="fontBounding"})(MeasureModeEnum||(MeasureModeEnum={}));const circleThreshold=tau$1-1e-8;class BoundsContext{constructor(e){this.init(e)}init(e){this.bounds=e}arc(e,i,n,o,l,u){if(Math.abs(l-o)>circleThreshold)return this.bounds.add(e-n,i-n),void this.bounds.add(e+n,i+n);let d,f,g,_,y=1/0,b=-1/0,S=1/0,v=-1/0;function A(x){g=n*Math.cos(x),_=n*Math.sin(x),g<y&&(y=g),g>b&&(b=g),_<S&&(S=_),_>v&&(v=_)}if(A(o),A(l),l!==o)if((o%=tau$1)<0&&(o+=tau$1),(l%=tau$1)<0&&(l+=tau$1),l<o&&(u=!u,d=o,o=l,l=d),u)for(l-=tau$1,d=o-o%halfPi$2,f=0;f<4&&d>l;++f,d-=halfPi$2)A(d);else for(d=o-o%halfPi$2+halfPi$2,f=0;f<4&&d<l;++f,d+=halfPi$2)A(d);this.bounds.add(e+y,i+S),this.bounds.add(e+b,i+v)}arcTo(e,i,n,o,l){this.bounds.add(e,i)}bezierCurveTo(e,i,n,o,l,u){this.bounds.add(e,i),this.bounds.add(n,o),this.bounds.add(l,u)}closePath(){}ellipse(){throw new Error("ellipse")}lineTo(e,i){this.bounds.add(e,i)}moveTo(e,i){this.bounds.add(e,i)}quadraticCurveTo(e,i,n,o){this.bounds.add(e,i),this.bounds.add(n,o)}rect(e,i,n,o){this.bounds.add(e,i),this.bounds.add(e+n,i+o)}clear(){this.bounds.clear()}release(...e){}}class CurvePath{constructor(){this.curves=[],this.bounds=new AABBBounds}getCurveLengths(){return this.curves.map(e=>e.getLength())}getPointAt(e){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},enumCommandMap={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let currPath,coordsStr,commandChar,coordStr,coordNumber,standardCommandLen;function parseSvgPath(r){if(!r)return[];const e=r.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(e===null)return[];let i,n;const o=[];for(let l=0,u=e.length;l<u;l++)if(currPath=e[l],coordsStr=currPath.slice(1),commandChar=currPath[0],i=[commandChar],n=coordsStr.match(rePathCommand),n!==null){for(let d=0,f=n.length;d<f;d++)coordStr=n[d],coordNumber=parseFloat(coordStr),Number.isNaN(coordNumber)||i.push(coordNumber);if(standardCommandLen=commandLengths[commandChar],i.length-1>standardCommandLen){let d,f=commandChar;for(let g=1,_=i.length;g<_;g+=standardCommandLen){d=[f];for(let y=g,b=g+standardCommandLen;y<b;y++)d.push(i[y]);o.push(d),f==="m"?f="l":f==="M"&&(f="L")}}else o.push(i)}else o.push(i);return o}var UpdateTag;(function(r){r[r.NONE=0]="NONE",r[r.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",r[r.UPDATE_SHAPE=2]="UPDATE_SHAPE",r[r.CLEAR_SHAPE=253]="CLEAR_SHAPE",r[r.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",r[r.INIT=179]="INIT",r[r.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",r[r.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",r[r.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",r[r.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",r[r.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",r[r.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",r[r.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",r[r.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(UpdateTag||(UpdateTag={}));var IContainPointMode;(function(r){r[r.GLOBAL=1]="GLOBAL",r[r.LOCAL=16]="LOCAL",r[r.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",r[r.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"})(IContainPointMode||(IContainPointMode={}));var AttributeUpdateType;(function(r){r[r.INIT=0]="INIT",r[r.DEFAULT=1]="DEFAULT",r[r.STATE=2]="STATE",r[r.ANIMATE_BIND=10]="ANIMATE_BIND",r[r.ANIMATE_PLAY=11]="ANIMATE_PLAY",r[r.ANIMATE_START=12]="ANIMATE_START",r[r.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",r[r.ANIMATE_END=14]="ANIMATE_END",r[r.TRANSLATE=20]="TRANSLATE",r[r.TRANSLATE_TO=21]="TRANSLATE_TO",r[r.SCALE=22]="SCALE",r[r.SCALE_TO=23]="SCALE_TO",r[r.ROTATE=24]="ROTATE",r[r.ROTATE_TO=25]="ROTATE_TO"})(AttributeUpdateType||(AttributeUpdateType={}));var AnimateStatus;(function(r){r[r.INITIAL=0]="INITIAL",r[r.RUNNING=1]="RUNNING",r[r.PAUSED=2]="PAUSED",r[r.END=3]="END"})(AnimateStatus||(AnimateStatus={}));var AnimateMode;(function(r){r[r.NORMAL=0]="NORMAL",r[r.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"})(AnimateMode||(AnimateMode={}));var AnimateStepType;(function(r){r.wait="wait",r.from="from",r.to="to",r.customAnimate="customAnimate"})(AnimateStepType||(AnimateStepType={}));var Direction$1;(function(r){r[r.ROW=1]="ROW",r[r.COLUMN=2]="COLUMN"})(Direction$1||(Direction$1={}));var CurveTypeEnum;(function(r){r[r.CubicBezierCurve=0]="CubicBezierCurve",r[r.QuadraticBezierCurve=1]="QuadraticBezierCurve",r[r.ArcCurve=2]="ArcCurve",r[r.LineCurve=3]="LineCurve",r[r.EllipseCurve=4]="EllipseCurve",r[r.MoveCurve=5]="MoveCurve"})(CurveTypeEnum||(CurveTypeEnum={}));var BaseRenderContributionTime;(function(r){r[r.beforeFillStroke=0]="beforeFillStroke",r[r.afterFillStroke=1]="afterFillStroke"})(BaseRenderContributionTime||(BaseRenderContributionTime={}));function segments(r,e,i,n,o,l,u,d,f){const g=degreeToRadian(u),_=Math.sin(g),y=Math.cos(g),b=y*(d-r)*.5+_*(f-e)*.5,S=y*(f-e)*.5-_*(d-r)*.5;let v=b*b/((i=Math.abs(i))*i)+S*S/((n=Math.abs(n))*n);v>1&&(v=Math.sqrt(v),i*=v,n*=v);const A=y/i,x=_/i,T=-_/n,C=y/n,E=A*d+x*f,P=T*d+C*f,L=A*r+x*e,R=T*r+C*e;let w=1/((L-E)*(L-E)+(R-P)*(R-P))-.25;w<0&&(w=0);let D=Math.sqrt(w);l===o&&(D=-D);const I=.5*(E+L)-D*(R-P),O=.5*(P+R)+D*(L-E),B=Math.atan2(P-O,E-I);let N=Math.atan2(R-O,L-I)-B;N<0&&l===1?N+=tau$1:N>0&&l===0&&(N-=tau$1);const $=Math.ceil(Math.abs(N/(halfPi$2+.001))),H=[];for(let F=0;F<$;++F){const V=B+F*N/$,G=B+(F+1)*N/$;H[F]=[I,O,V,G,i,n,_,y]}return H}function bezier(r){const e=r[0],i=r[1],n=r[2],o=r[3],l=r[4],u=r[5],d=r[6],f=r[7],g=f*l,_=-d*u,y=d*l,b=f*u,S=Math.cos(n),v=Math.sin(n),A=Math.cos(o),x=Math.sin(o),T=.5*(o-n),C=Math.sin(.5*T),E=8/3*C*C/Math.sin(T),P=e+S-E*v,L=i+v+E*S,R=e+A,w=i+x,D=R+E*x,I=w-E*A;return[g*P+_*L,y*P+b*L,g*D+_*I,y*D+b*I,g*R+_*w,y*R+b*w]}function drawArc(r,e,i,n){const o=segments(n[5],n[6],n[0],n[1],n[3],n[4],n[2],e,i);for(let l=0;l<o.length;++l){const u=bezier(o[l]);r.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5])}}const addArcToBezierPath$1=(r,e,i,n,o,l,u)=>{const d=Math.abs(i-e),f=d>.5*Math.PI?Math.ceil(2*d/Math.PI):1,g=(i-e)/f;for(let _=0;_<f;_++){const y=e+g*_,b=e+g*(_+1),S=4*Math.tan(Math.abs(g)/4)/3,v=b<y?-1:1,A=Math.cos(y),x=Math.sin(y),T=Math.cos(b),C=Math.sin(b),E=A*l+n,P=x*u+o,L=T*l+n,R=C*u+o,w=l*S*v,D=u*S*v;r.push(E-w*x,P+D*A,L+w*C,R-D*T,L,R)}},commandFuncs=[(r,e,i,n,o,l,u)=>e.arc(r[1]*o+i,r[2]*l+n,r[3]*(o+l)/2,r[4],r[5],r[6],u),(r,e,i,n,o,l,u)=>e.arcTo(r[1]*o+i,r[2]*l+n,r[3]*o+i,r[4]*l+n,r[5]*(o+l)/2,u),(r,e,i,n,o,l,u)=>e.bezierCurveTo(r[1]*o+i,r[2]*l+n,r[3]*o+i,r[4]*l+n,r[5]*o+i,r[6]*l+n,u),(r,e,i,n)=>e.closePath(),(r,e,i,n,o,l)=>e.ellipse(r[1]*o+i,r[2]*l+n,r[3]*o,r[4]*l,r[5],r[6],r[7],r[8]),(r,e,i,n,o,l,u)=>e.lineTo(r[1]*o+i,r[2]*l+n,u),(r,e,i,n,o,l,u)=>e.moveTo(r[1]*o+i,r[2]*l+n,u),(r,e,i,n,o,l,u)=>e.quadraticCurveTo(r[1]*o+i,r[2]*l+n,r[3]*o+i,r[4]*l+n,u),(r,e,i,n,o,l,u)=>e.rect(r[1]*o+i,r[2]*l+n,r[3]*o,r[4]*l,u)];function renderCommandList(r,e,i=0,n=0,o=1,l=1,u){for(let d=0;d<r.length;d++){const f=r[d];commandFuncs[f[0]](f,e,i,n,o,l,u)}}class Curve{getLength(e){return e!=null?this.calcProjLength(e):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function snapLength(r,e){let i=0;const n=r.length;for(let o=0;o<n;o++){const l=r[o],u=e[o],d=r[(o+1)%n],f=e[(o+1)%n];i+=PointService.distanceNN(l,u,d,f)}return i/2}function cubicLength(r,e,i,n,o){return snapLength([r.x,e.x,i.x,n.x],[r.y,e.y,i.y,n.y])}function cubicCalc(r,e,i,n,o){const l=1-o;return l*l*l*r+3*e*o*l*l+3*i*o*o*l+n*o*o*o}function cubicPointAt(r,e,i,n,o){const l=cubicCalc(r.x,e.x,i.x,n.x,o),u=cubicCalc(r.y,e.y,i.y,n.y,o);return new Point(l,u)}function divideCubic(r,e){const{p0:i,p1:n,p2:o,p3:l}=r,u=cubicPointAt(i,n,o,l,e),d=PointService.pointAtPP(i,n,e),f=PointService.pointAtPP(n,o,e),g=PointService.pointAtPP(o,l,e),_=PointService.pointAtPP(d,f,e),y=PointService.pointAtPP(f,g,e);return[new CubicBezierCurve(i,d,_,u),new CubicBezierCurve(u,y,g,l)]}class CubicBezierCurve extends Curve{constructor(e,i,n,o){super(),this.type=CurveTypeEnum.CubicBezierCurve,this.p0=e,this.p1=i,this.p2=n,this.p3=o}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(e){if(this.defined!==!1)return cubicPointAt(this.p0,this.p1,this.p2,this.p3,e);throw new Error("definedfalsegetPointAt")}calcLength(){return this._validPoint()?cubicLength(this.p0,this.p1,this.p2,this.p3):60}calcProjLength(e){return e===Direction$1.ROW?abs$1(this.p0.x-this.p3.x):e===Direction$1.COLUMN?abs$1(this.p0.y-this.p3.y):0}getAngleAt(e){const i=max$1(e-.01,0),n=min$1(e+.01,1),o=this.getPointAt(i),l=this.getPointAt(n);return atan2$1(l.y-o.y,l.x-o.x)}}function divideLinear(r,e){const{p0:i,p1:n}=r,o=PointService.pointAtPP(i,n,e);return[new LineCurve(i,o),new LineCurve(o,n)]}class LineCurve extends Curve{constructor(e,i){super(),this.type=CurveTypeEnum.LineCurve,this.p0=e,this.p1=i}getPointAt(e){if(this.defined!==!1)return PointService.pointAtPP(this.p0,this.p1,e);throw new Error("definedfalsegetPointAt")}getAngleAt(e){return this.angle==null&&(this.angle=atan2$1(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?PointService.distancePP(this.p0,this.p1):60}calcProjLength(e){return e===Direction$1.ROW?abs$1(this.p0.x-this.p1.x):e===Direction$1.COLUMN?abs$1(this.p0.y-this.p1.y):0}}class SegContext{get endX(){return this._lastX}get endY(){return this._lastY}constructor(e,i){this.init(e,i)}init(e,i){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=e,this.direction=i,this.curves=[]}bezierCurveTo(e,i,n,o,l,u,d,f){const g=new CubicBezierCurve(new Point(this._lastX,this._lastY),new Point(e,i),new Point(n,o),new Point(l,u));g.originP1=this._lastOriginP,g.originP2=f,g.defined=d,this.curves.push(g),this._lastX=l,this._lastY=u,this._lastOriginP=f}closePath(){if(this.curves.length<2)return;const e=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,e.defined,this._startOriginP)}ellipse(){throw new Error("SegContextellipse")}lineTo(e,i,n,o){const l=this.addLinearCurve(e,i,n,this._lastOriginP,o);this.curves.push(l),this._lastX=e,this._lastY=i,this._lastOriginP=o}moveTo(e,i,n){return this._lastX=this._startX=e,this._lastY=this._startY=i,this._lastOriginP=n,this._startOriginP=n,this}quadraticCurveTo(e,i,n,o){throw new Error("SegContextquadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(e){return this.getLength(e)}addLinearCurve(e,i,n,o,l){const u=new LineCurve(new Point(this._lastX,this._lastY),new Point(e,i));return u.originP1=o,u.originP2=l,u.defined=n,u}getPointAt(e){throw new Error("")}getCurveLengths(){return[]}getLength(e){var i,n;if(e===Direction$1.COLUMN){if(!this.curves.length)return 0;const o=this.curves[0],l=this.curves[this.curves.length-1],u=(i=l.p3)!==null&&i!==void 0?i:l.p1;return abs$1(o.p0.y-u.y)}if(e===Direction$1.ROW){if(!this.curves.length)return 0;const o=this.curves[0],l=this.curves[this.curves.length-1],u=(n=l.p3)!==null&&n!==void 0?n:l.p1;return abs$1(o.p0.x-u.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce((o,l)=>o+l.getLength(),0)),this.length}}class ReflectSegContext extends SegContext{bezierCurveTo(e,i,n,o,l,u,d,f){return super.bezierCurveTo(i,e,o,n,u,l,d,f)}lineTo(e,i,n,o){return super.lineTo(i,e,n,o)}moveTo(e,i,n){return super.moveTo(i,e,n)}clear(){return super.clear()}}function genCurveSegments(r,e,i=1){let n=!1;for(let o=0,l=e.length;o<=l;o++)o>=l===n&&((n=!n)?r.lineStart():r.lineEnd()),n&&r.point(e[o])}function genSegContext(r,e,i){const n=e??(abs$1(i[i.length-1].x-i[0].x)>abs$1(i[i.length-1].y-i[0].y)?Direction$1.ROW:Direction$1.COLUMN);return r==="monotoneY"?new ReflectSegContext(r,n):new SegContext(r,n)}class Linear{constructor(e,i){this.context=e,i&&(this.startPoint=i)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){const i=e.x,n=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,n,this._lastDefined!==!1&&e.defined!==!1,e):this.context.moveTo(i,n,e);break;case 1:this._point=2;default:this.context.lineTo(i,n,this._lastDefined!==!1&&e.defined!==!1,e)}this._lastDefined=e.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function genLinearSegments(r,e={}){const{direction:i,startPoint:n}=e;if(r.length<2-+!!n)return null;const o=genSegContext("linear",i,r);return genLinearTypeSegments(new Linear(o,n),r),o}function genLinearTypeSegments(r,e){return genCurveSegments(r,e,1)}function point$3(r,e,i,n,o){r.context.bezierCurveTo((2*r._x0+r._x1)/3,(2*r._y0+r._y1)/3,(r._x0+2*r._x1)/3,(r._y0+2*r._y1)/3,(r._x0+4*r._x1+e)/6,(r._y0+4*r._y1+i)/6,n,r.lastPoint1)}class Basis{constructor(e,i){this.context=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&point$3(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){const i=e.x,n=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,n,this._lastDefined1!==!1&&this._lastDefined2!==!1,e):this.context.moveTo(i,n,e);break;case 1:this._point=2;break;default:point$3(this,i,n,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}function genBasisTypeSegments(r,e){return genCurveSegments(r,e,2)}function genBasisSegments(r,e={}){const{direction:i,startPoint:n}=e;if(r.length<2-+!!n)return null;if(r.length<3-+!!n)return genLinearSegments(r,e);const o=genSegContext("basis",i,r);return genBasisTypeSegments(new Basis(o,n),r),o}function sign(r){return r<0?-1:1}function slope3(r,e,i){const n=r._x1-r._x0,o=e-r._x1,l=(r._y1-r._y0)/(n||Number(o<0&&-0)),u=(i-r._y1)/(o||Number(n<0&&-0)),d=(l*o+u*n)/(n+o);return(sign(l)+sign(u))*Math.min(Math.abs(l),Math.abs(u),.5*Math.abs(d))||0}function slope2(r,e){const i=r._x1-r._x0;return i?(3*(r._y1-r._y0)/i-e)/2:e}function point$2(r,e,i,n,o){const l=r._x0,u=r._y0,d=r._x1,f=r._y1,g=(d-l)/3;r.context.bezierCurveTo(l+g,u+g*e,d-g,f-g*i,d,f,n,r.lastPoint1)}class MonotoneX{constructor(e,i){this.context=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:point$2(this,this._t0,slope2(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){let i=NaN;const n=e.x,o=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(n,o,this._lastDefined1!==!1&&this._lastDefined2!==!1,e):this.context.moveTo(n,o,e);break;case 1:this._point=2;break;case 2:this._point=3,point$2(this,slope2(this,i=slope3(this,n,o)),i,this._lastDefined1!==!1&&this._lastDefined2!==!1);break;default:point$2(this,this._t0,i=slope3(this,n,o),this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=o,this._t0=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}class MonotoneY extends MonotoneX{constructor(e,i){super(e,i)}point(e){return super.point({y:e.x,x:e.y,defined:e.defined})}}function genMonotoneXTypeSegments(r,e){return genCurveSegments(r,e,2)}function genMonotoneXSegments(r,e={}){const{direction:i,startPoint:n}=e;if(r.length<2-+!!n)return null;if(r.length<3-+!!n)return genLinearSegments(r,e);const o=genSegContext("monotoneX",i,r);return genMonotoneXTypeSegments(new MonotoneX(o,n),r),o}function genMonotoneYTypeSegments(r,e){return genCurveSegments(r,e,2)}function genMonotoneYSegments(r,e={}){const{direction:i,startPoint:n}=e;if(r.length<2-+!!n)return null;if(r.length<3-+!!n)return genLinearSegments(r,e);const o=genSegContext("monotoneY",i,r);return genMonotoneYTypeSegments(new MonotoneY(o,n),r),o}let Step$1=class{constructor(e,i=.5,n){this.context=e,this._t=i,this.startPoint=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(e){const i=e.x,n=e.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,n,this._lastDefined!==!1&&e.defined!==!1,e):this.context.moveTo(i,n,e);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,n,this._lastDefined!==!1&&e.defined!==!1,this.lastPoint),this.context.lineTo(i,n,this._lastDefined!==!1&&e.defined!==!1,e);else{const o=this._x*(1-this._t)+i*this._t;this._t===.5?this.context.lineTo(o,this._y,this._lastDefined!==!1,this.lastPoint):this.context.lineTo(o,this._y,this._lastDefined!==!1&&e.defined!==!1,this.lastPoint),this.context.lineTo(o,n,this._lastDefined!==!1&&e.defined!==!1,e)}}this._lastDefined=e.defined,this._x=i,this._y=n,this.lastPoint=e}tryUpdateLength(){return this.context.tryUpdateLength()}};function genStepSegments(r,e,i={}){const{direction:n,startPoint:o}=i;if(r.length<2-+!!o)return null;const l=new SegContext("step",n??(abs$1(r[r.length-1].x-r[0].x)>abs$1(r[r.length-1].y-r[0].y)?Direction$1.ROW:Direction$1.COLUMN));return genStepTypeSegments(new Step$1(l,e,o),r),l}function genStepTypeSegments(r,e){return genCurveSegments(r,e,1)}class LinearClosed extends Linear{lineEnd(){this.context.closePath()}}function genLinearClosedSegments(r,e={}){const{direction:i,startPoint:n}=e;if(r.length<2-+!!n)return null;const o=genSegContext("linear",i,r);return genLinearClosedTypeSegments(new LinearClosed(o,n),r),o}function genLinearClosedTypeSegments(r,e){return genCurveSegments(r,e,1)}function point$1(r,e,i,n,o){let l=r._x1,u=r._y1,d=r._x2,f=r._y2;if(r._l01_a>epsilon$1){const g=2*r._l01_2a+3*r._l01_a*r._l12_a+r._l12_2a,_=3*r._l01_a*(r._l01_a+r._l12_a);l=(l*g-r._x0*r._l12_2a+r._x2*r._l01_2a)/_,u=(u*g-r._y0*r._l12_2a+r._y2*r._l01_2a)/_}if(r._l23_a>epsilon$1){const g=2*r._l23_2a+3*r._l23_a*r._l12_a+r._l12_2a,_=3*r._l23_a*(r._l23_a+r._l12_a);d=(d*g+r._x1*r._l23_2a-e*r._l12_2a)/_,f=(f*g+r._y1*r._l23_2a-i*r._l12_2a)/_}r.context.bezierCurveTo(l,u,d,f,r._x2,r._y2,n,r.lastPoint1)}class CatmullRom{constructor(e,i=.5,n){this.context=e,this.startPoint=n,this._alpha=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(e){const{x:i,y:n}=e;if(this._point){const o=this._x2-i,l=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(o*o+l*l,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,n,this._lastDefined1!==!1&&this._lastDefined2!==!1):this.context.moveTo(i,n);break;case 1:this._point=2;break;case 2:this._point=3;default:point$1(this,i,n,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=i,this._y0=this._y1,this._y1=this._y2,this._y2=n,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}function commonGenCatmullRomSegments(r,e){return function(i,n,o={}){const{direction:l,startPoint:u}=o;if(i.length<2-+!!u)return null;if(i.length<3-+!!u)return genLinearSegments(i,o);const d=genSegContext(r,l,i),f=new e(d,n,u);return genCurveSegments(f,i,2),d}}const genCatmullRomSegments=commonGenCatmullRomSegments("catmullRom",CatmullRom);class CatmullRomClosed{constructor(e,i=.5,n){this.context=e,this.startPoint=n,this._alpha=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(e){const{x:i,y:n}=e;if(this._point){const o=this._x2-i,l=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(o*o+l*l,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=i,this._y3=n;break;case 1:this._point=2,this.context.moveTo(this._x4=i,this._y4=n,e);break;case 2:this._point=3,this._x5=i,this._y5=n;break;default:point$1(this,i,n,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=i,this._y0=this._y1,this._y1=this._y2,this._y2=n,this._lastDefined1=this._lastDefined2,this._lastDefined2=e.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=e}tryUpdateLength(){return this.context.tryUpdateLength()}}const genCatmullRomClosedSegments=commonGenCatmullRomSegments("catmullRomClosed",CatmullRomClosed);function calcLineCache(r,e,i){var n,o;switch(e){case"linear":default:return genLinearSegments(r,i);case"basis":return genBasisSegments(r,i);case"monotoneX":return genMonotoneXSegments(r,i);case"monotoneY":return genMonotoneYSegments(r,i);case"step":return genStepSegments(r,.5,i);case"stepBefore":return genStepSegments(r,0,i);case"stepAfter":return genStepSegments(r,1,i);case"catmullRom":return genCatmullRomSegments(r,(n=i==null?void 0:i.curveTension)!==null&&n!==void 0?n:.5,i);case"catmullRomClosed":return genCatmullRomClosedSegments(r,(o=i==null?void 0:i.curveTension)!==null&&o!==void 0?o:.5,i);case"linearClosed":return genLinearClosedSegments(r,i)}}class CustomPath2D extends CurvePath{constructor(e){super(),this.commandList=[],e&&(this._ctx=e),this._boundsContext=new BoundsContext(this.bounds)}setCtx(e){this._ctx=e}moveTo(e,i){return this.commandList.push([enumCommandMap.M,e,i]),this._ctx&&this._ctx.moveTo(e,i),this}lineTo(e,i){return this.commandList.push([enumCommandMap.L,e,i]),this._ctx&&this._ctx.lineTo(e,i),this}quadraticCurveTo(e,i,n,o){return this.commandList.push([enumCommandMap.Q,e,i,n,o]),this._ctx&&this._ctx.quadraticCurveTo(e,i,n,o),this}bezierCurveTo(e,i,n,o,l,u){return this.commandList.push([enumCommandMap.C,e,i,n,o,l,u]),this._ctx&&this._ctx.bezierCurveTo(e,i,n,o,l,u),this}arcTo(e,i,n,o,l){return this.commandList.push([enumCommandMap.AT,e,i,n,o,l]),this._ctx&&this._ctx.arcTo(e,i,n,o,l),this}ellipse(e,i,n,o,l,u,d,f){return this.commandList.push([enumCommandMap.E,e,i,n,o,l,u,d,f]),this._ctx&&this._ctx.ellipse(e,i,n,o,l,u,d,f),this}rect(e,i,n,o){return this.commandList.push([enumCommandMap.R,e,i,n,o]),this._ctx&&this._ctx.rect(e,i,n,o),this}arc(e,i,n,o,l,u){return this.commandList.push([enumCommandMap.A,e,i,n,o,l,u]),this._ctx&&this._ctx.arc(e,i,n,o,l,u),this}closePath(){return this.commandList.push([enumCommandMap.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(e){this.curves.push(e)}clear(){this.transformCbList=null,this.commandList.length=0,this.curves.length=0}beginPath(){this.clear()}toString(){if(!this.toStringCbList){const n=[];n[enumCommandMap.M]=o=>`M${o[1]} ${o[2]}`,n[enumCommandMap.L]=o=>`L${o[1]} ${o[2]}`,n[enumCommandMap.Q]=o=>`Q${o[1]} ${o[2]} ${o[3]} ${o[4]}`,n[enumCommandMap.C]=o=>`C${o[1]} ${o[2]} ${o[3]} ${o[4]} ${o[5]} ${o[6]}`,n[enumCommandMap.A]=o=>{const l=[];addArcToBezierPath$1(l,o[4],o[5],o[1],o[2],o[3],o[3]);let u="";for(let d=0;d<l.length;d+=6)u+=`C${l[d]} ${l[d+1]} ${l[d+2]} ${l[d+3]} ${l[d+4]} ${l[d+5]}`;return u},n[enumCommandMap.R]=o=>`M${o[1]} ${o[2]} h${o[3]} v${o[4]} H${o[1]}Z`,n[enumCommandMap.Z]=o=>"Z",this.toStringCbList=n}const e=this.toStringCbList;let i="";return this.commandList.forEach(n=>{i+=e[n[0]](n)}),i}fromString(e,i,n,o,l){this.clear();const u=parseSvgPath(e);return this._runCommandStrList(u,i,n,o,l),this._updateBounds(),this}fromLine(e){const{points:i,curveType:n,clipRangeByDimension:o}=e.attribute;if(!i)return;const l=calcLineCache(i,n);o==="x"?this.direction=Direction$1.ROW:o==="y"?this.direction=Direction$1.COLUMN:o==="auto"&&(this.direction=l.direction),this.curves=l.curves}fromCustomPath2D(e,i,n,o,l){return this.clear(),this._runCommandList(e.commandList,i,n,o,l),this._updateBounds(),this}transform(e,i,n,o){const l=this.commandList;if(!this.transformCbList){const u=[];u[enumCommandMap.M]=this.moveToTransform,u[enumCommandMap.L]=this.lineToTransform,u[enumCommandMap.Q]=this.quadraticCurveToTransform,u[enumCommandMap.C]=this.bezierCurveToTransform,u[enumCommandMap.AT]=this.arcToTransform,u[enumCommandMap.E]=this.ellipseTransform,u[enumCommandMap.R]=this.rectTransform,u[enumCommandMap.A]=this.arcTransform,u[enumCommandMap.Z]=this.closePathTransform,this.transformCbList=u}l.forEach(u=>{this.transformCbList[u[0]](u,e,i,n,o)}),this._updateBounds()}moveToTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n}lineToTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n}quadraticCurveToTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n,e[3]=e[3]*o+i,e[4]=e[4]*l+n}bezierCurveToTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n,e[3]=e[3]*o+i,e[4]=e[4]*l+n,e[5]=e[5]*o+i,e[6]=e[6]*l+n}arcToTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n,e[3]=e[3]*o+i,e[4]=e[4]*l+n,e[5]=e[5]*(o+l)/2}ellipseTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n,e[3]=e[3]*o,e[4]=e[4]*l}rectTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n,e[3]=e[3]*o,e[4]=e[4]*l}arcTransform(e,i,n,o,l){e[1]=e[1]*o+i,e[2]=e[2]*l+n,e[3]=e[3]*(o+l)/2}closePathTransform(){}_runCommandStrList(e,i=0,n=0,o=1,l=1){let u,d,f,g,_,y=null,b=0,S=0,v=0,A=0;for(let x=0,T=e.length;x<T;++x){switch(u=e[x],o===1&&l===1||(u=scale$1(u,o,l)),u[0]){case"l":b+=u[1],S+=u[2],this.lineTo(b+i,S+n);break;case"L":b=u[1],S=u[2],this.lineTo(b+i,S+n);break;case"h":b+=u[1],this.lineTo(b+i,S+n);break;case"H":b=u[1],this.lineTo(b+i,S+n);break;case"v":S+=u[1],this.lineTo(b+i,S+n);break;case"V":S=u[1],this.lineTo(b+i,S+n);break;case"m":b+=u[1],S+=u[2],this.moveTo(b+i,S+n);break;case"M":b=u[1],S=u[2],this.moveTo(b+i,S+n);break;case"c":d=b+u[5],f=S+u[6],v=b+u[3],A=S+u[4],this.bezierCurveTo(b+u[1]+i,S+u[2]+n,v+i,A+n,d+i,f+n),b=d,S=f;break;case"C":b=u[5],S=u[6],v=u[3],A=u[4],this.bezierCurveTo(u[1]+i,u[2]+n,v+i,A+n,b+i,S+n);break;case"s":d=b+u[3],f=S+u[4],v=2*b-v,A=2*S-A,this.bezierCurveTo(v+i,A+n,b+u[1]+i,S+u[2]+n,d+i,f+n),v=b+u[1],A=S+u[2],b=d,S=f;break;case"S":d=u[3],f=u[4],v=2*b-v,A=2*S-A,this.bezierCurveTo(v+i,A+n,u[1]+i,u[2]+n,d+i,f+n),b=d,S=f,v=u[1],A=u[2];break;case"q":d=b+u[3],f=S+u[4],v=b+u[1],A=S+u[2],this.quadraticCurveTo(v+i,A+n,d+i,f+n),b=d,S=f;break;case"Q":d=u[3],f=u[4],this.quadraticCurveTo(u[1]+i,u[2]+n,d+i,f+n),b=d,S=f,v=u[1],A=u[2];break;case"t":d=b+u[1],f=S+u[2],y[0].match(/[QqTt]/)===null?(v=b,A=S):y[0]==="t"?(v=2*b-g,A=2*S-_):y[0]==="q"&&(v=2*b-v,A=2*S-A),g=v,_=A,this.quadraticCurveTo(v+i,A+n,d+i,f+n),b=d,S=f,v=b+u[1],A=S+u[2];break;case"T":d=u[1],f=u[2],v=2*b-v,A=2*S-A,this.quadraticCurveTo(v+i,A+n,d+i,f+n),b=d,S=f;break;case"a":drawArc(this,b+i,S+n,[u[1],u[2],u[3],u[4],u[5],u[6]+b+i,u[7]+S+n]),b+=u[6],S+=u[7];break;case"A":drawArc(this,b+i,S+n,[u[1],u[2],u[3],u[4],u[5],u[6]+i,u[7]+n]),b=u[6],S=u[7];break;case"z":case"Z":this.closePath()}y=u}}_runCommandList(e,i=0,n=0,o=1,l=1){if(i!==0||n!==0||o!==1||l!==1)for(let u=0,d=e.length;u<d;++u){const f=e[u].slice();switch(f[0]){case enumCommandMap.L:this.lineToTransform(f,i,n,o,l);break;case enumCommandMap.M:this.moveToTransform(f,i,n,o,l);break;case enumCommandMap.C:this.bezierCurveToTransform(f,i,n,o,l);break;case enumCommandMap.Q:this.quadraticCurveToTransform(f,i,n,o,l);break;case enumCommandMap.A:this.arcToTransform(f,i,n,o,l);break;case enumCommandMap.E:this.ellipseTransform(f,i,n,o,l);break;case enumCommandMap.R:this.rectTransform(f,i,n,o,l);break;case enumCommandMap.AT:this.arcToTransform(f,i,n,o,l);break;case enumCommandMap.Z:this.closePath()}}else this.commandList=e.map(u=>u.slice())}_updateBounds(){this.bounds.clear(),renderCommandList(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===Direction$1.COLUMN){if(!this.curves.length)return 0;const e=this.curves[0],i=this.curves[this.curves.length-1];return abs$1(e.p0.y-i.p1.y)}if(this.direction===Direction$1.ROW){if(!this.curves.length)return 0;const e=this.curves[0],i=this.curves[this.curves.length-1];return abs$1(e.p0.x-i.p1.x)}return this.curves.reduce((e,i)=>e+i.getLength(),0)}getAttrAt(e){if(!this.curves)return{pos:{x:0,y:0},angle:0};let i,n=0;for(let l=0;l<this.curves.length;l++){i=this.curves[l];const u=i.getLength(this.direction);if(n+u>=e)break;n+=u}const o=(e-n)/i.getLength(this.direction);return{pos:i.getPointAt(o),angle:i.getAngleAt(o)}}}const temp=["l",0,0,0,0,0,0,0];function scale$1(r,e,i){const n=temp[0]=r[0];if(n==="a"||n==="A")temp[1]=e*r[1],temp[2]=i*r[2],temp[3]=r[3],temp[4]=r[4],temp[5]=r[5],temp[6]=e*r[6],temp[7]=i*r[7];else if(n==="h"||n==="H")temp[1]=e*r[1];else if(n==="v"||n==="V")temp[1]=i*r[1];else for(let o=1,l=r.length;o<l;++o)temp[o]=(o%2==1?e:i)*r[o];return temp}const DefaultLayout={alignSelf:"auto"},DefaultTransform={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Matrix},DefaultFillStyle={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},commonStroke={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},DefaultStrokeStyle=Object.assign({outerBorder:Object.assign(Object.assign({},commonStroke),{distance:0}),innerBorder:Object.assign(Object.assign({},commonStroke),{distance:0})},commonStroke),DefaultTextStyle={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol`,fontWeight:"",ellipsis:"",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:MeasureModeEnum.fontBounding,keepCenterInLine:!1},DefaultPickStyle={pickStrokeBuffer:0},DefaultStyle=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,blur:0,cursor:null,html:null,react:null},DefaultFillStyle),DefaultStrokeStyle),DefaultLayout),DefaultPickStyle),DefaultConnectAttribute={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},DefaultDebugAttribute={_debug_bounds:!1},DefaultAttribute=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1},DefaultDebugAttribute),DefaultStyle),DefaultTransform),DefaultArcAttribute=Object.assign(Object.assign({},DefaultAttribute),{startAngle:0,endAngle:pi2,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),DefaultAreaAttribute=Object.assign(Object.assign(Object.assign({},DefaultAttribute),DefaultConnectAttribute),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),DefaultCircleAttribute=Object.assign(Object.assign({},DefaultAttribute),{radius:1,startAngle:0,endAngle:pi2}),DefaultGroupAttribute=Object.assign(Object.assign({},DefaultAttribute),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1}),DefaultGlyphAttribute=Object.assign(Object.assign({},DefaultAttribute),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),DefaultLineAttribute=Object.assign(Object.assign(Object.assign({},DefaultAttribute),DefaultConnectAttribute),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),DefaultPathAttribute=Object.assign(Object.assign({},DefaultAttribute),{path:new CustomPath2D,fillStrokeOrder:1,customPath:()=>{Logger.getInstance().warn("")}}),DefaultPolygonAttribute=Object.assign(Object.assign({},DefaultAttribute),{points:[],cornerRadius:0,closePath:!0}),DefaultRectAttribute=Object.assign(Object.assign({},DefaultAttribute),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0});Object.assign(Object.assign({},DefaultAttribute),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0});const DefaultSymbolAttribute=Object.assign(Object.assign({},DefaultAttribute),{symbolType:"circle",size:10,keepDirIn3d:!0}),DefaultTextAttribute=Object.assign(Object.assign(Object.assign({},DefaultAttribute),DefaultTextStyle),{strokeBoundsBuffer:0,keepDirIn3d:!0}),DefaultRichTextAttribute=Object.assign(Object.assign(Object.assign({},DefaultAttribute),DefaultTextStyle),{editable:!1,width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),DefaultImageAttribute=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0},DefaultAttribute),{fill:!0,cornerRadius:0}),DefaultRichTextIconAttribute=Object.assign(Object.assign({},DefaultImageAttribute),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});class Application{}const application=new Application,parse=function(){const r={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i};let e="";function i(P){const L=new Error(e+": "+P);throw L.source=e,L}function n(){const P=S(o);return e.length>0&&i("Invalid input not EOF"),P}function o(){return l("linear",r.linearGradient,u)||l("radial",r.radialGradient,f)||l("conic",r.conicGradient,d)}function l(P,L,R){return function(w,D){const I=C(w);if(I){C(r.startCall)||i("Missing (");const O=D(I);return C(r.endCall)||i("Missing )"),O}}(L,function(w){const D=R();return D&&(C(r.comma)||i("Missing comma before color stops")),{type:P,orientation:D,colorStops:S(v)}})}function u(){return T("directional",r.sideOrCorner,1)||T("angular",r.angleValue,1)}function d(){return T("angular",r.fromAngleValue,1)}function f(){let P,L,R=g();return R&&(P=[],P.push(R),L=e,C(r.comma)&&(R=g(),R?P.push(R):e=L)),P}function g(){let P=function(){const L=T("shape",/^(circle)/i,0);return L&&(L.style=x()||_()),L}()||function(){const L=T("shape",/^(ellipse)/i,0);return L&&(L.style=A()||_()),L}();if(P)P.at=y();else{const L=_();if(L){P=L;const R=y();R&&(P.at=R)}else{const R=b();R&&(P={type:"default-radial",at:R})}}return P}function _(){return T("extent-keyword",r.extentKeywords,1)}function y(){if(T("position",/^at/,0)){const P=b();return P||i("Missing positioning value"),P}}function b(){const P={x:A(),y:A()};if(P.x||P.y)return{type:"position",value:P}}function S(P){let L=P();const R=[];if(L)for(R.push(L);C(r.comma);)L=P(),L?R.push(L):i("One extra comma");return R}function v(){const P=T("hex",r.hexColor,1)||T("rgba",r.rgbaColor,1)||T("rgb",r.rgbColor,1)||T("literal",r.literalColor,0);return P||i("Expected color definition"),P.length=A(),P}function A(){return T("%",r.percentageValue,1)||T("position-keyword",r.positionKeywords,1)||x()}function x(){return T("px",r.pixelValue,1)||T("em",r.emValue,1)}function T(P,L,R){const w=C(L);if(w)return{type:P,value:w[R]}}function C(P){const L=/^[\n\r\t\s]+/.exec(e);L&&E(L[0].length);const R=P.exec(e);return R&&E(R[0].length),R}function E(P){e=e.substr(P)}return function(P){return e=P.toString(),n()}}();class GradientParser{static IsGradient(e){return!(typeof e=="string"&&!e.includes("gradient"))}static IsGradientStr(e){return typeof e=="string"&&e.includes("gradient")}static Parse(e){if(GradientParser.IsGradientStr(e))try{const i=parse(e)[0];if(i){if(i.type==="linear")return GradientParser.ParseLinear(i);if(i.type==="radial")return GradientParser.ParseRadial(i);if(i.type==="conic")return GradientParser.ParseConic(i)}}catch{return e}return e}static ParseConic(e){const{orientation:i,colorStops:n=[]}=e,o=pi$1/2,l=parseFloat(i.value)/180*pi$1-o;return{gradient:"conical",x:.5,y:.5,startAngle:l,endAngle:l+pi2,stops:n.map(u=>({color:u.value,offset:parseFloat(u.length.value)/100}))}}static ParseRadial(e){const{colorStops:i=[]}=e;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:i.map(n=>({color:n.value,offset:parseFloat(n.length.value)/100}))}}static ParseLinear(e){const{orientation:i,colorStops:n=[]}=e,o=pi$1/2;let l=i.type==="angular"?parseFloat(i.value)/180*pi$1:0;for(;l<0;)l+=pi2;for(;l>=pi2;)l-=pi2;let u=0,d=0,f=0,g=0;return l<o?(u=0,d=1,f=Math.sin(l),g=d-Math.cos(l)):l<pi$1?(u=0,d=0,f=Math.cos(l-o),g=Math.sin(l-o)):l<pi$1+o?(u=1,d=0,f=u-Math.sin(l-pi$1),g=Math.cos(l-pi$1)):(u=1,f=u-Math.cos(l-o-pi$1),g-=Math.sin(l-o-pi$1)),{gradient:"linear",x0:u,y0:d,x1:f,y1:g,stops:n.map(_=>({color:_.value,offset:parseFloat(_.length.value)/100}))}}}function getScaledStroke(r,e,i){let n=e;const{a:o,b:l,c:u,d}=r.currentMatrix,f=Math.sign(o)*Math.sqrt(o*o+l*l),g=Math.sign(d)*Math.sqrt(u*u+d*d);return f+g===0?0:(n=n/Math.abs(f+g)*2*i,n)}function createColor(r,e,i,n=0,o=0){if(!e||e===!0)return"black";let l,u;if(isArray(e))for(let d=0;d<e.length&&(u=e[d],!u);d++);else u=e;if(u=GradientParser.Parse(u),typeof u=="string")return u;if(i.AABBBounds&&(!i.attribute||i.attribute.scaleX!==0||i.attribute.scaleY!==0)){const d=i.AABBBounds;let f=d.x2-d.x1,g=d.y2-d.y1,_=d.x1-n,y=d.y1-o;if(i.attribute){const{scaleX:b=1,scaleY:S=1}=i.attribute;f/=b,g/=S,_/=b,y/=S}u.gradient==="linear"?l=createLinearGradient(r,u,_,y,f,g):u.gradient==="conical"?l=createConicGradient(r,u,_,y,f,g):u.gradient==="radial"&&(l=createRadialGradient(r,u,_,y,f,g))}return l||"orange"}function createLinearGradient(r,e,i,n,o,l){var u,d,f,g;const _=r.createLinearGradient(i+((u=e.x0)!==null&&u!==void 0?u:0)*o,n+((d=e.y0)!==null&&d!==void 0?d:0)*l,i+((f=e.x1)!==null&&f!==void 0?f:1)*o,n+((g=e.y1)!==null&&g!==void 0?g:0)*l);return e.stops.forEach(y=>{_.addColorStop(y.offset,y.color)}),_}function createRadialGradient(r,e,i,n,o,l){var u,d,f,g,_,y;const b=r.createRadialGradient(i+((u=e.x0)!==null&&u!==void 0?u:.5)*o,n+((d=e.y0)!==null&&d!==void 0?d:.5)*l,Math.max(o,l)*((f=e.r0)!==null&&f!==void 0?f:0),i+((g=e.x1)!==null&&g!==void 0?g:.5)*o,n+((_=e.y1)!==null&&_!==void 0?_:.5)*l,Math.max(o,l)*((y=e.r1)!==null&&y!==void 0?y:.5));return e.stops.forEach(S=>{b.addColorStop(S.offset,S.color)}),b}function createConicGradient(r,e,i,n,o,l){var u,d;const f=r.createConicGradient(i+((u=e.x)!==null&&u!==void 0?u:0)*o,n+((d=e.y)!==null&&d!==void 0?d:0)*l,e.startAngle,e.endAngle);return e.stops.forEach(g=>{f.addColorStop(g.offset,g.color)}),f.GetPattern(o+i,l+n,void 0)}const DIRECTION_KEY={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},defaultFormatting={fill:!0,stroke:!1},regLetter=/\w|\(|\)|-/,regPunctuation=/[.?!,;:/]/,regFirstSpace=/\S/,setTextStyle=(r,e)=>{let i=e.fontSize||16;switch(e.script){case"super":case"sub":i*=.8}r.setTextStyle({textAlign:"left",textBaseline:e.textBaseline||"alphabetic",fontStyle:e.fontStyle||"",fontWeight:e.fontWeight||"",fontSize:i,fontFamily:e.fontFamily})};function applyFillStyle(r,e,i){const n=e&&e.fill||defaultFormatting.fill,{fillOpacity:o=1,opacity:l=1}=e;r.globalAlpha=o*l,r.fillStyle=i?createColor(r,n,{AABBBounds:i}):n,setTextStyle(r,e)}function applyStrokeStyle(r,e){const i=e&&e.stroke||defaultFormatting.stroke;if(!i)return void(r.globalAlpha=0);const{strokeOpacity:n=1,opacity:o=1}=e;r.globalAlpha=n*o,r.lineWidth=e&&typeof e.lineWidth=="number"?e.lineWidth:1,r.strokeStyle=i,setTextStyle(r,e)}function getStrByWithCanvas(r,e,i,n,o){if(!e||e<=0)return 0;const l=application.graphicUtil.textMeasure;let u=n,d=r.slice(0,u),f=Math.floor(l.measureText(d,i).width),g=r.slice(0,u+1),_=Math.floor(l.measureText(g,i).width);for(;f>e||_<=e;){if(f>e?u--:u++,u>r.length){u=r.length;break}if(u<0){u=0;break}d=r.slice(0,u),f=Math.floor(l.measureText(d,i).width),g=r.slice(0,u+1),_=Math.floor(l.measureText(g,i).width)}return o&&(u=testLetter(r,u)),u}function testLetter(r,e,i=!1){let n=e;for(;regLetter.test(r[n-1])&&regLetter.test(r[n])||regPunctuation.test(r[n]);)if(n--,n<=0)return i?testLetter2(r,e):e;return n}function testLetter2(r,e){let i=e;for(;regLetter.test(r[i-1])&&regLetter.test(r[i])||regPunctuation.test(r[i]);)if(i++,i>=r.length)return i;return i}function measureTextCanvas(r,e){const i=application.graphicUtil.textMeasure.measureText(r,e),n={ascent:0,height:0,descent:0,width:0};return typeof i.actualBoundingBoxAscent!="number"||typeof i.actualBoundingBoxDescent!="number"?(n.width=Math.floor(i.width),n.height=e.fontSize||0,n.ascent=n.height,n.descent=0):(n.width=Math.floor(i.width),n.height=Math.floor(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent),n.ascent=Math.floor(i.actualBoundingBoxAscent),n.descent=n.height-n.ascent),n}var __decorate$1a=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let ATextMeasure=class{configure(r,e){this.canvas=r.canvas,this.context=r.context,r.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(r,e,i){this.context.setTextStyleWithoutAlignBaseline(e);const n=this.context.measureText(r);return i?this.compatibleMetrics(n,e):n}_measureTextWithAlignBaseline(r,e,i){this.context.setTextStyle(e);const n=this.context.measureText(r);return i?this.compatibleMetrics(n,e):n}compatibleMetrics(r,e){if(r.actualBoundingBoxAscent==null||r.actualBoundingBoxDescent==null||r.fontBoundingBoxAscent==null||r.fontBoundingBoxDescent==null){const{ascent:i,descent:n}=this.measureTextBoundADscentEstimate(e);r.actualBoundingBoxAscent=i,r.actualBoundingBoxDescent=n,r.fontBoundingBoxAscent=i,r.fontBoundingBoxDescent=n}if(r.actualBoundingBoxLeft==null||r.actualBoundingBoxRight==null){const{left:i,right:n}=this.measureTextBoundLeftRightEstimate(e);r.actualBoundingBoxLeft=i,r.actualBoundingBoxRight=n}return r}estimate(r,{fontSize:e=DefaultTextAttribute.fontSize}){let i=0,n=0;for(let o=0;o<r.length;o++)r.charCodeAt(o)<128?i++:n++;return{width:~~(.8*i*e+n*e),height:e}}measureTextWidth(r,e,i){return this.context?(i=i??this._measureTextWithoutAlignBaseline(r,e)).width:this.estimate(r,e).width}measureTextBoundsWidth(r,e,i){return this.context?(i=i??this._measureTextWithoutAlignBaseline(r,e)).width:this.estimate(r,e).width}measureTextBoundsLeftRight(r,e,i){return this.context?{left:(i=i??this._measureTextWithAlignBaseline(r,e,!0)).actualBoundingBoxLeft,right:i.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(e)}measureTextPixelHeight(r,e,i){var n;return this.context?(i=i??this._measureTextWithoutAlignBaseline(r,e,!0),Math.abs(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)):(n=e.fontSize)!==null&&n!==void 0?n:DefaultTextStyle.fontSize}measureTextPixelADscent(r,e,i){return this.context?{ascent:(i=i??this._measureTextWithAlignBaseline(r,e,!0)).actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundHieght(r,e,i){var n;return this.context?(i=i??this._measureTextWithoutAlignBaseline(r,e,!0),Math.abs(i.fontBoundingBoxAscent-i.fontBoundingBoxDescent)):(n=e.fontSize)!==null&&n!==void 0?n:DefaultTextStyle.fontSize}measureTextBoundADscent(r,e,i){return this.context?{ascent:(i=i??this._measureTextWithAlignBaseline(r,e,!0)).fontBoundingBoxAscent,descent:i.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundADscentEstimate(r){var e;const i=(e=r.fontSize)!==null&&e!==void 0?e:DefaultTextStyle.fontSize;return{ascent:.79*i,descent:.21*i}}measureTextBoundLeftRightEstimate(r){var e;const i=(e=r.fontSize)!==null&&e!==void 0?e:DefaultTextStyle.fontSize,{textAlign:n}=r;return n==="center"?{left:i/2,right:i/2}:n==="right"||n==="end"?{left:i,right:0}:{left:0,right:i}}measureTextPixelADscentAndWidth(r,e,i){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:this.estimate(r,e).width});const n=this._measureTextWithoutAlignBaseline(r,e,!0);if(i===MeasureModeEnum.actualBounding)return{ascent:n.actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent,width:n.width};if(i===MeasureModeEnum.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:n.width});if(i===MeasureModeEnum.fontBounding){let o=n.fontBoundingBoxAscent,l=n.fontBoundingBoxDescent;if(n.actualBoundingBoxDescent&&l<n.actualBoundingBoxDescent){const u=n.actualBoundingBoxDescent-l;l+=u,o-=u}else if(n.actualBoundingBoxAscent&&o<n.actualBoundingBoxAscent){const u=n.actualBoundingBoxAscent-o;o+=u,l-=u}return{ascent:o,descent:l,width:n.width}}return{ascent:n.actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent,width:n.width}}measureText(r,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(r)):this.estimate(r,e)}clipTextVertical(r,e,i,n){if(r.length===0)return{verticalList:r,width:0};const{fontSize:o=12}=e;r.forEach(f=>{f.width=f.direction===0?o:this.measureTextWidth(f.text,e)});const l=[];let u=0,d=0;for(;d<r.length&&u+r[d].width<i;d++)u+=r[d].width,l.push(r[d]);if(r[d]&&r[d].text.length>1){const f=this._clipText(r[d].text,e,i-u,0,r[d].text.length-1,"end",!1);if(n&&f.str!==r[d].text){let g="",_=0;for(let S=0;S<d;S++){const v=r[S];g+=v.text,_+=v.text.length}g+=r[d].text;const y=_+f.str.length;let b=testLetter(g,y);b-=_,b!==f.str.length-1&&(f.str=f.str.substring(0,b),f.width=this.measureTextWidth(f.str,e))}l.push(Object.assign(Object.assign({},r[d]),{text:f.str,width:f.width})),u+=f.width}return{verticalList:l,width:u}}clipText(r,e,i,n,o){if(r.length===0)return{str:"",width:0};let l=this.measureTextWidth(r,e);if(l<=i)return{str:r,width:l};if(l=this.measureTextWidth(r[0],e),l>i)return{str:"",width:0};const u=this._clipText(r,e,i,0,r.length-1,"end",!1);if(n&&u.str!==r){let d=testLetter(r,u.str.length,o);d!==u.str.length&&(d>u.str.length&&(u.wordBreaked=d,d=u.str.length),u.str=r.substring(0,d),u.width=this.measureTextWidth(u.str,e))}return u}_clipText(r,e,i,n,o,l,u){let d;if(l==="start")d=this._clipTextStart(r,e,i,n,o),u&&(d.result=u+d.str);else if(l==="middle"){const f=this._clipTextMiddle(r,e,i,"","",0,0,1);d={str:"none",width:f.width,result:f.left+u+f.right}}else d=this._clipTextEnd(r,e,i,n,o),u&&(d.result=d.str+u);return d}_clipTextEnd(r,e,i,n,o){if(n===o){Logger.getInstance().warn(`_clipTextEnd${r}, ${n}, ${o}`);const g=r.substring(0,o+1);return{str:g,width:this.measureTextWidth(g,e)}}const l=Math.floor((n+o)/2),u=r.substring(0,l+1),d=this.measureTextWidth(u,e);let f;if(d>i){if(u.length<=1)return{str:"",width:0};const g=r.substring(0,l);return f=this.measureTextWidth(g,e),f<=i?{str:g,width:f}:this._clipTextEnd(r,e,i,n,l)}if(d<i){if(l>=r.length-1)return{str:r,width:this.measureTextWidth(r,e)};const g=r.substring(0,l+2);return f=this.measureTextWidth(g,e),f>=i?{str:u,width:d}:this._clipTextEnd(r,e,i,l,o)}return{str:u,width:d}}_clipTextStart(r,e,i,n,o){const l=Math.ceil((n+o)/2),u=r.substring(l-1,r.length),d=this.measureTextWidth(u,e);let f;if(d>i){if(u.length<=1)return{str:"",width:0};const g=r.substring(l,r.length);return f=this.measureTextWidth(g,e),f<=i?{str:g,width:f}:this._clipTextStart(r,e,i,l,r.length)}if(d<i){if(l<=0)return{str:r,width:this.measureTextWidth(r,e)};const g=r.substring(l-2,r.length);return f=this.measureTextWidth(g,e),f>=i?{str:u,width:d}:this._clipTextStart(r,e,i,n,l)}return{str:u,width:d}}_clipTextMiddle(r,e,i,n,o,l,u,d){const f=r.substring(0,d),g=this.measureTextWidth(f,e);if(g+u>i)return{left:n,right:o,width:l+u};const _=r.substring(r.length-d,r.length),y=this.measureTextWidth(_,e);return g+y>i?{left:f,right:o,width:g+u}:this._clipTextMiddle(r,e,i,f,_,g,y,d+1)}clipTextWithSuffixVertical(r,e,i,n,o,l){if(n==="")return this.clipTextVertical(r,e,i,o);if(r.length===0)return{verticalList:r,width:0};const u=this.clipTextVertical(r,e,i,o);if(u.verticalList.length===r.length&&u.verticalList[u.verticalList.length-1].width===r[r.length-1].width)return u;const d=this.measureTextWidth(n,e);if(d>i)return u;let f;if(i-=d,l==="start"){const g=this.revertVerticalList(r);f=this.clipTextVertical(g,e,i,o);const _=this.revertVerticalList(f.verticalList);_.unshift({text:n,direction:1,width:d}),f.verticalList=_}else if(l==="middle"){const g=this.clipTextVertical(r,e,i/2,o),_=this.revertVerticalList(r),y=this.clipTextVertical(_,e,i/2,o);g.verticalList.push({text:n,direction:1,width:d}),this.revertVerticalList(y.verticalList).forEach(b=>g.verticalList.push(b)),f={verticalList:g.verticalList,width:g.width+y.width}}else f=this.clipTextVertical(r,e,i,o),f.verticalList.push({text:n,direction:1,width:d});return f.width+=d,f}revertVerticalList(r){return r.reverse().map(e=>{const i=e.text.split("").reverse().join("");return Object.assign(Object.assign({},e),{text:i})})}clipTextWithSuffix(r,e,i,n,o,l,u=!1){if(n==="")return this.clipText(r,e,i,o);if(r.length===0)return{str:"",width:0};const d=this.measureTextWidth(r,e);if(!u&&d<=i)return{str:r,width:d};const f=this.measureTextWidth(n,e);if(f>i)return{str:"",width:0};if(u&&d+f<=i)return{str:r+n,width:d+f};i-=f;const g=this._clipText(r,e,i,0,r.length-1,l,n);if(o&&g.str!==r){const _=testLetter(r,g.str.length);_!==g.str.length&&(g.result=r.substring(0,_),g.width=this.measureTextWidth(g.str,e))}else u&&g.str===r&&(g.result=r+n);return g.str=g.result,g.width+=f,g}};ATextMeasure=__decorate$1a([injectable()],ATextMeasure);var __decorate$19=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};const TextMeasureContribution=Symbol.for("TextMeasureContribution");let DefaultTextMeasureContribution=class extends ATextMeasure{};DefaultTextMeasureContribution=__decorate$19([injectable()],DefaultTextMeasureContribution);const container=new Container,CanvasFactory=Symbol.for("CanvasFactory"),Context2dFactory=Symbol.for("Context2dFactory");function wrapCanvas(r){return container.getNamed(CanvasFactory,application.global.env)(r)}class DefaultCanvasAllocate{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(e){if(!this.pools.length){const n=wrapCanvas(Object.assign({nativeCanvas:application.global.createCanvas(e)},e));return this.allocatedCanvas.push(n),n}const i=this.pools.pop();return i.resize(e.width,e.height),i.dpr=e.dpr,i}allocateByObj(e){if(!this.pools.length){const n={width:e.width/e.dpr,height:e.height/e.dpr,dpr:e.dpr},o=wrapCanvas(Object.assign({nativeCanvas:application.global.createCanvas(n)},n));return this.allocatedCanvas.push(o),o}const i=this.pools.pop();return i.width=e.width,i.height=e.height,i}free(e){this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}const canvasAllocate=new DefaultCanvasAllocate;var __decorate$18=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$S=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};const VWindow=Symbol.for("VWindow"),WindowHandlerContribution=Symbol.for("WindowHandlerContribution");let DefaultWindow=class{get width(){if(this._handler){const r=this._handler.getWH();return this._width=r.width}return this._width}get height(){if(this._handler){const r=this._handler.getWH();return this._height=r.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new SyncHook(["x","y","width","height"])},this.active=()=>{const r=this.global;!r.env||this.actived||(container.getNamed(WindowHandlerContribution,r.env).configure(this,r),this.actived=!0)},this._uid=Generator.GenAutoIncrementId(),this.global=application.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var r;return(r=this._handler.getStyle())!==null&&r!==void 0?r:{}}set style(r){this._handler.setStyle(r)}create(r){var e,i;this._handler.createWindow(r);const n=this._handler.getWH();this._width=n.width,this._height=n.height,r.viewBox?this.setViewBox(r.viewBox):r.canvasControled!==!1?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:(e=r.width)!==null&&e!==void 0?e:this._width,y2:(i=r.height)!==null&&i!==void 0?i:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(r){this._handler=r}setDpr(r){return this._handler.setDpr(r)}resize(r,e){return this._handler.resizeWindow(r,e)}configure(){throw new Error("")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(r){return this._handler.getImageBuffer?this._handler.getImageBuffer(r):null}addEventListener(r,e,i){return this._handler.addEventListener(r,e,i)}removeEventListener(r,e,i){return this._handler.removeEventListener(r,e,i)}dispatchEvent(r){return this._handler.dispatchEvent(r)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(r){this._handler.clearViewBox(r)}setViewBox(r){this._handler.setViewBox(r)}setViewBoxTransform(r,e,i,n,o,l){this._handler.setViewBoxTransform(r,e,i,n,o,l)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(r,e){const i=this._handler.getViewBox(),n={x:r,y:e};return this._handler.getViewBoxTransform().transformPoint({x:r,y:e},n),n.x-=i.x1,n.y-=i.y1,n}hasSubView(){const r=this._handler.getViewBox();return!(r.x1===0&&r.y1===0&&isNumberClose(this.width,r.width())&&isNumberClose(this.height,r.height()))}isVisible(r){return this._handler.isVisible(r)}onVisibleChange(r){return this._handler.onVisibleChange(r)}getTopLeft(r){return this._handler.getTopLeft(r)}};DefaultWindow=__decorate$18([injectable(),__metadata$S("design:paramtypes",[])],DefaultWindow);var __decorate$17=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$R=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$G=function(r,e){return function(i,n){e(i,n,r)}};let DefaultGraphicUtil=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(r){this.contributions=r,this.configured=!1,this.global=application.global,this.global.hooks.onSetEnv.tap("graphic-util",(e,i,n)=>{this.configured=!1,this.configure(n,i)})}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(r,e){this.configured||(this.contributions.getContributions().forEach(i=>{i.configure(this,e)}),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const r=canvasAllocate.shareCanvas();this._canvas=r,this._context=r.getContext("2d")}}bindTextMeasure(r){this._textMeasure=r}measureText(r,e,i="native"){var n;this.configure(this.global,this.global.env);const o=this.global.measureTextMethod;this.global.measureTextMethod=i;const l={width:this._textMeasure.measureTextWidth(r,e),height:(n=e.fontSize)!==null&&n!==void 0?n:DefaultTextStyle.fontSize};return this.global.measureTextMethod=o,l}createTextMeasureInstance(r,e,i){return this.configure(this.global,this.global.env),new TextMeasure(Object.assign({defaultFontParams:{fontFamily:DefaultTextStyle.fontFamily,fontSize:DefaultTextStyle.fontSize},getCanvasForMeasure:i||(()=>this.canvas),getTextBounds:void 0,specialCharSet:`-/: .,@%'"~`+TextMeasure.ALPHABET_CHAR_SET+TextMeasure.ALPHABET_CHAR_SET.toUpperCase()},e??{}),r)}drawGraphicToCanvas(r,e,i){if(!e.defaultLayer)return null;const n=container.get(VWindow),o=r.AABBBounds,l=o.width(),u=o.height(),d=-o.x1,f=-o.y1;n.create({viewBox:{x1:d,y1:f,x2:o.x2,y2:o.y2},width:l,height:u,canvas:i,dpr:e.window.dpr,canvasControled:!0,offscreen:!0,title:""});const g=e.params.optimize.disableCheckGraphicWidthOutRange;e.params.optimize.disableCheckGraphicWidthOutRange=!0,e.defaultLayer.getNativeHandler().drawTo(n,[r],{transMatrix:n.getViewBoxTransform(),viewBox:n.getViewBox(),stage:e,layer:e.defaultLayer,renderService:e.renderService,background:"transparent",clear:!0,updateBounds:!1}),e.params.optimize.disableCheckGraphicWidthOutRange=g;const _=n.getNativeHandler();return _.nativeCanvas?_.nativeCanvas:null}};DefaultGraphicUtil=__decorate$17([injectable(),__param$G(0,inject(ContributionProvider)),__param$G(0,named(TextMeasureContribution)),__metadata$R("design:paramtypes",[Object])],DefaultGraphicUtil);var TransformMode;(function(r){r[r.transform=0]="transform",r[r.matrix=1]="matrix"})(TransformMode||(TransformMode={}));const _matrix=new Matrix;let DefaultTransformUtil=class{constructor(){this.matrix=new Matrix}init(r){return this.mode=TransformMode.transform,this.originTransform=r,this.matrix.reset(),this}fromMatrix(r,e){return this.mode=TransformMode.matrix,this.outSourceMatrix=r,this.outTargetMatrix=e,this}scaleMatrix(r,e,i){const n=this.outSourceMatrix;if(_matrix.setValue(n.a,n.b,n.c,n.d,n.e,n.f),this.outTargetMatrix.reset(),i){const{x:o,y:l}=i;this.outTargetMatrix.translate(o,l),this.outTargetMatrix.scale(r,e),this.outTargetMatrix.translate(-o,-l)}else this.outTargetMatrix.scale(r,e);return this.outTargetMatrix.multiply(_matrix.a,_matrix.b,_matrix.c,_matrix.d,_matrix.e,_matrix.f),this}rotateMatrix(r,e){const i=this.outSourceMatrix;if(_matrix.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:n,y:o}=e;this.outTargetMatrix.translate(n,o),this.outTargetMatrix.rotate(r),this.outTargetMatrix.translate(-n,-o)}else this.outTargetMatrix.rotate(r);return this.outTargetMatrix.multiply(_matrix.a,_matrix.b,_matrix.c,_matrix.d,_matrix.e,_matrix.f),this}scale(r,e,i){return this.mode===TransformMode.matrix?this.scaleMatrix(r,e,i):this}rotate(r,e){return this.mode===TransformMode.matrix?this.rotateMatrix(r,e):this}translateMatrix(r,e){const i=this.outSourceMatrix;return _matrix.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(r,e),this.outTargetMatrix.multiply(_matrix.a,_matrix.b,_matrix.c,_matrix.d,_matrix.e,_matrix.f),this}translate(r,e){return this.mode===TransformMode.matrix?this.translateMatrix(r,e):this}simplify(r){return this.mode===TransformMode.matrix?this.simplifyMatrix(r):this}simplifyMatrix(r){return this}};DefaultTransformUtil=__decorate$17([injectable(),__metadata$R("design:paramtypes",[])],DefaultTransformUtil);const defaultThemeObj={arc:DefaultArcAttribute,area:DefaultAreaAttribute,circle:DefaultCircleAttribute,line:DefaultLineAttribute,path:DefaultPathAttribute,symbol:DefaultSymbolAttribute,text:DefaultTextAttribute,rect:DefaultRectAttribute,polygon:DefaultPolygonAttribute,richtext:DefaultRichTextAttribute,richtextIcon:DefaultRichTextIconAttribute,image:DefaultImageAttribute,group:DefaultGroupAttribute,glyph:DefaultGlyphAttribute},themeKeys=Object.keys(defaultThemeObj);function newThemeObj(){return{arc:Object.assign({},defaultThemeObj.arc),area:Object.assign({},defaultThemeObj.area),circle:Object.assign({},defaultThemeObj.circle),line:Object.assign({},defaultThemeObj.line),path:Object.assign({},defaultThemeObj.path),symbol:Object.assign({},defaultThemeObj.symbol),text:Object.assign({},defaultThemeObj.text),rect:Object.assign({},defaultThemeObj.rect),polygon:Object.assign({},defaultThemeObj.polygon),richtext:Object.assign({},defaultThemeObj.richtext),richtextIcon:Object.assign({},defaultThemeObj.richtextIcon),image:Object.assign({},defaultThemeObj.image),group:Object.assign({},defaultThemeObj.group),glyph:Object.assign({},defaultThemeObj.glyph)}}function combine(r,e){Object.keys(e).forEach(i=>{r[i]=e[i]})}const globalThemeObj=newThemeObj();class Theme{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},themeKeys.forEach(e=>{this._defaultTheme[e]=Object.create(globalThemeObj[e])}),this.combinedTheme=this._defaultTheme}getTheme(e){if(!e)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let i={};const n=this.getParentWithTheme(e);return n&&(i=n.theme),this.applyTheme(e,i),this.combinedTheme}getParentWithTheme(e){for(;e.parent;)if((e=e.parent).theme)return e;return null}applyTheme(e,i,n=!1){if(this.dirty){const o=this.getParentWithTheme(e);if(o){const l=o.theme;(l.dirty||n)&&l.applyTheme(o,i,!0)}this.userTheme?this.doCombine(o&&o.theme.combinedTheme):(o?this.combinedTheme=o.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,Logger.getInstance().warn("")),this.dirty=!1)}return this.combinedTheme}doCombine(e){const i=this.userTheme,n=this.combinedTheme;themeKeys.forEach(o=>{const l=Object.create(globalThemeObj[o]);e&&e[o]&&combine(l,e[o]),n[o]&&combine(l,n[o]),i[o]&&combine(l,i[o]),this.combinedTheme[o]=l}),i.common&&themeKeys.forEach(o=>{combine(this.combinedTheme[o],i.common)}),this.dirty=!1}setTheme(e,i){let n=this.userTheme;n?Object.keys(e).forEach(o=>{n[o]?Object.assign(n[o],e[o]):n[o]=Object.assign({},e[o])}):n=e,this.userTheme=n,this.dirty=!0,this.dirtyChildren(i)}resetTheme(e,i){this.userTheme=e,this.dirty=!0,this.dirtyChildren(i)}dirtyChildren(e){e.forEachChildren(i=>{i.isContainer&&(i.theme&&(i.theme.dirty=!0),this.dirtyChildren(i))})}}const globalTheme=new Theme;function getTheme$1(r,e){return r.glyphHost?getTheme$1(r.glyphHost):e?(r.isContainer,e):getThemeFromGroup(r)||r.attachedThemeGraphic&&getTheme$1(r.attachedThemeGraphic)||globalTheme.getTheme()}function getThemeFromGroup(r){let e;if(e=r.isContainer?r:r.parent,e){for(;e&&!e.theme;)e=e.parent;return e?(e.theme||e.createTheme(),e.theme.getTheme(e)):globalTheme.getTheme()}return null}var __awaiter$8=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};class Node extends EventEmitter{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=Generator.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(e,i=!1){if(i){let n=this._lastChild,o=0;for(;n;){if(e(n,o++))return;n=n._prev}}else{let n=this._firstChild,o=0;for(;n;){if(e(n,o++))return;n=n._next}}}forEachChildrenAsync(e,i=!1){return __awaiter$8(this,void 0,void 0,function*(){if(i){let n=this._lastChild,o=0;for(;n;){let l=e(n,o++);if(l.then&&(l=yield l),l)return;n=n._prev}}else{let n=this._firstChild,o=0;for(;n;){let l=e(n,o++);if(l.then&&(l=yield l),l)return;n=n._next}}})}forEach(e){return this.forEachChildren(e)}appendChild(e,i=!0){if(this._uid===e._uid)return null;if(!i&&e.isAncestorsOf(this))throw new Error("Node::appendChildappend");return e.parent&&e.parent.removeChild(e),e.parent=this,this._lastChild?(this._lastChild._next=e,e._prev=this._lastChild,this._lastChild=e):(this._firstChild=this._lastChild=e,e._prev=e._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this.setCount(e.count),this._structEdit=!0,e}appendChildArrHighPerformance(e,i=!1){return console.error(""),e}insertBefore(e,i){if(!i)return this.appendChild(e);if(this===e||e===i)return null;if(e.isAncestorsOf(this))throw new Error("Node::insertBeforeinsert");return i.parent!==this?null:(e.parent&&e.parent.removeChild(e),e.parent=this,e._prev=i._prev,i._prev?i._prev._next=e:this._firstChild=e,i._prev=e,e._next=i,this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e)}insertAfter(e,i){if(!i)return this.appendChild(e);if(this===e||e===i)return null;if(e.isAncestorsOf(this))throw new Error("Node::insertAfterinsert");return i.parent!==this?null:(e.parent&&e.parent.removeChild(e),e.parent=this,i._next?(i._next._prev=e,e._next=i._next):this._lastChild=e,i._next=e,e._prev=i,this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e)}insertInto(e,i){if(!this._ignoreWarn&&this._nodeList&&Logger.getInstance().warn("insertIntoKeepIdxinsertInto"),i>=this.childrenCount)return this.appendChild(e);if(this===e)return null;if(e.isAncestorsOf(this))throw new Error("Node::insertBeforeinsert");if(e.parent&&e.parent.removeChild(e),e.parent=this,i===0)e._next=this._firstChild,this._firstChild&&(this._firstChild._prev=e),e._prev=null,this._firstChild=e;else{let n=this._firstChild;for(let o=0;o<i;o++){if(!n)return null;o>0&&(n=n._next)}if(!n)return null;e._next=n._next,e._prev=n,n._next=e,e._next&&(e._next._prev=e)}return this._idMap||(this._idMap=new Map),this._idMap.set(e._uid,e),this._structEdit=!0,this.setCount(e.count),e}insertIntoKeepIdx(e,i){if(this._nodeList||(this._nodeList=this.children),this._nodeList[i]){const l=this._nodeList[i];return this._nodeList.splice(i,0,e),this.insertBefore(e,l)}let n;this._nodeList[i]=e;for(let l=i-1;l>=0&&(n=this._nodeList[l],!n);l--);if(n)return n._next?this.insertBefore(e,n._next):this.appendChild(e);this._ignoreWarn=!0;const o=this.insertInto(e,0);return this._ignoreWarn=!1,o}removeChild(e){if(!this._idMap||!this._idMap.has(e._uid))return null;if(this._idMap.delete(e._uid),this._nodeList){const i=this._nodeList.findIndex(n=>n===e);i>=0&&this._nodeList.splice(i,1)}return e._prev?e._prev._next=e._next:this._firstChild=e._next,e._next?e._next._prev=e._prev:this._lastChild=e._prev,e.parent=null,e._prev=null,e._next=null,this._structEdit=!0,this.setCount(-e.count),e}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(e){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let i=this._firstChild;for(;i;){const n=i._next;i.parent=null,i._prev=null,i._next=null,i=i._next,i=n}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(e,i){throw new Error("")}find(e,i=!1){let n=null;return this.forEachChildren((o,l)=>!(o===this||!e(o,l))&&(n=o,!0)),i&&this.forEachChildren(o=>{if(o.isContainer){const l=o.find(e,!0);if(l)return n=l,!0}return!1}),n}findAll(e,i=!1){let n=[];return this.forEachChildren((o,l)=>{o!==this&&e(o,l)&&n.push(o)}),i&&this.forEachChildren(o=>{if(o.isContainer){const l=o.findAll(e,!0);l.length&&(n=n.concat(l))}}),n}getElementById(e){return this.find(i=>i.id===e,!0)}findChildById(e){return this.getElementById(e)}findChildByUid(e){return this._idMap&&this._idMap.get(e)||null}getElementsByName(e){return this.findAll(i=>i.name===e,!0)}findChildrenByName(e){return this.getElementsByName(e)}getElementsByType(e){return this.findAll(i=>i.type===e,!0)}getChildByName(e,i=!1){return this.find(n=>n.name===e,i)}getChildAt(e){let i=this._firstChild;if(!i)return null;for(let n=0;n<e;n++){if(!i._next)return null;i=i._next}return i}at(e){return this.getChildAt(e)}containNode(e){if(!this._idMap)return!1;if(this._idMap.has(e._uid))return!0;let i=this._firstChild;for(;i;){if(i.containNode(e))return!0;i=i._next}return!1}getRootNode(){let e=this.parent;for(;e!=null&&e.parent;)e=e.parent;return e||this}hasChildNodes(){return this._firstChild!==null}addChild(e){return this.appendChild(e)}add(e){return this.appendChild(e)}getChildren(){const e=[];let i=this._firstChild;for(;i;)e.push(i),i=i._next;return e}isChildOf(e){return!!this.parent&&this.parent._uid===e._uid}isParentOf(e){return e.isChildOf(this)}isDescendantsOf(e){let i=this.parent;if(!i)return!1;do{if(i._uid===e._uid)return!0;i=i.parent}while(i!==null);return!1}isAncestorsOf(e){return e.isDescendantsOf(this)}getAncestor(e){throw new Error("")}setAllDescendantsProps(e,i){let n=this._firstChild;for(;n;)n[e]=i,n.setAllDescendantsProps(e,i),n=n._next}setCount(e){this._count+=e;let i=this.parent;if(i)do i._count+=e,i=i.parent;while(i!==null)}clone(){throw new Error("")}cloneTo(e){throw new Error("")}getParent(){return this.parent}del(e){return this.removeChild(e)}addEventListener(e,i,n){const o=isBoolean(n,!0)&&n||isObject$1(n)&&n.capture,l=isObject$1(n)&&n.once,u=isFunction(i)?void 0:i;return e=o?`${e}capture`:e,i=isFunction(i)?i:i.handleEvent,l?super.once(e,i,u):super.on(e,i,u),this}on(e,i,n){return this.addEventListener(e,i,n)}removeEventListener(e,i,n){const o=isBoolean(n,!0)&&n||isObject$1(n)&&n.capture,l=isFunction(i)?void 0:i;e=o?`${e}capture`:e,i=isFunction(i)?i:i.handleEvent;const u=isObject$1(n)&&n.once;return super.off(e,i,l,u),this}off(e,i,n){return this.removeEventListener(e,i,n)}once(e,i,n){return isObject$1(n)?(n.once=!0,this.addEventListener(e,i,n)):this.addEventListener(e,i,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(e,...i){return super.emit(e.type,e,...i),!e.defaultPrevented}emit(e,i){return this.dispatchEvent(e,i)}release(){this.removeAllListeners()}}class FederatedEvent{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=FederatedEvent.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(e){if(e&&e.graphic){const i=this.pickParams.graphic;if(i.stage){const n=i.stage.eventSystem.manager.propagationPath(i);this.detailPath.push(n),this._composedDetailPath(e.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&isFunction(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&isFunction(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class FederatedMouseEvent extends FederatedEvent{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,i,n,o,l,u,d,f,g,_,y,b,S,v,A){throw new Error("Method not implemented.")}}class FederatedPointerEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var e,i,n;const o=new FederatedPointerEvent(this.manager);o.eventPhase=o.NONE,o.currentTarget=null,o.path=[],o.detailPath=[],o.target=null,o.nativeEvent=this.nativeEvent,o.originalEvent=this.originalEvent,(e=this.manager)===null||e===void 0||e.copyPointerData(this,o),(i=this.manager)===null||i===void 0||i.copyMouseData(this,o),(n=this.manager)===null||n===void 0||n.copyData(this,o),o.target=this.target,o.path=this.composedPath().slice();const l=this.composedDetailPath();return o.detailPath=l&&l.slice(),o.type=this.type,o}}class FederatedWheelEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var e,i,n;const o=new FederatedWheelEvent(this.manager);o.eventPhase=o.NONE,o.currentTarget=null,o.path=[],o.detailPath=[],o.target=null,o.nativeEvent=this.nativeEvent,o.originalEvent=this.originalEvent,(e=this.manager)===null||e===void 0||e.copyWheelData(this,o),(i=this.manager)===null||i===void 0||i.copyMouseData(this,o),(n=this.manager)===null||n===void 0||n.copyData(this,o),o.target=this.target,o.path=this.composedPath().slice();const l=this.composedDetailPath();return o.detailPath=l&&l.slice(),o.type=this.type,o}}FederatedWheelEvent.DOM_DELTA_PIXEL=0,FederatedWheelEvent.DOM_DELTA_LINE=1,FederatedWheelEvent.DOM_DELTA_PAGE=2;class CustomEvent extends FederatedEvent{constructor(e,i){super(),this.type=e,this.detail=i}}const WILDCARD="*",clock=typeof performance=="object"&&performance.now?performance:Date;function isMouseLike(r){return r==="mouse"||r==="pen"}class EventManager{constructor(e,i){this.dispatch=new EventEmitter,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(n,o)=>{if(!(n instanceof FederatedPointerEvent))return void Logger.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const l=this.createPointerEvent(n,n.type,o);if(this.dispatchEvent(l,"pointerdown"),l.pointerType==="touch")this.dispatchEvent(l,"touchstart");else if(isMouseLike(l.pointerType)){const u=l.button===2;this.dispatchEvent(l,u?"rightdown":"mousedown")}this.trackingData(n.pointerId).pressTargetsByButton[n.button]=l.composedPath(),this.freeEvent(l)},this.onPointerMove=(n,o)=>{var l,u;if(!(n instanceof FederatedPointerEvent))return void Logger.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const d=this.createPointerEvent(n,n.type,o),f=isMouseLike(d.pointerType),g=this.trackingData(n.pointerId),_=this.findMountedTarget(g.overTargets);if(g.overTargets&&_&&_!==this.rootTarget&&_!==d.target){const y=n.type==="mousemove"?"mouseout":"pointerout",b=this.createPointerEvent(n,y,_||void 0);if(this.dispatchEvent(b,"pointerout"),f&&this.dispatchEvent(b,"mouseout"),!d.composedPath().includes(_)){const S=this.createPointerEvent(n,"pointerleave",_||void 0);for(S.eventPhase=S.AT_TARGET;S.target&&!d.composedPath().includes(S.target);)S.currentTarget=S.target,this.notifyTarget(S),f&&this.notifyTarget(S,"mouseleave"),S.target=S.target.parent;this.freeEvent(S)}this.freeEvent(b)}if(_!==d.target){const y=n.type==="mousemove"?"mouseover":"pointerover",b=this.clonePointerEvent(d,y);this.dispatchEvent(b,"pointerover"),f&&this.dispatchEvent(b,"mouseover");let S=_==null?void 0:_.parent;for(;S&&S!==this.rootTarget.parent&&S!==d.target;)S=S.parent;if(!S||S===this.rootTarget.parent){const v=this.clonePointerEvent(d,"pointerenter");v.eventPhase=v.AT_TARGET;let A=v.target;const x=new Set;let T=_;for(;T&&T!==this.rootTarget;)x.add(T),T=T.parent;for(;A&&A!==_&&A!==this.rootTarget.parent;)x.has(A)||(v.currentTarget=A,this.notifyTarget(v),f&&this.notifyTarget(v,"mouseenter")),A=A.parent;this.freeEvent(v)}this.freeEvent(b)}this.dispatchEvent(d,"pointermove"),d.pointerType==="touch"&&this.dispatchEvent(d,"touchmove"),f&&(this.dispatchEvent(d,"mousemove"),this.cursorTarget=d.target,this.cursor=((u=(l=d.target)===null||l===void 0?void 0:l.attribute)===null||u===void 0?void 0:u.cursor)||this.rootTarget.getCursor()),g.overTargets=d.composedPath(),this.freeEvent(d)},this.onPointerOver=(n,o)=>{var l,u;if(!(n instanceof FederatedPointerEvent))return void Logger.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const d=this.trackingData(n.pointerId),f=this.createPointerEvent(n,n.type,o),g=isMouseLike(f.pointerType);this.dispatchEvent(f,"pointerover"),g&&this.dispatchEvent(f,"mouseover"),f.pointerType==="mouse"&&(this.cursorTarget=f.target,this.cursor=((u=(l=f.target)===null||l===void 0?void 0:l.attribute)===null||u===void 0?void 0:u.cursor)||this.rootTarget.getCursor());const _=this.clonePointerEvent(f,"pointerenter");for(_.eventPhase=_.AT_TARGET;_.target&&_.target!==this.rootTarget.parent;)_.currentTarget=_.target,this.notifyTarget(_),g&&this.notifyTarget(_,"mouseenter"),_.target=_.target.parent;d.overTargets=f.composedPath(),this.freeEvent(f),this.freeEvent(_)},this.onPointerOut=(n,o)=>{if(!(n instanceof FederatedPointerEvent))return void Logger.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const l=this.trackingData(n.pointerId);if(l.overTargets){const u=isMouseLike(n.pointerType),d=this.findMountedTarget(l.overTargets),f=this.createPointerEvent(n,"pointerout",d||void 0);this.dispatchEvent(f),u&&this.dispatchEvent(f,"mouseout");const g=this.createPointerEvent(n,"pointerleave",d||void 0);for(g.eventPhase=g.AT_TARGET;g.target&&g.target!==this.rootTarget.parent;)g.currentTarget=g.target,this.notifyTarget(g),u&&this.notifyTarget(g,"mouseleave"),g.target=g.target.parent;l.overTargets=[],this.freeEvent(f),this.freeEvent(g)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(n,o)=>{var l;if(!(n instanceof FederatedPointerEvent))return void Logger.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const u=clock.now(),d=this.createPointerEvent(n,n.type,o);if(this.dispatchEvent(d,"pointerup"),d.pointerType==="touch")this.dispatchEvent(d,"touchend");else if(isMouseLike(d.pointerType)){const y=d.button===2;this.dispatchEvent(d,y?"rightup":"mouseup")}const f=this.trackingData(n.pointerId),g=this.findMountedTarget(f.pressTargetsByButton[n.button]);let _=g;if(g&&!d.composedPath().includes(g)){let y=g;for(;y&&!d.composedPath().includes(y);){if(d.currentTarget=y,this.notifyTarget(d,"pointerupoutside"),d.pointerType==="touch")this.notifyTarget(d,"touchendoutside");else if(isMouseLike(d.pointerType)){const b=d.button===2;this.notifyTarget(d,b?"rightupoutside":"mouseupoutside")}y=y.parent}delete f.pressTargetsByButton[n.button],_=y}if(_){const y=this.clonePointerEvent(d,"click");y.target=_,y.path=[],y.detailPath=[],f.clicksByButton[n.button]||(f.clicksByButton[n.button]={clickCount:0,target:y.target,timeStamp:u});const b=f.clicksByButton[n.button];b.target===y.target&&u-b.timeStamp<((l=this._config.clickInterval)!==null&&l!==void 0?l:200)?++b.clickCount:b.clickCount=1,b.target=y.target,b.timeStamp=u,y.detail=b.clickCount,isMouseLike(y.pointerType)?(this.dispatchEvent(y,"click"),b.clickCount===2&&this.dispatchEvent(y,"dblclick")):y.pointerType==="touch"&&this._config.supportsTouchEvents&&(this.dispatchEvent(y,"tap"),b.clickCount===2&&this.dispatchEvent(y,"dbltap")),this.dispatchEvent(y,"pointertap"),this.freeEvent(y)}this.freeEvent(d)},this.onPointerUpOutside=(n,o)=>{if(!(n instanceof FederatedPointerEvent))return void Logger.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const l=this.trackingData(n.pointerId),u=this.findMountedTarget(l.pressTargetsByButton[n.button]),d=this.createPointerEvent(n,n.type,o);if(u){let f=u;for(;f;)d.currentTarget=f,this.notifyTarget(d,"pointerupoutside"),d.pointerType==="touch"?this.notifyTarget(d,"touchendoutside"):isMouseLike(d.pointerType)&&this.notifyTarget(d,d.button===2?"rightupoutside":"mouseupoutside"),f=f.parent;delete l.pressTargetsByButton[n.button]}this.freeEvent(d)},this.onWheel=(n,o)=>{if(!(n instanceof FederatedWheelEvent))return void Logger.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const l=this.createWheelEvent(n,o);this.dispatchEvent(l),this.freeEvent(l)},this.rootTarget=e,this.mappingTable={},this._config=Object.assign({clickInterval:200},i),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(e,i){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:i,priority:0}),this.mappingTable[e].sort((n,o)=>n.priority-o.priority)}dispatchEvent(e,i){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,i),this.dispatch.emit(i||e.type,e)}mapEvent(e){var i,n,o,l,u,d,f;if(!this.rootTarget)return;const g=this.mappingTable[e.type];let _;const y=`${e.canvasX}-${e.canvasY}`;if(!((i=this._prePointTargetCache)===null||i===void 0)&&i[y]&&(!((o=(n=this._prePointTargetCache)===null||n===void 0?void 0:n[y])===null||o===void 0)&&o.stage)&&((u=(l=this._prePointTargetCache)===null||l===void 0?void 0:l[y])===null||u===void 0?void 0:u.stage.renderCount)===((d=this._prePointTargetCache)===null||d===void 0?void 0:d.stageRenderCount)?_=this._prePointTargetCache[y]:(_=this.pickTarget(e.viewX,e.viewY,e),e.pickParams||(this._prePointTargetCache={[y]:_,stageRenderCount:(f=_==null?void 0:_.stage.renderCount)!==null&&f!==void 0?f:-1})),g)for(let b=0,S=g.length;b<S;b++)g[b].fn(e,_);else Logger.getInstance().warn(`[EventManager]: Event mapping not defined for ${e.type}`)}propagate(e,i){if(!e.target)return;const n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let o=0,l=n.length-1;o<l;o++)if(e.currentTarget=n[o],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,i),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let o=n.length-2;o>=0;o--)if(e.currentTarget=n[o],this.notifyTarget(e,i),e.propagationStopped||e.propagationImmediatelyStopped)return}}propagationPath(e){const i=[e];for(let n=0;n<2048&&e!==this.rootTarget&&e.parent;n++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");i.push(e.parent),e=e.parent}return i.reverse(),i}notifyTarget(e,i){if(this.pauseNotify)return;i=i??e.type;const n=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${i}capture`:i;this.notifyListeners(e,n),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,i)}findMountedTarget(e){if(!e)return null;let i=e[0];for(let n=1;n<e.length&&e[n].parent===i;n++)i=e[n];return i}createPointerEvent(e,i,n){var o,l;const u=this.allocateEvent(FederatedPointerEvent);return this.copyPointerData(e,u),this.copyMouseData(e,u),this.copyData(e,u),u.nativeEvent=e.nativeEvent,u.originalEvent=e,u.target=n||this.pickTarget((o=u.viewX)!==null&&o!==void 0?o:u.global.x,(l=u.viewY)!==null&&l!==void 0?l:u.global.y,u),typeof i=="string"&&(u.type=i),u}createWheelEvent(e,i){var n,o;const l=this.allocateEvent(FederatedWheelEvent);return this.copyWheelData(e,l),this.copyMouseData(e,l),this.copyData(e,l),l.nativeEvent=e.nativeEvent,l.originalEvent=e,l.target=i||this.pickTarget((n=l.viewX)!==null&&n!==void 0?n:l.global.x,(o=l.viewY)!==null&&o!==void 0?o:l.global.y,l),l}clonePointerEvent(e,i){const n=this.allocateEvent(FederatedPointerEvent);n.nativeEvent=e.nativeEvent,n.originalEvent=e.originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice();const o=e.composedDetailPath();return n.detailPath=o&&o.slice(),n.type=i??n.type,n}copyWheelData(e,i){i.deltaMode=e.deltaMode,i.deltaX=e.deltaX,i.deltaY=e.deltaY,i.deltaZ=e.deltaZ}copyPointerData(e,i){e instanceof FederatedPointerEvent&&i instanceof FederatedPointerEvent&&(i.pointerId=e.pointerId,i.width=e.width,i.height=e.height,i.isPrimary=e.isPrimary,i.pointerType=e.pointerType,i.pressure=e.pressure,i.tangentialPressure=e.tangentialPressure,i.tiltX=e.tiltX,i.tiltY=e.tiltY,i.twist=e.twist)}copyMouseData(e,i){e instanceof FederatedMouseEvent&&i instanceof FederatedMouseEvent&&(i.altKey=e.altKey,i.button=e.button,i.buttons=e.buttons,i.ctrlKey=e.ctrlKey,i.shiftKey=e.shiftKey,i.metaKey=e.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach(n=>{i[n].x=e[n].x,i[n].y=e[n].y}))}copyData(e,i){i.isTrusted=e.isTrusted,i.srcElement=e.srcElement,i.timeStamp=clock.now(),i.type=e.type,i.detail=e.detail,i.view=e.view,i.which=e.which,i.layer.x=e.layer.x,i.layer.y=e.layer.y,i.page.x=e.page.x,i.page.y=e.page.y,i.pickParams=e.pickParams}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){var i;this.eventPool.has(e)||this.eventPool.set(e,[]);const n=((i=this.eventPool.get(e))===null||i===void 0?void 0:i.pop())||new e(this);return n.eventPhase=n.NONE,n.currentTarget=null,n.path=[],n.detailPath=[],n.target=null,n}freeEvent(e){var i;if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const n=e.constructor;this.eventPool.has(n)||this.eventPool.set(n,[]),(i=this.eventPool.get(n))===null||i===void 0||i.push(e)}notifyListeners(e,i){const n=e.currentTarget._events[i];if(n)if("fn"in n)n.once&&e.currentTarget.removeEventListener(i,n.fn,{once:!0}),n.fn.call(n.context,e);else for(let o=0,l=n.length;o<l&&!e.propagationImmediatelyStopped;o++)n[o].once&&e.currentTarget.removeEventListener(i,n[o].fn,{once:!0}),n[o].fn.call(n[o].context,e);this.emitDelegation(e,i)}emitDelegation(e,i){const n=e.currentTarget._events[WILDCARD];if(n)if("fn"in n)n.fn.call(n.context,e,i);else for(let o=0,l=n.length;o<l&&!e.propagationImmediatelyStopped;o++)n[o].fn.call(n[o].context,e,i)}pickTarget(e,i,n){let o;const l=this.rootTarget.pick(e,i);return o=l&&l.graphic?l.graphic:l&&l.group?l.group:this.rootTarget.AABBBounds.contains(e,i)?this.rootTarget:null,n&&(n.pickParams=l.params),o}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}const EventTarget={dispatchEvent(r){var e;if(!(r instanceof FederatedEvent))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=[],r.detailPath&&(r.detailPath=[]),r.target=this,(e=r==null?void 0:r.manager)===null||e===void 0||e.dispatchEvent(r),!r.defaultPrevented},emit(r,e){return this.dispatchEvent(new CustomEvent(r,e))}},TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class EventSystem{constructor(e){this.resolution=1,this.onPointerDown=_=>{if(this.supportsTouchEvents&&_.pointerType==="touch")return;const y=this.normalizeToPointerData(_);this.autoPreventDefault&&y[0].isNormalized&&(_.cancelable||!("cancelable"in _))&&_.preventDefault();for(let b=0,S=y.length;b<S;b++){const v=y[b],A=this.bootstrapEvent(this.rootPointerEvent,v);this.manager.mapEvent(A)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=_=>{if(this.supportsTouchEvents&&_.pointerType==="touch"||this.isEventOutsideOfTargetElement(_))return;const y=this.normalizeToPointerData(_);for(let b=0,S=y.length;b<S;b++){const v=this.bootstrapEvent(this.rootPointerEvent,y[b]);this.manager.mapEvent(v)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=_=>{if(this.supportsTouchEvents&&_.pointerType==="touch")return;const y=this.isEventOutsideOfTargetViewPort(_)?"outside":"",b=this.normalizeToPointerData(_);for(let S=0,v=b.length;S<v;S++){const A=this.bootstrapEvent(this.rootPointerEvent,b[S]);A.type+=y,this.manager.mapEvent(A)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=_=>{if(this.supportsTouchEvents&&_.pointerType==="touch")return;const y=this.normalizeToPointerData(_);for(let b=0,S=y.length;b<S;b++){const v=this.bootstrapEvent(this.rootPointerEvent,y[b]);this.manager.mapEvent(v)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=_=>{const y=this.normalizeWheelEvent(_);this.manager.mapEvent(y)};const{targetElement:i,resolution:n,rootNode:o,global:l,autoPreventDefault:u=!1,clickInterval:d,supportsTouchEvents:f=l.supportsTouchEvents,supportsPointerEvents:g=l.supportsPointerEvents}=e;this.manager=new EventManager(o,{clickInterval:d,supportsTouchEvents:f}),this.globalObj=l,this.supportsPointerEvents=g,this.supportsTouchEvents=f,this.supportsMouseEvents=l.supportsMouseEvents,this.applyStyles=l.applyStyles,this.autoPreventDefault=u,this.eventsAdded=!1,this.rootPointerEvent=new FederatedPointerEvent,this.rootWheelEvent=new FederatedWheelEvent,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=n,this.setTargetElement(i)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(e,i){if(!i&&!this.manager.rootTarget.window._handler.canvas.controled)return;e||(e="default");const{applyStyles:n,domElement:o}=this;if(this.currentCursor===e)return;this.currentCursor=e;const l=this.cursorStyles[e];l?typeof l=="string"&&n?o.style.cursor=l:typeof l=="function"?l(e):typeof l=="object"&&n&&Object.assign(o.style,l):n&&isString(e)&&!has(this.cursorStyles,e)&&(o.style.cursor=e)}setTargetElement(e){this.removeEvents(),this.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:e,domElement:i}=this;this.supportsPointerEvents?(e.getDocument()?(e.getDocument().addEventListener("pointermove",this.onPointerMove,!0),e.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(i.addEventListener("pointermove",this.onPointerMove,!0),i.addEventListener("pointerup",this.onPointerUp,!0)),i.addEventListener("pointerdown",this.onPointerDown,!0),i.addEventListener("pointerleave",this.onPointerOverOut,!0),i.addEventListener("pointerover",this.onPointerOverOut,!0)):(e.getDocument()?(e.getDocument().addEventListener("mousemove",this.onPointerMove,!0),e.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(i.addEventListener("mousemove",this.onPointerMove,!0),i.addEventListener("mouseup",this.onPointerUp,!0)),i.addEventListener("mousedown",this.onPointerDown,!0),i.addEventListener("mouseout",this.onPointerOverOut,!0),i.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(i.addEventListener("touchstart",this.onPointerDown,!0),i.addEventListener("touchend",this.onPointerUp,!0),i.addEventListener("touchmove",this.onPointerMove,!0)),i.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:e,domElement:i}=this;this.supportsPointerEvents?(e.getDocument()?(e.getDocument().removeEventListener("pointermove",this.onPointerMove,!0),e.getDocument().removeEventListener("pointerup",this.onPointerUp,!0)):(i.removeEventListener("pointermove",this.onPointerMove,!0),i.removeEventListener("pointerup",this.onPointerUp,!0)),i.removeEventListener("pointerdown",this.onPointerDown,!0),i.removeEventListener("pointerleave",this.onPointerOverOut,!0),i.removeEventListener("pointerover",this.onPointerOverOut,!0)):(e.getDocument()?(e.getDocument().removeEventListener("mousemove",this.onPointerMove,!0),e.getDocument().removeEventListener("mouseup",this.onPointerUp,!0)):(i.removeEventListener("mousemove",this.onPointerMove,!0),i.removeEventListener("mouseup",this.onPointerUp,!0)),i.removeEventListener("mousedown",this.onPointerDown,!0),i.removeEventListener("mouseout",this.onPointerOverOut,!0),i.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(i.removeEventListener("touchstart",this.onPointerDown,!0),i.removeEventListener("touchend",this.onPointerUp,!0),i.removeEventListener("touchmove",this.onPointerMove,!0)),i.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(e){return this.domElement.pointTransform?this.domElement.pointTransform(e.x,e.y):e}mapToCanvasPoint(e){var i,n;const o=(i=this.globalObj)===null||i===void 0?void 0:i.mapToCanvasPoint(e,this.domElement);if(o)return o;let l=0,u=0;if(e.changedTouches){const f=(n=e.changedTouches[0])!==null&&n!==void 0?n:{};l=f.clientX||0,u=f.clientY||0}else l=e.clientX||0,u=e.clientY||0;const d=this.domElement.getBoundingClientRect();return{x:l-d.left,y:u-d.top}}normalizeToPointerData(e){const i=[];if(this.supportsTouchEvents&&e.changedTouches&&e.changedTouches.length)for(let n=0,o=e.changedTouches.length;n<o;n++){const l=e.changedTouches[n];isUndefined(l.button)&&(l.button=0),isUndefined(l.buttons)&&(l.buttons=1),isUndefined(l.isPrimary)&&(l.isPrimary=e.touches.length===1&&e.type==="touchstart"),isUndefined(l.width)&&(l.width=l.radiusX||1),isUndefined(l.height)&&(l.height=l.radiusY||1),isUndefined(l.tiltX)&&(l.tiltX=0),isUndefined(l.tiltY)&&(l.tiltY=0),isUndefined(l.pointerType)&&(l.pointerType="touch"),isUndefined(l.pointerId)&&(l.pointerId=l.identifier||0),isUndefined(l.pressure)&&(l.pressure=l.force||.5),isUndefined(l.twist)&&(l.twist=0),isUndefined(l.tangentialPressure)&&(l.tangentialPressure=0),isUndefined(l.layerX)&&(l.layerX=l.offsetX=l.clientX),isUndefined(l.layerY)&&(l.layerY=l.offsetY=l.clientY),l.isNormalized=!0,l.type=e.type,i.push(l)}else if(this.globalObj.supportsMouseEvents&&(!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof PointerEvent))i.push(e);else{const n=e;isUndefined(n.isPrimary)&&(n.isPrimary=!0),isUndefined(n.width)&&(n.width=1),isUndefined(n.height)&&(n.height=1),isUndefined(n.tiltX)&&(n.tiltX=0),isUndefined(n.tiltY)&&(n.tiltY=0),isUndefined(n.pointerType)&&(n.pointerType="mouse"),isUndefined(n.pointerId)&&(n.pointerId=1),isUndefined(n.pressure)&&(n.pressure=.5),isUndefined(n.twist)&&(n.twist=0),isUndefined(n.tangentialPressure)&&(n.tangentialPressure=0),n.isNormalized=!0,i.push(n)}return i}normalizeWheelEvent(e){const i=this.rootWheelEvent;this.transferMouseData(i,e),i.deltaMode=e.deltaMode,i.deltaX=e.deltaX,i.deltaY=e.deltaY,i.deltaZ=e.deltaZ;const{x:n,y:o}=this.mapToCanvasPoint(e);i.canvas.x=n,i.canvas.y=o,i.global.x=n,i.global.y=o,i.offset.x=n,i.offset.y=o;const{x:l,y:u}=this.mapToViewportPoint(i);return i.viewport.x=l,i.viewport.y=u,i.nativeEvent=e,i.type=e.type,i}bootstrapEvent(e,i){e.originalEvent=null,e.nativeEvent=i,e.pointerId=i.pointerId,e.width=i.width,e.height=i.height,e.isPrimary=i.isPrimary,e.pointerType=i.pointerType,e.pressure=i.pressure,e.tangentialPressure=i.tangentialPressure,e.tiltX=i.tiltX,e.tiltY=i.tiltY,e.twist=i.twist,this.transferMouseData(e,i);const{x:n,y:o}=this.mapToCanvasPoint(i);e.canvas.x=n,e.canvas.y=o,e.global.x=n,e.global.y=o,e.offset.x=n,e.offset.y=o;const{x:l,y:u}=this.mapToViewportPoint(e);return e.viewport.x=l,e.viewport.y=u,e.isTrusted=i.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=TOUCH_TO_POINTER[e.type]||e.type),e}transferMouseData(e,i){e.isTrusted=i.isTrusted,e.srcElement=i.srcElement,e.timeStamp=clock.now(),e.type=i.type,e.altKey=i.altKey,e.button=i.button,e.buttons=i.buttons,e.client.x=i.clientX,e.client.y=i.clientY,e.ctrlKey=i.ctrlKey,e.shiftKey=i.shiftKey,e.metaKey=i.metaKey,e.movement.x=i.movementX,e.movement.y=i.movementY,e.page.x=i.pageX,e.page.y=i.pageY,e.relatedTarget=null}isEventOutsideOfTargetViewPort(e){if(this.isEventOutsideOfTargetElement(e))return!0;if(this.domElement.getViewBox){const i=this.mapToViewportPoint(this.mapToCanvasPoint(e)),n=this.domElement.getViewBox(),o=n.width(),l=n.height();return!(i.x<o&&i.y<l&&i.x>0&&i.y>0)}return!1}isEventOutsideOfTargetElement(e){let i=e.target;return e.composedPath&&e.composedPath().length>0&&(i=e.composedPath()[0]),i!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}var STATUS$1;(function(r){r[r.INITIAL=0]="INITIAL",r[r.RUNNING=1]="RUNNING",r[r.PAUSE=2]="PAUSE"})(STATUS$1||(STATUS$1={}));class RAFTickHandler{static Avaliable(){return!!application.global.getRequestAnimationFrame()}avaliable(){return RAFTickHandler.Avaliable()}tick(e,i){application.global.getRequestAnimationFrame()(()=>{this.released||i(this)})}release(){this.released=!0}getTime(){return Date.now()}}class TimeOutTickHandler{static Avaliable(){return!0}avaliable(){return TimeOutTickHandler.Avaliable()}tick(e,i){this.timerId=setTimeout(()=>{i(this)},e)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class DefaultTicker extends EventEmitter{set mode(e){this._mode!==e&&(this._mode=e,this.setupTickHandler())}get mode(){return this._mode}constructor(e=[]){super(),this.handleTick=(i,n)=>{const{once:o=!1}=n??{};this.ifCanStop()?this.stop():(this._handlerTick(),o||i.tick(this.interval,this.handleTick))},this._handlerTick=()=>{const i=this.tickerHandler.getTime();let n=0;this.lastFrameTime>=0&&(n=i-this.lastFrameTime),this.lastFrameTime=i,this.status===STATUS$1.RUNNING&&(this.tickCounts++,this.timelines.forEach(o=>{o.tick(n)}),this.emit("afterTick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=e,this.autoStop=!0}init(){this.interval=NaN,this.status=STATUS$1.INITIAL,application.global.hooks.onSetEnv.tap("default-ticker",()=>{this.initHandler()}),application.global.env&&this.initHandler()}addTimeline(e){this.timelines.push(e)}remTimeline(e){this.timelines=this.timelines.filter(i=>i!==e)}initHandler(){if(this._mode)return null;const e=[{mode:"raf",cons:RAFTickHandler},{mode:"timeout",cons:TimeOutTickHandler}];for(let i=0;i<e.length;i++)if(e[i].cons.Avaliable()){this.mode=e[i].mode;break}return null}setupTickHandler(){let e;switch(this._mode){case"raf":e=new RAFTickHandler;break;case"timeout":e=new TimeOutTickHandler;break;default:Logger.getInstance().warn(""),e=new RAFTickHandler}return!!e.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=e,!0)}setInterval(e){this.interval=e}getInterval(){return this.interval}setFPS(e){this.setInterval(1e3/e)}getFPS(){return 1e3/this.interval}tick(e){this.tickerHandler.tick(e,i=>{this.handleTick(i,{once:!0})})}tickTo(e){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(e,i=>{this.handleTick(i,{once:!0})})}pause(){return this.status!==STATUS$1.INITIAL&&(this.status=STATUS$1.PAUSE,!0)}resume(){return this.status!==STATUS$1.INITIAL&&(this.status=STATUS$1.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce((e,i)=>e+i.animateCount,0)===0))}start(e=!1){return this.status===STATUS$1.RUNNING||!this.tickerHandler||!e&&(this.status===STATUS$1.PAUSE||!this.timelines.length||this.timelines.reduce((i,n)=>i+n.animateCount,0)===0)?!1:(this.status=STATUS$1.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=STATUS$1.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}trySyncTickStatus(){this.status===STATUS$1.RUNNING&&this._handlerTick()}}class Easing{constructor(){}static linear(e){return e}static none(){return this.linear}static get(e){return e<-1?e=-1:e>1&&(e=1),function(i){return e===0?i:e<0?i*(i*-e+1+e):i*((2-i)*e+(1-e))}}static getPowIn(e){return function(i){return Math.pow(i,e)}}static getPowOut(e){return function(i){return 1-Math.pow(1-i,e)}}static getPowInOut(e){return function(i){return(i*=2)<1?.5*Math.pow(i,e):1-.5*Math.abs(Math.pow(2-i,e))}}static getBackIn(e){return function(i){return i*i*((e+1)*i-e)}}static getBackOut(e){return function(i){return--i*i*((e+1)*i+e)+1}}static getBackInOut(e){return e*=1.525,function(i){return(i*=2)<1?i*i*((e+1)*i-e)*.5:.5*((i-=2)*i*((e+1)*i+e)+2)}}static sineIn(e){return 1-Math.cos(e*Math.PI/2)}static sineOut(e){return Math.sin(e*Math.PI/2)}static sineInOut(e){return-(Math.cos(Math.PI*e)-1)/2}static expoIn(e){return e===0?0:Math.pow(2,10*e-10)}static expoOut(e){return e===1?1:1-Math.pow(2,-10*e)}static expoInOut(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}static circIn(e){return-(Math.sqrt(1-e*e)-1)}static circOut(e){return Math.sqrt(1- --e*e)}static circInOut(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}static bounceOut(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}static bounceIn(e){return 1-Easing.bounceOut(1-e)}static bounceInOut(e){return e<.5?.5*Easing.bounceIn(2*e):.5*Easing.bounceOut(2*e-1)+.5}static getElasticIn(e,i){return function(n){if(n===0||n===1)return n;const o=i/pi2*Math.asin(1/e);return-e*Math.pow(2,10*(n-=1))*Math.sin((n-o)*pi2/i)}}static getElasticOut(e,i){return function(n){if(n===0||n===1)return n;const o=i/pi2*Math.asin(1/e);return e*Math.pow(2,-10*n)*Math.sin((n-o)*pi2/i)+1}}static getElasticInOut(e,i){return function(n){const o=i/pi2*Math.asin(1/e);return(n*=2)<1?e*Math.pow(2,10*(n-=1))*Math.sin((n-o)*pi2/i)*-.5:e*Math.pow(2,-10*(n-=1))*Math.sin((n-o)*pi2/i)*.5+1}}}Easing.quadIn=Easing.getPowIn(2),Easing.quadOut=Easing.getPowOut(2),Easing.quadInOut=Easing.getPowInOut(2),Easing.cubicIn=Easing.getPowIn(3),Easing.cubicOut=Easing.getPowOut(3),Easing.cubicInOut=Easing.getPowInOut(3),Easing.quartIn=Easing.getPowIn(4),Easing.quartOut=Easing.getPowOut(4),Easing.quartInOut=Easing.getPowInOut(4),Easing.quintIn=Easing.getPowIn(5),Easing.quintOut=Easing.getPowOut(5),Easing.quintInOut=Easing.getPowInOut(5),Easing.backIn=Easing.getBackIn(1.7),Easing.backOut=Easing.getBackOut(1.7),Easing.backInOut=Easing.getBackInOut(1.7),Easing.elasticIn=Easing.getElasticIn(1,.3),Easing.elasticOut=Easing.getElasticOut(1,.3),Easing.elasticInOut=Easing.getElasticInOut(1,.3*1.5);class DefaultTimeline{constructor(){this.id=Generator.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(e){this.animateTail?(this.animateTail.nextAnimate=e,e.prevAnimate=this.animateTail,this.animateTail=e,e.nextAnimate=null):(this.animateHead=e,this.animateTail=e),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(e){if(this.paused)return;let i=this.animateHead;for(this.animateCount=0;i;)i.status===AnimateStatus.END?this.removeAnimate(i):i.status===AnimateStatus.RUNNING||i.status===AnimateStatus.INITIAL?(this.animateCount++,i.advance(e)):i.status===AnimateStatus.PAUSED&&this.animateCount++,i=i.nextAnimate}clear(){let e=this.animateHead;for(;e;)e.release(),e=e.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(e,i=!0){e._onRemove&&e._onRemove.forEach(n=>n()),e===this.animateHead?(this.animateHead=e.nextAnimate,e===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):e===this.animateTail?(this.animateTail=e.prevAnimate,this.animateTail.nextAnimate=null):(e.prevAnimate.nextAnimate=e.nextAnimate,e.nextAnimate.prevAnimate=e.prevAnimate),i&&e.release()}}const defaultTimeline=new DefaultTimeline;class ACustomAnimate{constructor(e,i,n,o,l){this.from=e,this.to=i,this.duration=n,this.easing=o,this.params=l,this.updateCount=0}bind(e,i){this.target=e,this.subAnimate=i,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var e;const i=this.getEndProps();return i?this._endProps===i?this._mergedEndProps:(this._endProps=i,void(this._mergedEndProps=Object.assign({},(e=this.step.prev.getLastProps())!==null&&e!==void 0?e:{},i))):this.step.prev?this.step.prev.getLastProps():i}update(e,i,n){if(this.updateCount===0){this.onFirstRun();const o=this.step.getLastProps();Object.keys(o).forEach(l=>{this.subAnimate.animate.validAttr(l)&&(n[l]=o[l])})}this.updateCount+=1,this.onUpdate(e,i,n),e&&this.onEnd()}}class CbAnimate extends ACustomAnimate{constructor(e){super(null,null,0,"linear"),this.cb=e}onUpdate(e,i,n){}onStart(){this.cb()}}let Animate$1=class we{constructor(e=Generator.GenAutoIncrementId(),i=defaultTimeline,n){this.id=e,this.timeline=i||defaultTimeline,this.status=AnimateStatus.INITIAL,this.tailAnimate=new SubAnimate(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=n}setTimeline(e){e!==this.timeline&&(this.timeline.removeAnimate(this,!1),e.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce((e,i)=>e+i.totalDuration,0)}after(e){const i=e.getDuration();return this._startTime=i,this}afterAll(e){let i=-1/0;return e.forEach(n=>{i=max$1(n.getDuration(),i)}),this._startTime=i,this}parallel(e){return this._startTime=e.getStartTime(),this}static AddInterpolate(e,i){we.interpolateMap.set(e,i)}play(e){if(this.tailAnimate.play(e),this.target){const i=this.target.stage;i&&i.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.totalDuration===e.duration&&this.trySetAttribute(e.getFromProps(),e.mode),this}trySetAttribute(e,i=we.mode){e&&i&AnimateMode.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(e,!1,{type:AttributeUpdateType.ANIMATE_PLAY})}runCb(e){const i=new CbAnimate(()=>{e(this,i.step.prev)});return this.tailAnimate.play(i),this}customInterpolate(e,i,n,o,l,u){const d=we.interpolateMap.get(e)||we.interpolateMap.get("");return!!d&&d(e,i,n,o,l,u)}pause(){this.status===AnimateStatus.RUNNING&&(this.status=AnimateStatus.PAUSED)}resume(){this.status===AnimateStatus.PAUSED&&(this.status=AnimateStatus.RUNNING)}to(e,i,n,o){if(this.tailAnimate.to(e,i,n,o),this.target){const l=this.target.stage;l&&l.renderNextFrame()}return this}from(e,i,n,o){if(this.tailAnimate.from(e,i,n,o),this.target){const l=this.target.stage;l&&l.renderNextFrame()}return this}wait(e){if(this.tailAnimate.wait(e),this.target){const i=this.target.stage;i&&i.renderNextFrame()}return this}startAt(e){if(this.tailAnimate.startAt(e),this.target){const i=this.target.stage;i&&i.renderNextFrame()}return this}loop(e){if(this.tailAnimate.loop=e,this.target){const i=this.target.stage;i&&i.renderNextFrame()}return this}reversed(e){if(this.tailAnimate.reversed=e,this.target){const i=this.target.stage;i&&i.renderNextFrame()}return this}bounce(e){if(this.tailAnimate.bounce=e,this.target){const i=this.target.stage;i&&i.renderNextFrame()}return this}subAnimate(){const e=new SubAnimate(this,this.tailAnimate);return this.tailAnimate=e,this.subAnimates.push(e),e.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(e){this._preventAttrs&&this._preventAttrs.delete(e)}preventAttr(e){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(e)}preventAttrs(e){e.forEach(i=>this.preventAttr(i))}validAttr(e){return!this._preventAttrs||!this._preventAttrs.has(e)}bind(e){return this.target=e,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach(i=>{i.bind(e)}),this}advance(e){if(this._duringTime<this._startTime){if(this._duringTime+e*this.timeScale<this._startTime)return void(this._duringTime+=e*this.timeScale);e=this._duringTime+e*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===AnimateStatus.INITIAL&&(this.status=AnimateStatus.RUNNING,this._onStart&&this._onStart.forEach(i=>i())),this.setPosition(Math.max(this.rawPosition,0)+e*this.timeScale)&&this.status===AnimateStatus.RUNNING&&(this.status=AnimateStatus.END,this._onEnd&&this._onEnd.forEach(i=>i()))}setPosition(e){let i,n=0;const o=this.rawPosition,l=this.subAnimates.reduce((d,f)=>d+f.totalDuration,0);e<0&&(e=0);const u=e>=l;if(u&&(e=l),e===o)return u;for(let d=0;d<this.subAnimates.length&&(i=this.subAnimates[d],!(n+i.totalDuration>=e));d++)n+=i.totalDuration,i=void 0;return this.rawPosition=e,i.setPosition(e-n),u}onStart(e){this._onStart||(this._onStart=[]),this._onStart.push(e)}onEnd(e){this._onEnd||(this._onEnd=[]),this._onEnd.push(e)}onRemove(e){this._onRemove||(this._onRemove=[]),this._onRemove.push(e)}onFrame(e){this._onFrame||(this._onFrame=[]),this._onFrame.push(e)}release(){this.status=AnimateStatus.END}stop(e){e||this.target.onStop(),e==="start"?this.target.onStop(this.getStartProps()):e==="end"?this.target.onStop(this.getEndProps()):this.target.onStop(e),this.release()}};Animate$1.mode=AnimateMode.NORMAL,Animate$1.interpolateMap=new Map;class SubAnimate{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(e,i){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=e,this.stepHead=new Step(0,0,i?Object.assign({},i.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(e){return this.target=e,this}play(e){let i=e.duration;(i==null||i<0)&&(i=0);const n=e.easing,o=typeof n=="string"?Easing[n]:n,l=this._addStep(i,null,o);return l.type=AnimateStepType.customAnimate,this._appendProps(e.getEndProps(),l,!1),this._appendCustomAnimate(e,l),this}to(e,i,n,o){(i==null||i<0)&&(i=0);const l=typeof n=="string"?Easing[n]:n,u=this._addStep(i,null,l);return u.type=AnimateStepType.to,this._appendProps(e,u,!!o&&o.tempProps),u.propKeys||(u.propKeys=Object.keys(u.props)),o&&o.noPreventAttrs||this.target.animates.forEach(d=>{d.id!==this.animate.id&&d.preventAttrs(u.propKeys)}),this}from(e,i,n,o){this.to(e,0,n,o);const l={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach(u=>{l[u]=this.getLastPropByName(u,this.stepTail)}),this.to(l,i,n,o),this.stepTail.type=AnimateStepType.from}startAt(e){return e<0&&(e=0),this._startAt=e,this}getStartProps(){var e;return(e=this.stepHead)===null||e===void 0?void 0:e.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(e){if(e>0){const i=this._addStep(+e,null);i.type=AnimateStepType.wait,i.prev.customAnimate?i.props=i.prev.customAnimate.getEndProps():i.props=i.prev.props,this.target.onAddStep&&this.target.onAddStep(i)}return this}_addStep(e,i,n){const o=new Step(this.duration,e,i,n);return this.duration+=e,this.stepTail.append(o),this.stepTail=o,o}_appendProps(e,i,n){i.props=n?e:Object.assign({},e);let o=i.prev;const l=i.props;for(i.propKeys||(i.propKeys=Object.keys(i.props)),i.propKeys.forEach(d=>{i.props[d]===void 0&&(i.props[d]=this.target.getDefaultAttribute(d))});o.prev;)o.props&&(o.propKeys||(o.propKeys=Object.keys(o.props)),o.propKeys.forEach(d=>{l[d]===void 0&&(l[d]=o.props[d])})),i.propKeys=Object.keys(i.props),o=o.prev;const u=this.stepHead.props;i.propKeys||(i.propKeys=Object.keys(l)),i.propKeys.forEach(d=>{if(u[d]===void 0){const f=this.animate.getStartProps();u[d]=f[d]=this.target.getComputedAttribute(d)}}),this.target.onAddStep&&this.target.onAddStep(i)}_appendCustomAnimate(e,i){i.customAnimate=e,e.step=i,e.bind(this.target,this)}setPosition(e){var i;const n=this.duration,o=this.loop,l=this.rawPosition;let u,d,f=!1;const g=(i=this._startAt)!==null&&i!==void 0?i:0;if(e<0&&(e=0),e<g)return this.rawPosition=e,!1;if(e-=g,n<=0&&(f=!0,n<0)||(u=Math.floor(e/n),d=e-u*n,f=e>=o*n+n,f&&(d=n,u=o,e=d*u+n),e===l))return f;const _=!this.reversed!=!(this.bounce&&u%2);return _&&(d=n-d),this._deltaPosition=d-this.position,this.position=d,this.rawPosition=e+g,this.updatePosition(f,_),f}updatePosition(e,i){if(!this.stepHead)return;let n=this.stepHead.next;const o=this.position,l=this.duration;if(this.target&&n){let u=n.next;for(;u&&u.position<=o;)n=u,u=n.next;let d=e?l===0?1:o/l:(o-n.position)/n.duration;n.easing&&(d=n.easing(d)),this.tryCallCustomAnimateLifeCycle(n,this._lastStep||(i?this.stepTail:this.stepHead),i),this.updateTarget(n,d,e),this._lastStep=n,this.animate._onFrame&&this.animate._onFrame.forEach(f=>f(n,d))}}tryCallCustomAnimateLifeCycle(e,i,n){if(e!==i)if(n){let o=i.prev;for(;o&&o!==e;)o.customAnimate&&(o.customAnimate.onStart&&o.customAnimate.onStart(),o.customAnimate.onEnd&&o.customAnimate.onEnd()),o=e.prev;i&&i.customAnimate&&i.customAnimate.onEnd&&i.customAnimate.onEnd(),e&&e.customAnimate&&e.customAnimate.onStart&&e.customAnimate.onStart()}else{let o=i.next;for(;o&&o!==e;)o.customAnimate&&(o.customAnimate.onStart&&o.customAnimate.onStart(),o.customAnimate.onEnd&&o.customAnimate.onEnd()),o=o.next;i&&i.customAnimate&&i.customAnimate.onEnd&&i.customAnimate.onEnd(),e&&e.customAnimate&&e.customAnimate.onStart&&e.customAnimate.onStart()}}getLastPropByName(e,i){let n=i.prev;for(;n;){if(n.props&&n.props[e]!==void 0)return n.props[e];if(n.customAnimate){const o=n.customAnimate.getEndProps()[e];if(o!==void 0)return o}n=n.prev}return Logger.getInstance().warn("step"),i.props[e]}updateTarget(e,i,n){e.props==null&&e.customAnimate==null||this.target.onStep(this,this.animate,e,i,n)}}class Step{constructor(e,i,n,o){this.duration=i,this.position=e,this.props=n,this.easing=o}append(e){e.prev=this,e.next=this.next,this.next=e}getLastProps(){let e=this.prev;for(;e;){if(e.props)return e.props;if(e.customAnimate)return e.customAnimate.getMergedEndProps();e=e.prev}return null}}const DefaultStateAnimateConfig={duration:200,easing:"cubicOut"};var Edge;(function(r){r[r.Top=1]="Top",r[r.Right=2]="Right",r[r.Bottom=4]="Bottom",r[r.Left=8]="Left",r[r.ALL=15]="ALL"})(Edge||(Edge={}));const _strokeVec4=[!1,!1,!1,!1],parseStroke=r=>{var e;let i=!0;if(isBoolean(r,!0)){for(let n=0;n<4;n++)_strokeVec4[n]=r,i&&(i=!((e=_strokeVec4[n])!==null&&e!==void 0&&!e));i=r}else if(Array.isArray(r))for(let n=0;n<4;n++)_strokeVec4[n]=!!r[n],i&&(i=!!_strokeVec4[n]);else _strokeVec4[0]=!1,_strokeVec4[1]=!1,_strokeVec4[2]=!1,_strokeVec4[3]=!1;return{isFullStroke:i,stroke:_strokeVec4}},_paddingVec4=[0,0,0,0],parsePadding=r=>r?isArray(r)?r.length===0?0:r.length===1?r[0]:r.length===2?(_paddingVec4[0]=r[0],_paddingVec4[2]=r[0],_paddingVec4[1]=r[1],_paddingVec4[3]=r[1],_paddingVec4):r:r:0,_coords=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],indexList=[1,2,3,0,1,2,3,0];function circleBounds(r,e,i,n){for(;r>=pi2;)r-=pi2;for(;r<0;)r+=pi2;for(;r>e;)e+=pi2;_coords[0].x=i,_coords[1].y=i,_coords[2].x=-i,_coords[3].y=-i;const o=Math.ceil(r/halfPi$2)%4,l=Math.ceil(e/halfPi$2)%4;if(n.add(cos$1(r)*i,sin$1(r)*i),n.add(cos$1(e)*i,sin$1(e)*i),o!==l||e-r>pi$1){let u=!1;for(let d=0;d<indexList.length;d++)if(u||o!==indexList[d]){if(u&&l===indexList[d])break;if(u){const f=_coords[indexList[d]];n.add(f.x,f.y)}}else{u=!0;const f=_coords[o];n.add(f.x,f.y)}}}function pointInterpolation(r,e,i){const{x:n,y:o}=pointAt(r.x,r.y,e.x,e.y,i),{x:l,y:u}=pointAt(r.x1,r.y1,e.x1,e.y1,i),d=new Point(n,o,l,u);return d.defined=e.defined,d}function pointsInterpolation(r,e,i){if(!r||!e)return[];Array.isArray(r)||(r=[r]),Array.isArray(e)||(e=[e]);let n=[];if(r.length>e.length){n=e.map(o=>{const l=new Point(o.x,o.y,o.x1,o.y1);return l.defined=o.defined,l});for(let o=0;o<e.length;o++)n[o]=pointInterpolation(r[o],e[o],i)}else{n=e.map(o=>{const l=new Point(o.x,o.y,o.x1,o.y1);return l.defined=o.defined,l});for(let o=0;o<r.length;o++)n[o]=pointInterpolation(r[o],e[o],i)}return n}function getAttributeFromDefaultAttrList(r,e){if(isArray(r)){let i;for(let n=0;n<r.length&&i===void 0;n++)i=r[n][e];return i}return r[e]}class RafBasedSTO{constructor(e=RafBasedSTO.TimeOut){this.durations=[],this.timeout=e,this.lastDate=0,this.durationsListThreshold=30}call(e){return this.lastDate=Date.now(),setTimeout(()=>{this.appendDuration(Date.now()-this.lastDate),e(0)},this.timeout,!0)}clear(e){clearTimeout(e)}appendDuration(e){this.durations.push(e),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce((i,n)=>i+n,0)/this.durations.length,1e3/60),1e3/30)}}RafBasedSTO.TimeOut=1e3/60;const rafBasedSto=new RafBasedSTO,_calculateLineHeight=(r,e)=>isString(r)&&r[r.length-1]==="%"?e*(Number.parseFloat(r.substring(0,r.length-1))/100):r,calculateLineHeight=(r,e)=>{const i=_calculateLineHeight(r,e);return isNaN(i)?i:Math.max(e,i)};class IncreaseCount extends ACustomAnimate{constructor(e,i,n,o,l){super(e,i,n,o,l)}getEndProps(){return this.valid===!1?{}:{text:this.to}}onBind(){var e,i,n,o,l,u,d,f;this.fromNumber=isNumber((e=this.from)===null||e===void 0?void 0:e.text)?(i=this.from)===null||i===void 0?void 0:i.text:Number.parseFloat((n=this.from)===null||n===void 0?void 0:n.text),this.toNumber=isNumber((o=this.to)===null||o===void 0?void 0:o.text)?(l=this.to)===null||l===void 0?void 0:l.text:Number.parseFloat((u=this.to)===null||u===void 0?void 0:u.text),Number.isFinite(this.toNumber)||(this.fromNumber=0),Number.isFinite(this.toNumber)||(this.valid=!1),this.valid!==!1&&(this.decimalLength=(f=(d=this.params)===null||d===void 0?void 0:d.fixed)!==null&&f!==void 0?f:Math.max(getDecimalPlaces(this.fromNumber),getDecimalPlaces(this.toNumber)))}onEnd(){}onUpdate(e,i,n){this.valid!==!1&&(n.text=e?this.toNumber:(this.fromNumber+(this.toNumber-this.fromNumber)*i).toFixed(this.decimalLength))}}var Direction;(function(r){r[r.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",r[r.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT",r[r.TOP_TO_BOTTOM=2]="TOP_TO_BOTTOM",r[r.BOTTOM_TO_TOP=3]="BOTTOM_TO_TOP",r[r.STROKE=4]="STROKE"})(Direction||(Direction={}));class TagPointsUpdate extends ACustomAnimate{constructor(e,i,n,o,l){var u,d;super(e,i,n,o,l),this.newPointAnimateType=(u=l==null?void 0:l.newPointAnimateType)!==null&&u!==void 0?u:"grow",this.clipRangeByDimension=(d=l==null?void 0:l.clipRangeByDimension)!==null&&d!==void 0?d:"x"}getPoints(e,i=!1){if(e.points)return e.points;if(e.segments){const n=[];return this.segmentsCache||(this.segmentsCache=[]),e.segments.map(o=>{var l,u;o.points&&n.push(...o.points),i&&this.segmentsCache.push((u=(l=o.points)===null||l===void 0?void 0:l.length)!==null&&u!==void 0?u:0)}),n}return[]}onBind(){const e=this.getPoints(this.from),i=this.getPoints(this.to,!0);this.fromPoints=e?Array.isArray(e)?e:[e]:[],this.toPoints=i?Array.isArray(i)?i:[i]:[];const n=new Map;this.fromPoints.forEach(g=>{g.context&&n.set(g.context,g)});let o,l,u=1/0,d=-1/0;for(let g=0;g<this.toPoints.length;g+=1)if(n.has(this.toPoints[g].context)){u=g,o=n.get(this.toPoints[g].context);break}for(let g=this.toPoints.length-1;g>=0;g-=1)if(n.has(this.toPoints[g].context)){d=g,l=n.get(this.toPoints[g].context);break}this.newPointAnimateType==="clip"&&this.toPoints.length!==0&&(Number.isFinite(d)?(this.clipRange=this.toPoints[d][this.clipRangeByDimension]/this.toPoints[this.toPoints.length-1][this.clipRangeByDimension],this.clipRange===1&&(this.shrinkClipRange=this.toPoints[d][this.clipRangeByDimension]/this.fromPoints[this.fromPoints.length-1][this.clipRangeByDimension]),isValidNumber(this.clipRange)?this.clipRange=clamp(this.clipRange,0,1):this.clipRange=0):this.clipRange=0);let f=this.toPoints[0];this.interpolatePoints=this.toPoints.map((g,_)=>{const y=n.get(g.context);return y?(f=y,[y,g]):this.newPointAnimateType==="appear"||this.newPointAnimateType==="clip"?[g,g]:_<u&&o?[o,g]:_>d&&l?[l,g]:[f,g]}),this.points=this.interpolatePoints.map(g=>{const _=g[0],y=g[1],b=new Point(_.x,_.y,_.x1,_.y1);return b.defined=y.defined,b.context=y.context,b})}onFirstRun(){const e=this.target.attribute.clipRange;isValidNumber(e*this.clipRange)&&(this.clipRange*=e)}onUpdate(e,i,n){if(this.points=this.points.map((o,l)=>{const u=pointInterpolation(this.interpolatePoints[l][0],this.interpolatePoints[l][1],i);return u.context=o.context,u}),this.clipRange){if(this.shrinkClipRange)return void(e?(n.points=this.toPoints,n.clipRange=1):(n.points=this.fromPoints,n.clipRange=this.clipRange-(this.clipRange-this.shrinkClipRange)*i));n.clipRange=this.clipRange+(1-this.clipRange)*i}if(this.segmentsCache&&this.to.segments){let o=0;n.segments=this.to.segments.map((l,u)=>{const d=o+this.segmentsCache[u],f=this.points.slice(o,d);return o=d,Object.assign(Object.assign({},l),{points:f})})}else n.points=this.points}}class ClipGraphicAnimate extends ACustomAnimate{constructor(e,i,n,o,l){super(null,null,n,o,l),this.clipFromAttribute=e,this.clipToAttribute=i,this._group=l==null?void 0:l.group,this._clipGraphic=l==null?void 0:l.clipGraphic}onBind(){this._group&&this._clipGraphic&&(this._lastClip=this._group.attribute.clip,this._lastPath=this._group.attribute.path,this._group.setAttributes({clip:!0,path:[this._clipGraphic]},!1,{type:AttributeUpdateType.ANIMATE_BIND}))}onEnd(){this._group&&this._group.setAttributes({clip:this._lastClip,path:this._lastPath},!1,{type:AttributeUpdateType.ANIMATE_END})}onUpdate(e,i,n){if(!this._clipGraphic)return;const o={};Object.keys(this.clipFromAttribute).forEach(l=>{o[l]=this.clipFromAttribute[l]+(this.clipToAttribute[l]-this.clipFromAttribute[l])*i}),this._clipGraphic.setAttributes(o,!1,{type:AttributeUpdateType.ANIMATE_UPDATE,animationState:{ratio:i,end:e}})}}class ClipAngleAnimate extends ClipGraphicAnimate{constructor(e,i,n,o,l){var u,d,f,g,_,y,b,S,v,A,x,T;const C=(d=(u=l==null?void 0:l.group)===null||u===void 0?void 0:u.attribute)!==null&&d!==void 0?d:{},E=(f=C.width)!==null&&f!==void 0?f:0,P=(g=C.height)!==null&&g!==void 0?g:0,L=(_=l==null?void 0:l.animationType)!==null&&_!==void 0?_:"in",R=(y=l==null?void 0:l.startAngle)!==null&&y!==void 0?y:0,w=(b=l==null?void 0:l.orient)!==null&&b!==void 0?b:"clockwise";let D=0,I=0;w==="anticlockwise"?(I=L==="in"?R+2*Math.PI:R,I=R+2*Math.PI):(D=R,I=L==="out"?R+2*Math.PI:R);const O=application.graphicService.creator.arc({x:(v=(S=l==null?void 0:l.center)===null||S===void 0?void 0:S.x)!==null&&v!==void 0?v:E/2,y:(x=(A=l==null?void 0:l.center)===null||A===void 0?void 0:A.y)!==null&&x!==void 0?x:P/2,outerRadius:(T=l==null?void 0:l.radius)!==null&&T!==void 0?T:(E+P)/2,innerRadius:0,startAngle:D,endAngle:I,fill:!0});let B,N;w==="anticlockwise"?(B={startAngle:R+2*Math.PI},N={startAngle:R}):(B={endAngle:R},N={endAngle:R+2*Math.PI}),super(L==="in"?B:N,L==="in"?N:B,n,o,{group:l==null?void 0:l.group,clipGraphic:O})}}class ClipDirectionAnimate extends ClipGraphicAnimate{constructor(e,i,n,o,l){var u,d,f,g,_,y,b,S,v;const A=(d=(u=l==null?void 0:l.group)===null||u===void 0?void 0:u.attribute)!==null&&d!==void 0?d:{},x=(g=(f=l==null?void 0:l.width)!==null&&f!==void 0?f:A.width)!==null&&g!==void 0?g:0,T=(y=(_=l==null?void 0:l.height)!==null&&_!==void 0?_:A.height)!==null&&y!==void 0?y:0,C=(b=l==null?void 0:l.animationType)!==null&&b!==void 0?b:"in",E=(S=l==null?void 0:l.direction)!==null&&S!==void 0?S:"x",P=(v=l==null?void 0:l.orient)!==null&&v!==void 0?v:"positive",L=application.graphicService.creator.rect({x:0,y:0,width:C==="in"&&E==="x"?0:x,height:C==="in"&&E==="y"?0:T,fill:!0});let R={},w={};E==="y"?P==="negative"?(R={y:T,height:0},w={y:0,height:T}):(R={height:0},w={height:T}):P==="negative"?(R={x,width:0},w={x:0,width:x}):(R={width:0},w={width:x}),super(C==="in"?R:w,C==="in"?w:R,n,o,{group:l==null?void 0:l.group,clipGraphic:L})}}class RotateBySphereAnimate extends ACustomAnimate{onStart(){const{center:e,r:i}=typeof this.params=="function"?this.params():this.params,n=this.target.getComputedAttribute("x"),o=this.target.getComputedAttribute("y"),l=this.target.getComputedAttribute("z"),u=Math.acos((o-e.y)/i);let d=Math.acos((n-e.x)/i/Math.sin(u));l-e.z<0&&(d=pi2-d),this.theta=d,this.phi=u}onBind(){}onEnd(){}onUpdate(e,i,n){if(this.phi==null||this.theta==null)return;const{center:o,r:l,cb:u}=typeof this.params=="function"?this.params():this.params,d=2*Math.PI*i,f=this.theta+d,g=this.phi,_=l*Math.sin(g)*Math.cos(f)+o.x,y=l*Math.cos(g)+o.y,b=l*Math.sin(g)*Math.sin(f)+o.z;for(n.x=_,n.y=y,n.z=b,n.alpha=f+pi$1/2;n.alpha>pi2;)n.alpha-=pi2;n.alpha=pi2-n.alpha,n.zIndex=-1e4*n.z,u&&u(n)}}class AnimateGroup extends ACustomAnimate{constructor(e,i){super(null,null,e,"linear"),this.customAnimates=i}initAnimates(){this.customAnimates.forEach(e=>{e.step=this.step,e.subAnimate=this.subAnimate,e.target=this.target})}getEndProps(){const e={};return this.customAnimates.forEach(i=>{Object.assign(e,i.getEndProps())}),e}onBind(){this.initAnimates(),this.customAnimates.forEach(e=>{e.onBind()})}onEnd(){this.customAnimates.forEach(e=>{e.onEnd()})}onStart(){this.customAnimates.forEach(e=>{e.onStart()})}onUpdate(e,i,n){this.updating||(this.updating=!0,this.customAnimates.forEach(o=>{const l=o.easing;i=(typeof l=="string"?Easing[l]:l)(i),o.onUpdate(e,i,n)}),this.updating=!1)}}const normalizeRectAttributes=r=>{if(!r)return{x:0,y:0,width:0,height:0};let e=isNil(r.width)?r.x1-r.x:r.width,i=isNil(r.height)?r.y1-r.y:r.height,n=0,o=0;return e<0?(n=e,e=-e):Number.isNaN(e)&&(e=0),i<0?(o=i,i=-i):Number.isNaN(i)&&(i=0),{x:n,y:o,width:e,height:i}};var ColorType;(function(r){r[r.Color255=0]="Color255",r[r.Color1=1]="Color1"})(ColorType||(ColorType={}));class ColorStore{static Get(e,i=ColorType.Color1,n=[0,0,0,1]){if(i===ColorType.Color1){const u=ColorStore.store1[e];if(u)return n[0]=u[0],n[1]=u[1],n[2]=u[2],n[3]=u[3],n;const d=Color.parseColorString(e);if(d){const f=[d.r/255,d.g/255,d.b/255,d.opacity];ColorStore.store1[e]=f,ColorStore.store255[e]=[d.r,d.g,d.b,d.opacity],n[0]=f[0],n[1]=f[1],n[2]=f[2],n[3]=f[3]}return n}const o=ColorStore.store255[e];if(o)return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n;const l=Color.parseColorString(e);return l&&(ColorStore.store1[e]=[l.r/255,l.g/255,l.b/255,l.opacity],ColorStore.store255[e]=[l.r,l.g,l.b,l.opacity],n[0]=l.r,n[1]=l.g,n[2]=l.b,n[3]=l.opacity),n}static Set(e,i,n){if(i===ColorType.Color1){if(ColorStore.store1[e])return;ColorStore.store1[e]=n,ColorStore.store255[e]=[Math.floor(255*n[0]),Math.floor(255*n[1]),Math.floor(255*n[2]),Math.floor(255*n[3])]}else{if(ColorStore.store255[e])return;ColorStore.store255[e]=n,ColorStore.store1[e]=[n[0]/255,n[1]/255,n[2]/255,n[3]]}}}ColorStore.store255={},ColorStore.store1={};function colorArrayToString(r,e=!1){return Array.isArray(r)&&isNumber(r[0])?e?`rgb(${Math.round(r[0])},${Math.round(r[1])},${Math.round(r[2])},${r[3].toFixed(2)})`:`rgb(${Math.round(r[0])},${Math.round(r[1])},${Math.round(r[2])})`:r}function interpolateColor(r,e,i,n,o){return Array.isArray(r)&&!isNumber(r[0])||Array.isArray(e)&&!isNumber(e[0])?new Array(4).fill(0).map((l,u)=>_interpolateColor(isArray(r)?r[u]:r,isArray(e)?e[u]:e,i,n)):_interpolateColor(r,e,i,n,o)}function _interpolateColor(r,e,i,n,o){if(!r||!e)return r&&colorArrayToString(r)||e&&colorArrayToString(e)||!1;let l,u,d=!1,f=!1;if(Array.isArray(r)?l=r:typeof r=="string"?l=ColorStore.Get(r,ColorType.Color255):d=!0,Array.isArray(e)?u=e:typeof e=="string"?u=ColorStore.Get(e,ColorType.Color255):f=!0,d!==f){const g=d?r:e,_=d?e:r,y=Object.assign(Object.assign({},g),{stops:g.stops.map(b=>Object.assign(Object.assign({},b),{color:colorArrayToString(_)}))});return d?interpolateColor(g,y,i,n,o):interpolateColor(y,g,i,n,o)}if(d){if(r.gradient===e.gradient){const g=r,_=e,y=g.stops,b=_.stops;if(y.length!==b.length)return!1;if(g.gradient==="linear")return interpolateGradientLinearColor(g,_,i);if(g.gradient==="radial")return interpolateGradientRadialColor(g,_,i);if(g.gradient==="conical")return interpolateGradientConicalColor(g,_,i)}return!1}return o&&o(l,u),colorArrayToString(interpolatePureColorArray(l,u,i),n)}function interpolateGradientLinearColor(r,e,i){const n=r.stops,o=e.stops;return{gradient:"linear",x0:r.x0+(e.x0-r.x0)*i,x1:r.x1+(e.x1-r.x1)*i,y0:r.y0+(e.y0-r.y0)*i,y1:r.y1+(e.y1-r.y1)*i,stops:new Array(n.length).fill(0).map((l,u)=>({color:colorStringInterpolationToStr(n[u].color,o[u].color,i),offset:n[u].offset+(o[u].offset-n[u].offset)*i}))}}function interpolateGradientRadialColor(r,e,i){const n=r.stops,o=e.stops;return{gradient:"radial",x0:r.x0+(e.x0-r.x0)*i,x1:r.x1+(e.x1-r.x1)*i,y0:r.y0+(e.y0-r.y0)*i,y1:r.y1+(e.y1-r.y1)*i,r0:r.r0+(e.r0-r.r0)*i,r1:r.r1+(e.r1-r.r1)*i,stops:new Array(n.length).fill(0).map((l,u)=>({color:colorStringInterpolationToStr(n[u].color,o[u].color,i),offset:n[u].offset+(o[u].offset-n[u].offset)*i}))}}function interpolateGradientConicalColor(r,e,i){const n=r.stops,o=e.stops;return{gradient:"conical",startAngle:r.startAngle+(e.startAngle-r.startAngle)*i,endAngle:r.endAngle+(e.endAngle-r.endAngle)*i,x:r.x+(e.x-r.x)*i,y:r.y+(e.y-r.y)*i,stops:new Array(n.length).fill(0).map((l,u)=>({color:colorStringInterpolationToStr(n[u].color,o[u].color,i),offset:n[u].offset+(o[u].offset-n[u].offset)*i}))}}function interpolatePureColorArray(r,e,i){return[r[0]+(e[0]-r[0])*i,r[1]+(e[1]-r[1])*i,r[2]+(e[2]-r[2])*i,r[3]+(e[3]-r[3])*i]}const _fromColorRGB=[0,0,0,0],_toColorRGB=[0,0,0,0];function colorStringInterpolationToStr(r,e,i){return ColorStore.Get(r,ColorType.Color255,_fromColorRGB),ColorStore.Get(e,ColorType.Color255,_toColorRGB),`rgba(${Math.round(_fromColorRGB[0]+(_toColorRGB[0]-_fromColorRGB[0])*i)},${Math.round(_fromColorRGB[1]+(_toColorRGB[1]-_fromColorRGB[1])*i)},${Math.round(_fromColorRGB[2]+(_toColorRGB[2]-_fromColorRGB[2])*i)},${_fromColorRGB[3]+(_toColorRGB[3]-_fromColorRGB[3])*i})`}class GroupFadeIn extends ACustomAnimate{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:0}})}onEnd(){this.target.setTheme({common:{opacity:1}})}onUpdate(e,i,n){this.target.setTheme({common:{opacity:i}})}}class GroupFadeOut extends ACustomAnimate{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:1}})}onEnd(){this.target.setTheme({common:{opacity:0}})}onUpdate(e,i,n){this.target.setTheme({common:{opacity:1-i}})}}class ResourceLoader{static GetImage(e,i){var n;const o=ResourceLoader.cache.get(e);o?o.loadState==="fail"?application.global.getRequestAnimationFrame()(()=>{i.imageLoadFail(e)}):o.loadState==="init"||o.loadState==="loading"?(n=o.waitingMark)===null||n===void 0||n.push(i):i&&i.imageLoadSuccess(e,o.data):ResourceLoader.loadImage(e,i)}static GetSvg(e,i){var n;let o=ResourceLoader.cache.get(e);o?o.loadState==="fail"?application.global.getRequestAnimationFrame()(()=>{i.imageLoadFail(e)}):o.loadState==="init"||o.loadState==="loading"?(n=o.waitingMark)===null||n===void 0||n.push(i):i&&i.imageLoadSuccess(e,o.data):(o={type:"image",loadState:"init"},ResourceLoader.cache.set(e,o),o.dataPromise=application.global.loadSvg(e),o.dataPromise?(o.waitingMark=[i],o.dataPromise.then(l=>{var u;o.loadState=l!=null&&l.data?"success":"fail",o.data=l==null?void 0:l.data,(u=o.waitingMark)===null||u===void 0||u.map((d,f)=>{l!=null&&l.data?(o.loadState="success",o.data=l.data,d.imageLoadSuccess(e,l.data)):(o.loadState="fail",d.imageLoadFail(e))}),o.waitingMark&&(o.waitingMark=[])})):(o.loadState="fail",i.imageLoadFail(e)))}static GetFile(e,i){let n=ResourceLoader.cache.get(e);return n?n.loadState==="fail"?Promise.reject():n.loadState==="init"||n.loadState==="loading"?n.dataPromise.then(o=>o.data):Promise.resolve(n.data):(n={type:i,loadState:"init"},ResourceLoader.cache.set(e,n),i==="arrayBuffer"?n.dataPromise=application.global.loadArrayBuffer(e):i==="blob"?n.dataPromise=application.global.loadBlob(e):i==="json"&&(n.dataPromise=application.global.loadJson(e)),n.dataPromise.then(o=>o.data))}static loading(){setTimeout(()=>{if(!ResourceLoader.isLoading&&ResourceLoader.toLoadAueue.length){ResourceLoader.isLoading=!0;const e=ResourceLoader.toLoadAueue.splice(0,10),i=[];e.forEach(n=>{const{url:o,marks:l}=n,u={type:"image",loadState:"init"};if(ResourceLoader.cache.set(o,u),u.dataPromise=application.global.loadImage(o),u.dataPromise){u.waitingMark=l;const d=u.dataPromise.then(f=>{var g;u.loadState=f!=null&&f.data?"success":"fail",u.data=f==null?void 0:f.data,(g=u.waitingMark)===null||g===void 0||g.map((_,y)=>{f!=null&&f.data?(u.loadState="success",u.data=f.data,_.imageLoadSuccess(o,f.data)):(u.loadState="fail",_.imageLoadFail(o))}),u.waitingMark&&(u.waitingMark=[])});i.push(d)}else u.loadState="fail",l.forEach(d=>d.imageLoadFail(o))}),Promise.all(i).then(()=>{ResourceLoader.isLoading=!1,this.onLoadSuccessCb.forEach(n=>n()),ResourceLoader.loading()}).catch(n=>{console.error(n),ResourceLoader.isLoading=!1,this.onLoadSuccessCb.forEach(o=>o()),ResourceLoader.loading()})}},0)}static loadImage(e,i){const n=getIndex(e,ResourceLoader.toLoadAueue);if(n!==-1)return ResourceLoader.toLoadAueue[n].marks.push(i),void ResourceLoader.loading();ResourceLoader.toLoadAueue.push({url:e,marks:[i]}),ResourceLoader.loading()}static improveImageLoading(e){const i=getIndex(e,ResourceLoader.toLoadAueue);if(i!==-1){const n=ResourceLoader.toLoadAueue.splice(i,1);ResourceLoader.toLoadAueue.unshift(n[0])}}static onLoadSuccess(e){this.onLoadSuccessCb.push(e)}}function getIndex(r,e){for(let i=0;i<e.length;i++)if(e[i].url===r)return i;return-1}ResourceLoader.cache=new Map,ResourceLoader.isLoading=!1,ResourceLoader.toLoadAueue=[],ResourceLoader.onLoadSuccessCb=[];const tempMatrix=new Matrix,tempBounds$1=new AABBBounds,GRAPHIC_UPDATE_TAG_KEY=["lineWidth","scaleX","scaleY","angle","anchor","visible"],tempConstantXYKey=["x","y"],tempConstantScaleXYKey=["scaleX","scaleY"],tempConstantAngleKey=["angle"],point=new Point,NOWORK_ANIMATE_ATTR={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class Graphic extends Node{static mixin(e){const i=Object.keys(e);for(let n=0;n<i.length;++n){const o=i[n];Object.defineProperty(Graphic.prototype,o,Object.getOwnPropertyDescriptor(e,o))}}get AABBBounds(){return this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise")}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(e={}){var i;super(),this._AABBBounds=new AABBBounds,this._updateTag=UpdateTag.INIT,this.attribute=e,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,e.background?this.loadImage((i=e.background.background)!==null&&i!==void 0?i:e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic)}setMode(e){e==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(e,i=!1){var n,o;const{dx:l=e.dx,dy:u=e.dy}=this.attribute;if(i&&this.parent){const d=this.parent.attribute;point.x=l+((n=d.scrollX)!==null&&n!==void 0?n:0),point.y=u+((o=d.scrollY)!==null&&o!==void 0?o:0)}else point.x=l,point.y=u;return point}onAnimateBind(e){this._emitCustomEvent("animate-bind",e)}tryUpdateAABBBounds(e){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;application.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const i=this.doUpdateAABBBounds(e);return application.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),i}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new OBBBounds),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(e){if(this.shadowRoot){const i=this.shadowRoot.AABBBounds.clone();e.union(i)}}doUpdateOBBBounds(){return this._OBBBounds}doUpdateAABBBounds(e){this.updateAABBBoundsStamp++;const i=this.getGraphicTheme();this._AABBBounds.clear();const n=this.attribute,o=this.updateAABBBounds(n,i,this._AABBBounds,e),{boundsPadding:l=i.boundsPadding}=n,u=parsePadding(l);return u&&o.expand(u),this.clearUpdateBoundTag(),o}updatePathProxyAABBBounds(e){const i=typeof this.pathProxy=="function"?this.pathProxy(this.attribute):this.pathProxy;if(!i)return!1;const n=new BoundsContext(e);return renderCommandList(i.commandList,n,0,0),!0}tryUpdateGlobalAABBBounds(){const e=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(e.x1,e.y1,e.x2,e.y2):this._globalAABBBounds=e.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(e=!0){if(this._globalTransMatrix){if(this.parent){const i=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(i.a,i.b,i.c,i.d,i.e,i.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(e=!0){return this._transMatrix||(this._transMatrix=new Matrix),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),e&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&UpdateTag.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&application.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&UpdateTag.UPDATE_BOUNDS)&&application.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&UpdateTag.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&UpdateTag.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&UpdateTag.UPDATE_LOCAL_MATRIX)}isValid(){var e,i;const n=this.attribute;return Number.isFinite(((e=n.x)!==null&&e!==void 0?e:0)+((i=n.y)!==null&&i!==void 0?i:0))}_validNumber(e){return e==null||Number.isFinite(e)}shouldUpdateShape(){return!!(this._updateTag&UpdateTag.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=UpdateTag.CLEAR_SHAPE}containsPoint(e,i,n,o){if(!o)return!1;if(n===IContainPointMode.GLOBAL){const l=new Point(e,i);this.parent&&this.parent.globalTransMatrix.transformPoint(l,l),e=l.x,i=l.y}return o.containsPoint(this,{x:e,y:i})}setAttributes(e,i=!1,n){(e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,n)||e).background?this.loadImage(e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic),this._setAttributes(e,i,n)}_setAttributes(e,i=!1,n){const o=Object.keys(e);for(let l=0;l<o.length;l++){const u=o[l];this.attribute[u]=e[u]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTags(o)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n)}setAttribute(e,i,n,o){var l;const u=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[e]:i},this.attribute,e,o);u?this._setAttributes(u,n,o):isNil((l=this.normalAttrs)===null||l===void 0?void 0:l[e])?(this.attribute[e]=i,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!n&&!this.needUpdateTag(e)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o)):this.normalAttrs[e]=i,e==="background"?this.loadImage(i,!0):e==="shadowGraphic"&&this.setShadowGraphic(i)}needUpdateTags(e,i=GRAPHIC_UPDATE_TAG_KEY){for(let n=0;n<i.length;n++){const o=i[n];if(e.indexOf(o)!==-1)return!0}return!1}needUpdateTag(e,i=GRAPHIC_UPDATE_TAG_KEY){for(let n=0;n<i.length;n++)if(e===i[n])return!0;return!1}initAttributes(e){const i={type:AttributeUpdateType.INIT};e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,i)||e,this.attribute=e,e.background?this.loadImage(e.background,!0):e.shadowGraphic&&this.setShadowGraphic(e.shadowGraphic),this._updateTag=UpdateTag.INIT,this.valid=this.isValid(),this.onAttributeUpdate(i)}translate(e,i){var n,o;if(e===0&&i===0)return this;const l={type:AttributeUpdateType.TRANSLATE},u=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:e,y:i},this.attribute,tempConstantXYKey,l);u&&(e=u.x,i=u.y,delete u.x,delete u.y,this._setAttributes(u));const d=this.attribute,f=d.postMatrix;return f?application.transformUtil.fromMatrix(f,f).translate(e,i):(d.x=((n=d.x)!==null&&n!==void 0?n:DefaultTransform.x)+e,d.y=((o=d.y)!==null&&o!==void 0?o:DefaultTransform.y)+i),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(l),this}translateTo(e,i){const n=this.attribute;if(n.x===e&&n.y===i)return this;const o={type:AttributeUpdateType.TRANSLATE_TO},l=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:e,y:i},this.attribute,tempConstantXYKey,o);return l?(this._setAttributes(l,!1,o),this):(n.x=e,n.y=i,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this)}scale(e,i,n){var o,l;if(e===1&&i===1)return this;const u={type:AttributeUpdateType.SCALE},d=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:e,scaleY:i,scaleCenter:n},this.attribute,tempConstantScaleXYKey,u);d&&(e=d.scaleX,i=d.scaleY,delete d.scaleX,delete d.scaleY,this._setAttributes(d));const f=this.attribute;if(n){let{postMatrix:g}=this.attribute;g||(g=new Matrix,f.postMatrix=g),application.transformUtil.fromMatrix(g,g).scale(e,i,n)}else f.scaleX=((o=f.scaleX)!==null&&o!==void 0?o:DefaultTransform.scaleX)*e,f.scaleY=((l=f.scaleY)!==null&&l!==void 0?l:DefaultTransform.scaleY)*i;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(u),this}scaleTo(e,i){const n=this.attribute;if(n.scaleX===e&&n.scaleY===i)return this;const o={type:AttributeUpdateType.SCALE_TO},l=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:e,scaleY:i},this.attribute,tempConstantScaleXYKey,o);return l?(this._setAttributes(l,!1,o),this):(n.scaleX=e,n.scaleY=i,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this)}rotate(e,i){var n;if(e===0)return this;const o={type:AttributeUpdateType.ROTATE},l=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:e,rotateCenter:i},this.attribute,tempConstantAngleKey,o);l&&(delete l.angle,this._setAttributes(l,!1,o));const u=this.attribute;if(i){let{postMatrix:d}=this.attribute;d||(d=new Matrix,u.postMatrix=d),application.transformUtil.fromMatrix(d,d).rotate(e,i)}else u.angle=((n=u.angle)!==null&&n!==void 0?n:DefaultTransform.angle)+e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}rotateTo(e){const i=this.attribute;if(i.angle===e)return this;const n={type:AttributeUpdateType.ROTATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,tempConstantAngleKey,n);return o?(this._setAttributes(o,!1,n),this):(i.angle=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this)}skewTo(e,i){return this}animate(e){this.animates||(this.animates=new Map);const i=new Animate$1(e==null?void 0:e.id,this.stage&&this.stage.getTimeline(),e==null?void 0:e.slience);if(i.bind(this),e){const{onStart:n,onFrame:o,onEnd:l,onRemove:u}=e;n!=null&&i.onStart(n),o!=null&&i.onFrame(o),l!=null&&i.onEnd(l),u!=null&&i.onRemove(u),i.interpolateFunc=e.interpolate}return this.animates.set(i.id,i),i.onRemove(()=>{this.animates.delete(i.id)}),i}onAttributeUpdate(e){e&&e.skipUpdateCallback||(application.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",e))}update(e){e?(e.bounds&&this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise"),e.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(this.attribute.boundsMode==="imprecise"),this.tryUpdateLocalTransMatrix())}hasState(e){return!(!this.currentStates||!this.currentStates.length)&&(!!isNil(e)||this.currentStates.includes(e))}getState(e){var i;return(i=this.states)===null||i===void 0?void 0:i[e]}applyStateAttrs(e,i,n,o){var l,u,d,f;if(n){const g=Object.keys(e),_=this.getNoWorkAnimateAttr(),y={};let b;g.forEach(v=>{_[v]?(b||(b={}),b[v]=e[v]):y[v]=o&&e[v]===void 0?this.getDefaultAttribute(v):e[v]});const S=this.animate({slience:!0});S.stateNames=i,S.to(y,(u=(l=this.stateAnimateConfig)===null||l===void 0?void 0:l.duration)!==null&&u!==void 0?u:DefaultStateAnimateConfig.duration,(f=(d=this.stateAnimateConfig)===null||d===void 0?void 0:d.easing)!==null&&f!==void 0?f:DefaultStateAnimateConfig.easing),b&&this.setAttributes(b,!1,{type:AttributeUpdateType.STATE})}else this.stopStateAnimates(),this.setAttributes(e,!1,{type:AttributeUpdateType.STATE})}updateNormalAttrs(e){const i={};this.normalAttrs?(Object.keys(e).forEach(n=>{n in this.normalAttrs?(i[n]=this.normalAttrs[n],delete this.normalAttrs[n]):i[n]=this.getNormalAttribute(n)}),Object.keys(this.normalAttrs).forEach(n=>{e[n]=this.normalAttrs[n]})):Object.keys(e).forEach(n=>{i[n]=this.getNormalAttribute(n)}),this.normalAttrs=i}stopStateAnimates(e="end"){this.animates&&this.animates.forEach(i=>{i.stateNames&&(i.stop(e),this.animates.delete(i.id))})}getNormalAttribute(e){let i=this.attribute[e];return this.animates&&this.animates.forEach(n=>{if(n.stateNames){const o=n.getEndProps();has(o,e)&&(i=o[e])}}),i}clearStates(e){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,e,!0)):this.currentStates=[],this.normalAttrs=null}removeState(e,i){if((this.currentStates?this.currentStates.indexOf(e):-1)>=0){const n=this.currentStates.filter(o=>o!==e);this.useStates(n,i)}}toggleState(e,i){if(this.hasState(e))this.removeState(e,i);else if((this.currentStates?this.currentStates.indexOf(e):-1)<0){const n=this.currentStates?this.currentStates.slice():[];n.push(e),this.useStates(n,i)}}addState(e,i,n){var o;if(this.currentStates&&this.currentStates.includes(e)&&(i||this.currentStates.length===1))return;const l=i&&(!((o=this.currentStates)===null||o===void 0)&&o.length)?this.currentStates.concat([e]):[e];this.useStates(l,n)}useStates(e,i){var n;if(!e.length)return void this.clearStates(i);if(!(((n=this.currentStates)===null||n===void 0?void 0:n.length)!==e.length||e.some((l,u)=>this.currentStates[u]!==l)))return;const o={};e.forEach(l=>{var u;const d=this.stateProxy?this.stateProxy(l,e):(u=this.states)===null||u===void 0?void 0:u[l];d&&Object.assign(o,d)}),this.updateNormalAttrs(o),this.currentStates=e,this.applyStateAttrs(o,e,i)}addUpdateBoundTag(){this._updateTag|=UpdateTag.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=UpdateTag.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=UpdateTag.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&UpdateTag.UPDATE_SHAPE_AND_BOUNDS)===UpdateTag.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=UpdateTag.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=UpdateTag.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=UpdateTag.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=UpdateTag.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=UpdateTag.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=UpdateTag.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=UpdateTag.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&UpdateTag.UPDATE_LAYOUT)}getAnchor(e,i){const n=[0,0],o=()=>{if(i.b)return i.b;const{scaleX:l,scaleY:u,angle:d}=this.attribute;return tempBounds$1.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),i.b=this.AABBBounds.clone(),this._AABBBounds.copy(tempBounds$1),this.setAttributes({scaleX:l,scaleY:u,angle:d}),i.b};if(typeof e[0]=="string"){const l=parseFloat(e[0])/100,u=o();n[0]=u.x1+(u.x2-u.x1)*l}else n[0]=e[0];if(typeof e[1]=="string"){const l=parseFloat(e[1])/100,u=o();n[1]=u.y1+(u.y2-u.y1)*l}else n[1]=e[1];return n}doUpdateLocalMatrix(){const{x:e=DefaultTransform.x,y:i=DefaultTransform.y,scaleX:n=DefaultTransform.scaleX,scaleY:o=DefaultTransform.scaleY,angle:l=DefaultTransform.angle,scaleCenter:u,anchor:d,postMatrix:f}=this.attribute;let g=[0,0];const _={};if(d&&(g=this.getAnchor(d,_)),!u||n===1&&o===1)normalTransform(this._transMatrix,this._transMatrix.reset(),e,i,n,o,l,d&&g);else{const b=this._transMatrix;b.reset(),b.translate(g[0],g[1]),b.rotate(l),b.translate(-g[0],-g[1]),b.translate(e,i),g=this.getAnchor(u,_),application.transformUtil.fromMatrix(b,b).scale(n,o,{x:g[0],y:g[1]})}const y=this.getOffsetXY(DefaultTransform);if(this._transMatrix.e+=y.x,this._transMatrix.f+=y.y,f){const b=tempMatrix.setValue(f.a,f.b,f.c,f.d,f.e,f.f),S=this._transMatrix;b.multiply(S.a,S.b,S.c,S.d,S.e,S.f),S.setValue(b.a,b.b,b.c,b.d,b.e,b.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:e=0,scrollY:i=0}=this.parent.attribute;this._globalTransMatrix.translate(e,i)}}setStage(e,i){if(this.stage!==e){if(this.stage=e,this.layer=i,this.setStageToShadowRoot(e,i),this.animates&&this.animates.size){const n=e.getTimeline();this.animates.forEach(o=>{o.setTimeline(n)})}this._onSetStage&&this._onSetStage(this,e,i),application.graphicService.onSetStage(this,e)}}setStageToShadowRoot(e,i){this.shadowRoot&&this.shadowRoot.setStage(e,i)}onAddStep(e){}onStop(e){e&&this.setAttributes(e,!1,{type:AttributeUpdateType.ANIMATE_END})}onStep(e,i,n,o,l){const u={};if(n.customAnimate)n.customAnimate.update(l,o,u);else{const d=n.props,f=n.parsedProps,g=n.propKeys;this.stepInterpolate(e,i,u,n,o,l,d,void 0,f,g)}this.setAttributes(u,!1,{type:AttributeUpdateType.ANIMATE_UPDATE,animationState:{ratio:o,end:l,step:n,isFirstFrameOfStep:e.getLastStep()!==n}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(e,i,n,o,l,u,d,f,g,_){_||(_=Object.keys(d),o.propKeys=_),u?o.propKeys.forEach(y=>{i.validAttr(y)&&(n[y]=d[y])}):_.forEach(y=>{var b;if(!i.validAttr(y))return;const S=d[y],v=(b=f&&f[y])!==null&&b!==void 0?b:e.getLastPropByName(y,o);if(S==null||v==null||S===v)return void(n[y]=S);let A;A=i.interpolateFunc&&i.interpolateFunc(y,l,v,S,n),A||(A=i.customInterpolate(y,l,v,S,this,n),A||this.defaultInterpolate(S,v,y,n,g,l)||this._interpolate(y,l,v,S,n))}),o.parsedProps=g}defaultInterpolate(e,i,n,o,l,u){if(Number.isFinite(e))return o[n]=i+(e-i)*u,!0;if(n==="fill"){l||(l={});const d=l.fillColorArray,f=interpolateColor(i,d??e,u,!1,(g,_)=>{l.fillColorArray=_});return f&&(o[n]=f),!0}if(n==="stroke"){l||(l={});const d=l.strokeColorArray,f=interpolateColor(i,d??e,u,!1,(g,_)=>{l.strokeColorArray=_});return f&&(o[n]=f),!0}if(n==="shadowColor"){l||(l={});const d=l.shadowColorArray,f=interpolateColor(i,d??e,u,!0,(g,_)=>{l.shadowColorArray=_});return f&&(o[n]=f),!0}return!1}_interpolate(e,i,n,o,l){}getDefaultAttribute(e){return this.getGraphicTheme()[e]}getComputedAttribute(e){var i;return(i=this.attribute[e])!==null&&i!==void 0?i:this.getDefaultAttribute(e)}onSetStage(e,i=!1){this._onSetStage=e,i&&this.stage&&e(this,this.stage)}attachShadow(e){return e&&(e.shadowHost=this),this.shadowRoot=e??application.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map(e=>e.toJson())}}createPathProxy(e){return isString(e,!0)?this.pathProxy=new CustomPath2D().fromString(e):this.pathProxy=new CustomPath2D,this.pathProxy}loadImage(e,i=!1){if(!e||i&&backgroundNotImage(e))return;const n=e;this.resources||(this.resources=new Map);const o={data:"init",state:null};this.resources.set(n,o),typeof e=="string"?(o.state="loading",e.startsWith("<svg")?(ResourceLoader.GetSvg(e,this),this.backgroundImg=this.backgroundImg||i):(isValidUrl(e)||e.includes("/")||isBase64(e))&&(ResourceLoader.GetImage(e,this),this.backgroundImg=this.backgroundImg||i)):isObject$1(e)?(o.state="success",o.data=e,this.backgroundImg=this.backgroundImg||i):o.state="fail"}setShadowGraphic(e){e?this.attachShadow().add(e):this.detachShadow()}imageLoadSuccess(e,i,n){if(!this.resources)return;const o=this.resources.get(e);o&&(o.state="success",o.data=i,n&&n(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(e,i){if(!this.resources)return;const n=this.resources.get(e);n&&(n.state="fail",i&&i())}_stopAnimates(e){e&&e.forEach(i=>{i.stop()})}stopAnimates(e=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&e&&this.forEachChildren(i=>{i.stopAnimates(e)})}release(){this.releaseStatus="released",application.graphicService.onRelease(this)}_emitCustomEvent(e,i){var n,o;if(this._events&&e in this._events){const l=new CustomEvent(e,i);l.bubbles=!1,l.manager=(o=(n=this.stage)===null||n===void 0?void 0:n.eventSystem)===null||o===void 0?void 0:o.manager,this.dispatchEvent(l)}}}function backgroundNotImage(r){return!(!r.fill&&!r.stroke)}Graphic.mixin(EventTarget);function getAllMatches(r,e){const i=[];let n=e.exec(r);for(;n;){const o=[];o.startIndex=e.lastIndex-n[0].length;const l=n.length;for(let u=0;u<l;u++)o.push(n[u]);i.push(o),n=e.exec(r)}return i}class XmlNode{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,i){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:i})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}function findClosingIndex(r,e,i,n){const o=r.indexOf(e,i);if(o===-1)throw new Error(n);return o+e.length-1}function tagExpWithClosingIndex(r,e,i=">"){let n,o="";for(let l=e;l<r.length;l++){let u=r[l];if(n)u===n&&(n="");else if(u==='"'||u==="'")n=u;else if(u===i[0]){if(!i[1])return{data:o,index:l};if(r[l+1]===i[1])return{data:o,index:l}}else u==="	"&&(u=" ");o+=u}}function readTagExp(r,e,i,n=">"){const o=tagExpWithClosingIndex(r,e+1,n);if(!o)return;let l=o.data;const u=o.index,d=l.search(/\s/);let f=l,g=!0;return d!==-1&&(f=l.substr(0,d).replace(/\s\s*$/,""),l=l.substr(d+1)),{tagName:f,tagExp:l,closeIndex:u,attrExpPresent:g,rawTagName:f}}const attrsRegx=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");class OrderedObjParser{constructor(e){this.currentNode=null,this.options=e,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(e,i,n){const o=i.tagname;typeof o=="string"&&(i.tagname=o),e.addChild(i)}buildAttributesMap(e,i,n){const o={};if(!e)return;const l=getAllMatches(e,attrsRegx),u=l.length;for(let d=0;d<u;d++){const f=l[d][1],g=l[d][4],_=f;f&&(o[_]=g===void 0||(isNaN(g)?g:Number(g)))}return o}parseXml(e){e=e.replace(/\r\n?/g,`
`);const i=new XmlNode("!xml");let n=i,o="",l="";for(let u=0;u<e.length;u++)if(e[u]==="<")if(e[u+1]==="/"){const d=findClosingIndex(e,">",u,"Closing Tag is not closed."),f=l.lastIndexOf(".");l=l.substring(0,f),n=this.tagsNodeStack.pop(),n&&n.child&&o&&n.child[n.child.length-1][":@"]&&(n.child[n.child.length-1][":@"].text=o),o="",u=d}else if(e[u+1]==="?")u=readTagExp(e,u,!1,"?>").closeIndex+1;else if(e.substr(u+1,3)==="!--")u=findClosingIndex(e,"-->",u+4,"Comment is not closed.");else{const d=readTagExp(e,u);let f=d.tagName,g=d.tagExp;const _=d.attrExpPresent,y=d.closeIndex;if(f!==i.tagname&&(l+=l?"."+f:f),g.length>0&&g.lastIndexOf("/")===g.length-1){f[f.length-1]==="/"?(f=f.substr(0,f.length-1),l=l.substr(0,l.length-1),g=f):g=g.substr(0,g.length-1);const b=new XmlNode(f);f!==g&&_&&(b[":@"]=this.buildAttributesMap(g,l,f)),this.addChild(n,b,l),l=l.substr(0,l.lastIndexOf("."))}else{const b=new XmlNode(f);this.tagsNodeStack.push(n),f!==g&&_&&(b[":@"]=this.buildAttributesMap(g,l,f)),this.addChild(n,b,l),n=b}o="",u=y}else o+=e[u];return i.child}}function prettify(r,e){return compress(r)}function compress(r,e){const i={};for(let n=0;n<r.length;n++){const o=r[n],l=propName(o);if(l!==void 0&&o[l]){const u=compress(o[l]);isLeafTag(u),o[":@"]&&assignAttributes(u,o[":@"]),i[l]!==void 0&&i.hasOwnProperty(l)?(Array.isArray(i[l])||(i[l]=[i[l]]),i[l].push(u)):i[l]=u}}return i}function propName(r){const e=Object.keys(r);for(let i=0;i<e.length;i++){const n=e[i];if(n!==":@")return n}}function assignAttributes(r,e,i){if(e){const n=Object.keys(e),o=n.length;for(let l=0;l<o;l++){const u=n[l];r[u]=e[u]}}}function isLeafTag(r){return Object.keys(r).length===0}class XMLParser{constructor(e){this.options=Object.assign({},XMLParser.defaultOptions,e)}valid(e){return e.startsWith("<")}parse(e){if(!this.valid)return!1;const i=new OrderedObjParser(this.options).parseXml(e);return prettify(i,this.options)}}XMLParser.defaultOptions={};function isSvg(r){return r.startsWith("<svg")||r.startsWith("<?xml")}var __awaiter$7=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};function waitForAllSubLayers(r){return __awaiter$7(this,void 0,void 0,function*(){const e=[],i=r.getChildren();yield new Promise(n=>{application.global.getRequestAnimationFrame()(()=>{n(null)})}),i.forEach(n=>{n.subLayers.size&&n.subLayers.forEach(o=>{o.drawContribution&&o.drawContribution.hooks&&o.drawContribution.rendering&&e.push(new Promise(l=>{o.drawContribution.hooks.completeDraw.tap("outWait",()=>{o.drawContribution.hooks.completeDraw.taps=o.drawContribution.hooks.completeDraw.taps.filter(u=>u.name!=="outWait"),l(null)})}))})}),yield Promise.all(e)})}function boundStroke(r,e,i,n=0){return r.expand(e+(n/2+(i?miterAdjustment(i,e):0))),r}function miterAdjustment(r,e){return r?e:0}let NUMBER_TYPE=0;function genNumberType(){return NUMBER_TYPE++}var TextDirection;(function(r){r[r.HORIZONTAL=0]="HORIZONTAL",r[r.VERTICAL=1]="VERTICAL"})(TextDirection||(TextDirection={}));function verticalLayout(r){const e=[];let i=0,n="";for(let o=0;o<r.length;o++)rotateText(r[o])?i?n+=r[o]:(i=1,n=r[o]):(i&&(e.push({text:n,direction:TextDirection.VERTICAL}),n="",i=0),e.push({text:r[o],direction:TextDirection.HORIZONTAL}));return n&&e.push({text:n,direction:TextDirection.VERTICAL}),e}const rotateCharList=["","","","","","","","","",""],rotateCharMap=new Map;rotateCharList.forEach(r=>rotateCharMap.set(r,!0));const noRotateCharList=[""],noRotateCharMap=new Map;function rotateText(r){if(rotateCharMap.has(r))return!0;if(noRotateCharMap.has(r))return!1;let e=!1;return r.codePointAt(0)<256&&(e=!0),e}noRotateCharList.forEach(r=>noRotateCharMap.set(r,!0));const ARC_NUMBER_TYPE=genNumberType(),ARC3D_NUMBER_TYPE=genNumberType(),AREA_NUMBER_TYPE=genNumberType(),CIRCLE_NUMBER_TYPE=genNumberType(),GLYPH_NUMBER_TYPE=genNumberType(),GROUP_NUMBER_TYPE=genNumberType(),IMAGE_NUMBER_TYPE=genNumberType(),LINE_NUMBER_TYPE=genNumberType(),PATH_NUMBER_TYPE=genNumberType(),POLYGON_NUMBER_TYPE=genNumberType(),PYRAMID3D_NUMBER_TYPE=genNumberType(),RECT_NUMBER_TYPE=genNumberType(),RECT3D_NUMBER_TYPE=genNumberType(),RICHTEXT_NUMBER_TYPE=genNumberType(),SYMBOL_NUMBER_TYPE=genNumberType(),TEXT_NUMBER_TYPE=genNumberType(),GraphicService=Symbol.for("GraphicService"),GraphicCreator$1=Symbol.for("GraphicCreator"),SVG_PARSE_ATTRIBUTE_MAP={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},SVG_PARSE_ATTRIBUTE_MAP_KEYS=Object.keys(SVG_PARSE_ATTRIBUTE_MAP);var GroupUpdateAABBBoundsMode;(function(r){r[r.LESS_GROUP=0]="LESS_GROUP",r[r.MORE_GROUP=1]="MORE_GROUP"})(GroupUpdateAABBBoundsMode||(GroupUpdateAABBBoundsMode={}));let Group$1=class Ie extends Graphic{constructor(e){super(e),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=GROUP_NUMBER_TYPE,this._childUpdateTag=UpdateTag.UPDATE_BOUNDS}setMode(e){e==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(e){return this.theme||(this.theme=new Theme),this.theme.setTheme(e,this)}createTheme(){this.theme||(this.theme=new Theme)}visibleAll(e){this.setAttribute("visible",e),this.forEachChildren(i=>{i.isContainer&&i.visibleAll?i.visibleAll(e):i.setAttribute("visible",e)})}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(e,i,n){if(n===IContainPointMode.GLOBAL){const o=new Point(e,i);return this.parent&&this.parent.globalTransMatrix.transformPoint(o,o),this.AABBBounds.contains(o.x,o.y)}return this.AABBBounds.contains(e,i)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&UpdateTag.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;application.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.shouldSelfChangeUpdateAABBBounds(),i=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),application.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,e),i}doUpdateLocalMatrix(){const{x:e=DefaultTransform.x,y:i=DefaultTransform.y,dx:n=DefaultTransform.dx,dy:o=DefaultTransform.dy,scaleX:l=DefaultTransform.scaleX,scaleY:u=DefaultTransform.scaleY,angle:d=DefaultTransform.angle,postMatrix:f}=this.attribute;if(e!==0||i!==0||n!==0||o!==0||l!==1||u!==1||d!==0||f)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return getTheme$1(this).group}updateAABBBounds(e,i,n){const o=n;n=n.clone();const{width:l,height:u,path:d,clip:f=i.clip}=e;if(d&&d.length?d.forEach(g=>{n.union(g.AABBBounds)}):l!=null&&u!=null&&n.set(0,0,Math.max(0,l),Math.max(0,u)),!f){this.forEachChildren(y=>{n.union(y.AABBBounds)});const{scrollX:g=0,scrollY:_=0}=e;n.translate(g,_)}return application.graphicService.updateTempAABBBounds(n),application.graphicService.transformAABBBounds(e,n,i,!1,this),o.copy(n),o}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const e=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),e}clearUpdateBoundTag(){this._updateTag&=UpdateTag.CLEAR_BOUNDS,this._childUpdateTag&=UpdateTag.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=UpdateTag.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&UpdateTag.UPDATE_BOUNDS||(this._childUpdateTag|=UpdateTag.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(e){const i=super.appendChild(e);return this.stage&&i&&(i.stage=this.stage,i.layer=this.layer),this.addUpdateBoundTag(),application.graphicService.onAddIncremental(e,this,this.stage),i}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),application.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(e){return this.stage&&e&&e.setStage(this.stage,this.layer),this.addUpdateBoundTag(),e}appendChild(e,i=!0){const n=super.appendChild(e);return i&&this.stage&&n&&n.setStage(this.stage,this.layer),this.addUpdateBoundTag(),n}insertBefore(e,i){return this._updateChildToStage(super.insertBefore(e,i))}insertAfter(e,i){return this._updateChildToStage(super.insertAfter(e,i))}insertInto(e,i){return this._updateChildToStage(super.insertInto(e,i))}removeChild(e){const i=super.removeChild(e);return e.stage=null,application.graphicService.onRemove(e),this.addUpdateBoundTag(),i}removeAllChild(e=!1){this.forEachChildren(i=>{application.graphicService.onRemove(i),e&&i.isContainer&&i.removeAllChild(e)}),super.removeAllChild(),this.addUpdateBoundTag()}setStage(e,i){this.stage!==e&&(this.stage=e,this.layer=i,this.setStageToShadowRoot(e,i),this._onSetStage&&this._onSetStage(this,e,i),application.graphicService.onSetStage(this,e),this.forEachChildren(n=>{n.setStage(e,this.layer)}))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren(e=>{e.isContainer&&e.addUpdateGlobalPositionTag()})}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren(e=>{e.isContainer&&e.addUpdateGlobalPositionTag()})}tryUpdateGlobalTransMatrix(e=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const i=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(i.a,i.b,i.c,i.d,i.e,i.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),e&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&UpdateTag.UPDATE_GLOBAL_MATRIX)}_getChildByName(e,i){return this.find(n=>n.name===e,i)}createOrUpdateChild(e,i,n){let o=this._getChildByName(e);return o?o.setAttributes(i):(o=application.graphicService.creator[n](i),o.name=e,this.add(o)),o}clone(){return new Ie(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ie.NOWORK_ANIMATE_ATTR}};Group$1.NOWORK_ANIMATE_ATTR=NOWORK_ANIMATE_ATTR;function createGroup(r){return new Group$1(r)}class Layer extends Group$1{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("")}get dpr(){return this._dpr}constructor(e,i,n,o){var l;super({}),this.stage=e,this.global=i,this.window=n,this.main=o.main,this.layerHandler=o.layerHandler,this.layerHandler.init(this,n,{main:o.main,canvasId:o.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(l=o.zIndex)!==null&&l!==void 0?l:0}),this.layer=this,this.subLayers=new Map,this.theme=new Theme,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(e=!0){const i=Array.from(this.subLayers.values()).sort((n,o)=>n.zIndex-o.zIndex);this.layerHandler.merge(i.map(n=>(n.layer.subLayers.size&&n.layer.combineSubLayer(e),n.layer.getNativeHandler()))),e&&i.forEach(n=>{n.group&&(n.group.incremental=0)}),i.forEach(n=>{application.layerService.releaseLayer(this.stage,n.layer)}),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(e,i){super.setStage(e,this)}pick(e,i){throw new Error("")}tryRenderSecondaryLayer(e,i){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach(n=>{n.layer.renderCount=this.renderCount,n.layer.render(e,i)})}render(e,i){var n;this.layerHandler.render([this],{renderService:e.renderService,stage:this.stage,layer:this,viewBox:e.viewBox,transMatrix:e.transMatrix,background:(n=e.background)!==null&&n!==void 0?n:this.background,updateBounds:e.updateBounds},i),this.afterDrawCbs.forEach(o=>o(this)),this.tryRenderSecondaryLayer(e,i)}resize(e,i){this.layerHandler.resize(e,i)}resizeView(e,i){this.layerHandler.resizeView(e,i)}setDpr(e){this.layerHandler.setDpr(e)}afterDraw(e){this.afterDrawCbs.push(e)}startAnimate(e){throw new Error("")}setToFrame(e){throw new Error("")}prepare(e,i){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach(e=>{application.layerService.releaseLayer(this.stage,e.layer)})}drawTo(e,i){var n;this.layerHandler.drawTo(e,[this],Object.assign({background:(n=i.background)!==null&&n!==void 0?n:this.background,renderService:i.renderService,viewBox:i.viewBox,transMatrix:i.transMatrix,stage:this.stage,layer:this},i)),this.afterDrawCbs.forEach(o=>o(this))}}const TransformUtil=Symbol.for("TransformUtil"),GraphicUtil=Symbol.for("GraphicUtil"),LayerService=Symbol.for("LayerService"),StaticLayerHandlerContribution=Symbol.for("StaticLayerHandlerContribution"),DynamicLayerHandlerContribution=Symbol.for("DynamicLayerHandlerContribution"),VirtualLayerHandlerContribution=Symbol.for("VirtualLayerHandlerContribution");var DefaultLayerService_1,__decorate$16=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$Q=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let DefaultLayerService=DefaultLayerService_1=class{static GenerateLayerId(){return`${DefaultLayerService_1.idprefix}_${DefaultLayerService_1.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=application.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(r){return this.layerMap.get(r)}getRecommendedLayerType(r){return r||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(r){let e;return e=r==="static"?container.get(StaticLayerHandlerContribution):r==="dynamic"?container.get(DynamicLayerHandlerContribution):container.get(VirtualLayerHandlerContribution),e}createLayer(r,e={main:!1}){var i;this.tryInit();let n=this.getRecommendedLayerType(e.layerMode);n=e.main||e.canvasId?"static":n;const o=this.getLayerHandler(n),l=new Layer(r,this.global,r.window,Object.assign(Object.assign({main:!1},e),{layerMode:n,canvasId:(i=e.canvasId)!==null&&i!==void 0?i:DefaultLayerService_1.GenerateLayerId(),layerHandler:o})),u=this.layerMap.get(r)||[];return u.push(l),this.layerMap.set(r,u),this.staticLayerCountInEnv--,l}prepareStageLayer(r){let e;r.forEachChildren(i=>{const n=i.getNativeHandler();n.type==="virtual"?(n.mainHandler=e,e.secondaryHandlers.push(n)):(e=n,e.secondaryHandlers=[])})}releaseLayer(r,e){e.release();const i=this.layerMap.get(r)||[];this.layerMap.set(r,i.filter(n=>n!==e))}layerCount(r){return(this.layerMap.get(r)||[]).length}restLayerCount(r){return this.global.env==="browser"?10:0}releaseStage(r){this.layerMap.delete(r)}};DefaultLayerService.idprefix="visactor_layer",DefaultLayerService.prefix_count=0,DefaultLayerService=DefaultLayerService_1=__decorate$16([injectable(),__metadata$Q("design:paramtypes",[])],DefaultLayerService);const coreModule=new ContainerModule(r=>{r(VGlobal).to(DefaultGlobal).inSingletonScope(),r(VWindow).to(DefaultWindow),r(GraphicUtil).to(DefaultGraphicUtil).inSingletonScope(),r(TransformUtil).to(DefaultTransformUtil).inSingletonScope(),r(LayerService).to(DefaultLayerService).inSingletonScope()});function runFill(r,e){return!(!r&&!e)}function runStroke(r,e){let i;return i=isArray(r)?r.some(n=>n||n===void 0):!!r,i&&e>0}function fillVisible(r,e,i){return i&&r*e>0}function rectFillVisible(r,e,i,n,o){return o&&r*e>0&&i!==0&&n!==0}function strokeVisible(r,e){return r*e>0}function rectStrokeVisible(r,e,i,n){return r*e>0&&i!==0&&n!==0}function drawPathProxy(r,e,i,n,o,l,u,d){if(!r.pathProxy)return!1;const f=getTheme$1(r,l==null?void 0:l.theme)[r.type.replace("3d","")],{fill:g=f.fill,stroke:_=f.stroke,opacity:y=f.opacity,fillOpacity:b=f.fillOpacity,lineWidth:S=f.lineWidth,strokeOpacity:v=f.strokeOpacity,visible:A=f.visible,x=f.x,y:T=f.y}=r.attribute,C=fillVisible(y,b,g),E=strokeVisible(y,v),P=runFill(g),L=runStroke(_,S);if(!A||!P&&!L||!(C||E||u||d))return!0;e.beginPath();const R=typeof r.pathProxy=="function"?r.pathProxy(r.attribute):r.pathProxy;return renderCommandList(R.commandList,e,i,n),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f),L&&E&&(e.setStrokeStyle(r,r.attribute,i-x,n-T,f),e.stroke()),P&&C&&(e.setCommonStyle(r,r.attribute,i-x,n-T,f),e.fill()),!0}function intersect(r,e,i,n,o,l,u,d){const f=i-r,g=n-e,_=u-o,y=d-l;let b=y*f-_*g;return b*b<epsilon$1?[]:(b=(_*(e-l)-y*(r-o))/b,[r+b*f,e+b*g])}function cornerTangents(r,e,i,n,o,l,u){const d=r-i,f=e-n,g=(u?l:-l)/Math.sqrt(d*d+f*f),_=g*f,y=-g*d,b=r+_,S=e+y,v=i+_,A=n+y,x=(b+v)/2,T=(S+A)/2,C=v-b,E=A-S,P=C*C+E*E,L=o-l,R=b*A-v*S,w=(E<0?-1:1)*Math.sqrt(Math.max(0,L*L*P-R*R));let D=(R*E-C*w)/P,I=(-R*C-E*w)/P;const O=(R*E+C*w)/P,B=(-R*C+E*w)/P,N=D-x,$=I-T,H=O-x,F=B-T;return N*N+$*$>H*H+F*F&&(D=O,I=B),{cx:D,cy:I,x01:-_,y01:-y,x11:D*(o/L-1),y11:I*(o/L-1)}}function calculateArcCornerRadius(r,e,i,n,o){const l=abs$1(i-e),u=r.getParsedCornerRadius(),d=isArray(u),{outerDeltaAngle:f,innerDeltaAngle:g,outerStartAngle:_,outerEndAngle:y,innerEndAngle:b,innerStartAngle:S}=r.getParsePadAngle(e,i),v=d?u[0]:u,A=d?u[1]:u,x=d?u[2]:u,T=d?u[3]:u,C=Math.max(A,v),E=Math.max(x,T);let P=C,L=E;const R=o*cos$1(_),w=o*sin$1(_),D=n*cos$1(b),I=n*sin$1(b);let O,B,N,$;if((E>epsilon$1||C>epsilon$1)&&(O=o*cos$1(y),B=o*sin$1(y),N=n*cos$1(S),$=n*sin$1(S),l<pi$1)){const H=intersect(R,w,N,$,O,B,D,I);if(H){const F=R-H[0],V=w-H[1],G=O-H[0],Y=B-H[1],J=1/sin$1(acos$1((F*G+V*Y)/(sqrt$3(F*F+V*V)*sqrt$3(G*G+Y*Y)))/2),q=sqrt$3(H[0]*H[0]+H[1]*H[1]);L=min$1(E,(n-q)/(J-1)),P=min$1(C,(o-q)/(J+1))}}return{outerDeltaAngle:f,xors:R,yors:w,xirs:N,yirs:$,xore:O,yore:B,xire:D,yire:I,limitedOcr:P,limitedIcr:L,outerCornerRadiusStart:v,outerCornerRadiusEnd:A,maxOuterCornerRadius:C,maxInnerCornerRadius:E,outerStartAngle:_,outerEndAngle:y,innerDeltaAngle:g,innerEndAngle:b,innerStartAngle:S,innerCornerRadiusStart:T,innerCornerRadiusEnd:x}}function drawArcPath$1(r,e,i,n,o,l,u){const{startAngle:d,endAngle:f}=r.getParsedAngle(),g=abs$1(f-d),_=f>d;let y=!1;if(o<l){const b=o;o=l,l=b}if(o<=epsilon$1)e.moveTo(i,n);else if(g>=pi2-epsilon$1)e.moveTo(i+o*cos$1(d),n+o*sin$1(d)),e.arc(i,n,o,d,f,!_),l>epsilon$1&&(e.moveTo(i+l*cos$1(f),n+l*sin$1(f)),e.arc(i,n,l,f,d,_));else{const{outerDeltaAngle:b,xors:S,yors:v,xirs:A,yirs:x,limitedOcr:T,outerCornerRadiusStart:C,outerCornerRadiusEnd:E,maxOuterCornerRadius:P,xore:L,yore:R,xire:w,yire:D,outerStartAngle:I,outerEndAngle:O,limitedIcr:B,innerDeltaAngle:N,innerEndAngle:$,innerStartAngle:H,innerCornerRadiusStart:F,innerCornerRadiusEnd:V,maxInnerCornerRadius:G}=calculateArcCornerRadius(r,d,f,l,o);if(b<.001)u&&(u[3]||u[1])&&e.moveTo(i+S,n+v),y=!0;else if(T>epsilon$1){const Y=min$1(C,T),J=min$1(E,T),q=cornerTangents(A,x,S,v,o,Y,Number(_)),te=cornerTangents(L,R,w,D,o,J,Number(_));T<P&&Y===J?!u||u[0]?(e.moveTo(i+q.cx+q.x01,n+q.cy+q.y01),e.arc(i+q.cx,n+q.cy,T,atan2$1(q.y01,q.x01),atan2$1(te.y01,te.x01),!_)):e.moveTo(i+q.cx+T*cos$1(atan2$1(te.y01,te.x01)),n+q.cy+T*sin$1(atan2$1(te.y01,te.x01))):!u||u[0]?(e.moveTo(i+q.cx+q.x01,n+q.cy+q.y01),Y>0&&e.arc(i+q.cx,n+q.cy,Y,atan2$1(q.y01,q.x01),atan2$1(q.y11,q.x11),!_),e.arc(i,n,o,atan2$1(q.cy+q.y11,q.cx+q.x11),atan2$1(te.cy+te.y11,te.cx+te.x11),!_),J>0&&e.arc(i+te.cx,n+te.cy,J,atan2$1(te.y11,te.x11),atan2$1(te.y01,te.x01),!_)):J>0?e.moveTo(i+te.cx+J*cos$1(atan2$1(te.y01,te.x01)),n+te.cy+J*sin$1(atan2$1(te.y01,te.x01))):e.moveTo(i+L,n+o*sin$1(O))}else!u||u[0]?(e.moveTo(i+S,n+v),e.arc(i,n,o,I,O,!_)):e.moveTo(i+o*cos$1(O),n+o*sin$1(O));if(!(l>epsilon$1)||N<.001)!u||u[1]?e.lineTo(i+w,n+D):e.moveTo(i+w,n+D),y=!0;else if(B>epsilon$1){const Y=min$1(F,B),J=min$1(V,B),q=cornerTangents(w,D,L,R,l,-J,Number(_)),te=cornerTangents(S,v,A,x,l,-Y,Number(_));if(!u||u[1]?e.lineTo(i+q.cx+q.x01,n+q.cy+q.y01):e.moveTo(i+q.cx+q.x01,n+q.cy+q.y01),B<G&&Y===J){const de=atan2$1(te.y01,te.x01);!u||u[2]?e.arc(i+q.cx,n+q.cy,B,atan2$1(q.y01,q.x01),de,!_):e.moveTo(i+q.cx+cos$1(de),n+q.cy+sin$1(de))}else!u||u[2]?(J>0&&e.arc(i+q.cx,n+q.cy,J,atan2$1(q.y01,q.x01),atan2$1(q.y11,q.x11),!_),e.arc(i,n,l,atan2$1(q.cy+q.y11,q.cx+q.x11),atan2$1(te.cy+te.y11,te.cx+te.x11),_),Y>0&&e.arc(i+te.cx,n+te.cy,Y,atan2$1(te.y11,te.x11),atan2$1(te.y01,te.x01),!_)):Y>0?e.moveTo(i+te.cx+Y*cos$1(atan2$1(te.y01,te.x01)),n+te.cy+Y*sin$1(atan2$1(te.y01,te.x01))):e.moveTo(i+A,n+x)}else!u||u[1]?e.lineTo(i+w,n+D):e.moveTo(i+w,n+D),!u||u[2]?e.arc(i,n,l,$,H,_):e.moveTo(i+l*cos$1(H),n+l*sin$1(H))}return u?u[3]&&e.lineTo(i+o*cos$1(d),n+o*sin$1(d)):e.closePath(),y}class ConicalCanvas{static GetCanvas(){try{return ConicalCanvas.canvas||(ConicalCanvas.canvas=application.global.createCanvas({})),ConicalCanvas.canvas}catch{return null}}static GetCtx(){if(!ConicalCanvas.ctx){const e=ConicalCanvas.GetCanvas();ConicalCanvas.ctx=e.getContext("2d")}return ConicalCanvas.ctx}}class ColorInterpolate extends LRU{static getInstance(){return ColorInterpolate._instance||(ColorInterpolate._instance=new ColorInterpolate),ColorInterpolate._instance}constructor(e=[],i=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const n=ConicalCanvas.GetCanvas(),o=ConicalCanvas.GetCtx();if(n.width=i,n.height=1,!o)return;if(o.translate(0,0),!o)throw new Error("ctx");const l=o.createLinearGradient(0,0,i,0);e.forEach(u=>{l.addColorStop(u[0],u[1])}),o.fillStyle=l,o.fillRect(0,0,i,1),this.rgbaSet=o.getImageData(0,0,i,1).data}getColor(e){const i=this.rgbaSet.slice(4*e,4*e+4);return`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${i[3]/255})`}GetOrCreate(e,i,n,o,l=[],u=100){let d=`${e}${i}${n}${o}`;l.forEach(g=>d+=g.join()),d+=u;let f=this.dataMap.get(d);return f||(f={data:new ColorInterpolate(l,u),timestamp:[]},this.addLimitedTimestamp(f,Date.now(),{}),this.dataMap.set(d,f)),this.clearCache(this.dataMap,this.cacheParams),f.data}}class ConicalPatternStore{static GetSize(e){for(let i=0;i<ConicalPatternStore.ImageSize.length;i++)if(ConicalPatternStore.ImageSize[i]>=e)return ConicalPatternStore.ImageSize[i];return e}static Get(e,i,n,o,l,u,d){const f=ConicalPatternStore.GenKey(e,i,n,o,l),g=ConicalPatternStore.cache[f];if(!g||g.length===0)return null;for(let _=0;_<g.length;_++)if(g[_].width>=u&&g[_].height>=d)return g[_].pattern;return null}static Set(e,i,n,o,l,u,d,f){const g=ConicalPatternStore.GenKey(e,i,n,o,l);ConicalPatternStore.cache[g]?ConicalPatternStore.cache[g].push({width:d,height:f,pattern:u}):ConicalPatternStore.cache[g]=[{width:d,height:f,pattern:u}]}static GenKey(e,i,n,o,l){return`${i},${n},${o},${l},${e.join()}`}}ConicalPatternStore.cache={},ConicalPatternStore.ImageSize=[20,40,80,160,320,640,1280,2560];function getConicGradientAt(r,e,i,n){const{stops:o,startAngle:l,endAngle:u}=n;for(;i<0;)i+=pi2;for(;i>pi2;)i-=pi2;if(i<l||i>u)return o[0].color;let d,f,g=(i-l)/(u-l);for(let _=0;_<o.length;_++)if(o[_].offset>=g){d=o[_-1],f=o[_];break}return g=(g-d.offset)/(f.offset-d.offset),interpolateColor(d.color,f.color,g,!1)}function createConicalGradient(r,e,i,n,o,l,u,d,f){const g=Math.floor(180*o/Math.PI),_=ConicalCanvas.GetCanvas(),y=ConicalCanvas.GetCtx();if(!y)return null;const b=ConicalPatternStore.GetSize(d),S=ConicalPatternStore.GetSize(f);let v=ConicalPatternStore.Get(e,i,n,l,u,b,S);if(v)return v;const A=Math.sqrt(Math.max(Math.max(Math.pow(i,2)+Math.pow(n,2),Math.pow(b-i,2)+Math.pow(n,2)),Math.max(Math.pow(b-i,2)+Math.pow(S-n,2),Math.pow(i,2)+Math.pow(S-n,2)))),x=g+1,T=o/Math.max(1,x-1),C=ColorInterpolate.getInstance().GetOrCreate(i,n,b,S,e,x),E=2*Math.PI*A/360;_.width=b,_.height=S,y.setTransform(1,0,0,1,0,0),y.clearRect(0,0,b,S),y.translate(i,n),y.rotate(l);for(let L=0,R=x-1;L<R&&!(l+L*T>u);L++){const w=C.getColor(L);y.beginPath(),y.rotate(T),y.moveTo(0,0),y.lineTo(A,-2*E),y.lineTo(A,0),y.fillStyle=w,y.closePath(),y.fill()}const P=y.getImageData(0,0,b,S);return _.width=P.width,_.height=P.height,y.putImageData(P,0,0),v=r.createPattern(_,"no-repeat"),v&&ConicalPatternStore.Set(e,i,n,l,u,v,b,S),v}const ArcRenderContribution=Symbol.for("ArcRenderContribution"),AreaRenderContribution=Symbol.for("AreaRenderContribution"),CircleRenderContribution=Symbol.for("CircleRenderContribution"),GroupRenderContribution=Symbol.for("GroupRenderContribution"),ImageRenderContribution=Symbol.for("ImageRenderContribution"),PathRenderContribution=Symbol.for("PathRenderContribution"),PolygonRenderContribution=Symbol.for("PolygonRenderContribution"),RectRenderContribution=Symbol.for("RectRenderContribution"),SymbolRenderContribution=Symbol.for("SymbolRenderContribution"),TextRenderContribution=Symbol.for("TextRenderContribution"),InteractiveSubRenderContribution=Symbol.for("InteractiveSubRenderContribution");function textDrawOffsetX(r,e){return r==="end"||r==="right"?-e:r==="center"?-e/2:0}function textLayoutOffsetY(r,e,i,n=0){return r==="middle"?-e/2:r==="top"?0:r==="bottom"?n-e:r&&r!=="alphabetic"?0:(i||(i=e),-(e-i)/2-.79*i)}function textAttributesToStyle(r){const e={},i=n=>/^\d+(\.\d+)?$/.test(`${n}`)?`${n}px`:`${n}`;return["textAlign","fontFamily","fontVariant","fontStyle","fontWeight"].forEach(n=>{r[n]&&(e[lowerCamelCaseToMiddle(n)]=r[n])}),["fontSize","lineHeight"].forEach(n=>{const o=lowerCamelCaseToMiddle(n);isNil(r[n])||(e[o]=i(r[n]))}),isValid(r.maxLineWidth)&&(e["max-width"]=i(r.maxLineWidth)),r.underline?e["text-decoration"]="underline":r.lineThrough&&(e["text-decoration"]="line-through"),r.fill&&isString(r.fill)&&(e.color=r.fill),e}function identityMat4(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function rotateX(r,e,i){const n=Math.sin(i),o=Math.cos(i),l=e[4],u=e[5],d=e[6],f=e[7],g=e[8],_=e[9],y=e[10],b=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=l*o+g*n,r[5]=u*o+_*n,r[6]=d*o+y*n,r[7]=f*o+b*n,r[8]=g*o-l*n,r[9]=_*o-u*n,r[10]=y*o-d*n,r[11]=b*o-f*n,r}function rotateY(r,e,i){const n=Math.sin(i),o=Math.cos(i),l=e[0],u=e[1],d=e[2],f=e[3],g=e[8],_=e[9],y=e[10],b=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=l*o-g*n,r[1]=u*o-_*n,r[2]=d*o-y*n,r[3]=f*o-b*n,r[8]=l*n+g*o,r[9]=u*n+_*o,r[10]=d*n+y*o,r[11]=f*n+b*o,r}function rotateZ(r,e,i){const n=Math.sin(i),o=Math.cos(i),l=e[0],u=e[1],d=e[2],f=e[3],g=e[4],_=e[5],y=e[6],b=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=l*o+g*n,r[1]=u*o+_*n,r[2]=d*o+y*n,r[3]=f*o+b*n,r[4]=g*o-l*n,r[5]=_*o-u*n,r[6]=y*o-d*n,r[7]=b*o-f*n,r}function translate(r,e,i){const n=i[0],o=i[1],l=i[2];let u,d,f,g,_,y,b,S,v,A,x,T;return e===r?(r[12]=e[0]*n+e[4]*o+e[8]*l+e[12],r[13]=e[1]*n+e[5]*o+e[9]*l+e[13],r[14]=e[2]*n+e[6]*o+e[10]*l+e[14],r[15]=e[3]*n+e[7]*o+e[11]*l+e[15]):(u=e[0],d=e[1],f=e[2],g=e[3],_=e[4],y=e[5],b=e[6],S=e[7],v=e[8],A=e[9],x=e[10],T=e[11],r[0]=u,r[1]=d,r[2]=f,r[3]=g,r[4]=_,r[5]=y,r[6]=b,r[7]=S,r[8]=v,r[9]=A,r[10]=x,r[11]=T,r[12]=u*n+_*o+v*l+e[12],r[13]=d*n+y*o+A*l+e[13],r[14]=f*n+b*o+x*l+e[14],r[15]=g*n+S*o+T*l+e[15]),r}function mat3Tomat4(r,e){r[0]=e.a,r[1]=e.b,r[2]=0,r[3]=0,r[4]=e.c,r[5]=e.d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e.e,r[13]=e.f,r[14]=0,r[15]=1}function scaleMat4(r,e,i){const n=i[0],o=i[1],l=i[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*o,r[5]=e[5]*o,r[6]=e[6]*o,r[7]=e[7]*o,r[8]=e[8]*l,r[9]=e[9]*l,r[10]=e[10]*l,r[11]=e[11]*l,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function multiplyMat4Mat4(r,e,i){const n=e[0],o=e[1],l=e[2],u=e[3],d=e[4],f=e[5],g=e[6],_=e[7],y=e[8],b=e[9],S=e[10],v=e[11],A=e[12],x=e[13],T=e[14],C=e[15];let E=i[0],P=i[1],L=i[2],R=i[3];return r[0]=E*n+P*d+L*y+R*A,r[1]=E*o+P*f+L*b+R*x,r[2]=E*l+P*g+L*S+R*T,r[3]=E*u+P*_+L*v+R*C,E=i[4],P=i[5],L=i[6],R=i[7],r[4]=E*n+P*d+L*y+R*A,r[5]=E*o+P*f+L*b+R*x,r[6]=E*l+P*g+L*S+R*T,r[7]=E*u+P*_+L*v+R*C,E=i[8],P=i[9],L=i[10],R=i[11],r[8]=E*n+P*d+L*y+R*A,r[9]=E*o+P*f+L*b+R*x,r[10]=E*l+P*g+L*S+R*T,r[11]=E*u+P*_+L*v+R*C,E=i[12],P=i[13],L=i[14],R=i[15],r[12]=E*n+P*d+L*y+R*A,r[13]=E*o+P*f+L*b+R*x,r[14]=E*l+P*g+L*S+R*T,r[15]=E*u+P*_+L*v+R*C,r}function lookAt(r,e,i,n){let o,l,u,d,f,g,_,y,b,S;const v=e[0],A=e[1],x=e[2],T=n[0],C=n[1],E=n[2],P=i[0],L=i[1],R=i[2];return Math.abs(v-P)<epsilon$1&&Math.abs(A-L)<epsilon$1&&Math.abs(x-R)<epsilon$1?identityMat4(r):(_=v-P,y=A-L,b=x-R,S=1/Math.hypot(_,y,b),_*=S,y*=S,b*=S,o=C*b-E*y,l=E*_-T*b,u=T*y-C*_,S=Math.hypot(o,l,u),S?(S=1/S,o*=S,l*=S,u*=S):(o=0,l=0,u=0),d=y*u-b*l,f=b*o-_*u,g=_*l-y*o,S=Math.hypot(d,f,g),S?(S=1/S,d*=S,f*=S,g*=S):(d=0,f=0,g=0),r[0]=o,r[1]=d,r[2]=_,r[3]=0,r[4]=l,r[5]=f,r[6]=y,r[7]=0,r[8]=u,r[9]=g,r[10]=b,r[11]=0,r[12]=-(o*v+l*A+u*x),r[13]=-(d*v+f*A+g*x),r[14]=-(_*v+y*A+b*x),r[15]=1,r)}function ortho(r,e,i,n,o,l,u){const d=1/(e-i),f=1/(n-o),g=1/(l-u);return r[0]=-2*d,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*f,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*g,r[11]=0,r[12]=(e+i)*d,r[13]=(o+n)*f,r[14]=(u+l)*g,r[15]=1,r}function transformMat4(r,e,i){const n=e[0],o=e[1],l=e[2];let u=i[3]*n+i[7]*o+i[11]*l+i[15];return u=u||1,r[0]=(i[0]*n+i[4]*o+i[8]*l+i[12])/u,r[1]=(i[1]*n+i[5]*o+i[9]*l+i[13])/u,r[2]=(i[2]*n+i[6]*o+i[10]*l+i[14])/u,r}function createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}class DefaultMatrixAllocate{constructor(){this.pools=[]}allocate(e,i,n,o,l,u){if(!this.pools.length)return new Matrix(e,i,n,o,l,u);const d=this.pools.pop();return d.a=e,d.b=i,d.c=n,d.d=o,d.e=l,d.f=u,d}allocateByObj(e){if(!this.pools.length)return new Matrix(e.a,e.b,e.c,e.d,e.e,e.f);const i=this.pools.pop();return i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,i.e=e.e,i.f=e.f,i}free(e){this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}class DefaultMat4Allocate{constructor(){this.pools=[]}static identity(e){return identityMat4(e)}allocate(){if(!this.pools.length)return createMat4();const e=this.pools.pop();return DefaultMat4Allocate.identity(e),e}allocateByObj(e){let i;i=this.pools.length?this.pools.pop():createMat4();for(let n=0;n<i.length;n++)i[n]=e[n];return i}free(e){e&&this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}const matrixAllocate=new DefaultMatrixAllocate,mat4Allocate=new DefaultMat4Allocate;var __decorate$15=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$P=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$F=function(r,e){return function(i,n){e(i,n,r)}};function getModelMatrix(r,e,i){var n;const{x:o=i.x,y:l=i.y,z:u=i.z,dx:d=i.dx,dy:f=i.dy,dz:g=i.dz,scaleX:_=i.scaleX,scaleY:y=i.scaleY,scaleZ:b=i.scaleZ,alpha:S=i.alpha,beta:v=i.beta,angle:A=i.angle,anchor3d:x=e.attribute.anchor,anchor:T}=e.attribute,C=[0,0,0];if(x){if(typeof x[0]=="string"){const E=parseFloat(x[0])/100,P=e.AABBBounds;C[0]=P.x1+(P.x2-P.x1)*E}else C[0]=x[0];if(typeof x[1]=="string"){const E=parseFloat(x[1])/100,P=e.AABBBounds;C[1]=P.x1+(P.x2-P.x1)*E}else C[1]=x[1];C[2]=(n=x[2])!==null&&n!==void 0?n:0}if(identityMat4(r),translate(r,r,[o+d,l+f,u+g]),translate(r,r,[C[0],C[1],C[2]]),rotateX(r,r,v),rotateY(r,r,S),translate(r,r,[-C[0],-C[1],C[2]]),scaleMat4(r,r,[_,y,b]),A){const E=mat4Allocate.allocate(),P=[0,0];if(T){if(typeof x[0]=="string"){const L=parseFloat(x[0])/100,R=e.AABBBounds;P[0]=R.x1+(R.x2-R.x1)*L}else P[0]=x[0];if(typeof x[1]=="string"){const L=parseFloat(x[1])/100,R=e.AABBBounds;P[1]=R.x1+(R.x2-R.x1)*L}else P[1]=x[1]}translate(E,E,[P[0],P[1],0]),rotateZ(E,E,A),translate(E,E,[-P[0],-P[1],0]),multiplyMat4Mat4(r,r,E)}}function shouldUseMat4(r){const{alpha:e,beta:i}=r.attribute;return e||i}let DefaultGraphicService=class{constructor(r){this.creator=r,this.hooks={onAttributeUpdate:new SyncHook(["graphic"]),onSetStage:new SyncHook(["graphic","stage"]),onRemove:new SyncHook(["graphic"]),onRelease:new SyncHook(["graphic"]),onAddIncremental:new SyncHook(["graphic","group","stage"]),onClearIncremental:new SyncHook(["graphic","group","stage"]),beforeUpdateAABBBounds:new SyncHook(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new SyncHook(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new SyncHook(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new AABBBounds,this.tempAABBBounds2=new AABBBounds}onAttributeUpdate(r){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(r)}onSetStage(r,e){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(r,e)}onRemove(r){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(r)}onRelease(r){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(r)}onAddIncremental(r,e,i){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(r,e,i)}onClearIncremental(r,e){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(r,e)}beforeUpdateAABBBounds(r,e,i,n){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(r,e,i,n)}afterUpdateAABBBounds(r,e,i,n,o){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(r,e,i,n,o)}clearAABBBounds(r,e,i){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(r,e,i)}updatePathProxyAABBBounds(r,e){const i=typeof e.pathProxy=="function"?e.pathProxy(e.attribute):e.pathProxy;if(!i)return!1;const n=new BoundsContext(r);return renderCommandList(i.commandList,n,0,0),!0}updateHTMLTextAABBBounds(r,e,i,n){const{textAlign:o,textBaseline:l}=r;if(r.forceBoundsHeight!=null){const u=isNumber(r.forceBoundsHeight)?r.forceBoundsHeight:r.forceBoundsHeight(),d=textLayoutOffsetY(l,u,u);i.set(i.x1,d,i.x2,d+u)}if(r.forceBoundsWidth!=null){const u=isNumber(r.forceBoundsWidth)?r.forceBoundsWidth:r.forceBoundsWidth(),d=textDrawOffsetX(o,u);i.set(d,i.y1,d+u,i.y2)}}combindShadowAABBBounds(r,e){if(e&&e.shadowRoot){const i=e.shadowRoot.AABBBounds;r.union(i)}}transformAABBBounds(r,e,i,n,o){if(!e.empty()){const{scaleX:d=i.scaleX,scaleY:f=i.scaleY,stroke:g=i.stroke,shadowBlur:_=i.shadowBlur,lineWidth:y=i.lineWidth,pickStrokeBuffer:b=i.pickStrokeBuffer,strokeBoundsBuffer:S=i.strokeBoundsBuffer}=r,v=this.tempAABBBounds1,A=this.tempAABBBounds2;if(g&&y){const x=(y+b)/Math.abs(d+f);boundStroke(v,x,n,S),e.union(v),v.setValue(A.x1,A.y1,A.x2,A.y2)}if(_){const{shadowOffsetX:x=i.shadowOffsetX,shadowOffsetY:T=i.shadowOffsetY}=r,C=_/Math.abs(d+f)*2;boundStroke(v,C,!1,S+1),v.translate(x,T),e.union(v)}}if(this.combindShadowAABBBounds(e,o),e.empty())return;let l=!0;const u=o.transMatrix;o&&o.isContainer&&(l=!(u.a===1&&u.b===0&&u.c===0&&u.d===1&&u.e===0&&u.f===0)),l&&transformBoundsWithMatrix(e,e,u)}validCheck(r,e,i,n){if(!n||r.forceBoundsHeight!=null||r.forceBoundsWidth!=null||n.shadowRoot||n.isContainer)return!0;const{visible:o=e.visible}=r;return!(!n.valid||!o)||(i.empty()||(n.parent&&i.transformWithMatrix(n.parent.globalTransMatrix),application.graphicService.clearAABBBounds(n,n.stage,i),i.clear()),!1)}updateTempAABBBounds(r){const e=this.tempAABBBounds1,i=this.tempAABBBounds2;return e.setValue(r.x1,r.y1,r.x2,r.y2),i.setValue(r.x1,r.y1,r.x2,r.y2),{tb1:e,tb2:i}}};DefaultGraphicService=__decorate$15([injectable(),__param$F(0,inject(GraphicCreator$1)),__metadata$P("design:paramtypes",[Object])],DefaultGraphicService);const result={x:0,y:0,z:0,lastModelMatrix:null};class BaseRender{init(e){e&&(this._renderContribitions=e.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions&&this.builtinContributions.forEach(i=>this._renderContribitions.push(i)),this._renderContribitions.length&&(this._renderContribitions.sort((i,n)=>n.order-i.order),this._beforeRenderContribitions=this._renderContribitions.filter(i=>i.time===BaseRenderContributionTime.beforeFillStroke),this._afterRenderContribitions=this._renderContribitions.filter(i=>i.time===BaseRenderContributionTime.afterFillStroke))}beforeRenderStep(e,i,n,o,l,u,d,f,g,_,y,b,S){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach(v=>{v.supportedAppName&&e.stage&&e.stage.params&&e.stage.params.context&&e.stage.params.context.appName&&!(Array.isArray(v.supportedAppName)?v.supportedAppName:[v.supportedAppName]).includes(e.stage.params.context.appName)||v.drawShape(e,i,n,o,l,u,d,f,g,_,y,b,S)})}afterRenderStep(e,i,n,o,l,u,d,f,g,_,y,b,S){this._afterRenderContribitions&&this._afterRenderContribitions.forEach(v=>{v.supportedAppName&&e.stage&&e.stage.params&&e.stage.params.context&&e.stage.params.context.appName&&!(Array.isArray(v.supportedAppName)?v.supportedAppName:[v.supportedAppName]).includes(e.stage.params.context.appName)||v.drawShape(e,i,n,o,l,u,d,f,g,_,y,b,S)})}valid(e,i,n,o){const{fill:l=i.fill,background:u,stroke:d=i.stroke,opacity:f=i.opacity,fillOpacity:g=i.fillOpacity,lineWidth:_=i.lineWidth,strokeOpacity:y=i.strokeOpacity,visible:b=i.visible}=e.attribute,S=fillVisible(f,g,l),v=strokeVisible(f,y),A=runFill(l,u),x=runStroke(d,_);return!(!e.valid||!b)&&!(!A&&!x)&&!!(S||v||n||o||u)&&{fVisible:S,sVisible:v,doFill:A,doStroke:x}}transform(e,i,n,o=!1){const{x:l=i.x,y:u=i.y,z:d=i.z,scaleX:f=i.scaleX,scaleY:g=i.scaleY,angle:_=i.angle,postMatrix:y}=e.attribute,b=n.modelMatrix,S=n.camera;result.x=l,result.y=u,result.z=d,result.lastModelMatrix=b;const v=S&&(o||shouldUseMat4(e)),A=v?e.transMatrix.onlyTranslate()&&!y:f===1&&g===1&&_===0&&!y;if(v){const x=mat4Allocate.allocate(),T=mat4Allocate.allocate();getModelMatrix(T,e,i),multiplyMat4Mat4(x,b||x,T),result.x=0,result.y=0,result.z=0,n.modelMatrix=x,n.setTransform(1,0,0,1,0,0,!0),mat4Allocate.free(T)}if(A&&!b){const x=e.getOffsetXY(i);result.x+=x.x,result.y+=x.y,result.z=d,n.setTransformForCurrent()}else if(v)result.x=0,result.y=0,result.z=0,n.setTransform(1,0,0,1,0,0,!0);else if(S&&n.project){const x=e.getOffsetXY(i);result.x+=x.x,result.y+=x.y,this.transformWithoutTranslate(n,result.x,result.y,result.z,f,g,_)}else n.transformFromMatrix(e.transMatrix,!0),result.x=0,result.y=0,result.z=0;return result}transformUseContext2d(e,i,n,o){const l=o.camera;if(this.camera=l,l){const u=e.AABBBounds,d=u.x2-u.x1,f=u.y2-u.y1,g=o.project(0,0,n),_=o.project(d,0,n),y=o.project(d,f,n),b={x:0,y:0},S={x:d,y:0},v={x:d,y:f};o.camera=null;const A=1/(b.x*(v.y-S.y)-S.x*v.y+v.x*S.y+(S.x-v.x)*b.y),x=-(b.y*(y.x-_.x)-S.y*y.x+v.y*_.x+(S.y-v.y)*g.x)*A,T=(S.y*y.y+b.y*(_.y-y.y)-v.y*_.y+(v.y-S.y)*g.y)*A,C=(b.x*(y.x-_.x)-S.x*y.x+v.x*_.x+(S.x-v.x)*g.x)*A,E=-(S.x*y.y+b.x*(_.y-y.y)-v.x*_.y+(v.x-S.x)*g.y)*A,P=(b.x*(v.y*_.x-S.y*y.x)+b.y*(S.x*y.x-v.x*_.x)+(v.x*S.y-S.x*v.y)*g.x)*A,L=(b.x*(v.y*_.y-S.y*y.y)+b.y*(S.x*y.y-v.x*_.y)+(v.x*S.y-S.x*v.y)*g.y)*A;o.setTransform(x,T,C,E,P,L,!0)}}restoreTransformUseContext2d(e,i,n,o){this.camera&&(o.camera=this.camera)}transformWithoutTranslate(e,i,n,o,l,u,d){const f=e.project(i,n,o);e.translate(f.x,f.y,!1),e.scale(l,u,!1),e.rotate(d,!1),e.translate(-f.x,-f.y,!1),e.setTransformForCurrent()}_draw(e,i,n,o,l){const{context:u}=o;if(!u)return;const{renderable:d}=e.attribute;if(d===!1)return;u.highPerformanceSave();const f=this.transform(e,i,u,n),{x:g,y:_,z:y,lastModelMatrix:b}=f;this.z=y,drawPathProxy(e,u,g,_,o,l)||(this.drawShape(e,u,g,_,o,l),this.z=0,u.modelMatrix!==b&&mat4Allocate.free(u.modelMatrix),u.modelMatrix=b),u.highPerformanceRestore()}}var __decorate$14=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$O=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$E=function(r,e){return function(i,n){e(i,n,r)}};class DefaultBaseBackgroundRenderContribution{constructor(){this.time=BaseRenderContributionTime.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(e,i,n,o,l,u,d,f,g,_,y,b,S){var v;const{background:A,backgroundOpacity:x=(v=e.attribute.fillOpacity)!==null&&v!==void 0?v:g.backgroundOpacity,opacity:T=g.opacity,backgroundMode:C=g.backgroundMode,backgroundFit:E=g.backgroundFit}=e.attribute;if(A)if(e.backgroundImg&&e.resources){const P=e.resources.get(A);if(P.state!=="success"||!P.data)return;if(i.save(),e.parent&&!e.transMatrix.onlyTranslate()){const R=getTheme$1(e.parent).group,{scrollX:w=R.scrollX,scrollY:D=R.scrollY}=e.parent.attribute;i.setTransformFromMatrix(e.parent.globalTransMatrix,!0),i.translate(w,D)}i.clip();const L=e.AABBBounds;i.setCommonStyle(e,e.attribute,n,o,g),i.globalAlpha=x*T,this.doDrawImage(i,P.data,L,C,E),i.restore(),e.transMatrix.onlyTranslate()||i.setTransformForCurrent()}else i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,n,o,g),i.globalAlpha=x*T,i.fillStyle=A,i.fill(),i.highPerformanceRestore()}doDrawImage(e,i,n,o,l){if(o==="no-repeat")e.drawImage(i,n.x1,n.y1,n.width(),n.height());else{const u=n.width(),d=n.height();let f=u,g=d;if(l&&o!=="repeat"&&(i.width||i.height)){const b=i.width,S=i.height;o==="repeat-x"?(f=b*(d/S),g=d):o==="repeat-y"&&(g=S*(u/b),f=u);const v=e.dpr,A=canvasAllocate.allocate({width:f,height:g,dpr:v}),x=A.getContext("2d");x&&(x.inuse=!0,x.clearMatrix(),x.setTransformForCurrent(!0),x.clearRect(0,0,f,g),x.drawImage(i,0,0,f,g),i=A.nativeCanvas),canvasAllocate.free(A)}const _=e.dpr,y=e.createPattern(i,o);y.setTransform&&y.setTransform(new DOMMatrix([1/_,0,0,1/_,0,0])),e.fillStyle=y,e.translate(n.x1,n.y1),e.fillRect(0,0,u,d),e.translate(-n.x1,-n.y1)}}}const defaultBaseBackgroundRenderContribution=new DefaultBaseBackgroundRenderContribution;let DefaultBaseInteractiveRenderContribution=class{constructor(r){this.subRenderContribitions=r,this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(r,e,i,n,o,l,u,d,f,g,_,y,b){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach(S=>{S.render(r,e,i,n,o,l,u,d,f,g,_,y,b)})}};DefaultBaseInteractiveRenderContribution=__decorate$14([injectable(),__param$E(0,inject(ContributionProvider)),__param$E(0,named(InteractiveSubRenderContribution)),__metadata$O("design:paramtypes",[Object])],DefaultBaseInteractiveRenderContribution);class DefaultBaseTextureRenderContribution{constructor(){this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=10}createCommonPattern(e,i,n,o,l){const u=(e-2*i)/2,d=o.dpr,f=canvasAllocate.allocate({width:e,height:e,dpr:d}),g=f.getContext("2d");if(!g)return null;g.inuse=!0,g.clearMatrix(),g.setTransformForCurrent(!0),g.clearRect(0,0,e,e),l(u,g);const _=o.createPattern(f.nativeCanvas,"repeat");return _.setTransform&&_.setTransform(new DOMMatrix([1/d,0,0,1/d,0,0])),canvasAllocate.free(f),_}createCirclePattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{u.fillStyle=n,u.arc(l,l,l,0,pi2),u.fill()})}createDiamondPattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{const d=e/2,f=d;u.fillStyle=n,u.moveTo(d,f-l),u.lineTo(l+d,f),u.lineTo(d,f+l),u.lineTo(d-l,f),u.closePath(),u.fill()})}createRectPattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{const d=i,f=d;u.fillStyle=n,u.fillRect(d,f,2*l,2*l)})}createVerticalLinePattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{const d=i;u.fillStyle=n,u.fillRect(d,0,2*l,e)})}createHorizontalLinePattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{const d=i;u.fillStyle=n,u.fillRect(0,d,e,2*l)})}createBiasLRLinePattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{u.strokeStyle=n,u.lineWidth=l,u.moveTo(0,0),u.lineTo(e,e);const d=e/2,f=-d;u.moveTo(d,f),u.lineTo(d+e,f+e),u.moveTo(-d,-f),u.lineTo(-d+e,-f+e),u.stroke()})}createBiasRLLinePattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{u.strokeStyle=n,u.lineWidth=l,u.moveTo(e,0),u.lineTo(0,e);const d=e/2,f=d;u.moveTo(e+d,f),u.lineTo(d,f+e),u.moveTo(e-d,-f),u.lineTo(-d,-f+e),u.stroke()})}createGridPattern(e,i,n,o){return this.createCommonPattern(e,i,n,o,(l,u)=>{const d=i,f=d;u.fillStyle=n,u.fillRect(d,f,l,l),u.fillRect(d+l,f+l,l,l)})}initTextureMap(e,i){this.textureMap=new Map}drawShape(e,i,n,o,l,u,d,f,g,_,y,b,S){this.textureMap||this.initTextureMap(i,e.stage);const{texture:v=g.texture,textureColor:A=g.textureColor,textureSize:x=g.textureSize,texturePadding:T=g.texturePadding}=e.attribute;v&&this.drawTexture(v,e,i,n,o,g,A,x,T)}drawTexture(e,i,n,o,l,u,d,f,g){let _=this.textureMap.get(e);if(!_)switch(e){case"circle":_=this.createCirclePattern(f,g,d,n);break;case"diamond":_=this.createDiamondPattern(f,g,d,n);break;case"rect":_=this.createRectPattern(f,g,d,n);break;case"vertical-line":_=this.createVerticalLinePattern(f,g,d,n);break;case"horizontal-line":_=this.createHorizontalLinePattern(f,g,d,n);break;case"bias-lr":_=this.createBiasLRLinePattern(f,g,d,n);break;case"bias-rl":_=this.createBiasRLLinePattern(f,g,d,n);break;case"grid":_=this.createGridPattern(f,g,d,n)}_&&(n.highPerformanceSave(),n.setCommonStyle(i,i.attribute,o,l,u),n.fillStyle=_,n.fill(),n.highPerformanceRestore())}}const defaultBaseTextureRenderContribution=new DefaultBaseTextureRenderContribution;class DefaultArcRenderContribution{constructor(){this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,i,n,o,l,u,d,f,g,_,y,b){const{outerBorder:S,innerBorder:v}=e.attribute,A=S&&S.visible!==!1,x=v&&v.visible!==!1;if(!A&&!x)return;const{innerPadding:T=g.innerPadding,outerPadding:C=g.outerPadding,startAngle:E=g.startAngle,endAngle:P=g.endAngle,opacity:L=g.opacity,x:R=g.x,y:w=g.y,scaleX:D=g.scaleX,scaleY:I=g.scaleY,keepStrokeScale:O=g.keepStrokeScale}=e.attribute;let{innerRadius:B=g.innerRadius,outerRadius:N=g.outerRadius}=e.attribute;N+=C,B-=T;const $=(H,F)=>{const V=!(!H||!H.stroke),{distance:G=g[F].distance}=H,Y=O?G:getScaledStroke(i,G,i.dpr),J=G/N,q=F==="outerBorder"?1:-1;if(e.setAttributes({outerRadius:N+q*Y,innerRadius:B-q*Y,startAngle:E-q*J,endAngle:P+q*J}),i.beginPath(),drawArcPath$1(e,i,n,o,N+q*Y,B-q*Y),i.setShadowBlendStyle&&i.setShadowBlendStyle(e,e.attribute,g),b)b(i,H,g[F]);else if(V){const te=g[F].opacity;g[F].opacity=L,i.setStrokeStyle(e,H,(R-n)/D,(w-o)/I,g[F]),g[F].opacity=te,i.stroke()}};A&&$(S,"outerBorder"),x&&$(v,"innerBorder"),e.setAttributes({outerRadius:N,innerRadius:B,startAngle:E,endAngle:P})}}const defaultArcRenderContribution=new DefaultArcRenderContribution,defaultArcTextureRenderContribution=defaultBaseTextureRenderContribution,defaultArcBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;class DefaultCircleRenderContribution{constructor(){this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,i,n,o,l,u,d,f,g,_,y,b){const{outerBorder:S,innerBorder:v}=e.attribute,A=S&&S.visible!==!1,x=v&&v.visible!==!1;if(!A&&!x)return;const{radius:T=g.radius,startAngle:C=g.startAngle,endAngle:E=g.endAngle,opacity:P=g.opacity,x:L=g.x,y:R=g.y,scaleX:w=g.scaleX,scaleY:D=g.scaleY,keepStrokeScale:I=g.keepStrokeScale}=e.attribute,O=(B,N)=>{const $=!(!B||!B.stroke),{distance:H=g[N].distance}=B,F=I?H:getScaledStroke(i,H,i.dpr),V=N==="outerBorder"?1:-1;if(i.beginPath(),i.arc(n,o,T+V*F,C,E),i.closePath(),i.setShadowBlendStyle&&i.setShadowBlendStyle(e,e.attribute,g),b)b(i,B,g[N]);else if($){const G=g[N].opacity;g[N].opacity=P,i.setStrokeStyle(e,B,(L-n)/w,(R-o)/D,g[N]),g[N].opacity=G,i.stroke()}};A&&O(S,"outerBorder"),x&&O(v,"innerBorder")}}const defaultCircleRenderContribution=new DefaultCircleRenderContribution,defaultCircleTextureRenderContribution=defaultBaseTextureRenderContribution,defaultCircleBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;class DefaultGroupBackgroundRenderContribution extends DefaultBaseBackgroundRenderContribution{constructor(){super(...arguments),this.time=BaseRenderContributionTime.beforeFillStroke}drawShape(e,i,n,o,l,u,d,f,g,_,y,b){const{background:S,backgroundMode:v=g.backgroundMode,backgroundFit:A=g.backgroundFit}=e.attribute;if(S)if(e.backgroundImg&&e.resources){const x=e.resources.get(S);if(x.state!=="success"||!x.data)return;i.highPerformanceSave(),i.setTransformFromMatrix(e.parent.globalTransMatrix,!0);const T=e.AABBBounds;this.doDrawImage(i,x.data,T,v,A),i.highPerformanceRestore(),i.setTransformForCurrent()}else i.highPerformanceSave(),i.fillStyle=S,i.fill(),i.highPerformanceRestore()}}const defaultGroupBackgroundRenderContribution=new DefaultGroupBackgroundRenderContribution,halfPi=pi$1/2;function createRectPath(r,e,i,n,o,l,u){let d;if(n<0&&(e+=n,n=-n),o<0&&(i+=o,o=-o),isNumber(l,!0))d=[l=abs$1(l),l,l,l];else if(Array.isArray(l)){const R=l;let w,D;switch(R.length){case 0:d=[0,0,0,0];break;case 1:w=abs$1(R[0]),d=[w,w,w,w];break;case 2:case 3:w=abs$1(R[0]),D=abs$1(R[1]),d=[w,D,w,D];break;default:d=R,d[0]=abs$1(d[0]),d[1]=abs$1(d[1]),d[2]=abs$1(d[2]),d[3]=abs$1(d[3])}}else d=[0,0,0,0];if(n<0||d[0]+d[1]+d[2]+d[3]<1e-12)return r.rect(e,i,n,o);const[f,g,_,y]=[[e,i],[e+n,i],[e+n,i+o],[e,i+o]],b=Math.min(n/2,o/2),S=[Math.min(b,d[0]),Math.min(b,d[1]),Math.min(b,d[2]),Math.min(b,d[3])],v=[f[0]+S[0],f[1]],A=[f[0],f[1]+S[0]],x=[g[0]-S[1],g[1]],T=[g[0],g[1]+S[1]],C=[_[0]-S[2],_[1]],E=[_[0],_[1]-S[2]],P=[y[0]+S[3],y[1]],L=[y[0],y[1]-S[3]];if(r.moveTo(v[0],v[1]),u&&u[0]?u[0](v[0],v[1],x[0],x[1]):r.lineTo(x[0],x[1]),!arrayEqual(x,T)){u&&u[0]&&r.moveTo(x[0],x[1]);const R=x[0],w=x[1]+S[1];r.arc(R,w,S[1],-halfPi,0,!1)}if(u&&u[1]?u[1](T[0],T[1],E[0],E[1]):r.lineTo(E[0],E[1]),!arrayEqual(C,E)){const R=E[0]-S[2],w=E[1];u&&u[1]&&r.moveTo(E[0],E[1]),r.arc(R,w,S[2],0,halfPi,!1)}if(u&&u[2]?u[2](C[0],C[1],P[0],P[1]):r.lineTo(P[0],P[1]),!arrayEqual(P,L)){const R=P[0],w=P[1]-S[3];u&&u[2]&&r.moveTo(P[0],P[1]),r.arc(R,w,S[3],halfPi,pi$1,!1)}if(u&&u[3]?u[3](L[0],L[1],A[0],A[1]):r.lineTo(A[0],A[1]),!arrayEqual(v,A)){const R=v[0],w=v[1]+S[0];u&&u[3]&&r.moveTo(A[0],A[1]),r.arc(R,w,S[0],pi$1,pi$1+halfPi,!1)}return!u&&r.closePath(),r}var __decorate$13=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};class DefaultRectRenderContribution{constructor(){this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,i,n,o,l,u,d,f,g,_,y,b){const{outerBorder:S,innerBorder:v}=e.attribute,A=S&&S.visible!==!1,x=v&&v.visible!==!1;if(!A&&!x)return;const{cornerRadius:T=g.cornerRadius,opacity:C=g.opacity,x:E=g.x,y:P=g.y,scaleX:L=g.scaleX,scaleY:R=g.scaleY,x1:w,y1:D,keepStrokeScale:I=g.keepStrokeScale}=e.attribute;let{width:O,height:B}=e.attribute;O=(O??w-n)||0,B=(B??D-o)||0;const N=($,H)=>{const F=!(!$||!$.stroke),V=H==="outerBorder"?-1:1,{distance:G=g[H].distance}=$,Y=I?G:getScaledStroke(i,G,i.dpr),J=n+V*Y,q=o+V*Y,te=2*Y;if(T===0||isArray(T)&&T.every(de=>de===0)?(i.beginPath(),i.rect(J,q,O-V*te,B-V*te)):(i.beginPath(),createRectPath(i,J,q,O-V*te,B-V*te,T)),i.setShadowBlendStyle&&i.setShadowBlendStyle(e,e.attribute,g),b)b(i,$,g[H]);else if(F){const de=g[H].opacity;g[H].opacity=C,i.setStrokeStyle(e,$,(E-n)/L,(P-o)/R,g[H]),g[H].opacity=de,i.stroke()}};A&&N(S,"outerBorder"),x&&N(v,"innerBorder")}}let SplitRectBeforeRenderContribution=class{constructor(){this.time=BaseRenderContributionTime.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(r,e,i,n,o,l,u,d,f,g,_,y,b){const{stroke:S=f.stroke}=r.attribute;Array.isArray(S)&&S.some(v=>v===!1)&&(b.doStroke=!1)}};SplitRectBeforeRenderContribution=__decorate$13([injectable()],SplitRectBeforeRenderContribution);let SplitRectAfterRenderContribution=class{constructor(){this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(r,e,i,n,o,l,u,d,f,g,_,y){const{x1:b,y1:S,x:v=f.x,y:A=f.y,stroke:x=f.stroke,cornerRadius:T=f.cornerRadius}=r.attribute;let{width:C,height:E}=r.attribute;if(C=(C??b-v)||0,E=(E??S-A)||0,Array.isArray(x)&&x.some(P=>P===!1)){if(e.setStrokeStyle(r,r.attribute,i,n,f),!(T===0||isArray(T)&&T.every(P=>P===0))){let P,L=0;return createRectPath(e,i,n,C,E,T,new Array(4).fill(0).map((R,w)=>(D,I,O,B)=>{x[w]&&(L===w-1&&x[w]===P||(e.setStrokeStyle(r,Object.assign(Object.assign({},r.attribute),{stroke:x[w]}),i,n,f),e.beginPath(),e.moveTo(D,I),P=x[w]),L=w,e.lineTo(O,B),e.stroke(),w===3&&e.beginPath())})),void e.stroke()}if(e.beginPath(),e.moveTo(i,n),x[0]?e.lineTo(i+C,n):e.moveTo(i+C,n),x[1]?e.lineTo(i+C,n+E):e.moveTo(i+C,n+E),x[2]?e.lineTo(i,n+E):e.moveTo(i,n+E),x[3]){const P=x[0]?n-e.lineWidth/2:n;e.lineTo(i,P)}else e.moveTo(i,n);e.stroke()}}};SplitRectAfterRenderContribution=__decorate$13([injectable()],SplitRectAfterRenderContribution);const defaultRectRenderContribution=new DefaultRectRenderContribution,defaultRectTextureRenderContribution=defaultBaseTextureRenderContribution,defaultRectBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;class DefaultImageRenderContribution extends DefaultRectRenderContribution{constructor(){super(...arguments),this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,i,n,o,l,u,d,f,g,_,y,b){return super.drawShape(e,i,n,o,l,u,d,f,g,_,y,b)}}const defaultImageRenderContribution=new DefaultImageRenderContribution,defaultImageBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;class DefaultSymbolRenderContribution{constructor(){this.time=BaseRenderContributionTime.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(e,i,n,o,l,u,d,f,g,_,y,b){const S=e.getParsedPath();if(!S)return;const{outerBorder:v,innerBorder:A}=e.attribute,x=v&&v.visible!==!1,T=A&&A.visible!==!1;if(!x&&!T)return;const{size:C=g.size,opacity:E=g.opacity,x:P=g.x,y:L=g.y,scaleX:R=g.scaleX,scaleY:w=g.scaleY,keepStrokeScale:D=g.keepStrokeScale}=e.attribute,I=(O,B)=>{const N=!(!O||!O.stroke),{distance:$=g[B].distance}=O,H=D?$:getScaledStroke(i,$,i.dpr),F=B==="outerBorder"?1:-1;if(i.beginPath(),S.drawOffset(i,C,n,o,F*H)===!1&&i.closePath(),i.setShadowBlendStyle&&i.setShadowBlendStyle(e,e.attribute,g),b)b(i,O,g[B]);else if(N){const V=g[B].opacity;g[B].opacity=E,i.setStrokeStyle(e,O,(P-n)/R,(L-o)/w,g[B]),g[B].opacity=V,i.stroke()}};x&&I(v,"outerBorder"),T&&I(A,"innerBorder")}}const defaultSymbolRenderContribution=new DefaultSymbolRenderContribution,defaultSymbolTextureRenderContribution=defaultBaseTextureRenderContribution,defaultSymbolBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;class DefaultAreaTextureRenderContribution extends DefaultBaseTextureRenderContribution{constructor(){super(...arguments),this.time=BaseRenderContributionTime.afterFillStroke}drawShape(e,i,n,o,l,u,d,f,g,_,y,b,S){var v,A,x,T;this.textureMap||this.initTextureMap(i,e.stage);const{attribute:C=e.attribute}=S||{},{texture:E=(v=e.attribute.texture)!==null&&v!==void 0?v:getAttributeFromDefaultAttrList(g,"texture"),textureColor:P=(A=e.attribute.textureColor)!==null&&A!==void 0?A:getAttributeFromDefaultAttrList(g,"textureColor"),textureSize:L=(x=e.attribute.textureSize)!==null&&x!==void 0?x:getAttributeFromDefaultAttrList(g,"textureSize"),texturePadding:R=(T=e.attribute.texturePadding)!==null&&T!==void 0?T:getAttributeFromDefaultAttrList(g,"texturePadding")}=C;E&&this.drawTexture(E,e,i,n,o,g,P,L,R)}}var __decorate$12=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$N=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$D=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasArcRender=class extends BaseRender{constructor(r){super(),this.arcRenderContribitions=r,this.numberType=ARC_NUMBER_TYPE,this.builtinContributions=[defaultArcRenderContribution,defaultArcBackgroundRenderContribution,defaultArcTextureRenderContribution],this.init(r)}drawArcTailCapPath(r,e,i,n,o,l,u,d){const f=d-u,g=r.getParsedAngle(),_=g.startAngle;let y=g.endAngle;y=d;const b=y>_;let S=!1;if(o<l){const V=o;o=l,l=V}const{xors:v,yors:A,xirs:x,yirs:T,limitedOcr:C,outerCornerRadiusStart:E,outerCornerRadiusEnd:P,maxOuterCornerRadius:L,xore:R,yore:w,xire:D,yire:I,limitedIcr:O,innerDeltaAngle:B,innerStartAngle:N,innerCornerRadiusStart:$,innerCornerRadiusEnd:H,maxInnerCornerRadius:F}=calculateArcCornerRadius(r,_,y,l,o);if(C>epsilon$1){const V=min$1(E,C),G=min$1(P,C),Y=cornerTangents(x,T,v,A,o,V,Number(b)),J=cornerTangents(R,w,D,I,o,G,Number(b));if(C<L&&V===G)e.moveTo(i+Y.cx+Y.x01,n+Y.cy+Y.y01),e.arc(i+Y.cx,n+Y.cy,C,atan2$1(Y.y01,Y.x01),atan2$1(J.y01,J.x01),!b);else{const q=y-f-.03,te=atan2$1(J.y11,J.x11);e.arc(i,n,o,q,te,!b),G>0&&e.arc(i+J.cx,n+J.cy,G,atan2$1(J.y11,J.x11),atan2$1(J.y01,J.x01),!b)}}else e.moveTo(i+v,n+A);if(!(l>epsilon$1)||B<.001)e.lineTo(i+D,n+I),S=!0;else if(O>epsilon$1){const V=min$1($,O),G=min$1(H,O),Y=cornerTangents(D,I,R,w,l,-G,Number(b)),J=cornerTangents(v,A,x,T,l,-V,Number(b));if(e.lineTo(i+Y.cx+Y.x01,n+Y.cy+Y.y01),O<F&&V===G){const q=atan2$1(J.y01,J.x01);e.arc(i+Y.cx,n+Y.cy,O,atan2$1(Y.y01,Y.x01),q,!b)}else{G>0&&e.arc(i+Y.cx,n+Y.cy,G,atan2$1(Y.y01,Y.x01),atan2$1(Y.y11,Y.x11),!b);const q=atan2$1(Y.cy+Y.y11,Y.cx+Y.x11),te=y-f-.03;e.arc(i,n,l,q,te,b)}}else e.lineTo(i+l*cos$1(N),n+l*sin$1(N));return S}drawShape(r,e,i,n,o,l,u,d){const f=getTheme$1(r,l==null?void 0:l.theme).arc,{fill:g=f.fill,stroke:_=f.stroke,x:y=f.x,y:b=f.y,fillStrokeOrder:S=f.fillStrokeOrder}=r.attribute,v=this.valid(r,f,u,d);if(!v)return;const{fVisible:A,sVisible:x,doFill:T,doStroke:C}=v,{outerPadding:E=f.outerPadding,innerPadding:P=f.innerPadding,cap:L=f.cap,forceShowCap:R=f.forceShowCap}=r.attribute;let{outerRadius:w=f.outerRadius,innerRadius:D=f.innerRadius}=r.attribute;w+=E,D-=P;let I=0;const O=(isBoolean(L)&&L||L[0])&&g.gradient==="conical";if(O){const{sc:H,startAngle:F,endAngle:V}=r.getParsedAngle();abs$1(V-F)<pi2-epsilon$1&&(I=H||0,g.startAngle-=I,g.endAngle-=I)}let B=!1;const{isFullStroke:N,stroke:$}=parseStroke(_);if(T||N){e.beginPath(),drawArcPath$1(r,e,i,n,w,D),B=!0,e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f),this.beforeRenderStep(r,e,i,n,T,C,A,x,f,o,u,d);const H=()=>{T&&(u?u(e,r.attribute,f):A&&(e.setCommonStyle(r,r.attribute,y-i,b-n,f),e.fill()))},F=()=>{C&&N&&(d?d(e,r.attribute,f):x&&(e.setStrokeStyle(r,r.attribute,y-i,b-n,f),e.stroke()))};S?(F(),H()):(H(),F())}if(!N&&C&&(e.beginPath(),drawArcPath$1(r,e,i,n,w,D,$),B||this.beforeRenderStep(r,e,i,n,T,C,A,x,f,o,u,d),d?d(e,r.attribute,f):x&&(e.setStrokeStyle(r,r.attribute,i,n,f),e.stroke())),(isBoolean(L)&&L||L[1])&&R){const{startAngle:H,endAngle:F}=r.getParsedAngle();if(abs$1(F-H)>=pi2-epsilon$1){e.beginPath();const V=Math.abs(w-D)/2/w,{endAngle:G=f.endAngle,fill:Y=f.fill}=r.attribute,J=G;this.drawArcTailCapPath(r,e,i,n,w,D,J,J+V),B||this.beforeRenderStep(r,e,i,n,T,C,A,x,f,o,u,d);const q=()=>{if(T){const de=Y;if(de.gradient==="conical"){const he=getConicGradientAt(0,0,G,de);u||fillVisible&&(e.setCommonStyle(r,r.attribute,i,n,f),e.fillStyle=he,e.fill())}}},te=()=>{C&&(d||x&&(e.setStrokeStyle(r,r.attribute,i,n,f),e.stroke()))};q(),te()}}this.afterRenderStep(r,e,i,n,T,C,A,x,f,o,u,d),O&&(g.startAngle+=I,g.endAngle+=I)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).arc;this._draw(r,o,!1,i,n)}};DefaultCanvasArcRender=__decorate$12([injectable(),__param$D(0,inject(ContributionProvider)),__param$D(0,named(ArcRenderContribution)),__metadata$N("design:paramtypes",[Object])],DefaultCanvasArcRender);var __decorate$11=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$M=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$C=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasCircleRender=class extends BaseRender{constructor(r){super(),this.circleRenderContribitions=r,this.numberType=CIRCLE_NUMBER_TYPE,this.builtinContributions=[defaultCircleRenderContribution,defaultCircleBackgroundRenderContribution,defaultCircleTextureRenderContribution],this.init(r)}drawShape(r,e,i,n,o,l,u,d){const f=getTheme$1(r,l==null?void 0:l.theme).circle,{radius:g=f.radius,startAngle:_=f.startAngle,endAngle:y=f.endAngle,x:b=f.x,y:S=f.y,fillStrokeOrder:v=f.fillStrokeOrder}=r.attribute,A=this.valid(r,f,u,d);if(!A)return;const{fVisible:x,sVisible:T,doFill:C,doStroke:E}=A;e.beginPath(),e.arc(i,n,g,_,y),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f),this.beforeRenderStep(r,e,i,n,C,E,x,T,f,o,u,d);const P=()=>{C&&(u?u(e,r.attribute,f):x&&(e.setCommonStyle(r,r.attribute,b-i,S-n,f),e.fill()))},L=()=>{E&&(d?d(e,r.attribute,f):T&&(e.setStrokeStyle(r,r.attribute,b-i,S-n,f),e.stroke()))};v?(L(),P()):(P(),L()),this.afterRenderStep(r,e,i,n,C,E,x,T,f,o,u,d)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).circle;this._draw(r,o,!1,i,n)}};DefaultCanvasCircleRender=__decorate$11([injectable(),__param$C(0,inject(ContributionProvider)),__param$C(0,named(CircleRenderContribution)),__metadata$M("design:paramtypes",[Object])],DefaultCanvasCircleRender);function drawSegItem(r,e,i,n){if(!e.p1)return;const{offsetX:o=0,offsetY:l=0,offsetZ:u=0}=n||{};if(i===1)e.p2&&e.p3?r.bezierCurveTo(o+e.p1.x,l+e.p1.y,o+e.p2.x,l+e.p2.y,o+e.p3.x,l+e.p3.y,u):r.lineTo(o+e.p1.x,l+e.p1.y,u);else if(e.p2&&e.p3){const[d]=divideCubic(e,i);r.bezierCurveTo(o+d.p1.x,l+d.p1.y,o+d.p2.x,l+d.p2.y,o+d.p3.x,l+d.p3.y,u)}else{const d=e.getPointAt(i);r.lineTo(o+d.x,l+d.y,u)}}function drawEachCurve(r,e,i,n,o,l,u){var d;let f=e.p0,g=n;if(i&&i.originP1===i.originP2&&(f=i.p0),e.defined)n||(r.lineTo(f.x+o,f.y+l,u),g=!n);else{const{originP1:_,originP2:y}=e;let b;if(_&&_.defined!==!1&&!i?b=f:_&&y.defined!==!1&&(b=(d=e.p3)!==null&&d!==void 0?d:e.p1),n){g=!n;const S=b?b.x:e.p0.x,v=b?b.y:e.p0.y;r.moveTo(S+o,v+l,u)}else b&&(g=!n,r.lineTo(b.x+o,b.y+l,u))}return g}function drawSegments(r,e,i,n,o){const{offsetX:l=0,offsetY:u=0,offsetZ:d=0,mode:f="none",drawConnect:g=!1}=o||{};if(g&&f==="none"||!e)return;let _=!0;const{curves:y}=e;if(i>=1){if(g){let T,C=!0;y.forEach((E,P)=>{E.originP1!==E.originP2&&(C=drawEachCurve(r,E,T,C,l,u,d)),T=E})}else y.forEach(T=>{T.defined?(_&&r.moveTo(T.p0.x+l,T.p0.y+u,d),drawSegItem(r,T,1,o),_=!1):_=!0});return}if(i<=0)return;let b;n==="x"?b=Direction$1.ROW:n==="y"?b=Direction$1.COLUMN:n==="auto"&&(b=e.direction);const S=i*e.tryUpdateLength(b);let v=0,A=!0,x=null;for(let T=0,C=y.length;T<C;T++){const E=y[T],P=E.getLength(b),L=(S-v)/P;if(v+=P,L<0)break;if(g){if(E.originP1===E.originP2){x=E;continue}A=drawEachCurve(r,E,x,A,l,u,d),x=E}else{if(!E.defined){_=!0;continue}_&&r.moveTo(E.p0.x+l,E.p0.y+u,d),drawSegItem(r,E,min$1(L,1),o),_=!1}}}function drawIncrementalSegments(r,e,i,n){const{offsetX:o=0,offsetY:l=0}=n||{},u=e?e.points[e.points.length-1]:i.points[0];r.moveTo(u.x+o,u.y+l),i.points.forEach(d=>{d.defined!==!1?r.lineTo(d.x+o,d.y+l):r.moveTo(d.x+o,d.y+l)})}function drawIncrementalAreaSegments(r,e,i,n){const{offsetX:o=0,offsetY:l=0}=n||{},{points:u}=i,d=[];for(let f=0;f<u.length;f++)u[f].defined;d.push(u),d.forEach((f,g)=>{var _,y,b,S;const v=e&&g===0?e.points[e.points.length-1]:f[0];r.moveTo(v.x+o,v.y+l),f.forEach(A=>{A.defined!==!1?r.lineTo(A.x+o,A.y+l):r.moveTo(A.x+o,A.y+l)});for(let A=f.length-1;A>=0;A--){const x=f[A];r.lineTo((_=x.x1)!==null&&_!==void 0?_:x.x,(y=x.y1)!==null&&y!==void 0?y:x.y)}r.lineTo((b=v.x1)!==null&&b!==void 0?b:v.x,(S=v.y1)!==null&&S!==void 0?S:v.y),r.closePath()})}var __decorate$10=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultCanvasLineRender=class extends BaseRender{constructor(){super(...arguments),this.numberType=LINE_NUMBER_TYPE}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).line;this._draw(r,o,!1,i,n)}drawSegmentItem(r,e,i,n,o,l,u,d,f,g,_,y,b,S,v){var A;if(!e)return;r.beginPath();const x=(A=this.z)!==null&&A!==void 0?A:0;drawSegments(r.camera?r:r.nativeContext,e,f,g,{offsetX:_,offsetY:y,offsetZ:x}),b.cache&&!isArray(b.cache)&&b.cache.curves.every(E=>E.defined)&&b.attribute.curveType&&b.attribute.curveType.includes("Closed")&&r.closePath(),r.setShadowBlendStyle&&r.setShadowBlendStyle(b,u,d);const{x:T=0,x:C=0}=u;return i!==!1&&(S?S(r,u,d):o&&(r.setCommonStyle(b,u,T-_,C-y,d),r.fill())),n!==!1&&(v?v(r,u,d):l&&(r.setStrokeStyle(b,u,T-_,C-y,d),r.stroke())),!1}drawLinearLineHighPerformance(r,e,i,n,o,l,u,d,f,g,_,y,b){var S;e.beginPath();const v=(S=this.z)!==null&&S!==void 0?S:0,{points:A}=r.attribute,x=A[0];e.moveTo(x.x+u,x.y+d,v);for(let E=1;E<A.length;E++){const P=A[E];e.lineTo(P.x+u,P.y+d,v)}e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f);const{x:T=0,x:C=0}=r.attribute;i!==!1&&(y?y(e,r.attribute,f):o&&(e.setCommonStyle(r,r.attribute,T-u,C-d,f),e.fill())),n!==!1&&(b?b(e,r.attribute,f):l&&(e.setStrokeStyle(r,r.attribute,T-u,C-d,f),e.stroke()))}drawShape(r,e,i,n,o,l,u,d){const f=getTheme$1(r,l==null?void 0:l.theme).line,{fill:g=f.fill,stroke:_=f.stroke,fillOpacity:y=f.fillOpacity,strokeOpacity:b=f.strokeOpacity,segments:S,points:v,closePath:A,curveTension:x=f.curveTension,connectedType:T=f.connectedType}=r.attribute;if(!this.valid(r,f,u,d))return;let{curveType:C=f.curveType}=r.attribute;A&&C==="linear"&&(C="linearClosed");const{clipRange:E=f.clipRange,clipRangeByDimension:P=f.clipRangeByDimension}=r.attribute;if(E===1&&!S&&!v.some(R=>R.defined===!1)&&C==="linear")return this.drawLinearLineHighPerformance(r,e,!!g,!!_,y,b,i,n,f,o,l,u,d);function L(R,w){return w==="none"?R:R.filter(D=>D.defined!==!1)}if(r.shouldUpdateShape()){const{points:R,segments:w}=r.attribute,D=R;if(w&&w.length){let I,O;if(r.cache=w.map((B,N)=>{if(B.points.length<=1&&N===0)return B.points[0]&&(O={endX:B.points[0].x,endY:B.points[0].y,curves:[{defined:B.points[0].defined!==!1}]}),null;N===1?I={x:O.endX,y:O.endY,defined:O.curves[O.curves.length-1].defined}:N>1&&(I.x=O.endX,I.y=O.endY,I.defined=O.curves[O.curves.length-1].defined);const $=calcLineCache(L(B.points,T),C,{startPoint:I,curveTension:x});return O=$,$}).filter(B=>!!B),C==="linearClosed"){let B;for(let N=0;N<r.cache.length;N++){const $=r.cache[N];for(let H=0;H<$.curves.length;H++)if($.curves[H].defined){B=$.curves[H].p0;break}if(B)break}r.cache[r.cache.length-1]&&r.cache[r.cache.length-1].lineTo(B.x,B.y,!0)}}else{if(!R||!R.length)return r.cache=null,void r.clearUpdateShapeTag();r.cache=calcLineCache(L(D,T),C,{curveTension:x})}r.clearUpdateShapeTag()}if(Array.isArray(r.cache)){const R=r.attribute.segments.filter(w=>w.points.length);if(R[0].points.length===1&&R.shift(),E===1){let w=!1;r.cache.forEach((D,I)=>{w||(w=this.drawSegmentItem(e,D,!!g,!!_,y,b,R[I],[f,r.attribute],E,P,i,n,r,u,d))})}else{const w=r.cache.reduce((B,N)=>B+N.getLength(),0),D=E*w;let I=0,O=!1;r.cache.forEach((B,N)=>{if(O)return;const $=B.getLength(),H=(D-I)/$;I+=$,H>0&&(O=this.drawSegmentItem(e,B,!!g,!!_,y,b,R[N],[f,r.attribute],min$1(H,1),P,i,n,r,u,d))})}}else this.drawSegmentItem(e,r.cache,!!g,!!_,y,b,r.attribute,f,E,P,i,n,r,u,d)}};DefaultCanvasLineRender=__decorate$10([injectable()],DefaultCanvasLineRender);function drawAreaSegments(r,e,i,n){var o;const{top:l,bottom:u}=e;if(l.curves.length!==u.curves.length)return;if(i>=1){const T=[],C=[];let E=!0;for(let P=0,L=l.curves.length;P<L;P++){const R=l.curves[P];E!==R.defined?(E?(drawAreaBlock(r,T,C,n),T.length=0,C.length=0):(T.push(R),C.push(u.curves[L-P-1])),E=!E):E&&(T.push(R),C.push(u.curves[L-P-1]))}return void drawAreaBlock(r,T,C,n)}if(i<=0)return;let{direction:d}=n||{};const{curves:f}=l,g=(o=f[f.length-1].p3)!==null&&o!==void 0?o:f[f.length-1].p1,_=abs$1(g.x-f[0].p0.x),y=abs$1(g.y-f[0].p0.y);d=d??(_>y?Direction$1.ROW:Direction$1.COLUMN),Number.isFinite(_)||(d=Direction$1.COLUMN),Number.isFinite(y)||(d=Direction$1.ROW);const b=i*(d===Direction$1.ROW?_:y);let S=0,v=!0;const A=[],x=[];for(let T=0,C=l.curves.length;T<C;T++){const E=l.curves[T],P=E.getLength(d),L=(b-S)/P;if(L<0)break;S+=P;let R=null,w=null;v!==E.defined?(v?(drawAreaBlock(r,A,x,n),A.length=0,x.length=0):(R=E,w=u.curves[C-T-1]),v=!v):v&&(R=E,w=u.curves[C-T-1]),R&&w&&(L<1&&(R=R.p2&&R.p3?divideCubic(R,L)[0]:divideLinear(R,L)[0],w=w.p2&&w.p3?divideCubic(w,1-L)[1]:divideLinear(w,1-L)[1]),R.defined=v,w.defined=v,A.push(R),x.push(w)),R=null,w=null}drawAreaBlock(r,A,x,n)}function drawAreaBlock(r,e,i,n){const{offsetX:o=0,offsetY:l=0,offsetZ:u=0}=n||{};let d=!0;e.forEach(f=>{f.defined?(d&&r.moveTo(f.p0.x+o,f.p0.y+l,u),drawSegItem(r,f,1,n),d=!1):d=!0}),d=!0;for(let f=i.length-1;f>=0;f--){const g=i[f];g.defined?(d&&r.lineTo(g.p0.x+o,g.p0.y+l,u),drawSegItem(r,g,1,n),d=!1):d=!0}r.closePath()}const defaultAreaTextureRenderContribution=new DefaultAreaTextureRenderContribution,defaultAreaBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;var __decorate$$=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$L=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$B=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasAreaRender=class extends BaseRender{constructor(r){super(),this.areaRenderContribitions=r,this.numberType=AREA_NUMBER_TYPE,this.builtinContributions=[defaultAreaTextureRenderContribution,defaultAreaBackgroundRenderContribution],this.init(r)}drawLinearAreaHighPerformance(r,e,i,n,o,l,u,d,f,g,_,y,b){var S,v,A;const{points:x}=r.attribute;if(x.length<2)return;e.beginPath();const T=(S=this.z)!==null&&S!==void 0?S:0,C=x[0];e.moveTo(C.x+u,C.y+d,T);for(let L=1;L<x.length;L++){const R=x[L];e.lineTo(R.x+u,R.y+d,T)}for(let L=x.length-1;L>=0;L--){const R=x[L];e.lineTo(((v=R.x1)!==null&&v!==void 0?v:R.x)+u,((A=R.y1)!==null&&A!==void 0?A:R.y)+d,T)}e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f),this.beforeRenderStep(r,e,u,d,!!o,!1,i,!1,f,g,y,null,{attribute:r.attribute});const{x:E=0,x:P=0}=r.attribute;i!==!1&&(y?y(e,r.attribute,f):o&&(e.setCommonStyle(r,r.attribute,E-u,P-d,f),e.fill())),this.afterRenderStep(r,e,u,d,!!o,!1,i,!1,f,g,y,null,{attribute:r.attribute}),(()=>{var L,R;if(n){const{stroke:w=f&&f.stroke}=r.attribute;if(isArray(w)&&(w[0]||w[2])&&w[1]===!1){if(e.beginPath(),w[0]){e.moveTo(C.x+u,C.y+d,T);for(let D=1;D<x.length;D++){const I=x[D];e.lineTo(I.x+u,I.y+d,T)}}else if(w[2]){const D=x[x.length-1];e.moveTo(D.x+u,D.y+d,T);for(let I=x.length-2;I>=0;I--){const O=x[I];e.lineTo(((L=O.x1)!==null&&L!==void 0?L:O.x)+u,((R=O.y1)!==null&&R!==void 0?R:O.y)+d,T)}}}b?b(e,r.attribute,f):(e.setStrokeStyle(r,r.attribute,E-u,P-d,f),e.stroke())}})()}drawShape(r,e,i,n,o,l,u,d){var f,g,_,y,b,S;const v=getTheme$1(r,l==null?void 0:l.theme).area,{fill:A=v.fill,stroke:x=v.stroke,fillOpacity:T=v.fillOpacity,z:C=v.z,strokeOpacity:E=v.strokeOpacity,curveTension:P=v.curveTension,connectedType:L=v.connectedType}=r.attribute,R=this.valid(r,v,u,d);if(!R)return;const{doFill:w}=R,D=R.doStroke&&R.sVisible,{clipRange:I=v.clipRange,closePath:O,points:B,segments:N}=r.attribute;let{curveType:$=v.curveType}=r.attribute;function H(F,V){return V!=="connect"?F:F.filter(G=>G.defined!==!1)}if(O&&$==="linear"&&($="linearClosed"),I===1&&!N&&!B.some(F=>F.defined===!1)&&$==="linear")return this.drawLinearAreaHighPerformance(r,e,!!A,D,T,E,i,n,v,o,l,u,d);if(r.shouldUpdateShape()){if(N&&N.length){let F,V;const G=N.map((q,te)=>{if(q.points.length<=1&&te===0)return q.points[0]&&(V={endX:q.points[0].x,endY:q.points[0].y}),null;te===1?F={x:V.endX,y:V.endY}:te>1&&(F.x=V.endX,F.y=V.endY);const de=calcLineCache(H(q.points,L),$,{startPoint:F,curveTension:P});return V=de,de}).filter(q=>!!q);let Y;const J=[];for(let q=N.length-1;q>=0;q--){const te=N[q].points,de=[];for(let he=te.length-1;he>=0;he--)de.push({x:(f=te[he].x1)!==null&&f!==void 0?f:te[he].x,y:(g=te[he].y1)!==null&&g!==void 0?g:te[he].y});if(q!==0){const he=N[q-1].points,fe=he[he.length-1];fe&&de.push({x:(_=fe.x1)!==null&&_!==void 0?_:fe.x,y:(y=fe.y1)!==null&&y!==void 0?y:fe.y})}de.length>1&&(Y=calcLineCache(H(de,L),$==="stepBefore"?"stepAfter":$==="stepAfter"?"stepBefore":$,{curveTension:P}),J.unshift(Y))}r.cacheArea=J.map((q,te)=>({top:G[te],bottom:q}))}else{if(!B||!B.length)return r.cacheArea=null,void r.clearUpdateShapeTag();{const F=H(B,L),V=[];for(let J=F.length-1;J>=0;J--)V.push({x:(b=F[J].x1)!==null&&b!==void 0?b:F[J].x,y:(S=F[J].y1)!==null&&S!==void 0?S:F[J].y});const G=calcLineCache(F,$,{curveTension:P}),Y=calcLineCache(V,$==="stepBefore"?"stepAfter":$==="stepAfter"?"stepBefore":$,{curveTension:P});r.cacheArea={top:G,bottom:Y}}}r.clearUpdateShapeTag()}if(Array.isArray(r.cacheArea)){const F=r.attribute.segments.filter(V=>V.points.length);if(F[0].points.length===1&&F.shift(),I===1){let V=!1;r.cacheArea.forEach((G,Y)=>{V||(V=this.drawSegmentItem(e,G,w,T,D,E,F[Y],[v,r.attribute],I,i,n,C,r,o,u,d))})}else{const V=r.cacheArea.reduce((q,te)=>q+te.top.getLength(),0),G=I*V;let Y=0,J=!1;r.cacheArea.forEach((q,te)=>{if(J)return;const de=q.top.getLength(),he=(G-Y)/de;Y+=de,he>0&&(J=this.drawSegmentItem(e,q,w,T,D,E,F[te],[v,r.attribute],min$1(he,1),i,n,C,r,o,u,d))})}}else this.drawSegmentItem(e,r.cacheArea,w,T,D,E,r.attribute,v,I,i,n,C,r,o,u,d)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).area;this._draw(r,o,!1,i,n)}drawSegmentItem(r,e,i,n,o,l,u,d,f,g,_,y,b,S,v,A){return this._drawSegmentItem(r,e,i,n,o,l,u,d,f,g,_,y,b,S,v,A)}_drawSegmentItem(r,e,i,n,o,l,u,d,f,g,_,y,b,S,v,A){if(!(e&&e.top&&e.bottom&&e.top.curves&&e.top.curves.length&&e.bottom.curves&&e.bottom.curves.length))return;r.beginPath();const{points:x,segments:T}=b.attribute;let C,E,P=Direction$1.ROW;if(T){const I=T[T.length-1];E=T[0].points[0],C=I.points[I.points.length-1]}else E=x[0],C=x[x.length-1];const L=abs$1(C.x-E.x),R=abs$1(C.y-E.y);P=C.x1==null?Direction$1.ROW:C.y1==null?Direction$1.COLUMN:Number.isFinite(L+R)?L>R?Direction$1.ROW:Direction$1.COLUMN:Direction$1.ROW,drawAreaSegments(r.camera?r:r.nativeContext,e,f,{offsetX:g,offsetY:_,offsetZ:y,direction:P}),this.beforeRenderStep(b,r,g,_,!!n,!1,i,!1,d,S,v,null,{attribute:u}),r.setShadowBlendStyle&&r.setShadowBlendStyle(b,u,d);const{x:w=0,x:D=0}=u;return i!==!1&&(v?v(r,u,d):n&&(r.setCommonStyle(b,u,w-g,D-_,d),r.fill())),this.afterRenderStep(b,r,g,_,!!n,!1,i,!1,d,S,v,null,{attribute:u}),(()=>{if(o!==!1)if(A)A(r,u,d);else{const{stroke:I=d&&d[1]&&d[1].stroke}=u;isArray(I)&&(I[0]||I[2])&&I[1]===!1&&(r.beginPath(),drawSegments(r.camera?r:r.nativeContext,I[0]?e.top:e.bottom,f,P===Direction$1.ROW?"x":"y",{offsetX:g,offsetY:_,offsetZ:y})),r.setStrokeStyle(b,u,w-g,D-_,d),r.stroke()}})(),!1}};DefaultCanvasAreaRender=__decorate$$([injectable(),__param$B(0,inject(ContributionProvider)),__param$B(0,named(AreaRenderContribution)),__metadata$L("design:paramtypes",[Object])],DefaultCanvasAreaRender);const defaultPathTextureRenderContribution=defaultBaseTextureRenderContribution,defaultPathBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;var __decorate$_=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$K=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$A=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasPathRender=class extends BaseRender{constructor(r){super(),this.pathRenderContribitions=r,this.numberType=PATH_NUMBER_TYPE,this.builtinContributions=[defaultPathBackgroundRenderContribution,defaultPathTextureRenderContribution],this.init(r)}drawShape(r,e,i,n,o,l,u,d){var f,g,_;const y=(f=this.tempTheme)!==null&&f!==void 0?f:getTheme$1(r,l==null?void 0:l.theme).path,{x:b=y.x,y:S=y.y,fillStrokeOrder:v=y.fillStrokeOrder}=r.attribute,A=(g=this.z)!==null&&g!==void 0?g:0,x=this.valid(r,y,u,d);if(!x)return;const{fVisible:T,sVisible:C,doFill:E,doStroke:P}=x;if(e.beginPath(),r.pathShape)renderCommandList(r.pathShape.commandList,e,i,n,1,1,A);else{const w=(_=r.attribute.path)!==null&&_!==void 0?_:y.path;renderCommandList(w.commandList,e,i,n,1,1,A)}e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,y),this.beforeRenderStep(r,e,i,n,E,P,T,C,y,o,u,d);const L=()=>{P&&(d?d(e,r.attribute,y):C&&(e.setStrokeStyle(r,r.attribute,b-i,S-n,y),e.stroke()))},R=()=>{E&&(u?u(e,r.attribute,y):T&&(e.setCommonStyle(r,r.attribute,b-i,S-n,y),e.fill()))};v?(L(),R()):(R(),L()),this.afterRenderStep(r,e,i,n,E,P,T,C,y,o,u,d)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).path;this.tempTheme=o,this._draw(r,o,!1,i,n),this.tempTheme=null}};DefaultCanvasPathRender=__decorate$_([injectable(),__param$A(0,inject(ContributionProvider)),__param$A(0,named(PathRenderContribution)),__metadata$K("design:paramtypes",[Object])],DefaultCanvasPathRender);var __decorate$Z=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$J=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$z=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasRectRender=class extends BaseRender{constructor(r){super(),this.rectRenderContribitions=r,this.type="rect",this.numberType=RECT_NUMBER_TYPE,this.builtinContributions=[defaultRectRenderContribution,defaultRectBackgroundRenderContribution,defaultRectTextureRenderContribution],this.init(r)}drawShape(r,e,i,n,o,l,u,d){var f;const g=(f=this.tempTheme)!==null&&f!==void 0?f:getTheme$1(r,l==null?void 0:l.theme).rect,{fill:_=g.fill,background:y,stroke:b=g.stroke,cornerRadius:S=g.cornerRadius,opacity:v=g.opacity,fillOpacity:A=g.fillOpacity,lineWidth:x=g.lineWidth,strokeOpacity:T=g.strokeOpacity,visible:C=g.visible,x1:E,y1:P,x:L=g.x,y:R=g.y,fillStrokeOrder:w=g.fillStrokeOrder}=r.attribute;let{width:D,height:I}=r.attribute;D=(D??E-L)||0,I=(I??P-R)||0;const O=rectFillVisible(v,A,D,I,_),B=rectStrokeVisible(v,T,D,I),N=runFill(_,y),$=runStroke(b,x);if(!r.valid||!C||!N&&!$||!(O||B||u||d||y))return;S===0||isArray(S)&&S.every(G=>G===0)?(e.beginPath(),e.rect(i,n,D,I)):(e.beginPath(),createRectPath(e,i,n,D,I,S));const H={doFill:N,doStroke:$};e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,g),this.beforeRenderStep(r,e,i,n,N,$,O,B,g,o,u,d,H);const F=()=>{H.doFill&&(u?u(e,r.attribute,g):O&&(e.setCommonStyle(r,r.attribute,L-i,R-n,g),e.fill()))},V=()=>{H.doStroke&&(d?d(e,r.attribute,g):B&&(e.setStrokeStyle(r,r.attribute,L-i,R-n,g),e.stroke()))};w?(V(),F()):(F(),V()),this.afterRenderStep(r,e,i,n,N,$,O,B,g,o,u,d)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).rect;this.tempTheme=o,this._draw(r,o,!1,i,n),this.tempTheme=null}};DefaultCanvasRectRender=__decorate$Z([injectable(),__param$z(0,inject(ContributionProvider)),__param$z(0,named(RectRenderContribution)),__metadata$J("design:paramtypes",[Object])],DefaultCanvasRectRender);var __decorate$Y=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$I=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$y=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasSymbolRender=class extends BaseRender{constructor(r){super(),this.symbolRenderContribitions=r,this.numberType=SYMBOL_NUMBER_TYPE,this.builtinContributions=[defaultSymbolRenderContribution,defaultSymbolBackgroundRenderContribution,defaultSymbolTextureRenderContribution],this.init(r)}drawShape(r,e,i,n,o,l,u,d){var f;const g=getTheme$1(r,l==null?void 0:l.theme).symbol,{size:_=g.size,x:y=g.x,y:b=g.y,scaleX:S=g.scaleX,scaleY:v=g.scaleY,fillStrokeOrder:A=g.fillStrokeOrder}=r.attribute,x=this.valid(r,g,u,d);if(!x)return;const{fVisible:T,sVisible:C,doFill:E,doStroke:P}=x,L=r.getParsedPath();if(!L)return;const{keepDirIn3d:R=g.keepDirIn3d}=r.attribute,w=(f=this.z)!==null&&f!==void 0?f:0;e.beginPath();const D=(B,N)=>{var $,H,F;if(r._parsedPath.svgCache){const Y=Object.assign({},N);Y.fill=($=N.fill)!==null&&$!==void 0?$:r.attribute.fill,Y.opacity=(H=N.opacity)!==null&&H!==void 0?H:r.attribute.opacity,Y.fillOpacity=r.attribute.fillOpacity,Y.stroke=(F=N.stroke)!==null&&F!==void 0?F:r.attribute.stroke,N=Y}const V=()=>{N.fill&&(u?u(e,r.attribute,g):(e.setCommonStyle(r,N,y-i,b-n,g),e.fill()))},G=()=>{N.stroke&&(d?d(e,r.attribute,g):(e.setStrokeStyle(r,N,(y-i)/S,(b-n)/v,g),e.stroke()))};A?(G(),V()):(V(),G())};if(R&&e.camera&&e.project){const B=e.project(i,n,w),N=e.camera;e.camera=null,L.draw(e,isArray(_)?[_[0]*S,_[1]*v]:_*S,B.x,B.y,void 0,D)===!1&&e.closePath(),e.camera=N}else L.draw(e,_,i,n,w,D)===!1&&e.closePath();e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,g),this.beforeRenderStep(r,e,i,n,E,P,T,C,g,o,u,d);const I=()=>{E&&!L.isSvg&&(u?u(e,r.attribute,g):T&&(e.setCommonStyle(r,r.attribute,y-i,b-n,g),e.fill()))},O=()=>{P&&!L.isSvg&&(d?d(e,r.attribute,g):C&&(e.setStrokeStyle(r,r.attribute,(y-i)/S,(b-n)/v,g),e.stroke()))};A?(O(),I()):(I(),O()),this.afterRenderStep(r,e,i,n,E,P,T,C,g,o,u,d)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).symbol;this._draw(r,o,!1,i,n)}};DefaultCanvasSymbolRender=__decorate$Y([injectable(),__param$y(0,inject(ContributionProvider)),__param$y(0,named(SymbolRenderContribution)),__metadata$I("design:paramtypes",[Object])],DefaultCanvasSymbolRender);class DefaultBoundsAllocate{constructor(){this.pools=[];for(let e=0;e<10;e++)this.pools.push(new AABBBounds)}allocate(e,i,n,o){if(!this.pools.length)return new AABBBounds().setValue(e,i,n,o);const l=this.pools.pop();return l.x1=e,l.y1=i,l.x2=n,l.y2=o,l}allocateByObj(e){if(!this.pools.length)return new AABBBounds(e);const i=this.pools.pop();return i.x1=e.x1,i.y1=e.y1,i.x2=e.x2,i.y2=e.y2,i}free(e){this.pools.push(e)}get length(){return this.pools.length}release(...e){this.pools=[]}}const boundsAllocate=new DefaultBoundsAllocate;class GraphicCreator{constructor(){this.store=new Map}RegisterGraphicCreator(e,i){this.store.set(e,i),this[e]=i}CreateGraphic(e,i){const n=this.store.get(e);return n?n(i):null}}const graphicCreator=new GraphicCreator;let text,richText;function getTextBounds(r){return text||(text=graphicCreator.CreateGraphic("text",{})),text.initAttributes(r),text.AABBBounds}function getRichTextBounds(r){return richText||(richText=graphicCreator.CreateGraphic("richtext",{})),richText.setAttributes(r),richText.AABBBounds}class DefaultTextBackgroundRenderContribution extends DefaultBaseBackgroundRenderContribution{constructor(){super(...arguments),this.time=BaseRenderContributionTime.beforeFillStroke}drawShape(e,i,n,o,l,u,d,f,g,_,y,b){var S,v,A,x,T,C,E,P,L,R;const{backgroundMode:w=g.backgroundMode,backgroundFit:D=g.backgroundFit}=e.attribute;let I,{background:O}=e.attribute;if(!O)return;const B=()=>{e.type==="richtext"&&(i.restore(),i.save(),I&&i.setTransformFromMatrix(I,!0,1))};let N;e.type==="richtext"&&(I=i.currentMatrix.clone(),i.restore(),i.save(),i.setTransformForCurrent());const $=isObject$1(O)&&O.background,H=e.transMatrix.onlyTranslate();if($){const F=e.AABBBounds,V=((S=O.x)!==null&&S!==void 0?S:F.x1)+((v=O.dx)!==null&&v!==void 0?v:0),G=((A=O.y)!==null&&A!==void 0?A:F.y1)+((x=O.dy)!==null&&x!==void 0?x:0),Y=(T=O.width)!==null&&T!==void 0?T:F.width(),J=(C=O.height)!==null&&C!==void 0?C:F.height();if(N=boundsAllocate.allocate(V,G,V+Y,G+J),O=O.background,!H){const q=N.width(),te=N.height();N.set(((E=O.x)!==null&&E!==void 0?E:0)+((P=O.dx)!==null&&P!==void 0?P:0),((L=O.y)!==null&&L!==void 0?L:0)+((R=O.dy)!==null&&R!==void 0?R:0),q,te)}}else N=e.AABBBounds,H||(N=getTextBounds(Object.assign(Object.assign({},e.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(e.backgroundImg&&e.resources){const F=e.resources.get(O);if(F.state!=="success"||!F.data)return void B();i.highPerformanceSave(),H&&i.setTransformFromMatrix(e.parent.globalTransMatrix,!0),i.setCommonStyle(e,e.attribute,n,o,g),this.doDrawImage(i,F.data,N,w,D),i.highPerformanceRestore(),i.setTransformForCurrent()}else{const{backgroundCornerRadius:F}=e.attribute;i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,n,o,g),i.fillStyle=O,F?(createRectPath(i,N.x1,N.y1,N.width(),N.height(),F),i.fill()):i.fillRect(N.x1,N.y1,N.width(),N.height()),i.highPerformanceRestore()}$&&boundsAllocate.free(N),B()}}const defaultTextBackgroundRenderContribution=new DefaultTextBackgroundRenderContribution;var __decorate$X=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$H=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$x=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasTextRender=class extends BaseRender{constructor(r){super(),this.textRenderContribitions=r,this.numberType=TEXT_NUMBER_TYPE,this.builtinContributions=[defaultTextBackgroundRenderContribution],this.init(r)}drawShape(r,e,i,n,o,l,u,d){var f,g,_;const y=getTheme$1(r,l==null?void 0:l.theme).text,{text:b,underline:S=y.underline,lineThrough:v=y.lineThrough,keepDirIn3d:A=y.keepDirIn3d,direction:x=y.direction,fontSize:T=y.fontSize,verticalMode:C=y.verticalMode,x:E=y.x,y:P=y.y}=r.attribute,L=(f=calculateLineHeight(r.attribute.lineHeight,T))!==null&&f!==void 0?f:T,R=this.valid(r,y,u,d);if(!R)return;const{fVisible:w,sVisible:D,doFill:I,doStroke:O}=R,B=!A,N=this.z||0;e.beginPath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,y),this.beforeRenderStep(r,e,i,n,I,O,w,D,y,o,u,d),B&&this.transformUseContext2d(r,y,N,e);const $=(H,F,V,G)=>{let Y=i+F;const J=n+V;if(G){e.highPerformanceSave(),Y+=T;const q=matrixAllocate.allocate(1,0,0,1,0,0);q.rotateByCenter(Math.PI/2,Y,J),e.transformFromMatrix(q,!0),matrixAllocate.free(q)}O&&(d?d(e,r.attribute,y):D&&(e.setStrokeStyle(r,r.attribute,E-i,P-n,y),e.strokeText(H,Y,J,N))),I&&(u?u(e,r.attribute,y):w&&(e.setCommonStyle(r,r.attribute,E-i,P-n,y),e.fillText(H,Y,J,N))),G&&(e.highPerformanceRestore(),e.setTransformForCurrent())};if(e.setTextStyleWithoutAlignBaseline(r.attribute,y,N),x==="horizontal"){const{multilineLayout:H}=r;if(!H)return void e.highPerformanceRestore();const{xOffset:F,yOffset:V}=H.bbox;O&&(d?d(e,r.attribute,y):D&&(e.setStrokeStyle(r,r.attribute,E-i,P-n,y),H.lines.forEach(G=>{e.strokeText(G.str,(G.leftOffset||0)+F+i,(G.topOffset||0)+V+n,N)}))),I&&(u?u(e,r.attribute,y):w&&(e.setCommonStyle(r,r.attribute,E-i,P-n,y),H.lines.forEach(G=>{e.fillText(G.str,(G.leftOffset||0)+F+i,(G.topOffset||0)+V+n,N),this.drawUnderLine(S,v,r,(G.leftOffset||0)+F+i,(G.topOffset||0)+V+n,G.descent,(G.descent-G.ascent)/2,N,y,e,{width:G.width})})))}else{let{textAlign:H=y.textAlign,textBaseline:F=y.textBaseline}=r.attribute;if(!C){const de=H;H=(g=r.getBaselineMapAlign()[F])!==null&&g!==void 0?g:"left",F=(_=r.getAlignMapBaseline()[de])!==null&&_!==void 0?_:"top"}r.tryUpdateAABBBounds();const V=r.cache,{verticalList:G}=V;e.textAlign="left",e.textBaseline="top";const Y=L*G.length;let J=0;G.forEach(de=>{const he=de.reduce((fe,pe)=>fe+(pe.width||0),0);J=max$1(he,J)});let q=0,te=0;F==="bottom"?te=-Y:F==="middle"&&(te=-Y/2),H==="center"?q-=J/2:H==="right"&&(q-=J),G.forEach((de,he)=>{const fe=de.reduce((ee,Q)=>ee+(Q.width||0),0),pe=J-fe;let me=q;H==="center"?me+=pe/2:H==="right"&&(me+=pe),de.forEach(ee=>{const{text:Q,width:ie,direction:le}=ee;$(Q,Y-(he+1)*L+te,me,le),me+=ie})})}B&&this.restoreTransformUseContext2d(r,y,N,e),this.afterRenderStep(r,e,i,n,I,O,w,D,y,o,u,d)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).text,{keepDirIn3d:l=o.keepDirIn3d}=r.attribute,u=!l;this._draw(r,o,u,i,n)}drawUnderLine(r,e,i,n,o,l,u,d,f,g,_){if(e+r<=0)return;const{textAlign:y=f.textAlign,fill:b=f.fill,opacity:S=f.opacity,underlineOffset:v=f.underlineOffset,underlineDash:A=f.underlineDash,fillOpacity:x=f.fillOpacity}=i.attribute,T=!isNil(_),C=T?_.width:i.clipedWidth,E=T?0:textDrawOffsetX(y,C),P={lineWidth:0,stroke:b,opacity:S,strokeOpacity:x};if(r){P.lineWidth=r,g.setStrokeStyle(i,P,n,o,f),A&&g.setLineDash(A),g.beginPath();const L=o+l+v;g.moveTo(n+E,L,d),g.lineTo(n+E+C,L,d),g.stroke()}if(e){P.lineWidth=e,g.setStrokeStyle(i,P,n,o,f),g.beginPath();const L=o+u;g.moveTo(n+E,L,d),g.lineTo(n+E+C,L,d),g.stroke()}}};DefaultCanvasTextRender=__decorate$X([injectable(),__param$x(0,inject(ContributionProvider)),__param$x(0,named(TextRenderContribution)),__metadata$H("design:paramtypes",[Object])],DefaultCanvasTextRender);function drawPolygon(r,e,i,n){r.moveTo(e[0].x+i,e[0].y+n);for(let o=1;o<e.length;o++)r.lineTo(e[o].x+i,e[o].y+n)}function drawRoundedPolygon(r,e,i,n,o,l=!0){var u;if(e.length<3)return void drawPolygon(r,e,i,n);let d=0,f=e.length-1;l||(d+=1,f-=1,r.moveTo(e[0].x+i,e[0].y+n));for(let g=d;g<=f;g++){const _=e[g===0?f:(g-1)%e.length],y=e[g%e.length],b=e[(g+1)%e.length],S=y.x-_.x,v=y.y-_.y,A=y.x-b.x,x=y.y-b.y,T=(Math.atan2(v,S)-Math.atan2(x,A))/2,C=Math.abs(Math.tan(T));let E=Array.isArray(o)?(u=o[g%e.length])!==null&&u!==void 0?u:0:o,P=E/C;const L=getLength(S,v),R=getLength(A,x),w=Math.min(L,R);P>w&&(P=w,E=w*C);const D=getProportionPoint(y,P,L,S,v),I=getProportionPoint(y,P,R,A,x),O=2*y.x-D.x-I.x,B=2*y.y-D.y-I.y,N=getLength(O,B),$=getProportionPoint(y,getLength(P,E),N,O,B);let H=Math.atan2(D.y-$.y,D.x-$.x);const F=Math.atan2(I.y-$.y,I.x-$.x);let V=F-H;V<0&&(H=F,V=-V),V>Math.PI&&(V-=Math.PI),g===0?r.moveTo(D.x+i,D.y+n):r.lineTo(D.x+i,D.y+n),V&&r.arcTo(y.x+i,y.y+n,I.x+i,I.y+n,E),r.lineTo(I.x+i,I.y+n)}l||r.lineTo(e[f+1].x+i,e[f+1].y+n)}function getLength(r,e){return Math.sqrt(r*r+e*e)}function getProportionPoint(r,e,i,n,o){const l=e/i;return{x:r.x-n*l,y:r.y-o*l}}const defaultPolygonTextureRenderContribution=defaultBaseTextureRenderContribution,defaultPolygonBackgroundRenderContribution=defaultBaseBackgroundRenderContribution;var __decorate$W=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$G=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$w=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasPolygonRender=class extends BaseRender{constructor(r){super(),this.polygonRenderContribitions=r,this.numberType=POLYGON_NUMBER_TYPE,this.builtinContributions=[defaultPolygonBackgroundRenderContribution,defaultPolygonTextureRenderContribution],this.init(r)}drawShape(r,e,i,n,o,l,u,d){const f=getTheme$1(r,l==null?void 0:l.theme).polygon,{points:g=f.points,cornerRadius:_=f.cornerRadius,x:y=f.x,y:b=f.y,closePath:S=f.closePath,fillStrokeOrder:v=f.fillStrokeOrder}=r.attribute,A=this.valid(r,f,u,d);if(!A)return;const{fVisible:x,sVisible:T,doFill:C,doStroke:E}=A;e.beginPath(),_<=0||isArray(_)&&_.every(R=>R===0)?drawPolygon(e.camera?e:e.nativeContext,g,i,n):drawRoundedPolygon(e.camera?e:e.nativeContext,g,i,n,_,S),S&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f),this.beforeRenderStep(r,e,i,n,C,E,x,T,f,o,u,d);const P=()=>{C&&(u?u(e,r.attribute,f):x&&(e.setCommonStyle(r,r.attribute,y-i,b-n,f),e.fill()))},L=()=>{E&&(d?d(e,r.attribute,f):T&&(e.setStrokeStyle(r,r.attribute,y-i,b-n,f),e.stroke()))};v?(L(),P()):(P(),L()),this.afterRenderStep(r,e,i,n,C,E,x,T,f,o,u,d)}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).polygon;this._draw(r,o,!1,i,n)}};DefaultCanvasPolygonRender=__decorate$W([injectable(),__param$w(0,inject(ContributionProvider)),__param$w(0,named(PolygonRenderContribution)),__metadata$G("design:paramtypes",[Object])],DefaultCanvasPolygonRender);var __decorate$V=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$F=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$v=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasGroupRender=class{constructor(r){this.groupRenderContribitions=r,this.numberType=GROUP_NUMBER_TYPE}drawShape(r,e,i,n,o,l,u,d){const f=getTheme$1(r,l==null?void 0:l.theme).group,{fill:g=f.fill,background:_,stroke:y=f.stroke,opacity:b=f.opacity,width:S=f.width,height:v=f.height,clip:A=f.clip,fillOpacity:x=f.fillOpacity,strokeOpacity:T=f.strokeOpacity,cornerRadius:C=f.cornerRadius,path:E=f.path,lineWidth:P=f.lineWidth,visible:L=f.visible,fillStrokeOrder:R=f.fillStrokeOrder,x:w=f.x,y:D=f.y}=r.attribute,I=rectFillVisible(b,x,S,v,g),O=rectStrokeVisible(b,T,S,v),B=runFill(g,_),N=runStroke(y,P);if(!r.valid||!L||!A&&(!B&&!N||!(I||O||u||d||_)))return;if(E&&E.length&&o.drawContribution){const V=e.disableFill,G=e.disableStroke,Y=e.disableBeginPath;e.disableFill=!0,e.disableStroke=!0,e.disableBeginPath=!0,E.forEach(J=>{o.drawContribution.getRenderContribution(J).draw(J,o.renderService,o,l)}),e.disableFill=V,e.disableStroke=G,e.disableBeginPath=Y}else C===0||isArray(C)&&C.every(V=>V===0)?(e.beginPath(),e.rect(i,n,S,v)):(e.beginPath(),createRectPath(e,i,n,S,v,C));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(defaultGroupBackgroundRenderContribution));const $={doFill:B,doStroke:N};this._groupRenderContribitions.forEach(V=>{V.time===BaseRenderContributionTime.beforeFillStroke&&V.drawShape(r,e,i,n,B,N,I,O,f,o,u,d,$)}),A&&e.clip(),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f);const H=()=>{$.doFill&&(u?u(e,r.attribute,f):I&&(e.setCommonStyle(r,r.attribute,w-i,D-n,f),e.fill()))},F=()=>{$.doStroke&&(d?d(e,r.attribute,f):O&&(e.setStrokeStyle(r,r.attribute,w-i,D-n,f),e.stroke()))};R?(F(),H()):(H(),F()),this._groupRenderContribitions.forEach(V=>{V.time===BaseRenderContributionTime.afterFillStroke&&V.drawShape(r,e,i,n,B,N,I,O,f,o,u,d)})}draw(r,e,i,n){const{context:o}=i;if(!o)return;const{clip:l,baseOpacity:u=1}=r.attribute;l?o.save():o.highPerformanceSave();const d=o.baseGlobalAlpha;o.baseGlobalAlpha*=u;const f=getTheme$1(r,n==null?void 0:n.theme).group,g=o.modelMatrix;if(o.camera){const S=mat4Allocate.allocate(),v=mat4Allocate.allocate();getModelMatrix(v,r,f),multiplyMat4Mat4(S,g||S,v),o.modelMatrix=S,mat4Allocate.free(v),o.setTransform(1,0,0,1,0,0,!0)}else o.transformFromMatrix(r.transMatrix,!0);o.beginPath(),n.skipDraw?this.drawShape(r,o,0,0,i,n,()=>!1,()=>!1):this.drawShape(r,o,0,0,i);const{scrollX:_=f.scrollX,scrollY:y=f.scrollY}=r.attribute;let b;(_||y)&&o.translate(_,y),n&&n.drawingCb&&(b=n.drawingCb()),o.modelMatrix!==g&&mat4Allocate.free(o.modelMatrix),o.modelMatrix=g,o.baseGlobalAlpha=d,b&&b.then?b.then(()=>{l?o.restore():o.highPerformanceRestore()}):l?o.restore():o.highPerformanceRestore()}};DefaultCanvasGroupRender=__decorate$V([injectable(),__param$v(0,inject(ContributionProvider)),__param$v(0,named(GroupRenderContribution)),__metadata$F("design:paramtypes",[Object])],DefaultCanvasGroupRender);var __decorate$U=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$E=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$u=function(r,e){return function(i,n){e(i,n,r)}};const repeatStr=["","repeat-x","repeat-y","repeat"];let DefaultCanvasImageRender=class extends BaseRender{constructor(r){super(),this.imageRenderContribitions=r,this.numberType=IMAGE_NUMBER_TYPE,this.builtinContributions=[defaultImageRenderContribution,defaultImageBackgroundRenderContribution],this.init(r)}drawShape(r,e,i,n,o,l,u,d){const f=getTheme$1(r).image,{width:g=f.width,height:_=f.height,repeatX:y=f.repeatX,repeatY:b=f.repeatY,x:S=f.x,y:v=f.y,cornerRadius:A=f.cornerRadius,fillStrokeOrder:x=f.fillStrokeOrder,image:T}=r.attribute,C=this.valid(r,f,u);if(!C)return;const{fVisible:E,sVisible:P,doFill:L,doStroke:R}=C;if(!T||!r.resources)return;const w=r.resources.get(T);if(w.state!=="success")return;let D=!1;A===0||isArray(A)&&A.every(B=>B===0)||(e.beginPath(),createRectPath(e,i,n,g,_,A),D=!0),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,f);const I=()=>{if(L){if(u)u(e,r.attribute,f);else if(E){e.setCommonStyle(r,r.attribute,i,n,f);let B=0;if(y==="repeat"&&(B|=1),b==="repeat"&&(B|=2),B){const N=e.createPattern(w.data,repeatStr[B]);e.fillStyle=N,e.translate(i,n,!0),e.fillRect(0,0,g,_),e.translate(-i,-n,!0)}else e.drawImage(w.data,i,n,g,_)}}},O=()=>{R&&(d?d(e,r.attribute,f):P&&(e.setStrokeStyle(r,r.attribute,S-i,v-n,f),e.stroke()))};x?(O(),D&&(e.save(),e.clip()),this.beforeRenderStep(r,e,i,n,L,!1,E,!1,f,o,u),I(),D&&e.restore()):(D&&(e.save(),e.clip()),this.beforeRenderStep(r,e,i,n,L,!1,E,!1,f,o,u),I(),D&&e.restore(),O()),this.afterRenderStep(r,e,i,n,L,!1,E,!1,f,o,u)}draw(r,e,i){const{image:n}=r.attribute;if(!n||!r.resources)return;const o=r.resources.get(n);if(o.state==="loading"&&isString(n))return void ResourceLoader.improveImageLoading(n);if(o.state!=="success")return;const{context:l}=e.drawParams;if(!l)return;const u=getTheme$1(r).image;this._draw(r,u,!1,i)}};DefaultCanvasImageRender=__decorate$U([injectable(),__param$u(0,inject(ContributionProvider)),__param$u(0,named(ImageRenderContribution)),__metadata$E("design:paramtypes",[Object])],DefaultCanvasImageRender);const IncrementalDrawContribution=Symbol.for("IncrementalDrawContribution"),ArcRender=Symbol.for("ArcRender"),Arc3dRender=Symbol.for("Arc3dRender"),AreaRender=Symbol.for("AreaRender"),CircleRender=Symbol.for("CircleRender"),GraphicRender=Symbol.for("GraphicRender"),GroupRender=Symbol.for("GroupRender"),LineRender=Symbol.for("LineRender"),PathRender=Symbol.for("PathRender"),PolygonRender=Symbol.for("PolygonRender"),RectRender=Symbol.for("RectRender"),Rect3DRender=Symbol.for("Rect3DRender"),SymbolRender=Symbol.for("SymbolRender"),TextRender=Symbol.for("TextRender"),RichTextRender=Symbol.for("RichTextRender"),Pyramid3dRender=Symbol.for("Pyramid3dRender"),GlyphRender=Symbol.for("GlyphRender"),ImageRender=Symbol.for("ImageRender"),DrawContribution=Symbol.for("DrawContribution"),draw3dItem=(r,e,i,n)=>{let o,l=!1,u=!1;if(e.forEachChildren(d=>(l=d.numberType===ARC3D_NUMBER_TYPE,!l)),e.forEachChildren(d=>(u=!!d.findFace,!u)),l){const d=e.getChildren(),f=[...d];f.sort((g,_)=>{var y,b,S,v;let A=((b=(y=g.attribute.startAngle)!==null&&y!==void 0?y:0+g.attribute.endAngle)!==null&&b!==void 0?b:0)/2,x=((v=(S=_.attribute.startAngle)!==null&&S!==void 0?S:0+_.attribute.endAngle)!==null&&v!==void 0?v:0)/2;for(;A<0;)A+=pi2;for(;x<0;)x+=pi2;return x-A}),f.forEach(g=>{g._next=null,g._prev=null}),e.removeAllChild(),e.update(),f.forEach(g=>{e.appendChild(g)}),n.hack_pieFace="outside",o=i(l,u),o&&o.graphic||(n.hack_pieFace="inside",o=i(l,u)),o&&o.graphic||(n.hack_pieFace="top",o=i(l,u)),e.removeAllChild(),d.forEach(g=>{g._next=null,g._prev=null}),d.forEach(g=>{e.appendChild(g)})}else if(u){const d=e.getChildren(),f=d.map(g=>({ave_z:g.findFace().vertices.map(_=>{var y;return r.view(_[0],_[1],(y=_[2]+g.attribute.z)!==null&&y!==void 0?y:0)[2]}).reduce((_,y)=>_+y,0),g}));f.sort((g,_)=>_.ave_z-g.ave_z),e.removeAllChild(),f.forEach(g=>{g.g._next=null,g.g._prev=null}),e.update(),f.forEach(g=>{e.add(g.g)}),o=i(l,u),e.removeAllChild(),d.forEach(g=>{g._next=null,g._prev=null}),e.update(),d.forEach(g=>{e.add(g)})}else o=i(l,u);return o};var __decorate$T=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$D=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};const DrawItemInterceptor=Symbol.for("DrawItemInterceptor"),tempDirtyBounds=new AABBBounds,tempBackupDirtyBounds=new AABBBounds;class ShadowRootDrawItemInterceptorContribution{constructor(){this.order=1}afterDrawItem(e,i,n,o,l){return e.attribute.shadowRootIdx==null&&e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx<0||(e.attribute.shadowRootIdx>0||!e.attribute.shadowRootIdx||e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(e,i,n,o,l),!1}beforeDrawItem(e,i,n,o,l){return e.attribute.shadowRootIdx==null&&e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx>0||(e.attribute.shadowRootIdx<0||e.shadowRoot&&e.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(e,i,n,o,l),!1}drawItem(e,i,n,o,l){if(!e.shadowRoot)return!1;const{context:u}=n;if(u.highPerformanceSave(),u.transformFromMatrix(e.transMatrix,!0),o.dirtyBounds&&o.backupDirtyBounds){tempDirtyBounds.copy(o.dirtyBounds),tempBackupDirtyBounds.copy(o.backupDirtyBounds);const d=e.globalTransMatrix.getInverse();o.dirtyBounds.copy(o.backupDirtyBounds).transformWithMatrix(d),o.backupDirtyBounds.copy(o.dirtyBounds)}return o.renderGroup(e.shadowRoot,n,matrixAllocate.allocate(1,0,0,1,0,0)),u.highPerformanceRestore(),o.dirtyBounds&&o.backupDirtyBounds&&(o.dirtyBounds.copy(tempDirtyBounds),o.backupDirtyBounds.copy(tempBackupDirtyBounds)),!0}}class DebugDrawItemInterceptorContribution{constructor(){this.order=1}afterDrawItem(e,i,n,o,l){return e.attribute._debug_bounds&&this.drawItem(e,i,n,o,l),!1}drawItem(e,i,n,o,l){if(!e.attribute._debug_bounds)return!1;const{context:u}=n;u.highPerformanceSave(),e.parent&&u.setTransformFromMatrix(e.parent.globalTransMatrix,!0),e.glyphHost&&e.glyphHost.parent&&u.setTransformFromMatrix(e.glyphHost.parent.globalTransMatrix,!0);const d=e.AABBBounds;return e.attribute._debug_bounds!==!0&&e.attribute._debug_bounds(u,e),u.strokeRect(d.x1,d.y1,d.width(),d.height()),u.highPerformanceRestore(),!0}}let CommonDrawItemInterceptorContribution=class{constructor(){this.order=1,this.interceptors=[new ShadowRootDrawItemInterceptorContribution,new Canvas3DDrawItemInterceptor,new InteractiveDrawItemInterceptorContribution,new DebugDrawItemInterceptorContribution]}afterDrawItem(r,e,i,n,o){for(let l=0;l<this.interceptors.length;l++)if(this.interceptors[l].afterDrawItem&&this.interceptors[l].afterDrawItem(r,e,i,n,o))return!0;return!1}beforeDrawItem(r,e,i,n,o){if((!r.in3dMode||i.in3dInterceptor)&&!r.shadowRoot&&!(r.baseGraphic||r.attribute.globalZIndex||r.interactiveGraphic))return!1;for(let l=0;l<this.interceptors.length;l++)if(this.interceptors[l].beforeDrawItem&&this.interceptors[l].beforeDrawItem(r,e,i,n,o))return!0;return!1}};CommonDrawItemInterceptorContribution=__decorate$T([injectable(),__metadata$D("design:paramtypes",[])],CommonDrawItemInterceptorContribution);class InteractiveDrawItemInterceptorContribution{constructor(){this.order=1}beforeDrawItem(e,i,n,o,l){return!this.processing&&(e.baseGraphic?this.beforeDrawInteractive(e,i,n,o,l):this.beforeSetInteractive(e,i,n,o,l))}beforeSetInteractive(e,i,n,o,l){let u=e.interactiveGraphic;if(e.attribute.globalZIndex){u||(u=e.clone(),e.interactiveGraphic=u,u.baseGraphic=e),u.setAttributes({globalZIndex:0,zIndex:e.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),n.stage.tryInitInteractiveLayer();const d=n.stage.getLayer("_builtin_interactive");return d&&this.getShadowRoot(d).add(u),!0}if(u){n.stage.tryInitInteractiveLayer();const d=n.stage.getLayer("_builtin_interactive");d&&this.getShadowRoot(d).removeChild(u),e.interactiveGraphic=null,u.baseGraphic=null}return!1}beforeDrawInteractive(e,i,n,o,l){const u=e.baseGraphic;let d=!!u.stage,f=u.parent;for(;d&&f&&f.stage!==f;)d=!!f.stage,f=f.parent;if(!d){const g=n.stage.getLayer("_builtin_interactive");return g&&this.getShadowRoot(g).removeChild(e),!0}if(u){this.processing=!0;const{context:g}=n;return g.highPerformanceSave(),g.setTransformFromMatrix(u.parent.globalTransMatrix,!0),u.isContainer?o.renderGroup(u,n,u.parent.globalTransMatrix):o.renderItem(u,n),g.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(e){var i;let n=e.getElementById("_interactive_group");return n||(n=graphicCreator.CreateGraphic("group",{}),n.id="_interactive_group",e.add(n)),(i=n.shadowRoot)!==null&&i!==void 0?i:n.attachShadow()}}class Canvas3DDrawItemInterceptor{constructor(){this.order=1}beforeDrawItem(e,i,n,o,l){if(!e.in3dMode||n.in3dInterceptor)return!1;n.in3dInterceptor=!0;const{context:u,stage:d}=i.drawParams;u.canvas,u.save(),this.initCanvasCtx(u),u.camera=d.camera;const f=u.currentMatrix;f.a/=u.dpr,f.b/=u.dpr,f.c/=u.dpr,f.d/=u.dpr,f.e/=u.dpr,f.f/=u.dpr;const g=mat4Allocate.allocate();mat3Tomat4(g,f);const _=u.modelMatrix;if(_){if(g){const y=mat4Allocate.allocate();u.modelMatrix=multiplyMat4Mat4(y,_,g)}}else u.modelMatrix=g;return u.setTransform(1,0,0,1,0,0,!0),e.isContainer?draw3dItem(u,e,(y,b)=>o.renderGroup(e,n,e.parent.globalTransMatrix,!y&&b),n):o.renderItem(e,n),u.camera=null,u.restore(),u.modelMatrix!==_&&mat4Allocate.free(u.modelMatrix),u.modelMatrix=_,n.in3dInterceptor=!1,!0}initCanvasCtx(e){e.setTransformForCurrent()}}var __decorate$S=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$C=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$t=function(r,e){return function(i,n){e(i,n,r)}};const RenderService=Symbol.for("RenderService");let DefaultRenderService=class{constructor(r){this.drawContribution=r}prepare(r){r&&this.renderTreeRoots.forEach(e=>{this._prepare(e,r)})}_prepare(r,e){r.forEachChildren(i=>{this._prepare(i,e)}),r.update({bounds:e,trans:!0})}prepareRenderList(){}beforeDraw(r){}draw(r){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(r){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(r,e){this.renderTreeRoots=r,this.drawParams=e;const i=e.updateBounds;this.prepare(i),this.prepareRenderList(),this.beforeDraw(e),this.draw(e),this.afterDraw(e),this.drawParams=null}};DefaultRenderService=__decorate$S([injectable(),__param$t(0,inject(DrawContribution)),__metadata$C("design:paramtypes",[Object])],DefaultRenderService);const renderModule$1=new ContainerModule(r=>{r(RenderService).to(DefaultRenderService)}),PickerService=Symbol.for("PickerService"),GlobalPickerService=Symbol.for("GlobalPickerService"),updateBoundsOfCommonOuterBorder=(r,e,i)=>{const{outerBorder:n,shadowBlur:o=e.shadowBlur}=r;if(n){const l=e.outerBorder,{distance:u=l.distance,lineWidth:d=l.lineWidth}=n;i.expand(u+(o+d)/2)}return i},CIRCLE_UPDATE_TAG_KEY=["radius","startAngle","endAngle",...GRAPHIC_UPDATE_TAG_KEY];class Circle extends Graphic{constructor(e={radius:1}){super(e),this.type="circle",this.numberType=CIRCLE_NUMBER_TYPE}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:e,endAngle:i,radius:n}=this.attribute;return this._validNumber(e)&&this._validNumber(i)&&this._validNumber(n)}getGraphicTheme(){return getTheme$1(this).circle}updateAABBBounds(e,i,n,o){this.updatePathProxyAABBBounds(n)||(o?this.updateCircleAABBBoundsImprecise(e,i,n):this.updateCircleAABBBoundsAccurate(e,i,n));const{tb1:l,tb2:u}=application.graphicService.updateTempAABBBounds(n);return updateBoundsOfCommonOuterBorder(e,i,l),n.union(l),l.setValue(u.x1,u.y1,u.x2,u.y2),application.graphicService.transformAABBBounds(e,n,i,!1,this),n}updateCircleAABBBoundsImprecise(e,i,n){const{radius:o=i.radius}=e;return n.set(-o,-o,o,o),n}updateCircleAABBBoundsAccurate(e,i,n){const{startAngle:o=i.startAngle,endAngle:l=i.endAngle,radius:u=i.radius}=e;return l-o>pi2-epsilon$1?n.set(-u,-u,u,u):circleBounds(o,l,u,n),n}needUpdateTags(e){return super.needUpdateTags(e,CIRCLE_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,CIRCLE_UPDATE_TAG_KEY)}toCustomPath(){var e,i,n;const o=this.attribute,l=(e=o.radius)!==null&&e!==void 0?e:this.getDefaultAttribute("radius"),u=(i=o.startAngle)!==null&&i!==void 0?i:this.getDefaultAttribute("startAngle"),d=(n=o.endAngle)!==null&&n!==void 0?n:this.getDefaultAttribute("endAngle"),f=new CustomPath2D;return f.arc(0,0,l,u,d),f}clone(){return new Circle(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Circle.NOWORK_ANIMATE_ATTR}}Circle.NOWORK_ANIMATE_ATTR=NOWORK_ANIMATE_ATTR;function createCircle(r){return new Circle(r)}class CanvasTextLayout{constructor(e,i,n){this.fontFamily=e,this.textOptions=i,this.textMeasure=n}LayoutBBox(e,i,n,o){if(e.xOffset=i==="left"||i==="start"?0:i==="center"?e.width/-2:i==="right"||i==="end"?-e.width:0,n==="top")e.yOffset=0;else if(n==="middle")e.yOffset=e.height/-2;else if(n==="alphabetic"){let l=.79;if(o.length===1){const u=o[0];l=u.ascent/(u.ascent+u.descent)}e.yOffset=e.height*-l}else e.yOffset=-e.height;return e}GetLayoutByLines(e,i,n,o,l="",u,d){const{lineWidth:f,suffixPosition:g="end",measureMode:_=MeasureModeEnum.actualBounding,keepCenterInLine:y=!1}=d??{};e=e.map(A=>A.toString());const b=[],S=[0,0];if(typeof f=="number"&&f!==1/0){let A;for(let x=0,T=e.length;x<T;x++){const C=this.textMeasure.measureTextPixelADscentAndWidth(e[x],this.textOptions,_);let E=e[x].toString();if(C.width>f){const P=this.textMeasure.clipTextWithSuffix(e[x],this.textOptions,f,l,u,g);E=P.str,A=P.width}else A=C.width;b.push({str:E,width:A,ascent:C.ascent,descent:C.descent,keepCenterInLine:y})}S[0]=f}else{let A,x,T=0;for(let C=0,E=e.length;C<E;C++){x=e[C];const P=this.textMeasure.measureTextPixelADscentAndWidth(e[C],this.textOptions,_);A=P.width,T=Math.max(T,A),b.push({str:x,width:A,ascent:P.ascent,descent:P.descent,keepCenterInLine:y})}S[0]=T}S[1]=b.length*o,S[0]=b.reduce((A,x)=>Math.max(A,x.width),0);const v={xOffset:0,yOffset:0,width:S[0],height:S[1]};return this.LayoutBBox(v,i,n,b),this.layoutWithBBox(v,b,i,n,o)}layoutWithBBox(e,i,n,o,l){const u=[0,0],d=i.length*l;o==="top"||(o==="middle"?u[1]=(e.height-d)/2:o==="bottom"&&(u[1]=e.height-d));for(let f=0;f<i.length;f++)this.lineOffset(e,i[f],n,o,l,u);return{bbox:e,lines:i,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:l,textAlign:n,textBaseline:o}}lineOffset(e,i,n,o,l,u){if(n==="left"||n==="start"?i.leftOffset=0:n==="center"?i.leftOffset=(e.width-i.width)/2:n!=="right"&&n!=="end"||(i.leftOffset=e.width-i.width),i.topOffset=l/2+(i.ascent-i.descent)/2+u[1],!i.keepCenterInLine){const f=i.ascent+i.descent+0;if(f<l-0&&(o==="bottom"?i.topOffset+=(l-f)/2:o==="top"&&(i.topOffset-=(l-f)/2)),o==="alphabetic"){const g=l/(i.ascent+i.descent);i.topOffset=l/2+(i.ascent-i.descent)/2*g+u[1]}}return u[1]+=l,i}}const TEXT_UPDATE_TAG_KEY=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...GRAPHIC_UPDATE_TAG_KEY];let Text$1=class Pe extends Graphic{get font(){const e=this.getGraphicTheme();return this._font||(this._font=getContextFont(this.attribute,e)),this._font}get clipedText(){var e;const i=this.attribute,n=this.getGraphicTheme(),o=this.getMaxWidth(n);return Number.isFinite(o)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((e=i.text)!==null&&e!==void 0?e:n.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var e,i;const n=this.getGraphicTheme(),o=this.attribute,l=this.getMaxWidth(n);if(!Number.isFinite(l))return!1;const{text:u}=this.attribute;if(this.tryUpdateAABBBounds(),(i=(e=this.cache)===null||e===void 0?void 0:e.layoutData)===null||i===void 0?void 0:i.lines){let d="";return this.cache.layoutData.lines.forEach(f=>{d+=f.str}),(Array.isArray(u)?u.join(""):u)!==d}return o.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map(d=>d.text).join("")!==o.text.toString():this.clipedText!=null&&this.clipedText!==o.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(e={text:"",fontSize:16}){super(e),this.type="text",this.numberType=TEXT_NUMBER_TYPE,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:e}=this.attribute;return isArray(e)?!e.every(i=>i==null||i===""):e!=null&&e!==""}getGraphicTheme(){return getTheme$1(this).text}doUpdateOBBBounds(){const e=this.getGraphicTheme();this._OBBBounds.clear();const i=this.attribute,{angle:n=e.angle}=i;if(!n){const g=this.AABBBounds;return this._OBBBounds.setValue(g.x1,g.y1,g.x2,g.y2),this._OBBBounds}this.obbText||(this.obbText=new Pe({})),this.obbText.setAttributes(Object.assign(Object.assign({},i),{angle:0}));const o=this.obbText.AABBBounds,{x:l,y:u}=i,d={x:(o.x1+o.x2)/2,y:(o.y1+o.y2)/2},f=rotatePoint(d,n,{x:l,y:u});return this._OBBBounds.copy(o),this._OBBBounds.translate(f.x-d.x,f.y-d.y),this._OBBBounds.angle=n,this._OBBBounds}updateAABBBounds(e,i,n){const{text:o=i.text}=this.attribute;Array.isArray(o)?this.updateMultilineAABBBounds(o):this.updateSingallineAABBBounds(o);const{tb1:l}=application.graphicService.updateTempAABBBounds(n),{scaleX:u=i.scaleX,scaleY:d=i.scaleY,shadowBlur:f=i.shadowBlur,strokeBoundsBuffer:g=i.strokeBoundsBuffer}=e;if(f){const _=f/Math.abs(u+d);boundStroke(l,_,!0,g),n.union(l)}return application.graphicService.combindShadowAABBBounds(n,this),e.forceBoundsHeight==null&&e.forceBoundsWidth==null||application.graphicService.updateHTMLTextAABBBounds(e,i,n),transformBoundsWithMatrix(n,n,this.transMatrix),n}updateSingallineAABBBounds(e){this.updateMultilineAABBBounds([e]);const i=this.cache.layoutData;if(i&&i.lines&&i.lines.length){const n=i.lines[0];this.cache.clipedText=n.str,this.cache.clipedWidth=n.width}return this._AABBBounds}updateMultilineAABBBounds(e){const i=this.getGraphicTheme(),{direction:n=i.direction,underlineOffset:o=i.underlineOffset}=this.attribute,l=n==="horizontal"?this.updateHorizontalMultilineAABBBounds(e):this.updateVerticalMultilineAABBBounds(e);return n==="horizontal"&&o&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+o),l}guessLineHeightBuf(e){return e?.1*e:0}updateHorizontalMultilineAABBBounds(e){var i;const n=this.getGraphicTheme(),o=this.attribute,{fontFamily:l=n.fontFamily,textAlign:u=n.textAlign,textBaseline:d=n.textBaseline,fontSize:f=n.fontSize,fontWeight:g=n.fontWeight,ellipsis:_=n.ellipsis,maxLineWidth:y,stroke:b=n.stroke,wrap:S=n.wrap,measureMode:v=n.measureMode,lineWidth:A=n.lineWidth,whiteSpace:x=n.whiteSpace,suffixPosition:T=n.suffixPosition,ignoreBuf:C=n.ignoreBuf,keepCenterInLine:E=n.keepCenterInLine}=o,P=C?0:this.guessLineHeightBuf(f),L=this.getLineHeight(o,n,P);if(x==="normal"||S)return this.updateWrapAABBBounds(e);if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const I=this.cache.layoutData.bbox;return this._AABBBounds.set(I.xOffset,I.yOffset,I.xOffset+I.width,I.yOffset+I.height),b&&this._AABBBounds.expand(A/2),this._AABBBounds}const R=application.graphicUtil.textMeasure,w=new CanvasTextLayout(l,{fontSize:f,fontWeight:g,fontFamily:l,lineHeight:L},R).GetLayoutByLines(e,u,d,L,_===!0?n.ellipsis:_||void 0,!1,{lineWidth:y,suffixPosition:T,measureMode:v,keepCenterInLine:E}),{bbox:D}=w;return this.cache.layoutData=w,this.clearUpdateShapeTag(),this._AABBBounds.set(D.xOffset,D.yOffset,D.xOffset+D.width,D.yOffset+D.height),b&&this._AABBBounds.expand(A/2),this._AABBBounds}updateWrapAABBBounds(e){var i,n,o;const l=this.getGraphicTheme(),{fontFamily:u=l.fontFamily,textAlign:d=l.textAlign,textBaseline:f=l.textBaseline,fontSize:g=l.fontSize,ellipsis:_=l.ellipsis,maxLineWidth:y,stroke:b=l.stroke,lineWidth:S=l.lineWidth,wordBreak:v=l.wordBreak,fontWeight:A=l.fontWeight,ignoreBuf:x=l.ignoreBuf,measureMode:T=l.measureMode,suffixPosition:C=l.suffixPosition,heightLimit:E=0,lineClamp:P,keepCenterInLine:L=l.keepCenterInLine}=this.attribute,R=x?0:this.guessLineHeightBuf(g),w=this.getLineHeight(this.attribute,l,R);if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const G=this.cache.layoutData.bbox;return this._AABBBounds.set(G.xOffset,G.yOffset,G.xOffset+G.width,G.yOffset+G.height),b&&this._AABBBounds.expand(S/2),this._AABBBounds}const D=application.graphicUtil.textMeasure,I={fontSize:g,fontWeight:A,fontFamily:u,lineHeight:w},O=new CanvasTextLayout(u,I,D),B=isArray(e)?e.map(G=>G.toString()):[e.toString()],N=[],$=[0,0];let H=1/0;if(E>0&&(H=Math.max(Math.floor(E/w),1)),P&&(H=Math.min(H,P)),typeof y=="number"&&y!==1/0){if(y>0)for(let Y=0;Y<B.length;Y++){const J=B[Y];let q=!0;if(Y===H-1){const fe=D.clipTextWithSuffix(J,I,y,_,!1,C,Y!==B.length-1),pe=D.measureTextPixelADscentAndWidth(fe.str,I,T);N.push({str:fe.str,width:fe.width,ascent:pe.ascent,descent:pe.descent,keepCenterInLine:L});break}const te=D.clipText(J,I,y,v!=="break-all",v==="keep-all");if(J!==""&&te.str===""||te.wordBreaked){if(_){const fe=D.clipTextWithSuffix(J,I,y,_,!1,C);te.str=(n=fe.str)!==null&&n!==void 0?n:"",te.width=(o=fe.width)!==null&&o!==void 0?o:0}else te.str="",te.width=0;q=!1}const de=D.measureTextPixelADscentAndWidth(te.str,I,T);N.push({str:te.str,width:te.width,ascent:de.ascent,descent:de.descent,keepCenterInLine:L});let he=te.str.length;if(!te.wordBreaked||J!==""&&te.str===""||(q=!0,he=te.wordBreaked),te.str.length!==J.length){if(q){let fe=J.substring(he);v==="keep-all"&&(fe=fe.replace(/^\s+/g,"")),B.splice(Y+1,0,fe)}}}let G=0;N.forEach(Y=>{G=Math.max(G,Y.width)}),$[0]=G}else{let G,Y,J=0;for(let q=0,te=B.length;q<te;q++){if(q===H-1){const he=D.clipTextWithSuffix(B[q],I,y,_,!1,C),fe=D.measureTextPixelADscentAndWidth(he.str,I,T);N.push({str:he.str,width:he.width,ascent:fe.ascent,descent:fe.descent,keepCenterInLine:L}),J=Math.max(J,he.width);break}Y=B[q],G=D.measureTextWidth(Y,I),J=Math.max(J,G);const de=D.measureTextPixelADscentAndWidth(Y,I,T);N.push({str:Y,width:G,ascent:de.ascent,descent:de.descent,keepCenterInLine:L})}$[0]=J}$[1]=N.length*w;const F={xOffset:0,yOffset:0,width:$[0],height:$[1]};O.LayoutBBox(F,d,f,N);const V=O.layoutWithBBox(F,N,d,f,w);return this.cache.layoutData=V,this.clearUpdateShapeTag(),this._AABBBounds.set(F.xOffset,F.yOffset,F.xOffset+F.width,F.yOffset+F.height),b&&this._AABBBounds.expand(S/2),this._AABBBounds}updateVerticalMultilineAABBBounds(e){var i,n;const o=this.getGraphicTheme(),l=application.graphicUtil.textMeasure;let u;const d=this.attribute,{maxLineWidth:f=o.maxLineWidth,ellipsis:g=o.ellipsis,fontFamily:_=o.fontFamily,fontSize:y=o.fontSize,fontWeight:b=o.fontWeight,stroke:S=o.stroke,lineWidth:v=o.lineWidth,verticalMode:A=o.verticalMode,suffixPosition:x=o.suffixPosition}=d,T=this.getLineHeight(d,o,0);let{textAlign:C=o.textAlign,textBaseline:E=o.textBaseline}=d;if(!A){const D=C;C=(i=Pe.baselineMapAlign[E])!==null&&i!==void 0?i:"left",E=(n=Pe.alignMapBaseline[D])!==null&&n!==void 0?n:"top"}if(u=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach(B=>{const N=B.reduce(($,H)=>$+H.width,0);u=max$1(N,u)});const D=textDrawOffsetX(C,u),I=this.cache.verticalList.length*T,O=textLayoutOffsetY(E,I,y);return this._AABBBounds.set(O,D,O+I,D+u),S&&this._AABBBounds.expand(v/2),this._AABBBounds}const P=e.map(D=>verticalLayout(D.toString()));P.forEach((D,I)=>{if(Number.isFinite(f))if(g){const O=g===!0?o.ellipsis:g,B=l.clipTextWithSuffixVertical(D,{fontSize:y,fontWeight:b,fontFamily:_},f,O,!1,x);P[I]=B.verticalList,u=B.width}else{const O=l.clipTextVertical(D,{fontSize:y,fontWeight:b,fontFamily:_},f,!1);P[I]=O.verticalList,u=O.width}else u=0,D.forEach(O=>{const B=O.direction===TextDirection.HORIZONTAL?y:l.measureTextWidth(O.text,{fontSize:y,fontWeight:b,fontFamily:_});u+=B,O.width=B})}),this.cache.verticalList=P,this.clearUpdateShapeTag(),this.cache.verticalList.forEach(D=>{const I=D.reduce((O,B)=>O+B.width,0);u=max$1(I,u)});const L=textDrawOffsetX(C,u),R=this.cache.verticalList.length*T,w=textLayoutOffsetY(E,R,y);return this._AABBBounds.set(w,L,w+R,L+u),S&&this._AABBBounds.expand(v/2),this._AABBBounds}getMaxWidth(e){var i,n;const o=this.attribute;return(n=(i=o.maxLineWidth)!==null&&i!==void 0?i:o.maxWidth)!==null&&n!==void 0?n:e.maxWidth}getLineHeight(e,i,n){var o;return(o=calculateLineHeight(e.lineHeight,e.fontSize||i.fontSize))!==null&&o!==void 0?o:(e.fontSize||i.fontSize)+n}needUpdateTags(e,i=TEXT_UPDATE_TAG_KEY){return super.needUpdateTags(e,i)}needUpdateTag(e,i=TEXT_UPDATE_TAG_KEY){return super.needUpdateTag(e,i)}clone(){return new Pe(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Pe.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return Pe.baselineMapAlign}getAlignMapBaseline(){return Pe.alignMapBaseline}};Text$1.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},NOWORK_ANIMATE_ATTR),Text$1.baselineMapAlign={top:"left",bottom:"right",middle:"center"},Text$1.alignMapBaseline={left:"top",right:"bottom",center:"middle"};function createText(r){return new Text$1(r)}class BaseSymbol{bounds(e,i){if(isNumber(e)){const n=e/2;i.x1=-n,i.x2=n,i.y1=-n,i.y2=n}else i.x1=-e[0]/2,i.x2=e[0]/2,i.y1=-e[1]/2,i.y2=e[1]/2}parseSize(e){return isNumber(e)?e:Math.min(e[0],e[1])}}function circle$1(r,e,i,n,o){return o?r.arc(i,n,e,0,tau$1,!1,o):r.arc(i,n,e,0,tau$1),!1}class CircleSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(e,i,n,o,l){return circle$1(e,this.parseSize(i)/2,n,o,l)}drawOffset(e,i,n,o,l,u){return circle$1(e,this.parseSize(i)/2+l,n,o,u)}drawToSvgPath(e,i,n,o){const l=this.parseSize(e)/2;return`M ${i-l}, ${n} a ${l},${l} 0 1,0 ${2*l},0 a ${l},${l} 0 1,0 -${2*l},0`}}const circle$2=new CircleSymbol;function cross(r,e,i,n,o){return r.moveTo(-3*e+i,-e+n,o),r.lineTo(-e+i,-e+n,o),r.lineTo(-e+i,-3*e+n,o),r.lineTo(e+i,-3*e+n,o),r.lineTo(e+i,-e+n,o),r.lineTo(3*e+i,-e+n,o),r.lineTo(3*e+i,e+n,o),r.lineTo(e+i,e+n,o),r.lineTo(e+i,3*e+n,o),r.lineTo(-e+i,3*e+n,o),r.lineTo(-e+i,e+n,o),r.lineTo(-3*e+i,e+n,o),r.closePath(),!0}function crossOffset(r,e,i,n,o,l){return r.moveTo(-3*e+i-o,-e+n-o,l),r.lineTo(-e+i-o,-e+n-o,l),r.lineTo(-e+i-o,-3*e+n-o,l),r.lineTo(e+i+o,-3*e+n-o,l),r.lineTo(e+i+o,-e+n-o,l),r.lineTo(3*e+i+o,-e+n-o,l),r.lineTo(3*e+i+o,e+n+o,l),r.lineTo(e+i+o,e+n+o,l),r.lineTo(e+i+o,3*e+n+o,l),r.lineTo(-e+i-o,3*e+n+o,l),r.lineTo(-e+i-o,e+n+o,l),r.lineTo(-3*e+i-o,e+n+o,l),r.closePath(),!0}class CrossSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(e,i,n,o,l){return cross(e,this.parseSize(i)/6,n,o,l)}drawOffset(e,i,n,o,l,u){return crossOffset(e,this.parseSize(i)/6,n,o,l,u)}}const cross$1=new CrossSymbol;function diamond$1(r,e,i,n,o){return r.moveTo(i,n-e,o),r.lineTo(e+i,n,o),r.lineTo(i,n+e,o),r.lineTo(i-e,n,o),r.closePath(),!0}class DiamondSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(e,i,n,o,l){return diamond$1(e,this.parseSize(i)/2,n,o,l)}drawFitDir(e,i,n,o,l){return diamond$1(e,this.parseSize(i)/2,n,o,l)}drawOffset(e,i,n,o,l,u){return diamond$1(e,this.parseSize(i)/2+l,n,o,u)}}const diamond$2=new DiamondSymbol;function square$2(r,e,i,n){const o=2*e;return r.rect(i-e,n-e,o,o),!1}class SquareSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(e,i,n,o){return square$2(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return square$2(e,this.parseSize(i)/2+l,n,o)}}const square$3=new SquareSymbol;function trianglUpOffset(r,e,i,n,o=0){return r.moveTo(i+e+2*o,e+n+o),r.lineTo(i-e-2*o,e+n+o),r.lineTo(i,n-e-2*o),r.closePath(),!0}class TriangleUpSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(e,i,n,o){return trianglUpOffset(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return trianglUpOffset(e,this.parseSize(i)/2,n,o,l)}}const triangleUp=new TriangleUpSymbol;class TriangleSymbol extends TriangleUpSymbol{constructor(){super(...arguments),this.type="triangle"}}const triangle$1=new TriangleSymbol,kr=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),kx=Math.sin(tau$1/10)*kr,ky=-Math.cos(tau$1/10)*kr;function star$1(r,e,i,n){const o=kx*e,l=ky*e;r.moveTo(i,-e+n),r.lineTo(o+i,l+n);for(let u=1;u<5;++u){const d=tau$1*u/5,f=Math.cos(d),g=Math.sin(d);r.lineTo(g*e+i,-f*e+n),r.lineTo(f*o-g*l+i,g*o+f*l+n)}return r.closePath(),!0}class StarSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(e,i,n,o){return star$1(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return star$1(e,this.parseSize(i)/2+l,n,o)}}const star$2=new StarSymbol,sqrt3$1=sqrt$3(3);function arrow(r,e,i,n){const o=e,l=o/sqrt3$1,u=l/5,d=e;return r.moveTo(0+i,-o+n),r.lineTo(l/2+i,n),r.lineTo(u/2+i,n),r.lineTo(u/2+i,d+n),r.lineTo(-u/2+i,d+n),r.lineTo(-u/2+i,n),r.lineTo(-l/2+i,n),r.closePath(),!0}class ArrowSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(e,i,n,o){return arrow(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return arrow(e,this.parseSize(i)/2+l,n,o)}}const arrow$1=new ArrowSymbol;function wedge(r,e,i,n){const o=2*e;return r.moveTo(i,-e+n),r.lineTo(o/3/2+i,e+n),r.lineTo(-o/3/2+i,e+n),r.closePath(),!0}class WedgeSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(e,i,n,o){return wedge(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return wedge(e,this.parseSize(i)/2+l,n,o)}}const wedge$1=new WedgeSymbol;function stroke(r,e,i,n){return r.moveTo(-e+i,n),r.lineTo(i,e+n),!1}class StrokeSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(e,i,n,o){return stroke(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return stroke(e,this.parseSize(i)/2+l,n,o)}}const stroke$1=new StrokeSymbol,c$1=-.5,s=sqrt$3(3)/2,k=1/sqrt$3(12);function wye(r,e,i,n){const o=e/2,l=e*k,u=o,d=e*k+e,f=-u,g=d;return r.moveTo(o+i,l+n),r.lineTo(u+i,d+n),r.lineTo(f+i,g+n),r.lineTo(c$1*o-s*l+i,s*o+c$1*l+n),r.lineTo(c$1*u-s*d+i,s*u+c$1*d+n),r.lineTo(c$1*f-s*g+i,s*f+c$1*g+n),r.lineTo(c$1*o+s*l+i,c$1*l-s*o+n),r.lineTo(c$1*u+s*d+i,c$1*d-s*u+n),r.lineTo(c$1*f+s*g+i,c$1*g-s*f+n),r.closePath(),!1}class WyeSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(e,i,n,o){return wye(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return wye(e,this.parseSize(i)/2+l,n,o)}}const wye$1=new WyeSymbol;function trianglLeftOffset(r,e,i,n,o){return r.moveTo(-e+i-2*o,n),r.lineTo(e+i+o,e+n+2*o),r.lineTo(e+i+o,n-e-2*o),r.closePath(),!0}class TriangleLeftSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(e,i,n,o){return trianglLeftOffset(e,this.parseSize(i)/2,n,o,0)}drawOffset(e,i,n,o,l){return trianglLeftOffset(e,this.parseSize(i)/2,n,o,l)}}const triangleLeft=new TriangleLeftSymbol;function trianglRightOffset(r,e,i,n,o=0){return r.moveTo(i-e-o,e+n+2*o),r.lineTo(e+i+2*o,n),r.lineTo(i-e-o,n-e-2*o),r.closePath(),!0}class TriangleRightSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(e,i,n,o){return trianglRightOffset(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return trianglRightOffset(e,this.parseSize(i)/2,n,o,l)}}const triangleRight=new TriangleRightSymbol;function trianglDownOffset(r,e,i,n,o=0){return r.moveTo(i-e-2*o,n-e-o),r.lineTo(i+e+2*o,n-e-o),r.lineTo(i,n+e+2*o),r.closePath(),!0}class TriangleDownSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(e,i,n,o){return trianglDownOffset(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l){return trianglDownOffset(e,this.parseSize(i)/2,n,o,l)}}const triangleDown=new TriangleDownSymbol,sqrt3=sqrt$3(3);function thinTriangle(r,e,i,n){const o=e*sqrt3;return r.moveTo(i,n+-o/3*2),r.lineTo(e+i,n+o),r.lineTo(i-e,n+o),r.closePath(),!0}class ThinTriangleSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(e,i,n,o){return thinTriangle(e,this.parseSize(i)/2/sqrt3,n,o)}drawOffset(e,i,n,o,l){return thinTriangle(e,this.parseSize(i)/2/sqrt3+l,n,o)}}const thinTriangle$1=new ThinTriangleSymbol;function arrow2Left(r,e,i,n){const o=2*e;return r.moveTo(e+i,n-o),r.lineTo(i-e,n),r.lineTo(e+i,o+n),!0}class Arrow2LeftSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(e,i,n,o){return arrow2Left(e,this.parseSize(i)/4,n,o)}drawOffset(e,i,n,o,l){return arrow2Left(e,this.parseSize(i)/4+l,n,o)}}const arrow2Left$1=new Arrow2LeftSymbol;function arrow2Right(r,e,i,n){const o=2*e;return r.moveTo(i-e,n-o),r.lineTo(i+e,n),r.lineTo(i-e,o+n),!0}class Arrow2RightSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(e,i,n,o){return arrow2Right(e,this.parseSize(i)/4,n,o)}drawOffset(e,i,n,o,l){return arrow2Right(e,this.parseSize(i)/4+l,n,o)}}const arrow2Right$1=new Arrow2RightSymbol;function arrow2Up(r,e,i,n){const o=2*e;return r.moveTo(i-o,n+e),r.lineTo(i,n-e),r.lineTo(i+o,n+e),!0}class Arrow2UpSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(e,i,n,o){return arrow2Up(e,this.parseSize(i)/4,n,o)}drawOffset(e,i,n,o,l){return arrow2Up(e,this.parseSize(i)/4+l,n,o)}}const arrow2Up$1=new Arrow2UpSymbol;function arrow2Down(r,e,i,n){const o=2*e;return r.moveTo(i-o,n-e),r.lineTo(i,n+e),r.lineTo(i+o,n-e),!0}class Arrow2DownSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(e,i,n,o){return arrow2Down(e,this.parseSize(i)/4,n,o)}drawOffset(e,i,n,o,l){return arrow2Down(e,this.parseSize(i)/4+l,n,o)}}const arrow2Down$1=new Arrow2DownSymbol;function lineV(r,e,i,n,o){return r.moveTo(i,n-e),r.lineTo(i,n+e),!0}class LineVSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(e,i,n,o,l){return lineV(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l,u){return lineV(e,this.parseSize(i)/2+l,n,o)}drawToSvgPath(e,i,n,o){const l=this.parseSize(e)/2;return`M ${i}, ${n-l} L ${i},${n+l}`}}const lineV$1=new LineVSymbol;function lineH(r,e,i,n,o){return r.moveTo(i-e,n),r.lineTo(i+e,n),!0}class LineHSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(e,i,n,o,l){return lineH(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l,u){return lineH(e,this.parseSize(i)/2+l,n,o)}drawToSvgPath(e,i,n,o){const l=this.parseSize(e)/2;return`M ${i-l}, ${n} L ${i+l},${n}`}}const lineH$1=new LineHSymbol;function close(r,e,i,n,o){return r.moveTo(i-e,n-e),r.lineTo(i+e,n+e),r.moveTo(i+e,n-e),r.lineTo(i-e,n+e),!0}class CloseSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(e,i,n,o,l){return close(e,this.parseSize(i)/2,n,o)}drawOffset(e,i,n,o,l,u){return close(e,this.parseSize(i)/2+l,n,o)}drawToSvgPath(e,i,n,o){const l=this.parseSize(e)/2;return`M ${i-l}, ${n-l} L ${i+l},${n+l} M ${i+l}, ${n-l} L ${i-l},${n+l}`}}const close$1=new CloseSymbol;function rectSizeArray(r,e,i,n){return r.rect(i-e[0]/2,n-e[1]/2,e[0],e[1]),!1}function rectSize(r,e,i,n){const o=e,l=e/2;return r.rect(i-o/2,n-l/2,o,l),!1}class RectSymbol extends BaseSymbol{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(e,i,n,o){return isNumber(i)?rectSize(e,i,n,o):rectSizeArray(e,i,n,o)}drawOffset(e,i,n,o,l){return isNumber(i)?rectSize(e,i+2*l,n,o):rectSizeArray(e,[i[0]+2*l,i[1]+2*l],n,o)}}const rect=new RectSymbol,tempBounds=new AABBBounds;class CustomSymbolClass{constructor(e,i,n=!1){this.pathStr="",this.type=e,isArray(i)?this.svgCache=i:this.path=i,this.isSvg=n}drawOffset(e,i,n,o,l,u,d){return i=this.parseSize(i),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(f=>{e.beginPath(),renderCommandList(f.path.commandList,e,n,o,i,i),d&&d(f.path,f.attribute)}),!1):(renderCommandList(this.path.commandList,e,n,o,i+l,i+l),!1)}draw(e,i,n,o,l,u){return i=this.parseSize(i),this.drawOffset(e,i,n,o,0,l,u)}parseSize(e){return isNumber(e)?e:Math.min(e[0],e[1])}bounds(e,i){if(e=this.parseSize(e),this.isSvg)return this.svgCache?(i.clear(),void this.svgCache.forEach(({path:n})=>{tempBounds.x1=n.bounds.x1*e,tempBounds.y1=n.bounds.y1*e,tempBounds.x2=n.bounds.x2*e,tempBounds.y2=n.bounds.y2*e,i.union(tempBounds)})):void 0;this.path.bounds&&(i.x1=this.path.bounds.x1*e,i.y1=this.path.bounds.y1*e,i.x2=this.path.bounds.x2*e,i.y2=this.path.bounds.y2*e)}}const builtinSymbols=[circle$2,cross$1,diamond$2,square$3,thinTriangle$1,triangle$1,star$2,arrow$1,wedge$1,stroke$1,wye$1,triangleLeft,triangleRight,triangleUp,triangleDown,arrow2Left$1,arrow2Right$1,arrow2Up$1,arrow2Down$1,rect,lineV$1,lineH$1,close$1],builtinSymbolsMap={};builtinSymbols.forEach(r=>{builtinSymbolsMap[r.type]=r});const builtInSymbolStrMap={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"},updateBoundsOfSymbolOuterBorder=(r,e,i)=>{const{outerBorder:n,shadowBlur:o=e.shadowBlur,strokeBoundsBuffer:l=e.strokeBoundsBuffer}=r;if(n){const u=e.outerBorder,{distance:d=u.distance,lineWidth:f=u.lineWidth}=n;boundStroke(i,d+(o+f)/2,!0,l)}return i},_tempBounds=new AABBBounds,SYMBOL_UPDATE_TAG_KEY=["symbolType","size",...GRAPHIC_UPDATE_TAG_KEY];let Symbol$1=class Re extends Graphic{constructor(e={symbolType:"circle"}){super(e),this.type="symbol",this.numberType=SYMBOL_NUMBER_TYPE}getParsedPath(){return this.shouldUpdateShape()&&(this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:e}=this.attribute;return isArray(e)?e.length===2&&e.every(this._validNumber):this._validNumber(e)}doUpdateParsedPath(){const e=this.getGraphicTheme();let{symbolType:i=e.symbolType}=this.attribute,n=builtinSymbolsMap[i];if(n)return this._parsedPath=n,n;if(n=Re.userSymbolMap[i],n)return this._parsedPath=n,n;if(i=builtInSymbolStrMap[i]||i,isSvg(i)===!0){const f=new XMLParser,{svg:g}=f.parse(i);if(!g)return null;const _=isArray(g.path)?g.path:[g.path];_tempBounds.clear();const y=[];_.forEach(A=>{const x=new CustomPath2D().fromString(A.d),T={};SVG_PARSE_ATTRIBUTE_MAP_KEYS.forEach(C=>{A[C]&&(T[SVG_PARSE_ATTRIBUTE_MAP[C]]=A[C])}),y.push({path:x,attribute:T}),_tempBounds.union(x.bounds)});const b=_tempBounds.width(),S=_tempBounds.height(),v=1/max$1(b,S);return y.forEach(A=>A.path.transform(0,0,v,v)),this._parsedPath=new CustomSymbolClass(i,y,!0),Re.userSymbolMap[i]=this._parsedPath,this._parsedPath}const o=new CustomPath2D().fromString(i),l=o.bounds.width(),u=o.bounds.height(),d=1/max$1(l,u);return o.transform(0,0,d,d),this._parsedPath=new CustomSymbolClass(i,o),Re.userSymbolMap[i]=this._parsedPath,this._parsedPath}getGraphicTheme(){return getTheme$1(this).symbol}updateAABBBounds(e,i,n,o){this.updatePathProxyAABBBounds(n)||(o?this.updateSymbolAABBBoundsImprecise(e,i,n):this.updateSymbolAABBBoundsAccurate(e,i,n));const{tb1:l,tb2:u}=application.graphicService.updateTempAABBBounds(n);updateBoundsOfSymbolOuterBorder(e,i,l),n.union(l),l.setValue(u.x1,u.y1,u.x2,u.y2);const{lineJoin:d=i.lineJoin}=e;return application.graphicService.transformAABBBounds(e,n,i,d==="miter",this),n}updateSymbolAABBBoundsImprecise(e,i,n){const{size:o=i.size}=e;if(isArray(o))n.set(-o[0]/2,-o[1]/2,o[0]/2,o[1]/2);else{const l=o/2;n.set(-l,-l,l,l)}return n}updateSymbolAABBBoundsAccurate(e,i,n){const{size:o=i.size}=e;return this.getParsedPath().bounds(o,n),n}needUpdateTags(e){return super.needUpdateTags(e,SYMBOL_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,SYMBOL_UPDATE_TAG_KEY)}toCustomPath(){const e=this.getParsedPath(),i=this.attribute.size,n=isArray(i)?i:[i,i];return e.path?new CustomPath2D().fromCustomPath2D(e.path,0,0,n[0],n[1]):new CustomPath2D().fromString(e.pathStr,0,0,n[0],n[1])}clone(){return new Re(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Re.NOWORK_ANIMATE_ATTR}};Symbol$1.userSymbolMap={},Symbol$1.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},NOWORK_ANIMATE_ATTR);function createSymbol(r){return new Symbol$1(r)}const LINE_UPDATE_TAG_KEY=["segments","points","curveType","curveTension",...GRAPHIC_UPDATE_TAG_KEY];let Line$1=class De extends Graphic{constructor(e={}){super(e),this.type="line",this.numberType=LINE_NUMBER_TYPE}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:e,segments:i}=this.attribute;return i?i.length!==0:!!e&&!(e.length<=1)}_interpolate(e,i,n,o,l){e==="points"&&(l.points=pointsInterpolation(n,o,i))}getGraphicTheme(){return getTheme$1(this).line}updateAABBBounds(e,i,n){this.updatePathProxyAABBBounds(n)||(e.segments?this.updateLineAABBBoundsBySegments(e,i,n):this.updateLineAABBBoundsByPoints(e,i,n)),application.graphicService.updateTempAABBBounds(n);const{lineJoin:o=i.lineJoin}=e;return application.graphicService.transformAABBBounds(e,n,i,o==="miter",this),n}updateLineAABBBoundsByPoints(e,i,n,o){const{points:l=i.points,connectedType:u}=e,d=n;return l.forEach(f=>{f.defined===!1&&u!=="connect"||d.add(f.x,f.y)}),d}updateLineAABBBoundsBySegments(e,i,n,o){const{segments:l=i.segments,connectedType:u}=e,d=n;return l.forEach(f=>{f.points.forEach(g=>{g.defined===!1&&u!=="connect"||d.add(g.x,g.y)})}),d}needUpdateTags(e){return super.needUpdateTags(e,LINE_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,LINE_UPDATE_TAG_KEY)}toCustomPath(){const e=this.attribute,i=new CustomPath2D,n=e.segments,o=l=>{if(l&&l.length){let u=!0;l.forEach(d=>{d.defined!==!1&&(u?i.moveTo(d.x,d.y):i.lineTo(d.x,d.y),u=!1)})}};return n&&n.length?n.forEach(l=>{o(l.points)}):e.points&&o(e.points),i}clone(){return new De(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return De.NOWORK_ANIMATE_ATTR}};Line$1.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},NOWORK_ANIMATE_ATTR);function createLine(r){return new Line$1(r)}const RECT_UPDATE_TAG_KEY=["width","x1","y1","height","cornerRadius",...GRAPHIC_UPDATE_TAG_KEY];class Rect extends Graphic{constructor(e){super(e),this.type="rect",this.numberType=RECT_NUMBER_TYPE}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return getTheme$1(this).rect}updateAABBBounds(e,i,n){if(!this.updatePathProxyAABBBounds(n)){let{width:u,height:d}=e;const{x1:f,y1:g,x:_,y}=e;u=u??f-_,d=d??g-y,(isFinite(u)||isFinite(d)||isFinite(_)||isFinite(y))&&n.set(0,0,u||0,d||0)}const{tb1:o,tb2:l}=application.graphicService.updateTempAABBBounds(n);return updateBoundsOfCommonOuterBorder(e,i,o),n.union(o),o.setValue(l.x1,l.y1,l.x2,l.y2),application.graphicService.transformAABBBounds(e,n,i,!1,this),n}needUpdateTags(e){return super.needUpdateTags(e,RECT_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,RECT_UPDATE_TAG_KEY)}toCustomPath(){const e=this.attribute,{x:i,y:n,width:o,height:l}=normalizeRectAttributes(e),u=new CustomPath2D;return u.moveTo(i,n),u.rect(i,n,o,l),u}clone(){return new Rect(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Rect.NOWORK_ANIMATE_ATTR}}Rect.NOWORK_ANIMATE_ATTR=NOWORK_ANIMATE_ATTR;function createRect(r){return new Rect(r)}const CUBE_VERTICES=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]];class Rect3d extends Rect{constructor(e){super(e),this.type="rect3d",this.numberType=RECT3D_NUMBER_TYPE}findFace(){const e={polygons:[],vertices:[],edges:[]},i=this.getGraphicTheme(),{x1:n,y1:o,x:l,y:u,length:d=min$1(i.width,i.height)}=this.attribute;let{width:f,height:g}=this.attribute;f=f??n-l,g=g??o-u;for(let _=0;_<CUBE_VERTICES.length;_++){const y=CUBE_VERTICES[_];e.vertices.push([y[0]*f,y[1]*g,y[2]*d])}return e.polygons.push({polygon:[0,1,5,4],normal:[0,-1,0]}),e.polygons.push({polygon:[2,3,7,6],normal:[0,1,0]}),e.polygons.push({polygon:[4,7,3,0],normal:[-1,0,0]}),e.polygons.push({polygon:[1,2,6,5],normal:[1,0,0]}),e.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),e.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),e.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],e}getNoWorkAnimateAttr(){return Rect3d.NOWORK_ANIMATE_ATTR}}Rect3d.NOWORK_ANIMATE_ATTR=NOWORK_ANIMATE_ATTR;function createRect3d(r){return new Rect3d(r)}class Glyph extends Graphic{constructor(e){super(e),this.type="glyph",this.numberType=GLYPH_NUMBER_TYPE,this.subGraphic=[],this._onInit&&this._onInit(this),this.valid=this.isValid()}setSubGraphic(e){this.detachSubGraphic(),this.subGraphic=e,e.forEach(i=>{i.glyphHost=this,Object.setPrototypeOf(i.attribute,this.attribute)}),this.valid=this.isValid(),this.addUpdateBoundTag()}detachSubGraphic(){this.subGraphic.forEach(e=>{e.glyphHost=null,Object.setPrototypeOf(e.attribute,{})})}getSubGraphic(){return this.subGraphic}onInit(e){this._onInit=e}onUpdate(e){this._onUpdate=e}isValid(){return!0}setAttribute(e,i,n,o){super.setAttribute(e,i,n,o),this.subGraphic.forEach(l=>{l.addUpdateShapeAndBoundsTag(),l.addUpdatePositionTag()})}setAttributes(e,i=!1,n){super.setAttributes(e,i,n),this.subGraphic.forEach(o=>{o.addUpdateShapeAndBoundsTag(),o.addUpdatePositionTag()})}translate(e,i){return super.translate(e,i),this.subGraphic.forEach(n=>{n.addUpdatePositionTag(),n.addUpdateBoundTag()}),this}translateTo(e,i){return super.translateTo(e,i),this.subGraphic.forEach(n=>{n.addUpdatePositionTag(),n.addUpdateBoundTag()}),this}scale(e,i,n){return super.scale(e,i,n),this.subGraphic.forEach(o=>{o.addUpdatePositionTag(),o.addUpdateBoundTag()}),this}scaleTo(e,i){return super.scaleTo(e,i),this.subGraphic.forEach(n=>{n.addUpdatePositionTag(),n.addUpdateBoundTag()}),this}rotate(e){return super.rotate(e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}rotateTo(e){return super.rotate(e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}getGraphicTheme(){return getTheme$1(this).glyph}updateAABBBounds(e,i,n){return this.getSubGraphic().forEach(o=>{n.union(o.AABBBounds)}),n}doUpdateAABBBounds(){this.updateAABBBoundsStamp++,this._AABBBounds.clear();const e=this.updateAABBBounds(this.attribute,this.getGraphicTheme(),this._AABBBounds);return this.clearUpdateBoundTag(),e}needUpdateTags(e){return!1}needUpdateTag(e){return!1}useStates(e,i){var n;if(!e.length)return void this.clearStates(i);if(!(((n=this.currentStates)===null||n===void 0?void 0:n.length)!==e.length||e.some((u,d)=>this.currentStates[d]!==u)))return;this.stopStateAnimates();const o={},l=this.subGraphic.map(()=>({}));e.forEach(u=>{var d;const f=this.glyphStateProxy?this.glyphStateProxy(u,e):this.glyphStates[u];f&&(Object.assign(o,f.attributes),!((d=f.subAttributes)===null||d===void 0)&&d.length&&l.forEach((g,_)=>{Object.assign(g,f.subAttributes[_])}))}),this.subGraphic.forEach((u,d)=>{u.updateNormalAttrs(l[d]),u.applyStateAttrs(l[d],e,i)}),this.updateNormalAttrs(o),this.currentStates=e,this.applyStateAttrs(o,e,i)}clearStates(e){this.stopStateAnimates(),this.hasState()&&this.normalAttrs?(this.currentStates=[],this.subGraphic.forEach(i=>{i.applyStateAttrs(i.normalAttrs,this.currentStates,e,!0),i.normalAttrs=null}),this.applyStateAttrs(this.normalAttrs,this.currentStates,e,!0)):this.currentStates=[],this.normalAttrs=null}clone(){const e=new Glyph(Object.assign({},this.attribute));return e.setSubGraphic(this.subGraphic.map(i=>i.clone())),e}getNoWorkAnimateAttr(){return Glyph.NOWORK_ANIMATE_ATTR}}Glyph.NOWORK_ANIMATE_ATTR=NOWORK_ANIMATE_ATTR;function createGlyph(r){return new Glyph(r)}class Frame{constructor(e,i,n,o,l,u,d,f,g,_,y,b,S,v){this.left=e,this.top=i,this.width=n,this.height=o,this.actualHeight=0,this.bottom=i+o,this.right=e+n,this.ellipsis=l,this.wordBreak=u,this.verticalDirection=d,this.lines=[],this.globalAlign=f,this.globalBaseline=g,this.layoutDirection=_,this.directionKey=DIRECTION_KEY[this.layoutDirection],this.isWidthMax=y,this.isHeightMax=b,this.singleLine=S,v?(v.clear(),this.icons=v):this.icons=new Map}draw(e,i){const{width:n,height:o}=this.getActualSize(),l=this.isWidthMax?Math.min(this.width,n):this.width||n||0;let u=this.isHeightMax?Math.min(this.height,o):this.height||o||0;u=Math.min(u,o);let d=0;switch(this.globalBaseline){case"top":d=0;break;case"middle":d=-u/2;break;case"bottom":d=-u}let f=0;this.globalAlign==="right"||this.globalAlign==="end"?f=-l:this.globalAlign==="center"&&(f=-l/2);let g=this[this.directionKey.height];this.singleLine&&(g=this.lines[0].height+1);let _=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=g&&g!==0)for(let y=0;y<this.lines.length;y++){const{top:b,height:S}=this.lines[y];if(b+S<this[this.directionKey.top]||b+S>this[this.directionKey.top]+g)return _;let v=!1;this.ellipsis&&this.lines[y+1]&&this.lines[y+1].top+this.lines[y+1].height>this[this.directionKey.top]+g&&(v=!0,_=!0),this.lines[y].draw(e,v,this.lines[y][this.directionKey.left]+f,this.lines[y][this.directionKey.top]+d,this.ellipsis,i)}else{const y=Math.floor((g-this.actualHeight)/2);this.layoutDirection==="vertical"?f+=y:d+=y;for(let b=0;b<this.lines.length;b++)this.lines[b].draw(e,!1,this.lines[b][this.directionKey.left]+f,this.lines[b][this.directionKey.top]+d,this.ellipsis,i)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let y=0;y<this.lines.length;y++){const{top:b,height:S}=this.lines[y],v=g-this.lines[y].top-this.lines[y].height;if(g===0)this.lines[y].draw(e,!1,f,v+d,this.ellipsis,i);else{if(v+S>this[this.directionKey.top]+g||v<this[this.directionKey.top])return _;{let A=!1;this.ellipsis&&this.lines[y+1]&&v-this.lines[y+1].height<this[this.directionKey.top]&&(A=!0,_=!0),this.lines[y].draw(e,A,f,v+d,this.ellipsis,i)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(f+=this.lines[0].height+1);for(let y=0;y<this.lines.length;y++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(f-=this.lines[y].height+this.lines[y].top);const{top:b,height:S}=this.lines[y];if(g===0)this.lines[y].draw(e,!1,this.lines[y][this.directionKey.left]+f,this.lines[y][this.directionKey.top]+d,this.ellipsis,i);else{if(b+S<this[this.directionKey.top]||b+S>this[this.directionKey.top]+g)return _;{let v=!1;this.ellipsis&&this.lines[y+1]&&this.lines[y+1].top+this.lines[y+1].height>this[this.directionKey.top]+g&&(v=!0,_=!0),this.lines[y].draw(e,v,this.lines[y][this.directionKey.left]+f,this.lines[y][this.directionKey.top]+d,this.ellipsis,i)}}}}return _}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let e=0,i=0;for(let n=0;n<this.lines.length;n++){const o=this.lines[n];o.actualWidth>e&&(e=o.actualWidth),i+=o.height}return{width:this.layoutDirection==="vertical"?i:e,height:this.layoutDirection==="vertical"?e:i}}getActualSizeWidthEllipsis(){let e=0,i=0;const{width:n,height:o}=this.getRawActualSize();this.width,this.height;let l=this[this.directionKey.height];if(this.singleLine&&(l=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=l&&l!==0)for(let u=0;u<this.lines.length;u++){const{top:d,height:f}=this.lines[u];if(!(d+f<this[this.directionKey.top]||d+f>this[this.directionKey.top]+l))if(this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+l){const g=this.ellipsis===!0?"...":this.ellipsis||"",_=this.lines[u].getWidthWithEllips(g);_>e&&(e=_),i+=this.lines[u].height}else this.lines[u].actualWidth>e&&(e=this.lines[u].actualWidth),i+=this.lines[u].height}else{Math.floor((l-this.actualHeight)/2);for(let u=0;u<this.lines.length;u++)this.lines[u].actualWidth>e&&(e=this.lines[u].actualWidth),i+=this.lines[u].height}else if(this.verticalDirection==="bottom")for(let u=0;u<this.lines.length;u++){const{top:d,height:f}=this.lines[u],g=l-this.lines[u].top-this.lines[u].height;if(l===0)this.lines[u].actualWidth>e&&(e=this.lines[u].actualWidth),i+=this.lines[u].height;else if(!(g+f>this[this.directionKey.top]+l||g<this[this.directionKey.top]))if(this.ellipsis&&this.lines[u+1]&&g-this.lines[u+1].height<this[this.directionKey.top]){const _=this.ellipsis===!0?"...":this.ellipsis||"",y=this.lines[u].getWidthWithEllips(_);y>e&&(e=y),i+=this.lines[u].height}else this.lines[u].actualWidth>e&&(e=this.lines[u].actualWidth),i+=this.lines[u].height}else for(let u=0;u<this.lines.length;u++){const{top:d,height:f}=this.lines[u];if(l===0)this.lines[u].actualWidth>e&&(e=this.lines[u].actualWidth),i+=this.lines[u].height;else if(!(d+f<this[this.directionKey.top]||d+f>this[this.directionKey.top]+l))if(this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+l){const g=this.ellipsis===!0?"...":this.ellipsis||"",_=this.lines[u].getWidthWithEllips(g);_>e&&(e=_),i+=this.lines[u].height}else this.lines[u].actualWidth>e&&(e=this.lines[u].actualWidth),i+=this.lines[u].height}return{width:this.layoutDirection==="vertical"?i:e,height:this.layoutDirection==="vertical"?e:i}}}class Paragraph{constructor(e,i,n){this.fontSize=n.fontSize||16,this.textBaseline=n.textBaseline||"alphabetic";const o=calculateLineHeight(n.lineHeight,this.fontSize);this.lineHeight=typeof o=="number"?o>this.fontSize?o:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:l,height:u,descent:d,width:f}=measureTextCanvas(e,n);let g=0,_=0,y=0;this.height>u&&(g=(this.height-u)/2,_=Math.ceil(g),y=Math.floor(g)),this.textBaseline==="top"?(this.ascent=g,this.descent=u-g):this.textBaseline==="bottom"?(this.ascent=u-g,this.descent=g):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=l+_,this.descent=d+y),this.length=e.length,this.width=f||0,this.text=e||"",this.newLine=i||!1,this.character=n,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,n.direction==="vertical"&&(this.direction=n.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:e}=measureTextCanvas(this.text,this.character);this.width=e,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}draw(e,i,n,o,l){let u=this.text,d=this.left+n;i+=this.top;let f=this.direction;if(this.verticalEllipsis)u=this.ellipsisStr,f="vertical",i-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")u+=this.ellipsisStr,l!=="right"&&l!=="end"||(d-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const _=getStrByWithCanvas(u,(f==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,u.length-1);if(u=u.slice(0,_),u+=this.ellipsisStr,l==="right"||l==="end"){const{width:y}=measureTextCanvas(this.text.slice(_),this.character);f==="vertical"||(d-=this.ellipsisWidth-y)}}}switch(this.character.script){case"super":i-=this.ascent*(1/3);break;case"sub":i+=this.descent/2}f==="vertical"&&(e.save(),e.rotateAbout(Math.PI/2,d,i),e.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),e.translate(d,i),d=0,i=0);const{lineWidth:g=1}=this.character;this.character.stroke&&g&&e.strokeText(u,d,i),this.character.fill&&e.fillText(u,d,i),this.character.fill&&(typeof this.character.lineThrough=="boolean"||typeof this.character.underline=="boolean"?(this.character.underline&&e.fillRect(d,1+i,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1),this.character.lineThrough&&e.fillRect(d,1+i-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)):this.character.textDecoration==="underline"?e.fillRect(d,1+i,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1):this.character.textDecoration==="line-through"&&e.fillRect(d,1+i-this.ascent/2,this.widthOrigin||this.width,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)),f==="vertical"&&e.restore()}getWidthWithEllips(e){let i=this.text;const n=e==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return n;if(this.ellipsis==="add")return n+this.ellipsisWidth;if(this.ellipsis==="replace"){const o=getStrByWithCanvas(i,n-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,i.length-1);i=i.slice(0,o),i+=this.ellipsisStr;const{width:l}=measureTextCanvas(this.text.slice(o),this.character);return n+this.ellipsisWidth-l}return n}}function seperateParagraph(r,e){const i=r.text.slice(0,e),n=r.text.slice(e);return[new Paragraph(i,r.newLine,r.character),new Paragraph(n,!0,r.character)]}const IMAGE_UPDATE_TAG_KEY=["width","height","image",...GRAPHIC_UPDATE_TAG_KEY];class Image extends Graphic{constructor(e){super(e),this.type="image",this.numberType=IMAGE_NUMBER_TYPE,this.loadImage(this.attribute.image)}get width(){var e;return(e=this.attribute.width)!==null&&e!==void 0?e:0}set width(e){this.attribute.width===e&&(this.attribute.width=e,this.addUpdateShapeAndBoundsTag())}get height(){var e;return(e=this.attribute.height)!==null&&e!==void 0?e:0}set height(e){this.attribute.height===e&&(this.attribute.height=e,this.addUpdateShapeAndBoundsTag())}get repeatX(){var e;return(e=this.attribute.repeatX)!==null&&e!==void 0?e:"no-repeat"}set repeatX(e){this.attribute.repeatX===e&&(this.attribute.repeatX=e)}get repeatY(){var e;return(e=this.attribute.repeatY)!==null&&e!==void 0?e:"no-repeat"}set repeatY(e){this.attribute.repeatY===e&&(this.attribute.repeatY=e)}get image(){return this.attribute.image}set image(e){e!==this.attribute.image&&(this.attribute.image=e,this.loadImage(this.attribute.image))}imageLoadSuccess(e,i,n){super.imageLoadSuccess(e,i,()=>{this.successCallback&&this.successCallback()})}imageLoadFail(e,i){super.imageLoadFail(e,()=>{this.failCallback&&this.failCallback()})}setAttributes(e,i,n){return e.image&&this.loadImage(e.image),super.setAttributes(e,i,n)}setAttribute(e,i,n,o){return e==="image"&&this.loadImage(i),super.setAttribute(e,i,n,o)}getGraphicTheme(){return getTheme$1(this).image}updateAABBBounds(e,i,n){if(!this.updatePathProxyAABBBounds(n)){const{width:u=i.width,height:d=i.height}=e;n.set(0,0,u,d)}const{tb1:o,tb2:l}=application.graphicService.updateTempAABBBounds(n);return updateBoundsOfCommonOuterBorder(e,i,o),n.union(o),o.setValue(l.x1,l.y1,l.x2,l.y2),application.graphicService.transformAABBBounds(e,n,i,!1,this),n}getDefaultAttribute(e){return DefaultImageAttribute[e]}needUpdateTags(e){return super.needUpdateTags(e,IMAGE_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,IMAGE_UPDATE_TAG_KEY)}clone(){return new Image(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Image.NOWORK_ANIMATE_ATTR}}Image.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},NOWORK_ANIMATE_ATTR);function createImage(r){return new Image(r)}class RichTextIcon extends Image{constructor(e){if(super(e),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],e.backgroundShowMode==="always"&&(this._hovered=!0),e.margin){const i=parsePadding(e.margin);this._marginArray=typeof i=="number"?[i,i,i,i]:i}this.onBeforeAttributeUpdate=(i,n,o)=>{if(isArray(o)&&o.indexOf("margin")!==-1||o==="margin")if(n.margin){const l=parsePadding(n.margin);this._marginArray=typeof l=="number"?[l,l,l,l]:l}else this._marginArray=[0,0,0,0]}}get width(){var e;return((e=this.attribute.width)!==null&&e!==void 0?e:0)+this._marginArray[1]+this._marginArray[3]}get height(){var e;return((e=this.attribute.height)!==null&&e!==void 0?e:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:e=DefaultImageAttribute.width,height:i=DefaultImageAttribute.height}=this.attribute,{backgroundWidth:n=e,backgroundHeight:o=i}=this.attribute,l=(n-e)/2,u=(o-i)/2;return this._AABBBounds.expand([0,2*l,2*u,0]),this._AABBBounds}setHoverState(e){this.attribute.backgroundShowMode==="hover"&&this._hovered!==e&&(this._hovered=e)}}class Line{constructor(e,i,n,o,l,u,d,f){this.left=e,this.width=i,this.baseline=n,this.ascent=o,this.descent=l,this.top=n-o,this.paragraphs=u.map(_=>_),this.textAlign=(this.paragraphs[0]instanceof RichTextIcon?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=d,this.directionKey=DIRECTION_KEY[this.direction],this.actualWidth=0;let g=0;this.paragraphs.forEach((_,y)=>{if(y===0&&_ instanceof Paragraph){const b=regFirstSpace.exec(_.text);(b==null?void 0:b.index)!==0&&(_.text=_.text.slice(b==null?void 0:b.index),_.updateWidth())}this.actualWidth+=_[this.directionKey.width],g=Math.max(_[this.directionKey.height],g)}),this.height=g,this.blankWidth=f?0:this.width-this.actualWidth,this.calcOffset(i,f)}calcOffset(e,i){const n=this.directionKey,o=this.height;let l=this.left,u=0;this.actualWidth<e&&!i&&(this.textAlign==="right"||this.textAlign==="end"?l=e-this.actualWidth:this.textAlign==="center"?l=(e-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?l=(e-this.actualWidth)/2:u=(e-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map(function(d){d instanceof RichTextIcon?(d["_"+n.x]=l,l+=d[n.width]+u,d["_"+n.y]=d.attribute.textBaseline==="top"?0:d.attribute.textBaseline==="bottom"?o-d.height:(o-d.height)/2):(d[n.left]=l,l+=d[n.width]+u)})}draw(e,i,n,o,l,u){if(l&&(i||this.paragraphs.some(d=>d.overflow))){let d=!0,f=!1;for(let _=this.paragraphs.length-1;_>=0;_--){const y=this.paragraphs[_];if(y.overflow)d=d&&y.text==="";else if(d){f=!0;break}}let g=0;if(!f)for(let _=this.paragraphs.length-1;_>=0;_--){const y=this.paragraphs[_];if(y.overflow){if(y.text==="")break;continue}if(y instanceof RichTextIcon)break;if(this.direction==="vertical"&&y.direction!=="vertical"){y.verticalEllipsis=!0;break}const b=l===!0?"...":l||"";y.ellipsisStr=b;const{width:S}=measureTextCanvas(b,y.character),v=S||0;if(v<=this.blankWidth+g){i&&(y.ellipsis="add");break}if(v<=this.blankWidth+g+y.width){y.ellipsis="replace",y.ellipsisWidth=v,y.ellipsisOtherParagraphWidth=this.blankWidth+g;break}y.ellipsis="hide",g+=y.width}}this.paragraphs.forEach((d,f)=>{if(d instanceof RichTextIcon)return d.setAttributes({x:n+d._x,y:o+d._y}),void u(d,e,n+d._x,o+d._y,this.ascent);const g={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};applyStrokeStyle(e,d.character),applyFillStyle(e,d.character,g),d.draw(e,o+this.ascent,n,f===0,this.textAlign)})}getWidthWithEllips(e){let i=0;for(let o=this.paragraphs.length-1;o>=0;o--){const l=this.paragraphs[o];if(l instanceof RichTextIcon)break;const{width:u}=measureTextCanvas(e,l.character),d=u||0;if(d<=this.blankWidth+i){l.ellipsis="add",l.ellipsisWidth=d;break}if(d<=this.blankWidth+i+l.width){l.ellipsis="replace",l.ellipsisWidth=d,l.ellipsisOtherParagraphWidth=this.blankWidth+i;break}l.ellipsis="hide",i+=l.width}let n=0;return this.paragraphs.forEach((o,l)=>{n+=o instanceof RichTextIcon?o.width:o.getWidthWithEllips(this.direction)}),n}}class Wrapper{constructor(e){this.frame=e,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=e.layoutDirection,this.directionKey=DIRECTION_KEY[this.direction]}store(e){if(e instanceof RichTextIcon){this.frame.icons.set(e.richtextId,e),this.lineBuffer.push(e),this.lineWidth+=e[this.directionKey.width];let i=0,n=0;e.attribute.textBaseline==="top"?(i=0,n=e.height):e.attribute.textBaseline==="bottom"?(i=e.height,n=0):(i=e.height/2,n=e.height/2),this.maxAscent=Math.max(this.maxAscent,i),this.maxDescent=Math.max(this.maxDescent,n)}else this.lineBuffer.push(e),e.text.length!==0?(this.lineWidth+=e[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,e.ascent),this.maxDescent=Math.max(this.maxDescent,e.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,e.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,e.descent))}send(){if(this.lineBuffer.length===0)return;const e=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,i=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,n=new Line(this.frame.left,this[this.directionKey.width],this.y+e,e,i,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(n),this.frame.actualHeight+=n.height,this.y+=n.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(e,i=!1){e instanceof RichTextIcon?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+e[this.directionKey.width]<=this[this.directionKey.width]?this.store(e):this.lineBuffer.length===0?(this.store(e),this.send()):(this.send(),this.deal(e)):typeof this.width!="number"||this.width<0||(e.newLine&&this.send(),e.text.length!==0&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+e[this.directionKey.width]<=this[this.directionKey.width]?this.store(e):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(e)):this.cut(e,i)))}cut(e,i){const n=this[this.directionKey.width]-this.lineWidth||0,o=Math.ceil(n/e[this.directionKey.width]*e.length)||0,l=getStrByWithCanvas(e.text,n,e.character,o,this.frame.wordBreak==="break-word");if(l!==0){const[u,d]=seperateParagraph(e,l);this.store(u),i?this.send():this.deal(d)}else this.lineBuffer.length!==0&&(this.send(),this.deal(e))}}const RICHTEXT_UPDATE_TAG_KEY=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...GRAPHIC_UPDATE_TAG_KEY];class RichText extends Graphic{constructor(e){super(e),this.type="richtext",this._currentHoverIcon=null,this.numberType=RICHTEXT_NUMBER_TYPE,this.onBeforeAttributeUpdate=(i,n,o)=>{for(const l in i)if(l==="hoverIconId"){if(i[l]===n[l])continue;const u=this._frameCache.icons.get(i[l]);this.updateHoverIconState(u)}}}get width(){var e;return(e=this.attribute.width)!==null&&e!==void 0?e:DefaultRichTextAttribute.width}set width(e){this.attribute.width!==e&&(this.attribute.width=e,this.addUpdateShapeAndBoundsTag())}get height(){var e;return(e=this.attribute.height)!==null&&e!==void 0?e:DefaultRichTextAttribute.height}set height(e){this.attribute.height!==e&&(this.attribute.height=e,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(e){this.attribute.maxWidth!==e&&(this.attribute.maxWidth=e,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(e){this.attribute.maxHeight!==e&&(this.attribute.maxHeight=e,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var e;return(e=this.attribute.ellipsis)!==null&&e!==void 0?e:DefaultRichTextAttribute.ellipsis}set ellipsis(e){this.attribute.ellipsis!==e&&(this.attribute.ellipsis=e,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var e;return(e=this.attribute.wordBreak)!==null&&e!==void 0?e:DefaultRichTextAttribute.wordBreak}set wordBreak(e){this.attribute.wordBreak!==e&&(this.attribute.wordBreak=e,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var e;return(e=this.attribute.verticalDirection)!==null&&e!==void 0?e:DefaultRichTextAttribute.verticalDirection}set verticalDirection(e){this.attribute.verticalDirection!==e&&(this.attribute.verticalDirection=e,this.addUpdateShapeAndBoundsTag())}get textAlign(){var e;return(e=this.attribute.textAlign)!==null&&e!==void 0?e:DefaultRichTextAttribute.textAlign}set textAlign(e){this.attribute.textAlign!==e&&(this.attribute.textAlign=e,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var e;return(e=this.attribute.textBaseline)!==null&&e!==void 0?e:DefaultRichTextAttribute.textBaseline}set textBaseline(e){this.attribute.textBaseline!==e&&(this.attribute.textBaseline=e,this.addUpdateShapeAndBoundsTag())}get textConfig(){var e;return(e=this.attribute.textConfig)!==null&&e!==void 0?e:DefaultRichTextAttribute.textConfig}set textConfig(e){this.attribute.textConfig=e,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return getTheme$1(this).richtext}updateAABBBounds(e,i,n){const{width:o=i.width,height:l=i.height,maxWidth:u=i.maxWidth,maxHeight:d=i.maxHeight,textAlign:f=i.textAlign,textBaseline:g=i.textBaseline}=e;if(o>0&&l>0)n.set(0,0,o,l);else{const b=this.getFrameCache(),{width:S,height:v}=b.getActualSize();let A=o||S||0,x=l||v||0;x=typeof d=="number"&&x>d?d:x||0,A=typeof u=="number"&&A>u?u:A||0,n.set(0,0,A,x)}let _=0;switch(g){case"top":_=0;break;case"middle":_=-n.height()/2;break;case"bottom":_=-n.height()}let y=0;switch(f){case"left":y=0;break;case"center":y=-n.width()/2;break;case"right":y=-n.width()}return n.translate(y,_),application.graphicService.updateTempAABBBounds(n),e.forceBoundsHeight==null&&e.forceBoundsWidth==null||application.graphicService.updateHTMLTextAABBBounds(e,i,n),application.graphicService.transformAABBBounds(e,n,i,!1,this),n}needUpdateTags(e){return super.needUpdateTags(e,RICHTEXT_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,RICHTEXT_UPDATE_TAG_KEY)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const e=this.getFrameCache();if(e.actualHeight>e.height)return!0;const{disableAutoWrapLine:i}=this.attribute;if(i)for(let n=0;n<e.lines.length;n++){const o=e.lines[n];for(let l=0;l<o.paragraphs.length;l++){const u=o.paragraphs[l];if(u.overflow&&u.text!=="")return!0}}return!1}combinedStyleToCharacter(e){const{fill:i,stroke:n,fontSize:o,fontFamily:l,fontStyle:u,fontWeight:d,lineWidth:f,opacity:g,fillOpacity:_,strokeOpacity:y}=this.attribute;return Object.assign({fill:i,stroke:n,fontSize:o,fontFamily:l,fontStyle:u,fontWeight:d,lineWidth:f,opacity:g,fillOpacity:_,strokeOpacity:y},e)}doUpdateFrameCache(e){var i;const{textConfig:n=[],maxWidth:o,maxHeight:l,width:u,height:d,ellipsis:f,wordBreak:g,verticalDirection:_,textAlign:y,textBaseline:b,layoutDirection:S,singleLine:v,disableAutoWrapLine:A}=this.attribute,x=[],T=e??n;for(let D=0;D<T.length;D++)if("image"in T[D]){const I=this.combinedStyleToCharacter(T[D]);I.lineWidth=void 0;const O=I.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(I.id);if(O)x.push(O);else{const B=new RichTextIcon(I);B.successCallback=()=>{var N;this.addUpdateBoundTag(),(N=this.stage)===null||N===void 0||N.renderNextFrame()},B.richtextId=I.id,x.push(B)}}else{const I=this.combinedStyleToCharacter(T[D]);if(isNumber(I.text)&&(I.text=`${I.text}`),I.text&&I.text.includes(`
`)){const O=I.text.split(`
`);for(let B=0;B<O.length;B++)x.push(new Paragraph(O[B],B!==0,I))}else I.text&&x.push(new Paragraph(I.text,!1,I))}const C=typeof o=="number"&&Number.isFinite(o)&&o>0,E=typeof l=="number"&&Number.isFinite(l)&&l>0,P=typeof u=="number"&&Number.isFinite(u)&&u>0&&(!C||u<=o),L=typeof d=="number"&&Number.isFinite(d)&&d>0&&(!E||d<=l),R=new Frame(0,0,(P?u:C?o:0)||0,(L?d:E?l:0)||0,f,g,_,y,b,S||"horizontal",!P&&C,!L&&E,v||!1,(i=this._frameCache)===null||i===void 0?void 0:i.icons),w=new Wrapper(R);if(A){let D=0,I=!1;for(let O=0;O<x.length;O++){const B=x[O];I?(B.overflow=!0,B.left=1/0,B.top=1/0,!B.newLine&&R.lines[R.lines.length-1].paragraphs.push(B)):w.deal(B,!0),R.lines.length!==D&&(D=R.lines.length,w.lineBuffer.length=0,B.overflow=!0,B.left=1e3,B.top=1e3,R.lines[R.lines.length-1].paragraphs.push(B),I=!0),B.newLine&&(I=!1,w.lineWidth=0),w.send()}}else for(let D=0;D<x.length;D++)w.deal(x[D]);if(w.send(),!(R.layoutDirection==="horizontal"?P:L)){const D=R.getActualSizeWidthEllipsis();let I=R.layoutDirection==="horizontal"?D.width:D.height;(R.layoutDirection==="horizontal"?C:E)&&(I=Math.min(I,R.layoutDirection==="horizontal"?o:l)),R.lines.forEach(function(O){O.calcOffset(I,!1)})}this._frameCache=R}clone(){return new RichText(Object.assign({},this.attribute))}setStage(e,i){super.setStage(e,i),this.getFrameCache().icons.forEach(n=>{n.setStage(e,i)})}bindIconEvent(){this.addEventListener("pointermove",e=>{const i=this.pickIcon(e.global);i&&i===this._currentHoverIcon||(i?this.setAttribute("hoverIconId",i.richtextId):!i&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))}),this.addEventListener("pointerleave",e=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)})}updateHoverIconState(e){var i,n,o,l,u;e?((i=this._currentHoverIcon)===null||i===void 0||i.setHoverState(!1),this._currentHoverIcon=e,this._currentHoverIcon.setHoverState(!0),(n=this.stage)===null||n===void 0||n.setCursor(e.attribute.cursor),(o=this.stage)===null||o===void 0||o.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(l=this.stage)===null||l===void 0||l.setCursor(),(u=this.stage)===null||u===void 0||u.renderNextFrame())}pickIcon(e){const i=this.getFrameCache(),{e:n,f:o}=this.globalTransMatrix;let l;return i.icons.forEach((u,d)=>{var f,g;const _=u.AABBBounds.clone();_.translate(u._marginArray[3],u._marginArray[0]),_.containsPoint({x:e.x-n,y:e.y-o})&&(l=u,l.globalX=((f=l.attribute.x)!==null&&f!==void 0?f:0)+n+u._marginArray[3],l.globalY=((g=l.attribute.y)!==null&&g!==void 0?g:0)+o+u._marginArray[0])}),l}getNoWorkAnimateAttr(){return RichText.NOWORK_ANIMATE_ATTR}}RichText.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},NOWORK_ANIMATE_ATTR);function createRichText(r){return new RichText(r)}const PATH_UPDATE_TAG_KEY=["path","customPath",...GRAPHIC_UPDATE_TAG_KEY];class Path extends Graphic{constructor(e){super(e),this.type="path",this.numberType=PATH_NUMBER_TYPE}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:e}=this.attribute;return e!=null&&e!==""}getParsedPathShape(){const e=this.getGraphicTheme();if(!this.valid)return e.path;const i=this.attribute;return i.path instanceof CustomPath2D?i.path:(isNil(this.cache)&&this.doUpdatePathShape(),this.cache instanceof CustomPath2D?this.cache:e.path)}getGraphicTheme(){return getTheme$1(this).path}updateAABBBounds(e,i,n){if(!this.updatePathProxyAABBBounds(n)){const d=this.getParsedPathShape();n.union(d.getBounds())}const{tb1:o,tb2:l}=application.graphicService.updateTempAABBBounds(n);updateBoundsOfCommonOuterBorder(e,i,o),n.union(o),o.setValue(l.x1,l.y1,l.x2,l.y2);const{lineJoin:u=i.lineJoin}=e;return application.graphicService.transformAABBBounds(e,n,i,u==="miter",this),n}doUpdateAABBBounds(e){return this.doUpdatePathShape(),super.doUpdateAABBBounds(e)}doUpdatePathShape(){const e=this.attribute;isString(e.path,!0)?this.cache=new CustomPath2D().fromString(e.path):e.customPath&&(this.cache=new CustomPath2D,e.customPath(this.cache,this))}needUpdateTags(e){return super.needUpdateTags(e,PATH_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,PATH_UPDATE_TAG_KEY)}toCustomPath(){return new CustomPath2D().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new Path(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Path.NOWORK_ANIMATE_ATTR}}Path.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},NOWORK_ANIMATE_ATTR);function createPath(r){return new Path(r)}const AREA_UPDATE_TAG_KEY=["segments","points","curveType","curveTension",...GRAPHIC_UPDATE_TAG_KEY];class Area extends Graphic{constructor(e){super(e),this.type="area",this.numberType=AREA_NUMBER_TYPE}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:e,segments:i}=this.attribute;return i?i.length!==0:!!e&&e.length!==0}getGraphicTheme(){return getTheme$1(this).area}updateAABBBounds(e,i,n){this.updatePathProxyAABBBounds(n)||(e.segments?this.updateAreaAABBBoundsBySegments(e,i,n):this.updateAreaAABBBoundsByPoints(e,i,n)),application.graphicService.updateTempAABBBounds(n);const{lineJoin:o=i.lineJoin}=e;return application.graphicService.transformAABBBounds(e,n,i,o==="miter",this),n}updateAreaAABBBoundsByPoints(e,i,n,o){const{points:l=i.points}=e,u=n;return l.forEach(d=>{var f,g;u.add(d.x,d.y),u.add((f=d.x1)!==null&&f!==void 0?f:d.x,(g=d.y1)!==null&&g!==void 0?g:d.y)}),u}updateAreaAABBBoundsBySegments(e,i,n,o){const{segments:l=i.segments}=e,u=n;return l.forEach(d=>{d.points.forEach(f=>{var g,_;u.add(f.x,f.y),u.add((g=f.x1)!==null&&g!==void 0?g:f.x,(_=f.y1)!==null&&_!==void 0?_:f.y)})}),u}_interpolate(e,i,n,o,l){e==="points"&&(l.points=pointsInterpolation(n,o,i))}needUpdateTags(e){return super.needUpdateTags(e,AREA_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,AREA_UPDATE_TAG_KEY)}toCustomPath(){const e=new CustomPath2D,i=this.attribute,n=i.segments,o=l=>{if(l&&l.length){let u=!0;const d=[];if(l.forEach(f=>{var g,_;f.defined!==!1&&(u?e.moveTo(f.x,f.y):e.lineTo(f.x,f.y),d.push({x:(g=f.x1)!==null&&g!==void 0?g:f.x,y:(_=f.y1)!==null&&_!==void 0?_:f.y}),u=!1)}),d.length){for(let f=d.length-1;f>=0;f--)e.lineTo(d[f].x,d[f].y);e.closePath()}}};return i.points?o(i.points):n&&n.length&&n.forEach(l=>{o(l.points)}),e}clone(){return new Area(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Area.NOWORK_ANIMATE_ATTR}}Area.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},NOWORK_ANIMATE_ATTR);function createArea(r){return new Area(r)}const ARC_UPDATE_TAG_KEY=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...GRAPHIC_UPDATE_TAG_KEY];class Arc extends Graphic{constructor(e){super(e),this.type="arc",this.numberType=ARC_NUMBER_TYPE}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:e,endAngle:i,outerRadius:n,innerRadius:o}=this.attribute;return this._validNumber(e)&&this._validNumber(i)&&this._validNumber(n)&&this._validNumber(o)}getParsedCornerRadius(){const e=this.getGraphicTheme(),{cornerRadius:i=e.cornerRadius,innerPadding:n=e.innerPadding,outerPadding:o=e.outerPadding}=this.attribute;let{outerRadius:l=e.outerRadius,innerRadius:u=e.innerRadius}=this.attribute;if(l+=o,u-=n,i===0||i==="0%")return 0;const d=Math.abs(l-u),f=g=>Math.min(isNumber(g,!0)?g:d*parseFloat(g)/100,d/2);if(isArray(i)){const g=i.map(_=>f(_)||0);return g.length===0?[g[0],g[0],g[0],g[0]]:g.length===2?[g[0],g[1],g[0],g[1]]:(g.length===3&&g.push(0),g)}return f(i)}getParsedAngle(){const e=this.getGraphicTheme();let{startAngle:i=e.startAngle,endAngle:n=e.endAngle}=this.attribute;const{cap:o=e.cap}=this.attribute,l=n-i>=0?1:-1,u=n-i;if(i=clampAngleByRadian(i),n=i+u,o&&abs$1(u)<pi2-epsilon$1){let d=1,f=1;o.length&&(d=Number(o[0]),f=Number(o[1]));let{outerRadius:g=e.outerRadius,innerRadius:_=e.innerRadius}=this.attribute;const{outerPadding:y=e.outerPadding,innerPadding:b=e.innerPadding}=this.attribute;g+=y,_-=b;const S=Math.abs(g-_)/2,v=S/g;if(S>epsilon$1&&g>epsilon$1)return{startAngle:i-l*v*d,endAngle:n+l*v*f,sc:l*v*d,ec:l*v*f}}return{startAngle:i,endAngle:n}}getParsePadAngle(e,i){const n=this.getGraphicTheme(),{innerPadding:o=n.innerPadding,outerPadding:l=n.outerPadding,padAngle:u=n.padAngle}=this.attribute;let{outerRadius:d=n.outerRadius,innerRadius:f=n.innerRadius}=this.attribute;d+=l,f-=o;const{padRadius:g=sqrt$3(d*d+f*f)}=this.attribute,_=abs$1(i-e);let y=e,b=i,S=e,v=i;const A=u/2;let x=_,T=_;if(A>epsilon$1&&g>epsilon$1){const C=i>e?1:-1;let E=asin$1(Number(g)/f*sin$1(A)),P=asin$1(Number(g)/d*sin$1(A));return(x-=2*E)>epsilon$1?(E*=C,S+=E,v-=E):(x=0,S=v=(e+i)/2),(T-=2*P)>epsilon$1?(P*=C,y+=P,b-=P):(T=0,y=b=(e+i)/2),{outerStartAngle:y,outerEndAngle:b,innerStartAngle:S,innerEndAngle:v,innerDeltaAngle:x,outerDeltaAngle:T}}return{outerStartAngle:y,outerEndAngle:b,innerStartAngle:S,innerEndAngle:v,innerDeltaAngle:x,outerDeltaAngle:T}}getGraphicTheme(){return getTheme$1(this).arc}updateAABBBounds(e,i,n,o){this.updatePathProxyAABBBounds(n)||(o?this.updateArcAABBBoundsImprecise(e,i,n):this.updateArcAABBBoundsAccurate(e,i,n));const{tb1:l,tb2:u}=application.graphicService.updateTempAABBBounds(n);updateBoundsOfCommonOuterBorder(e,i,l),n.union(l),l.setValue(u.x1,u.y1,u.x2,u.y2);const{lineJoin:d=i.lineJoin}=e;return application.graphicService.transformAABBBounds(e,n,i,d==="miter",this),n}updateArcAABBBoundsImprecise(e,i,n){let{outerRadius:o=i.outerRadius,innerRadius:l=i.innerRadius}=e;const{outerPadding:u=i.outerPadding,innerPadding:d=i.innerPadding}=e;return o+=u,l-=d,o<l&&(o=l),n.set(-o,-o,o,o),n}updateArcAABBBoundsAccurate(e,i,n){let{outerRadius:o=i.outerRadius,innerRadius:l=i.innerRadius}=e;const{outerPadding:u=i.outerPadding,innerPadding:d=i.innerPadding}=e;if(o+=u,l-=d,o<l){const _=o;o=l,l=_}let{endAngle:f=i.endAngle,startAngle:g=i.startAngle}=e;if(g>f){const _=g;g=f,f=_}return o<=epsilon$1?n.set(0,0,0,0):Math.abs(f-g)>pi2-epsilon$1?n.set(-o,-o,o,o):(circleBounds(g,f,o,n),circleBounds(g,f,l,n)),n}needUpdateTags(e){return super.needUpdateTags(e,ARC_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,ARC_UPDATE_TAG_KEY)}toCustomPath(){var e,i,n,o;const l=this.attribute,{startAngle:u,endAngle:d}=this.getParsedAngle();let f=((e=l.innerRadius)!==null&&e!==void 0?e:0)-((i=l.innerPadding)!==null&&i!==void 0?i:0),g=((n=l.outerRadius)!==null&&n!==void 0?n:0)-((o=l.outerPadding)!==null&&o!==void 0?o:0);const _=abs$1(d-u),y=d>u;if(g<f){const S=g;g=f,f=S}const b=new CustomPath2D;if(g<=epsilon$1)b.moveTo(0,0);else if(_>=pi2-epsilon$1)b.moveTo(0+g*cos$1(u),0+g*sin$1(u)),b.arc(0,0,g,u,d,!y),f>epsilon$1&&(b.moveTo(0+f*cos$1(d),0+f*sin$1(d)),b.arc(0,0,f,d,u,y));else{const S=g*cos$1(u),v=g*sin$1(u),A=f*cos$1(d),x=f*sin$1(d);b.moveTo(0+S,0+v),b.arc(0,0,g,u,d,!y),b.lineTo(0+A,0+x),b.arc(0,0,f,d,u,y),b.closePath()}return b}clone(){return new Arc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Arc.NOWORK_ANIMATE_ATTR}}Arc.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},NOWORK_ANIMATE_ATTR);function createArc(r){return new Arc(r)}class Arc3d extends Arc{constructor(e){super(e),this.type="arc3d",this.numberType=ARC3D_NUMBER_TYPE}updateAABBBounds(e,i,n){const o=this.stage;if(!o||!o.camera)return n;const{outerRadius:l=i.outerRadius,height:u=0}=e,d=l+u;return n.setValue(-d,-d,d,d),application.graphicService.updateTempAABBBounds(n),application.graphicService.transformAABBBounds(e,n,i,!1,this),n}getNoWorkAnimateAttr(){return Arc3d.NOWORK_ANIMATE_ATTR}}Arc3d.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},NOWORK_ANIMATE_ATTR);function createArc3d(r){return new Arc3d(r)}const POLYGON_UPDATE_TAG_KEY=["points","cornerRadius",...GRAPHIC_UPDATE_TAG_KEY];class Polygon extends Graphic{constructor(e){super(e),this.type="polygon",this.numberType=POLYGON_NUMBER_TYPE}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:e}=this.attribute;return e&&e.length>=2}getGraphicTheme(){return getTheme$1(this).polygon}updateAABBBounds(e,i,n){this.updatePathProxyAABBBounds(n)||this.updatePolygonAABBBoundsImprecise(e,i,n),application.graphicService.updateTempAABBBounds(n);const{lineJoin:o=i.lineJoin}=e;return application.graphicService.transformAABBBounds(e,n,i,o==="miter",this),n}updatePolygonAABBBoundsImprecise(e,i,n){const{points:o=i.points}=e;return o.forEach(l=>{n.add(l.x,l.y)}),n}_interpolate(e,i,n,o,l){e==="points"&&(l.points=pointsInterpolation(n,o,i))}needUpdateTags(e){return super.needUpdateTags(e,POLYGON_UPDATE_TAG_KEY)}needUpdateTag(e){return super.needUpdateTag(e,POLYGON_UPDATE_TAG_KEY)}toCustomPath(){const e=this.attribute.points,i=new CustomPath2D;return e.forEach((n,o)=>{o===0?i.moveTo(n.x,n.y):i.lineTo(n.x,n.y)}),i.closePath(),i}clone(){return new Polygon(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Polygon.NOWORK_ANIMATE_ATTR}}Polygon.NOWORK_ANIMATE_ATTR=NOWORK_ANIMATE_ATTR;function createPolygon(r){return new Polygon(r)}class Pyramid3d extends Polygon{constructor(e){super(e),this.type="pyramid3d",this.numberType=PYRAMID3D_NUMBER_TYPE}updateAABBBounds(e,i,n){const o=this.stage;return!o||!o.camera||(this.findFace().vertices.forEach(l=>{const u=l[0],d=l[1];n.add(u,d)}),application.graphicService.updateTempAABBBounds(n),application.graphicService.transformAABBBounds(e,n,i,!1,this)),n}findFace(){const{points:e}=this.attribute,i=e.map((d,f)=>{const g=f===3?e[0]:e[f+1],_=d.x-g.x;return _===0?0:(d.y-g.y)/_}),n=e.map(d=>({p:d,d:0}));let o=!1,l=0;for(let d=0;d<i.length-1;d++){for(let f=d+1;f<i.length;f++){if(i[d]===i[f]){o=!0;const g=PointService.distancePP(n[d].p,n[d+1].p);n[d].d=g,n[d+1].d=g,l=max$1(l,g);const _=PointService.distancePP(n[f].p,n[f+1].p);n[f].d=_,n[f+1].d=_,l=max$1(l,_)}if(o)break}if(o)break}for(let d=e.length-1;d>=0;d--){const f=e[d];n.unshift({p:f,d:0})}for(let d=0;d<e.length;d++){const f=(l-n[d+e.length].d)/2;n[d].d+=f,n[d+e.length].d+=f}const u={polygons:[],vertices:[],edges:[]};return n.forEach(d=>{u.vertices.push([d.p.x,d.p.y,d.d])}),u.polygons.push({polygon:[0,4,5,1],normal:[0,-1,0]}),u.polygons.push({polygon:[7,6,2,3],normal:[0,1,0]}),u.polygons.push({polygon:[0,4,7,3],normal:[-1,0,0]}),u.polygons.push({polygon:[1,5,6,2],normal:[1,0,0]}),u.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),u.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),u.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],u}_isValid(){return super._isValid()&&this.attribute.points.length===4}getNoWorkAnimateAttr(){return Pyramid3d.NOWORK_ANIMATE_ATTR}}Pyramid3d.NOWORK_ANIMATE_ATTR=NOWORK_ANIMATE_ATTR;function createPyramid3d(r){return new Pyramid3d(r)}class ShadowRoot extends Group$1{constructor(e){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=e}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(e=!0){if(this.shouldUpdateGlobalMatrix()){const i=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(i.a,i.b,i.c,i.d,i.e,i.f):this._globalTransMatrix=i.clone(),this.doUpdateGlobalMatrix(),e&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const e=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(e.a,e.b,e.c,e.d,e.e,e.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function createShadowRoot(r){return new ShadowRoot(r)}var __decorate$R=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};const PickItemInterceptor=Symbol.for("PickItemInterceptor");let ShadowRootPickItemInterceptorContribution=class{constructor(){this.order=1}afterPickItem(r,e,i,n,o){return r.attribute.shadowRootIdx>0||!r.attribute.shadowRootIdx?this._pickItem(r,e,i,n,o):null}beforePickItem(r,e,i,n,o){return r.attribute.shadowRootIdx<0?this._pickItem(r,e,i,n,o):null}_pickItem(r,e,i,n,o){var l;if(!r.shadowRoot)return null;const{parentMatrix:u}=o||{};if(!u)return null;const d=e.pickContext;d.highPerformanceSave();const f=(l=getTheme$1(r))===null||l===void 0?void 0:l[r.type],{shadowPickMode:g=f==null?void 0:f.shadowPickMode}=r.attribute,_=r.shadowRoot,y=matrixAllocate.allocateByObj(u),b=new Point(y.a*i.x+y.c*i.y+y.e,y.b*i.x+y.d*i.y+y.f),S=e.pickGroup(_,b,y,n);return d.highPerformanceRestore(),!S.graphic&&S.group&&g==="full"&&(S.graphic=S.group),S}};ShadowRootPickItemInterceptorContribution=__decorate$R([injectable()],ShadowRootPickItemInterceptorContribution);let InteractivePickItemInterceptorContribution=class{constructor(){this.order=1}beforePickItem(r,e,i,n,o){const l=r.baseGraphic;if(l&&l.parent){const u=new Point(i.x,i.y),d=e.pickContext;d.highPerformanceSave();const f=l.parent.globalTransMatrix;f.transformPoint(u,u);const g=l.isContainer?e.pickGroup(l,u.clone(),f,n):e.pickItem(l,u.clone(),f,n);return d.highPerformanceRestore(),g}return null}};InteractivePickItemInterceptorContribution=__decorate$R([injectable()],InteractivePickItemInterceptorContribution);let Canvas3DPickItemInterceptor=class{constructor(){this.order=1}beforePickItem(r,e,i,n,o){if(!r.in3dMode||n.in3dInterceptor)return null;const l=e.pickContext,u=r.stage;if(!l||!u)return null;if(n.in3dInterceptor=!0,l.save(),this.initCanvasCtx(l),l.camera=u.camera,r.isContainer){const d=draw3dItem(l,r,()=>e.pickGroup(r,i,o.parentMatrix,n),n);return l.camera=null,n.in3dInterceptor=!1,l.restore(),d}return l.restore(),null}initCanvasCtx(r){r.setTransformForCurrent()}};Canvas3DPickItemInterceptor=__decorate$R([injectable()],Canvas3DPickItemInterceptor);const pickModule=new ContainerModule((r,e,i)=>{i(PickerService)||(r(GlobalPickerService).toSelf(),r(PickerService).toService(GlobalPickerService)),r(Canvas3DPickItemInterceptor).toSelf().inSingletonScope(),r(PickItemInterceptor).toService(Canvas3DPickItemInterceptor),r(ShadowRootPickItemInterceptorContribution).toSelf().inSingletonScope(),r(PickItemInterceptor).toService(ShadowRootPickItemInterceptorContribution),r(InteractivePickItemInterceptorContribution).toSelf().inSingletonScope(),r(PickItemInterceptor).toService(InteractivePickItemInterceptorContribution),bindContributionProvider(r,PickItemInterceptor)}),graphicModule=new ContainerModule(r=>{r(GraphicService).to(DefaultGraphicService).inSingletonScope(),r(GraphicCreator$1).toConstantValue(graphicCreator)}),AutoEnablePlugins=Symbol.for("AutoEnablePlugins"),PluginService=Symbol.for("PluginService");var __decorate$Q=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$B=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$s=function(r,e){return function(i,n){e(i,n,r)}};let DefaultPluginService=class{constructor(r){this.autoEnablePlugins=r,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(r,e){this.stage=r,this.actived=!0;const{pluginList:i}=e;i&&container.isBound(AutoEnablePlugins)&&this.autoEnablePlugins.getContributions().forEach(n=>{i.includes(n.name)&&this.register(n)})}findPluginsByName(r){const e=[];return this.onStartupFinishedPlugin.forEach(i=>{i.name===r&&e.push(i)}),this.onRegisterPlugin.forEach(i=>{i.name===r&&e.push(i)}),e}register(r){r.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(r):r.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(r),r.activate(this))}unRegister(r){r.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(r),1):r.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(r),1),r.deactivate(this)}release(...r){this.onStartupFinishedPlugin.forEach(e=>{e.deactivate(this)}),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach(e=>{e.deactivate(this)}),this.onRegisterPlugin=[]}};DefaultPluginService=__decorate$Q([injectable(),__param$s(0,inject(ContributionProvider)),__param$s(0,named(AutoEnablePlugins)),__metadata$B("design:paramtypes",[Object])],DefaultPluginService);const pluginModule=new ContainerModule(r=>{r(PluginService).to(DefaultPluginService),bindContributionProviderNoSingletonScope(r,AutoEnablePlugins)}),envModules=new ContainerModule(r=>{bindContributionProvider(r,EnvContribution)}),textMeasureModules=new ContainerModule(r=>{r(TextMeasureContribution).to(DefaultTextMeasureContribution).inSingletonScope(),bindContributionProvider(r,TextMeasureContribution)});var __decorate$P=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$A=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let CanvasLayerHandlerContribution=class{constructor(){this.type="static",this.offscreen=!1,this.global=application.global}setDpr(r){this.canvas.dpr=r}init(r,e,i){if(this.layer=r,this.window=e,i.main)this.main=!0,this.context=e.getContext(),this.canvas=this.context.getCanvas();else{let n;this.main=!1,i.canvasId&&(n=this.global.getElementById(i.canvasId)),n||(n=this.global.createCanvas({width:e.width,height:e.height})),n.style&&(n.style["pointer-events"]="none");const o=e.getContext().getCanvas().nativeCanvas,l=wrapCanvas({nativeCanvas:n,width:e.width,height:e.height,dpr:e.dpr,id:i.canvasId,canvasControled:!0,container:e.getContainer(),x:o.offsetLeft,y:o.offsetTop});l.applyPosition(),this.canvas=l,this.context=l.getContext()}}resize(r,e){this.canvas.resize(r,e)}resizeView(r,e){}render(r,e,i){var n;if(!this.main){const o=this.window.getContext().getCanvas().nativeCanvas;!o||this.canvas.x===o.offsetLeft&&this.canvas.y===o.offsetTop||(this.canvas.x=o.offsetLeft,this.canvas.y=o.offsetTop,this.canvas.applyPosition())}e.renderService.render(r,Object.assign(Object.assign({context:this.context,clear:(n=e.background)!==null&&n!==void 0?n:"#ffffff"},e),i))}merge(r){r.forEach(e=>{const i=e.getContext().canvas.nativeCanvas;this.context.drawImage(i,0,0)})}prepare(r,e){}drawTo(r,e,i){var n;const o=r.getContext();i.renderService.render(e,Object.assign(Object.assign({context:o},i),{clear:i.clear?(n=i.background)!==null&&n!==void 0?n:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};CanvasLayerHandlerContribution=__decorate$P([injectable(),__metadata$A("design:paramtypes",[])],CanvasLayerHandlerContribution);const layerHandlerModules=new ContainerModule(r=>{r(CanvasLayerHandlerContribution).toSelf(),r(StaticLayerHandlerContribution).toService(CanvasLayerHandlerContribution)});function load$1(r){r.load(envModules),r.load(textMeasureModules),r.load(layerHandlerModules)}var __awaiter$6=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};function parseChildMap(r,e,i){const n={},o=[];return r.forEachChildren(l=>{const{zIndex:u=e}=l.attribute;n[u]?n[u].push(l):(n[u]=[l],o.push(u))},i),o.sort((l,u)=>i?u-l:l-u),{childMap:n,zIdxArray:o}}function foreach(r,e,i,n=!1,o=!1){let l=!1;if(o)l=!0;else{let u;r.forEachChildren((d,f)=>{const{zIndex:g=e}=d.attribute;if(f===0)u=g;else if(u!==g)return l=!0,!0;return!1},n)}if(l){const{childMap:u,zIdxArray:d}=parseChildMap(r,e,n);let f=!1;for(let g=0;g<d.length&&!f;g++){const _=u[d[g]];o&&_.sort((y,b)=>{var S,v;return(n?-1:1)*(((S=b.attribute.z)!==null&&S!==void 0?S:0)-((v=y.attribute.z)!==null&&v!==void 0?v:0))});for(let y=0;y<_.length;y++)if(i(_[y],y)){f=!0;break}}}else r.forEachChildren(i,n)}function foreachAsync(r,e,i,n=!1){return __awaiter$6(this,void 0,void 0,function*(){yield r.forEachChildrenAsync(i,n)})}function findNextGraphic(r,e,i,n=!1){let o=!1;r.forEachChildren((d,f)=>{const{zIndex:g=i}=d.attribute;if(f!==0){if(g!==void 0)return o=!0,!0}return!1},n);let l=null,u=!1;if(o){const{childMap:d,zIdxArray:f}=parseChildMap(r,i,n);let g=!1;for(let _=0;_<f.length&&!g;_++){const y=d[f[_]];for(let b=0;b<y.length;b++){if(u){g=!0,l=y[b];break}y[b]._uid!==e||(u=!0)}}}else r.forEachChildren(d=>u?(l=d,!0):(d._uid===e&&(u=!0),!1),n);return l}var __decorate$O=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$z=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$r=function(r,e){return function(i,n){e(i,n,r)}};let DefaultDrawContribution=class{constructor(r,e){this.contributions=r,this.drawItemInterceptorContributions=e,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Bounds,this.backupDirtyBounds=new Bounds,this.global=application.global,this.layerService=application.layerService,this.init()}init(){this.contributions.forEach(r=>{if(r.style){const e=this.styleRenderMap.get(r.style)||new Map;e.set(r.numberType,r),this.styleRenderMap.set(r.style,e)}else this.defaultRenderMap.set(r.numberType,r)}),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort((r,e)=>r.order-e.order)}prepareForDraw(r,e){e.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!e.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(r,e){this.prepareForDraw(r,e),e.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(e.renderStyle)||this.defaultRenderMap,this.currentRenderService=r;const{context:i,stage:n,viewBox:o,transMatrix:l}=e;if(!i)return;const u=this.dirtyBounds.setValue(0,0,o.width(),o.height());if(n.dirtyBounds&&!n.dirtyBounds.empty()){const f=getRectIntersect(u,n.dirtyBounds,!1);u.x1=Math.floor(f.x1),u.y1=Math.floor(f.y1),u.x2=Math.ceil(f.x2),u.y2=Math.ceil(f.y2)}const d=i.dpr%1;(d||d!==.5)&&(u.x1=Math.floor(u.x1*i.dpr)/i.dpr,u.y1=Math.floor(u.y1*i.dpr)/i.dpr,u.x2=Math.ceil(u.x2*i.dpr)/i.dpr,u.y2=Math.ceil(u.y2*i.dpr)/i.dpr),this.backupDirtyBounds.copy(u),i.inuse=!0,i.setClearMatrix(l.a,l.b,l.c,l.d,l.e,l.f),i.clearMatrix(),i.setTransformForCurrent(!0),i.translate(o.x1,o.y1,!0),i.beginPath(),i.rect(u.x1,u.y1,u.width(),u.height()),i.clip(),n.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(r,i,e),i.save(),r.renderTreeRoots.sort((f,g)=>{var _,y;return((_=f.attribute.zIndex)!==null&&_!==void 0?_:DefaultAttribute.zIndex)-((y=g.attribute.zIndex)!==null&&y!==void 0?y:DefaultAttribute.zIndex)}).forEach(f=>{f.isContainer?this.renderGroup(f,e,matrixAllocate.allocate(1,0,0,1,0,0)):this.renderItem(f,e)}),i.restore(),i.setClearMatrix(1,0,0,1,0,0),i.inuse=!1,i.draw()}doRegister(){throw new Error("")}_findNextGraphic(r){let e=r.parent,i=r._uid;for(;e;){const n=findNextGraphic(e,i,DefaultAttribute.zIndex);if(n)return n;i=e._uid,e=e.parent}return null}renderGroup(r,e,i,n){if(e.break||r.attribute.visibleAll===!1)return;if(r.incremental&&(e.startAtId==null||e.startAtId===r._uid))return e.break=!0,void this._increaseRender(r,e);if(this.useDirtyBounds&&!isRectIntersect(r.AABBBounds,this.dirtyBounds,!1))return;let o,l=i;if(this.useDirtyBounds){o=boundsAllocate.allocateByObj(this.dirtyBounds);const u=r.transMatrix;l=matrixAllocate.allocateByObj(i).multiply(u.a,u.b,u.c,u.d,u.e,u.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(l.getInverse())}this.renderItem(r,e,{drawingCb:()=>{var u;n?r.forEachChildren(d=>{e.break||(d.isContainer?this.renderGroup(d,e,l):this.renderItem(d,e))}):foreach(r,DefaultAttribute.zIndex,d=>{e.break||(d.isContainer?this.renderGroup(d,e,l):this.renderItem(d,e))},!1,!!(!((u=e.context)===null||u===void 0)&&u.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(o),boundsAllocate.free(o),matrixAllocate.free(l))}_increaseRender(r,e){const{layer:i,stage:n}=e,{subLayers:o}=i;let l=o.get(r._uid);l||(l={layer:this.layerService.createLayer(n),zIndex:o.size,group:r},o.set(r._uid,l));const u=l.layer.getNativeHandler().getContext(),d=l.drawContribution||container.get(IncrementalDrawContribution);d.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),d.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),d.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:d,clear:"transparent",layer:l.layer,context:u,startAtId:r._uid,break:!1})),l.drawContribution=d;const f=this._findNextGraphic(r);if(f)if(f.isContainer&&f.incremental)this._increaseRender(f,e);else{let g=o.get(f._uid);g||(g={layer:this.layerService.createLayer(n),zIndex:o.size},o.set(f._uid,g));const _=g.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:d,clear:"transparent",layer:g.layer,context:_,startAtId:f._uid,break:!1}))}}getRenderContribution(r){let e;return e||(e=this.selectRenderByNumberType(r.numberType,r)),e||(e=this.selectRenderByType(r.type)),e}renderItem(r,e,i){if(this.InterceptorContributions.length)for(let d=0;d<this.InterceptorContributions.length;d++){const f=this.InterceptorContributions[d];if(f.beforeDrawItem&&f.beforeDrawItem(r,this.currentRenderService,e,this,i))return}const n=this.getRenderContribution(r);if(!n)return;let o,l=this.scrollMatrix&&(this.scrollMatrix.e!==0||this.scrollMatrix.f!==0);if(r.parent){const{scrollX:d=0,scrollY:f=0}=r.parent.attribute;(d||f)&&(l=!0,this.scrollMatrix||(this.scrollMatrix=matrixAllocate.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-d,-f))}if(l&&(o=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!r.isContainer&&!isRectIntersect(r.AABBBounds,o??this.dirtyBounds,!1)){if(l&&r.parent){const{scrollX:d=0,scrollY:f=0}=r.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(d,f)}return}const u=e.startAtId!=null&&r._uid!==e.startAtId;if(r._uid===e.startAtId&&(e.startAtId=null),i&&(i.skipDraw=u),u?r.isContainer&&n.draw(r,this.currentRenderService,e,i):n.draw(r,this.currentRenderService,e,i),l&&r.parent){const{scrollX:d=0,scrollY:f=0}=r.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(d,f)}if(this.InterceptorContributions.length)for(let d=0;d<this.InterceptorContributions.length;d++){const f=this.InterceptorContributions[d];if(f.afterDrawItem&&f.afterDrawItem(r,this.currentRenderService,e,this))return}}selectRenderByType(r){return Logger.getInstance().warn(""),null}selectRenderByNumberType(r,e){let i;if(e.attribute.renderStyle){const n=this.styleRenderMap.get(e.attribute.renderStyle);i=n&&n.get(r)}return i||this.currentRenderMap.get(r)||this.defaultRenderMap.get(r)}clearScreen(r,e,i){var n,o;const{clear:l,viewBox:u}=i,d=u.width(),f=u.height();if(l){e.clearRect(0,0,d,f);const g=(n=r.drawParams)===null||n===void 0?void 0:n.stage;if(g&&(e.globalAlpha=(o=g.attribute.opacity)!==null&&o!==void 0?o:1),g&&g.backgroundImg&&g.resources){const _=g.resources.get(l);_&&_.state==="success"&&_.data&&e.drawImage(_.data,0,0,d,f)}else e.fillStyle=createColor(e,l,{AABBBounds:{x1:0,y1:0,x2:0+d,y2:0+f}},0,0),e.fillRect(0,0,d,f)}}afterDraw(r,e){}};DefaultDrawContribution=__decorate$O([injectable(),__param$r(0,multiInject(GraphicRender)),__param$r(1,inject(ContributionProvider)),__param$r(1,named(DrawItemInterceptor)),__metadata$z("design:paramtypes",[Array,Object])],DefaultDrawContribution);var __decorate$N=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultIncrementalCanvasLineRender=class extends DefaultCanvasLineRender{constructor(){super(...arguments),this.numberType=LINE_NUMBER_TYPE}drawShape(r,e,i,n,o,l,u,d){if(r.incremental&&o.multiGraphicOptions){const{startAtIdx:f,length:g}=o.multiGraphicOptions,{segments:_=[]}=r.attribute;if(f>_.length)return;const y=getTheme$1(r).line,{fill:b=y.fill,stroke:S=y.stroke,opacity:v=y.opacity,fillOpacity:A=y.fillOpacity,strokeOpacity:x=y.strokeOpacity,lineWidth:T=y.lineWidth,visible:C=y.visible}=r.attribute,E=fillVisible(v,A,b),P=strokeVisible(v,x),L=runFill(b),R=runStroke(S,T);if(!r.valid||!C||!L&&!R||!(E||P||u||d))return;const{context:w}=o;for(let D=f;D<f+g;D++)this.drawIncreaseSegment(r,w,_[D-1],_[D],r.attribute.segments[D],[y,r.attribute],i,n)}else super.drawShape(r,e,i,n,o,l,u,d)}drawIncreaseSegment(r,e,i,n,o,l,u,d){n&&(e.beginPath(),drawIncrementalSegments(e.nativeContext,i,n,{offsetX:u,offsetY:d}),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,o,l),e.setStrokeStyle(r,o,u,d,l),e.stroke())}};DefaultIncrementalCanvasLineRender=__decorate$N([injectable()],DefaultIncrementalCanvasLineRender);var __decorate$M=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultIncrementalCanvasAreaRender=class extends DefaultCanvasAreaRender{constructor(){super(...arguments),this.numberType=AREA_NUMBER_TYPE}drawShape(r,e,i,n,o,l,u){if(r.incremental&&o.multiGraphicOptions){const{startAtIdx:d,length:f}=o.multiGraphicOptions,{segments:g=[]}=r.attribute;if(d>g.length)return;const _=getTheme$1(r).area,{fill:y=_.fill,fillOpacity:b=_.fillOpacity,opacity:S=_.opacity,visible:v=_.visible}=r.attribute,A=fillVisible(S,b,y),x=runFill(y);if(!r.valid||!v||!x||!A&&!u)return;for(let T=d;T<d+f;T++)this.drawIncreaseSegment(r,e,g[T-1],g[T],r.attribute.segments[T],[_,r.attribute],i,n)}else super.drawShape(r,e,i,n,o,l,u)}drawIncreaseSegment(r,e,i,n,o,l,u,d){n&&(e.beginPath(),drawIncrementalAreaSegments(e.camera?e:e.nativeContext,i,n,{offsetX:u,offsetY:d}),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,o,l),e.setCommonStyle(r,o,u,d,l),e.fill())}};DefaultIncrementalCanvasAreaRender=__decorate$M([injectable()],DefaultIncrementalCanvasAreaRender);var STATUS,__decorate$L=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$y=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$q=function(r,e){return function(i,n){e(i,n,r)}},__awaiter$5=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};(function(r){r[r.NORMAL=0]="NORMAL",r[r.STOP=1]="STOP"})(STATUS||(STATUS={}));let DefaultIncrementalDrawContribution=class extends DefaultDrawContribution{constructor(r,e,i,n){super(r,n),this.contributions=r,this.lineRender=e,this.areaRender=i,this.drawItemInterceptorContributions=n,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=STATUS.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new SyncHook([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(r,e){return __awaiter$5(this,void 0,void 0,function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=r,this.lastDrawContext=e,this.checkingForDrawPromise=this.checkForDraw(e);const i=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,i)return;this.currentRenderService=r;const{context:n,viewBox:o}=e;n&&(n.inuse=!0,n.clearMatrix(),n.setTransformForCurrent(!0),n.save(),e.restartIncremental&&this.clearScreen(this.currentRenderService,n,e),n.translate(o.x1,o.y1,!0),n.save(),r.renderTreeRoots.sort((l,u)=>{var d,f;return((d=l.attribute.zIndex)!==null&&d!==void 0?d:DefaultAttribute.zIndex)-((f=u.attribute.zIndex)!==null&&f!==void 0?f:DefaultAttribute.zIndex)}).forEach(l=>{this.renderGroup(l,e)}),this.hooks.completeDraw.tap("top-draw",()=>{n.restore(),n.restore(),n.draw(),n.inuse=!1,this.rendering=!1}))})}_increaseRender(r,e){return __awaiter$5(this,void 0,void 0,function*(){this.rendering=!0,yield this._renderIncrementalGroup(r,e)})}_renderIncrementalGroup(r,e){return __awaiter$5(this,void 0,void 0,function*(){this.count=r.count,yield new Promise(i=>{this.renderItem(r,e,{drawingCb:()=>__awaiter$5(this,void 0,void 0,function*(){if(r.count!==2)yield foreachAsync(r,DefaultAttribute.zIndex,(n,o)=>{if(this.status===STATUS.STOP)return!0;if(n.isContainer||o<this.currentIdx)return!1;const l=this.currFrameStartAt+r.incremental;return o<l&&(this.currentIdx=o+1,this.renderItem(n,e)),o===l-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())}),i(!1);else{const n=r.getChildAt(0);if(n.incremental&&n.attribute.segments)for(n.incrementalAt||(n.incrementalAt=0);n.incrementalAt<n.attribute.segments.length;)e.multiGraphicOptions={startAtIdx:n.incrementalAt,length:n.incremental},this.renderItem(n,e),n.incrementalAt+=n.incremental,yield this.waitToNextFrame();else this.renderItem(n,e);i(!1)}})})}),this.hooks.completeDraw.call()})}waitToNextFrame(){return __awaiter$5(this,void 0,void 0,function*(){return new Promise(r=>{this.global.getRequestAnimationFrame()(()=>{r(!1)})})})}checkForDraw(r){return __awaiter$5(this,void 0,void 0,function*(){let e=this.rendering;return r.restartIncremental&&(e=!1,yield this.forceStop(),this.resetToInit()),e})}forceStop(){return __awaiter$5(this,void 0,void 0,function*(){this.rendering&&(this.status=STATUS.STOP,yield new Promise(r=>{this.hooks.completeDraw.tap("stopCb",()=>{this.status=STATUS.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter(e=>e.name!=="stopCb"),r(!1)})}))})}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(r,e){return __awaiter$5(this,void 0,void 0,function*(){if(!e.break&&r.attribute.visibleAll!==!1)return r.incremental&&e.startAtId===r._uid?(yield this._increaseRender(r,e),void(e.break=!0)):void(yield new Promise(i=>{this.renderItem(r,e,{drawingCb:()=>__awaiter$5(this,void 0,void 0,function*(){yield foreachAsync(r,DefaultAttribute.zIndex,n=>__awaiter$5(this,void 0,void 0,function*(){e.break||n.isContainer&&(yield this.renderGroup(n,e))})),i(!1)})})}))})}};DefaultIncrementalDrawContribution=__decorate$L([injectable(),__param$q(0,multiInject(GraphicRender)),__param$q(1,inject(DefaultIncrementalCanvasLineRender)),__param$q(2,inject(DefaultIncrementalCanvasAreaRender)),__param$q(3,inject(ContributionProvider)),__param$q(3,named(DrawItemInterceptor)),__metadata$y("design:paramtypes",[Array,Object,Object,Object])],DefaultIncrementalDrawContribution);const renderModule=new ContainerModule(r=>{r(DefaultBaseBackgroundRenderContribution).toSelf().inSingletonScope(),r(DefaultBaseTextureRenderContribution).toSelf().inSingletonScope(),r(DrawContribution).to(DefaultDrawContribution),r(IncrementalDrawContribution).to(DefaultIncrementalDrawContribution),r(GroupRender).to(DefaultCanvasGroupRender).inSingletonScope(),r(GraphicRender).toService(GroupRender),bindContributionProvider(r,GroupRenderContribution),r(DefaultBaseInteractiveRenderContribution).toSelf().inSingletonScope(),bindContributionProvider(r,InteractiveSubRenderContribution),bindContributionProvider(r,GraphicRender),r(CommonDrawItemInterceptorContribution).toSelf().inSingletonScope(),r(DrawItemInterceptor).toService(CommonDrawItemInterceptorContribution),bindContributionProvider(r,DrawItemInterceptor)});function load(r){r.load(renderModule)}function preLoadAllModule(){preLoadAllModule.__loaded||(preLoadAllModule.__loaded=!0,container.load(coreModule),container.load(graphicModule),container.load(renderModule$1),container.load(pickModule),container.load(pluginModule),load$1(container),load(container))}preLoadAllModule.__loaded=!1,preLoadAllModule();const vglobal=container.get(VGlobal);application.global=vglobal;const graphicUtil=container.get(GraphicUtil);application.graphicUtil=graphicUtil;const transformUtil=container.get(TransformUtil);application.transformUtil=transformUtil;const graphicService=container.get(GraphicService);application.graphicService=graphicService;const layerService=container.get(LayerService);application.layerService=layerService;class AutoRenderPlugin{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=e=>{e.glyphHost&&(e=e.glyphHost),e.stage===this.pluginService.stage&&e.stage!=null&&e.stage.renderNextFrame()}}activate(e){this.pluginService=e,application.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),application.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),application.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(e){const i=n=>n.filter(o=>o.name!==this.key);application.graphicService.hooks.onAttributeUpdate.taps=i(application.graphicService.hooks.onAttributeUpdate.taps),application.graphicService.hooks.onSetStage.taps=i(application.graphicService.hooks.onSetStage.taps),application.graphicService.hooks.onRemove.taps=i(application.graphicService.hooks.onRemove.taps)}}class AutoRefreshPlugin{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=e=>{e.glyphHost&&(e=e.glyphHost),e.stage===this.pluginService.stage&&e.stage!=null&&e.stage.renderNextFrame()}}activate(e){this.pluginService=e,this.dpr=application.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const e=application.global.getRequestAnimationFrame();this.rafId=e(()=>{application.global.devicePixelRatio!==this.dpr&&(this.dpr=application.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()})}_refreshByMediaQuery(){try{const e=`(resolution: ${window.devicePixelRatio}dppx)`,i=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))};matchMedia(e).addEventListener("change",i)}catch{return!1}return!0}deactivate(e){const i=application.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId)}}class IncrementalAutoRenderPlugin{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid}activate(e){this.pluginService=e,application.graphicService.hooks.onAddIncremental.tap(this.key,(i,n,o)=>{i.glyphHost&&(i=i.glyphHost),i.stage===e.stage&&i.stage!=null&&(this.nextUserParams.startAtId=n._uid,this.renderNextFrame(n))}),application.graphicService.hooks.onClearIncremental.tap(this.key,(i,n)=>{i.stage===e.stage&&i.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(i))})}deactivate(e){application.graphicService.hooks.onAddIncremental.taps=application.graphicService.hooks.onAddIncremental.taps.filter(i=>i.name!==this.key),application.graphicService.hooks.onClearIncremental.taps=application.graphicService.hooks.onClearIncremental.taps.filter(i=>i.name!==this.key)}renderNextFrame(e){this.nextFrameRenderGroupSet.add(e),this.willNextFrameRender||(this.willNextFrameRender=!0,application.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){const e=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach(i=>{const n=i.layer;if(!n||!i.layer.subLayers)return;const o=i.layer.subLayers.get(i._uid);o&&o.drawContribution&&o.drawContribution.draw(e.renderService,Object.assign({stage:e,layer:n,viewBox:e.window.getViewBox(),transMatrix:e.window.getViewBoxTransform(),clear:"transparent",renderService:e.renderService,updateBounds:!1,startAtId:i._uid,context:o.layer.getNativeHandler().getContext()},this.nextUserParams))}),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const globalBounds=new AABBBounds;class DirtyBoundsPlugin{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid}activate(e){this.pluginService=e,e.stage.hooks.afterRender.tap(this.key,i=>{i&&i===this.pluginService.stage&&i.dirtyBounds.clear()}),application.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(i,n,o,l)=>{i.glyphHost&&(i=i.glyphHost),n&&n===this.pluginService.stage&&n.renderCount&&(i.isContainer&&!i.shouldSelfChangeUpdateAABBBounds()||o&&(globalBounds.setValue(l.x1,l.y1,l.x2,l.y2),n.dirty(globalBounds,i.parent&&i.parent.globalTransMatrix)))}),application.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(i,n,o,l,u)=>{n&&n===this.pluginService.stage&&n.renderCount&&(i.isContainer&&!u||n.dirty(l.globalAABBBounds))}),application.graphicService.hooks.clearAABBBounds.tap(this.key,(i,n,o)=>{n&&n===this.pluginService.stage&&n.renderCount&&n&&n.dirty(o)}),application.graphicService.hooks.onRemove.tap(this.key,i=>{const n=i.stage;n&&n===this.pluginService.stage&&n.renderCount&&n&&n.dirty(i.globalAABBBounds)})}deactivate(e){application.graphicService.hooks.beforeUpdateAABBBounds.taps=application.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(i=>i.name!==this.key),application.graphicService.hooks.afterUpdateAABBBounds.taps=application.graphicService.hooks.afterUpdateAABBBounds.taps.filter(i=>i.name!==this.key),application.graphicService.hooks.clearAABBBounds.taps=application.graphicService.hooks.clearAABBBounds.taps.filter(i=>i.name!==this.key),e.stage.hooks.afterRender.taps=e.stage.hooks.afterRender.taps.filter(i=>i.name!==this.key),application.graphicService.hooks.onRemove.taps=application.graphicService.hooks.onRemove.taps.filter(i=>i.name!==this.key)}}const defaultTicker=new DefaultTicker;defaultTicker.addTimeline(defaultTimeline);defaultTicker.setFPS(60);let _isBrowserEnv;function initIsBrowserEnv(){if(_isBrowserEnv==null)try{const r=document.createElement("canvas"),e=r.getContext("2d");_isBrowserEnv=!!(window&&r.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&e&&e.isPointInPath&&e.isPointInStroke),_isBrowserEnv&&(_isBrowserEnv=!!document.createElement)}catch{_isBrowserEnv=!1}}function isBrowserEnv(){initIsBrowserEnv();const r=application.global&&application.global.env;return r?r==="browser":_isBrowserEnv}let Factory$2=class Oe{static registerPlugin(e,i){Oe._pluginClasses[e]=i}static getPlugin(e){return Oe._pluginClasses[e]}};Factory$2._pluginClasses={};const DefaultConfig$1={BACKGROUND:"white"};class Stage extends Group$1{set viewBox(e){this.window.setViewBox(e)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(e){const i=this.window.getViewBox();i.translate(e-i.x1,0),this.window.setViewBox(i)}get y(){return this.window.getViewBox().y1}set y(e){const i=this.window.getViewBox();i.translate(0,e-i.y1),this.window.setViewBox(i)}get width(){return this.window.width}set width(e){this.resize(e,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(e){this.resizeView(e,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(e){this.resizeView(this.viewWidth,e)}get height(){return this.window.height}set height(e){this.resize(this.width,e)}get dpr(){return this.window.dpr}set dpr(e){this.setDpr(e)}get background(){var e;return(e=this._background)!==null&&e!==void 0?e:DefaultConfig$1.BACKGROUND}set background(e){this._background=e}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(e={}){var i;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=n=>{if(!(this._skipRender<0))if(n){if(this.dirtyBounds){const o=this.window.getViewBox();this.dirtyBounds.setValue(o.x1,o.y1,o.width(),o.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=n=>{this._beforeRender&&this._beforeRender(n)},this.afterRender=n=>{this.renderCount++,this._afterRender&&this._afterRender(n),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach(o=>o(n)),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var n;this.tickedBeforeRender=!0,((n=this.params.optimize)===null||n===void 0?void 0:n.tickRenderMode)==="performance"||this.state!=="rendering"&&this.render()},this.params=e,this.theme=new Theme,this.hooks={beforeRender:new SyncHook(["stage"]),afterRender:new SyncHook(["stage"])},this.global=application.global,!this.global.env&&isBrowserEnv()&&this.global.setEnv("browser"),this.window=container.get(VWindow),this.renderService=container.get(RenderService),this.pluginService=container.get(PluginService),this.layerService=container.get(LayerService),this.pluginService.active(this,e),this.window.create({width:e.width,height:e.height,viewBox:e.viewBox,container:e.container,dpr:e.dpr||this.global.devicePixelRatio,canvasControled:e.canvasControled!==!1,title:e.title||"",canvas:e.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=(i=e.background)!==null&&i!==void 0?i:DefaultConfig$1.BACKGROUND,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=e.renderStyle,e.autoRender&&this.enableAutoRender(),e.autoRefresh&&this.enableAutoRefresh(),e.disableDirtyBounds===!1&&this.enableDirtyBounds(),e.enableHtmlAttribute&&this.enableHtmlAttribute(e.enableHtmlAttribute),e.ReactDOM&&this.enableReactAttribute(e.ReactDOM),e.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=e.beforeRender,this._afterRender=e.afterRender,this.ticker=e.ticker||defaultTicker,this.supportInteractiveLayer=e.interactiveLayer!==!1,this.timeline=new DefaultTimeline,this.ticker.addTimeline(this.timeline),this.timeline.pause(),e.optimize||(e.optimize={}),this.optmize(e.optimize),e.background&&isString(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(e=-1){this._skipRender=e}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new EventSystem(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(e){e?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(e){this.optmizeRender(e.skipRenderWithOutRange),this.params.optimize=e}optmizeRender(e=!1){e&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(e){const{center:i={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:n={},alpha:o=0,beta:l=0,camera:u,fieldRatio:d=1,fieldDepth:f}=e;return Object.assign(Object.assign({},e),{center:i,light:n,alpha:o,beta:l,camera:u,fieldRatio:d,fieldDepth:f})}set3dOptions(e){var i,n,o,l,u,d;this.option3d=e;const f=this.get3dOptions(e),{light:g,center:_,camera:y,alpha:b,beta:S,fieldRatio:v,fieldDepth:A}=f,{dir:x=[1,1,-1],color:T="white",ambient:C}=g,E=((i=_.x)!==null&&i!==void 0?i:this.width/2)+((n=_.dx)!==null&&n!==void 0?n:0),P=((o=_.y)!==null&&o!==void 0?o:this.height/2)+((l=_.dy)!==null&&l!==void 0?l:0),L=[E,P,((u=_.z)!==null&&u!==void 0?u:0)+((d=_.dz)!==null&&d!==void 0?d:0)];let R=0,w=0,D=0;y||(R=Math.sin(b)+E,w=Math.sin(S)+P,D=Math.cos(b)*Math.cos(S)*1);const I=Factory$2.getPlugin("DirectionalLight");I&&(this.light=new I(x,T,C));const O={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:v,fieldDepth:A,viewParams:{pos:[R,w,D],center:L,up:[0,1,0]}};if(this.camera)this.camera.params=O;else{const B=Factory$2.getPlugin("OrthoCamera");B&&(this.camera=new B(O))}e.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(e){this._beforeRender=e}setAfterRender(e){this._afterRender=e}afterNextRender(e){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(e)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const e=Factory$2.getPlugin("ViewTransform3dPlugin");e&&this.pluginService.register(new e)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new AutoRenderPlugin))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new AutoRefreshPlugin))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new IncrementalAutoRenderPlugin))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Bounds;let e=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];e?e.activate(this.pluginService):(e=new DirtyBoundsPlugin,this.pluginService.register(e))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const e=Factory$2.getPlugin("FlexLayoutPlugin");e&&this.pluginService.register(new e)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableHtmlAttribute(e){if(this.htmlAttribute)return;const i=Factory$2.getPlugin("HtmlAttributePlugin");i&&(this.htmlAttribute=e,this.pluginService.register(new i))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach(e=>{this.pluginService.unRegister(e)}))}enableReactAttribute(e){if(this.reactAttribute)return;const i=Factory$2.getPlugin("ReactAttributePlugin");i&&(this.reactAttribute=e,this.pluginService.register(new i))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach(e=>{this.pluginService.unRegister(e)}))}getPluginsByName(e){return this.pluginService.findPluginsByName(e)}tryUpdateAABBBounds(){const e=this.window.getViewBox();return this._AABBBounds.setValue(e.x1,e.y1,e.x2,e.y2),this._AABBBounds}combineLayer(e,i){throw new Error("")}createLayer(e,i){if(this.releaseStatus==="released")return;const n=this.layerService.createLayer(this,{main:!1,layerMode:i,canvasId:e});return this.appendChild(n),n}sortLayer(e){const i=this.children;i.sort(e),this.removeAllChild(),i.forEach(n=>{this.appendChild(n)})}removeLayer(e){return this.removeChild(this.findChildByUid(e))}tryInitInteractiveLayer(){this.releaseStatus!=="released"&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(e){this.window.clearViewBox(e)}render(e,i){if(this.releaseStatus==="released")return;this.ticker.start(),this.timeline.resume();const n=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=i,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=n,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env==="harmony"){const e=this.window.getContext().nativeContext;this.forEachChildren((i,n)=>{if(n>0){const o=i.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();e.transferFromImageBitmap(o)}})}}renderNextFrame(e,i){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(e||this).forEach(n=>{this.nextFrameRenderLayerSet.add(n)}),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){if(this.releaseStatus==="released")return;this.timeline.resume(),this.ticker.start();const e=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=e,this._skipRender&&this._skipRender++}renderLayerList(e,i){const n=[];for(let o=0;o<e.length;o++){let l=e[o];l.layerMode==="virtual"&&(l=l.getNativeHandler().mainHandler.layer),n.includes(l)||n.push(l)}n.forEach(o=>{o.renderCount>this.renderCount||(o.renderCount=this.renderCount+1,o===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),o.render({renderService:this.renderService,background:o===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},i)))}),this.interactiveLayer&&!e.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},i)))}resizeWindow(e,i,n=!0){this.window.resize(e,i),n&&this.render()}resize(e,i,n=!0){this.releaseStatus!=="released"&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+e,this.viewBox.y1+i),this.window.resize(e,i),this.forEachChildren(o=>{o.resize(e,i)}),this.camera&&this.option3d&&this.set3dOptions(this.option3d),n&&this.render())}resizeView(e,i,n=!0){this.releaseStatus!=="released"&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+e,this.viewBox.y1+i),this.forEachChildren(o=>{o.resizeView(e,i)}),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),n&&this.render())}setViewBox(e,i,n,o,l){let u=!0;typeof e=="object"?(this.viewBox.setValue(e.x1,e.y1,e.x2,e.y2),i===!1&&(u=!1)):(this.viewBox.setValue(e,i,e+n,i+o),l===!1&&(u=!1)),this.forEachChildren(d=>{d.resizeView(this.viewBox.width(),this.viewBox.height())}),u&&this.render()}setDpr(e,i=!0){this.forEachChildren(n=>{n.setDpr(e)}),i&&this.render()}setOrigin(e,i){throw new Error("")}export(e){throw new Error("")}pick(e,i){if(this.releaseStatus==="released")return;const n=this.getPickerService().pick(this.children,new Point(e,i),{bounds:this.AABBBounds});return!(!(n!=null&&n.graphic)&&!(n!=null&&n.group))&&n}startAnimate(e){throw new Error("")}setToFrame(e){throw new Error("")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach(e=>{e.release()}),this.interactiveLayer&&(this.interactiveLayer.forEachChildren(e=>{e.setStage&&e.setStage(null,null),this.interactiveLayer.removeChild(e)}),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(e){}dirty(e,i){this.releaseStatus!=="released"&&(i&&e.transformWithMatrix(i),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(e.x1,e.y1,e.x2,e.y2),this.dirtyBounds.union(e))}getLayer(e){return this.children.filter(i=>i.name===e)[0]}renderTo(e){this.releaseStatus!=="released"&&this.forEachChildren((i,n)=>{i.drawTo(e,{renderService:this.renderService,viewBox:e.getViewBox(),transMatrix:e.getViewBoxTransform(),background:i===this.defaultLayer?this.background:void 0,clear:n===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})})}renderToNewWindow(e=!0,i){if(this.releaseStatus==="released")return;const n=container.get(VWindow),o=i?-i.x1:0,l=i?-i.y1:0,u=i?i.x2:this.viewWidth,d=i?i.y2:this.viewHeight,f=i?i.width():this.viewWidth,g=i?i.height():this.viewHeight;return n.create({viewBox:{x1:o,y1:l,x2:u,y2:d},width:f,height:g,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(n),n}toCanvas(e=!0,i){if(this.releaseStatus==="released")return;const n=this.renderToNewWindow(e,i).getNativeHandler();return n.nativeCanvas?n.nativeCanvas:null}setCursor(e){this._cursor=e,this.eventSystem.setCursor(e,"ignore")}getCursor(){return this._cursor}eventPointTransform(e){const i=this.global.mapToCanvasPoint(e,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(i.x,i.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=container.get(PickerService)),this.pickerService}}function createStage(r){return new Stage(r)}const DefaultConfig={WIDTH:500,HEIGHT:500,DPR:1};class BaseCanvas{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get nativeCanvas(){return this._nativeCanvas}get width(){return this._pixelWidth}set width(e){this._pixelWidth=e,this._displayWidth=e/(this._dpr||1)}get height(){return this._pixelHeight}set height(e){this._pixelHeight=e,this._displayHeight=e/(this._dpr||1)}getContext(e){return this._context}get visiable(){return this._visiable}set visiable(e){this._visiable=e,e?this.show():this.hide()}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this.resize(this._displayWidth,this._displayHeight)}constructor(e){var i;const{nativeCanvas:n,width:o=DefaultConfig.WIDTH,height:l=DefaultConfig.HEIGHT,dpr:u=DefaultConfig.DPR,x:d,y:f,id:g,canvasControled:_=!0}=e;this._x=d??0,this._y=f??0,this._pixelWidth=o*u,this._pixelHeight=l*u,this._visiable=e.visiable!==!1,this.controled=_,this._displayWidth=o,this._displayHeight=l,this._dpr=u,this._nativeCanvas=n,this._id=(i=n.id)!==null&&i!==void 0?i:g,g&&(n.id=g),this.init(e)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(e){}resize(e,i){}toDataURL(e,i){return""}readPixels(e,i,n,o){return this._context.getImageData(e,i,n,o)}convertToBlob(e){throw new Error("")}transferToImageBitmap(){throw new Error("")}release(...e){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}BaseCanvas.env="browser";var __decorate$K=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__awaiter$4=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};let BaseEnvContribution=class{configure(r,...e){r.env===this.type&&r.setActiveEnvContribution(this)}getNativeAABBBounds(r){return new AABBBounds}removeDom(r){return!1}createDom(r){return null}updateDom(r,e){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(r){return document.getElementById(r)}getRootElement(){return document.body}loadJson(r){const e=fetch(r).then(i=>i.json());return e.then(i=>({data:i,state:"success"})).catch(()=>({data:null,state:"fail"})),e}loadArrayBuffer(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadBlob(r){return fetch(r).then(e=>e.blob()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}getElementTop(r,e){return 0}getElementLeft(r,e){return 0}getElementTopLeft(r,e){return{top:0,left:0}}loadFont(r,e,i){return __awaiter$4(this,void 0,void 0,function*(){return{loadState:"fail"}})}};BaseEnvContribution=__decorate$K([injectable()],BaseEnvContribution);var __decorate$J=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$x=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let BaseWindowHandlerContribution=class{constructor(){this._uid=Generator.GenAutoIncrementId(),this.viewBox=new AABBBounds,this.modelMatrix=new Matrix(1,0,0,1,0,0)}onChange(r){this._onChangeCb=r}configure(r,e){e.env===this.type&&r.setWindowHandler(this)}release(...r){this.releaseWindow()}isVisible(r){return!0}onVisibleChange(r){}getTopLeft(r){return{top:0,left:0}}setViewBox(r){this.viewBox.setValue(r.x1,r.y1,r.x2,r.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(r,e,i,n,o,l){this.modelMatrix.setValue(r,e,i,n,o,l)}getViewBoxTransform(){return this.modelMatrix}};BaseWindowHandlerContribution=__decorate$J([injectable(),__metadata$x("design:paramtypes",[])],BaseWindowHandlerContribution);class DirectionalLight{constructor(e,i,n=.8){this.dir=e,this.color=i,this.colorRgb=ColorStore.Get(i,ColorType.Color1),this.ambient=n;const o=sqrt$3(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);this.formatedDir=[e[0]/o,e[1]/o,e[2]/o]}computeColor(e,i){const n=this.formatedDir,o=min$1(max$1((e[0]*n[0]+e[1]*n[1]+e[2]*n[2])*(1-this.ambient/2),0)+this.ambient,1);let l;l=isString(i)?ColorStore.Get(i,ColorType.Color1):i;const u=this.colorRgb;return`rgb(${u[0]*l[0]*o}, ${u[1]*l[1]*o}, ${u[2]*l[2]*o})`}}const registerDirectionalLight=()=>{Factory$2.registerPlugin("DirectionalLight",DirectionalLight)};class OrthoCamera{set params(e){this._params=Object.assign({},e),this._projectionMatrixCached=this.forceGetProjectionMatrix(),this._viewMatrixCached=this.forceGetViewMatrix()}get params(){return Object.assign({},this._params)}constructor(e){this.params=e}getViewMatrix(){return this._viewMatrixCached||(this._viewMatrixCached=mat4Allocate.allocate()),this._viewMatrixCached}forceGetViewMatrix(){this._viewMatrixCached||(this._viewMatrixCached=mat4Allocate.allocate());const{pos:e,center:i,up:n}=this.params.viewParams;return lookAt(this._viewMatrixCached,e,i,n),this._vp||(this._vp=mat4Allocate.allocate()),this._vp=multiplyMat4Mat4(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._viewMatrixCached}getProjectionMatrix(){return this._projectionMatrixCached||(this._projectionMatrixCached=mat4Allocate.allocate()),this._projectionMatrixCached}forceGetProjectionMatrix(){this._projectionMatrixCached||(this._projectionMatrixCached=mat4Allocate.allocate());const{left:e,top:i,right:n,bottom:o}=this._params;return ortho(this._projectionMatrixCached,e,n,o,i,0,-2e6),this._vp||(this._vp=mat4Allocate.allocate()),this._vp=multiplyMat4Mat4(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._projectionMatrixCached}getField(){const{fieldRatio:e=.8,fieldDepth:i,left:n,right:o}=this._params;return(i??o-n)*e}getProjectionScale(e){const i=this.getField();return i/(i+e)}view(e,i,n){const o=[0,0,0];return transformMat4(o,[e,i,n],this._viewMatrixCached),o}vp(e,i,n){const o=[0,0,0],{pos:l}=this._params.viewParams;transformMat4(o,[e,i,n],this._viewMatrixCached),e=o[0],i=o[1],n=o[2];const u=this.getProjectionScale(n);return{x:e*u+l[0],y:i*u+l[1]}}}const registerOrthoCamera=()=>{Factory$2.registerPlugin("OrthoCamera",OrthoCamera)};var __decorate$I=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$w=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$p=function(r,e){return function(i,n){e(i,n,r)}};let DefaultPickService=class{constructor(r){this.pickItemInterceptorContributions=r,this.type="default",this.global=application.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort((r,e)=>r.order-e.order)}pick(r,e,i){let n={graphic:null,group:null};i.pickerService=this;const o=i.bounds.width(),l=i.bounds.height();if(!new AABBBounds().setValue(0,0,o,l).containsPoint(e))return n;this.pickContext&&(this.pickContext.inuse=!0),i.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const u=new Matrix(1,0,0,1,0,0);let d;for(let f=r.length-1;f>=0&&(n=r[f].isContainer?this.pickGroup(r[f],e,u,i):this.pickItem(r[f],e,u,i),!n.graphic);f--)d||(d=n.group);if(n.graphic||(n.group=d),this.pickContext&&(this.pickContext.inuse=!1),n.graphic){let f=n.graphic;for(;f.parent;)f=f.parent;f.shadowHost&&(n.params={shadowTarget:n.graphic},n.graphic=f.shadowHost)}return n}containsPoint(r,e,i){var n;return!!(!((n=this.pickItem(r,e,null,i??{pickContext:this.pickContext,pickerService:this}))===null||n===void 0)&&n.graphic)}pickGroup(r,e,i,n){let o={group:null,graphic:null};if(r.attribute.visibleAll===!1)return o;const l=n.pickContext,u=l.modelMatrix;if(l.camera){const S=r.transMatrix,v=mat4Allocate.allocate();if(mat3Tomat4(v,S),u){if(v){const A=mat4Allocate.allocate();l.modelMatrix=multiplyMat4Mat4(A,u,v),mat4Allocate.free(v)}}else mat3Tomat4(v,r.globalTransMatrix),l.modelMatrix=v}if(this.InterceptorContributions.length)for(let S=0;S<this.InterceptorContributions.length;S++){const v=this.InterceptorContributions[S];if(v.beforePickItem){const A=v.beforePickItem(r,this,e,n,{parentMatrix:i});if(A)return l.modelMatrix!==u&&mat4Allocate.free(l.modelMatrix),l.modelMatrix=u,A}}const d=r.transMatrix,f=matrixAllocate.allocateByObj(i),g=new Point(e.x,e.y);f.transformPoint(g,g);const _=r.AABBBounds.containsPoint(g);if(!_&&!r.stage.camera)return o;const y=this.pickItem(r,g.clone(),i,n);y&&y.graphic&&(o.graphic=y.graphic,o.params=y.params);const b=r.attribute.pickable!==!1&&_;return f.multiply(d.a,d.b,d.c,d.d,d.e,d.f),r.attribute.childrenPickable===!1||y&&y.graphic||foreach(r,DefaultAttribute.zIndex,S=>{if(S.isContainer){const v=new Point(e.x,e.y),A=getTheme$1(r).group,{scrollX:x=A.scrollX,scrollY:T=A.scrollY}=r.attribute;v.x-=x,v.y-=T,o=this.pickGroup(S,v,f,n)}else{const v=new Point(e.x,e.y);f.transformPoint(v,v);const A=getTheme$1(r).group,{scrollX:x=A.scrollX,scrollY:T=A.scrollY}=r.attribute;v.x-=x,v.y-=T;const C=this.pickItem(S,v,i,n);C&&C.graphic&&(o.graphic=C.graphic,o.params=C.params)}return!!o.graphic||!!o.group},!0,!!l.camera),l.modelMatrix!==u&&mat4Allocate.free(l.modelMatrix),l.modelMatrix=u,o.graphic||o.group||!b||r.stage.camera||(o.group=r),matrixAllocate.free(f),o}selectPicker(r){return this.pickerMap.get(r.numberType)||null}};DefaultPickService=__decorate$I([injectable(),__param$p(0,inject(ContributionProvider)),__param$p(0,named(PickItemInterceptor)),__metadata$w("design:paramtypes",[Object])],DefaultPickService);function simplifyRadialDist(r,e){let i,n,o=r[0].x,l=r[0].y;const u=[r[0]];for(let d=1,f=r.length;d<f;d++)i=r[d].x-o,n=r[d].y-l,i*i+n*n>e&&(o=r[d].x,l=r[d].y,u.push(r[d]));return r[r.length-1].x===o&&r[r.length-1].y===l||u.push(r[r.length-1]),u}function flatten_simplify(r,e,i){return r.length<=10?r:r=simplifyRadialDist(r,e!==void 0?e*e:1)}let loadArcModule=!1;const arcModule=new ContainerModule(r=>{loadArcModule||(loadArcModule=!0,r(DefaultCanvasArcRender).toSelf().inSingletonScope(),r(ArcRender).to(DefaultCanvasArcRender).inSingletonScope(),r(GraphicRender).toService(ArcRender),r(ArcRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,ArcRenderContribution))});let loadRectModule=!1;const rectModule=new ContainerModule(r=>{loadRectModule||(loadRectModule=!0,r(DefaultCanvasRectRender).toSelf().inSingletonScope(),r(RectRender).to(DefaultCanvasRectRender).inSingletonScope(),r(GraphicRender).toService(RectRender),r(SplitRectAfterRenderContribution).toSelf(),r(SplitRectBeforeRenderContribution).toSelf(),r(RectRenderContribution).toService(SplitRectAfterRenderContribution),r(RectRenderContribution).toService(SplitRectBeforeRenderContribution),r(RectRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,RectRenderContribution))});let loadLineModule=!1;const lineModule=new ContainerModule(r=>{loadLineModule||(loadLineModule=!0,r(DefaultCanvasLineRender).toSelf().inSingletonScope(),r(DefaultIncrementalCanvasLineRender).toSelf().inSingletonScope(),r(LineRender).to(DefaultCanvasLineRender).inSingletonScope(),r(GraphicRender).toService(LineRender))});let loadAreaModule=!1;const areaModule=new ContainerModule(r=>{loadAreaModule||(loadAreaModule=!0,r(DefaultCanvasAreaRender).toSelf().inSingletonScope(),r(AreaRender).to(DefaultCanvasAreaRender).inSingletonScope(),r(GraphicRender).toService(AreaRender),r(AreaRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,AreaRenderContribution),r(DefaultIncrementalCanvasAreaRender).toSelf().inSingletonScope())});let loadSymbolModule=!1;const symbolModule=new ContainerModule(r=>{loadSymbolModule||(loadSymbolModule=!0,r(DefaultCanvasSymbolRender).toSelf().inSingletonScope(),r(SymbolRender).to(DefaultCanvasSymbolRender).inSingletonScope(),r(GraphicRender).toService(SymbolRender),r(SymbolRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,SymbolRenderContribution))});let loadCircleModule=!1;const circleModule=new ContainerModule(r=>{loadCircleModule||(loadCircleModule=!0,r(DefaultCanvasCircleRender).toSelf().inSingletonScope(),r(CircleRender).to(DefaultCanvasCircleRender).inSingletonScope(),r(GraphicRender).toService(CircleRender),r(CircleRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,CircleRenderContribution))});let loadTextModule=!1;const textModule=new ContainerModule(r=>{loadTextModule||(loadTextModule=!0,r(TextRender).to(DefaultCanvasTextRender).inSingletonScope(),r(GraphicRender).toService(TextRender),r(TextRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,TextRenderContribution))});let loadPathModule=!1;const pathModule=new ContainerModule(r=>{loadPathModule||(loadPathModule=!0,r(DefaultCanvasPathRender).toSelf().inSingletonScope(),r(PathRender).to(DefaultCanvasPathRender).inSingletonScope(),r(GraphicRender).toService(PathRender),r(PathRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,PathRenderContribution))});let loadPolygonModule=!1;const polygonModule=new ContainerModule(r=>{loadPolygonModule||(loadPolygonModule=!0,r(PolygonRender).to(DefaultCanvasPolygonRender).inSingletonScope(),r(GraphicRender).toService(PolygonRender),r(PolygonRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,PolygonRenderContribution))});var __decorate$H=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultCanvasGlyphRender=class{constructor(){this.numberType=GLYPH_NUMBER_TYPE}drawShape(r,e,i,n,o,l,u,d){o.drawContribution&&r.getSubGraphic().forEach(f=>{const g=o.drawContribution.getRenderContribution(f);g&&g.drawShape&&g.drawShape(f,e,i,n,o,l,u,d)})}draw(r,e,i,n){const{context:o}=i;if(!o||(o.highPerformanceSave(),!i.drawContribution))return;const l=getTheme$1(r),u=r.getSubGraphic();u.length&&u.forEach(d=>{i.drawContribution.renderItem(d,i,{theme:l})}),o.highPerformanceRestore()}};DefaultCanvasGlyphRender=__decorate$H([injectable()],DefaultCanvasGlyphRender);let loadGlyphModule=!1;const glyphModule=new ContainerModule(r=>{loadGlyphModule||(loadGlyphModule=!0,r(GlyphRender).to(DefaultCanvasGlyphRender).inSingletonScope(),r(GraphicRender).toService(GlyphRender))});var __decorate$G=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$v=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let DefaultCanvasRichTextRender=class extends BaseRender{constructor(){super(),this.numberType=RICHTEXT_NUMBER_TYPE,this.builtinContributions=[defaultTextBackgroundRenderContribution],this.init()}drawShape(r,e,i,n,o){const l=getTheme$1(r).richtext,{strokeOpacity:u=l.strokeOpacity,opacity:d=l.opacity,fillOpacity:f=l.fillOpacity,visible:g=l.visible}=r.attribute;if(!r.valid||!g)return;const _=fillVisible(d,f,!0),y=fillVisible(d,u,!0);_&&(e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,l),e.translate(i,n),this.beforeRenderStep(r,e,i,n,_,y,_,y,l,o),r.getFrameCache().draw(e,this.drawIcon),this.afterRenderStep(r,e,i,n,_,y,_,y,l,o))}drawIcon(r,e,i,n,o){var l;const u=getTheme$1(r).richtextIcon,{width:d=u.width,height:f=u.height,opacity:g=u.opacity,image:_,backgroundFill:y=u.backgroundFill,backgroundFillOpacity:b=u.backgroundFillOpacity,backgroundStroke:S=u.backgroundStroke,backgroundStrokeOpacity:v=u.backgroundStrokeOpacity,backgroundRadius:A=u.backgroundRadius,margin:x}=r.attribute,{backgroundWidth:T=d,backgroundHeight:C=f}=r.attribute;if(x&&(i+=r._marginArray[3],n+=r._marginArray[0]),r._hovered){const P=(T-d)/2,L=(C-f)/2;A===0?(e.beginPath(),e.rect(i-P,n-L,T,C)):(e.beginPath(),createRectPath(e,i-P,n-L,T,C,A)),y&&(e.globalAlpha=b,e.fillStyle=y,e.fill()),S&&(e.globalAlpha=v,e.strokeStyle=S,e.stroke())}const E=_&&((l=r==null?void 0:r.resources)===null||l===void 0?void 0:l.get(_));E&&E.state==="success"&&(e.globalAlpha=g,e.drawImage(E.data,i,n,d,f))}draw(r,e,i){const n=getTheme$1(r).richtext;this._draw(r,n,!1,i)}};DefaultCanvasRichTextRender=__decorate$G([injectable(),__metadata$v("design:paramtypes",[])],DefaultCanvasRichTextRender);let loadRichtextModule=!1;const richtextModule=new ContainerModule(r=>{loadRichtextModule||(loadRichtextModule=!0,r(RichTextRender).to(DefaultCanvasRichTextRender).inSingletonScope(),r(GraphicRender).toService(RichTextRender))});let loadImageModule=!1;const imageModule=new ContainerModule(r=>{loadImageModule||(loadImageModule=!0,r(ImageRender).to(DefaultCanvasImageRender).inSingletonScope(),r(GraphicRender).toService(ImageRender),r(ImageRenderContribution).toService(DefaultBaseInteractiveRenderContribution),bindContributionProvider(r,ImageRenderContribution))});class Base3dRender extends BaseRender{stroke(e,i,n,o,l){const u=o.vertices;o.edges.forEach(d=>{const f=u[d[0]],g={x:e+f[0],y:i+f[1],z:n+f[2]},_=u[d[1]],y={x:e+_[0],y:i+_[1],z:n+_[2]};l.beginPath(),l.moveTo(g.x,g.y,g.z),l.lineTo(y.x,y.y,y.z),l.stroke()})}fill(e,i,n,o,l,u,d,f,g,_,y){const b=ColorStore.Get(u,ColorType.Color255),S=o.vertices,v=S.map(x=>d.view(x[0],x[1],x[2])[2]),A=[];o.polygons.forEach((x,T)=>{if(l&&!l[T])return;A.push({faceIdx:T,polygon:x});const{polygon:C}=x,E=v[C[0]],P=v[C[1]],L=v[C[2]],R=v[C[3]];x.ave_z=E+P+L+R}),A.sort((x,T)=>T.polygon.ave_z-x.polygon.ave_z),A.forEach(x=>{const{polygon:T,normal:C}=x.polygon,E=S[T[0]],P=S[T[1]],L=S[T[2]],R=S[T[3]],w={x:e+E[0],y:i+E[1],z:n+E[2]},D={x:e+P[0],y:i+P[1],z:n+P[2]},I={x:e+L[0],y:i+L[1],z:n+L[2]},O={x:e+R[0],y:i+R[1],z:n+R[2]};d.beginPath(),d.moveTo(w.x,w.y,w.z),d.lineTo(D.x,D.y,D.z),d.lineTo(I.x,I.y,I.z),d.lineTo(O.x,O.y,O.z),d.closePath(),y?y(d,g&&g.attribute,_):(d.fillStyle=f?f.computeColor(C,b):u,d.fill())})}}var __decorate$F=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultCanvasRect3dRender=class extends Base3dRender{constructor(){super(...arguments),this.type="rect3d",this.numberType=RECT3D_NUMBER_TYPE}drawShape(r,e,i,n,o,l,u,d){var f;const g=getTheme$1(r,l==null?void 0:l.theme).rect,{fill:_=g.fill,stroke:y=g.stroke,x1:b,y1:S,x:v,y:A,opacity:x=g.opacity,fillOpacity:T=g.fillOpacity,lineWidth:C=g.lineWidth,strokeOpacity:E=g.strokeOpacity,visible:P=g.visible}=r.attribute;let{width:L,height:R}=r.attribute;L=(L??b-v)||0,R=(R??S-A)||0;const w=(f=this.z)!==null&&f!==void 0?f:0,D=rectFillVisible(x,T,L,R,_),I=rectStrokeVisible(x,E,L,R),O=runFill(_),B=runStroke(y,C);if(!r.valid||!P||!O&&!B||!(D||I||u||d))return;const{light:N}=o.stage||{},$=r.findFace();if(_!==!1){e.setCommonStyle(r,r.attribute,i,n,g);let H=_;typeof H!="string"&&(H="black"),this.fill(i,n,w,$,null,H,e,N,null,null,u)}y!==!1&&(e.setStrokeStyle(r,r.attribute,i,n,g),this.stroke(i,n,w,$,e))}draw(r,e,i){const n=getTheme$1(r).rect;this._draw(r,n,!1,i)}};DefaultCanvasRect3dRender=__decorate$F([injectable()],DefaultCanvasRect3dRender);let loadRect3dModule=!1;const rect3dModule=new ContainerModule(r=>{loadRect3dModule||(loadRect3dModule=!0,r(Rect3DRender).to(DefaultCanvasRect3dRender).inSingletonScope(),r(GraphicRender).toService(Rect3DRender))});var __decorate$E=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};function drawArcPath(r,e,i,n,o,l,u){const{startAngle:d,endAngle:f}=r.getParsedAngle(),g=abs$1(f-d),_=f>d;let y=!1;if(l<u){const b=l;l=u,u=b}if(l<=epsilon$1)e.moveTo(i,n,o);else if(g>=pi2-epsilon$1)e.moveTo(i+l*cos$1(d),n+l*sin$1(d),o),e.arc(i,n,l,d,f,!_,o),u>epsilon$1&&(e.moveTo(i+u*cos$1(f),n+u*sin$1(f),o),e.arc(i,n,u,f,d,_,o));else{const{outerDeltaAngle:b,innerDeltaAngle:S,outerStartAngle:v,outerEndAngle:A,innerEndAngle:x,innerStartAngle:T}=r.getParsePadAngle(d,f),C=l*cos$1(v),E=l*sin$1(v),P=u*cos$1(x),L=u*sin$1(x);b<.001?y=!0:(e.moveTo(i+C,n+E,o),e.arc(i,n,l,v,A,!_,o)),!(u>epsilon$1)||S<.001?(e.lineTo(i+P,n+L,o),y=!0):(e.lineTo(i+P,n+L,o),e.arc(i,n,u,x,T,_,o))}return e.closePath(),y}function drawInnerOuterArcPath(r,e,i,n,o,l,u,d){const{startAngle:f,endAngle:g}=r.getParsedAngle(),_=abs$1(g-f),y=g>f;let b=!1;if(u<=epsilon$1)e.moveTo(i,n,o);else if(_>=pi2-epsilon$1)e.moveTo(i+u*cos$1(f),n+u*sin$1(f),o),e.arc(i,n,u,f,g,!y,o),e.lineTo(i+u*cos$1(g),n+u*sin$1(g),l),e.arc(i,n,u,g,f,y,l);else{const{innerouterDeltaAngle:S,innerouterStartAngle:v,innerouterEndAngle:A}=d(f,g),x=u*cos$1(v),T=u*sin$1(v),C=u*cos$1(A),E=u*sin$1(A);S<.001?b=!0:(e.moveTo(i+x,n+T,o),e.arc(i,n,u,v,A,!y,o),e.lineTo(i+C,n+E,l),e.arc(i,n,u,A,v,y,l))}return e.closePath(),b}let DefaultCanvasArc3DRender=class extends BaseRender{constructor(){super(...arguments),this.numberType=ARC3D_NUMBER_TYPE}drawShape(r,e,i,n,o,l,u,d){var f;const g=getTheme$1(r,l==null?void 0:l.theme).arc,{fill:_=g.fill}=r.attribute,y=this.valid(r,g,u,d);if(!y)return;const{fVisible:b,sVisible:S,doFill:v,doStroke:A}=y,x=(f=this.z)!==null&&f!==void 0?f:0,{outerPadding:T=g.outerPadding,innerPadding:C=g.innerPadding,height:E=10}=r.attribute;let{outerRadius:P=g.outerRadius,innerRadius:L=g.innerRadius}=r.attribute;P+=T,L-=C;const R=ColorStore.Get(_,ColorType.Color255),{light:w}=o.stage||{},D=o.hack_pieFace,I={top:x,bottom:x+E},O={top:[0,1,0],bottom:[0,-1,0],outside:[1,0,-1],inside:[1,0,-1]};D==="bottom"||D==="top"?(e.beginPath(),drawArcPath(r,e,i,n,I[D],P,L),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,g),v&&(u?u(e,r.attribute,g):b&&(e.setCommonStyle(r,r.attribute,i,n,g),e.fillStyle=w?w.computeColor(O[D],R):_,e.fill())),A&&(d?d(e,r.attribute,g):S&&(e.setStrokeStyle(r,r.attribute,i,n,g),e.stroke()))):D!=="outside"&&D!=="inside"||(D==="inside"&&(e.save(),e.beginPath(),e.arc(i,n,L,0,pi2,!0,I.top),e.clip()),e.beginPath(),drawInnerOuterArcPath(r,e,i,n,I.top,I.bottom,D==="outside"?P:L,(B,N)=>{const{outerDeltaAngle:$,innerDeltaAngle:H,outerStartAngle:F,outerEndAngle:V,innerEndAngle:G,innerStartAngle:Y}=r.getParsePadAngle(B,N);return D==="outside"?{innerouterDeltaAngle:$,innerouterEndAngle:V,innerouterStartAngle:F}:{innerouterDeltaAngle:H,innerouterEndAngle:G,innerouterStartAngle:Y}}),e.setShadowBlendStyle&&e.setShadowBlendStyle(r,r.attribute,g),v&&(u?u(e,r.attribute,g):b&&(e.setCommonStyle(r,r.attribute,i,n,g),e.fillStyle=w?w.computeColor(O[D],R):_,e.fill())),A&&(d?d(e,r.attribute,g):S&&(e.setStrokeStyle(r,r.attribute,i,n,g),e.stroke())),D==="inside"&&e.restore())}draw(r,e,i,n){const o=getTheme$1(r,n==null?void 0:n.theme).arc;this._draw(r,o,!1,i,n)}};DefaultCanvasArc3DRender=__decorate$E([injectable()],DefaultCanvasArc3DRender);let loadArc3dModule=!1;const arc3dModule=new ContainerModule(r=>{loadArc3dModule||(loadArc3dModule=!0,r(Arc3dRender).to(DefaultCanvasArc3DRender).inSingletonScope(),r(GraphicRender).toService(Arc3dRender))});var __decorate$D=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultCanvasPyramid3dRender=class extends Base3dRender{constructor(){super(...arguments),this.type="pyramid3d",this.numberType=PYRAMID3D_NUMBER_TYPE}drawShape(r,e,i,n,o,l,u,d){var f;const g=getTheme$1(r,l==null?void 0:l.theme).polygon,{fill:_=g.fill,stroke:y=g.stroke,face:b=[!0,!0,!0,!0,!0,!0]}=r.attribute,S=(f=this.z)!==null&&f!==void 0?f:0;if(!this.valid(r,g,u,d))return;const{light:v}=o.stage||{},A=r.findFace();if(_!==!1){e.setCommonStyle(r,r.attribute,i,n,g);let x=_;typeof x!="string"&&(x="black"),this.fill(i,n,S,A,b,x,e,v,r,g,u)}y!==!1&&(e.setStrokeStyle(r,r.attribute,i,n,g),this.stroke(i,n,S,A,e))}draw(r,e,i){const n=getTheme$1(r).polygon;this._draw(r,n,!1,i)}};DefaultCanvasPyramid3dRender=__decorate$D([injectable()],DefaultCanvasPyramid3dRender);let loadPyramid3dModule=!1;const pyramid3dModule=new ContainerModule(r=>{loadPyramid3dModule||(loadPyramid3dModule=!0,r(Pyramid3dRender).to(DefaultCanvasPyramid3dRender).inSingletonScope(),r(GraphicRender).toService(Pyramid3dRender))});function registerArcGraphic$1(){graphicCreator.RegisterGraphicCreator("arc",createArc)}function registerArc3dGraphic$1(){graphicCreator.RegisterGraphicCreator("arc3d",createArc3d)}function registerAreaGraphic$1(){graphicCreator.RegisterGraphicCreator("area",createArea)}function registerCircleGraphic(){graphicCreator.RegisterGraphicCreator("circle",createCircle)}function registerGlyphGraphic$1(){graphicCreator.RegisterGraphicCreator("glyph",createGlyph)}function registerGroupGraphic$1(){graphicCreator.RegisterGraphicCreator("group",createGroup)}function registerImageGraphic$1(){graphicCreator.RegisterGraphicCreator("image",createImage)}function registerLineGraphic$1(){graphicCreator.RegisterGraphicCreator("line",createLine)}function registerPathGraphic$1(){graphicCreator.RegisterGraphicCreator("path",createPath)}function registerPolygonGraphic$1(){graphicCreator.RegisterGraphicCreator("polygon",createPolygon)}function registerPyramid3dGraphic$1(){graphicCreator.RegisterGraphicCreator("pyramid3d",createPyramid3d)}function registerRectGraphic$1(){graphicCreator.RegisterGraphicCreator("rect",createRect)}function registerRect3dGraphic$1(){graphicCreator.RegisterGraphicCreator("rect3d",createRect3d)}function registerRichtextGraphic(){graphicCreator.RegisterGraphicCreator("richtext",createRichText)}function registerSymbolGraphic$1(){graphicCreator.RegisterGraphicCreator("symbol",createSymbol)}function registerTextGraphic$1(){graphicCreator.RegisterGraphicCreator("text",createText)}function registerShadowRootGraphic(){graphicCreator.RegisterGraphicCreator("shadowRoot",createShadowRoot)}class HtmlAttributePlugin{constructor(){this.name="HtmlAttributePlugin",this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid,this.htmlMap={},this.renderId=0,this.onWheel=e=>{try{const i=new e.constructor(e.type,e);this.pluginService.stage.window.getContext().getCanvas().nativeCanvas.dispatchEvent(i)}catch{return}}}activate(e){this.pluginService=e,e.stage.hooks.afterRender.tap(this.key,i=>{i&&i===this.pluginService.stage&&this.drawHTML([...e.stage.getChildren()])})}deactivate(e){e.stage.hooks.afterRender.taps=e.stage.hooks.afterRender.taps.filter(i=>i.name!==this.key),application.graphicService.hooks.onRemove.unTap(this.key),application.graphicService.hooks.onRelease.unTap(this.key),this.release()}getWrapContainer(e,i,n){let o;return o=i?typeof i=="string"?application.global.getElementById(i):i:e.window.getContainer(),{wrapContainer:application.global.createDom(Object.assign({tagName:"div",parent:o},n)),nativeContainer:o}}parseDefaultStyleFromGraphic(e){const i=e.type==="text"&&e.attribute?e.attribute:getTheme$1(e).text;return textAttributesToStyle(i)}getTransformOfText(e){const i=getTheme$1(e).text,{textAlign:n=i.textAlign,textBaseline:o=i.textBaseline}=e.attribute,l=e.globalTransMatrix.toTransformAttrs(),{rotateDeg:u,scaleX:d,scaleY:f}=l,g={left:"0",start:"0",end:"-100%",center:"-50%",right:"-100%",top:"0",middle:"-50%",bottom:"-100%",alphabetic:"-79%"},_={left:"0",start:"0",end:"100%",center:"50%",right:"100%",top:"0",middle:"50%",bottom:"100%",alphabetic:"79%"};return{textAlign:n,transform:`translate(${g[n]},${g[o]}) rotate(${u}deg) scaleX(${d}) scaleY(${f})`,transformOrigin:`${_[n]} ${_[o]}`}}updateStyleOfWrapContainer(e,i,n,o,l){const{pointerEvents:u,penetrateEventList:d=[]}=l;let f=this.parseDefaultStyleFromGraphic(e);f.display=e.attribute.visible!==!1?"block":"none",f.pointerEvents=u===!0?"all":u||"none",f.pointerEvents!=="none"&&(this.removeWrapContainerEventListener(n),d.forEach(C=>{C==="wheel"&&n.addEventListener("wheel",this.onWheel)})),n.style.position||(n.style.position="absolute",o.style.position="relative");let g=0,_=0;const y=e.globalAABBBounds;let b=l.anchorType;if(isNil(b)&&(b=e.type==="text"?"position":"boundsLeftTop"),b==="boundsLeftTop"&&(b="top-left"),b==="position"||y.empty()){const C=e.globalTransMatrix;g=C.e,_=C.f}else{const C=calculateAnchorOfBounds(y,b);g=C.x,_=C.y}const S=application.global.getElementTopLeft(o,!1),v=i.window.getTopLeft(!1),A=i.viewBox,x=g+v.left-S.left+A.x1,T=_+v.top-S.top+A.y1;if(f.left=`${x}px`,f.top=`${T}px`,e.type==="text"&&b==="position"&&(f=Object.assign(Object.assign({},f),this.getTransformOfText(e))),isFunction(l.style)){const C=l.style({top:T,left:x,width:y.width(),height:y.height()},e,n);C&&(f=Object.assign(Object.assign({},f),C))}else isObject$1(l.style)?f=Object.assign(Object.assign({},f),l.style):isString(l.style)&&l.style&&(f=Object.assign(Object.assign({},f),styleStringToObject(l.style)));application.global.updateDom(n,{width:l.width,height:l.height,style:f})}clearCacheContainer(){this.htmlMap&&Object.keys(this.htmlMap).forEach(e=>{this.htmlMap[e]&&this.htmlMap[e].renderId!==this.renderId&&this.removeElement(e)}),this.renderId+=1}drawHTML(e){application.global.env==="browser"&&(e.sort((i,n)=>{var o,l;return((o=i.attribute.zIndex)!==null&&o!==void 0?o:DefaultAttribute.zIndex)-((l=n.attribute.zIndex)!==null&&l!==void 0?l:DefaultAttribute.zIndex)}).forEach(i=>{this.renderGroupHTML(i)}),this.clearCacheContainer())}renderGroupHTML(e){this.renderGraphicHTML(e),e.forEachChildren(i=>{i.isContainer?this.renderGroupHTML(i):this.renderGraphicHTML(i)})}removeElement(e){if(!this.htmlMap||!this.htmlMap[e])return;const{wrapContainer:i}=this.htmlMap[e];i&&application.global.removeDom(i),this.htmlMap[e]=null}removeWrapContainerEventListener(e){e.removeEventListener("wheel",this.onWheel)}renderGraphicHTML(e){var i;const{html:n}=e.attribute;if(!n)return;const o=e.stage;if(!o)return;const{dom:l,container:u}=n;if(!l)return;const d=isNil(n.id)?`${(i=e.id)!==null&&i!==void 0?i:e._uid}_react`:n.id;if(this.htmlMap&&this.htmlMap[d]&&u&&u!==this.htmlMap[d].container&&this.removeElement(d),this.htmlMap&&this.htmlMap[d])typeof l=="string"?this.htmlMap[d].wrapContainer.innerHTML=l:l!==this.htmlMap[d].wrapContainer.firstChild&&(this.htmlMap[d].wrapContainer.removeChild(this.htmlMap[d].wrapContainer.firstChild),this.htmlMap[d].wrapContainer.appendChild(l));else{const{wrapContainer:_,nativeContainer:y}=this.getWrapContainer(o,u);_&&(typeof l=="string"?_.innerHTML=l:_.appendChild(l),this.htmlMap||(this.htmlMap={}),this.htmlMap[d]={wrapContainer:_,nativeContainer:y,container:u,renderId:this.renderId})}if(!this.htmlMap||!this.htmlMap[d])return;const{wrapContainer:f,nativeContainer:g}=this.htmlMap[d];this.updateStyleOfWrapContainer(e,o,f,g,n),this.htmlMap[d].renderId=this.renderId}release(){application.global.env==="browser"&&this.removeAllDom(this.pluginService.stage.defaultLayer)}removeAllDom(e){this.htmlMap&&(Object.keys(this.htmlMap).forEach(i=>{this.removeElement(i)}),this.htmlMap=null)}}const registerHtmlAttributePlugin=()=>{Factory$2.registerPlugin("HtmlAttributePlugin",HtmlAttributePlugin)};class ReactAttributePlugin extends HtmlAttributePlugin{constructor(){super(...arguments),this.name="ReactAttributePlugin",this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid,this.htmlMap={}}removeElement(e){if(!this.htmlMap||!this.htmlMap[e])return;const{root:i,wrapContainer:n,unmount:o}=this.htmlMap[e];i?application.global.getRequestAnimationFrame()(()=>{i.unmount()}):o&&o(),n&&application.global.removeDom(n),this.htmlMap[e]=null}renderGraphicHTML(e){var i;const{react:n}=e.attribute;if(!n)return;const o=e.stage;if(!o)return;const l=o.params.ReactDOM,{element:u,container:d}=n;if(!u||!l||!l.createRoot&&!l.render)return;const f=isNil(n.id)?`${(i=e.id)!==null&&i!==void 0?i:e._uid}_react`:n.id;if(this.htmlMap&&this.htmlMap[f]&&d&&d!==this.htmlMap[f].container&&this.removeElement(f),this.htmlMap&&this.htmlMap[f])l.createRoot?this.htmlMap[f].root.render(u):l.render(u,this.htmlMap[f].wrapContainer);else{const{wrapContainer:y,nativeContainer:b}=this.getWrapContainer(o,d);if(y)if(this.htmlMap||(this.htmlMap={}),l.createRoot){const S=l.createRoot(y);S.render(u),this.htmlMap[f]={root:S,wrapContainer:y,nativeContainer:b,container:d,renderId:this.renderId}}else l.render(u,y),this.htmlMap[f]={wrapContainer:y,nativeContainer:b,container:d,renderId:this.renderId,unmount:()=>{l.unmountComponentAtNode(y)}}}if(!this.htmlMap||!this.htmlMap[f])return;const{wrapContainer:g,nativeContainer:_}=this.htmlMap[f];this.updateStyleOfWrapContainer(e,o,g,_,n),this.htmlMap[f].renderId=this.renderId}}const registerReactAttributePlugin=()=>{Factory$2.registerPlugin("ReactAttributePlugin",ReactAttributePlugin)};class ViewTransform3dPlugin{constructor(){this.name="ViewTransform3dPlugin",this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid,this.onMouseDown=e=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!0,this.pageX=e.page.x,this.pageY=e.page.y)},this.onMouseUp=e=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!1)},this.onMouseMove=e=>{var i,n;const o=this.pluginService.stage;if(this.option3d||(this.option3d=o.option3d),this.option3d&&this.mousedown)if(this.pageX&&this.pageY){const l=e.page.x-this.pageX,u=e.page.y-this.pageY;this.pageX=e.page.x,this.pageY=e.page.y;const d=l/100,f=u/100;this.option3d.alpha=((i=this.option3d.alpha)!==null&&i!==void 0?i:0)+d,this.option3d.beta=((n=this.option3d.beta)!==null&&n!==void 0?n:0)+f,o.set3dOptions(this.option3d),o.renderNextFrame()}else this.pageX=e.page.x,this.pageY=e.page.y}}activate(e){this.pluginService=e;const i=e.stage;this.option3d=i.option3d,i.addEventListener("mousedown",this.onMouseDown),i.addEventListener("mouseup",this.onMouseUp),i.addEventListener("mousemove",this.onMouseMove)}deactivate(e){const i=e.stage;i.removeEventListener("mousedown",this.onMouseDown),i.removeEventListener("mouseup",this.onMouseUp),i.removeEventListener("mousemove",this.onMouseMove)}}const registerViewTransform3dPlugin=()=>{Factory$2.registerPlugin("ViewTransform3dPlugin",ViewTransform3dPlugin)};function combineDomains(r){const e=[];for(let i=0;i<r.length;i++){const n=r[i];i!==0&&n[0]===e[e.length-1]||e.push(n[0]),e.push(n[1])}return e}const warn=(r,e)=>(isFunction(config.warnHandler)&&config.warnHandler.call(null,r,e),Logger.getInstance().warn(`[VChart warn]: ${r}`)),error$1=(r,e,i)=>{{if(!isFunction(config.errorHandler))throw new Error(r);config.errorHandler.call(null,r,e)}},config={warnHandler:!1,errorHandler:!1},isBrowser=isBrowserEnv(),domDocument=isBrowser&&globalThis?globalThis.document:void 0;function isTrueBrowser(r){return(r==="desktop-browser"||r==="mobile-browser")&&isBrowser}function isMobileLikeMode(r){return isMiniAppLikeMode(r)||r==="mobile-browser"}function isMiniAppLikeMode(r){return r.includes("miniApp")||r==="lynx"||r==="wx"||r==="harmony"}let VChartId=0;function createID(){return VChartId>=9999999&&(VChartId=0),VChartId++}function couldBeValidNumber(r){return r!=null&&r!==""&&(!!isNumber(r)||+r==+r)}function toValidNumber(r){if(isValidNumber(r))return r;const e=+r;return isValidNumber(e)?e:0}function isDataDomainSpec(r){return!(!r||r.length===0)&&!isNil(r[0])&&!isNil(r[0].dataId)&&isArray(r[0].fields)}const accessor=(r,e,i)=>(r.fields=e||[],r.fname=i,r),getter=r=>e=>get(e,r),identity$1=r=>r,zero=r=>0,error=r=>{Logger.getInstance().error(r)},splitAccessPath=r=>{const e=[],i=r.length;let n,o,l,u=null,d=0,f="";r+="";const g=()=>{e.push(f+r.substring(n,o)),f="",n=o+1};for(n=0,o=0;o<i;o+=1)if(l=r[o],l==="\\")f+=r.substring(n,o),f+=r.substring(++o,++o),n=o;else if(l===u)g(),u=null,d=-1;else{if(u)continue;n===d&&l==='"'||n===d&&l==="'"?(n=o+1,u=l):l!=="."||d?l==="["?(o>n&&g(),n=o+1,d=n):l==="]"&&(d||error("Access path missing open bracket: "+r),d>0&&g(),d=0,n=o+1):o>n?g():n=o+1}return d&&error("Access path missing closing bracket: "+r),u&&error("Access path missing closing quote: "+r),o>n&&(o+=1,g()),e},fieldSingle=(r,e,i={})=>{if(isFunction(r))return r;const n=splitAccessPath(r),o=n.length===1?n[0]:r;return accessor((i&&i.get||getter)(n),[o],o)},field$3=(r,e,i={})=>{if(isArray(r)){const n=r.map(o=>fieldSingle(o,e,i));return o=>n.map(l=>l(o))}return fieldSingle(r,e,i)},extent$2=(r,e)=>{const i=isFunction(e)?e:l=>l;let n,o;if(r&&r.length){const l=r.length;for(let u=0;u<l;u+=1){let d=i(r[u]);isNil(d)||!isNumber(d=+d)||Number.isNaN(d)||(isNil(n)?(n=d,o=d):(n=Math.min(n,d),o=Math.max(o,d)))}return[n,o]}return[n,o]},toPercent=(r,e)=>isNil(r)?e:isString(r)?e*parseFloat(r)/100:r;function ordinaryLeastSquares(r,e,i,n){const o=n-r*r,l=Math.abs(o)<1e-24?0:(i-r*e)/o;return[e-l*r,l]}function visitPoints(r,e,i,n){let o,l,u=-1;r.forEach(d=>{o=e(d),l=i(d),!isNil(o)&&(o=+o)>=o&&!isNil(l)&&(l=+l)>=l&&n(o,l,++u)})}function rSquared(r,e,i,n,o){let l=0,u=0;return visitPoints(r,e,i,(d,f)=>{const g=f-o(d),_=f-n;l+=g*g,u+=_*_}),1-l/u}function regressionLinear(r,e=n=>n.x,i=n=>n.y){let n=0,o=0,l=0,u=0,d=0;visitPoints(r,e,i,(_,y)=>{++d,n+=(_-n)/d,o+=(y-o)/d,l+=(_*y-l)/d,u+=(_*_-u)/d});const f=ordinaryLeastSquares(n,o,l,u),g=_=>f[0]+f[1]*_;return{coef:f,predict:g,rSquared:rSquared(r,e,i,o,g)}}function isHorizontal$2(r){return r==="horizontal"}function isVertical$1(r){return r==="vertical"}const shapes={triangleForward,triangleUpright:triangle,triangle,diamond,square:square$1,star,cardioid,circle,pentagon};function diamond(){return function(r){const e=r%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))}}function star(){return function(r){const e=(r+.955)%(2*Math.PI/10);return(r+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}function square$1(){return function(r){return Math.min(1/Math.abs(Math.cos(r)),1/Math.abs(Math.sin(r)))}}function triangle(){return function(r){const e=(r+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))}}function triangleForward(){return function(r){const e=r%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))}}function cardioid(){return function(r){return 1+Math.sin(r)}}function circle(){return function(){return 1}}function pentagon(){return function(r){const e=(r+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))}}function getMaxRadiusAndCenter(r,e){const i=e[0],n=e[1];let o=1;const l=[e[0]>>1,e[1]>>1];switch(r){case"cardioid":l[1]=~~(n/2.7*.4),o=Math.floor(Math.min(i/2.3,n/2.6));break;case"triangleForward":o=n/Math.sqrt(.75)>i?Math.floor(i/2):Math.floor(n/(2*Math.sqrt(.75)));break;case"triangle":case"triangleUpright":l[1]=~~(n/1.5),o=Math.floor(Math.min(n/1.5,i/2));break;case"circle":case"diamond":case"square":case"star":case"pentagon":o=Math.floor(Math.min(i/2,n/2));break;default:o=Math.floor(Math.max(i/2,n/2))}return{maxRadius:o,center:l}}const getShapeFunction=r=>shapes[r]?shapes[r]():shapes.circle(),generateIsEmptyPixel=r=>{if(!r||r==="#fff")return(n,o,l)=>{const u=n.width;return n.data[o*u*4+4*l+3]===0||n.data[o*u*4+4*l+0]===255&&n.data[o*u*4+4*l+1]===255&&n.data[o*u*4+4*l+2]===255};const e=vglobal.createCanvas({width:1,height:1}).getContext("2d",{willReadFrequently:!0});e.fillStyle=r,e.fillRect(0,0,1,1);const i=e.getImageData(0,0,1,1).data;return(n,o,l)=>{const u=n.width;return[0,1,2,3].every(d=>n.data[4*(o*u+l)+d]===i[d])}},generateMaskCanvas=(r,e,i,n)=>{const{backgroundColor:o="#fff"}=r,l=vglobal.createCanvas({width:e,height:i,dpr:1}),u=l.getContext("2d",{willReadFrequently:!0});return u.fillStyle=o,u.fillRect(0,0,l.width,l.height),r.type==="text"?drawTextMask(r,l.width,l.height,u):r.type==="geometric"&&drawGeometricMask(r,l.width,l.height,u),l},drawTextMask=(r,e,i,n)=>{const{fontFamily:o="sans-serif",fontWeight:l="normal",fontStyle:u="normal",fontVariant:d="normal",fill:f,text:g,hollow:_}=r;let y=12;n.font=`${u} ${d} ${l} ${y}px ${o}`,n.textAlign="center",n.textBaseline="middle",n.fillStyle=f??"black";const b=n.measureText(g),S=u!=="normal"?1.1:1,v=isValid(b.actualBoundingBoxRight)&&isValid(b.actualBoundingBoxLeft)?Math.ceil(S*(Math.abs(b.actualBoundingBoxRight)+Math.abs(b.actualBoundingBoxLeft))):0,A=Math.max(Math.ceil(b.width),v,y);if(_&&(n.globalCompositeOperation="xor"),A>e){const x=Math.min(e/A,i/y);n.fillText(g,e/2,i/2),n.scale(x,x)}else y=Math.floor(y*e/A),y=Math.min(y,i),n.font=`${u} ${d} ${l} ${y}px ${o}`,n.fillText(g,Math.floor(e/2),Math.floor(i/2))},generatePoints=(r,e,i=0,n)=>{const o=2*Math.PI/n;return new Array(n).fill(0).map((l,u)=>polarToCartesian(r,e,i+u*o))},generateCardioidPoints=(r,e,i=0,n)=>{const o=2*Math.PI/n,l=getShapeFunction("cardioid");return new Array(n).fill(0).map((u,d)=>{const f=i+d*o,g=e*l(f);return polarToCartesian(r,g,f)})},drawRegularPolygon=(r,e)=>{r.beginPath(),e.forEach((i,n)=>{n===0?r.moveTo(i.x,i.y):r.lineTo(i.x,i.y)}),r.closePath(),r.fill()},drawCardioid=(r,e)=>{let i;r.beginPath(),e.forEach((n,o)=>{o===0?r.moveTo(n.x,n.y):r.bezierCurveTo(n.x,n.y,i.x,i.y,n.x,n.y),i=n}),r.closePath(),r.fill()},drawGeometricMask=(r,e,i,n)=>{const{fill:o,hollow:l}=r,{center:u,maxRadius:d}=getMaxRadiusAndCenter(r.shape,[e,i]);n.fillStyle=o??"black",l&&(n.globalCompositeOperation="xor");const f=u[0],g=u[1];if(r.shape==="cardioid")drawCardioid(n,generateCardioidPoints({x:f,y:g},d,0,100));else if(r.shape==="circle")n.beginPath(),n.arc(f,g,d,0,2*Math.PI,!0),n.fill();else if(r.shape==="diamond")drawRegularPolygon(n,generatePoints({x:f,y:g},d,-Math.PI/2,4));else if(r.shape==="square")drawRegularPolygon(n,generatePoints({x:f,y:g},d,-Math.PI/4,4));else if(r.shape==="pentagon")drawRegularPolygon(n,generatePoints({x:f,y:g},d,Math.PI/2,5));else if(r.shape==="triangle"||r.shape==="triangleUpright")drawRegularPolygon(n,generatePoints({x:f,y:g},d,-Math.PI/2,3));else if(r.shape==="triangleForward")drawRegularPolygon(n,generatePoints({x:f,y:g},d,0,3));else if(r.shape==="star"){const _=generatePoints({x:f,y:g},d,-Math.PI/2,5),y=generatePoints({x:f,y:g},d/(2*Math.cos(Math.PI/5)),-Math.PI/2+Math.PI/5,5),b=[];for(let S=0;S<5;S++)b.push(_[S]),b.push(y[S]);drawRegularPolygon(n,b)}else n.fillRect(0,0,e,i)},GROUP_ATTRIBUTES=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class AbstractComponent extends Group$1{constructor(e,i){super(e),i!=null&&i.mode&&(this.mode=i.mode,this.setMode(i.mode)),i!=null&&i.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=e,this.onSetStage(()=>{this.render(),this.bindEvents()})}setAttribute(e,i,n,o){const l=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[e]:i},this.attribute,e,o);if(l)return this._setAttributes(l,n);isPlainObject(this.attribute[e])&&isPlainObject(i)&&!isFunction(this.attribute[e])&&!isFunction(i)?merge$1(this.attribute[e],i):this.attribute[e]=i,GROUP_ATTRIBUTES.includes(e)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!n&&!this.needUpdateTag(e)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(e,i,n){return e=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(e,this.attribute,null,n)||e,this._setAttributes(e,i)}_setAttributes(e,i){const n=Object.keys(e);this._mergeAttributes(e,n),n.every(o=>GROUP_ATTRIBUTES.includes(o))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTags(n)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(e,i){isNil(i)&&(i=Object.keys(e));for(let n=0;n<i.length;n++){const o=i[n];!isPlainObject(this.attribute[o])||isFunction(this.attribute[o])||isFunction(e[o])?this.attribute[o]=e[o]:merge$1(this.attribute[o],e[o])}}bindEvents(){}_getNodeId(e){var i;return`${(i=this.id)!==null&&i!==void 0?i:this._uid}-${this.name}-${e}`}_dispatchEvent(e,i){var n;const o=new CustomEvent(e,i);o.manager=(n=this.stage)===null||n===void 0?void 0:n.eventSystem.manager,this.dispatchEvent(o)}}const MathPickerContribution=Symbol.for("MathPickerContribution"),MathArcPicker=Symbol.for("MathArcPicker"),MathAreaPicker=Symbol.for("MathAreaPicker"),MathCirclePicker=Symbol.for("MathCirclePicker"),MathImagePicker=Symbol.for("MathImagePicker"),MathLinePicker=Symbol.for("MathLinePicker"),MathPathPicker=Symbol.for("MathPathPicker"),MathRectPicker=Symbol.for("MathRectPicker"),MathSymbolPicker=Symbol.for("MathSymbolPicker"),MathTextPicker=Symbol.for("MathTextPicker"),MathPolygonPicker=Symbol.for("MathPolygonPicker"),MathGlyphPicker=Symbol.for("MathGlyphPicker"),CanvasArcPicker=Symbol.for("CanvasArcPicker"),CanvasArc3dPicker=Symbol.for("CanvasArc3dPicker"),CanvasAreaPicker=Symbol.for("CanvasAreaPicker"),CanvasCirclePicker=Symbol.for("CanvasCirclePicker"),CanvasImagePicker=Symbol.for("CanvasImagePicker"),CanvasLinePicker=Symbol.for("CanvasLinePicker"),CanvasPathPicker=Symbol.for("CanvasPathPicker"),CanvasRectPicker=Symbol.for("CanvasRectPicker"),CanvasRect3dPicker=Symbol.for("CanvasRect3dPicker"),CanvasSymbolPicker=Symbol.for("CanvasSymbolPicker"),CanvasTextPicker=Symbol.for("CanvasTextPicker"),CanvasPolygonPicker=Symbol.for("CanvasPolygonPicker"),CanvasPyramid3dPicker=Symbol.for("CanvasPyramid3dPicker"),CanvasRichTextPicker=Symbol.for("CanvasRichTextPicker"),CanvasGlyphPicker=Symbol.for("CanvasGlyphPicker"),CanvasGroupPicker=Symbol.for("CanvasGroupPicker"),CanvasPickerContribution=Symbol.for("CanvasPickerContribution"),calcDirection=(r,e)=>{const i=e.x-r.x,n=e.y-r.y;return Math.abs(i)>Math.abs(n)?i>0?"right":"left":n>0?"down":"up"},calcDistance=(r,e)=>{const i=Math.abs(e.x-r.x),n=Math.abs(e.y-r.y);return Math.sqrt(i*i+n*n)},getCenter=r=>{const e=r.length;if(e===1)return{x:Math.round(r[0].x),y:Math.round(r[0].y)};let i=0,n=0,o=0;for(;o<e;)i+=r[o].x,n+=r[o].y,o++;return{x:Math.round(i/e),y:Math.round(n/e)}};class Gesture extends EventEmitter{constructor(e,i={}){var n,o,l,u,d,f,g,_,y,b;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=S=>{this.cachedEvents=[],this.startPoints=[],this.reset(),this.startTime=clock.now();const{cachedEvents:v,startPoints:A}=this;S&&v.push(S.clone()),A.length=v.length;for(let x=0;x<v.length;x++){const{x:T,y:C}=v[x],E={x:T,y:C};A[x]=E}if(A.length!==1)this.startDistance=calcDistance(A[0],A[1]),this.center=getCenter([A[0],A[1]]);else{const x=v[0];this.pressTimeout=setTimeout(()=>{x.direction="none",x.deltaX=0,x.deltaY=0,x.points=A,this.triggerStartEvent("press",x),this.triggerEvent("press",x),this.eventType="press",this.direction="none",this.pressTimeout=null},this.config.press.time)}},this.onMove=S=>{this.clearPressTimeout();const{startPoints:v,cachedEvents:A}=this;if(!v.length)return;const x=S.clone(),{x:T,y:C,pointerId:E}=x;for(let I=0,O=A.length;I<O;I++)if(E===A[I].pointerId){A[I]=x;break}const P={x:T,y:C},L=A.map(I=>({x:I.x,y:I.y})),R=clock.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=R,this.lastMovePoint=P,v.length===1){const I=v[0],O=T-I.x,B=C-I.y,N=this.direction||calcDirection(I,P);this.direction=N;const $=this.getEventType(P);return x.direction=N,x.deltaX=O,x.deltaY=B,x.points=L,this.triggerStartEvent($,x),void this.triggerEvent($,x)}const{startDistance:w}=this,D=calcDistance(L[0],L[1]);x.scale=D/w,x.center=this.center,x.points=L,this.triggerStartEvent("pinch",x),this.triggerEvent("pinch",x)},this.onEnd=S=>{const v=S.clone(),{cachedEvents:A,startPoints:x}=this,T=A.map(C=>({x:C.x,y:C.y}));if(v.points=T,this.triggerEndEvent(v),A.length===1){const C=clock.now(),E=this.lastMoveTime;if(C-E<100){const P=E-(this.prevMoveTime||this.startTime);if(P>0){const L=this.prevMovePoint||x[0],R=this.lastMovePoint||x[0],w=calcDistance(L,R),D=w/P;if(D>this.config.swipe.velocity&&w>this.config.swipe.threshold)return v.velocity=D,v.direction=calcDirection(L,R),this.triggerEvent("swipe",v),this.cachedEvents=[],this.startPoints=[],void this.reset()}}C-this.startTime<this.config.press.time&&(C-this.lastTapTime<this.config.tap.interval&&S.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=C,this.lastTapTarget=S.target,this.tapCount===1?this.triggerEvent("tap",v):this.tapCount===2&&(this.triggerEvent("doubletap",v),this.tapCount=0))}for(let C=0,E=A.length;C<E;C++)if(A[C].pointerId===v.pointerId){A.splice(C,1),x.splice(C,1);break}this.reset(),A.length>0&&this.onStart()},this.element=e,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(o=(n=i==null?void 0:i.press)===null||n===void 0?void 0:n.time)!==null&&o!==void 0?o:251,threshold:(u=(l=i==null?void 0:i.press)===null||l===void 0?void 0:l.threshold)!==null&&u!==void 0?u:9},swipe:{threshold:(f=(d=i==null?void 0:i.swipe)===null||d===void 0?void 0:d.threshold)!==null&&f!==void 0?f:10,velocity:(_=(g=i==null?void 0:i.swipe)===null||g===void 0?void 0:g.velocity)!==null&&_!==void 0?_:.3},tap:{interval:(b=(y=i==null?void 0:i.tap)===null||y===void 0?void 0:y.interval)!==null&&b!==void 0?b:300}},this.initEvents()}initEvents(){const{element:e}=this;e&&(e.addEventListener("pointerdown",this.onStart),e.addEventListener("pointermove",this.onMove),e.addEventListener("pointerup",this.onEnd),e.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:e}=this;e&&(e.removeEventListener("pointerdown",this.onStart),e.removeEventListener("pointermove",this.onMove),e.removeEventListener("pointerup",this.onEnd),e.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(e){const{eventType:i,startTime:n,startPoints:o}=this;if(i==="press")return i;let l;return l=clock.now()-n>this.config.press.time&&calcDistance(o[0],e)<this.config.press.threshold?"press":"pan",this.eventType=l,l}enable(e){this.processEvent[e]=!0}isProcess(e){return this.processEvent[e]}pushEvent(e,i){const{emitThrottles:n}=this,o={type:e,ev:i};for(let l=0,u=n.length;l<u;l++)if(n[l].type===e)return void n.splice(l,1,o);n.push(o)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(e,i){this.pushEvent(e,i);const{throttleTimer:n,emitThrottles:o}=this;n||(this.throttleTimer=application.global.getRequestAnimationFrame()(()=>{application.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let l=0,u=o.length;l<u;l++){const{type:d,ev:f}=o[l];this.emitEvent(d,f)}this.emitThrottles.length=0}))}triggerStartEvent(e,i){this.isProcess(e)||(this.enable(e),this.triggerEvent(`${e}start`,i))}triggerEndEvent(e){const i=this.processEvent;Object.keys(i).forEach(n=>{this.triggerEvent(`${n}end`,e),n==="press"&&this.triggerEvent(`${n}up`,e),delete i[n]})}emitEvent(e,i){if(!this.element)return;const n=this.element._events[WILDCARD];if(n)if("fn"in n)n.fn.call(n.context,i,e);else for(let o=0,l=n.length;o<l&&!i.propagationImmediatelyStopped;o++)n[o].fn.call(n[o].context,i,e);this.emit(e,i)}}var __decorate$C=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$u=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};const outP=[0,0,0],addArcToBezierPath=(r,e,i,n,o,l,u,d)=>{if(d)for(;i>e;)i-=pi2;else for(;i<e;)i+=pi2;const f=pi$1/3*(i>e?1:-1);let g=e,_=g;for(;_!==i;){_=f>0?Math.min(_+f,i):Math.max(_+f,i);const y=Math.abs(_-g),b=4*Math.tan(y/4)/3,S=_<g?-1:1,v=Math.cos(g),A=Math.sin(g),x=Math.cos(_),T=Math.sin(_),C=v*l+n,E=A*u+o,P=x*l+n,L=T*u+o,R=l*b*S,w=u*b*S;r.push([C-R*A,E+w*v,P+R*T,L-w*x,P,L]),g=_}};let BrowserContext2d=class{set fillStyle(r){this.nativeContext.fillStyle=r}get fillStyle(){return this.nativeContext.fillStyle}set font(r){this.nativeContext.font=r}get font(){return this.nativeContext.font}set globalAlpha(r){this.nativeContext.globalAlpha=r*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(r){this.nativeContext.lineCap=r}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(r){this.nativeContext.lineDashOffset=r}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(r){this.nativeContext.lineJoin=r}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(r){this.nativeContext.lineWidth=r}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(r){this.nativeContext.miterLimit=r}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(r){this.nativeContext.shadowBlur=r}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(r){this.nativeContext.shadowColor=r}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(r){this.nativeContext.shadowOffsetX=r}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(r){this.nativeContext.shadowOffsetY=r}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(r){this.nativeContext.strokeStyle=r}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(r){this.nativeContext.textAlign=r}get textAlign(){return this.nativeContext.textAlign}set textBaseline(r){this.nativeContext.textBaseline=r}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(r){r!==!!this._inuse&&(this._inuse=r,r?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(r,e){this.fillAttributes=Object.assign(Object.assign({},DefaultFillStyle),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},DefaultStrokeStyle),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},DefaultTextStyle),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const i=r.nativeCanvas.getContext("2d");if(!i)throw new Error("2d");this.nativeContext=i,this.canvas=r,this.matrix=new Matrix(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new Matrix(1,0,0,1,0,0),this._clearMatrix=new Matrix(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&Logger.getInstance().warn("bugmatrix"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Matrix(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(r=!1){!r&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(r){return matrixAllocate.allocateByObj(r)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(matrixAllocate.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(matrixAllocate.free(this.matrix),this.matrix=this.stack.pop())}rotate(r,e=!0){this.matrix.rotate(r),e&&this.setTransformForCurrent()}save(){const r=this.cloneMatrix(this.matrix);this.stack.push(r),this.nativeContext.save()}highPerformanceSave(){const r=this.cloneMatrix(this.matrix);this.stack.push(r)}scale(r,e,i=!0){this.matrix.scale(r,e),i&&this.setTransformForCurrent()}setScale(r,e,i=!0){this.matrix.setScale(r,e),i&&this.setTransformForCurrent()}scalePoint(r,e,i,n,o=!0){this.translate(i,n,!1),this.scale(r,e,!1),this.translate(-i,-n,!1),o&&this.setTransformForCurrent()}setTransform(r,e,i,n,o,l,u=!0,d=this.dpr){this.matrix.setValue(d*r,d*e,d*i,d*n,d*o,d*l),u&&this.setTransformForCurrent()}setTransformFromMatrix(r,e=!0,i=this.dpr){this.matrix.setValue(r.a*i,r.b*i,r.c*i,r.d*i,r.e*i,r.f*i),e&&this.setTransformForCurrent()}resetTransform(r=!0,e=this.dpr){this.setTransform(e,0,0,e,0,0),r&&this.setTransformForCurrent()}transform(r,e,i,n,o,l,u=!0){this.matrix.multiply(r,e,i,n,o,l),u&&this.setTransformForCurrent()}transformFromMatrix(r,e){this.matrix.multiply(r.a,r.b,r.c,r.d,r.e,r.f),e&&this.setTransformForCurrent()}translate(r,e,i=!0){this.matrix.translate(r,e),i&&this.setTransformForCurrent()}rotateDegrees(r,e=!0){const i=r*Math.PI/180;this.rotate(i,e)}rotateAbout(r,e,i,n=!0){this.translate(e,i,!1),this.rotate(r,!1),this.translate(-e,-i,!1),n&&this.setTransformForCurrent()}rotateDegreesAbout(r,e,i,n=!0){this.translate(e,i,!1),this.rotateDegrees(r,!1),this.translate(-e,-i,!1),n&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(r,e){r?typeof r=="string"?this.nativeContext.clip(r):this.nativeContext.clip(r,e):this.nativeContext.clip()}arc(r,e,i,n,o,l,u){if(u=u||0,this.camera){const d=[];addArcToBezierPath(d,n,o,r,e,i,i,l);for(let f=0;f<d.length;++f){const g=d[f];this.bezierCurveTo(g[0],g[1],g[2],g[3],g[4],g[5],u)}}else this.nativeContext.arc(r,e,Math.max(0,i),n,o,l)}arcTo(r,e,i,n,o){this.nativeContext.arcTo(r,e,i,n,o)}bezierCurveTo(r,e,i,n,o,l,u){if(u=u||0,this.camera){let d=u,f=u;this.modelMatrix&&(transformMat4(outP,[r,e,u],this.modelMatrix),r=outP[0],e=outP[1],d=outP[2],transformMat4(outP,[i,n,u],this.modelMatrix),i=outP[0],n=outP[1],f=outP[2],transformMat4(outP,[o,l,u],this.modelMatrix),o=outP[0],l=outP[1],u=outP[2]);let g=this.camera.vp(o,l,u);o=g.x,l=g.y,g=this.camera.vp(r,e,d),r=g.x,e=g.y,g=this.camera.vp(i,n,f),i=g.x,n=g.y}this.nativeContext.bezierCurveTo(r,e,i,n,o,l)}closePath(){this.nativeContext.closePath()}ellipse(r,e,i,n,o,l,u,d){d==null?this.nativeContext.ellipse(r,e,i,n,o,l,u):this.nativeContext.ellipse(r,e,i,n,o,l,u,d)}lineTo(r,e,i){if(i=i||0,this.camera){this.modelMatrix&&(transformMat4(outP,[r,e,i],this.modelMatrix),r=outP[0],e=outP[1],i=outP[2]);const n=this.camera.vp(r,e,i);r=n.x,e=n.y}this.nativeContext.lineTo(r,e)}moveTo(r,e,i){if(i=i||0,this.camera){this.modelMatrix&&(transformMat4(outP,[r,e,i],this.modelMatrix),r=outP[0],e=outP[1],i=outP[2]);const n=this.camera.vp(r,e,i);r=n.x,e=n.y}this.nativeContext.moveTo(r,e)}quadraticCurveTo(r,e,i,n,o){if(o=o||0,this.camera){let l=o;this.modelMatrix&&(transformMat4(outP,[r,e,o],this.modelMatrix),r=outP[0],e=outP[1],l=outP[2],transformMat4(outP,[i,n,o],this.modelMatrix),i=outP[0],n=outP[1],o=outP[2]);let u=this.camera.vp(i,n,o);i=u.x,n=u.y,u=this.camera.vp(r,e,l),r=u.x,e=u.y}this.nativeContext.quadraticCurveTo(r,e,i,n)}rect(r,e,i,n,o){o=o||0,this.camera?(this.moveTo(r,e,o),this.lineTo(r+i,e,o),this.lineTo(r+i,e+n,o),this.lineTo(r,e+n,o),this.closePath()):this.nativeContext.rect(r,e,i,n)}createImageData(){const r=arguments;return r.length===2?this.nativeContext.createImageData(r[0],r[1]):r.length===1?this.nativeContext.createImageData(r[0]):null}createLinearGradient(r,e,i,n){return isFinite(r+e+i+n)||(r=0,e=0,i=0,n=0),this.nativeContext.createLinearGradient(r,e,i,n)}createPattern(r,e){return r.width===0||r.height===0?null:this.nativeContext.createPattern(r,e)}createRadialGradient(r,e,i,n,o,l){return this.nativeContext.createRadialGradient(r,e,i,n,o,l)}createConicGradient(r,e,i,n){let o,l=!1;const u=this;return{stops:[],addColorStop(d,f){this.stops.push([d,f]),l=!0},GetPattern(d,f,g){return l&&(g||(g=n-i),o=createConicalGradient(u,this.stops,r,e,g,i,n,d,f),l=!1),o}}}fill(r,e){this.disableFill||(r?this.nativeContext.fill(r):this.nativeContext.fill())}fillRect(r,e,i,n){this.nativeContext.fillRect(r,e,i,n)}clearRect(r,e,i,n){this.nativeContext.clearRect(r,e,i,n)}project(r,e,i){if(i=i||0,this.camera){this.modelMatrix&&(transformMat4(outP,[r,e,i],this.modelMatrix),r=outP[0],e=outP[1],i=outP[2]);const n=this.camera.vp(r,e,i);r=n.x,e=n.y}return{x:r,y:e}}view(r,e,i){return i=i||0,this.camera?(this.modelMatrix&&(transformMat4(outP,[r,e,i],this.modelMatrix),r=outP[0],e=outP[1],i=outP[2]),this.camera.view(r,e,i)):[r,e,i]}fillText(r,e,i,n){if(n=n||0,this.camera){this.modelMatrix&&(transformMat4(outP,[e,i,n],this.modelMatrix),e=outP[0],i=outP[1],n=outP[2]);const o=this.camera.vp(e,i,n);e=o.x,i=o.y}this.nativeContext.fillText(r,e,i)}getImageData(r,e,i,n){return this.nativeContext.getImageData(r,e,i,n)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(r,e){return this.nativeContext.isPointInPath(r,e)}isPointInStroke(r,e){return this.nativeContext.isPointInStroke(r,e)}measureText(r,e=application.global.measureTextMethod){var i,n;if(!e||e==="native")return this.nativeContext.measureText(r);this.mathTextMeasure||(this.mathTextMeasure=application.graphicUtil.createTextMeasureInstance({},{},()=>this.canvas.nativeCanvas));const o=(i=this.fontFamily)!==null&&i!==void 0?i:DefaultTextStyle.fontFamily,l=(n=this.fontSize)!==null&&n!==void 0?n:DefaultTextStyle.fontSize;return this.mathTextMeasure.textSpec.fontFamily===o&&this.mathTextMeasure.textSpec.fontSize===l||(this.mathTextMeasure.textSpec.fontFamily=o,this.mathTextMeasure.textSpec.fontSize=l,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(r,e)}putImageData(r,e,i){this.nativeContext.putImageData(r,e,i)}setLineDash(r){const e=arguments,i=this.nativeContext;this.nativeContext.setLineDash?e[0]&&i.setLineDash(e[0]):"mozDash"in i?i.mozDash=e[0]:"webkitLineDash"in i&&(i.webkitLineDash=e[0])}stroke(r){this.disableStroke||(r?this.nativeContext.stroke(r):this.nativeContext.stroke())}strokeRect(r,e,i,n){this.nativeContext.strokeRect(r,e,i,n)}strokeText(r,e,i,n){if(n=n||0,this.camera){this.modelMatrix&&(transformMat4(outP,[e,i,n],this.modelMatrix),e=outP[0],i=outP[1],n=outP[2]);const o=this.camera.vp(e,i,n);e=o.x,i=o.y}this.nativeContext.strokeText(r,e,i)}drawImage(){const r=this.nativeContext,e=arguments;e.length===3?r.drawImage(e[0],e[1],e[2]):e.length===5?r.drawImage(e[0],e[1],e[2],e[3],e[4]):e.length===9&&r.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}setCommonStyle(r,e,i,n,o){if(Array.isArray(o)){if(o.length<=1)return this._setCommonStyle(r,e,i,n,o[0]);const l=Object.create(o[0]);return o.forEach((u,d)=>{d!==0&&Object.assign(l,u)}),this._setCommonStyle(r,e,i,n,l)}return this._setCommonStyle(r,e,i,n,o)}_setCommonStyle(r,e,i,n,o){const l=this.nativeContext;o||(o=this.fillAttributes);const{fillOpacity:u=o.fillOpacity,opacity:d=o.opacity,fill:f=o.fill}=e;l.globalAlpha=u*d*this.baseGlobalAlpha,u>1e-12&&d>1e-12&&(l.fillStyle=createColor(this,f,r,i,n))}setShadowBlendStyle(r,e,i){if(Array.isArray(i)){if(i.length<=1)return this._setShadowBlendStyle(r,i[0]);const n=Object.create(i[0]);return i.forEach((o,l)=>{l!==0&&Object.assign(n,o)}),this._setShadowBlendStyle(r,e,n)}return this._setShadowBlendStyle(r,e,i)}_setShadowBlendStyle(r,e,i){const n=this.nativeContext;i||(i=this.fillAttributes);const{opacity:o=i.opacity,shadowBlur:l=i.shadowBlur,shadowColor:u=i.shadowColor,shadowOffsetX:d=i.shadowOffsetX,shadowOffsetY:f=i.shadowOffsetY,blur:g=i.blur,globalCompositeOperation:_=i.globalCompositeOperation}=e;o<=1e-12||(l||d||f?(n.shadowBlur=l*this.dpr,n.shadowColor=u,n.shadowOffsetX=d*this.dpr,n.shadowOffsetY=f*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0),g?(n.filter=`blur(${g}px)`,this._clearFilterStyle=!0):this._clearFilterStyle&&(n.filter="blur(0px)",this._clearFilterStyle=!1),_?(n.globalCompositeOperation=_,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(n.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(r,e,i,n,o){if(Array.isArray(o)){if(o.length<=1)return this._setStrokeStyle(r,e,i,n,o[0]);const l=Object.create(o[0]);return o.forEach((u,d)=>{d!==0&&Object.assign(l,u)}),this._setStrokeStyle(r,e,i,n,l)}return this._setStrokeStyle(r,e,i,n,o)}_setStrokeStyle(r,e,i,n,o){const l=this.nativeContext;o||(o=this.strokeAttributes);const{strokeOpacity:u=o.strokeOpacity,opacity:d=o.opacity}=e;if(l.globalAlpha=u*d*this.baseGlobalAlpha,u>1e-12&&d>1e-12){const{lineWidth:f=o.lineWidth,stroke:g=o.stroke,lineJoin:_=o.lineJoin,lineDash:y=o.lineDash,lineCap:b=o.lineCap,miterLimit:S=o.miterLimit,keepStrokeScale:v=o.keepStrokeScale}=e;l.lineWidth=v?f:getScaledStroke(this,f,this.dpr),l.strokeStyle=createColor(this,g,r,i,n),l.lineJoin=_,y&&l.setLineDash(y),l.lineCap=b,l.miterLimit=S}}setTextStyleWithoutAlignBaseline(r,e,i){const n=this.nativeContext;e||(e=this.textAttributes);const{scaleIn3d:o=e.scaleIn3d}=r;r.font?n.font=r.font:n.font=getContextFont(r,e,o&&this.camera&&this.camera.getProjectionScale(i));const{fontFamily:l=e.fontFamily,fontSize:u=e.fontSize}=r;this.fontFamily=l,this.fontSize=u,n.textAlign="left",n.textBaseline="alphabetic"}setTextStyle(r,e,i){var n,o;const l=this.nativeContext;e||(e=this.textAttributes),r.font?l.font=r.font:l.font=getContextFont(r,e,this.camera&&this.camera.getProjectionScale(i));const{fontFamily:u=e.fontFamily,fontSize:d=e.fontSize}=r;this.fontFamily=u,this.fontSize=d,l.textAlign=(n=r.textAlign)!==null&&n!==void 0?n:e.textAlign,l.textBaseline=(o=r.textBaseline)!==null&&o!==void 0?o:e.textBaseline}draw(){}clearMatrix(r=!0,e=this.dpr){this.setTransformFromMatrix(this._clearMatrix,r,e)}setClearMatrix(r,e,i,n,o,l){this._clearMatrix.setValue(r,e,i,n,o,l)}onlyTranslate(r=this.dpr){return this.matrix.a===r&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===r}release(...r){this.stack.forEach(e=>matrixAllocate.free(e)),this.stack.length=0}};BrowserContext2d.env="browser",BrowserContext2d=__decorate$C([injectable(),__metadata$u("design:paramtypes",[Object,Number])],BrowserContext2d);var __decorate$B=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$t=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let BrowserCanvas=class extends BaseCanvas{constructor(r){super(r)}init(r){const{container:e}=r;if(typeof e=="string"){const i=application.global.getElementById(e);i&&(this._container=i)}else this._container=e;this._context=new BrowserContext2d(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:r}=this;r.width=this._pixelWidth,r.height=this._pixelHeight,!r.style||this.setCanvasStyle(r,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(r),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const r=this._nativeCanvas;r.style.position="absolute",r.style.top=`${this._y}px`,r.style.left=`${this._x}px`}resetStyle(r){if(!this.controled)return;const{width:e=this._displayWidth,height:i=this._displayHeight,dpr:n=this._dpr,x:o=this._x,y:l=this._y}=r,{nativeCanvas:u}=this;u.width=e*n,u.height=i*n,!u.style||this.setCanvasStyle(u,o,l,e,i),r.id&&(u.id=r.id),this.visiable||this.hide()}setCanvasStyle(r,e,i,n,o){this.controled&&(r.style.width=`${n}px`,r.style.height=`${o}px`)}toDataURL(r,e){return r==="image/jpeg"?this._nativeCanvas.toDataURL(r,e):r==="image/png"?this._nativeCanvas.toDataURL(r):this._nativeCanvas.toDataURL(r,e)}resize(r,e){this.controled&&(this._pixelWidth=r*this._dpr,this._pixelHeight=e*this._dpr,this._displayWidth=r,this._displayHeight=e,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${r}px`,this._nativeCanvas.style.height=`${e}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};BrowserCanvas.env="browser",BrowserCanvas=__decorate$B([injectable(),__metadata$t("design:paramtypes",[Object])],BrowserCanvas);function createModule(r,e){return new ContainerModule(i=>{i(CanvasFactory).toDynamicValue(()=>n=>new r(n)).whenTargetNamed(r.env),i(Context2dFactory).toDynamicValue(()=>(n,o)=>new e(n,o)).whenTargetNamed(e.env)})}const browserCanvasModule=createModule(BrowserCanvas,BrowserContext2d);var __decorate$A=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$s=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$o=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasPickerService=class extends DefaultPickService{constructor(r,e,i){super(i),this.contributions=r,this.drawContribution=e,this.pickItemInterceptorContributions=i,this.global.hooks.onSetEnv.tap("canvas-picker-service",(n,o,l)=>{this.configure(l,o)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(r=>{this.pickerMap.set(r.numberType,r)}),super._init()}configure(r,e){this.pickCanvas=canvasAllocate.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(r,e,i,n){if(r.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let f=0;f<this.InterceptorContributions.length;f++){const g=this.InterceptorContributions[f];if(g.beforePickItem){const _=g.beforePickItem(r,this,e,n,{parentMatrix:i});if(_)return _}}const o=this.pickerMap.get(r.numberType);if(!o)return null;const l=o.contains(r,e,n),u=l?r:null,d={graphic:u,params:l};if(u)return d;if(this.InterceptorContributions.length)for(let f=0;f<this.InterceptorContributions.length;f++){const g=this.InterceptorContributions[f];if(g.afterPickItem){const _=g.afterPickItem(r,this,e,n,{parentMatrix:i});if(_)return _}}return d}};DefaultCanvasPickerService=__decorate$A([injectable(),__param$o(0,inject(ContributionProvider)),__param$o(0,named(CanvasPickerContribution)),__param$o(1,inject(DrawContribution)),__param$o(2,inject(ContributionProvider)),__param$o(2,named(PickItemInterceptor)),__metadata$s("design:paramtypes",[Object,Object,Object])],DefaultCanvasPickerService);var __decorate$z=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultCanvasGroupPicker=class{constructor(){this.type="group",this.numberType=GROUP_NUMBER_TYPE}contains(r,e,i){return!1}};DefaultCanvasGroupPicker=__decorate$z([injectable()],DefaultCanvasGroupPicker);const m$1=new ContainerModule((r,e,i,n)=>{m$1.__vloaded||(m$1.__vloaded=!0,r(CanvasGroupPicker).to(DefaultCanvasGroupPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasGroupPicker),bindContributionProvider(r,CanvasPickerContribution))});m$1.__vloaded=!1;const canvasPickerModule=new ContainerModule((r,e,i,n)=>{i(DefaultCanvasPickerService)||r(DefaultCanvasPickerService).toSelf().inSingletonScope(),i(PickerService)?n(PickerService).toService(DefaultCanvasPickerService):r(PickerService).toService(DefaultCanvasPickerService)});function loadCanvasPicker(r){r.load(m$1),r.load(canvasPickerModule)}var BrowserWindowHandlerContribution_1,__decorate$y=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$r=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let BrowserWindowHandlerContribution=BrowserWindowHandlerContribution_1=class extends BaseWindowHandlerContribution{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${BrowserWindowHandlerContribution_1.idprefix}_${BrowserWindowHandlerContribution_1.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=application.global,this.viewBox=new AABBBounds,this.modelMatrix=new Matrix(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(r){r.canvas?this.createWindowByCanvas(r):this.createWindowByConfig(r),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{console.error("IntersectionObserver")}}isElementVisible(r){const e=r.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight;return!(e.right<0||e.bottom<0||e.left>i||e.top>n)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const r=new IntersectionObserver((e,i)=>{e.forEach(n=>{this._canvasIsIntersecting!==n.isIntersecting?(this._canvasIsIntersecting=n.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(n.isIntersecting)):this._canvasIsIntersecting=n.isIntersecting})});r&&r.observe(this.canvas.nativeCanvas)}createWindowByConfig(r){const e=this.global.createCanvas({width:r.width,height:r.height});let i;if(i=typeof r.container=="string"?this.global.getElementById(r.container):r.container?r.container:this.global.getRootElement(),!i)throw new Error("containerId");r.offscreen?i=null:i.appendChild(e);const n={width:r.width,height:r.height,dpr:r.dpr,nativeCanvas:e,container:i,id:BrowserWindowHandlerContribution_1.GenerateCanvasId(),canvasControled:!0};this.canvas=new BrowserCanvas(n)}createWindowByCanvas(r){var e;let i;if(typeof r.canvas=="string"){if(i=this.global.getElementById(r.canvas),!i)throw new Error("canvasId canvasdom")}else i=r.canvas;if(!i)throw new Error("canvas");let n=r.width,o=r.height;if(n==null||o==null||!r.canvasControled){const u=i.getBoundingClientRect();n=u.width,o=u.height}let l=r.dpr;l==null&&(l=(e=i.getContext("2d").pixelRatio)!==null&&e!==void 0?e:i.width/n),this.canvas=new BrowserCanvas({width:n,height:o,dpr:l,nativeCanvas:i,canvasControled:r.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(r,e){this.canvas.resize(r,e)}setDpr(r){this.canvas.dpr=r}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(r,e,i){return this.canvas.nativeCanvas.addEventListener(r,e,i)}removeEventListener(r,e,i){return this.canvas.nativeCanvas.removeEventListener(r,e,i)}dispatchEvent(r){return this.canvas.nativeCanvas.dispatchEvent(r)}getStyle(){var r;return(r=this.canvas.nativeCanvas.style)!==null&&r!==void 0?r:{}}setStyle(r){this.canvas.nativeCanvas.style=r}getBoundingClientRect(){const r=this.canvas.nativeCanvas,e=this.getWH();return r.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:e.width,height:e.height,left:0,top:0,right:0,bottom:0}}clearViewBox(r){const e=this.viewBox,i=this.getContext(),n=this.getDpr();i.nativeContext.save(),i.nativeContext.setTransform(n,0,0,n,0,0),i.clearRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),r&&(i.fillStyle=r,i.fillRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1)),i.nativeContext.restore()}isVisible(r){return this._canvasIsIntersecting}onVisibleChange(r){this._onVisibleChangeCb=r}getTopLeft(r){return this.global.getElementTopLeft(this.canvas.nativeCanvas,r)}};BrowserWindowHandlerContribution.env="browser",BrowserWindowHandlerContribution.idprefix="visactor_window",BrowserWindowHandlerContribution.prefix_count=0,BrowserWindowHandlerContribution=BrowserWindowHandlerContribution_1=__decorate$y([injectable(),__metadata$r("design:paramtypes",[])],BrowserWindowHandlerContribution);const browserWindowModule=new ContainerModule(r=>{r(BrowserWindowHandlerContribution).toSelf(),r(WindowHandlerContribution).toDynamicValue(e=>e.container.get(BrowserWindowHandlerContribution)).whenTargetNamed(BrowserWindowHandlerContribution.env)});var __decorate$x=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$q=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__awaiter$3=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};class DynamicB{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(e){this.dom=e}}function createImageElement(r,e=!1){const i=document.createElement("img");if(application.global.isImageAnonymous&&(i.crossOrigin="anonymous"),e){const n=new Blob([r],{type:"image/svg+xml"});r=window.URL.createObjectURL(n)}return i.src=r,i.complete?Promise.resolve(i):new Promise((n,o)=>{i.onload=()=>{n(i)},i.onerror=()=>{o(new Error(""))}})}let BrowserEnvContribution=class extends BaseEnvContribution{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(r,e){var i,n;let o=0,l=0,u=0,d=0;if(r.changedTouches){const f=(i=r.changedTouches[0])!==null&&i!==void 0?i:{};o=f.clientX||0,l=f.clientY||0,u=o,d=l}else o=r.clientX||0,l=r.clientY||0,u=r.offsetX||0,d=r.offsetY||0;if(e){const f=o,g=l,_=e.getBoundingClientRect(),y=(n=e.getNativeHandler)===null||n===void 0?void 0:n.call(e).nativeCanvas;let b,S;return y&&(b=_.width/y.offsetWidth,S=_.height/y.offsetHeight),{x:(f-_.left)/(isValidNumber(b)?b:1),y:(g-_.top)/(isValidNumber(S)?S:1)}}return{x:u,y:d}}getNativeAABBBounds(r){let e=r;if(typeof r=="string"&&(e=new DOMParser().parseFromString(r,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)),e.getBoundingClientRect){const i=e.getBoundingClientRect();return new DynamicB(i)}return new AABBBounds}removeDom(r){return r.parentElement.removeChild(r),!0}updateDom(r,e){const{width:i,height:n,style:o}=e;return o&&(isString(o)?r.setAttribute("style",o):Object.keys(o).forEach(l=>{r.style[l]=o[l]})),i!=null&&(r.style.width=`${i}px`),n!=null&&(r.style.height=`${n}px`),!0}createDom(r){const{tagName:e="div",parent:i}=r,n=document.createElement(e);if(this.updateDom(n,r),i){const o=isString(i)?this.getElementById(i):i;o&&o.appendChild&&o.appendChild(n)}return n}loadImage(r){return createImageElement(r,!1).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadSvg(r){return createImageElement(r,!0).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}createCanvas(r){var e,i;const n=document.createElement("canvas");r.id&&(n.id=(e=r.id)!==null&&e!==void 0?e:Generator.GenAutoIncrementId().toString());const o=(i=r.dpr)!==null&&i!==void 0?i:window.devicePixelRatio;return r.width&&r.height&&(n.style.width=`${r.width}px`,n.style.height=`${r.height}px`,n.width=r.width*o,n.height=r.height*o),n}createOffscreenCanvas(r){var e;const i=(e=r.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return new OffscreenCanvas(r.width*i,r.height*i)}releaseCanvas(r){let e;e=typeof r=="string"?document.getElementById(r):r,e&&e.parentElement&&e.parentElement.removeChild(e)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(r,e,i){return document.addEventListener(r,e,i)}removeEventListener(r,e,i){return document.removeEventListener(r,e,i)}dispatchEvent(r){return document.dispatchEvent(r)}getElementById(r){return document.getElementById(r)}getRootElement(){return document.body}getDocument(){return document}release(...r){}getElementTop(r,e){let i=r.offsetTop,n=r.offsetParent;for(;n!==null;)i+=n.offsetTop,n=n.offsetParent;return i}getElementLeft(r,e){let i=r.offsetLeft,n=r.offsetParent;for(;n!==null;)i+=n.offsetLeft,n=n.offsetParent;return i}getElementTopLeft(r,e){let i=r.offsetTop,n=r.offsetLeft,o=r.offsetParent;for(;o!==null;)i+=o.offsetTop,n+=o.offsetLeft,o=o.offsetParent;return{top:i,left:n}}loadFont(r,e,i){return __awaiter$3(this,void 0,void 0,function*(){return new FontFace(r,isString(e)?`url(${e})`:e,i).load().then(function(n){return document.fonts.add(n),{loadState:"success"}}).catch(function(n){return console.error("Failed to load font:",n),{loadState:"fail"}})})}};BrowserEnvContribution=__decorate$x([injectable(),__metadata$q("design:paramtypes",[])],BrowserEnvContribution);const browserEnvModule=new ContainerModule(r=>{browserEnvModule.isBrowserBound||(browserEnvModule.isBrowserBound=!0,r(BrowserEnvContribution).toSelf().inSingletonScope(),r(EnvContribution).toService(BrowserEnvContribution))});browserEnvModule.isBrowserBound=!1;function loadBrowserEnv(r,e=!0){loadBrowserEnv.__loaded||(loadBrowserEnv.__loaded=!0,r.load(browserEnvModule),r.load(browserCanvasModule),r.load(browserWindowModule),e&&loadCanvasPicker(r))}loadBrowserEnv.__loaded=!1;class PickerBase{contains(e,i,n){if(!e.AABBBounds.containsPoint(i))return!1;if(e.attribute.pickMode==="imprecise")return!0;const{pickContext:o}=n??{};if(!o)return!1;const l=e.getGraphicTheme();o.highPerformanceSave();let{x:u=l.x,y:d=l.y}=e.attribute;if(e.transMatrix.onlyTranslate()){const g=e.getOffsetXY(l);u+=g.x,d+=g.y,o.setTransformForCurrent()}else u=0,d=0,o.transformFromMatrix(e.transMatrix,!0);let f=!1;return this.canvasRenderer.drawShape(e,o,u,d,{},null,(g,_,y)=>!!f||(f=g.isPointInPath(i.x,i.y),f),(g,_,y)=>{if(f)return!0;const b=_.lineWidth||y.lineWidth,S=_.pickStrokeBuffer||y.pickStrokeBuffer,v=_.keepStrokeScale||y.keepStrokeScale;return o.lineWidth=v?b+S:getScaledStroke(o,b+S,o.dpr),f=g.isPointInStroke(i.x,i.y),f}),o.highPerformanceRestore(),f}}var __decorate$w=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$p=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$n=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathArcPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="arc",this.numberType=ARC_NUMBER_TYPE}};DefaultMathArcPicker=__decorate$w([injectable(),__param$n(0,inject(ArcRender)),__metadata$p("design:paramtypes",[Object])],DefaultMathArcPicker);let loadArcPick$1=!1;const arcMathPickModule=new ContainerModule((r,e,i,n)=>{loadArcPick$1||(loadArcPick$1=!0,r(MathArcPicker).to(DefaultMathArcPicker).inSingletonScope(),r(MathPickerContribution).toService(MathArcPicker))});var __decorate$v=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$o=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$m=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathAreaPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="area",this.numberType=AREA_NUMBER_TYPE}};DefaultMathAreaPicker=__decorate$v([injectable(),__param$m(0,inject(AreaRender)),__metadata$o("design:paramtypes",[Object])],DefaultMathAreaPicker);let loadAreaPick$1=!1;const areaMathPickModule=new ContainerModule((r,e,i,n)=>{loadAreaPick$1||(loadAreaPick$1=!0,r(MathAreaPicker).to(DefaultMathAreaPicker).inSingletonScope(),r(MathPickerContribution).toService(MathAreaPicker))});var __decorate$u=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$n=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$l=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathCirclePicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="circle",this.numberType=CIRCLE_NUMBER_TYPE}};DefaultMathCirclePicker=__decorate$u([injectable(),__param$l(0,inject(CircleRender)),__metadata$n("design:paramtypes",[Object])],DefaultMathCirclePicker);let loadCirclePick$1=!1;const circleMathPickModule=new ContainerModule((r,e,i,n)=>{loadCirclePick$1||(loadCirclePick$1=!0,r(MathCirclePicker).to(DefaultMathCirclePicker).inSingletonScope(),r(MathPickerContribution).toService(MathCirclePicker))});class GlyphPickerBase{constructor(){this.type="glyph",this.numberType=GLYPH_NUMBER_TYPE}contains(e,i,n){if(!e.AABBBounds.containsPoint(i))return!1;if(e.attribute.pickMode==="imprecise")return!0;const{pickContext:o}=n??{};if(!o)return!1;const l=n==null?void 0:n.pickerService;if(l){let u=!1;return e.getSubGraphic().forEach(d=>{if(u)return;const f=l.pickItem(d,i,null,n);u=!(!f||!f.graphic)}),u}return!1}}var __decorate$t=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$m=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$k=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathGlyphPicker=class extends GlyphPickerBase{constructor(r){super(),this.canvasRenderer=r}};DefaultMathGlyphPicker=__decorate$t([injectable(),__param$k(0,inject(GlyphRender)),__metadata$m("design:paramtypes",[Object])],DefaultMathGlyphPicker);let loadGlyphPick$1=!1;const glyphMathPickModule=new ContainerModule((r,e,i,n)=>{loadGlyphPick$1||(loadGlyphPick$1=!0,r(MathGlyphPicker).to(DefaultMathGlyphPicker).inSingletonScope(),r(DefaultMathGlyphPicker).toService(MathGlyphPicker))});var __decorate$s=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultMathImagePicker=class{constructor(){this.type="image",this.numberType=IMAGE_NUMBER_TYPE}contains(r,e,i){const{pickContext:n}=i??{};return!!n&&!!r.AABBBounds.containsPoint(e)}};DefaultMathImagePicker=__decorate$s([injectable()],DefaultMathImagePicker);let loadImagePick$1=!1;const imageMathPickModule=new ContainerModule((r,e,i,n)=>{loadImagePick$1||(loadImagePick$1=!0,r(MathImagePicker).to(DefaultMathImagePicker).inSingletonScope(),r(DefaultMathImagePicker).toService(MathImagePicker))});var __decorate$r=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$l=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$j=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathLinePicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="line",this.numberType=LINE_NUMBER_TYPE}};DefaultMathLinePicker=__decorate$r([injectable(),__param$j(0,inject(LineRender)),__metadata$l("design:paramtypes",[Object])],DefaultMathLinePicker);let loadLinePick$1=!1;const lineMathPickModule=new ContainerModule((r,e,i,n)=>{loadLinePick$1||(loadLinePick$1=!0,r(MathLinePicker).to(DefaultMathLinePicker).inSingletonScope(),r(MathPickerContribution).toService(MathLinePicker))});var __decorate$q=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$k=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$i=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathPolygonPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="polygon",this.numberType=POLYGON_NUMBER_TYPE}};DefaultMathPolygonPicker=__decorate$q([injectable(),__param$i(0,inject(PolygonRender)),__metadata$k("design:paramtypes",[Object])],DefaultMathPolygonPicker);let loadPolygonPick$1=!1;const polygonMathPickModule=new ContainerModule((r,e,i,n)=>{loadPolygonPick$1||(loadPolygonPick$1=!0,r(MathPolygonPicker).to(DefaultMathPolygonPicker).inSingletonScope(),r(MathPickerContribution).toService(MathPolygonPicker))});var __decorate$p=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$j=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$h=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathPathPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="path",this.numberType=PATH_NUMBER_TYPE}};DefaultMathPathPicker=__decorate$p([injectable(),__param$h(0,inject(PathRender)),__metadata$j("design:paramtypes",[Object])],DefaultMathPathPicker);let loadPathPick$1=!1;const pathMathPickModule=new ContainerModule((r,e,i,n)=>{loadPathPick$1||(loadPathPick$1=!0,r(MathPathPicker).to(DefaultMathPathPicker).inSingletonScope(),r(MathPickerContribution).toService(MathPathPicker))}),_bounds=new AABBBounds;class RectPickerBase{constructor(){this.type="rect",this.numberType=RECT_NUMBER_TYPE}contains(e,i,n){if(!e.AABBBounds.containsPoint(i))return!1;if(e.attribute.pickMode==="imprecise")return!0;const{pickContext:o}=n??{};if(!o)return!1;const l=e.getGraphicTheme(),{cornerRadius:u=l.cornerRadius}=e.attribute;let{x:d=l.x,y:f=l.y}=e.attribute;o.highPerformanceSave();let g=!0;if(e.transMatrix.onlyTranslate()){const y=e.getOffsetXY(l);d+=y.x,f+=y.y,o.setTransformForCurrent()}else d=0,f=0,g=!1,o.transformFromMatrix(e.transMatrix,!0);let _=!0;if(!g||e.shadowRoot||isNumber(u,!0)&&u!==0||isArray(u)&&u.some(y=>y!==0))_=!1,this.canvasRenderer.drawShape(e,o,d,f,{},null,(y,b,S)=>!!_||(_=y.isPointInPath(i.x,i.y),_),(y,b,S)=>{if(_)return!0;const v=b.lineWidth||S.lineWidth,A=b.pickStrokeBuffer||S.pickStrokeBuffer,x=b.keepStrokeScale||S.keepStrokeScale;return o.lineWidth=x?v+A:getScaledStroke(o,v+A,o.dpr),_=y.isPointInStroke(i.x,i.y),_});else{const{fill:y=l.fill,stroke:b=l.stroke,lineWidth:S=l.lineWidth}=e.attribute;if(y)_=!0;else if(b){const v=e.AABBBounds;_bounds.setValue(v.x1,v.y1,v.x2,v.y2),_bounds.expand(-S/2),_=!_bounds.containsPoint(i)}}return o.highPerformanceRestore(),_}}var __decorate$o=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$i=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$g=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathRectPicker=class extends RectPickerBase{constructor(r){super(),this.canvasRenderer=r}};DefaultMathRectPicker=__decorate$o([injectable(),__param$g(0,inject(RectRender)),__metadata$i("design:paramtypes",[Object])],DefaultMathRectPicker);let loadRectPick$1=!1;const rectMathPickModule=new ContainerModule((r,e,i,n)=>{loadRectPick$1||(loadRectPick$1=!0,r(MathRectPicker).to(DefaultMathRectPicker).inSingletonScope(),r(MathPickerContribution).toService(MathRectPicker))});let loadRichTextPick=!1;const richTextMathPickModule=new ContainerModule((r,e,i,n)=>{loadRichTextPick||(loadRichTextPick=!0,r(MathImagePicker).to(DefaultMathImagePicker).inSingletonScope(),r(DefaultMathImagePicker).toService(MathImagePicker))});var __decorate$n=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$h=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$f=function(r,e){return function(i,n){e(i,n,r)}};let DefaultMathSymbolPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="symbol",this.numberType=SYMBOL_NUMBER_TYPE}};DefaultMathSymbolPicker=__decorate$n([injectable(),__param$f(0,inject(SymbolRender)),__metadata$h("design:paramtypes",[Object])],DefaultMathSymbolPicker);let loadSymbolPick$1=!1;const symbolMathPickModule=new ContainerModule((r,e,i,n)=>{loadSymbolPick$1||(loadSymbolPick$1=!0,r(MathSymbolPicker).to(DefaultMathSymbolPicker).inSingletonScope(),r(MathPickerContribution).toService(MathSymbolPicker))});var __decorate$m=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultMathTextPicker=class{constructor(){this.type="text",this.numberType=TEXT_NUMBER_TYPE}contains(r,e,i){return!!r.AABBBounds.containsPoint(e)}};DefaultMathTextPicker=__decorate$m([injectable()],DefaultMathTextPicker);let loadTextPick$1=!1;const textMathPickModule=new ContainerModule((r,e,i,n)=>{loadTextPick$1||(loadTextPick$1=!0,r(MathTextPicker).to(DefaultMathTextPicker).inSingletonScope(),r(MathPickerContribution).toService(MathTextPicker))});var __decorate$l=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$g=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let NodeContext2d=class extends BrowserContext2d{constructor(r,e){super(r,e);const i=r.nativeCanvas.getContext("2d");if(!i)throw new Error("2d");this.nativeContext=i,this.canvas=r,this.matrix=new Matrix(1,0,0,1,0,0),this.stack=[],this.dpr=e??1}release(...r){}};NodeContext2d.env="node",NodeContext2d=__decorate$l([injectable(),__metadata$g("design:paramtypes",[Object,Number])],NodeContext2d);var __decorate$k=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$f=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)};let NodeCanvas=class extends BaseCanvas{constructor(r){super(r)}init(){this._context=new NodeContext2d(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...r){this._nativeCanvas.release&&isFunction(this._nativeCanvas.release)&&this._nativeCanvas.release()}};NodeCanvas.env="node",NodeCanvas=__decorate$k([injectable(),__metadata$f("design:paramtypes",[Object])],NodeCanvas);const nodeCanvasModule=createModule(NodeCanvas,NodeContext2d);var __decorate$j=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$e=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$e=function(r,e){return function(i,n){e(i,n,r)}};let NodeWindowHandlerContribution=class extends BaseWindowHandlerContribution{get container(){return null}constructor(r){super(),this.global=r,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(r){r.canvas?this.createWindowByCanvas(r):this.createWindowByConfig(r)}createWindowByConfig(r){const e=this.global.createCanvas({width:r.width,height:r.height}),i={width:r.width,height:r.height,dpr:r.dpr,nativeCanvas:e,id:Generator.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new NodeCanvas(i)}createWindowByCanvas(r){const e=r.canvas;let i=r.width,n=r.height;i!=null&&n!=null&&r.canvasControled||(i=e.width,n=e.height),this.canvas=new NodeCanvas({width:i,height:n,dpr:1,nativeCanvas:e,canvasControled:r.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(r,e){this.canvas.resize(r,e)}setDpr(r){this.canvas.dpr=r}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(r="image/png"){return this.canvas.nativeCanvas.toBuffer(r)}addEventListener(r,e,i){}dispatchEvent(r){return!0}removeEventListener(r,e,i){}getStyle(){}setStyle(r){}getBoundingClientRect(){return null}clearViewBox(r){}};NodeWindowHandlerContribution.env="node",NodeWindowHandlerContribution=__decorate$j([injectable(),__param$e(0,inject(VGlobal)),__metadata$e("design:paramtypes",[Object])],NodeWindowHandlerContribution);const nodeWindowModule=new ContainerModule(r=>{r(NodeWindowHandlerContribution).toSelf(),r(WindowHandlerContribution).toDynamicValue(e=>e.container.get(NodeWindowHandlerContribution)).whenTargetNamed(NodeWindowHandlerContribution.env)});var __decorate$i=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let NodeEnvContribution=class extends BaseEnvContribution{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(r,e){r.env===this.type&&(r.setActiveEnvContribution(this),this.pkg=e)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(r){const e=fetch(r).then(i=>i.json());return e.then(i=>({data:i,state:"success"})).catch(()=>({data:null,state:"fail"})),e}loadArrayBuffer(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadImage(r){const{loadImage:e}=this.pkg;return e?e(r).then(i=>({loadState:i?"success":"fail",data:i})).catch(()=>({loadState:"fail",data:null})):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(r){const e=this.pkg.Resvg;if(!e)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const i=new e(r).render().asPng();return this.loadImage(i)}createCanvas(r){return this.pkg.createCanvas(r.width,r.height)}releaseCanvas(r){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(r){return rafBasedSto.call(r)}}getCancelAnimationFrame(){return r=>{rafBasedSto.clear(r)}}addEventListener(r,e,i){}removeEventListener(r,e,i){}getElementById(r){return null}getRootElement(){return null}dispatchEvent(r){}release(...r){}createOffscreenCanvas(r){}};NodeEnvContribution=__decorate$i([injectable()],NodeEnvContribution);const nodeEnvModule=new ContainerModule(r=>{nodeEnvModule.isNodeBound||(nodeEnvModule.isNodeBound=!0,r(NodeEnvContribution).toSelf().inSingletonScope(),r(EnvContribution).toService(NodeEnvContribution))});nodeEnvModule.isNodeBound=!1;function loadNodeEnv(r,e=!0){loadNodeEnv.__loaded||(loadNodeEnv.__loaded=!0,r.load(nodeEnvModule),r.load(nodeCanvasModule),r.load(nodeWindowModule))}loadNodeEnv.__loaded=!1;var __decorate$h=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$d=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$d=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasArcPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="arc",this.numberType=ARC_NUMBER_TYPE}};DefaultCanvasArcPicker=__decorate$h([injectable(),__param$d(0,inject(ArcRender)),__metadata$d("design:paramtypes",[Object])],DefaultCanvasArcPicker);let loadArcPick=!1;const arcCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadArcPick||(loadArcPick=!0,r(CanvasArcPicker).to(DefaultCanvasArcPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasArcPicker))});var __decorate$g=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$c=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$c=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasRectPicker=class extends RectPickerBase{constructor(r){super(),this.canvasRenderer=r}};DefaultCanvasRectPicker=__decorate$g([injectable(),__param$c(0,inject(RectRender)),__metadata$c("design:paramtypes",[Object])],DefaultCanvasRectPicker);let loadRectPick=!1;const rectCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadRectPick||(loadRectPick=!0,r(CanvasRectPicker).to(DefaultCanvasRectPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasRectPicker))});class BaseLinePicker extends BaseRender{contains(e,i,n){if(!e.AABBBounds.containsPoint(i))return!1;if(e.attribute.pickMode==="imprecise")return!0;const{pickContext:o}=n??{};if(!o)return!1;o.highPerformanceSave();const l=e.getGraphicTheme(),u=this.transform(e,l,o),{x:d,y:f,z:g,lastModelMatrix:_}=u;let y=i;if(o.camera){y=i.clone();const S=e.parent.globalTransMatrix;y.x=S.a*i.x+S.c*i.y+S.e,y.y=S.b*i.x+S.d*i.y+S.f}this.canvasRenderer.z=g;let b=!1;return this.canvasRenderer.drawShape(e,o,d,f,{},null,S=>!!b||(b=S.isPointInPath(y.x,y.y),b),(S,v,A)=>{if(b)return!0;const x=v.lineWidth||A.lineWidth,T=v.pickStrokeBuffer||A.pickStrokeBuffer,C=v.keepStrokeScale||A.keepStrokeScale;return o.lineWidth=C?x+T:getScaledStroke(o,x+T,o.dpr),b=S.isPointInStroke(y.x,y.y),b}),this.canvasRenderer.z=0,o.modelMatrix!==_&&mat4Allocate.free(o.modelMatrix),o.modelMatrix=_,o.highPerformanceRestore(),b}}var __decorate$f=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$b=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$b=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasLinePicker=class extends BaseLinePicker{constructor(r){super(),this.canvasRenderer=r,this.type="line",this.numberType=LINE_NUMBER_TYPE}};DefaultCanvasLinePicker=__decorate$f([injectable(),__param$b(0,inject(LineRender)),__metadata$b("design:paramtypes",[Object])],DefaultCanvasLinePicker);let loadLinePick=!1;const lineCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadLinePick||(loadLinePick=!0,r(CanvasLinePicker).to(DefaultCanvasLinePicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasLinePicker))});var __decorate$e=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$a=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$a=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasAreaPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="area",this.numberType=AREA_NUMBER_TYPE}};DefaultCanvasAreaPicker=__decorate$e([injectable(),__param$a(0,inject(AreaRender)),__metadata$a("design:paramtypes",[Object])],DefaultCanvasAreaPicker);let loadAreaPick=!1;const areaCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadAreaPick||(loadAreaPick=!0,r(CanvasAreaPicker).to(DefaultCanvasAreaPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasAreaPicker))});class Base3dPicker extends BaseRender{contains(e,i,n){const{pickContext:o}=n??{};if(!o)return!1;const l=e.getGraphicTheme();o.highPerformanceSave();const u=this.transform(e,l,o),{x:d,y:f,z:g,lastModelMatrix:_}=u;let y=i;if(o.camera){y=i.clone();const S=e.parent.globalTransMatrix;y.x=S.a*i.x+S.c*i.y+S.e,y.y=S.b*i.x+S.d*i.y+S.f}this.canvasRenderer.z=g;let b=!1;return this.canvasRenderer.drawShape(e,o,d,f,n,null,(S,v,A)=>!!b||(b=S.isPointInPath(y.x,y.y),b)),this.canvasRenderer.z=0,o.modelMatrix!==_&&mat4Allocate.free(o.modelMatrix),o.modelMatrix=_,o.highPerformanceRestore(),b}}var __decorate$d=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$9=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$9=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasSymbolPicker=class extends Base3dPicker{constructor(r){super(),this.canvasRenderer=r,this.type="symbol",this.numberType=SYMBOL_NUMBER_TYPE}contains(r,e,i){const{pickContext:n}=i??{};if(!n)return!1;const o=r.getParsedPath();if(!n.camera){if(!r.AABBBounds.containsPoint(e))return!1;if(o.isSvg||r.attribute.pickMode==="imprecise")return!0}n.highPerformanceSave();const l=r.getGraphicTheme(),u=this.transform(r,l,n),{x:d,y:f,z:g,lastModelMatrix:_}=u;let y=e;if(n.camera){y=e.clone();const S=r.parent.globalTransMatrix;y.x=S.a*e.x+S.c*e.y+S.e,y.y=S.b*e.x+S.d*e.y+S.f}this.canvasRenderer.z=g;let b=!1;return this.canvasRenderer.drawShape(r,n,d,f,{},null,(S,v,A)=>!!b||(b=S.isPointInPath(y.x,y.y),b),(S,v,A)=>{if(b)return!0;const x=v.lineWidth||A.lineWidth,T=v.pickStrokeBuffer||A.pickStrokeBuffer,C=v.keepStrokeScale||A.keepStrokeScale;return n.lineWidth=C?x+T:getScaledStroke(n,x+T,n.dpr),b=S.isPointInStroke(y.x,y.y),b}),this.canvasRenderer.z=0,n.modelMatrix!==_&&mat4Allocate.free(n.modelMatrix),n.modelMatrix=_,n.highPerformanceRestore(),b}};DefaultCanvasSymbolPicker=__decorate$d([injectable(),__param$9(0,inject(SymbolRender)),__metadata$9("design:paramtypes",[Object])],DefaultCanvasSymbolPicker);let loadSymbolPick=!1;const symbolCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadSymbolPick||(loadSymbolPick=!0,r(CanvasSymbolPicker).to(DefaultCanvasSymbolPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasSymbolPicker))});var __decorate$c=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$8=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$8=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasCirclePicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="circle",this.numberType=CIRCLE_NUMBER_TYPE}};DefaultCanvasCirclePicker=__decorate$c([injectable(),__param$8(0,inject(CircleRender)),__metadata$8("design:paramtypes",[Object])],DefaultCanvasCirclePicker);let loadCirclePick=!1;const circleCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadCirclePick||(loadCirclePick=!0,r(CanvasCirclePicker).to(DefaultCanvasCirclePicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasCirclePicker))});var __decorate$b=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$7=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$7=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasTextPicker=class extends Base3dPicker{constructor(r){super(),this.canvasRenderer=r,this.type="text",this.numberType=TEXT_NUMBER_TYPE}contains(r,e,i){const{pickContext:n}=i??{};if(!n)return!1;const o=r.AABBBounds;if(!n.camera)return!!o.containsPoint(e);n.highPerformanceSave();const l=r.getGraphicTheme(),{keepDirIn3d:u=l.keepDirIn3d}=r.attribute,d=!u,f=this.transform(r,l,n,d),{x:g,y:_,z:y,lastModelMatrix:b}=f;this.canvasRenderer.z=y;let S=e;if(n.camera){S=e.clone();const A=r.parent.globalTransMatrix;S.x=A.a*e.x+A.c*e.y+A.e,S.y=A.b*e.x+A.d*e.y+A.f}let v=!1;return this.canvasRenderer.drawShape(r,n,g,_,{},null,(A,x,T)=>{if(v)return!0;const{fontSize:C=l.fontSize,textBaseline:E=l.textBaseline,textAlign:P=l.textAlign}=r.attribute,L=r.AABBBounds,R=L.height(),w=L.width(),D=textLayoutOffsetY(E,R,C),I=textDrawOffsetX(P,w);return A.rect(I+g,D+_,w,R,y),v=A.isPointInPath(S.x,S.y),v},(A,x,T)=>v),this.canvasRenderer.z=0,n.modelMatrix!==b&&mat4Allocate.free(n.modelMatrix),n.modelMatrix=b,n.highPerformanceRestore(),v}};DefaultCanvasTextPicker=__decorate$b([injectable(),__param$7(0,inject(TextRender)),__metadata$7("design:paramtypes",[Object])],DefaultCanvasTextPicker);let loadTextPick=!1;const textCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadTextPick||(loadTextPick=!0,r(CanvasTextPicker).to(DefaultCanvasTextPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasTextPicker))});var __decorate$a=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$6=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$6=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasPathPicker=class extends BaseLinePicker{constructor(r){super(),this.canvasRenderer=r,this.type="path",this.numberType=PATH_NUMBER_TYPE}};DefaultCanvasPathPicker=__decorate$a([injectable(),__param$6(0,inject(PathRender)),__metadata$6("design:paramtypes",[Object])],DefaultCanvasPathPicker);let loadPathPick=!1;const pathCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadPathPick||(loadPathPick=!0,r(CanvasPathPicker).to(DefaultCanvasPathPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasPathPicker))});var __decorate$9=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$5=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$5=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasPolygonPicker=class extends PickerBase{constructor(r){super(),this.canvasRenderer=r,this.type="polygon",this.numberType=POLYGON_NUMBER_TYPE}};DefaultCanvasPolygonPicker=__decorate$9([injectable(),__param$5(0,inject(PolygonRender)),__metadata$5("design:paramtypes",[Object])],DefaultCanvasPolygonPicker);let loadPolygonPick=!1;const polygonCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadPolygonPick||(loadPolygonPick=!0,r(CanvasPolygonPicker).to(DefaultCanvasPolygonPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasPolygonPicker))});var __decorate$8=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$4=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$4=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasGlyphPicker=class extends GlyphPickerBase{constructor(r){super(),this.canvasRenderer=r}};DefaultCanvasGlyphPicker=__decorate$8([injectable(),__param$4(0,inject(GlyphRender)),__metadata$4("design:paramtypes",[Object])],DefaultCanvasGlyphPicker);let loadGlyphPick=!1;const glyphCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadGlyphPick||(loadGlyphPick=!0,r(CanvasGlyphPicker).to(DefaultCanvasGlyphPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasGlyphPicker))});var __decorate$7=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$3=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$3=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasRichTextPicker=class{constructor(r){this.canvasRenderer=r,this.type="richtext",this.numberType=RICHTEXT_NUMBER_TYPE}contains(r,e,i){return!!r.AABBBounds.containsPoint(e)}};DefaultCanvasRichTextPicker=__decorate$7([injectable(),__param$3(0,inject(RichTextRender)),__metadata$3("design:paramtypes",[Object])],DefaultCanvasRichTextPicker);let loadRichtextPick=!1;const richtextCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadRichtextPick||(loadRichtextPick=!0,r(CanvasRichTextPicker).to(DefaultCanvasRichTextPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasRichTextPicker))});var __decorate$6=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let DefaultCanvasImagePicker=class{constructor(){this.type="image",this.numberType=IMAGE_NUMBER_TYPE}contains(r,e,i){const{pickContext:n}=i??{};return!!n&&!!r.AABBBounds.containsPoint(e)}};DefaultCanvasImagePicker=__decorate$6([injectable()],DefaultCanvasImagePicker);let loadImagePick=!1;const imageCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadImagePick||(loadImagePick=!0,r(CanvasImagePicker).to(DefaultCanvasImagePicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasImagePicker))});var __decorate$5=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$2=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$2=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasRect3dPicker=class extends Base3dPicker{constructor(r){super(),this.canvasRenderer=r,this.type="rect3d",this.numberType=RECT3D_NUMBER_TYPE,this.themeType="rect"}};DefaultCanvasRect3dPicker=__decorate$5([injectable(),__param$2(0,inject(Rect3DRender)),__metadata$2("design:paramtypes",[Object])],DefaultCanvasRect3dPicker);let loadRect3dPick=!1;const rect3dCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadRect3dPick||(loadRect3dPick=!0,r(CanvasRect3dPicker).to(DefaultCanvasRect3dPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasRect3dPicker))});var __decorate$4=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata$1=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param$1=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasArc3dPicker=class extends Base3dPicker{constructor(r){super(),this.canvasRenderer=r,this.type="arc3d",this.numberType=ARC3D_NUMBER_TYPE,this.themeType="arc"}};DefaultCanvasArc3dPicker=__decorate$4([injectable(),__param$1(0,inject(Arc3dRender)),__metadata$1("design:paramtypes",[Object])],DefaultCanvasArc3dPicker);let loadArc3dPick=!1;const arc3dCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadArc3dPick||(loadArc3dPick=!0,r(CanvasArc3dPicker).to(DefaultCanvasArc3dPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasArc3dPicker))});var __decorate$3=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u},__metadata=function(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)},__param=function(r,e){return function(i,n){e(i,n,r)}};let DefaultCanvasPyramid3dPicker=class extends Base3dPicker{constructor(r){super(),this.canvasRenderer=r,this.type="pyramid3d",this.numberType=PYRAMID3D_NUMBER_TYPE,this.themeType="polygon"}};DefaultCanvasPyramid3dPicker=__decorate$3([injectable(),__param(0,inject(Pyramid3dRender)),__metadata("design:paramtypes",[Object])],DefaultCanvasPyramid3dPicker);let loadPyramid3dPick=!1;const pyramid3dCanvasPickModule=new ContainerModule((r,e,i,n)=>{loadPyramid3dPick||(loadPyramid3dPick=!0,r(CanvasPyramid3dPicker).to(DefaultCanvasPyramid3dPicker).inSingletonScope(),r(CanvasPickerContribution).toService(CanvasPyramid3dPicker))}),browser=isBrowserEnv();function _registerArc(){_registerArc.__loaded||(_registerArc.__loaded=!0,registerArcGraphic$1(),container.load(arcModule),container.load(browser?arcCanvasPickModule:arcMathPickModule))}_registerArc.__loaded=!1;const registerArc=_registerArc;function _registerArc3d(){_registerArc3d.__loaded||(_registerArc3d.__loaded=!0,registerArc3dGraphic$1(),registerDirectionalLight(),registerOrthoCamera(),container.load(arc3dModule),container.load(arc3dCanvasPickModule))}_registerArc3d.__loaded=!1;const registerArc3d=_registerArc3d;function _registerArea(){_registerArea.__loaded||(_registerArea.__loaded=!0,registerAreaGraphic$1(),container.load(areaModule),container.load(browser?areaCanvasPickModule:areaMathPickModule))}_registerArea.__loaded=!1;const registerArea=_registerArea;function _registerCircle(){_registerCircle.__loaded||(_registerCircle.__loaded=!0,registerCircleGraphic(),container.load(circleModule),container.load(browser?circleCanvasPickModule:circleMathPickModule))}_registerCircle.__loaded=!1;const registerCircle=_registerCircle;function _registerGlyph(){_registerGlyph.__loaded||(_registerGlyph.__loaded=!0,registerGlyphGraphic$1(),container.load(glyphModule),container.load(browser?glyphCanvasPickModule:glyphMathPickModule))}_registerGlyph.__loaded=!1;const registerGlyph=_registerGlyph;function _registerGroup(){_registerGroup.__loaded||(_registerGroup.__loaded=!0,registerGroupGraphic$1())}_registerGroup.__loaded=!1;const registerGroup=_registerGroup;function _registerImage(){_registerImage.__loaded||(_registerImage.__loaded=!0,registerImageGraphic$1(),container.load(imageModule),container.load(browser?imageCanvasPickModule:imageMathPickModule))}_registerImage.__loaded=!1;const registerImage=_registerImage;function _registerLine(){_registerLine.__loaded||(_registerLine.__loaded=!0,registerLineGraphic$1(),container.load(lineModule),container.load(browser?lineCanvasPickModule:lineMathPickModule))}_registerLine.__loaded=!1;const registerLine=_registerLine;function _registerPath(){_registerPath.__loaded||(_registerPath.__loaded=!0,registerPathGraphic$1(),container.load(pathModule),container.load(browser?pathCanvasPickModule:pathMathPickModule))}_registerPath.__loaded=!1;const registerPath=_registerPath;function _registerPolygon(){_registerPolygon.__loaded||(_registerPolygon.__loaded=!0,registerPolygonGraphic$1(),container.load(polygonModule),container.load(browser?polygonCanvasPickModule:polygonMathPickModule))}_registerPolygon.__loaded=!1;const registerPolygon=_registerPolygon;function _registerPyramid3d(){_registerPyramid3d.__loaded||(_registerPyramid3d.__loaded=!0,registerPyramid3dGraphic$1(),registerDirectionalLight(),registerOrthoCamera(),container.load(pyramid3dModule),container.load(pyramid3dCanvasPickModule))}_registerPyramid3d.__loaded=!1;const registerPyramid3d=_registerPyramid3d;function _registerRect(){_registerRect.__loaded||(_registerRect.__loaded=!0,registerRectGraphic$1(),container.load(rectModule),container.load(browser?rectCanvasPickModule:rectMathPickModule))}_registerRect.__loaded=!1;const registerRect=_registerRect;function _registerRect3d(){_registerRect3d.__loaded||(_registerRect3d.__loaded=!0,registerRect3dGraphic$1(),container.load(rect3dModule),container.load(rect3dCanvasPickModule))}_registerRect3d.__loaded=!1;const registerRect3d=_registerRect3d;function _registerRichtext(){_registerRichtext.__loaded||(_registerRichtext.__loaded=!0,registerRichtextGraphic(),container.load(richtextModule),container.load(browser?richtextCanvasPickModule:richTextMathPickModule))}_registerRichtext.__loaded=!1;const registerRichtext=_registerRichtext;function _registerShadowRoot(){_registerShadowRoot.__loaded||(_registerShadowRoot.__loaded=!0,registerShadowRootGraphic())}_registerShadowRoot.__loaded=!1;const registerShadowRoot=_registerShadowRoot;function _registerSymbol(){_registerSymbol.__loaded||(_registerSymbol.__loaded=!0,registerSymbolGraphic$1(),container.load(symbolModule),container.load(browser?symbolCanvasPickModule:symbolMathPickModule))}_registerSymbol.__loaded=!1;const registerSymbol=_registerSymbol;function _registerText(){_registerText.__loaded||(_registerText.__loaded=!0,registerTextGraphic$1(),container.load(textModule),container.load(browser?textCanvasPickModule:textMathPickModule))}_registerText.__loaded=!1;const registerText=_registerText;function loadScrollbarComponent(){registerGroup(),registerRect()}const POLAR_START_ANGLE$1=-.5*Math.PI,POLAR_END_ANGLE$1=1.5*Math.PI,DEFAULT_TEXT_FONT_FAMILY="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",DEFAULT_TEXT_FONT_SIZE=14;var StateValue;(function(r){r.selected="selected",r.selectedReverse="selected_reverse",r.hover="hover",r.hoverReverse="hover_reverse"})(StateValue||(StateValue={}));const DEFAULT_STATES$2={[StateValue.selectedReverse]:{},[StateValue.selected]:{},[StateValue.hover]:{},[StateValue.hoverReverse]:{}},DEFAULT_HTML_TEXT_SPEC={container:"",width:30,height:30,style:{}},SCROLLBAR_EVENT="scrollDrag",delayMap$3={debounce,throttle};loadScrollbarComponent();let ScrollBar$1=class Ne extends AbstractComponent{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Ne.defaultAttributes,e)),this.name="scrollbar",this._onRailPointerDown=n=>{const{viewX:o,viewY:l}=n,{direction:u,width:d,height:f,range:g}=this.attribute,_=this._sliderSize,[y,b]=this._getScrollRange();let S;if(u==="vertical"){const v=l-this._viewPosition.y,A=clamp(v-_/2,y,b);S=v/f,this._slider.setAttribute("y",A,!0)}else{const v=o-this._viewPosition.x,A=clamp(v-_/2,y,b);S=v/d,this._slider.setAttribute("x",A,!0)}this.setScrollRange([S-(g[1]-g[0])/2,S+(g[1]-g[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=n=>{const{stopSliderDownPropagation:o=!0}=this.attribute;o&&n.stopPropagation();const{direction:l}=this.attribute,{x:u,y:d}=this.stage.eventPointTransform(n);this._prePos=l==="horizontal"?u:d,this._dispatchEvent("scrollDown",{pos:this._prePos,event:n}),vglobal.env==="browser"?(vglobal.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),vglobal.addEventListener("pointerup",this._onSliderPointerUp)):(this.stage.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.addEventListener("pointerup",this._onSliderPointerUp),this.stage.addEventListener("pointerupoutside",this._onSliderPointerUp))},this._computeScrollValue=n=>{const{direction:o}=this.attribute,{x:l,y:u}=this.stage.eventPointTransform(n);let d,f,g=0;const{width:_,height:y}=this.getSliderRenderBounds();return o==="vertical"?(f=u,g=f-this._prePos,d=g/y):(f=l,g=f-this._prePos,d=g/_),[f,d]},this._onSliderPointerMove=n=>{const{stopSliderMovePropagation:o=!0}=this.attribute;o&&n.stopPropagation();const l=this.getScrollRange(),[u,d]=this._computeScrollValue(n);this.setScrollRange([l[0]+d,l[1]+d],!0),this._prePos=u},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:delayMap$3[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=n=>{n.preventDefault();const{realTime:o=!0,range:l,limitRange:u=[0,1]}=this.attribute,d=this.getScrollRange(),[f,g]=this._computeScrollValue(n),_=[d[0]+g,d[1]+g];this._dispatchEvent("scrollUp",{pre:l,value:clampRange(_,u[0],u[1])}),vglobal.env==="browser"?(vglobal.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),vglobal.removeEventListener("pointerup",this._onSliderPointerUp)):(this.stage.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.removeEventListener("pointerup",this._onSliderPointerUp),this.stage.removeEventListener("pointerupoutside",this._onSliderPointerUp))}}setScrollRange(e,i=!0){const{direction:n="horizontal",limitRange:o=[0,1],range:l,realTime:u=!0}=this.attribute,d=clampRange(e,o[0],o[1]);if(i){const f=this._getSliderPos(d);if(this._slider){const g=f[1]-f[0];this._sliderSize=g,n==="horizontal"?this._slider.setAttributes({x:f[0],width:g},!0):this._slider.setAttributes({y:f[0],height:g},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=d,u&&this._dispatchEvent(SCROLLBAR_EVENT,{pre:l,value:d})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:e="throttle",delayTime:i=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",delayMap$3[e](this._onRailPointerDown,i)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown)}render(){this._reset();const{direction:e="horizontal",width:i,height:n,range:o,limitRange:l=[0,1],railStyle:u,sliderStyle:d,padding:f=2}=this.attribute,g=this.createOrUpdateChild("scrollbar-container",{},"group"),_=g.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:i,height:n},u),"rect");this._rail=_;const y=this.getSliderRenderBounds(),b=this._getSliderPos(clampRange(o,l[0],l[1])),S=b[1]-b[0];let v;this._sliderSize=S,v=e==="horizontal"?{x:b[0],y:y.y1,width:S,height:y.height}:{x:y.x1,y:b[0],width:y.width,height:S};const A=g.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},v),{cornerRadius:this._getDefaultSliderCornerRadius()}),d),{boundsPadding:normalizePadding$1(f),pickMode:"imprecise"}),"rect");this._slider=A,this._container=g;const x=this._container.AABBBounds;this._viewPosition={x:x.x1,y:x.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:e,height:i,padding:n=2}=this.attribute,[o,l,u,d]=normalizePadding$1(n),f={x1:d,y1:o,x2:e-l,y2:i-u,width:Math.max(0,e-(d+l)),height:Math.max(0,i-(o+u))};return this._sliderRenderBounds=f,f}_getDefaultSliderCornerRadius(){const{direction:e,round:i}=this.attribute;if(i){const{width:n,height:o}=this.getSliderRenderBounds();return e==="horizontal"?o:n}return 0}_getSliderPos(e){const{direction:i}=this.attribute,{width:n,height:o,x1:l,y1:u}=this.getSliderRenderBounds();return i==="horizontal"?[n*e[0]+l,n*e[1]+l]:[o*e[0]+u,o*e[1]+u]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:e=[0,1],direction:i}=this.attribute,[n,o]=clampRange(e,0,1),{width:l,height:u,x1:d,y1:f}=this.getSliderRenderBounds(),g=this._sliderSize;return i==="horizontal"?clampRange([d+n*l,d+o*l],d,l-g):clampRange([f+n*u,f+o*u],f,u-g)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}};ScrollBar$1.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};var ScrollBarPlugin_1,__decorate$2=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};let ScrollBarPlugin=ScrollBarPlugin_1=class{constructor(){this.name="scrollbar",this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.key=this.name+this._uid,this.scroll=r=>{var e,i;const n=r.target,o=this.getScrollContainer(n);if(!o&&!this.scrollContainer)return;if(!o&&this.scrollContainer){if(!this.scrollContainer.g.stage||this.scrollContainer.g.stage!==n.stage)return;const x=this.formatScrollContainer(this.scrollContainer.g);if(!x)return void this.clearScrollbar(this.scrollContainer.g,"all");this.scrollContainer.showH&&!x.showH&&this.clearScrollbar(this.scrollContainer.g,"horizontal"),this.scrollContainer.showV&&!x.showV&&this.clearScrollbar(this.scrollContainer.g,"vertical"),this.scrollContainer=x}else o&&this.scrollContainer&&o.g!==this.scrollContainer.g&&this.clearScrollbar(this.scrollContainer.g,"all");if(this.scrollContainer=o??this.scrollContainer,!o)return;const l=o.g;if(!l)return;const{width:u,height:d,scrollX:f=0,scrollY:g=0}=l.attribute;let _=f,y=g,{showH:b,showV:S}=o;this.scrollContainerBounds=new Bounds().set(0,0,l.attribute.width,l.attribute.height),b&&b&&(abs$1(r.deltaX)>abs$1(r.deltaY)?(b=b&&!0,S=S&&!1):(b=b&&!1,S=S&&!0));const v=this.childrenBounds.width(),A=this.childrenBounds.height();b&&(_=f-((e=r.deltaX)!==null&&e!==void 0?e:0),_>0?_=0:_<u-v&&(_=u-v)),S&&(y=g-((i=r.deltaY)!==null&&i!==void 0?i:0),y>0?y=0:y<d-A&&(y=d-A)),l.setAttributes({scrollX:_,scrollY:y}),this.addOrUpdateScroll(b,S,l.parent,l)},this.handleScrollBarChange=r=>{if(!(this.scrollContainer&&this.scrollContainerBounds&&this.childrenBounds&&r&&r.target&&r.detail&&r.detail.value))return;const e=r.target,i=r.detail.value;if(e.attribute.direction==="horizontal"){const n=this.childrenBounds.width();this.scrollContainer.g.setAttributes({scrollX:-i[0]*n})}else{const n=this.childrenBounds.height();this.scrollContainer.g.setAttributes({scrollY:-i[0]*n})}}}activate(r){this.pluginService=r;const{stage:e}=this.pluginService;this.childrenBounds=new AABBBounds,e.addEventListener("wheel",this.scroll),this.params=ScrollBarPlugin_1.defaultParams}initEventOfScrollbar(r,e,i){r.addEventListener("pointerover",()=>{e.setAttribute("visibleAll",!0)}),r.addEventListener("pointermove",()=>{e.setAttribute("visibleAll",!0)}),r.addEventListener("pointerout",()=>{e.setAttribute("visibleAll",!1)}),e.addEventListener("pointerover",()=>{e.setAttribute("visibleAll",!0)}),e.addEventListener("pointerout",()=>{e.setAttribute("visibleAll",!0)}),e.addEventListener("scrollUp",this.handleScrollBarChange),e.addEventListener(SCROLLBAR_EVENT,this.handleScrollBarChange)}addOrUpdateScroll(r,e,i,n){if(r){const{scrollBar:o,isUpdate:l}=this.addOrUpdateHScroll(n,i,!0);l||this.initEventOfScrollbar(n,o,!0)}else this.clearScrollbar(n,"horizontal");if(e){const{scrollBar:o,isUpdate:l}=this.addOrUpdateHScroll(n,i,!1);l||this.initEventOfScrollbar(n,o,!1)}else this.clearScrollbar(n,"vertical")}getDirection(r){return r?"horizontal":"vertical"}addOrUpdateHScroll(r,e,i){var n,o;const l=this.getDirection(i),u=`${(n=r.name)!==null&&n!==void 0?n:r._uid}_${this.getDirection(i)}_${this.name}`,d=e.children.filter(L=>L.name===u);let f=!0,g=d[0];const{y:_=0,dy:y=0,x:b=0,dx:S=0,height:v,width:A,zIndex:x=0}=this.scrollContainer.g.attribute,T={x:0,y:0,direction:l,zIndex:x+1,visibleAll:!0,padding:[2,0],railStyle:{fill:"rgba(0, 0, 0, .1)"},range:[0,.05]};i?(T.width=this.scrollContainerBounds.width(),T.height=12):(T.height=this.scrollContainerBounds.height(),T.width=12),g?d.length>1&&d.forEach((L,R)=>{var w;R&&((w=L.parent)===null||w===void 0||w.removeChild(L))}):(f=!1,g=new ScrollBar$1(T),g.name=u,e.add(g),g.isScrollBar=!0);const C=this.childrenBounds,{scrollX:E,scrollY:P}=r.attribute;if(i){const L=Math.min(this.scrollContainerBounds.width()/C.width(),1),R=Math.max(Math.min(E/this.childrenBounds.width(),0),L-1);T.x=b+S,T.y=_+y+v-((o=T.height)!==null&&o!==void 0?o:0),T.range=[-R,-R+L]}else{const L=Math.min(this.scrollContainerBounds.height()/C.height(),1),R=Math.max(Math.min(P/this.childrenBounds.height(),0),L-1);T.x=b+S+A-this.scrollContainerBounds.width(),T.y=_+y,T.range=[-R,-R+L]}return g.setAttributes(T),{scrollBar:g,isUpdate:f}}clearScrollbar(r,e){r.parent&&r.parent.children.filter(i=>i.isScrollBar&&(e==="all"||i.attribute.direction===e)).forEach(i=>{i.parent.removeChild(i)})}formatScrollContainer(r){if(!r||r.type!=="group"||!r.attribute)return null;const{overflow:e,width:i,height:n}=r.attribute;if(!e||e==="hidden")return null;let o=!1,l=!1;e==="scroll"?(o=!0,l=!0):(o=e==="scroll-x",l=!o);const u=this.childrenBounds;return u.clear(),r.forEachChildren(d=>{u.union(d.AABBBounds)}),r.AABBBounds.empty()||(o&&(o=i<u.width()),l&&(l=n<u.height())),o||l?{g:r,showH:o,showV:l}:null}getScrollContainer(r){let e=r;for(;e;){const i=this.formatScrollContainer(e);if(i)return i;e=e.parent}return null}deactivate(r){const{stage:e}=this.pluginService;e.removeEventListener("wheel",this.scroll)}};ScrollBarPlugin.defaultParams={timeout:500},ScrollBarPlugin=ScrollBarPlugin_1=__decorate$2([injectable()],ScrollBarPlugin);const scrollbarModule=new ContainerModule((r,e,i,n)=>{i(ScrollBarPlugin)||(r(ScrollBarPlugin).toSelf(),r(AutoEnablePlugins).toService(ScrollBarPlugin))});function loadScrollbar(){container.load(scrollbarModule)}function traverseGroup(r,e){r.forEachChildren(i=>{const n=e(i);i.isContainer&&!n&&traverseGroup(i,e)})}const isVisible=r=>!isNil(r)&&r.visible!==!1;function getMarksByName(r,e){if(!e)return[];const i=r.find(n=>n.name===e,!0);return i?i.getChildren():[]}function getNoneGroupMarksByName(r,e){if(!e)return[];const i=r.find(n=>n.name===e,!0);return i?i.findAll(n=>n.type!=="group",!0):[]}function removeRepeatPoint(r){const e=[r[0]];for(let i=1;i<r.length;i++)r[i].x===r[i-1].x&&r[i].y===r[i-1].y||e.push(r[i]);return e}function isPostiveXAxis(r){return r>=0&&r<Math.PI/2||r>3*Math.PI/2&&r<=2*Math.PI}function fuzzyEqualNumber(r,e,i){return Math.abs(r-e)<i}function getTextAlignAttrOfVerticalDir(r,e,i){return r?{textAlign:"right",textBaseline:"middle"}:{textAlign:e<Math.PI&&i.toLocaleLowerCase().includes("top")||e>Math.PI&&i.toLocaleLowerCase().includes("bottom")?"left":e<Math.PI&&i.toLocaleLowerCase().includes("bottom")||e>Math.PI&&i.toLocaleLowerCase().includes("top")?"right":"center",textBaseline:e<Math.PI&&i.includes("inside")||e>Math.PI&&!i.includes("inside")?"bottom":"top"}}const defaultAlternativeColors=["#ffffff","#000000"];function labelSmartInvert(r,e,i,n,o,l){if(typeof r!="string"||typeof e!="string")return r;const u=new Color(r).toHex(),d=new Color(e).toHex();return contrastAccessibilityChecker(u,d,i,n,l)?u:improveContrastReverse(u,d,i,n,o,l)}function improveContrastReverse(r,e,i,n,o,l){const u=[];o&&(o instanceof Array?u.push(...o):u.push(o)),u.push(...defaultAlternativeColors);for(const d of u)if(r!==d&&contrastAccessibilityChecker(d,e,i,n,l))return d}function contrastAccessibilityChecker(r,e,i,n,o){if(o==="lightness"){const l=Color.getColorBrightness(new Color(e));return Color.getColorBrightness(new Color(r))<.5?l>=.5:l<.5}return n?contrastRatios(r,e)>n:i==="largeText"?contrastRatios(r,e)>3:contrastRatios(r,e)>4.5}function contrastRatios(r,e){const i=getColorLuminance(r),n=getColorLuminance(e);return((i>n?i:n)+.05)/((i>n?n:i)+.05)}function getColorLuminance(r){const e=hexToRgb(r),i=e[0]/255,n=e[1]/255,o=e[2]/255;let l,u,d;return l=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),u=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),d=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),.2126*l+.7152*u+.0722*d}function smartInvertStrategy(r,e,i,n){let o;switch(r){case"base":o=e;break;case"invertBase":o=i;break;case"similarBase":o=n}return o}function scale(r,e){return[r[0]*e,r[1]*e]}function length(r){const[e,i]=r;return Math.sqrt(e*e+i*i)}function normalize$1(r){let e=length(r);return e>0&&(e=1/e),[r[0]*e,r[1]*e]}function angle(r,e){const[i,n]=r,[o,l]=e,u=Math.sqrt((i*i+n*n)*(o*o+l*l)),d=u&&(i*o+n*l)/u;return Math.acos(Math.min(Math.max(d,-1),1))}function angleTo(r,e,i){const n=angle(r,e),o=crossProduct(r,e)>=0;return i?o?2*Math.PI-n:n:o?n:2*Math.PI-n}const initTextMeasure$1=(r,e,i,n)=>new TextMeasure(Object.assign({defaultFontParams:Object.assign({fontFamily:DEFAULT_TEXT_FONT_FAMILY,fontSize:DEFAULT_TEXT_FONT_SIZE},n),getTextBounds:i?void 0:getTextBounds,specialCharSet:`-/: .,@%'"~`+TextMeasure.ALPHABET_CHAR_SET+TextMeasure.ALPHABET_CHAR_SET.toUpperCase()},e??{}),r);function measureTextSize(r,e,i={}){if(!r)return{width:0,height:0};const n=getTextBounds({text:r,fontFamily:e.fontFamily||i.fontFamily||DEFAULT_TEXT_FONT_FAMILY,fontSize:e.fontSize||i.fontSize||12,fontWeight:e.fontWeight||i.fontWeight,textAlign:e.textAlign||"center",textBaseline:e.textBaseline,ellipsis:!!e.ellipsis,maxLineWidth:e.maxLineWidth||1/0,lineHeight:e.fontSize||i.fontSize||12});return{width:n.width(),height:n.height()}}function isRichText(r,e="type"){return getTextType(r,e)==="rich"}function getTextType(r,e="type"){var i,n;return isObject$1(r.text)&&"type"in r.text?(i=r.text.type)!==null&&i!==void 0?i:"text":e in r&&(n=r[e])!==null&&n!==void 0?n:"text"}function richTextAttributeTransform(r){var e,i;return isValid(r.maxLineWidth)&&(r.maxWidth=r.maxLineWidth,delete r.maxLineWidth),r.width=(e=r.width)!==null&&e!==void 0?e:0,r.height=(i=r.height)!==null&&i!==void 0?i:0,r.textConfig=r.text.text||r.text,r}function htmlAttributeTransform(r){const{text:e,_originText:i}=r,{text:n}=e;return r.html=n,r.text=i,r.renderable=!1,r}function reactAttributeTransform(r){const{text:e,_originText:i}=r,{text:n}=e;return r.react=n,r.text=i,r.renderable=!1,r}function createTextGraphicByType(r,e="type"){const i=getTextType(r,e);return i==="rich"?graphicCreator.richtext(richTextAttributeTransform(r)):(i==="html"?r=htmlAttributeTransform(r):i==="react"&&(r=reactAttributeTransform(r)),graphicCreator.text(r))}function alignTextInLine(r,e,i,n,o){r==="right"?i==="center"?e.setAttribute("x",n-o/2):i==="right"||i==="end"?e.setAttribute("x",n):e.setAttribute("x",n-o):i==="center"?e.setAttribute("x",n+o/2):i==="right"||i==="end"?e.setAttribute("x",n+o):e.setAttribute("x",n)}const deltaXYToAngle=(r,e)=>{const i=Math.atan2(r,e);return i<0?i+2*Math.PI:i};function computeOffsetForlimit(r,e){const{x1:i,y1:n,x2:o,y2:l}=e,{x1:u,y1:d,x2:f,y2:g}=r.AABBBounds;let _=0,y=0;return u<i&&(_=i-u),d<n&&(y=n-d),f>o&&(_=o-f),g>l&&(y=l-g),{dx:_,dy:y}}function limitShapeInBounds(r,e){const{dx:i,dy:n}=computeOffsetForlimit(r,e),{dx:o=0,dy:l=0}=r.attribute;i&&r.setAttribute("dx",i+o),n&&r.setAttribute("dy",n+l)}function loadTagComponent(){registerGroup(),registerRect(),registerSymbol(),registerRichtext(),registerText()}var __rest$w=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};loadTagComponent();class Tag extends AbstractComponent{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Tag.defaultAttributes,e)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var e,i,n;this.cacheStates();const{text:o="",textStyle:l={},shape:u={},panel:d={},space:f=4,minWidth:g,maxWidth:_,padding:y=4,visible:b,state:S,type:v,textAlwaysCenter:A,containerTextAlign:x}=this.attribute,T=normalizePadding$1(y),C=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let E,P=-T[3],L=-T[0],R=T[1]+T[3],w=T[0]+T[2],D=0,I=0;const{visible:O}=u,B=__rest$w(u,["visible"]);if(isBoolean(O)){const F=(B==null?void 0:B.size)||10,V=isNumber(F)?F:Math.max(F[0],F[1]);E=C.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:F,strokeBoundsBuffer:0},B),{visible:O,x:V/2,y:V/2}),"symbol"),isEmpty(S==null?void 0:S.shape)||(E.states=S.shape),O&&(I=V+f)}let N;if(R+=I,D+=I,isRichText({text:o})||v==="rich"){const F=Object.assign(Object.assign(Object.assign({},richTextAttributeTransform(Object.assign({type:v,text:o},l))),l),{visible:isValid(o)&&b!==!1,x:D,y:0});N=C.createOrUpdateChild("tag-text",F,"richtext"),R+=N.AABBBounds.width(),w+=N.AABBBounds.height(),P+=N.AABBBounds.x1,L+=N.AABBBounds.y1}else{const F=Object.assign(Object.assign({text:isObject$1(o)&&"type"in o&&o.type==="text"?o.text:o,visible:isValid(o)&&b!==!1,lineHeight:l==null?void 0:l.fontSize},l),{x:D,y:0});isNil(F.lineHeight)&&(F.lineHeight=l.fontSize),N=C.createOrUpdateChild("tag-text",F,"text"),isEmpty(S==null?void 0:S.text)||(N.states=S.text);const V=measureTextSize(F.text,l,(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),G=V.width,Y=V.height;R+=G;const J=(n=u.size)!==null&&n!==void 0?n:10,q=isNumber(J)?J:Math.max(J[0],J[1]);w+=Math.max(Y,u.visible?q:0);const{textAlign:te,textBaseline:de}=l;(isValid(g)||isValid(_))&&(isValid(g)&&R<g&&(R=g),isValid(_)&&R>_&&(R=_,N.setAttribute("maxLineWidth",_-T[1]-T[2]))),P=0,L=0;let he=0;te==="left"||te==="start"?he=1:te==="right"||te==="end"?he=-1:te==="center"&&(he=0),he?he<0?(P-=R,E&&E.setAttribute("x",(E.attribute.x||0)-G),C.setAttribute("x",-T[1]-I)):he>0&&C.setAttribute("x",T[3]):(P-=R/2,E&&E.setAttribute("x",(E.attribute.x||0)-G/2),C.setAttribute("x",-I/2));const fe=x==="right"||x==="end",pe=x==="left"||x==="start";if((x?x==="center":A)&&he){const me=R-T[1]-T[3],ee=G+I,Q=he===1?(me-ee)/2+I+G/2:T[0]+I-(R/2+ee/2-I)+G/2;if(N.setAttributes({x:Q,textAlign:"center"}),E){const ie=Q-G/2-I+q/2;E.setAttributes({x:ie})}}if(pe&&he!==1){const me=R-T[1]-T[3],ee=he===0?-me/2+I/2:-R+T[3]+T[1]+I,Q=ee+I;if(N.setAttributes({x:Q,textAlign:"left"}),E){const ie=ee+q/2;E.setAttributes({x:ie})}}if(fe&&he!==-1){const me=R-T[1]-T[3],ee=he===0?me/2+I/2:me;if(N.setAttributes({x:ee,textAlign:"right"}),E){const Q=ee-G-I+q/2;E.setAttributes({x:Q})}}de==="middle"?(L-=w/2,E&&E.setAttribute("y",0)):de==="bottom"?(L-=w,E&&E.setAttribute("y",-Y/2),C.setAttribute("y",-T[2])):de==="top"&&(C.setAttribute("y",T[0]),E&&E.setAttribute("y",Y/2))}const{visible:$}=d,H=__rest$w(d,["visible"]);if(b&&isBoolean($)){const F=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},H),{visible:$&&!!o,width:R,height:w,x:P,y:L}),"rect");if(isEmpty(S==null?void 0:S.panel)||(F.states=S.panel),H.customShape){const V=H.customShape;F.pathProxy=G=>V(this,G,new CustomPath2D)}this._bgRect=F}this._textShape=N,this._symbol=E,this.resetStates()}initAttributes(e,i){e=i!=null&&i.skipDefault?e:merge$1({},Tag.defaultAttributes,e),super.initAttributes(e),this.render()}addState(e,i,n){super.addState(e,i,n),this._textShape&&this._textShape.addState(e,i,n),this._bgRect&&this._bgRect.addState(e,i,n),this._symbol&&this._symbol.addState(e,i,n)}removeState(e,i){super.removeState(e,i),this._textShape&&this._textShape.removeState(e,i),this._bgRect&&this._bgRect.removeState(e,i),this._symbol&&this._symbol.removeState(e,i)}cacheStates(){var e,i,n,o,l,u,d,f,g,_,y,b,S,v;this._tagStates=(i=(e=this.currentStates)===null||e===void 0?void 0:e.slice())!==null&&i!==void 0?i:[],this._rectStates=(l=(o=(n=this._bgRect)===null||n===void 0?void 0:n.currentStates)===null||o===void 0?void 0:o.slice())!==null&&l!==void 0?l:[],this._symbolStates=(f=(d=(u=this._symbol)===null||u===void 0?void 0:u.currentStates)===null||d===void 0?void 0:d.slice())!==null&&f!==void 0?f:[],this._textStates=(y=(_=(g=this._textShape)===null||g===void 0?void 0:g.currentStates)===null||_===void 0?void 0:_.slice())!==null&&y!==void 0?y:[],this.clearStates(),(b=this._bgRect)===null||b===void 0||b.clearStates(),(S=this._symbol)===null||S===void 0||S.clearStates(),(v=this._textShape)===null||v===void 0||v.clearStates()}resetStates(){var e,i,n;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((e=this._bgRect)===null||e===void 0||e.useStates(this._rectStates)),this._symbolStates.length&&((i=this._symbol)===null||i===void 0||i.useStates(this._symbolStates)),this._textStates.length&&((n=this._textShape)===null||n===void 0||n.useStates(this._textStates))}}Tag.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const DEFAULT_THEME={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},theme={poptip:merge$1({},DEFAULT_THEME)};function loadPoptipComponent(){registerGroup(),registerText(),registerSymbol(),registerRect()}function setPoptipTheme(r){merge$1(theme.poptip,DEFAULT_THEME,r)}var __rest$v=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const _tBounds=new AABBBounds;loadPoptipComponent();class PopTip extends AbstractComponent{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},PopTip.defaultAttributes,e)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var e,i,n,o,l,u,d,f;const{titleStyle:g={},position:_,contentStyle:y={},panel:b={},space:S=4,minWidth:v=0,maxWidth:A=1/0,padding:x=4,maxWidthPercent:T,visible:C,state:E,dx:P=0,dy:L=0}=this.attribute;let{title:R="",content:w=""}=this.attribute;R=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(R):R,w=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(w):w;const D=normalizePadding$1(x),I=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group"),O=A-D[1]-D[3],B=isValid(R)&&C!==!1,N=Object.assign(Object.assign({text:isArray(R)?R:[R],visible:B,wrap:!0},g),{x:D[3],y:D[0],maxLineWidth:O,textAlign:"left",textBaseline:"top"}),$=I.createOrUpdateChild("poptip-title",N,"text");isEmpty(E==null?void 0:E.title)||($.states=E.title);const H=$.AABBBounds,F=H.height(),V=H.width();let G=F+S;B||(G=0);const Y=isValid(w)&&C!==!1,J=Object.assign(Object.assign({text:isArray(w)?w:[w],visible:Y,wrap:!0},y),{x:D[3],y:D[0]+G,maxLineWidth:O,textAlign:"left",textBaseline:"top"}),q=I.createOrUpdateChild("poptip-content",J,"text");isEmpty(E==null?void 0:E.content)||(q.states=E.content);const te=q.AABBBounds,de=te.height(),he=te.width();Y&&(G+=de);let fe=max$1(V+D[1]+D[3],he+D[1]+D[3]);fe>A?fe=A:fe<v&&(fe=v);let pe=D[0]+D[2]+G;const{visible:me}=b,ee=__rest$v(b,["visible"]),Q=(e=ee.size)!==null&&e!==void 0?e:12,ie=isArray(Q)?[Q[0]+((i=ee.space)!==null&&i!==void 0?i:0),Q[1]+((n=ee.space)!==null&&n!==void 0?n:0)]:Q+((o=ee.space)!==null&&o!==void 0?o:0),le=(l=ee.lineWidth)!==null&&l!==void 0?l:1,ce=this.stage?[(u=this.stage.viewWidth)!==null&&u!==void 0?u:this.stage.width,(d=this.stage.viewHeight)!==null&&d!==void 0?d:this.stage.height]:void 0;if(ce){const ne=this.AABBBounds,se=(f=this.attribute.x)!==null&&f!==void 0?f:ne.x1,ae=ce[0]-ne.x1;let j=Math.max(se,ae);const U=(isArray(Q)?Q[0]:12)+3;if(j=Math.min(j-U,j*T),j<fe){fe=j;const X=D[1]+D[3];$.setAttribute("maxLineWidth",j-X),q.setAttribute("maxLineWidth",j-X),pe=D[0]+D[2],B&&(pe+=$.AABBBounds.height()+S),pe+=q.AABBBounds.height()}}const z=_==="auto";let W,K=-1/0;for(let ne=0;ne<this.positionList.length+1;ne++){const se=z?this.positionList[ne===this.positionList.length?W:ne]:_,{angle:ae,offset:j,rectOffset:U}=this.getAngleAndOffset(se,fe,pe,isArray(ie)?ie:[ie,ie-le]);if(isBoolean(me)){const X=(isArray(Q)?Q[0]:Q)/4,re=I.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},ee),{visible:me&&(Y||B),x:X,y:0,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:"arrow2Left",angle:ae,dx:j[0],dy:j[1],size:Q,zIndex:-9}),"symbol");isEmpty(E==null?void 0:E.panel)||(re.states=E.panel);const ge=I.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},ee),{visible:me&&(Y||B),x:0,y:0,width:fe,height:pe,zIndex:-8}),"rect");isEmpty(E==null?void 0:E.panel)||(ge.states=E.panel)}if(I.setAttributes({x:-j[0]+P,y:-j[1]+L}),!z||!ce)break;{_tBounds.setValue(0,0,fe,pe).transformWithMatrix(I.globalTransMatrix);const X=_tBounds,re=new Bounds().setValue(0,0,ce[0],ce[1]);if(rectInsideAnotherRect(X,re,!1))break;{const ge=getRectIntersect(X,re,!1),ue=(ge.x2-ge.x1)*(ge.y2-ge.y1);ue>K&&(K=ue,W=ne)}}}}getAngleAndOffset(e,i,n,o){const l=o[1]/2;switch(e){case"tl":return{angle:pi$1/2*3,offset:[i/4,n+l],rectOffset:[-i/4,-n-o[1]]};case"top":return{angle:pi$1/2*3,offset:[i/2,n+l],rectOffset:[0,-n-o[1]]};case"tr":return{angle:pi$1/2*3,offset:[i/4*3,n+l],rectOffset:[i/4*3,-n-o[1]]};case"rt":return{angle:0,offset:[-l,n/5],rectOffset:[i/4*3,-n-o[1]]};case"right":return{angle:0,offset:[-l,n/2],rectOffset:[i/4*3,-n-o[1]]};case"rb":return{angle:0,offset:[-l,n/5*4],rectOffset:[i/4*3,-n-o[1]]};case"bl":return{angle:pi$1/2,offset:[i/4,-l],rectOffset:[-i/4,-n-o[1]]};case"bottom":return{angle:pi$1/2,offset:[i/2,-l],rectOffset:[0,-n-o[1]]};case"br":return{angle:pi$1/2,offset:[i/4*3,-l],rectOffset:[i/4*3,-n-o[1]]};case"lt":return{angle:pi$1,offset:[i+l,n/5],rectOffset:[-i/4,-n-o[1]]};case"left":return{angle:pi$1,offset:[i+l,n/2],rectOffset:[0,-n-o[1]]};case"lb":return{angle:pi$1,offset:[i+l,n/5*4],rectOffset:[i/4*3,-n-o[1]]}}}}PopTip.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},maxWidthPercent:.8,space:8,padding:10};var __decorate$1=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};function wrapPoptip(r,e){return merge$1(r,theme.poptip,e),r}let PopTipRenderContribution=class{render(r,e,i,n,o,l,u,d,f,g,_,y,b){var S,v;if(r._showPoptip===1){const{visible:A,visibleCb:x}=r.attribute.poptip||{};if(A===!1||x&&x(r)===!1)return;const T={};merge$1(T,PopTip.defaultAttributes,r.attribute.poptip?r.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(T):this.poptipComponent=new PopTip(T);let C=r.attribute.poptip||{};if(r.type==="text"&&C.title==null&&C.content==null){const L={};wrapPoptip(L,C),C=L,C.content=(S=C.content)!==null&&S!==void 0?S:r.attribute.text}const E=r.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1},C),{x:E.e,y:E.f})),g.stage.tryInitInteractiveLayer();const P=g.stage.getLayer("_builtin_interactive");P&&P.add(this.poptipComponent)}else r._showPoptip===2&&(r._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),(v=this.poptipComponent.parent)===null||v===void 0||v.removeChild(this.poptipComponent),this.poptipComponent=null))}};PopTipRenderContribution=__decorate$1([injectable()],PopTipRenderContribution);var __decorate=function(r,e,i,n){var o,l=arguments.length,u=l<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,e,i,n);else for(var d=r.length-1;d>=0;d--)(o=r[d])&&(u=(l<3?o(u):l>3?o(e,i,u):o(e,i))||u);return l>3&&u&&Object.defineProperty(e,i,u),u};class PopTipPluginBase{constructor(){this.activeEvent="onRegister",this._uid=Generator.GenAutoIncrementId(),this.poptip=e=>{const i=e.target;this.needHide(i)?this.unpoptip(e):i!==this.activeGraphic&&(this.needShow(i)&&(i.setAttributes({}),i._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(i,!0))},this.unpoptip=e=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(e){this.pluginService=e;const{stage:i}=this.pluginService;i.addEventListener("pointerover",this.poptip)}needHide(e){return e.isContainer||!e.attribute}needShow(e){return!!e.attribute.poptip}setActiveGraphic(e,i){this.activeGraphic=e,this.pluginService.stage.renderNextFrame()}deactivate(e){const{stage:i}=this.pluginService;i.removeEventListener("pointerover",this.poptip)}}let PopTipPlugin=class extends PopTipPluginBase{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};PopTipPlugin=__decorate([injectable()],PopTipPlugin);let PopTipForClipedTextPlugin=class extends PopTipPluginBase{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=r=>{const{stage:e}=this.pluginService;r.target===e&&this.unpoptip(r)}}activate(r){super.activate(r);const{stage:e}=this.pluginService;e.addEventListener("pointerleave",this.pointerlave)}needHide(r){return r.type!=="text"||!r.cliped||r.isContainer||!r.attribute||r.attribute.disableAutoClipedPoptip}needShow(r){return!0}deactivate(r){const{stage:e}=this.pluginService;super.deactivate(r),e.removeEventListener("pointerleave",this.pointerlave)}};PopTipForClipedTextPlugin=__decorate([injectable()],PopTipForClipedTextPlugin);const popTipModule=new ContainerModule((r,e,i,n)=>{i(PopTipRenderContribution)||(r(PopTipRenderContribution).toSelf().inSingletonScope(),r(InteractiveSubRenderContribution).toService(PopTipRenderContribution)),i(PopTipPlugin)||(r(PopTipPlugin).toSelf(),r(AutoEnablePlugins).toService(PopTipPlugin)),i(PopTipForClipedTextPlugin)||(r(PopTipForClipedTextPlugin).toSelf(),r(AutoEnablePlugins).toService(PopTipForClipedTextPlugin))});function loadPoptip(){container.load(popTipModule)}class CrosshairBase extends AbstractComponent{constructor(){super(...arguments),this.name="crosshair"}render(){this.renderCrosshair(this)}}function loadLineCrosshairComponent(){registerGroup(),registerLine()}function loadCircleCrosshairComponent(){registerGroup(),registerArc()}function loadPolygonCrosshairComponent(){registerGroup(),registerPath()}function loadRectCrosshairComponent(){registerGroup(),registerRect()}function loadSectorCrosshairComponent(){registerGroup(),registerArc()}loadLineCrosshairComponent();class LineCrosshair extends CrosshairBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},LineCrosshair.defaultAttributes,e))}renderCrosshair(e){const{start:i,end:n,lineStyle:o}=this.attribute;return e.createOrUpdateChild("crosshair-line",Object.assign({points:[i,n]},o),"line")}setLocation(e){const{start:i,end:n}=e;this.setAttributes({start:i,end:n})}}LineCrosshair.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};loadRectCrosshairComponent();class RectCrosshair extends CrosshairBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},RectCrosshair.defaultAttributes,e))}renderCrosshair(e){const{start:i,end:n,rectStyle:o}=this.attribute;return e.createOrUpdateChild("crosshair-rect",Object.assign({x:i.x,y:i.y,width:n.x-i.x,height:n.y-i.y},o),"rect")}setLocation(e){const{start:i,end:n}=e;this.setAttributes({start:i,end:n})}}RectCrosshair.defaultAttributes={rectStyle:{fill:"#b2bacf",opacity:.2}};loadCircleCrosshairComponent();class CircleCrosshair extends CrosshairBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},CircleCrosshair.defaultAttributes,e))}renderCrosshair(e){const{center:i,radius:n,lineStyle:o}=this.attribute;return e.createOrUpdateChild("crosshair-circle",Object.assign(Object.assign(Object.assign(Object.assign({},i),{outerRadius:n}),this.attribute),o),"arc")}setLocation(e){const{center:i}=this.attribute,n=PointService.distancePP(e,i);this.setAttribute("radius",n)}}CircleCrosshair.defaultAttributes={lineStyle:{stroke:["#b2bacf",!1,!1,!1],lineWidth:1,lineDash:[2]}};loadSectorCrosshairComponent();class SectorCrosshair extends CrosshairBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},SectorCrosshair.defaultAttributes,e))}renderCrosshair(e){const{center:i,radius:n,innerRadius:o=0,sectorStyle:l}=this.attribute,{startAngle:u,endAngle:d}=this.attribute;return e.createOrUpdateChild("crosshair-sector",Object.assign(Object.assign(Object.assign({},i),{outerRadius:n,innerRadius:o,startAngle:u,endAngle:d}),l),"arc")}setLocation(e){const{center:i,startAngle:n=POLAR_START_ANGLE$1,endAngle:o=POLAR_END_ANGLE$1}=this.attribute,l=o-n,u=radianToDegree(getAngleByPoint(i,e));this.setAttributes({startAngle:u-l/2,endAngle:u+l/2})}}SectorCrosshair.defaultAttributes={sectorStyle:{fill:"#b2bacf",opacity:.2}};loadPolygonCrosshairComponent();class PolygonCrosshair extends CrosshairBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},PolygonCrosshair.defaultAttributes,e))}renderCrosshair(e){const{center:i,radius:n,sides:o=6,lineStyle:l}=this.attribute,{startAngle:u,endAngle:d}=this.attribute,f=(d-u)%(2*Math.PI)==0,g=(d-u)/o;let _;for(let y=0;y<=o;y++){const b=polarToCartesian(i,n,u+g*y);y===0?_=`M${b.x},${b.y}`:_+=`L${b.x},${b.y}`,y===o&&f&&(_+="Z")}return e.createOrUpdateChild("crosshair-polygon",Object.assign({path:_},l),"path")}setLocation(e){const{center:i}=this.attribute,n=PointService.distancePP(e,i);this.setAttribute("radius",n)}}PolygonCrosshair.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};function loadSegmentComponent(){registerGroup(),registerLine(),registerPolygon(),registerSymbol()}function loadArcSegmentComponent(){registerGroup(),registerLine(),registerArc(),registerSymbol()}loadSegmentComponent();class Segment extends AbstractComponent{getStartAngle(){return normalizeAngle(this._startAngle)}getEndAngle(){return normalizeAngle(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Segment.defaultAttributes,e)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:e,endSymbol:i,lineStyle:n,state:o,visible:l=!0,multiSegment:u,mainSegmentIndex:d}=this.attribute;if(!l)return;this._computeLineAngle();const f=this._getMainSegmentPoints(),g=this._renderSymbol(e,f,"start"),_=this._renderSymbol(i,f,"end");if(this.startSymbol=g,this.endSymbol=_,u){const y=[...this.attribute.points];if(isValidNumber(d))y[d]=this._clipPoints(y[d]);else{const b=this._clipPoints(flattenArray(y));y[0][0]=b[0],y[y.length-1][y[y.length-1].length-1]=b[b.length-1]}y.forEach((b,S)=>{var v,A;const x=graphicCreator.line(Object.assign(Object.assign({points:b},isArray(n)?(v=n[S])!==null&&v!==void 0?v:n[n.length-1]:n),{fill:!1}));x.name=`${this.name}-line`,x.id=this._getNodeId("line"+S),isEmpty(o==null?void 0:o.line)||(x.states=isArray(o.line)?(A=o.line[S])!==null&&A!==void 0?A:o.line[o.line.length-1]:o.line),this.add(x),this.lines.push(x)})}else{let y=graphicCreator.line;array(n)[0].cornerRadius&&(y=graphicCreator.polygon);const b=y(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},array(n)[0]),{fill:!1,closePath:!1}));b.name=`${this.name}-line`,b.id=this._getNodeId("line"),isEmpty(o==null?void 0:o.line)||(b.states=[].concat(o.line)[0]),this.add(b),this.lines.push(b)}}_computeStartRotate(e){return e+Math.PI/2}_computeEndRotate(e){return e+Math.PI/2}_renderSymbol(e,i,n){if(!i.length)return;const{autoRotate:o=!0}=e;let l;if(e&&e.visible){const u=this.getStartAngle(),d=this.getEndAngle(),{state:f}=this.attribute,g=i[0],_=i[i.length-1],{refX:y=0,refY:b=0,refAngle:S=0,style:v,symbolType:A,size:x=12}=e;let T,C;n==="start"?(T={x:g.x+(isValidNumber(u)?y*Math.cos(u)+b*Math.cos(u-Math.PI/2):0),y:g.y+(isValidNumber(u)?y*Math.sin(u)+b*Math.sin(u-Math.PI/2):0)},C=this._computeStartRotate(this._startAngle)):(T={x:_.x+(isValidNumber(d)?y*Math.cos(d)+b*Math.cos(d-Math.PI/2):0),y:_.y+(isValidNumber(d)?y*Math.sin(d)+b*Math.sin(d-Math.PI/2):0)},C=this._computeEndRotate(this._endAngle)),l=graphicCreator.symbol(Object.assign(Object.assign(Object.assign({},T),{symbolType:A,size:x,angle:o?C+S:0,strokeBoundsBuffer:0}),v)),l.name=`${this.name}-${n}-symbol`,l.id=this._getNodeId(`${n}-symbol`),isEmpty(f==null?void 0:f.symbol)||(l.states=f.symbol),n==="start"?isEmpty(f==null?void 0:f.startSymbol)||(l.states=f.startSymbol):isEmpty(f==null?void 0:f.endSymbol)||(l.states=f.endSymbol),this.add(l)}return l}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:e,multiSegment:i,mainSegmentIndex:n}=this.attribute;let o;return o=i?isValidNumber(n)?e[n]:flattenArray(e):e,this._mainSegmentPoints=o,o}_clipPoints(e){const{startSymbol:i={},endSymbol:n={}}=this.attribute;let o=e;if(i.visible){const l=i.clip?i.size||10:0;o=[{x:e[0].x-l/2*(Math.cos(this._startAngle)||0),y:e[0].y-l/2*(Math.sin(this._startAngle)||0)},...o.slice(1)]}if(n.visible){const l=n.clip?n.size||10:0,u={x:e[e.length-1].x-l/2*(Math.cos(this._endAngle)||0),y:e[e.length-1].y-l/2*(Math.sin(this._endAngle)||0)};o=[...o.slice(0,o.length-1),u]}return o}_computeLineAngle(){const e=this._getMainSegmentPoints();if(e.length<=1)return;const i=e[0],n=e[1],o=e[e.length-2],l=e[e.length-1],u=[i.x-n.x,i.y-n.y],d=Math.atan2(u[1],u[0]),f=[l.x-o.x,l.y-o.y],g=Math.atan2(f[1],f[0]);this._startAngle=d,this._endAngle=g}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}Segment.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};loadArcSegmentComponent();class ArcSegment extends Segment{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Segment.defaultAttributes,e)),this.name="arc-segment",this.key="arc-segment",this.isReverseArc=!1}getStartAngle(){const e=this.isReverseArc?this._startAngle+Math.PI/2:this._startAngle-Math.PI/2;return e<0?e+2*Math.PI:e>2*Math.PI?e-2*Math.PI:e}getEndAngle(){const e=this.isReverseArc?this._endAngle-Math.PI/2:this._endAngle+Math.PI/2;return e<0?e+2*Math.PI:e>2*Math.PI?e-2*Math.PI:e}getMainSegmentPoints(){return this._mainSegmentPoints}_computeStartRotate(e){return this.isReverseArc?e+Math.PI:e}_computeEndRotate(e){return this.isReverseArc?e:e+Math.PI}render(){this.removeAllChild(!0),this._reset();const{startSymbol:e,endSymbol:i,lineStyle:n,state:o,visible:l=!0,radius:u,startAngle:d,endAngle:f,center:g}=this.attribute;if(!l)return;this._startAngle=d,this._endAngle=f,this.isReverseArc=d>f;const _={x:g.x+u*Math.cos(this._startAngle),y:g.y+u*Math.sin(this._startAngle)},y={x:g.x+u*Math.cos(this._endAngle),y:g.y+u*Math.sin(this._endAngle)};this._mainSegmentPoints=[_,y];const b=this._renderSymbol(e,this._mainSegmentPoints,"start"),S=this._renderSymbol(i,this._mainSegmentPoints,"end");this.startSymbol=b,this.endSymbol=S;const v=graphicCreator.arc(Object.assign({x:g.x,y:g.y,startAngle:d,endAngle:f,innerRadius:u,outerRadius:u},n));v.name=`${this.name}-line`,v.id=this._getNodeId("arc"),isEmpty(o==null?void 0:o.line)||(v.states=[].concat(o.line)[0]),this.add(v),this.line=v}}var AXIS_ELEMENT_NAME;(function(r){r.innerView="inner-view",r.axisContainer="axis-container",r.labelContainer="axis-label-container",r.tickContainer="axis-tick-container",r.tick="axis-tick",r.subTick="axis-sub-tick",r.label="axis-label",r.title="axis-title",r.gridContainer="axis-grid-container",r.grid="axis-grid",r.gridRegion="axis-grid-region",r.line="axis-line",r.background="axis-background",r.axisLabelBackground="axis-label-background",r.axisBreak="axis-break",r.axisBreakSymbol="axis-break-symbol"})(AXIS_ELEMENT_NAME||(AXIS_ELEMENT_NAME={}));var AxisStateValue;(function(r){r.selected="selected",r.selectedReverse="selected_reverse",r.hover="hover",r.hoverReverse="hover_reverse"})(AxisStateValue||(AxisStateValue={}));const DEFAULT_STATES$1={[AxisStateValue.selectedReverse]:{},[AxisStateValue.selected]:{},[AxisStateValue.hover]:{},[AxisStateValue.hoverReverse]:{}},TopZIndex=999,DEFAULT_AXIS_THEME={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},DEFAULT_AXIS_BREAK_SYMBOL_STYLE={size:8,stroke:"#000",lineWidth:1,zIndex:1};function genNormalBounds(r){const e=r.AABBBounds;return{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,centerX:r.attribute.x,centerY:r.attribute.y,angle:r.attribute.angle}}function genRotateBounds(r){r.forEach(e=>{if(e.rotatedBounds||!e.attribute.angle)return;const i=genNormalBounds(e),n=rotatePoint({x:e.attribute.x,y:e.attribute.y},i.angle,{x:i.centerX,y:i.centerY}),o=n.x-i.centerX,l=n.y-i.centerY;i.x1+=o,i.x2+=o,i.y1+=l,i.y2+=l,i.centerX+=o,i.centerY+=l,e.rotatedBounds=i})}function itemIntersect(r,e){var i,n;return!((i=r.OBBBounds)===null||i===void 0)&&i.empty()||!((n=e.OBBBounds)===null||n===void 0)&&n.empty()?isRectIntersect(r.AABBBounds,e.AABBBounds,!1)&&(!r.rotatedBounds||!e.rotatedBounds||isRotateAABBIntersect(r.rotatedBounds,e.rotatedBounds,!0)):r.OBBBounds.intersects(e.OBBBounds)}const DELTA_ANGLE=Math.sin(Math.PI/10);function isAngleVertical(r,e=DELTA_ANGLE){const i=!isNil(r)&&r!==0,n=i?Math.cos(r):1;return i&&Math.abs(n)<=e}function isAngleHorizontal(r,e=DELTA_ANGLE){const i=!isNil(r)&&r!==0,n=i?Math.sin(r):0;return!i||Math.abs(n)<=e}function getCircleLabelPosition(r,e){return{x:r.x+e[0],y:r.y+e[1]}}function getAxisBreakSymbolAttrs(r={}){var e,i;const{style:n={},angle:o=.5*Math.PI}=r,l=merge$1({},DEFAULT_AXIS_BREAK_SYMBOL_STYLE,n),u=(e=l.size)!==null&&e!==void 0?e:DEFAULT_AXIS_BREAK_SYMBOL_STYLE.size;return Object.assign(Object.assign({},l),{symbolType:(i=l.symbolType)!==null&&i!==void 0?i:`M ${-u/2} ${u*Math.sin(o)} L ${u/2} ${-u*Math.sin(o)}`,symbolSize:u})}function getElMap(r){const e={};return traverseGroup(r,i=>{i.type!=="group"&&i.id&&(e[i.id]=i)}),e}function getVerticalCoord(r,e){return{x:r.x+e[0],y:r.y+e[1]}}function getCircleVerticalVector(r,e,i,n=!1,o=!1){const l=[e.x-i.x,e.y-i.y];return scale(l,(n?-1:1)*(o?-1:1)*r/length(l))}function angleLabelOrientAttribute(r){let e="center",i="middle";return e=(r=normalizeAngle(r))>=Math.PI*(5/3)||r<=Math.PI*(1/3)?"left":r>=Math.PI*(2/3)&&r<=Math.PI*(4/3)?"right":"center",i=r>=Math.PI*(7/6)&&r<=Math.PI*(11/6)?"bottom":r>=Math.PI*(1/6)&&r<=Math.PI*(5/6)?"top":"middle",{align:e,baseline:i}}function getPolarAngleLabelPosition(r,e,i,n,o){const l=polarToCartesian({x:0,y:0},i,r),u=getVerticalCoord(l,getCircleVerticalVector(n,l,e,o));return getCircleLabelPosition(u,getCircleVerticalVector(n||1,u,e,o))}function getCirclePoints(r,e,i,n,o){const l=[],u=o-n;for(let d=0;d<e;d++){const f=n+d*u/e;l.push(polarToCartesian(r,i,f))}return l}function getPolygonPath(r,e){let i="";return r.length===0||(r.forEach((n,o)=>{o===0?i=`M${n.x},${n.y}`:i+=`L${n.x},${n.y}`}),e&&(i+="Z")),i}function textIntersect(r,e,i){var n;let o,l;const u=(n=r.attribute)===null||n===void 0?void 0:n.angle,d=(f,g,_)=>(o=f.AABBBounds,l=g.AABBBounds,_>Math.max(l.x1-o.x2,o.x1-l.x2,l.y1-o.y2,o.y1-l.y2));return isAngleHorizontal(u,Number.EPSILON)?d(r,e,i):(o=r.OBBBounds,l=e.OBBBounds,!o||!l||o.empty()||l.empty()?d(r,e,i):o.intersects(l))}function hasOverlap$1(r,e){for(let i,n=1,o=r.length,l=r[0];n<o;l=i,++n)if(i=r[n],textIntersect(l,i,e))return!0;return!1}const dispatchHoverState=(r,e,i)=>{const n=r.target;return n!==i&&n.name&&!isEmpty(n.states)?(n.addState(StateValue.hover,!0),traverseGroup(e,o=>{o!==n&&o.name&&!isEmpty(o.states)&&o.addState(StateValue.hoverReverse,!0)}),n):i},dispatchUnHoverState=(r,e,i)=>i&&(traverseGroup(e,n=>{n.name&&!isEmpty(n.states)&&(n.removeState(StateValue.hoverReverse),n.removeState(StateValue.hover))}),null),dispatchClickState=(r,e,i)=>{const n=r.target;return i===n&&n.hasState(StateValue.selected)?(traverseGroup(e,o=>{o.name&&!isEmpty(o.states)&&(o.removeState(StateValue.selectedReverse),o.removeState(StateValue.selected))}),null):n.name&&!isEmpty(n.states)?(n.addState(StateValue.selected,!0),traverseGroup(e,o=>{o!==n&&o.name&&!isEmpty(o.states)&&o.addState(StateValue.selectedReverse,!0)}),n):i};class AxisBase extends AbstractComponent{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=e=>{this._lastHover=dispatchHoverState(e,this.axisContainer,this._lastHover)},this._onUnHover=e=>{this._lastHover=dispatchUnHoverState(e,this.axisContainer,this._lastHover)},this._onClick=e=>{this._lastSelect=dispatchClickState(e,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(e){const i=cloneDeep(this.attribute);merge$1(this.attribute,e);const n=graphicCreator.group({x:this.attribute.x,y:this.attribute.y});return this.add(n),this._renderInner(n),this.removeChild(n),this.attribute=i,n.AABBBounds}render(){this._prevInnerView=this._innerView&&getElMap(this._innerView),this.removeAllChild(!0),this._innerView=graphicCreator.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:e,select:i}=this.attribute;e&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),i&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(e){const{title:i,label:n,tick:o,line:l,items:u}=this.attribute,d=graphicCreator.group({x:0,y:0,zIndex:1,pickable:!1});if(d.name=AXIS_ELEMENT_NAME.axisContainer,d.id=this._getNodeId("container"),d.setMode(this.mode),this.axisContainer=d,e.add(d),l&&l.visible&&this.renderLine(d),u&&u.length&&(this.data=this._transformItems(u[0]),o&&o.visible&&this.renderTicks(d),n&&n.visible)){const f=graphicCreator.group({x:0,y:0,pickable:!1});f.name=AXIS_ELEMENT_NAME.labelContainer,f.id=this._getNodeId("label-container"),this.axisLabelsContainer=f,d.add(f),u.forEach((g,_)=>{const y=this.renderLabels(f,g,_),b=y.getChildren();this.beforeLabelsOverlap(b,g,y,_,u.length),this.handleLabelsOverlap(b,g,y,_,u.length),this.afterLabelsOverlap(b,g,y,_,u.length);let S=0,v=0,A="center",x="middle",T=0;b.forEach((C,E)=>{var P;const L=C.attribute,R=(P=L.angle)!==null&&P!==void 0?P:0,w=C.AABBBounds;let D=w.width(),I=w.height();R&&(D=Math.abs(D*Math.cos(R)),I=Math.abs(I*Math.sin(R))),S=Math.max(S,D),v=Math.max(v,I),A=L.textAlign,x=L.textBaseline,E===0&&(T=L.x)}),this.axisLabelLayerSize[_]={width:S,height:v,labelPos:T,textAlign:A,textBaseline:x}})}i&&i.visible&&this.renderTitle(d)}renderTicks(e){const i=this.getTickLineItems(),n=graphicCreator.group({x:0,y:0,pickable:!1});n.name=AXIS_ELEMENT_NAME.tickContainer,n.id=this._getNodeId("tick-container"),e.add(n),i.forEach((l,u)=>{var d;const f=graphicCreator.line(Object.assign({},this._getTickLineAttribute("tick",l,u,i)));if(f.name=AXIS_ELEMENT_NAME.tick,f.id=this._getNodeId(l.id),isEmpty((d=this.attribute.tick)===null||d===void 0?void 0:d.state))f.states=DEFAULT_STATES$2;else{const g=this.data[u],_=merge$1({},DEFAULT_STATES$2,this.attribute.tick.state);Object.keys(_).forEach(y=>{isFunction(_[y])&&(_[y]=_[y](g.rawValue,u,g,this.data))}),f.states=_}n.add(f)}),this.tickLineItems=i;const{subTick:o}=this.attribute;if(o&&o.visible){const l=this.getSubTickLineItems();l.length&&l.forEach((u,d)=>{const f=graphicCreator.line(Object.assign({},this._getTickLineAttribute("subTick",u,d,i)));if(f.name=AXIS_ELEMENT_NAME.subTick,f.id=this._getNodeId(`${d}`),isEmpty(o.state))f.states=DEFAULT_STATES$2;else{const g=merge$1({},DEFAULT_STATES$2,o.state);Object.keys(g).forEach(_=>{isFunction(g[_])&&(g[_]=g[_](u.value,d,u,i))}),f.states=g}n.add(f)}),this.subTickLineItems=l}}renderLabels(e,i,n){const{dataFilter:o}=this.attribute.label;o&&isFunction(o)&&(i=o(i,n));const l=this._transformItems(i),u=graphicCreator.group({x:0,y:0,pickable:!1});return u.name=`${AXIS_ELEMENT_NAME.labelContainer}-layer-${n}`,u.id=this._getNodeId(`label-container-layer-${n}`),e.add(u),l.forEach((d,f)=>{var g;const _=this._getLabelAttribute(d,f,l,n),y=createTextGraphicByType(_);if(y.name=AXIS_ELEMENT_NAME.label,y.id=this._getNodeId(`layer${n}-label-${d.id}`),isEmpty((g=this.attribute.label)===null||g===void 0?void 0:g.state))y.states=DEFAULT_STATES$2;else{const b=merge$1({},DEFAULT_STATES$2,this.attribute.label.state);Object.keys(b).forEach(S=>{isFunction(b[S])&&(b[S]=b[S](d,f,l,n))}),y.states=b}y.data=Object.assign(Object.assign({},d),{index:f,layer:n}),u.add(y)}),u}renderTitle(e){const i=this.getTitleAttribute(),n=new Tag(Object.assign({},i));n.name=AXIS_ELEMENT_NAME.title,n.id=this._getNodeId("title"),e.add(n)}getVerticalCoord(e,i,n){return getVerticalCoord(e,this.getVerticalVector(i,n,e))}getTickLineItems(){const{tick:e}=this.attribute,i=this.data,n=[],{alignWithLabel:o,inside:l=!1,length:u,dataFilter:d}=e;let f=1;return i.length>=2&&(f=i[1].value-i[0].value),(d&&isFunction(d)?d(i):i).forEach(g=>{let _=g.point,y=g.value;if(!o){const S=g.value-f/2;if(this.isInValidValue(S))return;_=this.getTickCoord(S),y=S}const b=this.getVerticalCoord(_,u,l);if(this.mode==="3d"){const S=this.getVerticalVector(u,l,_);let v=0,A=0;abs$1(S[0])>abs$1(S[1])?v=pi$1/2*(b.x>_.x?1:-1):A=pi$1/2*(b.y>_.y?-1:1),n.push({start:_,end:b,value:y,id:`tick-${g.id}`,anchor:[_.x,_.y],alpha:v,beta:A})}else n.push({start:_,end:b,value:y,id:`tick-${g.id}`})}),n}getSubTickLineItems(){const{subTick:e}=this.attribute,i=[],{count:n=4,inside:o=!1,length:l=2}=e,u=this.tickLineItems,d=u.length;if(d>=2)for(let f=0;f<d-1;f++){const g=u[f],_=u[f+1];for(let y=0;y<n;y++){const b=(y+1)/(n+1),S=(1-b)*g.value+b*_.value,v=this.getTickCoord(S),A=this.getVerticalCoord(v,l,o);i.push({start:v,end:A,value:S,id:`sub-tick-${S}`})}}return i}_getTickLineAttribute(e,i,n,o){let l=get(this.attribute,`${e}.style`);const u=this.data[n];l=isFunction(l)?merge$1({},get(DEFAULT_AXIS_THEME,`${e}.style`),e==="tick"?l(u.rawValue,n,u,this.data):l(i.value,n,i,o)):l;const{start:d,end:f,anchor:g,alpha:_,beta:y}=i;return Object.assign({points:[d,f],anchor:g,alpha:_,beta:y},l)}_getLabelAttribute(e,i,n,o){var l,u;const{space:d=4,inside:f=!1,formatMethod:g,type:_="text",text:y}=this.attribute.label;let b=d,S=0;!((l=this.attribute.tick)===null||l===void 0)&&l.visible&&this.attribute.tick.inside===f&&(S=this.attribute.tick.length||4),!((u=this.attribute.subTick)===null||u===void 0)&&u.visible&&this.attribute.subTick.inside===f&&(S=Math.max(S,this.attribute.subTick.length||2)),b+=S;const v=this.getRelativeVector(e.point);o>0&&(v[1]===0?b+=(this.axisLabelLayerSize[o-1].height+get(this.attribute,"label.space",4))*o:b+=(this.axisLabelLayerSize[o-1].width+get(this.attribute,"label.space",4))*o);const A=this.getVerticalCoord(e.point,b,f),x=this.getVerticalVector(b||1,f,A),T=g?g(`${e.label}`,e,i,n,o):e.label;let{style:C}=this.attribute.label;C=isFunction(C)?merge$1({},DEFAULT_AXIS_THEME.label.style,C(e,i,n,o)):C;const E=this.getLabelAlign(x,f,C.angle);return C=merge$1(E,C),isFunction(C.text)&&(C.text=C.text({label:e.label,value:e.rawValue,index:e.index,layer:o})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(A,x,T,C)),{text:y??T,_originText:e.label,lineHeight:C==null?void 0:C.fontSize,type:_}),C)}getLabelPosition(e,i,n,o){return e}_transformItems(e){const i=[];return e.forEach(n=>{var o;i.push(Object.assign(Object.assign({},n),{point:this.getTickCoord(n.value),id:(o=n.id)!==null&&o!==void 0?o:n.label}))}),i}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const methods$2={parity:function(r){return r.filter((e,i)=>i%2?e.setAttribute("opacity",0):1)},greedy:function(r,e){let i;return r.filter((n,o)=>o&&textIntersect(i,n,e)?n.setAttribute("opacity",0):(i=n,1))}};function hasBounds(r){let e;return e=r.OBBBounds.empty()?r.AABBBounds:r.OBBBounds,e.width()>1&&e.height()>1}function reset$1(r){return r.forEach(e=>e.setAttribute("opacity",1)),r}function forceItemVisible$1(r,e,i,n,o=!1){if(i&&!r.attribute.opacity){const l=e.length;if(l>1){r.setAttribute("opacity",1);for(let u=0;u<l;u++){const d=o?e[l-1-u]:e[u];if(!n(d))break;d.setAttribute("opacity",0)}}}}function autoHide(r,e){if(isEmpty(r))return;const i=r.filter(hasBounds);if(isEmpty(i))return;let n;n=reset$1(i);const{method:o="parity",separation:l=0}=e,u=isFunction(o)?o:methods$2[o]||methods$2.parity;if(n.length>=3&&hasOverlap$1(n,l)){do n=u(n,l);while(n.length>=3&&hasOverlap$1(n,l));const d=(b,S,v=!0)=>v&&b<3||S,f=d(n.length,e.firstVisible,!1);let g=d(n.length,e.lastVisible);const _=i[0],y=last(i);textIntersect(_,y,l)&&f&&g&&(y.setAttribute("opacity",0),g=!1),forceItemVisible$1(_,n,f,b=>textIntersect(b,_,l)),forceItemVisible$1(y,n,g,b=>textIntersect(b,y,l)||!(!f||b===_)&&textIntersect(b,_,l),!0)}i.forEach(d=>{d.setAttribute("visible",!!d.attribute.opacity)})}function autoRotate(r,e){if(isEmpty(r))return;const{orient:i,labelRotateAngle:n=[0,45,90]}=e;if(n.length===0||r.some(u=>!!u.attribute.angle))return;let o=0,l=0;for(n&&n.length>0&&(l=n.length);o<l;){const u=n[o++];if(r.forEach(d=>{d.attribute.angle=degreeToRadian(u)}),tryRotate(i,r),!hasIntersect(r))break}}function hasIntersect(r){for(let e=1;e<r.length;e++)if(itemIntersect(r[e-1],r[e]))return!0;return!1}function tryRotate(r,e){r!=="bottom"&&r!=="top"||rotateXAxis(r,e),r!=="left"&&r!=="right"||rotateYAxis(r,e),genRotateBounds(e)}function clampAngle(r=0){if(r<0)for(;r<0;)r+=2*Math.PI;if(r>0)for(;r>=2*Math.PI;)r-=2*Math.PI;return r}function rotateYAxis(r,e){e.forEach((i,n)=>{i.attribute.angle&&i.setAttributes(Object.assign(Object.assign({},getYAxisLabelAlign(r,i.attribute.angle)),{angle:clampAngle(i.attribute.angle)}))})}function rotateXAxis(r,e){e.forEach(i=>{i.attribute.angle&&i.setAttributes(Object.assign(Object.assign({},getXAxisLabelAlign(r,i.attribute.angle)),{angle:clampAngle(i.attribute.angle)}))})}function getXAxisLabelAlign(r,e=0){let i=["center","left","left","left","center","right","right","right","left"],n=["top","top","middle","bottom","bottom","bottom","middle","top","top"];r==="top"&&(i=["center","right","right","right","center","left","left","left","right"],n=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const o=(e=clampAngle(e))/(.5*Math.PI);let l;return l=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[l],textBaseline:n[l]}}function getYAxisLabelAlign(r,e=0){let i=["right","right","center","left","left","left","center","right","right"],n=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];r==="right"&&(i=["left","left","center","right","right","right","center","left","left"],n=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const o=(e=clampAngle(e))/(.5*Math.PI);let l;return l=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[l],textBaseline:n[l]}}function normalizeOverflowLimitLength(r){return isValidNumber(r)?{left:r,right:r}:isObject$1(r)?{left:r.left||0,right:r.right||0}:{left:0,right:0}}function autoLimit(r,e){const{limitLength:i,verticalLimitLength:n,ellipsis:o="...",orient:l,axisLength:u}=e;if(isEmpty(r)||!isValidNumber(i))return;const d=normalizeOverflowLimitLength(e.overflowLimitLength),f=r[0],g=f.attribute.angle,_=!isNil(g),y=_?Math.cos(g):1,b=_?Math.sin(g):0,S=isAngleHorizontal(g),v=isAngleVertical(g),A=l==="top"||l==="bottom",x=f.attribute.direction,T=!S&&!v&&A&&(r.length<2||r.some(C=>Math.abs(C.AABBBounds.width()-f.AABBBounds.width())>=2))&&f.AABBBounds.width()>Math.abs(i/b);r.forEach(C=>{var E;if(A&&(v&&Math.floor(C.AABBBounds.height())<=i||S&&Math.floor(C.AABBBounds.width())<=n)||!A&&(x==="vertical"&&Math.floor(C.AABBBounds.height())<=n||x!=="vertical"&&(S&&Math.floor(C.AABBBounds.width())<=i||v&&Math.floor(C.AABBBounds.height())<=n)))return;let P=null;if(S||v)P=A?S?n:i:x==="vertical"||v?n:i;else if(A){const{x1:L,x2:R}=C.AABBBounds,w=b/y,D=Math.abs(i/b);if(T&&w>0&&L<=u+d.right&&i/w+L>u+d.right){const I=(u-L+d.right)/Math.abs(y);P=Math.min(I,D)}else if(T&&w<0&&R>=-d.left&&i/w+R<-d.left){const I=(R+d.left)/Math.abs(y);P=Math.min(I,D)}else P=D}else P=Math.abs(i/y);isValidNumber(C.attribute.maxLineWidth)&&(P=isValidNumber(P)?Math.min(C.attribute.maxLineWidth,P):C.attribute.maxLineWidth),C.setAttributes({maxLineWidth:P,ellipsis:(E=C.attribute.ellipsis)!==null&&E!==void 0?E:o})})}function autoWrap(r,e){const{limitLength:i,axisLength:n,ellipsis:o="...",orient:l}=e;if(isEmpty(r)||!isValidNumber(i))return;const u=r[0].attribute.angle,d=isAngleHorizontal(u),f=isAngleVertical(u),g=l==="top"||l==="bottom";let _=n/r.length;r.forEach((y,b)=>{var S,v,A,x,T;if(g){if(f&&Math.floor(y.AABBBounds.height())<=i)return;if(d){const P=getLabelMinGap(y.attribute.x,(S=r[b+1])===null||S===void 0?void 0:S.attribute.x,(v=r[b-1])===null||v===void 0?void 0:v.attribute.x);isValidNumber(P)&&(_=min$1(_,P))}}else{if(f){const P=getLabelMinGap(y.attribute.y,(A=r[b+1])===null||A===void 0?void 0:A.attribute.y,(x=r[b-1])===null||x===void 0?void 0:x.attribute.y);isValidNumber(P)&&(_=min$1(_,P))}if(d&&Math.floor(y.AABBBounds.width())<=i)return}let C=null,E=null;g?f?(C=i,E=_):(C=_,E=i):f?(C=_,E=i):(C=i,E=_),y.setAttributes({maxLineWidth:C,ellipsis:(T=y.attribute.ellipsis)!==null&&T!==void 0?T:o,whiteSpace:"normal",heightLimit:E})})}function getLabelMinGap(r,e,i){let n;return isValidNumber(e)&&(n=Math.abs(e-r)),isValidNumber(i)&&(n=isValidNumber(n)?Math.min(Math.abs(r-i),n):Math.abs(r-i)),n}function alignAxisLabels(r,e,i,n,o){n==="left"||n==="right"?o==="left"?r.forEach(l=>{var u;l.setAttributes({dx:((u=l.attribute.dx)!==null&&u!==void 0?u:0)+e-l.AABBBounds.x1})}):o==="right"?r.forEach(l=>{var u;l.setAttributes({dx:((u=l.attribute.dx)!==null&&u!==void 0?u:0)+e+i-l.AABBBounds.x2})}):o==="center"&&r.forEach(l=>{var u;l.setAttributes({dx:((u=l.attribute.dx)!==null&&u!==void 0?u:0)+e+i/2-(l.AABBBounds.x1+l.AABBBounds.x2)/2})}):n!=="bottom"&&n!=="top"||(o==="top"?r.forEach(l=>{var u;l.setAttributes({dy:((u=l.attribute.dy)!==null&&u!==void 0?u:0)+e-l.AABBBounds.y1})}):o==="bottom"?r.forEach(l=>{var u;l.setAttributes({dy:((u=l.attribute.dy)!==null&&u!==void 0?u:0)+e+i-l.AABBBounds.y2})}):o==="middle"&&r.forEach(l=>{var u;l.setAttributes({dy:((u=l.attribute.dy)!==null&&u!==void 0?u:0)+e+i/2-(l.AABBBounds.y1+l.AABBBounds.y2)/2})}))}class LineAxisMixin{isInValidValue(e){return e<0||e>1}getTickCoord(e){const{start:i}=this.attribute,n=this.getRelativeVector();return{x:i.x+n[0]*e,y:i.y+n[1]*e}}getRelativeVector(e){const{start:i,end:n}=this.attribute;return[n.x-i.x,n.y-i.y]}getVerticalVector(e,i=!1,n){const{verticalFactor:o=1}=this.attribute,l=this.getRelativeVector(),u=normalize$1(l),d=[u[1],-1*u[0]];return scale(d,e*(i?1:-1)*o)}}function loadBasicAxis(){registerGroup(),registerLine(),registerRichtext(),registerText()}function loadLineAxisComponent(){loadBasicAxis(),registerRect()}function loadCircleAxisComponent(){loadBasicAxis(),registerCircle()}function loadLineAxisGridComponent(){registerGroup(),registerPath()}function loadCircleAxisGridComponent(){registerGroup(),registerPath()}var __rest$u=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};loadLineAxisComponent();class LineAxis extends AxisBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},LineAxis.defaultAttributes,e),i)}_renderInner(e){var i;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const o=[];for(let l=0;l<this.attribute.breaks.length;l++){const u=this.attribute.breaks[l],{range:d,breakSymbol:f,rawRange:g}=u;o.push({startPoint:this.getTickCoord(d[0]),endPoint:this.getTickCoord(d[1]),range:d,breakSymbol:f,rawRange:g})}this._breaks=o}super._renderInner(e),this._breaks&&this._breaks.length&&this._breaks.forEach((o,l)=>{const{startPoint:u,endPoint:d,breakSymbol:f,rawRange:g}=o;if((f==null?void 0:f.visible)!==!1){const _=graphicCreator.group({zIndex:TopZIndex});_.name=AXIS_ELEMENT_NAME.axisBreak,_.id=this._getNodeId(`${AXIS_ELEMENT_NAME.axisBreak}-${l}`),_.data=g;const y=getAxisBreakSymbolAttrs(f),b=graphicCreator.symbol(Object.assign({x:u.x,y:u.y},y));b.name=AXIS_ELEMENT_NAME.axisBreakSymbol;const S=graphicCreator.symbol(Object.assign({x:d.x,y:d.y},y));S.name=AXIS_ELEMENT_NAME.axisBreakSymbol,_.add(b),_.add(S),e.add(_)}});const{panel:n}=this.attribute;if(n&&n.visible){const o=this.axisContainer,l=o.AABBBounds,u=graphicCreator.rect(Object.assign({x:l.x1,y:l.y1,width:l.width(),height:l.height()},n.style));u.name=AXIS_ELEMENT_NAME.background,u.id=this._getNodeId("background"),u.states=merge$1({},DEFAULT_STATES$1,(i=n.state)!==null&&i!==void 0?i:{}),o.insertBefore(u,o.firstChild)}}renderLine(e){const{start:i,end:n,line:o}=this.attribute,l=o,{startSymbol:u,endSymbol:d,style:f,state:g}=l,_=__rest$u(l,["startSymbol","endSymbol","style","state"]),y=Object.assign({startSymbol:u,endSymbol:d,lineStyle:f},_);if(this._breaks&&this._breaks.length){const S=[];let v=i;this._breaks.forEach(A=>{const{startPoint:x,endPoint:T}=A;S.push([v,x]),v=T}),S.push([v,n]),y.points=S,y.multiSegment=!0}else y.points=[i,n];isEmpty(g)||(y.state={line:merge$1({},DEFAULT_STATES$1,g),symbol:merge$1({},DEFAULT_STATES$1,g)});const b=new Segment(y);b.name=AXIS_ELEMENT_NAME.line,b.id=this._getNodeId("line"),e.add(b)}getTextAlign(e){let i="center";return isNumberClose(e[0],0)?isNumberClose(e[1],0)?Object.is(e[1],-0)?i="start":Object.is(e[0],-0)&&(i="end"):i="center":e[0]>0?i="start":e[0]<0&&(i="end"),i}getTitleAttribute(){var e,i,n;const o=this.attribute.title,{position:l="middle",space:u=4,textStyle:d={},autoRotate:f=!0,shape:g,background:_,state:y={},maxWidth:b}=o,S=__rest$u(o,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let v=.5;l==="start"?v=0:l==="end"&&(v=1);const{verticalFactor:A=1}=this.attribute,x=-1*A,T=this.getTickCoord(v),C=this.getRelativeVector();let E=0;if(!((e=this.attribute.label)===null||e===void 0)&&e.visible&&this.attribute.label.inside===!1){const $=+get(this.attribute,"label.space",4);E+=$;const H=Object.keys(this.axisLabelLayerSize).length;if(C[1]===0){const F=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(F)?E+=F+(H-1)*$:E=0}else if(C[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const F=this.axisLabelLayerSize[0].labelPos,V=this.axisLabelsContainer.AABBBounds;E+=(x===1?V.x2>F?Math.min(V.x2-F,V.width()):0:V.x1<F?Math.min(F-V.x1,V.width()):0)+(H-1)*$}else E=0;else Object.keys(this.axisLabelLayerSize).forEach((F,V)=>{E+=this.axisLabelLayerSize[F].width+(V>0?$:0)})}let P=0;!((i=this.attribute.tick)===null||i===void 0)&&i.visible&&this.attribute.tick.inside===!1&&(P=this.attribute.tick.length||4),!((n=this.attribute.subTick)===null||n===void 0)&&n.visible&&this.attribute.subTick.inside===!1&&(P=Math.max(P,this.attribute.subTick.length||2));const L=P+E+u,R=this.getVerticalCoord(T,L,!1),w=this.getVerticalVector(L,!1,{x:0,y:0});let D,I,{angle:O}=S;if(D=l==="start"?"start":l==="end"?"end":"center",isNil(O)&&f){O=angleTo(C,[1,0],!0);const{verticalFactor:$=1}=this.attribute;I=-1*$===1?"bottom":"top"}else D=this.getTextAlign(w),I=this.getTextBaseline(w,!1);let B=b;if(isNil(B)){const{verticalLimitSize:$,verticalMinSize:H,orient:F}=this.attribute,V=Math.min($||1/0,H||1/0);if(isValidNumber(V))if(F==="bottom"||F==="top")if(O!==Math.PI/2){const G=Math.abs(Math.cos(O??0));B=G<1e-6?1/0:this.attribute.end.x/G}else B=V-L;else if(O&&O!==0){const G=Math.abs(Math.sin(O));B=G<1e-6?1/0:this.attribute.end.y/G}else B=V-L}const N=Object.assign(Object.assign(Object.assign({},R),S),{maxWidth:B,textStyle:Object.assign({textAlign:D,textBaseline:I},d),state:{text:merge$1({},DEFAULT_STATES$1,y.text),shape:merge$1({},DEFAULT_STATES$1,y.shape),panel:merge$1({},DEFAULT_STATES$1,y.background)}});return N.angle=O,g&&g.visible&&(N.shape=Object.assign({visible:!0},g.style),g.space&&(N.space=g.space)),_&&_.visible&&(N.panel=Object.assign({visible:!0},_.style)),N}getTextBaseline(e,i){let n="middle";const{verticalFactor:o=1}=this.attribute,l=(i?1:-1)*o;return isNumberClose(e[1],0)?n=!isNumberClose(e[0],0)||Object.is(e[0],-0)||Object.is(e[1],-0)?"middle":l===1?"bottom":"top":e[1]>0?n="top":e[1]<0&&(n="bottom"),n}getLabelAlign(e,i,n){const o=this.attribute.orient;if(["top","bottom","right","left"].includes(o)||e[0]===0&&e[1]===0){if(o==="top"||o==="bottom")return getXAxisLabelAlign(i?o==="bottom"?"top":"bottom":o,n);if(o==="left"||o==="right")return getYAxisLabelAlign(i?o==="left"?"right":"left":o,n)}return{textAlign:this.getTextAlign(e),textBaseline:this.getTextBaseline(e,i)}}beforeLabelsOverlap(e,i,n,o,l){var u,d,f,g;const{flush:_=!1}=this.attribute.label||{};if(_&&e.length){const{orient:y,start:b,end:S}=this.attribute,v=y==="bottom"||y==="top",A=e[0],x=last(e),T=v?A.attribute.x>x.attribute.x:A.attribute.y<x.attribute.y;if(v){const C=T?x:A,E=T?A:x,P=b.x,L=S.x,R=C.AABBBounds.x1,w=E.AABBBounds.x2;R<P&&(C.attribute.angle?C.setAttributes({dx:((u=C.attribute.dx)!==null&&u!==void 0?u:0)+P-R}):C.setAttributes({x:P,textAlign:"left"})),w>L&&(E.attribute.angle?E.setAttributes({dx:((d=E.attribute.dx)!==null&&d!==void 0?d:0)+L-w}):E.setAttributes({x:L,textAlign:"right"}))}else{const C=T?x:A,E=T?A:x,P=C.AABBBounds.y2,L=E.AABBBounds.y1,R=b.y,w=S.y;L<R&&(E.attribute.angle?E.setAttributes({dy:((f=E.attribute.dy)!==null&&f!==void 0?f:0)+R-L}):E.setAttributes({y:R,textBaseline:"top"})),P>w&&(C.attribute.angle?C.setAttributes({dy:((g=C.attribute.dy)!==null&&g!==void 0?g:0)+w-P}):C.setAttributes({y:w,textBaseline:"bottom"}))}}}handleLabelsOverlap(e,i,n,o,l){if(isEmpty(e))return;const{verticalLimitSize:u,label:d,orient:f}=this.attribute,g=this._getAxisLabelLimitLength(u,l),{layoutFunc:_,autoRotate:y,autoRotateAngle:b,autoLimit:S,limitEllipsis:v,autoHide:A,autoHideMethod:x,autoHideSeparation:T,lastVisible:C,firstVisible:E,autoWrap:P,overflowLimitLength:L}=d;if(isFunction(_))_(e,i,o,this);else{if(y)autoRotate(e,{labelRotateAngle:b,orient:f});else if(P){const R=Math.abs(f==="left"||f==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);autoWrap(e,{orient:f,limitLength:g,axisLength:R,ellipsis:v})}if(!P&&S&&isValidNumber(g)&&g>0){const R=f==="left"||f==="right",w=Math.abs(R?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),D=R?w/e.length:A||y?1/0:w/e.length;autoLimit(e,{limitLength:g,verticalLimitLength:D,ellipsis:v,orient:f,axisLength:w,overflowLimitLength:L})}A&&autoHide(e,{method:x,separation:T,lastVisible:C,firstVisible:E})}}afterLabelsOverlap(e,i,n,o,l){const{verticalLimitSize:u,orient:d}=this.attribute,f=d==="bottom"||d==="top",g=n.AABBBounds;let _=f?g.height():g.width();const{verticalMinSize:y}=this.attribute;if(isValidNumber(y)&&(!isValidNumber(u)||y<=u)){const b=this._getAxisLabelLimitLength(y,l);let S,v;_=Math.max(_,b),d==="left"?(S=g.x2-_,v=g.y1):d==="right"?(S=g.x1,v=g.y1):d==="top"?(S=g.x1,v=g.y2-_):d==="bottom"&&(S=g.x1,v=g.y1);const A=graphicCreator.rect({x:S,y:v,width:f?g.width():_,height:f?_:g.height(),pickable:!1});A.name=AXIS_ELEMENT_NAME.axisLabelBackground,A.id=this._getNodeId("axis-label-background"),n.insertBefore(A,n.firstChild)}if(isValid(this.attribute.label.containerAlign)){let b;d==="left"?b=g.x2-_:d==="right"?b=g.x1:d==="top"?b=g.y2-_:d==="bottom"&&(b=g.y1),alignAxisLabels(e,b,_,d,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(e,i){var n,o,l,u,d;const{label:f,title:g,line:_,tick:y}=this.attribute,b=(n=f.space)!==null&&n!==void 0?n:4;let S=e,v=0,A=0;const x=_&&_.visible?(o=_.style.lineWidth)!==null&&o!==void 0?o:1:0,T=y&&y.visible?(l=y.length)!==null&&l!==void 0?l:4:0;if(g&&g.visible&&typeof g.text=="string"){v=measureTextSize(g.text,g.textStyle,(d=(u=this.stage)===null||u===void 0?void 0:u.getTheme())===null||d===void 0?void 0:d.text).height;const C=normalizePadding$1(g.padding);A=g.space+C[0]+C[2]}return S&&(S=(S-b-A-v-x-T)/i),S}release(){super.release(),this._breaks=null}}LineAxis.defaultAttributes=DEFAULT_AXIS_THEME,mixin(LineAxis,LineAxisMixin);class CircleAxisMixin{isInValidValue(e){const{startAngle:i=POLAR_START_ANGLE$1,endAngle:n=POLAR_END_ANGLE$1}=this.attribute;return Math.abs(n-i)%(2*Math.PI)==0?e>1:e<0||e>1}getTickCoord(e){const{startAngle:i=POLAR_START_ANGLE$1,endAngle:n=POLAR_END_ANGLE$1,center:o,radius:l,inside:u=!1,innerRadius:d=0}=this.attribute;return polarToCartesian(o,u&&d>0?d:l,i+(n-i)*e)}getVerticalVector(e,i=!1,n){return getCircleVerticalVector(e,n,this.attribute.center,i,this.attribute.inside)}getRelativeVector(e){const{center:i}=this.attribute;return[e.y-i.y,-1*(e.x-i.x)]}}function findSiblingLabels(r,e){const i=r.length;return{prevLabel:e>=1?r[e-1]:r[i-1],nextLabel:e<i-1?r[e+1]:r[0]}}function adjustMaxLineWidth(r,e,i){var n;r.setAttributes({maxLineWidth:e,ellipsis:(n=r.attribute.ellipsis)!==null&&n!==void 0?n:i})}function adjustMaxHeight(r,e,i){const n=[];if(r.length>=3){const{prevLabel:u,nextLabel:d}=findSiblingLabels(r,e);n.push(u,d)}else r.length===2&&n.push(r[e===0?1:0]);const o=r[e];let l=Math.min(Math.abs(o.attribute.y-i.y1),Math.abs(o.attribute.y-i.y2));n.forEach(u=>{l=Math.min(l,Math.abs(u.attribute.y-o.attribute.y))}),l>0&&o.setAttributes({whiteSpace:"normal",heightLimit:l})}function circleAutoLimit(r,e){const{ellipsis:i,inside:n,bounds:o,autoWrap:l,center:u}=e;n||r.forEach((d,f)=>{const{x:g,y:_}=d.attribute,y=d.AABBBounds;if(isNumberClose(g,u.x)){if(_>o.y2||_<o.y1)return void adjustMaxLineWidth(d,0,i);const b=o.x2-o.x1;if(r.length>=3){const{prevLabel:S,nextLabel:v}=findSiblingLabels(r,f);let A=S.attribute.x,x=v.attribute.x;A>x&&(A=v.attribute.x,x=S.attribute.x);const T=A===x?b:g>=A&&g<=x?x-A:Math.min(Math.abs(A-g),Math.abs(x-g));d.AABBBounds.width()>T&&adjustMaxLineWidth(d,T,i)}else d.AABBBounds.width()>b&&adjustMaxLineWidth(d,b,i)}else g>u.x&&y.x2>o.x2?(adjustMaxLineWidth(d,o.x2-g,i),l&&adjustMaxHeight(r,f,o)):g<u.x&&y.x1<o.x1&&(adjustMaxLineWidth(d,g-o.x1,i),l&&adjustMaxHeight(r,f,o))})}var __rest$t=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};loadCircleAxisComponent();class CircleAxis extends AxisBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},CircleAxis.defaultAttributes,e))}renderLine(e){const{startAngle:i=POLAR_START_ANGLE$1,endAngle:n=POLAR_END_ANGLE$1,radius:o,center:l,innerRadius:u=0,line:d={},inside:f=!1,sides:g}=this.attribute;let _,y=o,b=u;if(f&&u>0&&(y=u,b=0),isValidNumber(g)&&g>=3){const S=getCirclePoints(l,g,y,i,n);_=graphicCreator.path(Object.assign(Object.assign({},d.style),{path:getPolygonPath(S,!0)}))}else{const S=Object.assign(Object.assign(Object.assign({},l),{startAngle:i,endAngle:n,radius:y,innerRadius:b}),d.style);_=graphicCreator.circle(S)}_.name=AXIS_ELEMENT_NAME.line,_.id=this._getNodeId("line"),isEmpty(d.state)||(_.states=merge$1({},DEFAULT_STATES$1,d.state)),e.add(_)}getTitleAttribute(){var e,i,n;const{center:o,radius:l,innerRadius:u=0}=this.attribute,d=this.attribute.title,{space:f=4,textStyle:g={},shape:_,background:y,state:b={}}=d,S=__rest$t(d,["space","textStyle","shape","background","state"]);let v=o,A=0;!((e=this.attribute.label)===null||e===void 0)&&e.visible&&this.attribute.label.inside===!1&&(A=get(this.attribute.label,"style.fontSize",12)+get(this.attribute.label,"space",4));let x=0;!((i=this.attribute.tick)===null||i===void 0)&&i.visible&&this.attribute.tick.inside===!1&&(x=this.attribute.tick.length||4),!((n=this.attribute.subTick)===null||n===void 0)&&n.visible&&this.attribute.subTick.inside===!1&&(x=Math.max(x,this.attribute.subTick.length||2));const T=l+x+A+f;let C="middle",{position:E}=this.attribute.title;isNil(E)&&(E=u===0?"end":"middle"),E==="start"?(C="bottom",v={x:o.x,y:o.y-T}):E==="end"&&(C="top",v={x:o.x,y:o.y+T});const P=Object.assign(Object.assign(Object.assign({},v),S),{textStyle:Object.assign({textBaseline:C,textAlign:"center"},g),state:{text:merge$1({},DEFAULT_STATES$1,b.text),shape:merge$1({},DEFAULT_STATES$1,b.shape),panel:merge$1({},DEFAULT_STATES$1,b.background)}}),{angle:L}=S;return P.angle=L,_&&_.visible&&(P.shape=Object.assign({visible:!0},_.style),_.space&&(P.space=_.space)),y&&y.visible&&(P.panel=Object.assign({visible:!0},y.style)),P}getSubTickLineItems(){var e,i;const{subTick:n}=this.attribute,o=[],{count:l=4,inside:u=!1,length:d=2}=n,f=this.tickLineItems,g=f.length;if(g>=2){const _=this.data[1].value-this.data[0].value,y=(i=(e=this.attribute)===null||e===void 0?void 0:e.tick)===null||i===void 0?void 0:i.alignWithLabel;for(let b=0;b<g;b++){const S=f[b],v=f[b+1];for(let A=0;A<l;A++){const x=(A+1)/(l+1),T=(1-x)*S.value+x*(v?v.value:y?1:S.value+_),C=this.getTickCoord(T),E=this.getVerticalCoord(C,d,u);o.push({start:C,end:E,value:T})}}}return o}beforeLabelsOverlap(e,i,n,o,l){}handleLabelsOverlap(e,i,n,o,l){if(isEmpty(e))return;const{inside:u,radius:d,center:f,size:g,label:_,orient:y}=this.attribute,b=g?{x1:0,y1:0,x2:g.width,y2:g.height}:{x1:f.x-d,y1:f.y-d,x2:f.x+d,y2:f.y+d},{layoutFunc:S,autoLimit:v,limitEllipsis:A,autoHide:x,autoHideMethod:T,autoHideSeparation:C,autoWrap:E}=_;isFunction(S)?S(e,i,o,this):((v||E)&&circleAutoLimit(e,{inside:u,autoWrap:E,bounds:b,ellipsis:A,center:f}),x&&autoHide(e,{method:T,separation:C}))}afterLabelsOverlap(e,i,n,o,l){}getTextBaseline(e){return Math.abs(e[1]/e[0])<.3?"middle":e[1]<0?"bottom":e[1]>0?"top":"middle"}getLabelAlign(e,i,n){return isNumberClose(e[0],0)?{textAlign:"center",textBaseline:e[1]>0?"top":"bottom"}:e[0]<0?{textAlign:"right",textBaseline:this.getTextBaseline(e)}:e[0]>0?{textAlign:"left",textBaseline:this.getTextBaseline(e)}:{textAlign:"center",textBaseline:"middle"}}getLabelPosition(e,i,n,o){return e}}CircleAxis.defaultAttributes=DEFAULT_AXIS_THEME,mixin(CircleAxis,CircleAxisMixin);class GroupTransition extends ACustomAnimate{constructor(){super(...arguments),this.mode=AnimateMode.NORMAL}onBind(){const e=this.target.getInnerView(),i=this.target.getPrevInnerView();i&&(this._newElementAttrMap={},traverseGroup(e,n=>{var o,l,u,d,f,g;if(n.type!=="group"&&n.id){const _=i[n.id];if(_){if(!isEqual(n.attribute,_.attribute)){const y=cloneDeep(n.attribute);this._newElementAttrMap[n.id]={state:"update",node:n,attrs:Object.assign(Object.assign({},y),{opacity:(o=y.opacity)!==null&&o!==void 0?o:1,fillOpacity:(l=y.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(u=y.strokeOpacity)!==null&&u!==void 0?u:1})},n.setAttributes(_.attribute)}}else{const y={opacity:(d=n.attribute.opacity)!==null&&d!==void 0?d:1,fillOpacity:(f=n.attribute.fillOpacity)!==null&&f!==void 0?f:1,strokeOpacity:(g=n.attribute.strokeOpacity)!==null&&g!==void 0?g:1};this._newElementAttrMap[n.id]={state:"enter",node:n,attrs:y},n.setAttributes({opacity:0,fillOpacity:0,strokeOpacity:0})}}}))}onStart(){let e=this.duration,i=this.easing;this._newElementAttrMap&&Object.keys(this._newElementAttrMap).forEach(n=>{var o;const{node:l,attrs:u,state:d}=this._newElementAttrMap[n];if(d==="enter"){const{enter:f={}}=(o=this.params)!==null&&o!==void 0?o:{};e=isValidNumber(f.duration)?f.duration:e,i=f.easing?f.easing:i}l.type==="path"?l.animate({interpolate:(f,g,_,y,b)=>f==="path"&&(b.path=interpolateString(_,y)(g),!0)}).to(u,e,i):l.animate().to(u,e,i)})}onUpdate(e,i,n){}}const convertDomainToTickData=r=>r.map((e,i)=>({index:i,value:e})),labelOverlap=(r,e,i=0)=>{const n=new AABBBounds(r).expand(i/2),o=new AABBBounds(e).expand(i/2);return n.intersects(o)},MIN_TICK_GAP=12,calculateFlushPos=(r,e,i,n)=>i<r?Math.max(r-e/2,i):i>r?Math.min(r-e/2,i-e):i<n?i:i-e,getCartesianLabelBounds=(r,e,i)=>{var n;const{labelStyle:o,axisOrientType:l,labelFlush:u,labelFormatter:d,startAngle:f=0}=i;let g=(n=o.angle)!==null&&n!==void 0?n:0;o.direction==="vertical"&&(g+=degreeToRadian(90));const _=["bottom","top"].includes(l),y=["left","right"].includes(l);let b=1,S=0;_||(y?(b=0,S=1):f&&(b=Math.cos(f),S=-Math.sin(f)));const v=initTextMeasure$1(o),A=r.range();return e.map((T,C)=>{var E,P;const L=d?d(T):`${T}`,{width:R,height:w}=v.quickMeasure(L),D=Math.max(R,12),I=Math.max(w,12),O=r.scale(T),B=b*O,N=S*O;let $,H,F=B,V=N;u&&_&&C===0?F=calculateFlushPos(B,D,A[0],A[A.length-1]):u&&_&&C===e.length-1?F=calculateFlushPos(B,D,A[A.length-1],A[0]):$=(E=o.textAlign)!==null&&E!==void 0?E:"center",$==="right"?F-=D:$==="center"&&(F-=D/2),u&&y&&C===0?V=calculateFlushPos(N,I,A[0],A[A.length-1]):u&&y&&C===e.length-1?V=calculateFlushPos(N,I,A[A.length-1],A[0]):H=(P=o.textBaseline)!==null&&P!==void 0?P:"middle",H==="bottom"?V-=I:H==="middle"&&(V-=I/2);const G=new AABBBounds().set(F,V,F+D,V+I);return g&&G.rotate(g,B,N),G})},isAxisHorizontal=r=>["bottom","top","z"].includes(r);var ScaleEnum;(function(r){r.Identity="identity",r.Linear="linear",r.Log="log",r.Pow="pow",r.Sqrt="sqrt",r.Symlog="symlog",r.Time="time",r.Quantile="quantile",r.Quantize="quantize",r.Threshold="threshold",r.Ordinal="ordinal",r.Point="point",r.Band="band"})(ScaleEnum||(ScaleEnum={}));const EnableScaleMap={};Object.values(ScaleEnum).forEach(r=>{EnableScaleMap[r]=!0});function isContinuous(r){switch(r){case ScaleEnum.Linear:case ScaleEnum.Log:case ScaleEnum.Pow:case ScaleEnum.Sqrt:case ScaleEnum.Symlog:case ScaleEnum.Time:return!0;default:return!1}}function isValidScaleType(r){return!!EnableScaleMap[r]}function isDiscrete(r){switch(r){case ScaleEnum.Ordinal:case ScaleEnum.Point:case ScaleEnum.Band:return!0;default:return!1}}function identity(r){return r}const sqrt$1=r=>r<0?-Math.sqrt(-r):Math.sqrt(r),square=r=>r<0?-r*r:r*r,logNegative=r=>-Math.log(-r),expNegative=r=>-Math.exp(-r),pow10=r=>isFinite(r)?Math.pow(10,r):r<0?0:r,powp=r=>r===10?pow10:r===Math.E?Math.exp:e=>Math.pow(r,e),logp=r=>r===Math.E?Math.log:r===10?Math.log10:r===2?Math.log2:(r=Math.log(r),e=>Math.log(e)/r),symlog=r=>e=>Math.sign(e)*Math.log1p(Math.abs(e/r)),symexp=r=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*r;function normalize(r,e){if(r=Number(r),e=Number(e),e-=r)return n=>(n-r)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function bimap(r,e,i){const n=r[0],o=r[1],l=e[0],u=e[1];let d,f;return o<n?(d=normalize(o,n),f=i(u,l)):(d=normalize(n,o),f=i(l,u)),g=>f(d(g))}function bandSpace(r,e,i){let n;return n=r===1?r+2*i:r-e+2*i,r?n>0?n:1:0}function scaleWholeRangeSize(r,e,i,n){return i===1&&(i=0),bandSpace(r,i,n)*(e/(1-i))}function calculateBandwidthFromWholeRangeSize(r,e,i,n,o){const l=bandSpace(r,i,n);let u=e/Math.max(1,l||1);o&&(u=Math.floor(u));let d=u*(1-i);return o&&(d=Math.round(d)),d}function calculateWholeRangeFromRangeFactor(r,e){const i=(r[1]-r[0])/(e[1]-e[0]),n=r[0]-i*e[0];return[n,i+n]}function polymap(r,e,i){const n=Math.min(r.length,e.length)-1,o=new Array(n),l=new Array(n);let u=-1;for(r[n]<r[0]&&(r=r.slice().reverse(),e=e.slice().reverse());++u<n;)o[u]=normalize(r[u],r[u+1]),l[u]=i(e[u],e[u+1]);return function(d){const f=bisect(r,d,1,n)-1;return l[f](o[f](d))}}const nice=(r,e)=>{const i=r.slice();let n=0,o=i.length-1,l=i[n],u=i[o];return u<l&&([n,o]=[o,n],[l,u]=[u,l]),i[n]=e.floor(l),i[o]=e.ceil(u),i},niceNumber=(r,e=!1)=>{const i=Math.floor(Math.log10(r)),n=r/Math.pow(10,i);let o;return o=e?n<1.5?1:n<3?2:n<7?5:10:n<=1?1:n<=2?2:n<=5?5:10,o*Math.pow(10,i)},restrictNumber=(r,e)=>{let i,n;return e[0]<e[1]?(i=e[0],n=e[1]):(i=e[1],n=e[0]),Math.min(Math.max(r,i),n)};class BaseScale{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(e){return this._wholeRange?this._wholeRange:isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)&&e.length===2?(this._wholeRange=calculateWholeRangeFromRangeFactor(e,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):e}rangeFactor(e,i,n){return e?(e.length===2&&e.every(o=>o>=0&&o<=1)&&(this._wholeRange=null,e[0]===0&&e[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=e[0],this._rangeFactorEnd=e[1])),this):n?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(e,i){var n;return isNil(e)?this._rangeFactorStart:(e>=0&&e<=1&&(this._wholeRange=null,e!==0||!isNil(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=e,this._rangeFactorEnd=(n=this._rangeFactorEnd)!==null&&n!==void 0?n:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(e,i){var n;return isNil(e)?this._rangeFactorEnd:(e>=0&&e<=1&&(this._wholeRange=null,e!==0||!isNil(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=e,this._rangeFactorStart=(n=this._rangeFactorStart)!==null&&n!==void 0?n:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var e;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:i=2,radiusRatio:n=.1,radius:o}=this._fishEyeOptions,l=this.range(),u=l[0],d=l[l.length-1],f=Math.min(u,d),g=Math.max(u,d),_=clamp((e=this._fishEyeOptions.focus)!==null&&e!==void 0?e:0,f,g),y=isNil(o)?(g-f)*n:o;let b=Math.exp(i);b=b/(b-1)*y;const S=i/y;this._fishEyeTransform=v=>{const A=Math.abs(v-_);if(A>=y)return v;if(A<=1e-6)return _;const x=b*(1-Math.exp(-A*S))/A*.75+.25;return _+(v-_)*x}}unknown(e){return arguments.length?(this._unknown=e,this):this._unknown}get(e,i){var n;return(n=this==null?void 0:this[e])!==null&&n!==void 0?n:i}}const implicit=Symbol("implicit");class OrdinalScale extends BaseScale{specified(e){var i;return e?(this._specified=Object.assign((i=this._specified)!==null&&i!==void 0?i:{},e),this):Object.assign({},this._specified)}_getSpecifiedValue(e){if(this._specified)return this._specified[e]}constructor(){super(),this.type=ScaleEnum.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=implicit}clone(){const e=new OrdinalScale().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&e.specified(this._specified),e}calculateVisibleDomain(e){return isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)&&e.length===2?[this.invert(e[0]),this.invert(e[1])]:this._domain}scale(e){const i=`${e}`,n=this._getSpecifiedValue(i);if(n!==void 0)return n;let o=this._index.get(i);if(!o){if(this._unknown!==implicit)return this._unknown;o=this._domain.push(e),this._index.set(i,o)}const l=this._ordinalRange[(o-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(l):l}invert(e){let i=0;for(;i<this._ordinalRange.length&&this._ordinalRange[i]!==e;)i++;return this._domain[(i-1)%this._domain.length]}domain(e){if(!e)return this._domain.slice();this._domain=[],this._index=new Map;for(const i of e){const n=`${i}`;this._index.has(n)||this._index.set(n,this._domain.push(i))}return this}range(e){if(!e)return this._ordinalRange.slice();const i=Array.from(e);return this._ordinalRange=i,this}index(e){var i;return this._index&&(i=this._index.get(`${e}`))!==null&&i!==void 0?i:-1}}function generateTicks(r,e,i,n){const o=[];let l=r;for(;l<=e;)o.push(l),l+=i;return n&&o.reverse(),o}function ticks$1(r,e,i,n){let o,l;if(e=Math.floor(+e),r=Math.floor(+r),!(i=Math.floor(+i)))return[];if(r===e)return[r];if(o=e<r){const d=r;r=e,e=d}let u=clamper(1,e-r+1)(i);if(l=Math.floor((e-r+1)/u),!n)for(;Math.ceil((e-r+1)/l)>i&&u>1;)u-=1,l=Math.floor((e-r)/u);return generateTicks(r,e,l,o)}function stepTicks$1(r,e,i){let n;if(e=Math.floor(+e),r=Math.floor(+r),i=clamper(1,e-r+1)(Math.floor(+i)),n=e<r){const o=r;r=e,e=o}return generateTicks(r,e,i,n)}class BandScale extends OrdinalScale{constructor(e){super(),this.type=ScaleEnum.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(e)}rescale(e,i){if(e)return this;this._wholeRange=null;const n=this._calculateWholeRange(this._range,i),o=super.domain().length,l=n[1]<n[0];let u=n[Number(l)-0];const d=n[1-Number(l)],f=bandSpace(o,this._paddingInner,this._paddingOuter);return this._step=(d-u)/Math.max(1,f||1),this._round&&(this._step=Math.floor(this._step)),u+=(d-u-this._step*(o-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(u=Math.round(u),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:l,start:l?u+this._step*(o-1):u,count:o},this.generateFishEyeTransform(),this}scale(e){if(!this._bandRangeState)return;const i=`${e}`,n=this._getSpecifiedValue(i);if(n!==void 0)return n;let o=this._index.get(i);if(!o){if(this._unknown!==implicit)return this._unknown;o=this._domain.push(e),this._index.set(i,o)}const{count:l,start:u,reverse:d}=this._bandRangeState,f=u+(d?-1:1)*((o-1)%l)*this._step;return this._fishEyeTransform?this._fishEyeTransform(f):f}_calculateWholeRange(e,i){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let n;if(isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)&&e.length===2){const l=calculateWholeRangeFromRangeFactor(e,[this._rangeFactorStart,this._rangeFactorEnd]);n=Math.abs(l[1]-l[0])}else n=Math.abs(e[1]-e[0]);const o=calculateBandwidthFromWholeRangeSize(super.domain().length,n,this._paddingInner,this._paddingOuter,this._round);o<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):o>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=o,this._isFixed=!1)}if(this.isBandwidthFixed()){const n=scaleWholeRangeSize(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(e[1]-e[0]),o=Math.min((e[1]-e[0])/n,1);if(isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)){const l=this._rangeFactorStart+o<=1,u=this._rangeFactorEnd-o>=0;if(i==="rangeFactorStart"&&l?this._rangeFactorEnd=this._rangeFactorStart+o:i==="rangeFactorEnd"&&u?this._rangeFactorStart=this._rangeFactorEnd-o:e[0]<=e[1]?l?this._rangeFactorEnd=this._rangeFactorStart+o:u?this._rangeFactorStart=this._rangeFactorEnd-o:(this._rangeFactorStart=0,this._rangeFactorEnd=o):u?this._rangeFactorStart=this._rangeFactorEnd-o:l?this._rangeFactorEnd=this._rangeFactorStart+o:(this._rangeFactorStart=1-o,this._rangeFactorEnd=1),n>0){const d=e[0]-n*this._rangeFactorStart,f=d+n;this._wholeRange=[d,f]}else{const d=e[1]+n*(1-this._rangeFactorEnd),f=d-n;this._wholeRange=[f,d]}}else this._rangeFactorStart=0,this._rangeFactorEnd=o,this._wholeRange=[e[0],e[0]+n];return this._wholeRange}return super._calculateWholeRange(e)}calculateWholeRangeSize(){const e=this._calculateWholeRange(this._range);return Math.abs(e[1]-e[0])}calculateVisibleDomain(e){const i=this._domain;if(isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)&&i.length){const n=this._getInvertIndex(e[0]),o=this._getInvertIndex(e[1]);return i.slice(Math.min(n,o),Math.max(n,o)+1)}return i}domain(e,i){return e?(super.domain(e),this.rescale(i)):super.domain()}range(e,i){return e?(this._range=[toNumber(e[0]),toNumber(e[1])],this.rescale(i)):this._range}rangeRound(e,i){return this._range=[toNumber(e[0]),toNumber(e[1])],this._round=!0,this.rescale(i)}ticks(e=10){const i=this.calculateVisibleDomain(this._range);return e===-1?i:ticks$1(0,i.length-1,e,!1).map(n=>i[n])}tickData(e=10){return this.ticks(e).map((i,n)=>({index:n,tick:i,value:(this.scale(i)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])}))}forceTicks(e=10){const i=this.calculateVisibleDomain(this._range);return ticks$1(0,i.length-1,e,!0).filter(n=>n<i.length).map(n=>i[n])}stepTicks(e){const i=this.calculateVisibleDomain(this._range);return stepTicks$1(0,i.length-1,e).map(n=>i[n])}_getInvertIndex(e){let i=0;const n=this.step()/2,o=this.bandwidth()/2,l=this._domain.length,u=this.range(),d=u[0]>u[u.length-1];for(i=0;i<l;i++){const f=this.scale(this._domain[i])+o;if(i===0&&(!d&&!isGreater(e,f+n)||d&&!isLess(e,f-n))||i===l-1||!isLess(e,f-n)&&!isGreater(e,f+n))break}return i>=0&&i<=l-1?i:l-1}invert(e){return this._domain[this._getInvertIndex(e)]}padding(e,i){return e!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(e)?Math.min.apply(null,e):e)),this._paddingInner=this._paddingOuter,this.rescale(i)):this._paddingInner}paddingInner(e,i){return e!==void 0?(this._paddingInner=Math.max(0,Math.min(1,e)),this.rescale(i)):this._paddingInner}paddingOuter(e,i){return e!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,e)),this.rescale(i)):this._paddingOuter}step(){return this._step}round(e,i){return e!==void 0?(this._round=e,this.rescale(i)):this._round}align(e,i){return e!==void 0?(this._align=Math.max(0,Math.min(1,e)),this.rescale(i)):this._align}rangeFactor(e,i){return e?(super.rangeFactor(e),this.rescale(i)):super.rangeFactor()}rangeFactorStart(e,i){return isNil(e)?super.rangeFactorStart():(super.rangeFactorStart(e),this.rescale(i,"rangeFactorStart"))}rangeFactorEnd(e,i){return isNil(e)?super.rangeFactorEnd():(super.rangeFactorEnd(e),this.rescale(i,"rangeFactorEnd"))}bandwidth(e,i){return e?(e==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=e,this._isFixed=!0),this._userBandwidth=e,this.rescale(i)):this._bandwidth}maxBandwidth(e,i){return e?(this._maxBandwidth=e==="auto"?void 0:e,this.rescale(i)):this._maxBandwidth}minBandwidth(e,i){return e?(this._minBandwidth=e==="auto"?void 0:e,this.rescale(i)):this._minBandwidth}fishEye(e,i,n){return e||n?(this._fishEyeOptions=e,this._fishEyeTransform=null,this.rescale(i)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&isNumber(this._userBandwidth)}clone(){var e,i,n;return new BandScale(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((e=this._userBandwidth)!==null&&e!==void 0?e:"auto",!0).maxBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto",!0).minBandwidth((n=this._maxBandwidth)!==null&&n!==void 0?n:"auto")}}const{interpolateRgb}=ColorUtil;function interpolate(r,e){const i=typeof e;let n;if(isNil(e)||i==="boolean")return()=>e;if(i==="number")return interpolateNumber(r,e);if(i==="string"){if(n=Color.parseColorString(e)){const o=interpolateRgb(Color.parseColorString(r),n);return l=>o(l).formatRgb()}return interpolateNumber(Number(r),Number(e))}return e instanceof RGB?interpolateRgb(r,e):e instanceof Color?interpolateRgb(r.color,e.color):e instanceof Date?interpolateDate(r,e):interpolateNumber(Number(r),Number(e))}class ContinuousScale extends BaseScale{constructor(e=identity,i=identity){super(),this._unknown=void 0,this.transformer=e,this.untransformer=i,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=identity,this._piecewise=bimap,this._interpolate=interpolate}calculateVisibleDomain(e){var i;return isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)&&e.length===2?[this.invert(e[0]),this.invert(e[1])]:(i=this._niceDomain)!==null&&i!==void 0?i:this._domain}fishEye(e,i,n){return e||n?(this._fishEyeOptions=e,this._fishEyeTransform=null,this.rescale(i)):this._fishEyeOptions}scale(e){var i;if(e=Number(e),Number.isNaN(e)||this._domainValidator&&!this._domainValidator(e))return this._unknown;this._output||(this._output=this._piecewise(((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const n=this._output(this.transformer(this._clamp(e)));return this._fishEyeTransform?this._fishEyeTransform(n):n}invert(e){var i;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).map(this.transformer),interpolateNumber)),this._clamp(this.untransformer(this._input(e)))}domain(e,i){var n;if(!e)return((n=this._niceDomain)!==null&&n!==void 0?n:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const o=Array.from(e,toNumber);return this._domain=o,this.rescale(i)}range(e,i){if(!e)return this._range.slice();const n=Array.from(e);return this._range=n,this.rescale(i)}rangeRound(e,i){const n=Array.from(e);return this._range=n,this._interpolate=interpolateNumberRound,this.rescale(i)}rescale(e){var i;if(e)return this;const n=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,o=n.length,l=this._range.length;let u=Math.min(o,l);if(o&&o<l&&this._forceAlign){const d=l-o+1,f=n[o-1],g=o>=2?(f-n[o-2])/d:0;for(let _=1;_<=d;_++)n[o-2+_]=f-g*(d-_);u=l}return this._autoClamp&&(this._clamp=clamper(n[0],n[u-1])),this._piecewise=u>2?polymap:bimap,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(e,i,n){return arguments.length?(i?(this._autoClamp=!1,this._clamp=i):(this._autoClamp=!!e,this._clamp=e?void 0:identity),this.rescale(n)):this._clamp!==identity}interpolate(e,i){return arguments.length?(this._interpolate=e,this.rescale(i)):this._interpolate}ticks(e=10){return[]}tickData(e=10){const i=this.ticks(e);return(i??[]).map((n,o)=>({index:o,tick:n,value:(this.scale(n)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(e,i){return e?(super.rangeFactor(e),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(e,i){return isNil(e)?super.rangeFactorStart():(super.rangeFactorStart(e),this._output=this._input=null,this)}rangeFactorEnd(e,i){return isNil(e)?super.rangeFactorEnd():(super.rangeFactorEnd(e),this._output=this._input=null,this)}forceAlignDomainRange(e){return arguments.length?(this._forceAlign=e,this):this._forceAlign}}const e10$1=Math.sqrt(50),e5$1=Math.sqrt(10),e2$1=Math.sqrt(2),niceNumbers=[1,2,5,10],calculateTicksOfSingleValue=(r,e,i)=>{let n=1,o=r;const l=Math.floor((e-1)/2),u=Math.abs(r);return r>=0&&r<=Number.MIN_VALUE?o=0:r<0&&r>=-Number.MIN_VALUE?o=-(e-1):!i&&u<1?n=getNickStep(u).step:(i||u>1)&&(o=Math.floor(r)-l*n),n>0?(r>0?o=Math.max(o,0):r<0&&(o=Math.min(o,-(e-1)*n)),range(0,e).map(d=>o+d*n)):r>0?calculateTicksByStep(0,-(e-1)/n,n):calculateTicksByStep((e-1)/n,0,n)},d3Ticks=memoize((r,e,i,n)=>{let o,l,u,d,f=-1;if(i=+i,(r=+r)==(e=+e))return[r];if(Math.abs(r-e)<=Number.MIN_VALUE&&i>0)return[r];if((o=e<r)&&(l=r,r=e,e=l),d=tickIncrement(r,e,i).step,!isFinite(d))return[];if(d>0){let g=Math.round(r/d),_=Math.round(e/d);for(g*d<r&&++g,_*d>e&&--_,u=new Array(l=_-g+1);++f<l;)u[f]=(g+f)*d}else if(d<0&&(n!=null&&n.noDecimals)){d=1;const g=Math.ceil(r),_=Math.floor(e);if(!(g<=_))return[];for(u=new Array(l=_-g+1);++f<l;)u[f]=g+f}else{d=-d;let g=Math.round(r*d),_=Math.round(e*d);for(g/d<r&&++g,_/d>e&&--_,u=new Array(l=_-g+1);++f<l;)u[f]=(g+f)/d}return o&&u.reverse(),u}),calculateTicksByStep=(r,e,i)=>{let n,o,l=-1;if(i>0){let u=Math.floor(r/i),d=Math.ceil(e/i);for((u+1)*i<r&&++u,(d-1)*i>e&&--d,o=new Array(n=d-u+1);++l<n;)o[l]=(u+l)*i}else{i=-i;let u=Math.floor(r*i),d=Math.ceil(e*i);for((u+1)/i<r&&++u,(d-1)/i>e&&--d,o=new Array(n=d-u+1);++l<n;)o[l]=(u+l)/i}return o},appendTicksToCount=(r,e,i)=>{let n;const o=r[0],l=r[r.length-1],u=e-r.length;if(l<=0){const g=[];for(n=u;n>=1;n--)g.push(o-n*i);return g.concat(r)}if(o>=0){for(n=1;n<=u;n++)r.push(l+n*i);return r}let d=[];const f=[];for(n=1;n<=u;n++)n%2==0?d=[o-Math.floor(n/2)*i].concat(d):f.push(l+Math.ceil(n/2)*i);return d.concat(r).concat(f)},ticks=memoize((r,e,i,n)=>{let o,l,u;if(i=+i,(r=+r)==(e=+e)||Math.abs(r-e)<=Number.MIN_VALUE&&i>0)return calculateTicksOfSingleValue(r,i,n==null?void 0:n.noDecimals);(o=e<r)&&(u=r,r=e,e=u);const d=tickIncrement(r,e,i);let f=d.step;if(!isFinite(f))return[];if(f>0){let g=1;const{power:_,gap:y}=d,b=y===10?2*10**_:1*10**_;for(;g<=5&&(l=calculateTicksByStep(r,e,f),l.length>i+1)&&i>2;)f+=b,g+=1;i>2&&l.length<i-1&&(l=appendTicksToCount(l,i,f))}else n!=null&&n.noDecimals&&f<0&&(f=1),l=calculateTicksByStep(r,e,f);return o&&l.reverse(),l}),getNickStep=r=>{const e=Math.floor(Math.log(r)/Math.LN10),i=r/10**e;let n=niceNumbers[0];return i>=e10$1?n=niceNumbers[3]:i>=e5$1?n=niceNumbers[2]:i>=e2$1&&(n=niceNumbers[1]),e>=0?{step:n*10**e,gap:n,power:e}:{step:-(10**-e)/n,gap:n,power:e}};function tickIncrement(r,e,i){const n=(e-r)/Math.max(0,i);return getNickStep(n)}function forceTicks(r,e,i){let n;if(i=+i,(r=+r)==(e=+e)&&i>0)return[r];if(i<=0||(n=forceTickIncrement(r,e,i))===0||!isFinite(n))return[];const o=new Array(i);for(let l=0;l<i;l++)o[l]=r+l*n;return o}function forceTickIncrement(r,e,i){return(e-r)/Math.max(1,i-1)}function stepTicks(r,e,i){let n,o,l=-1;if(i=+i,(o=(e=+e)<(r=+r))&&(n=r,r=e,e=n),!isFinite(i)||e-r<=i)return[r];const u=Math.floor((e-r)/i+1),d=new Array(u);for(;++l<u;)d[l]=r+l*i;return o&&d.reverse(),d}function niceLinear(r,e=10){let i,n,o=0,l=r.length-1,u=r[o],d=r[l],f=10;for(d<u&&(n=u,u=d,d=n,n=o,o=l,l=n);f-- >0;){if(n=tickIncrement(u,d,e).step,n===i)return r[o]=u,r[l]=d,r;if(n>0)u=Math.floor(u/n)*n,d=Math.ceil(d/n)*n;else{if(!(n<0))break;u=Math.ceil(u*n)/n,d=Math.floor(d*n)/n}i=n}}function parseNiceOptions(r,e){const i=isNumber(e.forceMin),n=isNumber(e.forceMax);let o=null;const l=[];let u=null;const d=i&&n?f=>f>=e.forceMin&&f<=e.forceMax:i?f=>f>=e.forceMin:n?f=>f<=e.forceMax:null;return i?l[0]=e.forceMin:isNumber(e.min)&&e.min<=Math.min(r[0],r[r.length-1])&&(l[0]=e.min),n?l[1]=e.forceMax:isNumber(e.max)&&e.max>=Math.max(r[0],r[r.length-1])&&(l[1]=e.max),isNumber(l[0])&&isNumber(l[1])?(u=r.slice(),u[0]=l[0],u[u.length-1]=l[1]):o=isNumber(l[0])||isNumber(l[1])?isNumber(l[0])?"max":"min":"all",{niceType:o,niceDomain:u,niceMinMax:l,domainValidator:d}}const fixPrecision=(r,e,i)=>Math.abs(e-r)<1?+i.toFixed(1):Math.round(+i),d3TicksForLog=memoize((r,e,i,n,o,l,u)=>{let d=r,f=e;const g=f<d;g&&([d,f]=[f,d]);let _,y,b=o(d),S=o(f),v=[];if(!(n%1)&&S-b<i){if(b=Math.floor(b),S=Math.ceil(S),d>0){for(;b<=S;++b)for(_=1;_<n;++_)if(y=b<0?_/l(-b):_*l(b),!(y<d)){if(y>f)break;v.push(y)}}else for(;b<=S;++b)for(_=n-1;_>=1;--_)if(y=b>0?_/l(-b):_*l(b),!(y<d)){if(y>f)break;v.push(y)}2*v.length<i&&(v=ticks(d,f,i))}else v=ticks(b,S,Math.min(S-b,i)).map(l);return v=v.filter(A=>A!==0),u!=null&&u.noDecimals&&(v=Array.from(new Set(v.map(A=>Math.floor(A))))),g?v.reverse():v}),ticksBaseTransform=memoize((r,e,i,n,o,l)=>{const u=[],d={},f=o(r),g=o(e);let _=[];if(Number.isInteger(n))_=ticks(f,g,i);else{const y=(g-f)/(i-1);for(let b=0;b<i;b++)_.push(f+b*y)}return _.forEach(y=>{const b=l(y),S=Number.isInteger(n)?fixPrecision(r,e,b):fixPrecision(r,e,niceNumber(b)),v=fixPrecision(r,e,restrictNumber(S,[r,e]));!d[v]&&!isNaN(v)&&_.length>1&&(d[v]=1,u.push(v))}),u}),forceTicksBaseTransform=memoize((r,e,i,n,o)=>forceTicks(n(r),n(e),i).map(l=>niceNumber(o(l))));class LinearScale extends ContinuousScale{constructor(){super(...arguments),this.type=ScaleEnum.Linear}clone(){return new LinearScale().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(e=10,i){const n=this.calculateVisibleDomain(this._range);return d3Ticks(n[0],n[n.length-1],e,i)}ticks(e=10,i){var n;if(isFunction(i==null?void 0:i.customTicks))return i.customTicks(this,e);if(isValid(this._rangeFactorStart)&&isValid(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(e,i);const o=(n=this._niceDomain)!==null&&n!==void 0?n:this._domain,l=this._domain,u=o[0],d=o[o.length-1];let f=ticks(l[0],l[l.length-1],e,i);if(!f.length)return f;if(this._domainValidator)f=f.filter(this._domainValidator);else if((f[0]!==u||f[f.length-1]!==d)&&this._niceType){const g=o.slice();if(this._niceType==="all"?(g[0]=f[0],g[g.length-1]=f[f.length-1],this._niceDomain=g,this.rescale()):this._niceType==="min"&&f[0]!==u?(g[0]=f[0],this._niceDomain=g,this.rescale()):this._niceType==="max"&&f[f.length-1]!==d&&(g[g.length-1]=f[f.length-1],this._niceDomain=g,this.rescale()),this._niceType!=="all"){const _=Math.min(g[0],g[g.length-1]),y=Math.max(g[0],g[g.length-1]);f=f.filter(b=>b>=_&&b<=y)}}return f}forceTicks(e=10){const i=this.calculateVisibleDomain(this._range);return forceTicks(i[0],i[i.length-1],e)}stepTicks(e){const i=this.calculateVisibleDomain(this._range);return stepTicks(i[0],i[i.length-1],e)}nice(e=10,i){var n,o;const l=this._domain;let u=[];if(i){const d=parseNiceOptions(l,i);if(u=d.niceMinMax,this._domainValidator=d.domainValidator,this._niceType=d.niceType,d.niceDomain)return this._niceDomain=d.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const d=niceLinear(l.slice(),e);this._niceType==="min"?d[d.length-1]=(n=u[1])!==null&&n!==void 0?n:d[d.length-1]:this._niceType==="max"&&(d[0]=(o=u[0])!==null&&o!==void 0?o:d[0]),this._niceDomain=d,this.rescale()}return this}niceMin(e=10){this._niceType="min";const i=this._domain[this._domain.length-1],n=niceLinear(this.domain(),e);return n&&(n[n.length-1]=i,this._niceDomain=n,this.rescale()),this}niceMax(e=10){this._niceType="max";const i=this._domain[0],n=niceLinear(this._domain.slice(),e);return n&&(n[0]=i,this._niceDomain=n,this.rescale()),this}}class LogNiceMixin{nice(e=10,i){var n,o,l,u;const d=this._domain;let f=[],g=null;if(i){const _=parseNiceOptions(d,i);if(f=_.niceMinMax,this._domainValidator=_.domainValidator,g=_.niceType,_.niceDomain)return this._niceDomain=_.niceDomain,this.rescale(),this}else g="all";if(g){const _=nice(d.slice(),(o=(n=this.getNiceConfig)===null||n===void 0?void 0:n.call(this))!==null&&o!==void 0?o:{floor:y=>Math.floor(y),ceil:y=>Math.ceil(y)});return g==="min"?_[_.length-1]=(l=f[1])!==null&&l!==void 0?l:_[_.length-1]:g==="max"&&(_[0]=(u=f[0])!==null&&u!==void 0?u:_[0]),this._niceDomain=_,this.rescale(),this}return this}niceMin(){const e=this._domain[this._domain.length-1];this.nice();const i=this._domain.slice();return this._domain&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(){const e=this._domain[0];this.nice();const i=this._domain.slice();return this._domain&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}function reflect(r){return e=>-r(-e)}function limitPositiveZero(r=Number.EPSILON){return e=>Math.max(e,r)}function limitNegativeZero(r=Number.EPSILON){return e=>Math.min(e,-r)}class LogScale extends ContinuousScale{constructor(){super(logp(10),powp(10)),this.type=ScaleEnum.Log,this._limit=limitPositiveZero(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new LogScale().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(e){var i;if(e)return this;super.rescale();const n=logp(this._base),o=powp(this._base);return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain)[0]<0?(this._logs=reflect(n),this._pows=reflect(o),this._limit=limitNegativeZero(),this.transformer=logNegative,this.untransformer=expNegative):(this._logs=n,this._pows=o,this._limit=limitPositiveZero(),this.transformer=this._logs,this.untransformer=o),this}scale(e){var i;if(e=Number(e),Number.isNaN(e)||this._domainValidator&&!this._domainValidator(e))return this._unknown;this._output||(this._output=this._piecewise(((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const n=this._output(this.transformer(this._limit(this._clamp(e))));return this._fishEyeTransform?this._fishEyeTransform(n):n}base(e,i){return arguments.length?(this._base=e,this.rescale(i)):this._base}tickFormat(){return identity}d3Ticks(e=10,i){const n=this.domain(),o=this._limit(n[0]),l=this._limit(n[n.length-1]);return d3TicksForLog(o,l,e,this._base,this.transformer,this.untransformer,i)}ticks(e=10){const i=this.calculateVisibleDomain(this._range);return ticksBaseTransform(this._limit(i[0]),this._limit(i[i.length-1]),e,this._base,this.transformer,this.untransformer)}forceTicks(e=10){const i=this.calculateVisibleDomain(this._range);return forceTicksBaseTransform(i[0],i[i.length-1],e,this.transformer,this.untransformer)}stepTicks(e){const i=this.calculateVisibleDomain(this._range);return forceTicksBaseTransform(this._limit(i[0]),this._limit(i[i.length-1]),e,this.transformer,this.untransformer)}getNiceConfig(){return{floor:e=>this._pows(Math.floor(this._logs(this._limit(e)))),ceil:e=>Math.abs(e)>=1?Math.ceil(e):this._pows(Math.ceil(this._logs(this._limit(e))))}}}mixin(LogScale,LogNiceMixin);class PointScale extends BandScale{constructor(e){super(!1),this.type=ScaleEnum.Point,this._padding=0,this.paddingInner(1,e),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}}class SqrtScale extends LinearScale{constructor(){super(sqrt$1,square),this.type=ScaleEnum.Sqrt}clone(){return new SqrtScale().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}}class SymlogScale extends LinearScale{constructor(){super(symlog(1),symexp(1)),this.type=ScaleEnum.Symlog,this._const=1}clone(){return new SymlogScale().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(e,i){return arguments.length?(this._const=e,this.transformer=symlog(e),this.untransformer=symexp(e),this.rescale(i)):this._const}d3Ticks(e=10,i){const n=this.domain(),o=n[0],l=n[n.length-1];return d3TicksForLog(o,l,e,this._const,this.transformer,this.untransformer,i)}ticks(e=10){const i=this.calculateVisibleDomain(this._range);return ticksBaseTransform(i[0],i[i.length-1],e,this._const,this.transformer,this.untransformer)}forceTicks(e=10){const i=this.calculateVisibleDomain(this._range);return forceTicksBaseTransform(i[0],i[i.length-1],e,this.transformer,this.untransformer)}stepTicks(e){const i=this.calculateVisibleDomain(this._range);return forceTicksBaseTransform(i[0],i[i.length-1],e,this.transformer,this.untransformer)}}mixin(SymlogScale,LogNiceMixin);class ThresholdScale{constructor(){this.type=ScaleEnum.Threshold,this._range=[0,1],this._domain=[.5],this.n=1}unknown(e){return arguments.length?(this._unknown=e,this):this._unknown}scale(e){return!isNil(e)&&isValidNumber(+e)?this._range[bisect(this._domain,e,0,this.n)]:this._unknown}invertExtent(e){const i=this._range.indexOf(e);return[this._domain[i-1],this._domain[i]]}domain(e){return e?(this._domain=Array.from(e),this.n=Math.min(this._domain.length,this._range.length-1),this):this._domain.slice()}range(e){return e?(this._range=Array.from(e),this.n=Math.min(this._domain.length,this._range.length-1),this):this._range.slice()}clone(){return new ThresholdScale().domain(this._domain).range(this._range).unknown(this._unknown)}}function getScaleTicks(r,e,i,n){let o;const{breakData:l}=r;if(l&&l()){const{breakDomains:u}=l(),d=e.domain();o=[];for(let f=0;f<d.length-1;f++)n(i,[d[f],d[f+1]]).forEach(g=>{u.some(_=>g>=_[0]&&g<=_[1])||o.push(g)});e.domain(d)}else o=n(i);return o}function forceItemVisible(r,e,i,n,o=!1){if(i&&!e.includes(r)){let l=e.length;if(l>1){o?e.push(r):e.unshift(r);for(let u=0;u<l;u++){const d=o?l-1-u:u;if(!n(e[d]))break;e.splice(d,1),u--,l--}}}}const continuousTicks=(r,e)=>{var i,n;if(!isContinuous(r.type))return convertDomainToTickData(r.domain());const o=r.range(),l=Math.abs(o[o.length-1]-o[0]);if(l<2)return convertDomainToTickData([r.domain()[0]]);const{tickCount:u,forceTickCount:d,tickStep:f,noDecimals:g=!1,labelStyle:_,breakData:y}=e;let b;if(isValid(f))S=r.stepTicks(f),v=y&&y()?y().breakDomains:null,b=v&&v.length?S.filter(x=>v.every(T=>x<T[0]||x>T[1])):S;else if(isValid(d))b=getScaleTicks(e,r,d,(x,T)=>T&&T.length?r.domain(T,!0).forceTicks(x):r.forceTicks(x));else if(e.tickMode==="d3"){const x=(i=isFunction(u)?u({axisLength:l,labelStyle:_}):u)!==null&&i!==void 0?i:5;b=getScaleTicks(e,r,x,(T,C)=>C&&C.length?r.domain(C,!0).d3Ticks(T,{noDecimals:g}):r.d3Ticks(T,{noDecimals:g}))}else{const x=(n=isFunction(u)?u({axisLength:l,labelStyle:_}):u)!==null&&n!==void 0?n:5,T=isFunction(e.tickMode)?e.tickMode:void 0;b=getScaleTicks(e,r,x,(C,E)=>E&&E.length?r.domain(E,!0).ticks(C,{noDecimals:g,customTicks:T}):r.ticks(C,{noDecimals:g,customTicks:T}))}var S,v;const A=r.domain();if(e.labelFirstVisible&&A[0]!==b[0]&&!b.includes(A[0])&&b.unshift(A[0]),e.labelLastVisible&&A[A.length-1]!==b[b.length-1]&&!b.includes(A[A.length-1])&&b.push(A[A.length-1]),e.sampling&&b.length>1&&(e.coordinateType==="cartesian"||e.coordinateType==="polar"&&e.axisOrientType==="radius")){const{labelGap:x=4,labelFlush:T}=e,C=6;let E;if(b.length*C>l){const O=[],B=Math.floor(b.length*C/l);b.forEach((N,$)=>{$%B!=0&&$!==b.length-1||O.push(N)}),E=getCartesianLabelBounds(r,O,e).map((N,$)=>({AABBBounds:N,value:O[$]}))}else E=getCartesianLabelBounds(r,b,e).map((O,B)=>({AABBBounds:O,value:b[B]}));const P=E[0],L=last(E),R=y&&y()?methods$1.greedy:methods$1.parity;for(;E.length>=3&&hasOverlap$1(E,x);)E=R(E,x);const w=e.labelFirstVisible;let D=e.labelLastVisible;textIntersect(P,L,x)&&E.includes(L)&&E.length>1&&w&&D&&(E.splice(E.indexOf(L),1),D=!1),forceItemVisible(P,E,w,O=>textIntersect(O,P,x)),forceItemVisible(L,E,D,O=>textIntersect(O,L,x)||!(!w||O===P)&&textIntersect(O,P,x),!0);const I=E.map(O=>O.value);I.length<3&&T&&(I.length>1&&I.pop(),last(I)!==last(b)&&I.push(last(b))),b=I}return convertDomainToTickData(b)},methods$1={parity:function(r){return r.filter((e,i)=>i%2==0)},greedy:function(r,e){let i;return r.filter((n,o)=>(!o||!textIntersect(i,n,e))&&(i=n,!0))}},getOneDimensionalLabelBounds=(r,e,i,n)=>getCartesianLabelBounds(r,e,i).map(o=>n?[o.x1,o.x2,o.width()]:[o.y1,o.y2,o.height()]),boundsOverlap=(r,e,i=0)=>Math.max(r[0],e[0])-i/2<=Math.min(r[1],e[1])+i/2,boundsDistance=(r,e)=>r[1]<e[0]?e[0]-r[1]:e[1]<r[0]?r[0]-e[1]:0,linearDiscreteTicks=(r,e)=>{var i;const n=r.domain();if(!n.length)return[];const{tickCount:o,forceTickCount:l,tickStep:u,labelGap:d=4,axisOrientType:f,labelStyle:g}=e,_=isAxisHorizontal(f),y=r.range(),b=r.calculateWholeRangeSize();if(b<2)return e.labelLastVisible?convertDomainToTickData([n[n.length-1]]):convertDomainToTickData([n[0]]);let S;if(isValid(u))S=r.stepTicks(u);else if(isValid(l))S=r.forceTicks(l);else if(isValid(o)){const v=isFunction(o)?o({axisLength:b,labelStyle:g}):o;S=r.ticks(v)}else if(e.sampling){const v=((i=e.labelStyle.fontSize)!==null&&i!==void 0?i:12)+2,A=minInArray(y),x=maxInArray(y);if(n.length<=b/v){const T=(x-A)/n.length,C=getOneDimensionalLabelBounds(r,n,e,_),E=Math.min(...C.map(L=>L[2])),P=getStep$1(n,C,d,e.labelLastVisible,Math.floor(E/T));S=r.stepTicks(P.step),e.labelLastVisible&&(P.delCount&&(S=S.slice(0,S.length-P.delCount)),S.push(n[n.length-1]))}else{const T=[n[0],n[Math.floor(n.length/2)],n[n.length-1]],C=getOneDimensionalLabelBounds(r,T,e,_);let E=null;C.forEach(L=>{E?E[2]<L[2]&&(E=L):E=L});const P=x-A-d>0?Math.ceil(n.length*(d+E[2])/(x-A-d)):n.length-1;S=r.stepTicks(P),!e.labelLastVisible||S.length&&S[S.length-1]===n[n.length-1]||(S.length&&Math.abs(r.scale(S[S.length-1])-r.scale(n[n.length-1]))<E[2]&&(S=S.slice(0,-1)),S.push(n[n.length-1]))}}else S=r.domain();return convertDomainToTickData(S)},getStep$1=(r,e,i,n,o,l)=>{let u=0,d=0,f=-1,g=Number.MAX_VALUE;const _=S=>{let v=!0,A=0;do A+S<r.length&&boundsOverlap(e[A],e[A+S],i)&&(v=!1),A+=S;while(v&&A<r.length);return v},y=binaryFuzzySearchInNumberRange(o,r.length,S=>_(S)?1:-1);let b=y;do if(b>y&&!_(b))b++;else{if(!n){d=b;break}{const S=r.length-1;let v,A=0;v=r.length%b>0?r.length-r.length%b+b:r.length;do{if(v-=b,v!==S&&!boundsOverlap(e[v],e[S],i))break;A++}while(v>0);if(v===S){d=b,u=A;break}{const x=Math.floor(r.length/b)-A+1;if(x<f)break;{f=x;const T=boundsDistance(e[v],e[S]),C=v-b>=0?boundsDistance(e[v-b],e[v]):T,E=Math.abs(T-C);if(E<g&&(g=E,d=b,u=A),T<=C)break}}}b++}while(b<=r.length);return{step:d,delCount:u}},getPolarAngleLabelBounds=(r,e,i)=>{var n;const{labelStyle:o,getRadius:l,labelOffset:u,labelFormatter:d,inside:f}=i,g=l==null?void 0:l(),_=(n=o.angle)!==null&&n!==void 0?n:0,y=initTextMeasure$1(o);return e.map(b=>{const S=d?d(b):`${b}`,{width:v,height:A}=y.quickMeasure(S),x=Math.max(v,MIN_TICK_GAP),T=Math.max(A,MIN_TICK_GAP),C=r.scale(b),E={x:0,y:0};let P=0,L=0;const R={align:o.textAlign,baseline:o.textBaseline},{x:w,y:D}=getPolarAngleLabelPosition(C,E,g,u,f);return R.align||(isNumberClose(w,E.x)?R.baseline||(R.baseline=D>E.y?"top":"bottom"):w>E.x?R.align="left":w<E.x&&(R.align="right")),P=w+(R.align==="right"?-x:R.align==="left"?0:-x/2),L=D+(R.baseline==="bottom"?-T:R.baseline==="top"?0:-T/2),new AABBBounds().set(P,L,P+x,L+T).rotate(_,P+x/2,L+T/2)})},polarAngleAxisDiscreteTicks=(r,e)=>{const{tickCount:i,forceTickCount:n,tickStep:o,getRadius:l,labelOffset:u,labelGap:d=0,labelStyle:f}=e,g=l==null?void 0:l();if(!g)return convertDomainToTickData(r.domain());let _;if(isValid(o))_=r.stepTicks(o);else if(isValid(n))_=r.forceTicks(n);else if(isValid(i)){const y=r.range(),b=Math.abs(y[y.length-1]-y[0]),S=isFunction(i)?i({axisLength:b,labelStyle:f}):i;_=r.ticks(S)}else if(e.sampling){const y=r.domain(),b=r.range(),S=getPolarAngleLabelBounds(r,y,e),v=minInArray(b),A=maxInArray(b),x=Math.abs(A-v)*(g+u)/y.length,{step:T,delCount:C}=getStep(y,S,d,Math.floor(S.reduce((E,P)=>Math.min(E,P.width(),P.height()),Number.MAX_VALUE)/x));_=r.stepTicks(T),_=_.slice(0,_.length-C)}else _=r.domain();return convertDomainToTickData(_)},getStep=(r,e,i,n)=>{let o=n;do{let u=!0;o++;let d=0;do d+o<r.length&&labelOverlap(e[d],e[d+o],i)&&(u=!1),d+=o;while(u&&d<r.length);if(u)break}while(o<=r.length);let l=0;if(r.length>2){let u=r.length-r.length%o;for(u>=r.length&&(u-=o);u>0&&labelOverlap(e[0],e[u]);)l++,u-=o}return{step:o,delCount:l}},RIGHT0=new Uint32Array(33),RIGHT1=new Uint32Array(33);RIGHT1[0]=0,RIGHT0[0]=~RIGHT1[0];for(let r=1;r<=32;++r)RIGHT1[r]=RIGHT1[r-1]<<1|1,RIGHT0[r]=~RIGHT1[r];function bitmap(r,e){const i=new Uint32Array(~~((r*e+32)/32));function n(l,u){i[l]|=u}function o(l,u){i[l]&=u}return{array:i,get:(l,u)=>{const d=u*r+l;return i[d>>>5]&1<<(31&d)},set:(l,u)=>{const d=u*r+l;n(d>>>5,1<<(31&d))},clear:(l,u)=>{const d=u*r+l;o(d>>>5,~(1<<(31&d)))},getRange:({x1:l,y1:u,x2:d,y2:f})=>{if(d<0||f<0||l>r||u>e)return!0;let g,_,y,b,S=f;for(;S>=u;--S)if(g=S*r+l,_=S*r+d,y=g>>>5,b=_>>>5,y===b){if(i[y]&RIGHT0[31&g]&RIGHT1[1+(31&_)])return!0}else{if(i[y]&RIGHT0[31&g]||i[b]&RIGHT1[1+(31&_)])return!0;for(let v=y+1;v<b;++v)if(i[v])return!0}return!1},setRange:({x1:l,y1:u,x2:d,y2:f})=>{if(d<0||f<0||l>r||u>e)return;let g,_,y,b,S;for(;u<=f;++u)if(g=u*r+l,_=u*r+d,y=g>>>5,b=_>>>5,y===b)n(y,RIGHT0[31&g]&RIGHT1[1+(31&_)]);else for(n(y,RIGHT0[31&g]),n(b,RIGHT1[1+(31&_)]),S=y+1;S<b;++S)n(S,4294967295)},clearRange:({x1:l,y1:u,x2:d,y2:f})=>{let g,_,y,b,S;for(;u<=f;++u)if(g=u*r+l,_=u*r+d,y=g>>>5,b=_>>>5,y===b)o(y,RIGHT1[31&g]|RIGHT0[1+(31&_)]);else for(o(y,RIGHT1[31&g]),o(b,RIGHT0[1+(31&_)]),S=y+1;S<b;++S)o(S,0)},outOfBounds:({x1:l,y1:u,x2:d,y2:f})=>l<0||u<0||f>=e||d>=r,toImageData:l=>{const u=l.createImageData(r,e),d=u.data;for(let f=0;f<e;++f)for(let g=0;g<r;++g){const _=f*r+g,y=4*_,b=i[_>>>5]&1<<(31&_);d[y+0]=255*b,d[y+1]=255*b,d[y+2]=255*b,d[y+3]=31}return u}}}function bitmapTool(r,e,i={top:0,left:0,right:0,bottom:0}){const{top:n=0,left:o=0,right:l=0,bottom:u=0}=i,d=Math.max(1,Math.sqrt(r*e/1e6)),f=~~((r+o+l+d)/d),g=~~((e+n+u+d)/d),_=y=>~~(y/d);return _.bitmap=()=>bitmap(f,g),_.x=y=>~~((y+o)/d),_.y=y=>~~((y+n)/d),_.ratio=d,_.padding=i,_.width=r,_.height=e,_}function clampRangeByBitmap(r,e){const{x1:i,x2:n,y1:o,y2:l}=e,u=clamp(i,0,r.width),d=clamp(n,0,r.width),f=clamp(o,0,r.height),g=clamp(l,0,r.height);return{x1:r.x(u),x2:r.x(d),y1:r.y(f),y2:r.y(g)}}function boundToRange(r,e,i=!1){return i?clampRangeByBitmap(r,e):{x1:r.x(e.x1),x2:r.x(e.x2),y1:r.y(e.y1),y2:r.y(e.y2)}}function canPlace(r,e,i,n=!0,o=0){let l=i;o>0&&(l={x1:i.x1-o,x2:i.x2+o,y1:i.y1-o,y2:i.y2+o}),l=boundToRange(r,l);const u=e.outOfBounds(l);return(!n||!u)&&(u&&(l=clampRangeByBitmap(r,l)),!e.getRange(l))}function placeToCandidates(r,e,i,n=[],o=!0,l=0,u=!1){const d=n.filter(f=>isValid(f));for(let f=0;f<d.length;f++){let g;if(g=u?i:i.clone(),g.setAttributes(d[f]),canPlace(r,e,g.AABBBounds,o,l))return e.setRange(boundToRange(r,g.AABBBounds,!0)),d[f]}return!1}function place$2(r,e,i,n,o,l,u){var d,f;const g=(d=n.overlap)===null||d===void 0?void 0:d.clampForce,_=(f=n.overlap)===null||f===void 0?void 0:f.overlapPadding;if(i.type==="bound"||i.type==="position"){if(isFunction(u)){const y=((isFunction(i.position)?i.position(o.attribute):i.position)||defaultLabelPosition(n.type)).map(S=>u(o.AABBBounds,l,S,n.offset)),b=i.restorePosition===!1;return placeToCandidates(r,e,o,y,g,_,b)}return!1}if(i.type==="moveY"){const y=(i.offset?isFunction(i.offset)?i.offset(o.attribute):i.offset:[]).map(b=>({x:o.attribute.x,y:o.attribute.y+b}));return placeToCandidates(r,e,o,y,g,_)}if(i.type==="moveX"){const y=(i.offset?isFunction(i.offset)?i.offset(o.attribute):i.offset:[]).map(b=>({x:o.attribute.x+b,y:o.attribute.y}));return placeToCandidates(r,e,o,y,g,_)}return!1}const DefaultPositions=["top","bottom","right","left","top-right","bottom-right","top-left","bottom-left"],DefaultRectPositions=["top","inside-top","inside"];function defaultLabelPosition(r){return r==="rect"?DefaultRectPositions:DefaultPositions}function clampText(r,e,i,n={}){const{x1:o,x2:l,y1:u,y2:d}=r.AABBBounds,{top:f=0,left:g=0,right:_=0,bottom:y=0}=n,b=Math.min(o,l),S=Math.max(o,l),v=Math.min(u,d),A=Math.max(u,d),x=e+_,T=i+y;let C=0,E=0;return b<0-g?C=-b:S>x&&(C=x-S),v<0-f?E=-v:A>T&&(E=T-A),{dx:C,dy:E}}const fadeIn$1=(r={})=>{var e,i,n;return{from:{opacity:0,fillOpacity:0,strokeOpacity:0},to:{opacity:(e=r.opacity)!==null&&e!==void 0?e:1,fillOpacity:(i=r.fillOpacity)!==null&&i!==void 0?i:1,strokeOpacity:(n=r.strokeOpacity)!==null&&n!==void 0?n:1}}},fadeOut$1=(r={})=>{var e,i,n;return{from:{opacity:(e=r.opacity)!==null&&e!==void 0?e:1,fillOpacity:(i=r.fillOpacity)!==null&&i!==void 0?i:1,strokeOpacity:(n=r.strokeOpacity)!==null&&n!==void 0?n:1},to:{opacity:0,fillOpacity:0,strokeOpacity:0}}},animationEffects={fadeIn:fadeIn$1,fadeOut:fadeOut$1};function getAnimationAttributes(r,e){var i,n;return(n=(i=animationEffects[e])===null||i===void 0?void 0:i.call(animationEffects,r))!==null&&n!==void 0?n:{from:{},to:{}}}function updateAnimation(r,e,i){if(!isArray(i)){const{duration:n,easing:o,increaseEffect:l=!0}=i;return r.animate().to(e.attribute,n,o),void(l&&r.type==="text"&&e.type==="text"&&playIncreaseCount(r,e,n,o))}i.forEach(n=>{const{duration:o,easing:l,increaseEffect:u=!0,channel:d}=n,{to:f}=update$1(r,e,d,n.options);isEmpty(f)||r.animate().to(f,o,l),u&&r.type==="text"&&e.type==="text"&&playIncreaseCount(r,e,o,l)})}const update$1=(r,e,i,n)=>{const o=Object.assign({},r.attribute),l=Object.assign({},e.attribute);return array(n==null?void 0:n.excludeChannels).forEach(u=>{delete l[u]}),Object.keys(l).forEach(u=>{i&&!i.includes(u)&&delete l[u]}),{from:o,to:l}};function playIncreaseCount(r,e,i,n){r.attribute.text!==e.attribute.text&&isValidNumber(Number(r.attribute.text)*Number(e.attribute.text))&&r.animate().play(new IncreaseCount({text:r.attribute.text},{text:e.attribute.text},i,n))}const DefaultLabelAnimation={mode:"same-time",duration:300,easing:"linear"};function isQuadrantLeft(r){return r===3||r===4}function isQuadrantRight(r){return r===1||r===2}function lineCirclePoints(r,e,i,n,o,l){if(r===0&&e===0||l<=0)return[];if(r===0){const b=-i/e,S=l**2-(b-o)**2;return S<0?[]:S===0?[{x:n,y:b}]:[{x:Math.sqrt(S)+n,y:b},{x:-Math.sqrt(S)+n,y:b}]}if(e===0){const b=-i/r,S=l**2-(b-n)**2;return S<0?[]:S===0?[{x:b,y:o}]:[{x:b,y:Math.sqrt(S)+o},{x:b,y:-Math.sqrt(S)+o}]}const u=(e/r)**2+1,d=2*((i/r+n)*(e/r)-o),f=d**2-4*u*((i/r+n)**2+o**2-l**2);if(f<0)return[];const g=(-d+Math.sqrt(f))/(2*u),_=(-d-Math.sqrt(f))/(2*u),y=-(e*g+i)/r;return f===0?[{x:y,y:g}]:[{x:y,y:g},{x:-(e*_+i)/r,y:_}]}function connectLineRadian(r,e){return e>2*r?NaN:2*Math.asin(e/2/r)}function checkBoundsOverlap(r,e){const{x1:i,y1:n,x2:o,y2:l}=r,{x1:u,y1:d,x2:f,y2:g}=e;return!(i<=u&&o<=u||i>=f&&o>=f||n<=d&&l<=d||n>=g&&l>=g)}const labelingPoint=(r,e,i="top",n=0)=>{if(!r)return;const{x1:o,y1:l,x2:u,y2:d}=r,f=Math.abs(u-o),g=Math.abs(d-l),_=(e.x1+e.x2)/2,y=(e.y1+e.y2)/2;let b=0,S=0,v=0,A=0;e&&(v=Math.abs(e.x1-e.x2)/2,A=Math.abs(e.y1-e.y2)/2);const x={"top-right":-235,"top-left":235,"bottom-right":45,"bottom-left":-45};switch(i){case"top":S=-1;break;case"bottom":S=1;break;case"left":b=-1;break;case"right":b=1;break;case"bottom-left":case"bottom-right":case"top-left":case"top-right":b=Math.sin(x[i]*(Math.PI/180)),S=Math.cos(x[i]*(Math.PI/180));break;case"center":b=0,S=0}return{x:_+b*(n+v)+Math.sign(b)*(f/2),y:y+S*(n+A)+Math.sign(S)*(g/2)}},getPointsOfLineArea=r=>{if(!r||!r.attribute)return[];const{points:e,segments:i}=r.attribute;if(i&&i.length){const n=[];return i.forEach(o=>{o.points.forEach(l=>{n.push(l)})}),n}return e};function labelingLineOrArea(r,e,i="end",n=0){if(!r||!e)return{x:1/0,y:1/0};const{x1:o,x2:l}=r,u=Math.abs(l-o),d=e.x1;let f=d;return i==="end"?f=d+u/2+n:i==="start"&&(f=d-u/2-n),{x:f,y:e.y1}}function connectLineBetweenBounds(r,e){if(!r||!e||isRectIntersect(r,e,!0))return;const i=Math.min(r.x1,r.x2),n=Math.min(r.y1,r.y2),o=Math.min(e.x1,e.x2),l=Math.min(e.y1,e.y2),u=Math.abs(r.x2-i)/2,d=Math.abs(r.y2-n)/2,f=Math.abs(e.x2-o)/2,g=Math.abs(e.y2-l)/2,_=i+u,y=n+d,b=o+f,S=l+g,v=b-_,A=S-y;return[getIntersection(v,A,_,y,u,d),getIntersection(-v,-A,b,S,f,g)]}function getIntersection(r,e,i,n,o,l){return Math.abs(e/r)<l/o?{x:i+(r>0?o:-o),y:n+e*o/Math.abs(r)}:{x:i+r*l/Math.abs(e),y:n+(e>0?l:-l)}}function getAlignOffset(r){return r==="left"?0:r==="right"?1:.5}function loadLabelComponent(){registerGroup(),registerText(),registerRichtext(),registerLine()}const isIntersect=(r,e)=>Math.ceil(r)>Math.floor(e),isXIntersect=([r,e],[i,n])=>n>r&&e>i;function getIntersectionLength(r,e){const[i,n]=r,[o,l]=e,u=Math.max(i,o),d=Math.min(n,l);return Math.max(0,d-u)}function shiftY(r,e){const{maxY:i=Number.MAX_VALUE,labelling:n,globalShiftY:o={enable:!0,maxIterations:10,maxError:.1,padding:1}}=e,l=r.length;if(l<=1)return r;const u=new Map,d=new Map,f=L=>d.get(L).y1Initial,g=L=>d.get(L).height,_=L=>d.get(L).y1,y=L=>d.get(L).x,b=L=>d.get(L).x1,S=L=>d.get(L).x2,v=L=>d.get(L).attempts,A=(L,R)=>{d.get(L).y1=R},x=(L,R)=>{d.get(L).attempts=R};function T(L){for(let w=L.length-1;w>=0;w--){const D=L[w],I=L[w-1],O=L[w+1];if(I&&isIntersect(_(I)+g(I),_(D))||_(D)===0&&D._isClamped){const{y:B}=n(D);O&&isIntersect(B+g(D)/2,_(O))||B+g(D)/2<=i&&A(D,_(D)+B-(R=D,d.get(R).y))}}var R}r.sort((L,R)=>L.attribute.x-R.attribute.x);for(const L of r){const{y1:R,y2:w,x1:D,x2:I}=L.AABBBounds,{x:O,y:B}=L.attribute;d.set(L,{y1Initial:R,y1:R,y2:w,y:B,height:w-R,x1:D,x2:I,x:O,attempts:0});let N=!1;for(const[$,H]of u){const{start:F,end:V}=$;if(D>=F&&I<=V)H.push(L),N=!0;else if(isNumberClose(O,y(H[0]),void 0,5)){const G={start:Math.min(F,D),end:Math.max(V,I)};H.push(L),u.set(G,H),u.delete($),N=!0}else if(getIntersectionLength([F,V],[D,I])/(V-F)>.5){const G={start:Math.min(F,D),end:Math.max(V,I)};H.push(L),u.set(G,H),u.delete($),N=!0}if(N)break}N||u.set({start:D,end:I},[L])}for(const L of u.values())L.sort((R,w)=>f(R)-f(w)),T(L);if(o.enable!==!1){const{maxIterations:L=10,maxError:R=.1,padding:w=1,maxAttempts:D=1e3,deltaYTolerance:I=Number.MAX_VALUE}=o;for(let O=0;O<L;O++){r.sort((N,$)=>f(N)-f($));let B=0;for(let N=0;N<l-1;N++){const $=r[N];if(v($)>=D)continue;let H,F=N+1;for(;(H=r[F])&&!isXIntersect([b($),S($)],[b(H),S(H)]);)F+=1;if(H){const V=_($),G=g($),Y=_(H),J=Y-(V+G);if(J<w){const q=(w-J)/2;if(B=Math.max(B,q),V+q+g(H)>i){const te=V-(w-J),de=f($)-te;Math.abs(de)<=I&&(A($,te),x($,v($)+1))}else if(V-q<0){const te=Y+(w-J),de=f(H)-te;Math.abs(de)<=I&&(A(H,te),x(H,v(H)+1))}else{const te=V-q,de=f($)-te,he=Y+q,fe=f(H)-he;Math.abs(de)<=I&&Math.abs(fe)<=I&&(A($,te),A(H,he),x($,v($)+1),x(H,v(H)+1))}}}}if(B<R)break}}for(const L of r){const R=L.attribute.y+_(L)-f(L);L.setAttribute("y",R)}const C=[];r.sort((L,R)=>L.attribute.x-R.attribute.x);let E=0,P=r.length-1;for(;E<=P;)E===P?C.push(r[E]):(C.push(r[E]),C.push(r[P])),E++,P--;return C}var __rest$s=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};loadLabelComponent();class LabelBase extends AbstractComponent{setBitmap(e){this._bitmap=e}setBitmapTool(e){this._bmpTool=e}constructor(e,i){const{data:n}=e,o=__rest$s(e,["data"]);super(i!=null&&i.skipDefault?e:Object.assign({data:n},merge$1({},LabelBase.defaultAttributes,o))),this.name="label",this._onHover=l=>{const u=l.target;u===this._lastHover||isEmpty(u.states)||(u.addState(StateValue.hover,!0),traverseGroup(this,d=>{d===u||isEmpty(d.states)||d.addState(StateValue.hoverReverse,!0)}),this._lastHover=u)},this._onUnHover=l=>{this._lastHover&&(traverseGroup(this,u=>{isEmpty(u.states)||(u.removeState(StateValue.hoverReverse),u.removeState(StateValue.hover))}),this._lastHover=null)},this._onClick=l=>{const u=l.target;if(this._lastSelect===u&&u.hasState("selected"))return this._lastSelect=null,void traverseGroup(this,d=>{isEmpty(d.states)||(d.removeState(StateValue.selectedReverse),d.removeState(StateValue.selected))});isEmpty(u.states)||(u.addState(StateValue.selected,!0),traverseGroup(this,d=>{d===u||isEmpty(d.states)||d.addState(StateValue.selectedReverse,!0)}),this._lastSelect=u)},this._handleRelatedGraphicSetState=l=>{var u,d,f,g,_;if(((u=l.detail)===null||u===void 0?void 0:u.type)===AttributeUpdateType.STATE||((d=l.detail)===null||d===void 0?void 0:d.type)===AttributeUpdateType.ANIMATE_UPDATE&&(!((f=l.detail.animationState)===null||f===void 0)&&f.isFirstFrameOfStep)){const y=(_=(g=l.target)===null||g===void 0?void 0:g.currentStates)!==null&&_!==void 0?_:[],b=this._isCollectionBase?[...this._graphicToText.values()]:[this._graphicToText.get(l.target)];this.updateStatesOfLabels(b,y)}}}labeling(e,i,n,o){}_getLabelLinePoints(e,i){return connectLineBetweenBounds(e.AABBBounds,i==null?void 0:i.AABBBounds)}_createLabelLine(e,i){const n=this._getLabelLinePoints(e,i);if(n){const o=graphicCreator.line({points:n}),{line:l={}}=e.attribute;if(l.customShape){const u=l.customShape;o.pathProxy=d=>u({text:e,baseMark:i},d,new CustomPath2D)}return i&&i.attribute.fill&&o.setAttribute("stroke",i.attribute.fill),this.attribute.line&&!isEmpty(this.attribute.line.style)&&o.setAttributes(this.attribute.line.style),this._setStatesOfLabelLine(o),o}}render(){if(this._prepare(),isNil(this._idToGraphic)||this._isCollectionBase&&isNil(this._idToPoint))return;const{overlap:e,smartInvert:i,dataFilter:n,customLayoutFunc:o,customOverlapFunc:l}=this.attribute;let u=this.attribute.data;if(isFunction(n)&&(u=n(u)),u&&u.length){const f=new Set;u=u.filter(g=>!f.has(g.id)&&f.add(g.id))}let d=this._initText(u);d=isFunction(o)?o(u,d,this.getRelatedGraphic.bind(this),this._isCollectionBase?f=>this._idToPoint.get(f.id):null):this._layout(d),isFunction(l)?d=l(d,this.getRelatedGraphic.bind(this),this._isCollectionBase?f=>this._idToPoint.get(f.id):null):e!==!1&&(d=this._overlapping(d)),isFunction(this.attribute.onAfterOverlapping)&&this.attribute.onAfterOverlapping(d,this.getRelatedGraphic.bind(this),this._isCollectionBase?f=>this._idToPoint.get(f.id):null),d&&d.length&&d.forEach(f=>{this._bindEvent(f),this._setStatesOfText(f)}),i!==!1&&this._smartInvert(d),this._renderLabels(d)}_bindEvent(e){if(this.attribute.disableTriggerEvent||!e)return;const{hover:i,select:n}=this.attribute;i&&(e.addEventListener("pointermove",this._onHover),e.addEventListener("pointerout",this._onUnHover)),n&&e.addEventListener("pointerdown",this._onClick)}_setStatesOfText(e){if(!e)return;const i=this.attribute.state;i&&!isEmpty(i)&&(e.states=i)}_setStatesOfLabelLine(e){if(!e)return;const i=this.attribute.labelLineState;i&&!isEmpty(i)&&(e.states=i)}_createLabelText(e){var i,n;const o=Object.assign(Object.assign({},(n=(i=this.stage)===null||i===void 0?void 0:i.getTheme())===null||n===void 0?void 0:n.text),e);return createTextGraphicByType(o,"textType")}_prepare(){var e,i;const n=[];let o;if(o=isFunction(this.attribute.getBaseMarks)?this.attribute.getBaseMarks():getMarksByName(this.getRootNode(),this.attribute.baseMarkGroupName),o.forEach(u=>{u.releaseStatus!=="willRelease"&&n.push(u)}),(e=this._idToGraphic)===null||e===void 0||e.clear(),(i=this._idToPoint)===null||i===void 0||i.clear(),this._baseMarks=n,this._isCollectionBase=this.attribute.type==="line-data",!n||n.length===0)return;const{data:l}=this.attribute;if(l&&l.length!==0){if(this._idToGraphic||(this._idToGraphic=new Map),this._isCollectionBase){this._idToPoint||(this._idToPoint=new Map);let u=0;for(let d=0;d<n.length;d++){const f=n[d],g=getPointsOfLineArea(f);if(g&&g.length)for(let _=0;_<g.length;_++){const y=l[u];y&&g[_]&&(isValid(y.id)||(y.id=`vrender-component-${this.name}-${u}`),this._idToPoint.set(y.id,g[_]),this._idToGraphic.set(y.id,f)),u++}}}else for(let u=0;u<n.length;u++){const d=l[u],f=n[u];d&&f&&(isValid(d.id)||(d.id=`vrender-component-${this.name}-${u}`),this._idToGraphic.set(d.id,f))}if(this.attribute.animation!==!1){const{animation:u,animationEnter:d,animationExit:f,animationUpdate:g}=this.attribute,_=isObject$1(u)?u:{};this._animationConfig={enter:d!==!1&&merge$1({},DefaultLabelAnimation,_,d??{}),exit:f!==!1&&merge$1({},DefaultLabelAnimation,_,f??{}),update:g!==!1&&(isArray(g)?g:merge$1({},DefaultLabelAnimation,_,g??{}))}}else this._animationConfig={enter:!1,exit:!1,update:!1}}}getRelatedGraphic(e){return this._idToGraphic.get(e.id)}_initText(e=[]){const{textStyle:i={}}=this.attribute,n=[];for(let o=0;o<e.length;o++){const l=e[o],u=this.getRelatedGraphic(l);if(!u)continue;const d=Object.assign(Object.assign({fill:this._isCollectionBase?isArray(u.attribute.stroke)?u.attribute.stroke.find(g=>!!g&&g!==!0):u.attribute.stroke:u.attribute.fill},i),l),f=this._createLabelText(d);n.push(f)}return n}_layout(e){const{position:i,offset:n}=this.attribute;for(let o=0;o<e.length;o++){const l=e[o];if(!l)return;const u=l.attribute,d=this.getRelatedGraphic(u);if(!d)continue;l.attachedThemeGraphic=this;const f=this.getGraphicBounds(l);l.attachedThemeGraphic=null;const g=isFunction(i)?i(u):i,_=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(u.id),g):this.getGraphicBounds(d,{x:u.x,y:u.y},g),y=this.labeling(f,_,g,n);y&&l.setAttributes(y)}return e}_overlapping(e){var i,n,o;if(e.length===0)return[];const l=isObject$1(this.attribute.overlap)?this.attribute.overlap:{},u=this.getBaseMarkGroup(),d=(i=l.size)!==null&&i!==void 0?i:{width:(n=u==null?void 0:u.AABBBounds.width())!==null&&n!==void 0?n:0,height:(o=u==null?void 0:u.AABBBounds.height())!==null&&o!==void 0?o:0};if(d.width===0||d.height===0)return e;const{strategy:f,priority:g}=l,_=this._bmpTool||bitmapTool(d.width,d.height),y=this._bitmap||_.bitmap();return g&&(e=e.sort((b,S)=>g(S.attribute.data)-g(b.attribute.data))),(f==null?void 0:f.type)==="shiftY"?this._overlapGlobal(e,l,_,y):this._overlapByStrategy(e,l,_,y)}_overlapGlobal(e,i,n,o){let l=e.filter(_=>_.attribute.visible&&_.attribute.opacity!==0);const{clampForce:u=!0,hideOnHit:d=!0,overlapPadding:f,strategy:g}=i;if(u)for(let _=0;_<l.length;_++){const y=e[_],{dx:b=0,dy:S=0}=clampText(y,n.width,n.height,n.padding);b===0&&S===0||(y.setAttributes({x:y.attribute.x+b,y:y.attribute.y+S}),y._isClamped=!0)}l=shiftY(l,Object.assign(Object.assign({maxY:n.height},g),{labelling:_=>{const y=this.getRelatedGraphic(_.attribute),b=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(_.attribute.id)):this.getGraphicBounds(y,_);return this.labeling(_.AABBBounds,b,"bottom",this.attribute.offset)}}));for(let _=0;_<l.length;_++){const y=l[_],b=y.AABBBounds,S=boundToRange(n,b,!0);if(canPlace(n,o,b,u,f))o.setRange(S);else{if(u&&this._processClampForce(y,n,o,f))continue;d?y.setAttributes({visible:!1}):o.setRange(S)}}return l}_processClampForce(e,i,n,o=0){const{dy:l=0,dx:u=0}=clampText(e,i.width,i.height,i.padding);if(u===0&&l===0){if(canPlace(i,n,e.AABBBounds,!1,o))return n.setRange(boundToRange(i,e.AABBBounds,!0)),!0}else if(canPlace(i,n,{x1:e.AABBBounds.x1+u,x2:e.AABBBounds.x2+u,y1:e.AABBBounds.y1+l,y2:e.AABBBounds.y2+l}))return e.setAttributes({x:e.attribute.x+u,y:e.attribute.y+l}),n.setRange(boundToRange(i,e.AABBBounds,!0)),!0;return!1}_overlapByStrategy(e,i,n,o){var l;const{avoidBaseMark:u,strategy:d=[],hideOnHit:f=!0,clampForce:g=!0,avoidMarks:_=[],overlapPadding:y}=i,b=[],S=d.some(v=>v.type==="bound");u&&((l=this._baseMarks)===null||l===void 0||l.forEach(v=>{v.AABBBounds&&o.setRange(boundToRange(n,v.AABBBounds,!0))})),_.length>0&&_.forEach(v=>{isString(v)?getNoneGroupMarksByName(this.getRootNode(),v).forEach(A=>{A.AABBBounds&&o.setRange(boundToRange(n,A.AABBBounds,!0))}):v.AABBBounds&&o.setRange(boundToRange(n,v.AABBBounds,!0))});for(let v=0;v<e.length;v++){if(e[v].attribute.visible===!1)continue;const A=e[v],x=this.getRelatedGraphic(A.attribute);if(A.update(),!isRectIntersect(x.AABBBounds,{x1:0,x2:n.width,y1:0,y2:n.height},!0))continue;if(canPlace(n,o,A.AABBBounds,g,y)){if(!S){o.setRange(boundToRange(n,A.AABBBounds,!0)),b.push(A);continue}if(S&&x&&x.AABBBounds&&this._canPlaceInside(A.AABBBounds,x.AABBBounds)){o.setRange(boundToRange(n,A.AABBBounds,!0)),b.push(A);continue}}let T=!1;for(let C=0;C<d.length;C++)if(T=place$2(n,o,d[C],this.attribute,A,this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(e[v].attribute.id)):this.getGraphicBounds(x,e[v].attribute),this.labeling),T!==!1){A.setAttributes({x:T.x,y:T.y}),b.push(A);break}if(!T&&g&&this._processClampForce(A,n,o,y)){b.push(A);continue}!T&&!f&&b.push(A)}return b}getBaseMarkGroup(){const{baseMarkGroupName:e}=this.attribute;if(e)return this.getRootNode().find(i=>i.name===e,!0)}getGraphicBounds(e,i={},n){if(e){if(e.attribute.visible!==!1)return e.AABBBounds;const{x:u,y:d}=e.attribute;return{x1:u,x2:u,y1:d,y2:d}}if(i&&n&&n==="inside-middle"){const{x:u,y:d,x1:f=u,y1:g=d}=i;return{x1:(u+f)/2,x2:(u+f)/2,y1:(d+g)/2,y2:(d+g)/2}}const{x:o,y:l}=i;return{x1:o,x2:o,y1:l,y2:l}}_renderLabels(e){var i;const{syncState:n}=this.attribute,o=new Map,l=this._graphicToText||new Map,u=[],d=[],{visible:f}=(i=this.attribute.line)!==null&&i!==void 0?i:{};e&&e.forEach((g,_)=>{var y;const b=this.getRelatedGraphic(g.attribute),S=this._isCollectionBase?g.attribute.id:b,v=l!=null&&l.get(S)?"update":"enter";let A;if(f&&(A=this._createLabelLine(g,b)),n&&this.updateStatesOfLabels([A?{text:g,labelLine:A}:{text:g}],(y=b.currentStates)!==null&&y!==void 0?y:[]),v==="enter")u.push(g),o.set(S,A?{text:g,labelLine:A}:{text:g}),this._addLabel({text:g,labelLine:A},u,d,_);else if(v==="update"){const x=l.get(S);l.delete(S),o.set(S,x),this._updateLabel(x,{text:g,labelLine:A})}}),this._removeLabel(l),this._graphicToText=o}_addLabel(e,i,n,o){const{text:l,labelLine:u}=e,d=this.getRelatedGraphic(l.attribute);if(this._syncStateWithRelatedGraphic(d),this._enableAnimation!==!1&&this._animationConfig.enter!==!1){if(d){const{from:f,to:g}=getAnimationAttributes(l.attribute,"fadeIn");l&&this.add(l),u&&(n.push(u),this.add(u)),this._animationConfig.enter.duration>0&&d.once("animate-bind",_=>{l.setAttributes(f),u&&u.setAttributes(f);const y=this._afterRelatedGraphicAttributeUpdate(l,i,u,n,o,d,g,this._animationConfig.enter);d.on("afterAttributeUpdate",y)})}}else l&&this.add(l),u&&this.add(u)}_updateLabel(e,i){const{text:n,labelLine:o}=e,{text:l,labelLine:u}=i;if(this._enableAnimation!==!1&&this._animationConfig.update!==!1){const{duration:d,easing:f}=this._animationConfig.update;updateAnimation(n,l,this._animationConfig.update),o&&u&&e.labelLine.animate().to(u.attribute,d,f)}else e.text.setAttributes(l.attribute),o&&u&&e.labelLine.setAttributes(u.attribute)}_removeLabel(e){const i=n=>{this.removeChild(n.text),n.labelLine&&this.removeChild(n.labelLine)};if(this._enableAnimation!==!1&&this._animationConfig.exit!==!1){const{duration:n,easing:o}=this._animationConfig.exit;e.forEach(l=>{var u;(u=l.text)===null||u===void 0||u.animate().to(getAnimationAttributes(l.text.attribute,"fadeOut").to,n,o).onEnd(()=>{i(l)})})}else e.forEach(n=>{i(n)})}updateStatesOfLabels(e,i){e.forEach(n=>{n&&(n.text&&n.text.useStates(i),n.labelLine&&n.labelLine.useStates(i))})}_syncStateWithRelatedGraphic(e){this.attribute.syncState&&e&&e.on("afterAttributeUpdate",this._handleRelatedGraphicSetState)}_afterRelatedGraphicAttributeUpdate(e,i,n,o,l,u,d,{mode:f,duration:g,easing:_,delay:y}){const b=S=>{var v,A,x;const{detail:T}=S;if(!T)return{};const C=(v=T.animationState)===null||v===void 0?void 0:v.step;if(!(T.type===AttributeUpdateType.ANIMATE_UPDATE&&C&&!(C.type==="wait"&&((A=C.prev)===null||A===void 0?void 0:A.type)==null)))return{};if(T.type===AttributeUpdateType.ANIMATE_END)return e.setAttributes(d),void(n&&n.setAttributes(d));const E=()=>{u&&(u.onAnimateBind=void 0,u.removeEventListener("afterAttributeUpdate",b))};switch(f){case"after":T.animationState.end&&(e.animate({onStart:E}).wait(y).to(d,g,_),n&&n.animate().wait(y).to(d,g,_));break;case"after-all":l===i.length-1&&T.animationState.end&&(i.forEach(P=>{P.animate({onStart:E}).wait(y).to(d,g,_)}),o.forEach(P=>{P.animate().wait(y).to(d,g,_)}));break;default:if(this._isCollectionBase){const P=this._idToPoint.get(e.attribute.id);!P||e.animates&&e.animates.has("label-animate")||!u.containsPoint(P.x,P.y,IContainPointMode.LOCAL,(x=this.stage)===null||x===void 0?void 0:x.getPickerService())||(e.animate({onStart:E}).wait(y).to(d,g,_),n&&n.animate().wait(y).to(d,g,_))}else T.animationState.isFirstFrameOfStep&&(e.animate({onStart:E}).wait(y).to(d,g,_),n&&n.animate().wait(y).to(d,g,_))}};return b}_smartInvert(e){var i,n,o,l,u,d,f;const g=isObject$1(this.attribute.smartInvert)?this.attribute.smartInvert:{},{textType:_,contrastRatiosThreshold:y,alternativeColors:b,mode:S,interactInvertType:v}=g,A=(i=g.fillStrategy)!==null&&i!==void 0?i:"invertBase",x=(n=g.strokeStrategy)!==null&&n!==void 0?n:"base",T=(o=g.brightColor)!==null&&o!==void 0?o:"#ffffff",C=(l=g.darkColor)!==null&&l!==void 0?l:"#000000",E=(u=g.outsideEnable)!==null&&u!==void 0&&u;if(A!=="null"||x!=="null")for(let P=0;P<e.length;P++){const L=e[P];if(!L)continue;const R=this.getRelatedGraphic(L.attribute);let w=R.attribute.fill,D=L.attribute.fill;if(isObject$1(w)&&w.gradient){const $=(f=(d=w.stops)===null||d===void 0?void 0:d[0])===null||f===void 0?void 0:f.color;$&&(w=$,D=$)}const I=labelSmartInvert(D,w,_,y,b,S),O=contrastAccessibilityChecker(I,T)?T:C,B=this._canPlaceInside(L.AABBBounds,R.AABBBounds),N=!B&&L.AABBBounds&&R.AABBBounds&&R.AABBBounds.intersects(L.AABBBounds);if(B||E||N&&v==="inside"){const $=smartInvertStrategy(A,w,I,O);if($&&L.setAttributes({fill:$}),L.attribute.lineWidth===0||L.attribute.strokeOpacity===0)continue;const H=smartInvertStrategy(x,w,I,O);H&&L.setAttributes({stroke:H})}else if(N&&v!=="none"){if(L.attribute.lineWidth===0||L.attribute.strokeOpacity===0)continue;if(L.attribute.stroke){L.setAttributes({fill:labelSmartInvert(L.attribute.fill,L.attribute.stroke,_,y,b,S)});continue}const $=smartInvertStrategy(A,w,I,O);$&&L.setAttributes({fill:$});const H=smartInvertStrategy(x,w,I,O);H&&L.setAttributes({stroke:H})}}}_canPlaceInside(e,i){return!(!e||!i)&&i.encloses(e)}setLocation(e){this.translateTo(e.x,e.y)}disableAnimation(){this._enableAnimation=!1}enableAnimation(){this._enableAnimation=!0}}LabelBase.defaultAttributes={textStyle:{fontSize:12,textAlign:"center",textBaseline:"middle",boundsPadding:[-2,-1,-2,-1]},offset:0,pickable:!1};const labelComponentMap={},registerLabelComponent=(r,e)=>{labelComponentMap[r]=e},getLabelComponent=r=>labelComponentMap[r];var __rest$r=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class SymbolLabel extends LabelBase{constructor(e,i){const{data:n}=e,o=__rest$r(e,["data"]);super(i!=null&&i.skipDefault?e:Object.assign({data:n},merge$1({},SymbolLabel.defaultAttributes,o))),this.name="symbol-label"}labeling(e,i,n="top",o=0){return labelingPoint(e,i,n,o)}}SymbolLabel.defaultAttributes={textStyle:{fill:"#000"},position:"top",offset:5};const registerSymbolDataLabel=()=>{registerLabelComponent("symbol",SymbolLabel),registerLabelComponent("line-data",SymbolLabel)};var __rest$q=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class RectLabel extends LabelBase{constructor(e,i){const{data:n}=e,o=__rest$q(e,["data"]);super(i!=null&&i.skipDefault?e:Object.assign({data:n},merge$1({},RectLabel.defaultAttributes,o)))}labeling(e,i,n="top",o=0){if(!e||!i)return;const{x1:l,y1:u,x2:d,y2:f}=e,g=Math.abs(d-l),_=Math.abs(f-u),{x:y,y:b}=calculateAnchorOfBounds(i,n);let S=0,v=0;const A=n.includes("inside");switch(n.includes("top")?v=A?1:-1:n.includes("bottom")?v=A?-1:1:n.includes("left")?S=A?1:-1:n.includes("right")&&(S=A?-1:1),n){case"top-right":case"bottom-right":S=-1;break;case"top-left":case"bottom-left":S=1}return{x:y+S*o+S*g/2,y:b+v*o+v*_/2}}}RectLabel.tag="rect-label",RectLabel.defaultAttributes={textStyle:{fill:"#000"},position:"top",offset:5};const registerRectDataLabel=()=>{registerLabelComponent("rect",RectLabel)};var __rest$p=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};let LineLabel$1=class $e extends LabelBase{constructor(e,i){const{data:n}=e,o=__rest$p(e,["data"]);super(i!=null&&i.skipDefault?e:Object.assign({data:n},merge$1({},$e.defaultAttributes,o))),this.name="line-label"}getGraphicBounds(e,i={},n="end"){if(!e||e.type!=="line"&&e.type!=="area")return super.getGraphicBounds(e,i);let o=e.attribute.points;const l=e.attribute.segments;!o&&l&&l.length&&(o=l.reduce((d,f)=>{var g;return d.concat((g=f.points)!==null&&g!==void 0?g:[])},[])),o&&o.length!==0||(o=[i]);const u=n==="start"?0:o.length-1;return o[u]?{x1:o[u].x,x2:o[u].x,y1:o[u].y,y2:o[u].y}:void 0}labeling(e,i,n="end",o=0){return labelingLineOrArea(e,i,n,o)}};LineLabel$1.defaultAttributes={textStyle:{fill:"#000"},position:"end",offset:6};const registerLineDataLabel=()=>{registerLabelComponent("line",LineLabel$1),registerLabelComponent("area",LineLabel$1)};var __rest$o=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class ArcInfo{constructor(e,i,n,o,l,u,d,f,g){this.refDatum=e,this.center=i,this.outerCenter=n,this.quadrant=o,this.radian=l,this.middleAngle=u,this.innerRadius=d,this.outerRadius=f,this.circleCenter=g,this.labelVisible=!0}getLabelBounds(){return this.labelPosition&&this.labelSize?{x1:this.labelPosition.x-this.labelSize.width/2,y1:this.labelPosition.y-this.labelSize.height/2,x2:this.labelPosition.x+this.labelSize.width/2,y2:this.labelPosition.y+this.labelSize.height/2}:{x1:0,x2:0,y1:0,y2:0}}}class ArcLabel extends LabelBase{constructor(e,i){const{data:n}=e,o=__rest$o(e,["data"]);super(i!=null&&i.skipDefault?e:Object.assign({data:n},merge$1({},ArcLabel.defaultAttributes,o))),this.name="arc-label",this._ellipsisWidth=0,this._arcLeft=new Map,this._arcRight=new Map,this._line2MinLength=0,this._alignOffset=0}_overlapping(e){return["inside","inside-center"].includes(this.attribute.position)?super._overlapping(e):e}labeling(e,i,n="outside",o=0){if(e&&i)return{x:0,y:0}}_layout(e){var i,n,o;if(!e||!e.length)return;const l=super._layout(e),u=l.map(b=>this.getGraphicBounds(b)),d=Object.assign(Object.assign({},this.attribute.textStyle),{text:""});let f=1/0;if(d.ellipsis!==!1){const b=this._createLabelText(d),S=this.getGraphicBounds(b);f=S.x2-S.x1}const g=l.map(b=>b.attribute),_=Array.from(this._idToGraphic.values());this._line2MinLength=isFunction(this.attribute.line.line2MinLength)?this.attribute.line.line2MinLength(e,_,this.attribute):this.attribute.line.line2MinLength,this._alignOffset=(i=isFunction(this.attribute.layout.alignOffset)?this.attribute.layout.alignOffset(e,_,this.attribute):this.attribute.layout.alignOffset)!==null&&i!==void 0?i:0;const y=this.layoutArcLabels(this.attribute.position,this.attribute,_,g,u,f);for(let b=0;b<g.length;b++){const S=g[b],v=y.find(A=>{var x;return((x=A.refDatum)===null||x===void 0?void 0:x.id)===S.id});if(v){const A={visible:v.labelVisible,x:v.labelPosition.x,y:v.labelPosition.y,angle:v.angle,points:v.pointA&&v.pointB&&v.pointC?[v.pointA,v.pointB,v.pointC]:void 0,line:v.labelLine};l[b].type==="richtext"?A.width=(n=v.labelLimit)!==null&&n!==void 0?n:l[b].attribute.width:A.maxLineWidth=(o=v.labelLimit)!==null&&o!==void 0?o:l[b].attribute.maxLineWidth,v.refArc&&v.refArc.type==="arc3d"&&(A.anchor3d=[v.circleCenter.x-A.x,v.circleCenter.y-A.y],A.beta=v.refArc.attribute.beta),l[b].setAttributes(A)}}return l}layoutArcLabels(e,i,n,o,l,u){this._arcLeft.clear(),this._arcRight.clear(),this._ellipsisWidth=u;let d=0;n.forEach(y=>{y.attribute.outerRadius>d&&(d=y.attribute.outerRadius)}),o.forEach((y,b)=>{var S,v;const A=this._idToGraphic.get(y.id),x=A.attribute,T={x:(S=x==null?void 0:x.x)!==null&&S!==void 0?S:0,y:(v=x==null?void 0:x.y)!==null&&v!==void 0?v:0};if(!isNil(o[b])&&!isNil(l[b])){const C=o[b]?o[b]:null,E=l[b]?l[b]:{x1:0,x2:0,y1:0,y2:0},P=(x.startAngle+x.endAngle)/2,L=x.endAngle-x.startAngle,R=computeQuadrant(x.endAngle-L/2),w=polarToCartesian(T,x.outerRadius,P),D=polarToCartesian(T,d+i.line.line1MinLength,P),I=new ArcInfo(C,w,D,R,L,P,x.innerRadius,x.outerRadius,T);I.refArc=A,I.pointA=polarToCartesian(T,this.computeDatumRadius(2*T.x,2*T.y,x.outerRadius),I.middleAngle),I.labelSize={width:E.x2-E.x1,height:E.y2-E.y1},isQuadrantRight(I.quadrant)?this._arcRight.set(I.refDatum,I):isQuadrantLeft(I.quadrant)&&this._arcLeft.set(I.refDatum,I)}});const f=Array.from(this._arcLeft.values()),g=Array.from(this._arcRight.values()),_=[];switch(e){case"inside":case"inside-inner":case"inside-outer":case"inside-center":_.push(...this._layoutInsideLabels(g,i,n)),_.push(...this._layoutInsideLabels(f,i,n));break;default:_.push(...this._layoutOutsideLabels(g,i,n)),_.push(...this._layoutOutsideLabels(f,i,n))}return _}_layoutInsideLabels(e,i,n){var o,l;const u=i,d=u.spaceWidth,f=(o=u.position)!==null&&o!==void 0?o:"inside",g=(l=u.offsetRadius)!==null&&l!==void 0?l:-d;return e.forEach(_=>{var y,b,S;const{labelSize:v,radian:A}=_,x=_.innerRadius,T=_.outerRadius;let C;if(A<connectLineRadian(T,v.height))C=0;else{let D;D=A>=Math.PI?x:Math.max(x,v.height/2/Math.tan(A/2)),C=T-D-d}u.rotate!==!0&&(C=T-d);const E=this._getFormatLabelText(_.refDatum,C);_.labelText=E;const P=Math.min(C,_.labelSize.width),L=this._computeAlign(_,i);let R,w=0;if(f==="inside"&&(w=L==="left"?P:L==="right"?0:P/2),R=f==="inside-inner"?x-g+w:f==="inside-center"?x+(T-x)/2:T+g-w,_.labelPosition=polarToCartesian(_.circleCenter,R,_.middleAngle),_.labelLimit=P,isGreater(P,0)||(_.labelVisible=!1),u.rotate!==!1){_.angle=(b=(y=i.textStyle)===null||y===void 0?void 0:y.angle)!==null&&b!==void 0?b:_.middleAngle;let D=(S=u.offsetAngle)!==null&&S!==void 0?S:0;["inside-inner","inside-outer"].includes(f)&&(D+=Math.PI/2),_.angle+=D}}),e}_layoutOutsideLabels(e,i,n){var o,l,u;const d=(o=n[0].attribute.x)!==null&&o!==void 0?o:0,f=2*((l=n[0].attribute.y)!==null&&l!==void 0?l:0),g=i.layout,_=i.spaceWidth;if(e.forEach(b=>{const S=isQuadrantLeft(b.quadrant)?-1:1;b.labelPosition={x:b.outerCenter.x+S*(b.labelSize.width/2+this._line2MinLength+_),y:b.outerCenter.y}}),e.sort((b,S)=>b.labelPosition.y-S.labelPosition.y),i.coverEnable!==!1||g.strategy==="none"){for(const b of e){const{labelPosition:S,labelSize:v}=b;b.labelLimit=v.width,b.pointB=isQuadrantLeft(b.quadrant)?{x:S.x+v.width/2+this._line2MinLength+_,y:S.y}:{x:S.x-v.width/2-this._line2MinLength-_,y:S.y},this._computeX(b,i,n)}i.coverEnable===!1&&g.strategy==="none"&&this._coverLabels(e)}else{const b=f/(((u=i.textStyle)===null||u===void 0?void 0:u.fontSize)||16);this._adjustY(e,b,i,n);const{minY:S,maxY:v}=e.reduce((T,C)=>{const{y1:E,y2:P}=C.getLabelBounds();return T.minY=Math.max(0,Math.min(E,T.minY)),T.maxY=Math.min(f,Math.max(P,T.maxY)),T},{minY:1/0,maxY:-1/0}),A=Math.max(Math.abs(f/2-S),Math.abs(v-f/2)),x=this._computeLayoutRadius(A,i,n);for(const T of e)this._computePointB(T,x,i,n),this._computeX(T,i,n)}const y=2*d;return e.forEach(b=>{var S,v;b.labelVisible&&(isLess(b.pointB.x,this._line2MinLength+_)||isGreater(b.pointB.x,y-this._line2MinLength-_))&&(b.labelVisible=!1),b.angle=(v=(S=i.textStyle)===null||S===void 0?void 0:S.angle)!==null&&v!==void 0?v:0,i.offsetAngle&&(b.angle+=i.offsetAngle),b.labelLine=Object.assign(Object.assign({},i.line),{visible:b.labelVisible})}),e}_computeX(e,i,n){var o;const l=e.circleCenter,u=0,d=this.attribute.width;this.attribute.height;let f=0;n.forEach(I=>{I.attribute.outerRadius>f&&(f=I.attribute.outerRadius)});const g=this.computeLayoutOuterRadius(f,i.width,i.height),_=i.line.line1MinLength,y=(o=i.layout)===null||o===void 0?void 0:o.align,b=i.spaceWidth,{labelPosition:S,quadrant:v,pointB:A}=e;isValidNumber(A.x*A.y)||(e.pointC={x:NaN,y:NaN},S.x=NaN,e.labelLimit=0);const x=this.computeRadius(g,i.width,i.height),T=isQuadrantLeft(v)?-1:1;let C=0,E=(T>0?d-A.x:A.x-u)+this._alignOffset-this._line2MinLength-b;y==="labelLine"&&(C=(x+_+this._line2MinLength)*T+l.x,E=(T>0?d-C:C-u)-b);const P=this._getFormatLabelText(e.refDatum,E);e.labelText=P;let L=Math.min(E,e.labelSize.width);switch(y){case"labelLine":break;case"edge":C=T>0?d-L-b:u+L+b;break;default:C=A.x+T*this._line2MinLength}L=Math.max(this._ellipsisWidth,L);const R=L<e.labelSize.width-1;e.labelLimit=R?L:null,e.pointC={x:C,y:S.y};const w=this._computeAlign(e,i),D=getAlignOffset(w)*(R?L:e.labelSize.width);y==="edge"?(S.x=(T>0?d:u)-T*D+T*this._alignOffset,e.pointC.x+=T*this._alignOffset):S.x=C+T*(this._alignOffset+b+D)}_computeAlign(e,i){var n,o,l,u,d,f;const g=i,_=(o=(n=g.textStyle)===null||n===void 0?void 0:n.textAlign)!==null&&o!==void 0?o:(l=g.textStyle)===null||l===void 0?void 0:l.align,y=(d=(u=g.layout)===null||u===void 0?void 0:u.textAlign)!==null&&d!==void 0?d:(f=g.layout)===null||f===void 0?void 0:f.align;return g.position!=="inside"?isNil(_)||_==="auto"?y==="edge"?isQuadrantLeft(e.quadrant)?"left":"right":isQuadrantLeft(e.quadrant)?"right":"left":_:isNil(_)||_==="auto"?"center":_}_getFormatLabelText(e,i){var n;return(n=e==null?void 0:e.text)!==null&&n!==void 0?n:""}_adjustY(e,i,n,o){var l;o[0].attribute.x;const u=2*((l=o[0].attribute.y)!==null&&l!==void 0?l:0),d=n.layout;if(d.strategy==="vertical"){let f,g=0;const _=e.length;if(_<=0)return;for(let b=0;b<_;b++){const{y1:S}=e[b].getLabelBounds();if(f=S-g,isLess(f,0)){const A=this._shiftY(e,b,_-1,-f);this._shiftY(e,A,0,f/2)}const{y2:v}=e[b].getLabelBounds();g=v}const{y1:y}=e[0].getLabelBounds();f=y-0,isLess(f,0)&&this._shiftY(e,0,_-1,-f);for(let b=e.length-1;b>=0&&e[b].getLabelBounds().y2>u;b--)e[b].labelVisible=!1}else if(d.strategy!=="none"){const f=e.map((y,b)=>({arc:y,originIndex:b,priorityIndex:0}));f.sort((y,b)=>b.arc.radian-y.arc.radian),f.forEach((y,b)=>{y.priorityIndex=b,y.arc.labelVisible=!1});let g=1/0,_=-1/0;for(let y=0;y<i&&y<e.length;y++){this._storeY(e);const b=f[y].arc;this._computeYRange(b,n,o),b.labelVisible=!0;const S=b.labelPosition.y,{lastIndex:v,nextIndex:A}=this._findNeighborIndex(e,f[y]),x=e[v],T=e[A];if(v===-1&&A!==-1){const L=T.labelPosition.y;S>L?b.labelPosition.y=L-T.labelSize.height/2-b.labelSize.height/2:this._twoWayShift(e,b,T,A)}else if(v!==-1&&A===-1){const L=x.labelPosition.y;S<L?b.labelPosition.y=L+x.labelSize.height/2+b.labelSize.height/2:this._twoWayShift(e,x,b,f[y].originIndex)}else if(v!==-1&&A!==-1){const L=x.labelPosition.y,R=T.labelPosition.y;S>R?(b.labelPosition.y=R-T.labelSize.height/2-b.labelSize.height/2,this._twoWayShift(e,x,b,f[y].originIndex)):S<L?(b.labelPosition.y=L+x.labelSize.height/2+b.labelSize.height/2,this._twoWayShift(e,b,T,A)):(this._twoWayShift(e,x,b,f[y].originIndex),this._twoWayShift(e,b,T,A))}const C=Math.min(g,f[y].originIndex),E=Math.max(_,f[y].originIndex);let P;if(P=e[E].getLabelBounds().y2-u,isGreater(P,0)&&this._shiftY(e,E,0,-P),P=e[C].getLabelBounds().y1-0,isLess(P,0)&&this._shiftY(e,C,e.length-1,-P),P=e[E].getLabelBounds().y2-u,isGreater(P,0)){b.labelVisible=!1,this._restoreY(e);break}d.tangentConstraint&&!this._checkYRange(e)?(b.labelVisible=!1,this._restoreY(e)):(g=C,_=E)}}}_shiftY(e,i,n,o){const l=i<n?1:-1;let u=i;for(;u!==-1;){e[u].labelPosition.y+=o;const d=this._findNextVisibleIndex(e,u,n,l);if(d>=0&&d<e.length){const{y1:f,y2:g}=e[u].getLabelBounds(),{y1:_,y2:y}=e[d].getLabelBounds();if(l>0&&g<_||l<0&&f>y)return u}u=d}return n}_findNextVisibleIndex(e,i,n,o){const l=(n-i)*o;for(let u=1;u<=l;u++){const d=i+u*o;if(e[d].labelVisible)return d}return-1}_computePointB(e,i,n,o){const l=n;let u=0;o.forEach(g=>{g.attribute.outerRadius>u&&(u=g.attribute.outerRadius)});const d=this.computeLayoutOuterRadius(u,n.width,n.height),f=l.line.line1MinLength;if(l.layout.strategy==="none")e.pointB={x:e.outerCenter.x,y:e.outerCenter.y};else{const g=e.circleCenter,_=this.computeRadius(d,n.width,n.height),{labelPosition:y,quadrant:b}=e,S=i-Math.max(_+f,e.outerRadius),v=Math.sqrt(i**2-Math.abs(g.y-y.y)**2)-S;isValidNumber(v)?e.pointB={x:g.x+v*(isQuadrantLeft(b)?-1:1),y:y.y}:e.pointB={x:NaN,y:NaN}}}_storeY(e){for(const i of e)i.labelVisible&&(i.lastLabelY=i.labelPosition.y)}_computeYRange(e,i,n){const o=e.circleCenter,l={width:2*o.x,height:2*o.y};let u=0;n.forEach(L=>{L.attribute.outerRadius>u&&(u=L.attribute.outerRadius)});const d=this.computeLayoutOuterRadius(u,i.width,i.height),f=i.line.line1MinLength,{width:g,height:_}=l,y=this.computeRadius(d,i.width,i.height),b=this._computeLayoutRadius(_/2,i,n),S=Math.abs(e.center.x-g/2),v=e.center.y-_/2;let A,x,T;if(isNumberClose(g/2,S))A=0,x=1,T=-v;else if(isNumberClose(_/2,v))A=1,x=0,T=-S;else{const L=-1/(v/S);A=L,x=-1,T=v-L*S}const C=lineCirclePoints(A,x,T,f+y-b,0,b);if(C.length<2)return;let E,P;C[0].x>C[1].x&&C.reverse(),C[0].x<0?isNumberClose(C[0].y,C[1].y)?isGreater(e.middleAngle,-Math.PI)&&isLess(e.middleAngle,0)||isGreater(e.middleAngle,Math.PI)&&isLess(e.middleAngle,2*Math.PI)?(E=0,P=C[1].y+_/2):(E=C[1].y+_/2,P=_):C[0].y<C[1].y?(E=0,P=C[1].y+_/2):(E=C[1].y+_/2,P=l.height):(E=Math.min(C[0].y,C[1].y)+_/2,P=Math.max(C[0].y,C[1].y)+_/2),e.labelYRange=[E,P]}_computeLayoutRadius(e,i,n){const o=i,l=o.layoutArcGap,u=o.line.line1MinLength;let d=0;n.forEach(y=>{y.attribute.outerRadius>d&&(d=y.attribute.outerRadius)});const f=this.computeLayoutOuterRadius(d,i.width,i.height),g=this.computeRadius(f,i.width,i.height)+u,_=g-l;return Math.max((_**2+e**2)/(2*_),g)}_findNeighborIndex(e,i){const n=i.originIndex;let o=-1,l=-1;for(let u=n-1;u>=0;u--)if(e[u].labelVisible){o=u;break}for(let u=n+1;u<e.length;u++)if(e[u].labelVisible){l=u;break}return{lastIndex:o,nextIndex:l}}_twoWayShift(e,i,n,o){const l=n.getLabelBounds().y1-i.getLabelBounds().y2;if(isLess(l,0)){const u=this._shiftY(e,o,e.length-1,-l);this._shiftY(e,u,0,l/2)}}_restoreY(e){for(const i of e)i.labelVisible&&(i.labelPosition.y=i.lastLabelY)}_checkYRange(e){for(const i of e){const{labelYRange:n,labelPosition:o}=i;if(i.labelVisible&&n&&(isLess(o.y,n[0])||isGreater(o.y,n[1])))return!1}return!0}_coverLabels(e){if(e.length<=1)return;let i=e[0].getLabelBounds();for(let n=1;n<e.length;n++){const o=e[n].getLabelBounds();checkBoundsOverlap(i,o)?e[n].labelVisible=!1:i=o}}_getLabelLinePoints(e,i){return e.attribute.points}_createLabelLine(e,i){var n,o,l,u,d;const{line:f={},visible:g}=e.attribute,_=super._createLabelLine(e,i);if(_&&(_.setAttributes({visible:(l=(n=f.visible&&g)!==null&&n!==void 0?n:(o=e.attribute)===null||o===void 0?void 0:o.visible)===null||l===void 0||l,lineWidth:(d=(u=f.style)===null||u===void 0?void 0:u.lineWidth)!==null&&d!==void 0?d:1}),f.smooth&&_.setAttributes({curveType:"basis"}),i.type==="arc3d"&&i)){const{beta:y,x:b,y:S}=i.attribute;_.setAttributes({beta:y,anchor3d:[b,S]})}return _}computeRadius(e,i,n,o){return this.computeLayoutRadius(i||0,n||0)*e*(isNil(o)?1:o)}computeLayoutRadius(e,i){return Math.min(e/2,i/2)}_canPlaceInside(e,i){return this.attribute.position==="inside"||this.attribute.position==="inside-center"}computeLayoutOuterRadius(e,i,n){return e/(Math.min(i,n)/2)}computeDatumRadius(e,i,n){const o=this.computeLayoutOuterRadius(n,e,i);return this.computeLayoutRadius(e||0,i||0)*o}}ArcLabel.defaultAttributes={coverEnable:!1,spaceWidth:5,layoutArcGap:6,textStyle:{visible:!0,fontSize:14,fontWeight:"normal",fillOpacity:1,boundsPadding:[-1,0,-1,0],ellipsis:!0},position:"outside",line:{visible:!0,line1MinLength:20,line2MinLength:10},layout:{align:"arc",strategy:"priority",tangentConstraint:!0}};const registerArcDataLabel=()=>{registerLabelComponent("arc",ArcLabel)};var __rest$n=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class DataLabel extends AbstractComponent{constructor(e,i){const{dataLabels:n}=e,o=__rest$n(e,["dataLabels"]);super(i!=null&&i.skipDefault?e:Object.assign({dataLabels:n},merge$1({},DataLabel.defaultAttributes,o))),this.name="data-label"}render(){var e;const{dataLabels:i,size:n}=this.attribute;if(!i||i.length===0)return;const{width:o=0,height:l=0,padding:u}=n||{};if(!o||!l||!isValidNumber(l*o))return;this._componentMap||(this._componentMap=new Map);const d=bitmapTool(o,l,u),f=d.bitmap(),g=new Map,_=this._componentMap;for(let y=0;y<i.length;y++){const b=i[y],S=getLabelComponent(b.type)||LabelBase;if(S){const{baseMarkGroupName:v,type:A}=b,x=(e=b.id)!==null&&e!==void 0?e:`${v}-${A}-${y}`;b.type==="arc"&&(b.width=n.width,b.height=n.height);let T=this._componentMap.get(x);T?(T.setBitmapTool(d),T.setBitmap(f),T.setAttributes(b),g.set(x,T)):(T=new S(b),T.setBitmap(f),T.setBitmapTool(d),this.add(T),g.set(x,T))}}_.forEach((y,b)=>{g.get(b)||this.removeChild(y)}),this._componentMap=g}setLocation(e){this.translateTo(e.x,e.y)}disableAnimation(){this._componentMap.forEach(e=>{e.disableAnimation()})}enableAnimation(){this._componentMap.forEach(e=>{e.enableAnimation()})}}DataLabel.defaultAttributes={pickable:!1};function getArcPath(r,e,i,n){let o="";if(!r||e.length===0)return o;const l=e[0],u=PointService.distancePP(r,l),d=i?0:1;return n?o+=`M${r.x},${r.y-u}A${u},${u},0,0,${d},${r.x},${r.y+u}A${u},${u},0,0,${d},${r.x},${r.y-u}Z`:e.forEach((f,g)=>{g===0?o=`M${f.x},${f.y}`:o+=`A${u},${u},0,0,${d},${f.x},${f.y}`}),o}function getRegionPath(r,e,i){const{type:n,closed:o}=i,l=e.slice(0).reverse();let u="",d="";if(n==="line"&&i.smoothLink&&i.center){const f=r[0],g=l[0],_=i.center;u=getPolygonPath(r,!!o),d=getPolygonPath(l,!!o);const y=PointService.distancePP(g,_),b=PointService.distancePP(f,_);u+=`A${y},${y},0,0,1,${g.x},${g.y}L${g.x},${g.y}`,d+=`A${b},${b},0,0,0,${f.x},${f.y}`}else if(n==="circle"){const{center:f}=i;u=getArcPath(f,r,!1,!!o),d=getArcPath(f,l,!0,!!o)}else n!=="line"&&n!=="polygon"||(u=getPolygonPath(r,!!o),d=getPolygonPath(l,!!o));return o?u+=d:(d="L"+d.substring(1),u+=d,u+="Z"),u}class BaseGrid extends AbstractComponent{constructor(){super(...arguments),this.name="axis-grid",this.data=[]}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}render(){this._prevInnerView=this._innerView&&getElMap(this._innerView),this.removeAllChild(!0),this._innerView=graphicCreator.group({x:0,y:0,pickable:!1}),this.add(this._innerView);const{items:e,visible:i}=this.attribute;e&&e.length&&i!==!1&&(this.data=this._transformItems(e),this._renderGrid(this._innerView))}getVerticalCoord(e,i,n){return getVerticalCoord(e,this.getVerticalVector(i,n,e))}_transformItems(e){const i=[];return e.forEach(n=>{var o;i.push(Object.assign(Object.assign({},n),{point:this.getTickCoord(n.value),id:(o=n.id)!==null&&o!==void 0?o:n.label}))}),i}_renderGrid(e){const{visible:i}=this.attribute.subGrid||{};i&&this._renderGridByType(!0,e),this._renderGridByType(!1,e)}_renderGridByType(e,i){const n=merge$1({},this.attribute,this.getGridAttribute(e)),{type:o,items:l,style:u,closed:d,alternateColor:f,depth:g=0}=n,_=e?`${AXIS_ELEMENT_NAME.grid}-sub`:`${AXIS_ELEMENT_NAME.grid}`;if(l.forEach((y,b)=>{const{id:S,points:v}=y;let A="";if(o==="line"||o==="polygon")A=getPolygonPath(v,!!d);else if(o==="circle"){const{center:T}=this.attribute;A=getArcPath(T,v,!1,!!d)}const x=graphicCreator.path(Object.assign({path:A,z:g},isFunction(u)?merge$1({},this.skipDefault?null:BaseGrid.defaultAttributes.style,u(y,b)):u));x.name=`${_}-line`,x.id=this._getNodeId(`${_}-path-${S}`),i.add(x)}),g&&o==="line"&&l.forEach((y,b)=>{const{id:S,points:v}=y,A=[];A.push(v[0]);const x=v[1].x-v[0].x,T=v[1].y-v[0].y,C=Math.sqrt(x*x+T*T),E=g/C;A.push({x:v[0].x+x*E,y:v[0].y+T*E});const P=getPolygonPath(A,!!d),L=abs$1(A[0].x-A[1].x),R=abs$1(A[0].y-A[1].y),w=graphicCreator.path(Object.assign({path:P,z:0,alpha:L>R?(v[1].x-v[0].x>0?-1:1)*pi$1/2:0,beta:L<R?-pi$1/2:0,anchor3d:L>R?[A[0].x,0]:[0,A[0].y]},isFunction(u)?merge$1({},this.skipDefault?null:BaseGrid.defaultAttributes.style,u(y,b)):u));w.name=`${_}-line`,w.id=this._getNodeId(`${_}-path-${S}`),i.add(w)}),l.length>1&&f){const y=isArray(f)?f:[f,"transparent"],b=P=>y[P%y.length],S=this.attribute.items,v=S[0],A=S[S.length-1],x=!isNumberClose(v.value,0)&&!isNumberClose(A.value,0),T=!isNumberClose(v.value,1)&&!isNumberClose(A.value,1),C=[],E=v.value>A.value;(E&&T||!E&&x)&&C.push(this.getGridPointsByValue(E?1:0)),l.forEach(P=>{C.push(P.points)}),(E&&x||!E&&T)&&C.push(this.getGridPointsByValue(E?0:1));for(let P=0;P<C.length-1;P++){const L=getRegionPath(C[P],C[P+1],n),R=graphicCreator.path({path:L,fill:b(P)});R.name=`${_}-region`,R.id=this._getNodeId(`${_}-region-${P}`),i.add(R)}}}_getNodeId(e){return`${this.id}-${e}`}_parseTickSegment(){let e=1;return this.data.length>=2&&(e=this.data[1].value-this.data[0].value),e}_getPointsOfSubGrid(e,i){const n=this.data.length,o=[];return n>=2&&this.data.forEach(l=>{let u=l.value;if(!i){const d=l.value-e/2;if(this.isInValidValue(d))return;u=d}o.push({value:u})}),o}release(){super.release(),this._prevInnerView=null,this._innerView=null}}BaseGrid.defaultAttributes={style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]}}};loadLineAxisGridComponent();class LineAxisGrid extends BaseGrid{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},BaseGrid.defaultAttributes,e),i)}_getGridPoint(e,i){let n;if(e==="line"){const{length:o}=this.attribute;n=[i,this.getVerticalCoord(i,o,!0)]}else if(e==="circle"||e==="polygon"){const{center:o,sides:l=6,startAngle:u=POLAR_START_ANGLE$1,endAngle:d=POLAR_END_ANGLE$1}=this.attribute,f=PointService.distancePP(o,i);n=getCirclePoints(o,l,f,u,d)}return n}getGridPointsByValue(e){const i=this.getTickCoord(e);return this._getGridPoint(this.attribute.type,i)}getGridAttribute(e){const{type:i,alignWithLabel:n=!0}=this.attribute,o=this._parseTickSegment();let l,u=[];if(e){l=merge$1({},this.attribute,this.attribute.subGrid);const d=[],{count:f=4}=l;if(this.data.length>=2){const g=this._getPointsOfSubGrid(o,n);for(let _=0;_<g.length-1;_++){const y=g[_],b=g[_+1];d.push({id:`sub-${_}-0`,points:this.getGridPointsByValue(y.value),datum:{}});for(let S=0;S<f;S++){const v=(S+1)/(f+1),A=(1-v)*y.value+v*b.value;d.push({id:`sub-${_}-${S+1}`,points:this.getGridPointsByValue(A),datum:{}})}_===g.length-2&&d.push({id:`sub-${_}-${f+1}`,points:this.getGridPointsByValue(b.value),datum:{}})}u=d}}else{l=this.attribute;const d=[];this.data.forEach(f=>{let{point:g}=f;if(!n){const _=f.value-o/2;if(this.isInValidValue(_))return;g=this.getTickCoord(_)}d.push({id:f.label,datum:f,points:this._getGridPoint(i,g)})}),u=d}return Object.assign(Object.assign({},l),{items:u})}}mixin(LineAxisGrid,LineAxisMixin);var __rest$m=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};loadCircleAxisGridComponent();class CircleAxisGrid extends BaseGrid{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},BaseGrid.defaultAttributes,e),i)}getGridPointsByValue(e){const i=this.getTickCoord(e),{radius:n,innerRadius:o=0}=this.attribute;return[i,this.getVerticalCoord(i,n-o,!0)]}getGridAttribute(e){let i,n=[];const o=this.attribute,{radius:l,innerRadius:u=0,startAngle:d=POLAR_START_ANGLE$1,endAngle:f=POLAR_END_ANGLE$1,center:g,subGrid:_}=o,y=__rest$m(o,["radius","innerRadius","startAngle","endAngle","center","subGrid"]),{alignWithLabel:b=!0}=y||{},S=l-u,v=this._parseTickSegment();if(e){i=merge$1({},y,_);const A=[],{count:x=4}=_||{},T=this.data.length;if(T>=2){const C=this._getPointsOfSubGrid(v,b);for(let E=0;E<T;E++){const P=C[E],L=C[E+1];A.push({id:`sub-${E}-0`,points:[this.getTickCoord(P.value),this.getVerticalCoord(this.getTickCoord(P.value),S,!0)],datum:{}});for(let R=0;R<x;R++){const w=(R+1)/(x+1),D=(1-w)*P.value+w*(L?L.value:b?1:P.value+v),I=this.getTickCoord(D),O=this.getVerticalCoord(I,S,!0);A.push({id:`sub-${E}-${R+1}`,points:[I,O],datum:{}})}}Math.abs(f-d)%(2*Math.PI)==0&&A.push(A[0]),n=A}}else{i=y;const A=[];let x;x=Math.abs(f-d)%(2*Math.PI)==0?[...this.data].concat(this.data[0]):this.data,x.forEach(T=>{let{point:C}=T;if(!b){const P=T.value-v/2;if(this.isInValidValue(P))return;C=this.getTickCoord(P)}const E=this.getVerticalCoord(C,S,!0);A.push({id:T.id,points:[C,E],datum:T})}),n=A}return Object.assign(Object.assign({},i),{items:n,center:g,type:"line"})}}mixin(CircleAxisGrid,CircleAxisMixin);const DEFAULT_HANDLER_PATH="M -0.0544 0.25 C -0.0742 0.25 -0.0901 0.234 -0.0901 0.2143 L -0.0901 -0.1786 C -0.0901 -0.1983 -0.0742 -0.2143 -0.0544 -0.2143 L -0.0187 -0.2143 L -0.0187 -0.5 L 0.017 -0.5 L 0.017 -0.2143 L 0.0527 -0.2143 C 0.0724 -0.2143 0.0884 -0.1983 0.0884 -0.1786 L 0.0884 0.2143 C 0.0884 0.234 0.0724 0.25 0.0527 0.25 L 0.017 0.25 L 0.017 0.5 L -0.0187 0.5 L -0.0187 0.25 L -0.0544 0.25 Z M -0.0187 -0.1429 L -0.0544 -0.1429 L -0.0544 0.1786 L -0.0187 0.1786 L -0.0187 -0.1429 Z M 0.0527 -0.1429 L 0.017 -0.1429 L 0.017 0.1786 L 0.0527 0.1786 L 0.0527 -0.1429 Z",DEFAULT_DATA_ZOOM_ATTRIBUTES={orient:"bottom",showDetail:"auto",brushSelect:!0,zoomLock:!1,minSpan:0,maxSpan:1,delayType:"throttle",delayTime:0,realTime:!0,backgroundStyle:{fill:"white",stroke:"#D1DBEE",lineWidth:1,cornerRadius:2},dragMaskStyle:{fill:"#B0C8F9",fillOpacity:.2},backgroundChartStyle:{area:{visible:!0,stroke:"#D1DBEE",lineWidth:1,fill:"#F6F8FC"},line:{visible:!0,stroke:"#D1DBEE",lineWidth:1}},selectedBackgroundStyle:{fill:"#B0C8F9",fillOpacity:.5},selectedBackgroundChartStyle:{area:{visible:!0,stroke:"#B0C8F9",lineWidth:1,fill:"#fbb934"},line:{visible:!0,stroke:"#fbb934",lineWidth:1}},middleHandlerStyle:{visible:!0,background:{size:8,style:{fill:"white",stroke:"#B0C8F9",cornerRadius:2}},icon:{size:6,fill:"white",stroke:"#B0C8F9",symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}},startHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:DEFAULT_HANDLER_PATH,fill:"white",stroke:"#B0C8F9",lineWidth:.5},endHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:DEFAULT_HANDLER_PATH,fill:"white",stroke:"#B0C8F9",lineWidth:.5},startTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}},endTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}}},DEFAULT_HANDLER_ATTR_MAP={horizontal:{angle:0,strokeBoundsBuffer:0,boundsPadding:2,pickMode:"imprecise",cursor:"ew-resize"},vertical:{angle:Math.PI/180*90,cursor:"ns-resize",boundsPadding:2,pickMode:"imprecise",strokeBoundsBuffer:0}};var DataZoomActiveTag;(function(r){r.startHandler="startHandler",r.endHandler="endHandler",r.middleHandler="middleHandler",r.background="background"})(DataZoomActiveTag||(DataZoomActiveTag={}));function loadDataZoomComponent(){loadTagComponent(),registerRect(),registerSymbol(),registerArea(),registerLine()}var __rest$l=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const delayMap$2={debounce,throttle};loadDataZoomComponent();let DataZoom$1=class Ve extends AbstractComponent{setPropsFromAttrs(){const{start:e,end:i,orient:n,previewData:o,previewPointsX:l,previewPointsY:u,previewPointsX1:d,previewPointsY1:f}=this.attribute;e&&(this.state.start=e),i&&(this.state.end=i);const{width:g,height:_}=this.getLayoutAttrFromConfig();this._spanCache=this.state.end-this.state.start,this._isHorizontal=n==="top"||n==="bottom",this._layoutCache.max=this._isHorizontal?g:_,this._layoutCache.attPos=this._isHorizontal?"x":"y",this._layoutCache.attSize=this._isHorizontal?"width":"height",o&&(this._previewData=o),isFunction(l)&&(this._previewPointsX=l),isFunction(u)&&(this._previewPointsY=u),isFunction(d)&&(this._previewPointsX1=d),isFunction(f)&&(this._previewPointsY1=f)}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Ve.defaultAttributes,e)),this.name="dataZoom",this._previewData=[],this._activeState=!1,this._activeCache={startPos:{x:0,y:0},lastPos:{x:0,y:0}},this._layoutCache={attPos:"x",attSize:"width",max:0},this.state={start:0,end:1},this._statePointToData=l=>l,this._onHandlerPointerDown=(l,u)=>{l.stopPropagation(),u==="start"?(this._activeTag=DataZoomActiveTag.startHandler,this._activeItem=this._startHandlerMask):u==="end"?(this._activeTag=DataZoomActiveTag.endHandler,this._activeItem=this._endHandlerMask):u==="middleRect"?(this._activeTag=DataZoomActiveTag.middleHandler,this._activeItem=this._middleHandlerRect):u==="middleSymbol"?(this._activeTag=DataZoomActiveTag.middleHandler,this._activeItem=this._middleHandlerSymbol):u==="background"&&(this._activeTag=DataZoomActiveTag.background,this._activeItem=this._background),this._activeState=!0,this._activeCache.startPos=this.eventPosToStagePos(l),this._activeCache.lastPos=this.eventPosToStagePos(l),vglobal.env==="browser"&&(vglobal.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),vglobal.addEventListener("pointerup",this._onHandlerPointerUp)),this.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0})},this._pointerMove=l=>{l.stopPropagation();const{start:u,end:d,brushSelect:f,realTime:g=!0}=this.attribute,_=this.eventPosToStagePos(l),{attPos:y,max:b}=this._layoutCache,S=(_[y]-this._activeCache.lastPos[y])/b;let{start:v,end:A}=this.state;this._activeState&&(this._activeTag===DataZoomActiveTag.middleHandler?this.moveZoomWithMiddle((this.state.start+this.state.end)/2+S):this._activeTag===DataZoomActiveTag.startHandler?v+S>A?(v=A,A=v+S,this._activeTag=DataZoomActiveTag.endHandler):v+=S:this._activeTag===DataZoomActiveTag.endHandler&&(A+S<v?(A=v,v=A+S,this._activeTag=DataZoomActiveTag.startHandler):A+=S),this._activeCache.lastPos=_,f&&this.renderDragMask()),v=Math.min(Math.max(v,0),1),A=Math.min(Math.max(A,0),1),u===v&&d===A||(this.setStateAttr(v,A,!0),g&&this._dispatchEvent("change",{start:v,end:A,tag:this._activeTag}))},this._onHandlerPointerMove=this.attribute.delayTime===0?this._pointerMove:delayMap$2[this.attribute.delayType](this._pointerMove,this.attribute.delayTime),this._onHandlerPointerUp=l=>{l.preventDefault();const{start:u,end:d,brushSelect:f,realTime:g=!0}=this.attribute;if(this._activeState&&this._activeTag===DataZoomActiveTag.background){const _=this.eventPosToStagePos(l);this.backgroundDragZoom(this._activeCache.startPos,_)}this._activeState=!1,f&&this.renderDragMask(),u===this.state.start&&d===this.state.end||(this.setStateAttr(this.state.start,this.state.end,!0),this._dispatchEvent("change",{start:this.state.start,end:this.state.end,tag:this._activeTag})),vglobal.env==="browser"&&(vglobal.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),vglobal.removeEventListener("pointerup",this._onHandlerPointerUp)),this.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.removeEventListener("pointerup",this._onHandlerPointerUp)};const{position:n,showDetail:o}=e;this._activeCache.startPos=n,this._activeCache.lastPos=n,this._showText=o!=="auto"&&o,this.setPropsFromAttrs()}setAttributes(e,i){super.setAttributes(e,i),this.setPropsFromAttrs()}bindEvents(){if(this.attribute.disableTriggerEvent)return void this.setAttribute("childrenPickable",!1);const{showDetail:e,brushSelect:i}=this.attribute;this._startHandlerMask&&this._startHandlerMask.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,"start")),this._endHandlerMask&&this._endHandlerMask.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,"end")),this._middleHandlerSymbol&&this._middleHandlerSymbol.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,"middleSymbol")),this._middleHandlerRect&&this._middleHandlerRect.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,"middleRect"));const n=i?"background":"middleRect";this._selectedBackground&&this._selectedBackground.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,n)),i&&this._background&&this._background.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,"background")),i&&this._previewGroup&&this._previewGroup.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,"background")),this._selectedPreviewGroup&&this._selectedPreviewGroup.addEventListener("pointerdown",o=>this._onHandlerPointerDown(o,n)),this.addEventListener("pointerup",this._onHandlerPointerUp),this.addEventListener("pointerupoutside",this._onHandlerPointerUp),e==="auto"&&(this.addEventListener("pointerenter",this._onHandlerPointerEnter),this.addEventListener("pointerleave",this._onHandlerPointerLeave))}dragMaskSize(){const{position:e}=this.attribute,{attPos:i,max:n}=this._layoutCache;return this._activeCache.lastPos[i]-e[i]>n?n+e[i]-this._activeCache.startPos[i]:this._activeCache.lastPos[i]-e[i]<0?e[i]-this._activeCache.startPos[i]:this._activeCache.lastPos[i]-this._activeCache.startPos[i]}setStateAttr(e,i,n){const{zoomLock:o=!1,minSpan:l=0,maxSpan:u=1}=this.attribute,d=i-e;d!==this._spanCache&&(o||d<l||d>u)||(this._spanCache=d,this.state.start=e,this.state.end=i,n&&this.setAttributes({start:e,end:i}))}eventPosToStagePos(e){return this.stage.eventPointTransform(e)}_onHandlerPointerEnter(e){e.stopPropagation(),this._showText=!0,this.renderText()}_onHandlerPointerLeave(e){e.stopPropagation(),this._showText=!1,this.renderText()}backgroundDragZoom(e,i){const{attPos:n,max:o}=this._layoutCache,{position:l}=this.attribute,u=e[n]-l[n],d=i[n]-l[n],f=Math.min(Math.max(Math.min(u,d)/o,0),1),g=Math.min(Math.max(Math.max(u,d)/o,0),1);Math.abs(f-g)<.01?this.moveZoomWithMiddle(f):this.setStateAttr(f,g,!1)}moveZoomWithMiddle(e){let i=e-(this.state.start+this.state.end)/2;i!==0&&(i>0?this.state.end+i>1&&(i=1-this.state.end):i<0&&this.state.start+i<0&&(i=-this.state.start),this.setStateAttr(this.state.start+i,this.state.end+i,!1))}renderDragMask(){const{dragMaskStyle:e}=this.attribute,{position:i,width:n,height:o}=this.getLayoutAttrFromConfig();this._isHorizontal?this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:clamp(this.dragMaskSize()<0?this._activeCache.lastPos.x:this._activeCache.startPos.x,i.x,i.x+n),y:i.y,width:this._activeState&&this._activeTag===DataZoomActiveTag.background&&Math.abs(this.dragMaskSize())||0,height:o},e),"rect"):this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:i.x,y:clamp(this.dragMaskSize()<0?this._activeCache.lastPos.y:this._activeCache.startPos.y,i.y,i.y+o),width:n,height:this._activeState&&this._activeTag===DataZoomActiveTag.background&&Math.abs(this.dragMaskSize())||0},e),"rect")}isTextOverflow(e,i,n){if(!i)return!1;if(this._isHorizontal){if(n==="start"){if(i.x1<e.x1)return!0}else if(i.x2>e.x2)return!0}else if(n==="start"){if(i.y1<e.y1)return!0}else if(i.y2>e.y2)return!0;return!1}setTextAttr(e,i){var n,o,l,u,d,f,g,_;const{startTextStyle:y,endTextStyle:b}=this.attribute,{formatMethod:S}=y,v=__rest$l(y,["formatMethod"]),{formatMethod:A}=b,x=__rest$l(b,["formatMethod"]),{start:T,end:C}=this.state;this._startValue=this._statePointToData(T),this._endValue=this._statePointToData(C);const{position:E,width:P,height:L}=this.getLayoutAttrFromConfig(),R=S?S(this._startValue):this._startValue,w=A?A(this._endValue):this._endValue,D={x1:E.x,y1:E.y,x2:E.x+P,y2:E.y+L};let I,O,B,N;this._isHorizontal?(I={x:E.x+T*P,y:E.y+L/2},O={x:E.x+C*P,y:E.y+L/2},B={textAlign:this.isTextOverflow(D,e,"start")?"left":"right",textBaseline:(o=(n=v==null?void 0:v.textStyle)===null||n===void 0?void 0:n.textBaseline)!==null&&o!==void 0?o:"middle"},N={textAlign:this.isTextOverflow(D,i,"end")?"right":"left",textBaseline:(u=(l=x==null?void 0:x.textStyle)===null||l===void 0?void 0:l.textBaseline)!==null&&u!==void 0?u:"middle"}):(I={x:E.x+P/2,y:E.y+T*L},O={x:E.x+P/2,y:E.y+C*L},B={textAlign:(f=(d=v==null?void 0:v.textStyle)===null||d===void 0?void 0:d.textAlign)!==null&&f!==void 0?f:"center",textBaseline:this.isTextOverflow(D,e,"start")?"top":"bottom"},N={textAlign:(_=(g=x==null?void 0:x.textStyle)===null||g===void 0?void 0:g.textAlign)!==null&&_!==void 0?_:"center",textBaseline:this.isTextOverflow(D,i,"end")?"bottom":"top"}),this._startText=this.maybeAddLabel(this._container,merge$1({},v,{text:R,x:I.x,y:I.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:B}),`data-zoom-start-text-${E}`),this._endText=this.maybeAddLabel(this._container,merge$1({},x,{text:w,x:O.x,y:O.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:N}),`data-zoom-end-text-${E}`)}renderText(){let e=null,i=null;this.setTextAttr(e,i),e=this._startText.AABBBounds,i=this._endText.AABBBounds,this.setTextAttr(e,i),e=this._startText.AABBBounds,i=this._endText.AABBBounds;const{x1:n,x2:o,y1:l,y2:u}=e,{dx:d=0,dy:f=0}=this.attribute.startTextStyle;if(new Bounds().set(n,l,o,u).intersects(i)){const g=this.attribute.orient==="bottom"||this.attribute.orient==="right"?-1:1;this._isHorizontal?this._startText.setAttribute("dy",f+g*Math.abs(i.y1-i.y2)):this._startText.setAttribute("dx",d+g*Math.abs(i.x1-i.x2))}else this._isHorizontal?this._startText.setAttribute("dy",f):this._startText.setAttribute("dx",d)}getLayoutAttrFromConfig(){var e,i,n,o,l,u;if(this._layoutAttrFromConfig)return this._layoutAttrFromConfig;const{position:d,size:f,orient:g,middleHandlerStyle:_={},startHandlerStyle:y={},endHandlerStyle:b={},backgroundStyle:S={}}=this.attribute,{width:v,height:A}=f,x=(i=(e=_.background)===null||e===void 0?void 0:e.size)!==null&&i!==void 0?i:10;let T,C,E;_.visible?this._isHorizontal?(T=v,C=A-x,E={x:d.x,y:d.y+x}):(T=v-x,C=A,E={x:d.x+(g==="left"?x:0),y:d.y}):(T=v,C=A,E=d);const P=(n=y.size)!==null&&n!==void 0?n:this._isHorizontal?C:T,L=(o=b.size)!==null&&o!==void 0?o:this._isHorizontal?C:T;return y.visible&&(this._isHorizontal?(T-=(P+L)/2,E={x:E.x+P/2,y:E.y}):(C-=(P+L)/2,E={x:E.x,y:E.y+P/2})),C+=(l=S.lineWidth/2)!==null&&l!==void 0?l:1,T+=(u=S.lineWidth/2)!==null&&u!==void 0?u:1,this._layoutAttrFromConfig={position:E,width:T,height:C},this._layoutAttrFromConfig}render(){var e,i,n,o,l,u,d,f,g,_,y,b,S,v,A,x,T,C,E,P,L,R,w,D,I,O,B,N,$,H,F,V,G,Y;this._layoutAttrFromConfig=null;const{orient:J,backgroundStyle:q,backgroundChartStyle:te={},selectedBackgroundStyle:de={},selectedBackgroundChartStyle:he={},middleHandlerStyle:fe={},startHandlerStyle:pe={},endHandlerStyle:me={},brushSelect:ee,zoomLock:Q}=this.attribute,{start:ie,end:le}=this.state,{position:ce,width:z,height:W}=this.getLayoutAttrFromConfig(),K=(e=pe.triggerMinSize)!==null&&e!==void 0?e:40,ne=(i=me.triggerMinSize)!==null&&i!==void 0?i:40,se=this.createOrUpdateChild("dataZoom-container",{},"group");if(this._container=se,this._background=se.createOrUpdateChild("background",Object.assign(Object.assign({x:ce.x,y:ce.y,width:z,height:W,cursor:ee?"crosshair":"auto"},q),{pickable:!Q&&((n=q.pickable)===null||n===void 0||n)}),"rect"),!((o=te.line)===null||o===void 0)&&o.visible&&this.setPreviewAttributes("line",se),!((l=te.area)===null||l===void 0)&&l.visible&&this.setPreviewAttributes("area",se),ee&&this.renderDragMask(),this._isHorizontal?this._selectedBackground=se.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:ce.x+ie*z,y:ce.y,width:(le-ie)*z,height:W,cursor:ee?"crosshair":"move"},de),{pickable:!Q&&((u=he.pickable)===null||u===void 0||u)}),"rect"):this._selectedBackground=se.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:ce.x,y:ce.y+ie*W,width:z,height:(le-ie)*W,cursor:ee?"crosshair":"move"},de),{pickable:!Q&&((d=de.pickable)===null||d===void 0||d)}),"rect"),!((f=he.line)===null||f===void 0)&&f.visible&&this.setSelectedPreviewAttributes("line",se),!((g=he.area)===null||g===void 0)&&g.visible&&this.setSelectedPreviewAttributes("area",se),this._isHorizontal){if(fe.visible){const re=((_=fe.background)===null||_===void 0?void 0:_.size)||10;this._middleHandlerRect=se.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:ce.x+ie*z,y:ce.y-re,width:(le-ie)*z,height:re},(y=fe.background)===null||y===void 0?void 0:y.style),{pickable:!Q&&((v=(S=(b=fe.background)===null||b===void 0?void 0:b.style)===null||S===void 0?void 0:S.pickable)===null||v===void 0||v)}),"rect"),this._middleHandlerSymbol=se.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:ce.x+(ie+le)/2*z,y:ce.y-re/2,strokeBoundsBuffer:0,angle:0,symbolType:(x=(A=fe.icon)===null||A===void 0?void 0:A.symbolType)!==null&&x!==void 0?x:"square"},fe.icon),{pickable:!Q&&((T=fe.icon.pickable)===null||T===void 0||T)}),"symbol")}this._startHandler=se.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:ce.x+ie*z,y:ce.y+W/2,size:W,symbolType:(C=pe.symbolType)!==null&&C!==void 0?C:"square"},DEFAULT_HANDLER_ATTR_MAP.horizontal),pe),{pickable:!Q&&((E=pe.pickable)===null||E===void 0||E)}),"symbol"),this._endHandler=se.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:ce.x+le*z,y:ce.y+W/2,size:W,symbolType:(P=me.symbolType)!==null&&P!==void 0?P:"square"},DEFAULT_HANDLER_ATTR_MAP.horizontal),me),{pickable:!Q&&((L=me.pickable)===null||L===void 0||L)}),"symbol");const ae=Math.max(this._startHandler.AABBBounds.width(),K),j=Math.max(this._startHandler.AABBBounds.height(),K),U=Math.max(this._endHandler.AABBBounds.width(),ne),X=Math.max(this._endHandler.AABBBounds.height(),ne);this._startHandlerMask=se.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:ce.x+ie*z-ae/2,y:ce.y+W/2-j/2,width:ae,height:j,fill:"white",fillOpacity:0,zIndex:999},DEFAULT_HANDLER_ATTR_MAP.horizontal),{pickable:!Q}),"rect"),this._endHandlerMask=se.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:ce.x+le*z-U/2,y:ce.y+W/2-X/2,width:U,height:X,fill:"white",fillOpacity:0,zIndex:999},DEFAULT_HANDLER_ATTR_MAP.horizontal),{pickable:!Q}),"rect")}else{if(fe.visible){const re=((R=fe.background)===null||R===void 0?void 0:R.size)||10;this._middleHandlerRect=se.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:J==="left"?ce.x-re:ce.x+z,y:ce.y+ie*W,width:re,height:(le-ie)*W},(w=fe.background)===null||w===void 0?void 0:w.style),{pickable:!Q&&((O=(I=(D=fe.background)===null||D===void 0?void 0:D.style)===null||I===void 0?void 0:I.pickable)===null||O===void 0||O)}),"rect"),this._middleHandlerSymbol=se.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:J==="left"?ce.x-re/2:ce.x+z+re/2,y:ce.y+(ie+le)/2*W,angle:Math.PI/180*90,symbolType:(N=(B=fe.icon)===null||B===void 0?void 0:B.symbolType)!==null&&N!==void 0?N:"square",strokeBoundsBuffer:0},fe.icon),{pickable:!Q&&((H=($=fe.icon)===null||$===void 0?void 0:$.pickable)===null||H===void 0||H)}),"symbol")}this._startHandler=se.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:ce.x+z/2,y:ce.y+ie*W,size:z,symbolType:(F=pe.symbolType)!==null&&F!==void 0?F:"square"},DEFAULT_HANDLER_ATTR_MAP.vertical),pe),{pickable:!Q&&((V=pe.pickable)===null||V===void 0||V)}),"symbol"),this._endHandler=se.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:ce.x+z/2,y:ce.y+le*W,size:z,symbolType:(G=me.symbolType)!==null&&G!==void 0?G:"square"},DEFAULT_HANDLER_ATTR_MAP.vertical),me),{pickable:!Q&&((Y=me.pickable)===null||Y===void 0||Y)}),"symbol");const ae=Math.max(this._startHandler.AABBBounds.width(),K),j=Math.max(this._startHandler.AABBBounds.height(),K),U=Math.max(this._endHandler.AABBBounds.width(),ne),X=Math.max(this._endHandler.AABBBounds.height(),ne);this._startHandlerMask=se.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:ce.x+z/2+ae/2,y:ce.y+ie*W-j/2,width:X,height:U,fill:"white",fillOpacity:0,zIndex:999},DEFAULT_HANDLER_ATTR_MAP.vertical),{pickable:!Q}),"rect"),this._endHandlerMask=se.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:ce.x+z/2+U/2,y:ce.y+le*W-X/2,width:X,height:U,fill:"white",fillOpacity:0,zIndex:999},DEFAULT_HANDLER_ATTR_MAP.vertical),{pickable:!Q}),"rect")}this._showText&&this.renderText()}computeBasePoints(){const{orient:e}=this.attribute,{position:i,width:n,height:o}=this.getLayoutAttrFromConfig();let l,u;return this._isHorizontal?(l=[{x:i.x,y:i.y+o}],u=[{x:i.x+n,y:i.y+o}]):e==="left"?(l=[{x:i.x+n,y:i.y}],u=[{x:i.x+n,y:i.y+o}]):(l=[{x:i.x,y:i.y+o}],u=[{x:i.x,y:i.y}]),{basePointStart:l,basePointEnd:u}}simplifyPoints(e){var i;if(e.length>1e4){const n=(i=this.attribute.tolerance)!==null&&i!==void 0?i:this._previewData.length/1e4;return flatten_simplify(e,n)}return e}getPreviewLinePoints(){let e=this._previewData.map(o=>({x:this._previewPointsX&&this._previewPointsX(o),y:this._previewPointsY&&this._previewPointsY(o)}));if(e.length===0)return e;e=this.simplifyPoints(e);const{basePointStart:i,basePointEnd:n}=this.computeBasePoints();return i.concat(e).concat(n)}getPreviewAreaPoints(){let e=this._previewData.map(o=>({x:this._previewPointsX&&this._previewPointsX(o),y:this._previewPointsY&&this._previewPointsY(o),x1:this._previewPointsX1&&this._previewPointsX1(o),y1:this._previewPointsY1&&this._previewPointsY1(o)}));if(e.length===0)return e;e=this.simplifyPoints(e);const{basePointStart:i,basePointEnd:n}=this.computeBasePoints();return i.concat(e).concat(n)}setPreviewAttributes(e,i){this._previewGroup||(this._previewGroup=i.createOrUpdateChild("previewGroup",{pickable:!1},"group")),e==="line"?this._previewLine=this._previewGroup.createOrUpdateChild("previewLine",{},"line"):this._previewArea=this._previewGroup.createOrUpdateChild("previewArea",{curveType:"basis"},"area");const{backgroundChartStyle:n={}}=this.attribute;e==="line"&&this._previewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},n.line)),e==="area"&&this._previewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},n.area))}setSelectedPreviewAttributes(e,i){this._selectedPreviewGroupClip||(this._selectedPreviewGroupClip=i.createOrUpdateChild("selectedPreviewGroupClip",{pickable:!1},"group"),this._selectedPreviewGroup=this._selectedPreviewGroupClip.createOrUpdateChild("selectedPreviewGroup",{},"group")),e==="line"?this._selectedPreviewLine=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewLine",{},"line"):this._selectedPreviewArea=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewArea",{curveType:"basis"},"area");const{selectedBackgroundChartStyle:n={}}=this.attribute,{start:o,end:l}=this.state,{position:u,width:d,height:f}=this.getLayoutAttrFromConfig();this._selectedPreviewGroupClip.setAttributes({x:this._isHorizontal?u.x+o*d:u.x,y:this._isHorizontal?u.y:u.y+o*f,width:this._isHorizontal?(l-o)*d:d,height:this._isHorizontal?f:(l-o)*f,clip:!0,pickable:!1}),this._selectedPreviewGroup.setAttributes({x:-(this._isHorizontal?u.x+o*d:u.x),y:-(this._isHorizontal?u.y:u.y+o*f),width:this._isHorizontal?(l-o)*d:d,height:this._isHorizontal?f:(l-o)*f,pickable:!1}),e==="line"&&this._selectedPreviewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},n.line)),e==="area"&&this._selectedPreviewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},n.area))}maybeAddLabel(e,i,n){let o=this.find(l=>l.name===n,!0);return o?o.setAttributes(i):(o=new Tag(i),o.name=n),e.add(o),o}setStartAndEnd(e,i){const{start:n,end:o}=this.attribute;isValid(e)&&isValid(i)&&(e!==this.state.start||i!==this.state.end)&&(this.state.start=e,this.state.end=i,n===this.state.start&&o===this.state.end||(this.setStateAttr(e,i,!0),this._dispatchEvent("change",{start:e,end:i,tag:this._activeTag})))}setPreviewData(e){this._previewData=e}setText(e,i){i==="start"?this._startText.setAttribute("text",e):this._endText.setAttribute("text",e)}getStartValue(){return this._startValue}getEndTextValue(){return this._endValue}getMiddleHandlerSize(){var e,i,n,o;const{middleHandlerStyle:l={}}=this.attribute,u=(i=(e=l.background)===null||e===void 0?void 0:e.size)!==null&&i!==void 0?i:10,d=(o=(n=l.icon)===null||n===void 0?void 0:n.size)!==null&&o!==void 0?o:10;return Math.max(u,...array(d))}setPreviewPointsX(e){isFunction(e)&&(this._previewPointsX=e)}setPreviewPointsY(e){isFunction(e)&&(this._previewPointsY=e)}setPreviewPointsX1(e){isFunction(e)&&(this._previewPointsX1=e)}setPreviewPointsY1(e){isFunction(e)&&(this._previewPointsY1=e)}setStatePointToData(e){isFunction(e)&&(this._statePointToData=e)}};DataZoom$1.defaultAttributes=DEFAULT_DATA_ZOOM_ATTRIBUTES;var IMarkLineLabelPosition;(function(r){r.start="start",r.startTop="startTop",r.startBottom="startBottom",r.insideStart="insideStart",r.insideStartTop="insideStartTop",r.insideStartBottom="insideStartBottom",r.middle="middle",r.insideMiddleTop="insideMiddleTop",r.insideMiddleBottom="insideMiddleBottom",r.end="end",r.endTop="endTop",r.endBottom="endBottom",r.insideEnd="insideEnd",r.insideEndTop="insideEndTop",r.insideEndBottom="insideEndBottom"})(IMarkLineLabelPosition||(IMarkLineLabelPosition={}));var IMarkAreaLabelPosition;(function(r){r.left="left",r.right="right",r.top="top",r.bottom="bottom",r.topLeft="topLeft",r.topRight="topRight",r.bottomLeft="bottomLeft",r.bottomRight="bottomRight",r.middle="middle",r.insideLeft="insideLeft",r.insideRight="insideRight",r.insideTop="insideTop",r.insideBottom="insideBottom",r.insideTopLeft="insideTopLeft",r.insideTopRight="insideTopRight",r.insideBottomLeft="insideBottomLeft",r.insideBottomRight="insideBottomRight"})(IMarkAreaLabelPosition||(IMarkAreaLabelPosition={}));var IMarkCommonArcLabelPosition;(function(r){r.arcInnerStart="arcInnerStart",r.arcInnerEnd="arcInnerEnd",r.arcInnerMiddle="arcInnerMiddle",r.arcOuterStart="arcOuterStart",r.arcOuterEnd="arcOuterEnd",r.arcOuterMiddle="arcOuterMiddle",r.center="center"})(IMarkCommonArcLabelPosition||(IMarkCommonArcLabelPosition={}));var IMarkPointItemPosition;(function(r){r.top="top",r.bottom="bottom",r.middle="middle",r.insideTop="insideTop",r.insideBottom="insideBottom",r.insideMiddle="insideMiddle"})(IMarkPointItemPosition||(IMarkPointItemPosition={}));function loadBaseMarker(){registerGroup(),loadTagComponent()}function loadMarkLineComponent(){loadBaseMarker(),loadSegmentComponent()}function loadMarkArcLineComponent(){loadBaseMarker(),loadArcSegmentComponent()}function loadMarkAreaComponent(){loadBaseMarker(),registerPolygon()}function loadMarkArcAreaComponent(){loadBaseMarker(),registerArc()}function loadMarkPointComponent(){loadBaseMarker(),loadSegmentComponent(),loadArcSegmentComponent(),registerSymbol(),registerImage(),registerLine()}class Marker extends AbstractComponent{constructor(){super(...arguments),this.name="marker",this._onHover=e=>{this._lastHover=dispatchHoverState(e,this._container,this._lastHover)},this._onUnHover=e=>{this._lastHover=dispatchUnHoverState(e,this._container,this._lastHover)},this._onClick=e=>{this._lastSelect=dispatchClickState(e,this._container,this._lastSelect)}}transAnimationConfig(){var e,i,n;if(this.attribute.animation!==!1){const o=isObject$1(this.attribute.animation)?this.attribute.animation:{};this._animationConfig={enter:merge$1({},this.defaultUpdateAnimation,o,(e=this.attribute.animationEnter)!==null&&e!==void 0?e:{}),exit:merge$1({},this.defaultExitAnimation,o,(i=this.attribute.animationExit)!==null&&i!==void 0?i:{}),update:merge$1({},this.defaultUpdateAnimation,o,(n=this.attribute.animationUpdate)!==null&&n!==void 0?n:{})}}}setAttribute(e,i,n){super.setAttribute(e,i,n),e==="visible"&&this.render()}_bindEvent(){var e,i,n;if(!this.attribute.interactive)return;const{hover:o,select:l}=this.attribute;o&&((e=this._container)===null||e===void 0||e.addEventListener("pointermove",this._onHover),(i=this._container)===null||i===void 0||i.addEventListener("pointerout",this._onUnHover)),l&&((n=this._container)===null||n===void 0||n.addEventListener("pointerdown",this._onClick))}_releaseEvent(){var e,i,n;(e=this._container)===null||e===void 0||e.removeEventListener("pointermove",this._onHover),(i=this._container)===null||i===void 0||i.removeEventListener("pointerout",this._onUnHover),(n=this._container)===null||n===void 0||n.removeEventListener("pointerdown",this._onClick)}_initContainer(){var e,i;const{limitRect:n={},clipInRange:o}=this.attribute;let l;if(o){const u=graphicCreator.group(Object.assign(Object.assign({},n),{clip:!0,pickable:!1}));l=graphicCreator.group({x:-((e=n.x)!==null&&e!==void 0?e:0),y:-((i=n.y)!==null&&i!==void 0?i:0),pickable:!1}),u.add(l),this._containerClip=u,this.add(u)}else l=graphicCreator.group({x:0,y:0,pickable:!1}),this.add(l);l.name="marker-container",this._container=l}_updateContainer(){var e,i;const{limitRect:n={},clipInRange:o}=this.attribute;this._containerClip&&this._containerClip.setAttributes(Object.assign({},n)),this._container.setAttributes({x:o?-((e=n.x)!==null&&e!==void 0?e:0):0,y:o?-((i=n.y)!==null&&i!==void 0?i:0):0})}render(){var e;this.transAnimationConfig(),this.setAttribute("pickable",!1);const i=(e=this.attribute.visible)===null||e===void 0||e;this.attribute.interactive===!1&&this.setAttribute("childrenPickable",!1),i&&this.isValidPoints()?this._container?(this._updateContainer(),this.updateMarker(),this.markerAnimate("update")):(this._initContainer(),this.initMarker(this._container),this.markerAnimate("enter")):(this.markerAnimate("exit"),this._container=null,this.removeAllChild(!0)),this._releaseEvent(),this._bindEvent()}release(){this.markerAnimate("exit"),super.release(),this._releaseEvent(),this._container=null}}function graphicFadeIn(r,e,i,n){var o,l,u,d,f;if(!r)return;(o=r==null?void 0:r.animates)===null||o===void 0||o.forEach(y=>y.stop("end"));const g=(u=(l=r.attribute)===null||l===void 0?void 0:l.fillOpacity)!==null&&u!==void 0?u:1,_=(f=(d=r.attribute)===null||d===void 0?void 0:d.strokeOpacity)!==null&&f!==void 0?f:1;r.setAttributes({fillOpacity:0,strokeOpacity:0}),r.animate().wait(e).to({fillOpacity:g,strokeOpacity:_},i,n)}function segmentFadeIn(r,e,i,n){r&&(graphicFadeIn(r.startSymbol,e,i,n),r.lines.forEach(o=>graphicFadeIn(o,e,i,n)),graphicFadeIn(r.line,e,i,n),graphicFadeIn(r.endSymbol,e,i,n))}function tagFadeIn(r,e,i,n){r&&(graphicFadeIn(r.getTextShape(),e,i,n),graphicFadeIn(r.getBgRect(),e,i,n))}function graphicFadeOut(r,e,i,n){var o,l,u,d;r&&(r.setAttributes({fillOpacity:(l=(o=r.attribute)===null||o===void 0?void 0:o.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(d=(u=r.attribute)===null||u===void 0?void 0:u.strokeOpacity)!==null&&d!==void 0?d:1}),r.animate().wait(e).to({fillOpacity:0,strokeOpacity:0},i,n))}function segmentFadeOut(r,e,i,n){r&&(graphicFadeOut(r.startSymbol,e,i,n),r.lines.forEach(o=>graphicFadeOut(o,e,i,n)),graphicFadeOut(r.line,e,i,n),graphicFadeOut(r.endSymbol,e,i,n))}function tagFadeOut(r,e,i,n){r&&(graphicFadeOut(r.getTextShape(),e,i,n),graphicFadeOut(r.getBgRect(),e,i,n))}function commonLineClipIn(r,e,i,n,o){const l=.1*i,u=.7*i,d=.1*i,f=.1*i;graphicFadeIn(r.startSymbol,n,l,o),r.lines.forEach(g=>g.setAttribute("clipRange",0)),r.lines.forEach((g,_)=>{const y=u/r.lines.length;g.animate().wait(n+l+_*y).to({clipRange:1},y,o)}),graphicFadeIn(r.endSymbol,n+l+u,d,o),graphicFadeIn(e.getTextShape(),n+l+u+d,f,o),graphicFadeIn(e.getBgRect(),n+l+u+d,f,o)}function commonLineFadeIn(r,e,i,n,o){segmentFadeIn(r,n,i,o),tagFadeIn(e,n,i,o)}function areaFadeIn(r,e,i,n,o){graphicFadeIn(r,n,i,o),tagFadeIn(e,n,i,o)}function arcAreaFadeIn(r,e,i,n,o){graphicFadeIn(r,n,i,o),tagFadeIn(e,n,i,o)}function pointFadeIn(r,e,i,n,o,l){var u;segmentFadeIn(r,o,n,l),graphicFadeIn(e,o,n,l),!((u=i.getTextShape)===null||u===void 0)&&u.call(i)?tagFadeIn(i,o,n,l):graphicFadeIn(i,o,n,l)}function commonLineFadeOut(r,e,i,n,o){segmentFadeOut(r,n,i,o),tagFadeOut(e,n,i,o)}function areaFadeOut(r,e,i,n,o){graphicFadeOut(r,n,i,o),tagFadeOut(e,n,i,o)}function arcAreaFadeOut(r,e,i,n,o){graphicFadeOut(r,n,i,o),tagFadeOut(e,n,i,o)}function pointFadeOut(r,e,i,n,o,l){var u;segmentFadeOut(r,o,n,l),graphicFadeOut(e,o,n,l),!((u=i.getTextShape)===null||u===void 0)&&u.call(i)?tagFadeOut(i,o,n,l):graphicFadeOut(i,o,n,l)}function pointCallIn(r,e,i,n,o,l){var u;const d=.1*n,f=.65*n,g=.05*n,_=.1*n,y=.1*n;graphicFadeIn(r.startSymbol,o,d,l),r.lines.forEach(b=>b.setAttribute("clipRange",0)),r.lines.forEach((b,S)=>{const v=f/r.lines.length;b.animate().wait(o+d+S*v).to({clipRange:1},v,l)}),graphicFadeIn(e,o+d+f,g,l),graphicFadeIn(r.endSymbol,o+d+f+g,_,l),!((u=i.getTextShape)===null||u===void 0)&&u.call(i)?(graphicFadeIn(i.getTextShape(),o+d+f+g+_,y,l),graphicFadeIn(i.getBgRect(),o+d+f+_,y,l)):graphicFadeIn(i,o+d+f+_,y,l)}function markCommonLineAnimate(r,e,i,n){const{enter:o,update:l,exit:u}=i;if(n==="enter"){const{type:d,duration:f,delay:g,easing:_}=o;d==="clipIn"?commonLineClipIn(r,e,f,g,_):d==="fadeIn"&&commonLineFadeIn(r,e,f,g,_)}else if(n==="update"){const{type:d,duration:f,delay:g,easing:_}=l;d==="clipIn"?commonLineClipIn(r,e,f,g,_):d==="fadeIn"&&commonLineFadeIn(r,e,f,g,_)}else if(n==="exit"){const{duration:d,delay:f,easing:g}=u;commonLineFadeOut(r,e,d,f,g)}}function markAreaAnimate(r,e,i,n){const{enter:o,update:l,exit:u}=i;if(n==="enter"){const{type:d,duration:f,delay:g,easing:_}=o;d==="fadeIn"&&areaFadeIn(r,e,f,g,_)}else if(n==="update"){const{type:d,duration:f,delay:g,easing:_}=l;d==="fadeIn"&&areaFadeIn(r,e,f,g,_)}else if(n==="exit"){const{duration:d,delay:f,easing:g}=u;areaFadeOut(r,e,d,f,g)}}function markArcAreaAnimate(r,e,i,n){const{enter:o,update:l,exit:u}=i;if(n==="enter"){const{type:d,duration:f,delay:g,easing:_}=o;d==="fadeIn"&&arcAreaFadeIn(r,e,f,g,_)}else if(n==="update"){const{type:d,duration:f,delay:g,easing:_}=l;d==="fadeIn"&&arcAreaFadeIn(r,e,f,g,_)}else if(n==="exit"){const{duration:d,delay:f,easing:g}=u;arcAreaFadeOut(r,e,d,f,g)}}function markPointAnimate(r,e,i,n){const[o,l]=r,{enter:u,update:d,exit:f}=i;if(n==="enter"){const{type:g,duration:_,delay:y,easing:b}=u;g==="fadeIn"?pointFadeIn(o,l,e,_,y,b):g==="callIn"&&pointCallIn(o,l,e,_,y,b)}else if(n==="update"){const{type:g,duration:_,delay:y,easing:b}=d;g==="fadeIn"?pointFadeIn(o,l,e,_,y,b):g==="callIn"&&pointCallIn(o,l,e,_,y,b)}else if(n==="exit"){const{duration:g,delay:_,easing:y}=f;pointFadeOut(o,l,e,g,_,y)}}const DefaultUpdateMarkLineAnimation={type:"clipIn",duration:500,easing:"linear",delay:0},DefaultUpdateMarkAreaAnimation={type:"fadeIn",duration:500,easing:"linear",delay:0},DefaultUpdateMarkPointAnimation={type:"callIn",duration:500,easing:"linear",delay:0},DefaultExitMarkerAnimation={type:"fadeOut",duration:500,easing:"linear",delay:0};class MarkCommonLine extends Marker{constructor(){super(...arguments),this.name="markCommonLine",this.defaultUpdateAnimation=DefaultUpdateMarkLineAnimation,this.defaultExitAnimation=DefaultExitMarkerAnimation}getLine(){return this._line}getLabel(){return this._label}setLabelPos(){const{label:e={},limitRect:i}=this.attribute,{position:n,confine:o,autoRotate:l}=e,u=this.getPointAttrByPosition(n),d=n.toString().toLocaleLowerCase().includes("start")?this._line.getStartAngle()||0:this._line.getEndAngle()||0;if(this._label.setAttributes(Object.assign(Object.assign({},u.position),{angle:l?this.getRotateByAngle(u.angle):0,textStyle:Object.assign(Object.assign({},this.getTextStyle(n,d,l)),e.textStyle)})),i&&o){const{x:f,y:g,width:_,height:y}=i;limitShapeInBounds(this._label,{x1:f,y1:g,x2:f+_,y2:g+y})}}initMarker(e){const{label:i,state:n}=this.attribute,o=this.createSegment();o.name="mark-common-line-line",this._line=o,e.add(o);const l=new Tag(Object.assign(Object.assign({},i),{state:{panel:merge$1({},DEFAULT_STATES$2,n==null?void 0:n.labelBackground),text:merge$1({},DEFAULT_STATES$2,n==null?void 0:n.label)}}));l.name="mark-common-line-label",this._label=l,e.add(l),this.setLabelPos()}updateMarker(){const{label:e,state:i}=this.attribute;this.setLineAttributes(),this._label&&(this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},e),{state:{panel:merge$1({},DEFAULT_STATES$2,i==null?void 0:i.labelBackground),text:merge$1({},DEFAULT_STATES$2,i==null?void 0:i.label)}})),this.setLabelPos())}}const FUZZY_EQUAL_DELTA=.001,DEFAULT_MARK_LINE_THEME={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{position:IMarkLineLabelPosition.end,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},DEFAULT_CARTESIAN_MARK_LINE_TEXT_STYLE_MAP={postiveXAxis:{start:{textAlign:"left",textBaseline:"middle"},startTop:{textAlign:"left",textBaseline:"bottom"},startBottom:{textAlign:"left",textBaseline:"top"},insideStart:{textAlign:"right",textBaseline:"middle"},insideStartTop:{textAlign:"right",textBaseline:"bottom"},insideStartBottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"left",textBaseline:"middle"},endTop:{textAlign:"left",textBaseline:"bottom"},endBottom:{textAlign:"left",textBaseline:"top"},insideEnd:{textAlign:"right",textBaseline:"middle"},insideEndTop:{textAlign:"right",textBaseline:"bottom"},insideEndBottom:{textAlign:"right",textBaseline:"top"}},negativeXAxis:{start:{textAlign:"right",textBaseline:"middle"},startTop:{textAlign:"right",textBaseline:"bottom"},startBottom:{textAlign:"right",textBaseline:"top"},insideStart:{textAlign:"left",textBaseline:"middle"},insideStartTop:{textAlign:"left",textBaseline:"bottom"},insideStartBottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"right",textBaseline:"middle"},endTop:{textAlign:"right",textBaseline:"bottom"},endBottom:{textAlign:"right",textBaseline:"top"},insideEnd:{textAlign:"left",textBaseline:"middle"},insideEndTop:{textAlign:"left",textBaseline:"bottom"},insideEndBottom:{textAlign:"left",textBaseline:"top"}}},DEFAULT_MARK_ARC_LINE_THEME={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{position:IMarkCommonArcLabelPosition.arcOuterMiddle,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},DEFAULT_MARK_AREA_THEME={interactive:!0,label:{position:IMarkAreaLabelPosition.right,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}},DEFAULT_MARK_ARC_AREA_THEME={interactive:!0,label:{position:IMarkCommonArcLabelPosition.arcOuterMiddle,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}},DEFAULT_POLAR_MARKER_TEXT_STYLE_MAP={arcInnerStart:{textAlign:"center",textBaseline:"bottom"},arcInnerEnd:{textAlign:"center",textBaseline:"bottom"},arcInnerMiddle:{textAlign:"center",textBaseline:"bottom"},arcOuterStart:{textAlign:"center",textBaseline:"top"},arcOuterEnd:{textAlign:"center",textBaseline:"top"},arcOuterMiddle:{textAlign:"center",textBaseline:"top"},center:{textAlign:"center",textBaseline:"middle"}},DEFAULT_CARTESIAN_MARK_AREA_TEXT_STYLE_MAP={left:{textAlign:"right",textBaseline:"middle"},insideLeft:{textAlign:"left",textBaseline:"middle"},right:{textAlign:"left",textBaseline:"middle"},insideRight:{textAlign:"right",textBaseline:"middle"},top:{textAlign:"center",textBaseline:"bottom"},insideTop:{textAlign:"center",textBaseline:"top"},bottom:{textAlign:"center",textBaseline:"top"},insideBottom:{textAlign:"center",textBaseline:"bottom"},middle:{textAlign:"center",textBaseline:"middle"},topLeft:{textAlign:"right",textBaseline:"top"},insideTopLeft:{textAlign:"left",textBaseline:"top"},topRight:{textAlign:"left",textBaseline:"top"},insideTopRight:{textAlign:"right",textBaseline:"top"},bottomLeft:{textAlign:"right",textBaseline:"bottom"},insideBottomLeft:{textAlign:"left",textBaseline:"bottom"},bottomRight:{textAlign:"left",textBaseline:"bottom"},insideBottomRight:{textAlign:"right",textBaseline:"bottom"}},DEFAULT_MARK_POINT_THEME={interactive:!0,targetSymbol:{visible:!1,offset:0,style:{symbolType:"circle",size:20,fill:!1,stroke:"rgba(46, 47, 50)"}},itemLine:{visible:!0,decorativeLine:{visible:!1,length:30},startSymbol:{visible:!0,clip:!0,symbolType:"circle",size:20,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},endSymbol:{visible:!1,clip:!0,symbolType:"triangle",size:12,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},lineStyle:{stroke:"#000",lineWidth:1}},itemContent:{type:"text",position:"middle",refX:10,symbolStyle:{symbolType:"star",fill:"rgb(48, 115, 242)",fillOpacity:.8,size:20},textStyle:{dx:0,dy:0},imageStyle:{width:80,height:80},richTextStyle:{width:100,height:100}}},DEFAULT_MARK_POINT_TEXT_STYLE_MAP={postiveXAxis:{top:{textAlign:"left",textBaseline:"bottom"},bottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"left",textBaseline:"middle"},insideTop:{textAlign:"right",textBaseline:"bottom"},insideBottom:{textAlign:"right",textBaseline:"top"},insideMiddle:{textAlign:"right",textBaseline:"middle"}},negativeXAxis:{top:{textAlign:"right",textBaseline:"bottom"},bottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"right",textBaseline:"middle"},insideTop:{textAlign:"left",textBaseline:"bottom"},insideBottom:{textAlign:"left",textBaseline:"top"},insideMiddle:{textAlign:"left",textBaseline:"middle"}}};loadMarkLineComponent();function registerMarkLineAnimate(){MarkLine._animate=markCommonLineAnimate}class MarkLine extends MarkCommonLine{markerAnimate(e){MarkLine._animate&&this._animationConfig&&MarkLine._animate(this._line,this._label,this._animationConfig,e)}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},MarkLine.defaultAttributes,e)),this.name="markLine"}getPointAttrByPosition(e){var i;const{label:n={}}=this.attribute,{refX:o=0,refY:l=0}=n,u=this._line.getMainSegmentPoints(),d=(i=this._line.getEndAngle())!==null&&i!==void 0?i:0,f=d,g=o*Math.cos(f)+l*Math.cos(f-Math.PI/2),_=o*Math.sin(f)+l*Math.sin(f-Math.PI/2);return e.includes("start")||e.includes("Start")?{position:{x:u[0].x+g,y:u[0].y+_},angle:f}:e.includes("middle")||e.includes("Middle")?{position:{x:(u[0].x+u[u.length-1].x)/2+g,y:(u[0].y+u[u.length-1].y)/2+_},angle:f}:{position:{x:u[u.length-1].x+g,y:u[u.length-1].y+_},angle:f}}getRotateByAngle(e){var i;return(isPostiveXAxis(e)?e:e-Math.PI)+((i=this.attribute.label.refAngle)!==null&&i!==void 0?i:0)}getTextStyle(e,i,n){return fuzzyEqualNumber(Math.abs(i),Math.PI/2,FUZZY_EQUAL_DELTA)||fuzzyEqualNumber(Math.abs(i),3*Math.PI/2,FUZZY_EQUAL_DELTA)?getTextAlignAttrOfVerticalDir(n,i,e):isPostiveXAxis(i)?DEFAULT_CARTESIAN_MARK_LINE_TEXT_STYLE_MAP.postiveXAxis[e]:DEFAULT_CARTESIAN_MARK_LINE_TEXT_STYLE_MAP.negativeXAxis[e]}createSegment(){const{points:e,startSymbol:i,endSymbol:n,lineStyle:o,mainSegmentIndex:l,multiSegment:u,state:d}=this.attribute;return new Segment({points:e,startSymbol:i,endSymbol:n,lineStyle:o,mainSegmentIndex:l,multiSegment:u,pickable:!1,state:{line:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.line),startSymbol:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.lineStartSymbol),endSymbol:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.lineEndSymbol)}})}setLineAttributes(){const{points:e,startSymbol:i,endSymbol:n,lineStyle:o,mainSegmentIndex:l,multiSegment:u,state:d}=this.attribute;this._line&&this._line.setAttributes({points:e,startSymbol:i,endSymbol:n,lineStyle:o,mainSegmentIndex:l,multiSegment:u,state:{line:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.line),startSymbol:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.lineStartSymbol),endSymbol:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.lineEndSymbol)}})}isValidPoints(){const{points:e}=this.attribute;if(!e||e.length<2)return!1;let i=!0;return e.forEach(n=>{if(n.length)n.forEach(o=>{isValidNumber(o.x)&&isValidNumber(o.y)||(i=!1)});else if(!isValidNumber(n.x)||!isValidNumber(n.y))return void(i=!1)}),i}}MarkLine.defaultAttributes=DEFAULT_MARK_LINE_THEME;loadMarkAreaComponent();function registerMarkAreaAnimate(){MarkArea._animate=markAreaAnimate}class MarkArea extends Marker{markerAnimate(e){MarkArea._animate&&this._animationConfig&&MarkArea._animate(this._area,this._label,this._animationConfig,e)}getArea(){return this._area}getLabel(){return this._label}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},MarkArea.defaultAttributes,e)),this.name="markArea",this.defaultUpdateAnimation=DefaultUpdateMarkAreaAnimation,this.defaultExitAnimation=DefaultExitMarkerAnimation}getPointAttrByPosition(e){const{x1:i,x2:n,y1:o,y2:l}=this._area.AABBBounds,u={x:(i+n)/2,y:(o+l)/2};return(e.includes("left")||e.includes("Left"))&&(u.x=i),(e.includes("right")||e.includes("Right"))&&(u.x=n),(e.includes("top")||e.includes("Top"))&&(u.y=o),(e.includes("bottom")||e.includes("Bottom"))&&(u.y=l),u}setLabelPos(){var e;if(this._label&&this._area){const{label:i={}}=this.attribute,n=(e=i.position)!==null&&e!==void 0?e:"middle",o=this.getPointAttrByPosition(n);if(this._label.setAttributes(Object.assign(Object.assign({},o),{textStyle:Object.assign(Object.assign({},DEFAULT_CARTESIAN_MARK_AREA_TEXT_STYLE_MAP[n]),i.textStyle)})),this.attribute.limitRect&&i.confine){const{x:l,y:u,width:d,height:f}=this.attribute.limitRect;limitShapeInBounds(this._label,{x1:l,y1:u,x2:l+d,y2:u+f})}}}initMarker(e){const{points:i,label:n,areaStyle:o,state:l}=this.attribute,u=graphicCreator.polygon(Object.assign({points:i},o));u.states=merge$1({},DEFAULT_STATES$2,l==null?void 0:l.area),u.name="mark-area-polygon",this._area=u,e.add(u);const d=new Tag(Object.assign(Object.assign({},n),{state:{panel:merge$1({},DEFAULT_STATES$2,l==null?void 0:l.labelBackground),text:merge$1({},DEFAULT_STATES$2,l==null?void 0:l.label)}}));d.name="mark-area-label",this._label=d,e.add(d),this.setLabelPos()}updateMarker(){const{points:e,label:i,areaStyle:n,state:o}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({points:e},n)),this._area.states=merge$1({},DEFAULT_STATES$2,o==null?void 0:o.area)),this._label&&this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},i),{state:{panel:merge$1({},DEFAULT_STATES$2,o==null?void 0:o.labelBackground),text:merge$1({},DEFAULT_STATES$2,o==null?void 0:o.label)}})),this.setLabelPos()}isValidPoints(){const{points:e}=this.attribute;if(!e||e.length<3)return!1;let i=!0;return e.forEach(n=>{isValidNumber(n.x)&&isValidNumber(n.y)||(i=!1)}),i}}MarkArea.defaultAttributes=DEFAULT_MARK_AREA_THEME;loadMarkArcLineComponent();function registerMarkArcLineAnimate(){MarkArcLine._animate=markCommonLineAnimate}class MarkArcLine extends MarkCommonLine{markerAnimate(e){MarkArcLine._animate&&this._animationConfig&&MarkArcLine._animate(this._line,this._label,this._animationConfig,e)}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},MarkArcLine.defaultAttributes,e,{label:{autoRotate:!0}})),this.name="markArcLine"}getPointAttrByPosition(e){const{center:i,radius:n,startAngle:o,endAngle:l,label:u}=this.attribute,{refX:d=0,refY:f=0}=u;let g;switch(e){case IMarkCommonArcLabelPosition.arcInnerStart:g=o;case IMarkCommonArcLabelPosition.arcOuterStart:g=o;break;case IMarkCommonArcLabelPosition.arcInnerEnd:g=l;case IMarkCommonArcLabelPosition.arcOuterEnd:g=l;break;case IMarkCommonArcLabelPosition.center:case IMarkCommonArcLabelPosition.arcInnerMiddle:case IMarkCommonArcLabelPosition.arcOuterMiddle:default:g=(o+l)/2}return{position:{x:i.x+(n+f)*Math.cos(g)+d*Math.cos(g-Math.PI/2),y:i.y+(n+f)*Math.sin(g)+d*Math.sin(g-Math.PI/2)},angle:g}}getTextStyle(e){return DEFAULT_POLAR_MARKER_TEXT_STYLE_MAP[e]}getRotateByAngle(e){var i;return e-Math.PI/2+((i=this.attribute.label.refAngle)!==null&&i!==void 0?i:0)}createSegment(){const{center:e,radius:i,startAngle:n,endAngle:o,startSymbol:l,endSymbol:u,lineStyle:d,state:f}=this.attribute;return new ArcSegment({center:e,radius:i,startAngle:n,endAngle:o,startSymbol:l,endSymbol:u,lineStyle:d,state:{line:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.line),startSymbol:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.lineStartSymbol),endSymbol:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.lineEndSymbol)}})}setLineAttributes(){const{center:e,radius:i,startAngle:n,endAngle:o,startSymbol:l,endSymbol:u,lineStyle:d,state:f}=this.attribute;this._line&&this._line.setAttributes({center:e,radius:i,startAngle:n,endAngle:o,startSymbol:l,endSymbol:u,lineStyle:d,state:{line:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.line),startSymbol:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.lineStartSymbol),endSymbol:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.lineEndSymbol)}})}isValidPoints(){return!0}}MarkArcLine.defaultAttributes=DEFAULT_MARK_ARC_LINE_THEME;loadMarkArcAreaComponent();function registerMarkArcAreaAnimate(){MarkArcArea._animate=markArcAreaAnimate}class MarkArcArea extends Marker{markerAnimate(e){MarkArcArea._animate&&this._animationConfig&&MarkArcArea._animate(this._area,this._label,this._animationConfig,e)}getArea(){return this._area}getLabel(){return this._label}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},MarkArcArea.defaultAttributes,e,{label:{autoRotate:!0}})),this.name="markArcArea",this.defaultUpdateAnimation=DefaultUpdateMarkAreaAnimation,this.defaultExitAnimation=DefaultExitMarkerAnimation}getPointAttrByPosition(e){const{center:i,innerRadius:n,outerRadius:o,startAngle:l,endAngle:u,label:d}=this.attribute,{refX:f=0,refY:g=0}=d;let _,y;switch(e){case IMarkCommonArcLabelPosition.center:_=(n+o)/2,y=(l+u)/2;break;case IMarkCommonArcLabelPosition.arcInnerStart:_=n,y=l;break;case IMarkCommonArcLabelPosition.arcOuterStart:_=o,y=l;break;case IMarkCommonArcLabelPosition.arcInnerEnd:_=n,y=u;break;case IMarkCommonArcLabelPosition.arcOuterEnd:_=o,y=u;break;case IMarkCommonArcLabelPosition.arcInnerMiddle:_=n,y=(l+u)/2;break;case IMarkCommonArcLabelPosition.arcOuterMiddle:_=o,y=(l+u)/2;break;default:_=n,y=(l+u)/2}return{position:{x:i.x+(_+g)*Math.cos(y)+f*Math.cos(y-Math.PI/2),y:i.y+(_+g)*Math.sin(y)+f*Math.sin(y-Math.PI/2)},angle:y}}setLabelPos(){var e;if(this._label&&this._area){const{label:i={}}=this.attribute,{position:n="arcInnerMiddle",autoRotate:o}=i,l=this.getPointAttrByPosition(n);if(this._label.setAttributes(Object.assign(Object.assign({},l.position),{angle:o?l.angle-Math.PI/2+((e=i.refAngle)!==null&&e!==void 0?e:0):0,textStyle:Object.assign(Object.assign({},DEFAULT_POLAR_MARKER_TEXT_STYLE_MAP[n]),i.textStyle)})),this.attribute.limitRect&&i.confine){const{x:u,y:d,width:f,height:g}=this.attribute.limitRect;limitShapeInBounds(this._label,{x1:u,y1:d,x2:u+f,y2:d+g})}}}initMarker(e){const{center:i,innerRadius:n,outerRadius:o,startAngle:l,endAngle:u,areaStyle:d,label:f,state:g}=this.attribute,_=graphicCreator.arc(Object.assign({x:i.x,y:i.y,innerRadius:n,outerRadius:o,startAngle:l,endAngle:u},d));_.states=merge$1({},DEFAULT_STATES$2,g==null?void 0:g.area),_.name="polar-mark-area-area",this._area=_,e.add(_);const y=new Tag(Object.assign(Object.assign({},f),{state:{panel:merge$1({},DEFAULT_STATES$2,g==null?void 0:g.labelBackground),text:merge$1({},DEFAULT_STATES$2,g==null?void 0:g.label)}}));y.name="mark-area-label",this._label=y,e.add(y),this.setLabelPos()}updateMarker(){const{center:e,innerRadius:i,outerRadius:n,startAngle:o,endAngle:l,areaStyle:u,label:d,state:f}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({x:e.x,y:e.y,innerRadius:i,outerRadius:n,startAngle:o,endAngle:l},u)),this._area.states=merge$1({},DEFAULT_STATES$2,f==null?void 0:f.area)),this._label&&(this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},d),{state:{panel:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.labelBackground),text:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.label)}})),this.setLabelPos())}isValidPoints(){return!0}}MarkArcArea.defaultAttributes=DEFAULT_MARK_ARC_AREA_THEME;loadMarkPointComponent();function registerMarkPointAnimate(){MarkPoint._animate=markPointAnimate}class MarkPoint extends Marker{markerAnimate(e){MarkPoint._animate&&this._animationConfig&&MarkPoint._animate([this._line,this._decorativeLine],this._item,this._animationConfig,e)}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},MarkPoint.defaultAttributes,e)),this.name="markPoint",this.defaultUpdateAnimation=DefaultUpdateMarkPointAnimation,this.defaultExitAnimation=DefaultExitMarkerAnimation,this._isArcLine=!1,this._isStraightLine=!1}setLabelPos(){}getTextAlignAttr(e,i,n,o,l){return fuzzyEqualNumber(Math.abs(o),Math.PI/2,FUZZY_EQUAL_DELTA)||fuzzyEqualNumber(Math.abs(o),3*Math.PI/2,FUZZY_EQUAL_DELTA)?getTextAlignAttrOfVerticalDir(e,o,l):isPostiveXAxis(o)?DEFAULT_MARK_POINT_TEXT_STYLE_MAP.postiveXAxis[l]:DEFAULT_MARK_POINT_TEXT_STYLE_MAP.negativeXAxis[l]}setItemAttributes(e,i,n,o,l){var u,d;if(!e)return;const{autoRotate:f=!0,refX:g=0,refY:_=0,refAngle:y=0,textStyle:b={},richTextStyle:S={},imageStyle:v={},position:A=IMarkPointItemPosition.middle}=i,{state:x}=this.attribute,T=((u=this._line)===null||u===void 0?void 0:u.getEndAngle())||0,C=g*Math.cos(T)+_*Math.cos(T-Math.PI/2),E=g*Math.sin(T)+_*Math.sin(T-Math.PI/2);if(l==="text"){const L=o.x-n.x,R=o.y-n.y;e.setAttributes(Object.assign(Object.assign({},b),{textStyle:Object.assign(Object.assign({},this.getTextAlignAttr(f,L,R,T,(d=i.position)!==null&&d!==void 0?d:"end")),b.textStyle),state:{panel:merge$1({},DEFAULT_STATES$2,x==null?void 0:x.textBackground),text:merge$1({},DEFAULT_STATES$2,x==null?void 0:x.text)}}))}else l==="richText"?(e.setAttributes({dx:this.getItemDx(e,A,S)+(S.dx||0),dy:this.getItemDy(e,A,S)+(S.dy||0)}),e.states=merge$1({},DEFAULT_STATES$2,x==null?void 0:x.richText)):l==="image"&&(e.setAttributes({dx:this.getItemDx(e,A,v)+(v.dx||0),dy:this.getItemDy(e,A,v)+(v.dy||0)}),e.states=merge$1({},DEFAULT_STATES$2,x==null?void 0:x.image));const P=isPostiveXAxis(T)?T:T-Math.PI;e.setAttributes({x:o.x+(C||0),y:o.y+(E||0),angle:f&&P+y})}getItemDx(e,i,n){var o,l;const u=(l=(o=e==null?void 0:e.AABBBounds)===null||o===void 0?void 0:o.width())!==null&&l!==void 0?l:(n==null?void 0:n.width)||0;return i.includes("inside")?-u:0}getItemDy(e,i,n){var o,l;const u=(l=(o=e==null?void 0:e.AABBBounds)===null||o===void 0?void 0:o.height())!==null&&l!==void 0?l:(n==null?void 0:n.height)||0;return i.includes("top")||i.includes("Top")?-u:i.includes("middle")||i.includes("Middle")?-u/2:0}initItem(e,i,n){const{state:o}=this.attribute,{type:l="text",symbolStyle:u,richTextStyle:d,imageStyle:f,renderCustomCallback:g}=e;let _;return l==="symbol"?(_=graphicCreator.symbol(Object.assign(Object.assign({},n),u)),_.states=merge$1({},DEFAULT_STATES$2,o==null?void 0:o.symbol)):l==="text"?_=new Tag(Object.assign(Object.assign({},n),{state:{panel:merge$1({},DEFAULT_STATES$2,o==null?void 0:o.textBackground),text:merge$1({},DEFAULT_STATES$2,o==null?void 0:o.text)}})):l==="richText"?(_=graphicCreator.richtext(Object.assign(Object.assign({},n),d)),_.states=merge$1({},DEFAULT_STATES$2,o==null?void 0:o.richText)):l==="image"?(_=graphicCreator.image(Object.assign(Object.assign({},n),f)),_.states=merge$1({},DEFAULT_STATES$2,o==null?void 0:o.image)):l==="custom"&&g&&(_=g(),_.states=merge$1({},DEFAULT_STATES$2,o==null?void 0:o.customMark)),_.name=`mark-point-${l}`,this.setItemAttributes(_,e,i,n,l),_}getItemLineAttr(e,i,n){let o=[],l={x:0,y:0},u=0,d=0,f=0;const{type:g="type-s",arcRatio:_=.8}=e,y=n.x-i.x,b=n.y-i.y;if(this._isStraightLine=fuzzyEqualNumber(y,0,FUZZY_EQUAL_DELTA)||fuzzyEqualNumber(b,0,FUZZY_EQUAL_DELTA),this._isArcLine){const{x:S,y:v}=this.attribute.position,{x:A,y:x}=n,T=(S+A)/2,C=(v+x)/2,E=v===x?0:-(S-A)/(v-x),P=T+_*(x>v?-1:1)*T,L=(D=>E*(D-T)+C)(P);d=deltaXYToAngle(v-L,S-P),f=deltaXYToAngle(x-L,A-P),l={x:P,y:L};const R=Math.sqrt((P-S)*(P-S)+(L-v)*(L-v)),w=this.attribute.targetSymbol.style.size/2;d+=2*Math.acos(Math.sqrt(1-w*w/(4*R*R))),_>0?f<d&&(f+=2*Math.PI):d<f&&(d+=2*Math.PI),u=Math.sqrt((P-S)*(P-S)+(L-v)*(L-v))}else o=g!=="type-do"||this._isStraightLine?g!=="type-po"||this._isStraightLine?g!=="type-op"||this._isStraightLine?[i,n]:[i,{x:i.x,y:n.y},n]:[i,{x:n.x,y:i.y},n]:[i,{x:(i.x+n.x)/2,y:n.y},n];return o=removeRepeatPoint(o),{points:o,center:l,radius:u,startAngle:d,endAngle:f}}reDrawLine(e,i){this._line.release();const{startSymbol:n,endSymbol:o,lineStyle:l,type:u="type-s"}=e,{state:d}=this.attribute,f=this._isArcLine?ArcSegment:Segment;this._container.removeChild(this._line),this._line=new f(Object.assign(Object.assign({},i),{pickable:!1,startSymbol:n,endSymbol:o,lineStyle:l,visible:e.visible,state:{line:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.line),startSymbol:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.lineStartSymbol),endSymbol:merge$1({},DEFAULT_STATES$2,d==null?void 0:d.lineEndSymbol)}})),this._container.add(this._line)}setItemLineAttr(e,i,n){if(this._line){const{startSymbol:o,endSymbol:l,lineStyle:u,type:d="type-s"}=e,{state:f}=this.attribute,g=this.getItemLineAttr(e,i,n);this._isArcLine&&this._line.key==="arc-segment"||!this._isArcLine&&this._line.key==="segment"?this._line.setAttributes(Object.assign(Object.assign({},g),{startSymbol:o,endSymbol:l,lineStyle:u,visible:e.visible,state:{line:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.line),startSymbol:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.lineStartSymbol),endSymbol:merge$1({},DEFAULT_STATES$2,f==null?void 0:f.lineEndSymbol)}})):this.reDrawLine(e,g)}}getDecorativeLineAttr(e){var i;const n=((i=e==null?void 0:e.decorativeLine)===null||i===void 0?void 0:i.length)||10,o=this._line.getEndAngle()||0;return{startPointOffsetX:n/2*Math.cos(o-Math.PI/2),startPointOffsetY:n/2*Math.sin(o-Math.PI/2),endPointOffsetX:-n/2*Math.cos(o-Math.PI/2),endPointOffsetY:-n/2*Math.sin(o-Math.PI/2)}}setDecorativeLineAttr(e,i,n){var o;if(this._decorativeLine){const{lineStyle:l}=e,{startPointOffsetX:u,startPointOffsetY:d,endPointOffsetX:f,endPointOffsetY:g}=this.getDecorativeLineAttr(e);this._decorativeLine.setAttributes(Object.assign(Object.assign({points:[{x:i.x+u,y:i.y+d},{x:i.x+f,y:i.y+g}]},l),{visible:n})),this._decorativeLine.states=merge$1({},DEFAULT_STATES$2,(o=this.attribute.state)===null||o===void 0?void 0:o.line)}}setTargetItemAttributes(e,i){var n,o;this._targetItem&&(this._targetItem.setAttributes(Object.assign({x:i.x,y:i.y,visible:(n=e.visible)!==null&&n!==void 0&&n,size:e.size},e.style)),this._targetItem.states=merge$1({},DEFAULT_STATES$2,(o=this.attribute.state)===null||o===void 0?void 0:o.targetItem))}setAllOfItemsAttr(e,i){var n;const{position:o,itemLine:l={},itemContent:u={},limitRect:d,targetSymbol:f}=this.attribute,{type:g="text",confine:_}=u;if(d&&_){const{x:y,y:b,width:S,height:v}=d,{dx:A,dy:x}=computeOffsetForlimit(this._item,{x1:y,y1:b,x2:y+S,y2:b+v});i.x=i.x+A,i.y=i.y+x}this.setTargetItemAttributes(f,o),this.setItemLineAttr(l,e,i),this.setItemAttributes(this._item,u,e,i,g),this.setDecorativeLineAttr(l,i,(n=l.decorativeLine)===null||n===void 0?void 0:n.visible)}computeNewPositionAfterTargetItem(e){var i,n;const{itemContent:o={},targetSymbol:l,itemLine:u}=this.attribute,{offsetX:d=0,offsetY:f=0}=o,{offset:g=0,style:_,visible:y=!1,size:b}=l,S=y?(n=(i=_.size)!==null&&i!==void 0?i:b)!==null&&n!==void 0?n:20:0;let v;return v=u.type==="type-do"?deltaXYToAngle(f,d/2):u.type==="type-po"?deltaXYToAngle(0,d):u.type==="type-op"?deltaXYToAngle(f,0):deltaXYToAngle(f,d),{newPosition:{x:e.x+(S/2+g)*Math.cos(v),y:e.y+(S/2+g)*Math.sin(v)},newItemPosition:{x:e.x+(S/2+g)*Math.cos(v)+d,y:e.y+(S/2+g)*Math.sin(v)+f}}}initMarker(e){const{position:i,itemContent:n={},itemLine:o}=this.attribute,{type:l="type-s",arcRatio:u=.8}=o,{offsetX:d=0,offsetY:f=0}=n;this._isStraightLine=fuzzyEqualNumber(d,0,FUZZY_EQUAL_DELTA)||fuzzyEqualNumber(f,0,FUZZY_EQUAL_DELTA),this._isArcLine=l==="type-arc"&&u!==0&&!this._isStraightLine;const{newPosition:g,newItemPosition:_}=this.computeNewPositionAfterTargetItem(i),y=new(this._isArcLine?ArcSegment:Segment)({points:[],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0});y.name="mark-point-line",this._line=y,e.add(y);const b=graphicCreator.line({points:[]});b.name="mark-point-decorativeLine",this._decorativeLine=b,e.add(b);const S=graphicCreator.symbol({});S.name="mark-point-targetItem",this._targetItem=S,e.add(this._targetItem);const v=this.initItem(n,g,_);this._item=v,e.add(v),this.setAllOfItemsAttr(g,_)}updateMarker(){const{position:e,itemContent:i={},itemLine:n}=this.attribute,{type:o="text"}=i,{type:l="type-s",arcRatio:u=.8}=n,{offsetX:d=0,offsetY:f=0}=i;this._isStraightLine=fuzzyEqualNumber(d,0,FUZZY_EQUAL_DELTA)||fuzzyEqualNumber(f,0,FUZZY_EQUAL_DELTA);const g=l==="type-arc"&&u!==0&&!this._isStraightLine,{newPosition:_,newItemPosition:y}=this.computeNewPositionAfterTargetItem(e);g!==this._isArcLine?(this._isArcLine=g,this.reDrawLine(n,{points:[{x:0,y:0}],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0})):this._isArcLine=g,this.setItemAttributes(this._item,i,_,y,o),this.setAllOfItemsAttr(_,y)}isValidPoints(){const{position:e}=this.attribute;return!(!isValidNumber(e.x)||!isValidNumber(e.y))}}MarkPoint.defaultAttributes=DEFAULT_MARK_POINT_THEME;function loadPagerComponent(){registerGroup(),registerSymbol(),registerText()}const DEFAULT_HANDLER_STYLE={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};loadPagerComponent();class Pager extends AbstractComponent{getCurrent(){return this._current}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Pager.defaultAttributes,e)),this.name="pager",this._current=1,this._onHover=n=>{const o=n.target;o.hasState("disable")||o.addState("hover")},this._onUnHover=n=>{n.target.removeState("hover")},this._onClick=n=>{const o=n.target;if(o.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?o.addState("disable"):o.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:n})}if(o.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?o.addState("disable"):o.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:n})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var e,i,n;this._reset();const{layout:o="horizontal",handler:l=DEFAULT_HANDLER_STYLE,total:u,defaultCurrent:d=1,textStyle:f,padding:g=0}=this.attribute;this._current=d;const _=normalizePadding$1(g),y=o==="horizontal",b=graphicCreator.group({x:0,y:0}),S=l.style||{},v=S.size||15,A=(e=l.space)!==null&&e!==void 0?e:8,x=l.state||{};let{preShape:T,nextShape:C}=l;T||(T=y?"triangleLeft":"triangleUp"),C||(C=y?"triangleRight":"triangleDown");const E=graphicCreator.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},S),{x:0,y:0,symbolType:T,size:v}));E.states=x,E.name="preHandler",this.preHandler=E,b.add(E);const{width:P,height:L}=measureTextSize(this._getPageText(u),Object.assign({textAlign:"center",textBaseline:"middle"},f),(n=(i=this.stage)===null||i===void 0?void 0:i.getTheme())===null||n===void 0?void 0:n.text),R=isNumber(v)?v:v[0],w=isNumber(v)?v:v[1],D=graphicCreator.text(Object.assign({x:y?R/2+A+P/2:0,y:y?0:w/2+A+L/2,text:this._getPageText(d),textAlign:"center",textBaseline:"middle",lineHeight:f==null?void 0:f.fontSize},f));this.text=D,b.add(D);const I=graphicCreator.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},S),{x:y?R+2*A+P:0,y:y?0:w+2*A+L,symbolType:C,size:v}));I.name="nextHandler",I.states=x,this.nextHandler=I,b.add(I),this._total===1?(E.addState("disable"),I.addState("disable")):this._current===1?E.addState("disable"):this._current===u&&I.addState("disable");const O=b.AABBBounds,B=O.width(),N=O.height();b.translateTo(0-O.x1+_[3],0-O.y1+_[0]),this.add(b),this.attribute.width=B+_[1]+_[3],this.attribute.height=N+_[0]+_[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(e){const{pageFormatter:i}=this.attribute;return i?isFunction(i)?i(e,this._total):`${i}`.replace("{current}",`${e}`).replace("{total}",`${this._total}`):`${e}/${this._total}`}setTotal(e){e!==this.attribute.total&&(this._total=e,this._current!==1&&this._current<=e?this.setAttributes({total:e,defaultCurrent:this._current}):this.setAttribute("total",e))}}Pager.defaultAttributes={handler:DEFAULT_HANDLER_STYLE,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const DEFAULT_SHAPE_SIZE=10,DEFAULT_SHAPE_SPACE=8,DEFAULT_LABEL_SPACE=8,DEFAULT_VALUE_SPACE=8,DEFAULT_ITEM_SPACE_COL=16,DEFAULT_ITEM_SPACE_ROW=8,DEFAULT_TITLE_SPACE=12,DEFAULT_PAGER_SPACE=12;var LegendStateValue;(function(r){r.selected="selected",r.unSelected="unSelected",r.selectedHover="selectedHover",r.unSelectedHover="unSelectedHover",r.focus="focus"})(LegendStateValue||(LegendStateValue={}));var LegendEvent;(function(r){r.legendItemHover="legendItemHover",r.legendItemUnHover="legendItemUnHover",r.legendItemClick="legendItemClick",r.legendItemAttributeUpdate="legendItemAttributeUpdate"})(LegendEvent||(LegendEvent={}));var LEGEND_ELEMENT_NAME;(function(r){r.innerView="innerView",r.title="legendTitle",r.item="legendItem",r.itemShape="legendItemShape",r.itemLabel="legendItemLabel",r.itemValue="legendItemValue",r.focus="legendItemFocus"})(LEGEND_ELEMENT_NAME||(LEGEND_ELEMENT_NAME={}));class LegendBase extends AbstractComponent{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:e=!0,title:i,padding:n=0}=this.attribute;this._parsedPadding=normalizePadding$1(n);const o=graphicCreator.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:e,childrenPickable:e});o.name=LEGEND_ELEMENT_NAME.innerView,this.add(o),this._innerView=o,i!=null&&i.visible&&this._renderTitle(i),this._renderContent(),this._adjustLayout(),e&&this._bindEvents();const l=this._innerView.AABBBounds;this.attribute.width=l.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=l.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(e){const{text:i="",textStyle:n,padding:o=0,background:l,minWidth:u,maxWidth:d,shape:f}=e,g={x:0,y:0,text:i,textStyle:n,padding:normalizePadding$1(o),minWidth:u,maxWidth:d};f&&f.visible&&(g.shape=Object.assign({visible:!0},f.style),isValid(f.space)&&(g.space=f.space)),l&&l.visible&&(g.panel=Object.assign({visible:!0},l.style));const _=new Tag(g);_.name=LEGEND_ELEMENT_NAME.title,this._title=_,this._innerView.add(_)}_adjustLayout(){var e;if(this._title){const i=this._innerView.AABBBounds.width(),n=this._title.AABBBounds.width(),o=(e=this.attribute.title)===null||e===void 0?void 0:e.align;o==="center"?this._title.setAttribute("x",(i-n)/2):o==="end"&&this._title.setAttribute("x",i-n)}}}function loadSliderComponent(){registerGroup(),registerText(),registerRect(),registerSymbol()}function loadBaseLegend(){registerGroup(),loadTagComponent()}function loadDiscreteLegendComponent(){loadBaseLegend(),loadPagerComponent(),loadScrollbarComponent()}function loadColorContinuousLegendComponent(){loadBaseLegend(),loadSliderComponent()}function loadSizeContinuousLegendComponent(){loadBaseLegend(),loadSliderComponent(),registerPath()}var __rest$k=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const DEFAULT_STATES={[LegendStateValue.focus]:{},[LegendStateValue.selected]:{},[LegendStateValue.selectedHover]:{},[LegendStateValue.unSelected]:{},[LegendStateValue.unSelectedHover]:{}};loadDiscreteLegendComponent();let DiscreteLegend$1=class He extends LegendBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},He.defaultAttributes,e)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=n=>{const o=n.target;if(o&&o.name&&o.name.startsWith(LEGEND_ELEMENT_NAME.item)){const l=o.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===l.id)return;this._unHover(this._lastActiveItem,n)}this._hover(l,n)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,n),this._lastActiveItem=null)},this._onUnHover=n=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,n),this._lastActiveItem=null)},this._onClick=n=>{var o,l,u,d;const f=n.target;if(f&&f.name&&f.name.startsWith(LEGEND_ELEMENT_NAME.item)){const g=f.delegate,{selectMode:_="multiple"}=this.attribute;if(f.name===LEGEND_ELEMENT_NAME.focus||_==="focus"){const y=g.hasState(LegendStateValue.focus);g.toggleState(LegendStateValue.focus),y?(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach(b=>{this._removeLegendItemState(b,[LegendStateValue.unSelected,LegendStateValue.unSelectedHover,LegendStateValue.focus],n),this._setLegendItemState(b,LegendStateValue.selected,n)}):(this._setLegendItemState(g,LegendStateValue.selected,n),this._removeLegendItemState(g,[LegendStateValue.unSelected,LegendStateValue.unSelectedHover],n),(l=this._itemsContainer)===null||l===void 0||l.getChildren().forEach(b=>{g!==b&&(this._removeLegendItemState(b,[LegendStateValue.selected,LegendStateValue.selectedHover,LegendStateValue.focus],n),this._setLegendItemState(b,LegendStateValue.unSelected,n))}))}else{(u=this._itemsContainer)===null||u===void 0||u.getChildren().forEach(v=>{v.removeState(LegendStateValue.focus)});const{allowAllCanceled:y=!0}=this.attribute,b=g.hasState(LegendStateValue.selected),S=this._getSelectedLegends();if(_==="multiple"){if(y===!1&&b&&S.length===1)return void this._dispatchLegendEvent(LegendEvent.legendItemClick,g,n);b?(this._removeLegendItemState(g,[LegendStateValue.selected,LegendStateValue.selectedHover],n),this._setLegendItemState(g,LegendStateValue.unSelected,n)):(this._setLegendItemState(g,LegendStateValue.selected,n),this._removeLegendItemState(g,[LegendStateValue.unSelected,LegendStateValue.unSelectedHover],n))}else this._setLegendItemState(g,LegendStateValue.selected,n),this._removeLegendItemState(g,[LegendStateValue.unSelected,LegendStateValue.unSelectedHover],n),(d=this._itemsContainer)===null||d===void 0||d.getChildren().forEach(v=>{g!==v&&(this._removeLegendItemState(v,[LegendStateValue.selected,LegendStateValue.selectedHover],n),this._setLegendItemState(v,LegendStateValue.unSelected,n))})}this._dispatchLegendEvent(LegendEvent.legendItemClick,g,n)}}}render(){super.render(),this._lastActiveItem=null}setSelected(e){var i;((i=this._itemsContainer)===null||i===void 0?void 0:i.getChildren()).forEach(n=>{const o=n.data;e.includes(o.label)?(this._setLegendItemState(n,LegendStateValue.selected),this._removeLegendItemState(n,[LegendStateValue.unSelected,LegendStateValue.unSelectedHover])):(this._removeLegendItemState(n,[LegendStateValue.selected,LegendStateValue.selectedHover]),this._setLegendItemState(n,LegendStateValue.unSelected))})}_renderItems(){const{item:e={},maxCol:i=1,maxRow:n=2,maxWidth:o,defaultSelected:l,lazyload:u,autoPage:d}=this.attribute,{spaceCol:f=DEFAULT_ITEM_SPACE_COL,spaceRow:g=DEFAULT_ITEM_SPACE_ROW,verticalAlign:_="middle"}=e,y=this._itemsContainer,{items:b,isHorizontal:S,startIndex:v,isScrollbar:A}=this._itemContext,x=A?1:S?n:i,T=this._contentMaxHeight;let C,{doWrap:E,maxWidthInCol:P,startX:L,startY:R,pages:w}=this._itemContext,D=0,I=0;const O=[];for(let B=v,N=b.length;B<N&&!(u&&w>this._itemContext.currentPage*x);B++){u&&(this._itemContext.startIndex=B+1),C=b[B],C.id||(C.id=C.label),C.index=B;let $=!0;isArray(l)&&($=l.includes(C.label));const H=this._renderEachItem(C,$,B,b),F=H.attribute.width,V=H.attribute.height;this._itemHeight=Math.max(this._itemHeight,V),P=Math.max(F,P),this._itemMaxWidth=Math.max(F,this._itemMaxWidth),S?(isValid(o)&&(A&&d?(w=Math.ceil((L+F)/o),E=w>1):L+F>o&&(E=!0,L>0&&(_!=="middle"&&_!=="bottom"||O.forEach(G=>{G.setAttributes({y:G.attribute.y+(I-G.attribute.height)/(_==="middle"?2:1)})}),w+=1,L=0,R+=I+g,I=0,O.length=0))),L===0&&R===0||H.setAttributes({x:L,y:R}),L+=f+F,I=Math.max(I,V),O.push(H)):(isValid(T)&&(A&&d?(w=Math.ceil((R+V)/T),E=w>1):T<=V?(w+=1,E=!0,R=0,B>0&&(L+=D+f)):T<R+V&&(w+=1,E=!0,R=0,L+=P+f,P=0)),L===0&&R===0||H.setAttributes({x:L,y:R}),R+=g+V),y.add(H),D=F}return!S||_!=="middle"&&_!=="bottom"||O.forEach(B=>{B.setAttributes({y:B.attribute.y+(I-B.attribute.height)/(_==="middle"?2:1)})}),this._itemContext.doWrap=E,this._itemContext.startX=L,this._itemContext.startY=R,this._itemContext.maxWidthInCol=P,this._itemContext.pages=w,this._itemContext.maxPages=x,A&&(this._itemContext.totalPage=w),u||(this._itemContext.startIndex=b.length),this._itemContext}_renderContent(){const{item:e={},items:i,reversed:n,maxWidth:o,maxHeight:l}=this.attribute;if(e.visible===!1||isEmpty(i))return;let u=i;n&&(u=i==null?void 0:i.reverse()),this._contentMaxHeight=Math.max(0,l-this._parsedPadding[0]-this._parsedPadding[2]);const d=graphicCreator.group({x:0,y:0});this._itemsContainer=d;const{layout:f,autoPage:g}=this.attribute,_=f==="horizontal",{maxWidth:y,width:b,height:S}=e,v=[];isValid(y)&&v.push(y),isValid(b)&&v.push(b),v.length&&(isValid(o)&&v.push(o),this._itemWidthByUser=minInArray(v)),isValid(S)&&(this._itemHeightByUser=S);const A=this.attribute.pager;this._itemContext={currentPage:A&&A.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:u,isHorizontal:_,totalPage:1/0,isScrollbar:A&&A.type==="scrollbar",clipContainer:void 0},this._itemContext=this._renderItems();let x=!1;this._itemContext.doWrap&&g&&this._itemContext.pages>this._itemContext.maxPages&&(x=this._renderPagerComponent()),x||(d.setAttribute("y",this._title?this._title.AABBBounds.height()+get(this.attribute,"title.space",8):0),this._innerView.add(d))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;const{hover:e=!0,select:i=!0}=this.attribute;if(e){let n="pointermove",o="pointerleave";isObject$1(e)&&(e.trigger&&(n=e.trigger),e.triggerOff&&(o=e.triggerOff)),this._itemsContainer.addEventListener(n,this._onHover),this._itemsContainer.addEventListener(o,this._onUnHover)}if(i){let n="pointerdown";isObject$1(i)&&i.trigger&&(n=i.trigger),this._itemsContainer.addEventListener(n,this._onClick)}}_autoEllipsis(e,i,n,o){var l,u;const{label:d,value:f}=this.attribute.item,g=o.AABBBounds,_=n.AABBBounds,y=g.width(),b=_.width();let S=!1;e==="labelFirst"?b>i?S=!0:o.setAttribute("maxLineWidth",i-b):e==="valueFirst"?y>i?S=!0:n.setAttribute("maxLineWidth",i-y):y+b>i&&(S=!0),S&&(o.setAttribute("maxLineWidth",Math.max(i*((l=d.widthRatio)!==null&&l!==void 0?l:.5),i-b)),n.setAttribute("maxLineWidth",Math.max(i*((u=f.widthRatio)!==null&&u!==void 0?u:.5),i-y)))}_renderEachItem(e,i,n,o){var l,u;const{id:d,label:f,value:g,shape:_}=e,{padding:y=0,focus:b,focusIconStyle:S,align:v,autoEllipsisStrategy:A}=this.attribute.item,{shape:x,label:T,value:C,background:E}=this.attribute.item,P=this._handleStyle(x,e,i,n,o),L=this._handleStyle(T,e,i,n,o),R=this._handleStyle(C,e,i,n,o),w=this._handleStyle(E,e,i,n,o),D=normalizePadding$1(y);let I;E.visible===!1?(I=graphicCreator.group({x:0,y:0,cursor:(l=w.style)===null||l===void 0?void 0:l.cursor}),this._appendDataToShape(I,LEGEND_ELEMENT_NAME.item,e,I)):(I=graphicCreator.group(Object.assign({x:0,y:0},w.style)),this._appendDataToShape(I,LEGEND_ELEMENT_NAME.item,e,I,w.state)),I.id=`${d??f}-${n}`,I.addState(i?LegendStateValue.selected:LegendStateValue.unSelected);const O=graphicCreator.group({x:0,y:0,pickable:!1});I.add(O);let B,N=0,$=0,H=0;if(x&&x.visible!==!1){const pe=get(P,"style.size",DEFAULT_SHAPE_SIZE);$=isArray(pe)?pe[0]||0:pe,H=get(x,"space",DEFAULT_SHAPE_SPACE);const me=graphicCreator.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},_),P.style));Object.keys(P.state||{}).forEach(ee=>{const Q=P.state[ee].fill||P.state[ee].stroke;_.fill&&isNil(P.state[ee].fill)&&Q&&(P.state[ee].fill=Q),_.stroke&&isNil(P.state[ee].stroke)&&Q&&(P.state[ee].stroke=Q)}),this._appendDataToShape(me,LEGEND_ELEMENT_NAME.itemShape,e,I,P.state),me.addState(i?LegendStateValue.selected:LegendStateValue.unSelected),O.add(me)}let F=0;if(b){const pe=get(S,"size",DEFAULT_SHAPE_SIZE);B=graphicCreator.symbol(Object.assign(Object.assign({x:0,y:-pe/2-1,strokeBoundsBuffer:0,boundsPadding:D},S),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(B,LEGEND_ELEMENT_NAME.focus,e,I),F=pe}const V=T.formatMethod?T.formatMethod(f,e,n):f,G=Object.assign(Object.assign({x:$/2+H,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(u=L.style)===null||u===void 0?void 0:u.fontSize},L.style),{text:V,_originText:T.formatMethod?f:void 0}),Y=createTextGraphicByType(G);this._appendDataToShape(Y,LEGEND_ELEMENT_NAME.itemLabel,e,I,L.state),Y.addState(i?LegendStateValue.selected:LegendStateValue.unSelected),O.add(Y);const J=get(T,"space",DEFAULT_LABEL_SPACE);if(isValid(g)){const pe=get(C,"space",b?DEFAULT_VALUE_SPACE:0),me=C.formatMethod?C.formatMethod(g,e,n):g,ee=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:R.style.fontSize},R.style),{text:me,_originText:C.formatMethod?g:void 0}),Q=createTextGraphicByType(ee);if(this._appendDataToShape(Q,LEGEND_ELEMENT_NAME.itemValue,e,I,R.state),Q.addState(i?LegendStateValue.selected:LegendStateValue.unSelected),this._itemWidthByUser){const ie=this._itemWidthByUser-D[1]-D[3]-$-H-J-F-pe;this._autoEllipsis(A,ie,Y,Q),C.alignRight?Q.setAttributes({textAlign:"right",x:this._itemWidthByUser-$/2-D[1]-D[3]-F-pe}):Q.setAttribute("x",J+(Y.AABBBounds.empty()?0:Y.AABBBounds.x2))}else Q.setAttribute("x",J+(Y.AABBBounds.empty()?0:Y.AABBBounds.x2));N=pe+(Q.AABBBounds.empty()?0:Q.AABBBounds.x2),O.add(Q)}else this._itemWidthByUser&&Y.setAttribute("maxLineWidth",this._itemWidthByUser-D[1]-D[3]-$-H-F),N=J+(Y.AABBBounds.empty()?0:Y.AABBBounds.x2);B&&(B.setAttribute("x",N),O.add(B));const q=O.AABBBounds,te=q.width();if(v==="right"){const pe=q.x2,me=q.x1;O.forEachChildren((ee,Q)=>{ee.type!=="symbol"&&ee.attribute.textAlign!=="right"||ee===B?ee.setAttribute("x",me+pe-ee.attribute.x-ee.AABBBounds.width()):ee.type!=="symbol"?ee.setAttributes({x:me+pe-ee.attribute.x,textAlign:"left"}):ee.setAttribute("x",me+pe-ee.attribute.x)})}const de=q.height(),he=isValid(this.attribute.item.width)?this.attribute.item.width:te+D[1]+D[3],fe=this._itemHeightByUser||de+D[0]+D[2];return I.attribute.width=he,I.attribute.height=fe,B&&B.setAttribute("visible",!1),O.translateTo(-q.x1+D[3],-q.y1+D[0]),I}_createPager(e){var i,n;const{disableTriggerEvent:o,maxRow:l}=this.attribute,u=d=>d<=99?99:d<=999?999:9999;return this._itemContext.isHorizontal?new Pager(Object.assign(Object.assign({layout:l===1?"horizontal":"vertical",total:u(this._itemContext.pages)},merge$1({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},e)),{defaultCurrent:(i=this.attribute.pager)===null||i===void 0?void 0:i.defaultCurrent,disableTriggerEvent:o})):new Pager(Object.assign({layout:"horizontal",total:u(this._itemContext.pages),disableTriggerEvent:o,defaultCurrent:(n=this.attribute.pager)===null||n===void 0?void 0:n.defaultCurrent},e))}_createScrollbar(e,i){const{disableTriggerEvent:n}=this.attribute;return this._itemContext.isHorizontal?new ScrollBar$1(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:n,range:[0,.5],height:e.visible===!1?0:12},e),{width:i})):new ScrollBar$1(Object.assign(Object.assign({direction:"vertical",width:e.visible===!1?0:12,range:[0,.5]},e),{height:i,disableTriggerEvent:n}))}_updatePositionOfPager(e,i,n){const{pager:o}=this.attribute,{totalPage:l,isHorizontal:u}=this._itemContext,d=o&&o.position||"middle";if(this._pagerComponent.setTotal(l),u){let f;f=d==="start"?e:d==="end"?e+n-this._pagerComponent.AABBBounds.height()/2:e+n/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:i-this._pagerComponent.AABBBounds.width(),y:f})}else{let f;f=d==="start"?0:d==="end"?i-this._pagerComponent.AABBBounds.width():(i-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:f,y:n-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:e,clipContainer:i}=this._itemContext,n=this._itemsContainer.AABBBounds,o=i.AABBBounds;let l,u;return e?(u=o.width(),l=u/n.width()):(u=o.height(),l=u/n.height()),l}_updatePositionOfScrollbar(e,i,n){const{isHorizontal:o,currentPage:l,totalPage:u}=this._itemContext,d=(l-1)/u;this._pagerComponent.setScrollRange([d,d+this._computeScrollbarDelta()]),o?this._pagerComponent.setAttributes({x:0,y:n+i}):this._pagerComponent.setAttributes({x:e,y:n})}_bindEventsOfPager(e,i){const n=this.attribute.pager||{},{animation:o=!0,animationDuration:l=450,animationEasing:u="quadIn"}=n,d=this._itemContext.isScrollbar?_=>{const{value:y}=_.detail;let b;return b=y[0]===0?1:y[1]===1?this._itemContext.totalPage:y[0]*this._itemContext.totalPage+1,b}:_=>_.detail.current,f=_=>{const y=this._pagerComponent,b=y.getScrollRange(),{direction:S}=y.attribute,{width:v,height:A}=y.getSliderRenderBounds(),x=S==="vertical"?_.deltaY/A:_.deltaX/v;y.setScrollRange([b[0]+x,b[1]+x],!0),this.updateScrollMask()},g=_=>{const y=d(_);if(y!==this._itemContext.currentPage){if(this._itemContext.currentPage=y,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const b=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=b,this._itemContext.isScrollbar&&this._pagerComponent){const S=this._computeScrollbarDelta(),[v]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([v,v+S])}}if(this._itemContext.isScrollbar){const[b]=this._pagerComponent.getScrollRange();let S;S=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const v=S*b;this.updateScrollMask(),o?this._itemsContainer.animate().to({[i]:-v},l,u):this._itemsContainer.setAttribute(i,-v)}else o?this._itemsContainer.animate().to({[i]:-(y-1)*e},l,u):this._itemsContainer.setAttribute(i,-(y-1)*e)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",g),this._pagerComponent.addEventListener("scrollUp",g),this.attribute.pager.roamScroll&&(this.addEventListener("wheel",y=>y.nativeEvent.preventDefault()),this.addEventListener("wheel",throttle(f,50)))):(this._pagerComponent.addEventListener("toPrev",g),this._pagerComponent.addEventListener("toNext",g))}_renderPager(){const e=this._title?this._title.AABBBounds.height()+get(this.attribute,"title.space",8):0,{maxWidth:i,maxCol:n=1,maxRow:o=2,item:l={},pager:u={}}=this.attribute,{spaceCol:d=DEFAULT_ITEM_SPACE_COL,spaceRow:f=DEFAULT_ITEM_SPACE_ROW}=l,g=this._itemsContainer,{space:_=DEFAULT_PAGER_SPACE,defaultCurrent:y=1}=u,b=__rest$k(u,["space","defaultCurrent"]),{isHorizontal:S}=this._itemContext,v=this._contentMaxHeight;let A,x=0,T=0,C=0,E=0,P=0,L=0,R=1;if(S){if(T=(o-1)*f+this._itemHeight*o,x=i,A=this._createPager(b),this._pagerComponent=A,this._innerView.add(A),C=i-A.AABBBounds.width()-_,C<=0)return this._innerView.removeChild(A),!1;g.getChildren().forEach((I,O)=>{const{width:B,height:N}=I.attribute;C<P+B&&(P=0,L+=N+f,R+=1),O>0&&I.setAttributes({x:P,y:L}),P+=d+B}),this._itemContext.startX=P,this._itemContext.startY=L,this._itemContext.pages=R;const D=Math.ceil(R/o);this._itemContext.totalPage=D,this._updatePositionOfPager(e,x,T)}else{if(x=this._itemMaxWidth*n+(n-1)*d,T=v,C=x,A=this._createPager(b),this._pagerComponent=A,this._innerView.add(A),E=v-A.AABBBounds.height()-_-e,E<=0)return this._innerView.removeChild(A),!1;g.getChildren().forEach((I,O)=>{const{height:B}=I.attribute;E<L+B&&(L=0,P+=this._itemMaxWidth+d,R+=1),O>0&&I.setAttributes({x:P,y:L}),L+=f+B});const D=Math.ceil(R/n);this._itemContext.totalPage=D,this._updatePositionOfPager(e,x,T)}y>1&&(S?g.setAttribute("y",-(y-1)*(T+f)):g.setAttribute("x",-(y-1)*(x+d)));const w=graphicCreator.group({x:0,y:e,width:S?C:x,height:S?T:E,clip:!0,pickable:!1});return w.add(g),this._innerView.add(w),this._itemContext.clipContainer=w,this._bindEventsOfPager(S?T+f:x+d,S?"y":"x"),!0}_renderScrollbar(){var e;const i=this._title?this._title.AABBBounds.height()+get(this.attribute,"title.space",8):0,{maxWidth:n,item:o={},pager:l={}}=this.attribute,{spaceCol:u=DEFAULT_ITEM_SPACE_COL,spaceRow:d=DEFAULT_ITEM_SPACE_ROW}=o,f=this._itemsContainer,{space:g=DEFAULT_PAGER_SPACE,defaultCurrent:_=1}=l,y=__rest$k(l,["space","defaultCurrent"]),{isHorizontal:b}=this._itemContext,S=this._contentMaxHeight;let v,A=0,x=0,T=0,C=1;if(b)A=n,x=this._itemHeight,v=this._createScrollbar(y,A),this._pagerComponent=v,this._innerView.add(v);else{if(x=S-i,A=this._itemMaxWidth,v=this._createScrollbar(y,x),this._pagerComponent=v,this._innerView.add(v),x<=0)return this._innerView.removeChild(v),!1;const P=f.getChildren(),L=P.map(R=>R.attribute.height);if(L.length===1||L.every(R=>R===L[0])){const R=L[0],w=x,D=Math.floor(w/(d+R));x=D*(d+R),C=Math.ceil(P.length/D)}else P.forEach((R,w)=>{const{height:D}=R.attribute,I=C,O=T;C=Math.floor((T+D)/x)+1,T+=d+D,I!==C&&w===f.getChildren().length-1&&T-x>=1/3*D&&(x=O+D,C-=1)});this._itemContext.totalPage=C,this._itemContext.pages=C}if(_>1)if(b){const P=this._itemsContainer.AABBBounds.width()-A;f.setAttribute("x",-Math.min((_-1)*(A+u),P))}else{const P=this._itemsContainer.AABBBounds.height()-x;f.setAttribute("y",-Math.min((_-1)*(x+d),P))}const E=graphicCreator.group({x:0,y:i,width:A,height:x,clip:!0,pickable:!1});return E.add(f),this._innerView.add(E),this._itemContext.clipContainer=E,this._updatePositionOfScrollbar(A,x,i),!((e=l.scrollMask)===null||e===void 0)&&e.visible&&this.renderScrollMask(E),this._bindEventsOfPager(b?A:x,b?"x":"y"),!0}renderScrollMask(e){const{scrollMask:i={}}=this.attribute.pager,{visible:n=!0,gradientLength:o=16,gradientStops:l}=i;if(!n||!l)return;const u=e.AABBBounds.width(),d=e.AABBBounds.height(),f=this._itemContext.isHorizontal?u:d,g=l.map(b=>({offset:o*b.offset/f,color:b.color})),_=l.map(b=>({offset:(f-o*b.offset)/f,color:b.color})),y=graphicCreator.rect({x:0,y:0,width:u,height:d});this._scrollMask=y,this._scrollMaskContext={startStops:g,endStops:_},this.updateScrollMask(),e.add(y)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;const[e,i]=this._pagerComponent.getScrollRange(),n=[];isNumberClose(clamp(i,0,1),1)||n.push(...this._scrollMaskContext.endStops),isNumberClose(clamp(e,0,1),0)||n.push(...this._scrollMaskContext.startStops),n.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:n}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:n}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(e,i){this._lastActiveItem=e,e.hasState(LegendStateValue.selected)?this._setLegendItemState(e,LegendStateValue.selectedHover,i):this._setLegendItemState(e,LegendStateValue.unSelectedHover,i);const n=e.getChildren()[0].find(o=>o.name===LEGEND_ELEMENT_NAME.focus,!1);n&&n.setAttribute("visible",!0),this._dispatchLegendEvent(LegendEvent.legendItemHover,e,i)}_unHover(e,i){let n=!1;(e.hasState(LegendStateValue.unSelectedHover)||e.hasState(LegendStateValue.selectedHover))&&(n=!0),e.removeState(LegendStateValue.unSelectedHover),e.removeState(LegendStateValue.selectedHover),e.getChildren()[0].getChildren().forEach(l=>{n||!l.hasState(LegendStateValue.unSelectedHover)&&!l.hasState(LegendStateValue.selectedHover)||(n=!0),l.removeState(LegendStateValue.unSelectedHover),l.removeState(LegendStateValue.selectedHover)});const o=e.getChildren()[0].find(l=>l.name===LEGEND_ELEMENT_NAME.focus,!1);o&&o.setAttribute("visible",!1),n&&this._dispatchLegendEvent(LegendEvent.legendItemAttributeUpdate,e,i),this._dispatchLegendEvent(LegendEvent.legendItemUnHover,e,i)}_setLegendItemState(e,i,n){let o=!1;e.hasState(i)||(o=!0),e.addState(i,!0),e.getChildren()[0].getChildren().forEach(l=>{l.name!==LEGEND_ELEMENT_NAME.focus&&(o||l.hasState(i)||(o=!0),l.addState(i,!0))}),o&&this._dispatchLegendEvent(LegendEvent.legendItemAttributeUpdate,e,n)}_removeLegendItemState(e,i,n){let o=!1;i.forEach(l=>{!o&&e.hasState(l)&&(o=!0),e.removeState(l)}),e.getChildren()[0].getChildren().forEach(l=>{l.name!==LEGEND_ELEMENT_NAME.focus&&i.forEach(u=>{!o&&l.hasState(u)&&(o=!0),l.removeState(u)})}),o&&this._dispatchLegendEvent(LegendEvent.legendItemAttributeUpdate,e,n)}_getSelectedLegends(){var e;const i=[];return(e=this._itemsContainer)===null||e===void 0||e.getChildren().forEach(n=>{n.hasState(LegendStateValue.selected)&&i.push(n.data)}),i}_appendDataToShape(e,i,n,o,l={}){e.name=i,e.data=n,e.delegate=o,e.states=merge$1({},DEFAULT_STATES,l)}_dispatchLegendEvent(e,i,n){const o=this._getSelectedLegends();o.sort((u,d)=>u.index-d.index);const l=o.map(u=>u.label);this._dispatchEvent(e,{item:i,data:i.data,selected:i.hasState(LegendStateValue.selected),currentSelectedItems:o,currentSelected:l,event:n})}_handleStyle(e,i,n,o,l){const u={};return e.style&&(isFunction(e.style)?u.style=e.style(i,n,o,l):u.style=e.style),e.state&&(u.state={},Object.keys(e.state).forEach(d=>{e.state[d]&&(isFunction(e.state[d])?u.state[d]=e.state[d](i,n,o,l):u.state[d]=e.state[d])})),u}release(){super.release(),this.removeAllEventListeners()}};DiscreteLegend$1.defaultAttributes={layout:"horizontal",title:{align:"start",space:DEFAULT_TITLE_SPACE,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:DEFAULT_ITEM_SPACE_COL,spaceRow:DEFAULT_ITEM_SPACE_ROW,shape:{space:DEFAULT_SHAPE_SPACE,style:{size:DEFAULT_SHAPE_SIZE,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:DEFAULT_LABEL_SPACE,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:DEFAULT_SHAPE_SIZE,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:DEFAULT_PAGER_SPACE,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var SLIDER_ELEMENT_NAME;(function(r){r.innerView="innerView",r.railContainer="sliderRailContainer",r.rail="sliderRail",r.startText="sliderStartText",r.endText="sliderEndText",r.startHandler="sliderStartHandler",r.startHandlerText="startHandlerText",r.endHandler="sliderEndHandler",r.endHandlerText="sliderEndHandlerText",r.track="sliderTrack",r.trackContainer="sliderTrackContainer"})(SLIDER_ELEMENT_NAME||(SLIDER_ELEMENT_NAME={}));function convertValueToRange(r){return isArray(r)?r:[r,r]}function getDefaultCursor(r){return r?"ew-resize":"ns-resize"}loadSliderComponent();class Slider extends AbstractComponent{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Slider.defaultAttributes,e)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=n=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(n),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=n=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const o=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),l=clamp(this._isHorizontal?(n.viewX-this._rail.globalAABBBounds.x1)/o:(n.viewY-this._rail.globalAABBBounds.y1)/o,0,1);l!==this._tooltipState.pos&&(this._tooltipState.pos=l,this._tooltipState.value=this.calculateValueByPos(l*o),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:n}=this.attribute;n&&n.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=n=>{n.stopPropagation(),this._isChanging=!0;const{x:o,y:l}=this.stage.eventPointTransform(n);this._currentHandler=n.target,this._prePos=this._isHorizontal?o:l,vglobal.env==="browser"?(vglobal.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),vglobal.addEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onHandlerPointerUp),this.stage.addEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onHandlerPointerMove=n=>{var o,l;n.stopPropagation(),this._isChanging=!0;const{railWidth:u,railHeight:d,min:f,max:g}=this.attribute;if(g===f)return;const{x:_,y}=this.stage.eventPointTransform(n);let b,S,v,A=0;this._isHorizontal?(b=_,A=b-this._prePos,S=(l=this._currentHandler)===null||l===void 0?void 0:l.attribute.x,v=u):(b=y,A=b-this._prePos,S=(o=this._currentHandler)===null||o===void 0?void 0:o.attribute.y,v=d);const x=clamp(S+A,0,v),T=this.calculateValueByPos(x);this._currentHandler.type==="text"?this._updateHandlerText(this._currentHandler,x,T):this._updateHandler(this._currentHandler,x,T),this._updateTrack(),this._prePos=b,this._dispatchChangeEvent()},this._onHandlerPointerUp=n=>{n.preventDefault(),this._isChanging=!1,this._currentHandler=null,vglobal.env==="browser"?(vglobal.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),vglobal.removeEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onHandlerPointerUp),this.stage.removeEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onTrackPointerdown=n=>{n.stopPropagation(),this._isChanging=!0;const{x:o,y:l}=this.stage.eventPointTransform(n);this._prePos=this._isHorizontal?o:l,vglobal.env==="browser"?(vglobal.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),vglobal.addEventListener("pointerup",this._onTrackPointerUp)):(this.stage.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onTrackPointerUp),this.stage.addEventListener("pointerupoutside",this._onTrackPointerUp))},this._onTrackPointerMove=n=>{n.stopPropagation(),this._isChanging=!0;const{railWidth:o,railHeight:l,min:u,max:d,inverse:f}=this.attribute;if(d===u)return;const{startHandler:g,endHandler:_}=this._getHandlers();let y,b,S;const{x:v,y:A}=this.stage.eventPointTransform(n);this._isHorizontal?(y=v,b=this._track.attribute.width,S=o):(y=A,b=this._track.attribute.height,S=l);const x=y-this._prePos;if(g){const T=this._isHorizontal?g.attribute.x:g.attribute.y,C=f?clamp(T+x,b,S):clamp(T+x,0,S-b),E=this.calculateValueByPos(C);this._updateHandler(g,C,E)}if(_){const T=this._isHorizontal?_.attribute.x:_.attribute.y,C=f?clamp(T+x,0,S-b):clamp(T+x,b,S),E=this.calculateValueByPos(C),P=g==null?void 0:g.attribute;this._updateHandler(_,C,E),this._track.setAttributes(this._isHorizontal?{x:Math.min(P.x,_.attribute.x),width:Math.abs(P.x-_.attribute.x)}:{y:Math.min(P.y,_.attribute.y),height:Math.abs(P.y-_.attribute.y)})}this._prePos=y,this._dispatchChangeEvent()},this._onTrackPointerUp=n=>{n.preventDefault(),this._isChanging=!1,vglobal.env==="browser"?(vglobal.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),vglobal.removeEventListener("pointerup",this._onTrackPointerUp)):(this.stage.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onTrackPointerUp),this.stage.removeEventListener("pointerupoutside",this._onTrackPointerUp))},this._onRailPointerDown=n=>{n.stopPropagation(),this._isChanging=!0;const{railWidth:o,railHeight:l,min:u,max:d}=this.attribute;if(d===u)return;const f=this._startHandler,g=this._endHandler;let _,y,b;this._isHorizontal?(_=n.viewX-this._rail.globalAABBBounds.x1,y=f==null?void 0:f.attribute.x,b=g==null?void 0:g.attribute.x):(_=n.viewY-this._rail.globalAABBBounds.y1,y=f==null?void 0:f.attribute.y,b=g==null?void 0:g.attribute.y);const S=this.calculateValueByPos(_);if(isValid(b)){const v=Math.abs(_-y)>Math.abs(_-b)?g:f;this._updateHandler(v,_,S)}else this._updateHandler(f,_,S);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(e,i){const{layout:n,railWidth:o,railHeight:l,min:u,max:d,inverse:f}=this.attribute;let g=0;return g=u===d?i==="start"?0:i==="end"?1:0:(e-u)/(d-u),(f?1-g:g)*(n==="vertical"?l:o)}calculateValueByPos(e){const{layout:i,railWidth:n,railHeight:o,min:l,max:u,inverse:d}=this.attribute,f=i==="vertical"?o:n;return l+(u-l)*(d?1-e/f:e/f)}setValue(e){const{min:i,max:n}=this.attribute;if(n===i)return;const[o,l]=array(e),{startHandler:u,endHandler:d}=this._getHandlers();u&&this._updateHandler(u,this.calculatePosByValue(o),o),d&&this._updateHandler(d,this.calculatePosByValue(l),l),this._updateTrack()}render(){var e,i;this.removeAllChild(!0);const{layout:n="horizontal",railWidth:o,railHeight:l,startText:u,endText:d,min:f,max:g,showHandler:_=!0,showTooltip:y}=this.attribute;let{value:b}=this.attribute;isNil(b)&&(b=[f,g]),this._currentValue={startValue:convertValueToRange(b)[0],endValue:convertValueToRange(b)[1]};const S=n==="horizontal";this._isHorizontal=S;const v=graphicCreator.group({x:0,y:0});v.name=SLIDER_ELEMENT_NAME.innerView,this.add(v),this._innerView=v;let A,x=0;if(u&&u.visible){A=graphicCreator.text(Object.assign({x:S?0:o/2,y:S?l/2:0,textAlign:S?"start":"center",textBaseline:S?"middle":"top",text:u.text,lineHeight:(e=u.style)===null||e===void 0?void 0:e.fontSize},u.style)),A.name=SLIDER_ELEMENT_NAME.startText,v.add(A);const P=isValid(u.space)?u.space:0;x+=(S?A.AABBBounds.width():A.AABBBounds.height())+P}const T=graphicCreator.group({x:S?x:0,y:S?0:x});v.add(T);const C=graphicCreator.group({x:0,y:0});let E;if(C.name=SLIDER_ELEMENT_NAME.railContainer,this._railContainer=C,T.add(C),this._mainContainer=T,this._renderRail(C),x+=S?o:l,d&&d.visible){const P=isValid(d.space)?d.space:0;E=graphicCreator.text(Object.assign({x:S?x+P:o/2,y:S?l/2:x+P,textAlign:S?"start":"center",textBaseline:S?"middle":"top",text:d.text,lineHeight:(i=d.style)===null||i===void 0?void 0:i.fontSize},d.style)),E.name=SLIDER_ELEMENT_NAME.endText,v.add(E)}this._renderTrack(C),_&&(this._renderHandlers(T),this._bindEvents()),y&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(e){const{railWidth:i,railHeight:n,railStyle:o,slidable:l}=this.attribute;let u="default";l!==!1&&(u="pointer");const d=graphicCreator.rect(Object.assign({x:0,y:0,width:i,height:n,cursor:u},o));return d.name=SLIDER_ELEMENT_NAME.rail,e.add(d),this._rail=d,d}_renderHandlers(e){const{range:i,min:n,max:o,handlerSize:l=14,handlerStyle:u,handlerText:d,railHeight:f,railWidth:g,slidable:_}=this.attribute;let{value:y}=this.attribute;isNil(y)&&(y=[n,o]);const b=d&&d.visible,S=this._isHorizontal,[v,A]=convertValueToRange(y),x=this.calculatePosByValue(v,i?"start":"end"),T=this._renderHandler(Object.assign({x:S?x:g/2,y:S?f/2:x,size:l,strokeBoundsBuffer:0,cursor:_===!1?"default":getDefaultCursor(S)},u));if(T.name=SLIDER_ELEMENT_NAME.startHandler,this._startHandler=T,e.add(T),this._currentValue.startPos=x,b){const C=this._renderHandlerText(v,i?"start":"end");C.name=SLIDER_ELEMENT_NAME.startHandlerText,e.add(C),this._startHandlerText=C}if(i){const C=this.calculatePosByValue(A,"end"),E=this._renderHandler(Object.assign({x:S?C:g/2,y:S?f/2:C,size:l,strokeBoundsBuffer:0,cursor:_===!1?"default":getDefaultCursor(S)},u));if(E.name=SLIDER_ELEMENT_NAME.endHandler,this._endHandler=E,e.add(E),this._currentValue.endPos=C,b){const P=this._renderHandlerText(A,"end");P.name=SLIDER_ELEMENT_NAME.endHandlerText,e.add(P),this._endHandlerText=P}}}_renderTrack(e){const{range:i,min:n,max:o,railHeight:l,railWidth:u,trackStyle:d,railStyle:f,slidable:g,value:_}=this.attribute;let y,b;if(isNil(_))i?(y=n,b=o):y=b=n;else if(i){const P=clampRange(_,n,o);y=P[0],b=P[1]}else y=n,b=clamp(_,n,o);const S=this._isHorizontal;i||(y=n);const v=graphicCreator.group({x:0,y:0,width:u,height:l,cornerRadius:f==null?void 0:f.cornerRadius,clip:!0,pickable:!1});v.name=SLIDER_ELEMENT_NAME.trackContainer;const A=isObject$1(i)&&i.draggableTrack===!0;let x;x=g===!1?"default":i===!1||A===!1?"pointer":getDefaultCursor(S);const T=this.calculatePosByValue(y,"start"),C=this.calculatePosByValue(b,i?"end":"start"),E=graphicCreator.rect(Object.assign({x:S?Math.min(T,C):0,y:S?0:Math.min(T,C),width:S?Math.abs(C-T):u,height:S?l:Math.abs(C-T),cursor:x},d));E.name=SLIDER_ELEMENT_NAME.track,this._track=E,v.add(E),e.add(v)}_renderHandler(e){return graphicCreator.symbol(e)}_renderHandlerText(e,i){var n,o,l;const{align:u,handlerSize:d=14,handlerText:f={},railHeight:g,railWidth:_,slidable:y}=this.attribute,b=this._isHorizontal,S=this.calculatePosByValue(e,i),v=(n=f.space)!==null&&n!==void 0?n:4,A={text:f.formatter?f.formatter(e):e.toFixed((o=f.precision)!==null&&o!==void 0?o:0),lineHeight:(l=f.style)===null||l===void 0?void 0:l.lineHeight,cursor:y===!1?"default":getDefaultCursor(b)};return b?u==="top"?(A.textBaseline="bottom",A.textAlign="center",A.x=S,A.y=(g-d)/2-v):(A.textBaseline="top",A.textAlign="center",A.x=S,A.y=(g+d)/2+v):u==="left"?(A.textBaseline="middle",A.textAlign="end",A.x=(_-d)/2-v,A.y=S):(A.textBaseline="middle",A.textAlign="start",A.x=(_+d)/2+v,A.y=S),graphicCreator.text(Object.assign(Object.assign({},A),f.style))}_renderTooltip(){var e;const{tooltip:i,railHeight:n,railWidth:o,align:l}=this.attribute;i&&i.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const u=this._isHorizontal?0:o/2,d=this._isHorizontal?n/2:0;if(i&&i.shape){const b=graphicCreator.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:u,y:d,symbolType:"circle"},i.shapeStyle));this._tooltipShape=b,this._mainContainer.add(b)}const f=i&&i.text||{},g=(e=f.space)!==null&&e!==void 0?e:6,_={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(_.x=u,_.y=l==="top"?d-n/2-g:d+n/2+g,_.textAlign="center",_.textBaseline=l==="top"?"bottom":"top"):(_.y=d,_.x=l==="left"?u-o/2-g:d+o/2+g,_.textAlign=l==="left"?"end":"start",_.textBaseline="middle");const y=graphicCreator.text(Object.assign(Object.assign({},_),f.style));this._mainContainer.add(y),this._tooltipText=y,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var e,i;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:n,railHeight:o}=this.attribute,l=this._isHorizontal?n:o,u=this._tooltipState.pos*l,d=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[d]:u});const{align:f}=this.attribute;if(this._tooltipText){const g=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[d]:u,text:g.formatter?g.formatter(this._tooltipState.value):this._isHorizontal||f!=="left"?` ${this._tooltipState.value.toFixed((i=g.precision)!==null&&i!==void 0?i:0)}`:`${this._tooltipState.value.toFixed((e=g.precision)!==null&&e!==void 0?e:0)} `})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:e,range:i}=this.attribute;e&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),isObject$1(i)&&i.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_updateTrack(){const{inverse:e,railWidth:i,railHeight:n}=this.attribute,o=this._startHandler,l=this._endHandler;if(this._isHorizontal){const u=o==null?void 0:o.attribute.x;if(l){const d=l==null?void 0:l.attribute.x;this._track.setAttributes({x:Math.min(u,d),width:Math.abs(u-d)})}else e?this._track.setAttributes({x:u,width:i-u}):this._track.setAttributes({width:u})}else{const u=o==null?void 0:o.attribute.y;if(l){const d=l==null?void 0:l.attribute.y;this._track.setAttributes({y:Math.min(u,d),height:Math.abs(u-d)})}else e?this._track.setAttributes({y:u,height:n-u}):this._track.setAttributes({height:u})}}_updateHandler(e,i,n){var o;const l=this._isHorizontal;e.setAttribute(l?"x":"y",i);const u=e.name===SLIDER_ELEMENT_NAME.startHandler?this._startHandlerText:this._endHandlerText;if(u){const{handlerText:d={}}=this.attribute;u.setAttributes({text:d.formatter?d.formatter(n):n.toFixed((o=d.precision)!==null&&o!==void 0?o:0),[l?"x":"y"]:i})}e.name===SLIDER_ELEMENT_NAME.startHandler?(this._currentValue.startValue=n,this._currentValue.startPos=i):(this._currentValue.endValue=n,this._currentValue.endPos=i)}_updateHandlerText(e,i,n){var o;const l=this._isHorizontal,{handlerText:u={}}=this.attribute;e.setAttributes({[l?"x":"y"]:i,text:u.formatter?u.formatter(n):n.toFixed((o=u.precision)!==null&&o!==void 0?o:0)});const d=e.name===SLIDER_ELEMENT_NAME.startHandlerText?this._startHandler:this._endHandler;d&&d.setAttributes({[l?"x":"y"]:i}),e.name===SLIDER_ELEMENT_NAME.startHandlerText?(this._currentValue.startValue=n,this._currentValue.startPos=i):(this._currentValue.endValue=n,this._currentValue.endPos=i)}_dispatchChangeEvent(){const e=!!this.attribute.range,i=this._currentValue;this._dispatchEvent("change",{value:e?[Math.min(i.endValue,i.startValue),Math.max(i.endValue,i.startValue)]:i.startValue,position:e?[Math.min(i.endPos,i.startPos),Math.max(i.endPos,i.startPos)]:i.startPos})}_dispatchTooltipEvent(e){this._dispatchEvent("sliderTooltip",{type:e,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:e}=this.attribute;let i=this._startHandler,n=this._endHandler;return n?(this._isHorizontal?(!e&&n.attribute.x<(i==null?void 0:i.attribute.x)||e&&n.attribute.x>(i==null?void 0:i.attribute.x))&&([i,n]=[n,i]):(!e&&n.attribute.y<(i==null?void 0:i.attribute.y)||e&&n.attribute.y>(i==null?void 0:i.attribute.y))&&([i,n]=[n,i]),{startHandler:i,endHandler:n}):{startHandler:i,endHandler:n}}}Slider.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}};loadColorContinuousLegendComponent();class ColorContinuousLegend extends LegendBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},ColorContinuousLegend.defaultAttributes,e)),this.name="colorLegend",this._onSliderToolipChange=n=>{const o=this._slider.tooltipShape;if(o&&n.detail&&!isNil(n.detail.value)){const l=this._colorScale.scale(n.detail.value);o.setAttribute("fill",l)}this.dispatchEvent(n)},this._onSliderChange=n=>{this._updateColor(),this.dispatchEvent(n)}}setSelected(e){this._slider&&(this._slider.setValue(e),this._updateColor())}_renderContent(){const{colors:e,slidable:i,layout:n,align:o,min:l,max:u,value:d,railWidth:f,railHeight:g,showHandler:_=!0,handlerSize:y,handlerStyle:b,railStyle:S,trackStyle:v,startText:A,endText:x,handlerText:T,showTooltip:C,tooltip:E,inverse:P,disableTriggerEvent:L}=this.attribute,R=[],w=(u-l)/(e.length-1);for(let I=0;I<e.length;I++)R.push(l+w*I);this._colorScale=new LinearScale().domain(R,!0).range(e),this._color=this._getTrackColor();const D=new Slider({x:0,y:0,range:{draggableTrack:!0},slidable:i,layout:n,align:o,min:l,max:u,value:d,railWidth:f,railHeight:g,showHandler:_,handlerSize:y,handlerStyle:b,railStyle:S,trackStyle:Object.assign({fill:this._color},v),startText:A,endText:x,handlerText:T,showTooltip:C,tooltip:E,disableTriggerEvent:L,inverse:P});this._innerView.add(D),this._slider=D,D.translateTo(0-D.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+get(this.attribute,"title.space",DEFAULT_TITLE_SPACE):0)-D.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:e,layout:i,inverse:n}=this.attribute;if(isEmpty(e))return;const o=e.length;if(o===1)return e[0];const l=[];for(let f=0;f<o;f++){const g=f/(o-1);l.push({offset:g,color:e[f]})}const u=i==="horizontal",d={gradient:"linear",stops:l,x0:0,y0:0,x1:u?1:0,y1:u?0:1};return n&&(u?(d.x0=1,d.x1=0):(d.y0=1,d.y1=0)),d}_updateColor(){var e;const{layout:i="horizontal",colors:n,railWidth:o,railHeight:l}=this.attribute,{startHandler:u,endHandler:d,track:f,attribute:g}=this._slider,{startValue:_,endValue:y,startPos:b,endPos:S}=this._slider.currentValue,v=(e=g.handlerStyle)===null||e===void 0?void 0:e.fill;if(u&&!v){const x=this._colorScale.scale(_);u.setAttribute("fill",x)}if(d&&!v){const x=this._colorScale.scale(y);d.setAttribute("fill",x)}const A=i==="horizontal"?o:l;if(Math.abs(b-S)!==A&&n&&n.length>1){const x=this._color.stops,T=Math.min(b,S),C=Math.max(b,S),E=T/A,P=C/A,L=P-E,R=x.filter(N=>N.offset>E&&N.offset<P),w=Math.min(_,y),D=Math.max(_,y),I=this._colorScale.scale(w),O=this._colorScale.scale(D),B=[{offset:0,color:I}];R.forEach(N=>{B.push({offset:(N.offset-E)/L,color:N.color})}),B.push({offset:1,color:O}),f.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:B}))}}}ColorContinuousLegend.defaultAttributes={layout:"horizontal",title:{align:"start",space:DEFAULT_TITLE_SPACE,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}};function getSizeHandlerPath(r="bottom"){let e=0;return r==="top"?`
    M${e},-6L${e-3.5},-2.5
    v5
    h7
    v-5
    Z
`:r==="left"?(e=1,`
    M${e-6},0L${e-6+2.5},-3.5
    h5
    v7
    h-5
    Z
`):r==="right"?(e=-1,`
    M${e+6},0L${e+6-2.5},-3.5
    h-5
    v7
    h5
    Z
  `):`
    M${e},6L${e-3.5},2.5
    v-5
    h7
    v5
    Z
`}loadSizeContinuousLegendComponent();class SizeContinuousLegend extends LegendBase{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},SizeContinuousLegend.defaultAttributes,e)),this.name="sizeLegend",this._onSliderChange=n=>{this.dispatchEvent(n)},this._onSliderToolipChange=n=>{this.dispatchEvent(n)}}setSelected(e){this._slider&&this._slider.setValue(e)}_renderContent(){const{slidable:e,layout:i,align:n,min:o,max:l,value:u,railWidth:d,railHeight:f,showHandler:g=!0,handlerSize:_,handlerStyle:y,railStyle:b,trackStyle:S,startText:v,endText:A,handlerText:x,showTooltip:T,tooltip:C,sizeBackground:E,disableTriggerEvent:P,inverse:L}=this.attribute,R=graphicCreator.group({x:0,y:0});this._innerView.add(R);const w=new Slider({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:e,layout:i,align:n,min:o,max:l,value:u,railWidth:d,railHeight:f,showHandler:g,handlerSize:_,handlerStyle:Object.assign({symbolType:getSizeHandlerPath(n)},y),railStyle:b,trackStyle:S,startText:v,endText:A,handlerText:x,showTooltip:T,tooltip:C,disableTriggerEvent:P,inverse:L});R.add(w);let D,I=0;i==="horizontal"?n==="top"?(D=`M0,0L${d},0L${L?0:d},12Z`,I=f):(D=`M0,12L${d},12L${L?0:d},0Z`,w.setAttribute("y",12)):n==="left"?D=`M${d},0L${d+12},${L?0:f}L${d},${f}Z`:(D=`M0,${L?0:f}L12,${f}L12,0Z`,w.setAttribute("x",12));const O=graphicCreator.path(Object.assign(Object.assign({x:0,y:I,path:D},E),{zIndex:0}));R.add(O);const B=this._title?this._title.AABBBounds.height()+get(this.attribute,"title.space",DEFAULT_TITLE_SPACE):0;R.translate(0-R.AABBBounds.x1,B-R.AABBBounds.y1),this._slider=w}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}SizeContinuousLegend.defaultAttributes={layout:"horizontal",title:{align:"start",space:DEFAULT_TITLE_SPACE,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}};function loadTitleComponent(){registerGroup(),registerText(),registerRichtext()}loadTitleComponent();let Title$1=class Ge extends AbstractComponent{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Ge.defaultAttributes,e)),this.name="title"}render(){var e,i,n,o,l,u,d,f,g,_,y,b,S,v,A,x,T,C,E;const{textType:P,text:L,subtextType:R,textStyle:w={},subtext:D,subtextStyle:I={},width:O,height:B,minWidth:N,maxWidth:$,minHeight:H,maxHeight:F,align:V,verticalAlign:G,padding:Y=0}=this.attribute,J=normalizePadding$1(Y),q=this.createOrUpdateChild("title-container",{x:J[3],y:J[0],zIndex:1},"group"),te=(e=w.height)!==null&&e!==void 0?e:B;if(this.attribute.visible!==!1&&w.visible!==!1){const{width:Q,maxHeight:ie,maxWidth:le,x:ce=0,y:z=0,ellipsis:W=!0,wordBreak:K="break-word",maxWidth:ne,lineClamp:se}=w;if(P==="rich"||isValid(w.character)){const ae=Object.assign({x:ce,y:z,width:(i=Q??O)!==null&&i!==void 0?i:0,height:te??0,ellipsis:W==null||W,wordBreak:K??"break-word",maxHeight:ie??F,maxWidth:le??ne,textConfig:(n=w.character)!==null&&n!==void 0?n:L},w);this._mainTitle=q.createOrUpdateChild("mainTitle",ae,"richtext")}else if(P==="html"){const ae=Object.assign({html:Object.assign(Object.assign({dom:L},DEFAULT_HTML_TEXT_SPEC),w),x:ce,y:z,width:(o=Q??O)!==null&&o!==void 0?o:0,height:te??0,ellipsis:W,wordBreak:K,maxHeight:ie??F,maxWidth:le??ne,textConfig:[]},w);this._mainTitle=q.createOrUpdateChild("mainTitle",ae,"richtext")}else isValid(L)&&(this._mainTitle=q.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:isArray(L)?L:[L],whiteSpace:"normal"},w),{maxLineWidth:(u=(l=w.maxLineWidth)!==null&&l!==void 0?l:Q)!==null&&u!==void 0?u:O,heightLimit:(d=w.height)!==null&&d!==void 0?d:F,lineClamp:se,ellipsis:W,x:ce,y:z}),"text"))}const de=this._mainTitle?this._mainTitle.AABBBounds.height():0,he=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(this.attribute.visible!==!1&&I.visible!==!1){const{width:Q,height:ie,maxWidth:le,maxHeight:ce,x:z=0,y:W=0,ellipsis:K=!0,wordBreak:ne="break-word",lineClamp:se}=I,ae=Math.max(Number.MIN_VALUE,F-de);if(R==="rich"||isValid(I.character)){const j=Object.assign({x:z,y:W,width:(f=Q??O)!==null&&f!==void 0?f:0,height:(g=ie??B)!==null&&g!==void 0?g:0,ellipsis:K,wordBreak:ne,maxHeight:ce??ae,maxWidth:le??$,textConfig:(_=I.character)!==null&&_!==void 0?_:D},I);this._subTitle=q.createOrUpdateChild("subTitle",j,"richtext")}else if(R==="html"){const j=Object.assign({html:Object.assign(Object.assign({dom:D},DEFAULT_HTML_TEXT_SPEC),I),x:z,y:W,width:(y=Q??O)!==null&&y!==void 0?y:0,height:(b=ie??B)!==null&&b!==void 0?b:0,ellipsis:K,wordBreak:ne,maxHeight:ce??ae,maxWidth:le??$,textConfig:[]},I);this._subTitle=q.createOrUpdateChild("subTitle",j,"richtext")}else isValid(D)&&(this._subTitle=q.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:isArray(D)?D:[D],whiteSpace:"normal"},I),{maxLineWidth:(S=I.maxLineWidth)!==null&&S!==void 0?S:O,heightLimit:(v=I.heightLimit)!==null&&v!==void 0?v:ae,lineClamp:se,ellipsis:K,x:0,y:de}),"text"))}const fe=this._subTitle?this._subTitle.AABBBounds.height():0,pe=this._subTitle?this._subTitle.AABBBounds.width():0;let me=Math.max(he,pe),ee=de+((A=I.height)!==null&&A!==void 0?A:fe);if(isValid(O)&&(me=O),isValid(B)&&(ee=B),isValid(N)&&me<N&&(me=N),isValid($)&&me>$&&(me=$),isValid(H)&&ee<H&&(ee=H),isValid(F)&&ee>F&&(ee=F),q.attribute.width=me,q.attribute.height=ee,q.attribute.boundsPadding=J,this._mainTitle){if(isValid(V)||isValid(w.align)){const Q=w.align?w.align:V,ie=(x=w.width)!==null&&x!==void 0?x:me;Q==="center"?(this._mainTitle.setAttribute("x",ie/2),this._mainTitle.setAttribute("textAlign","center")):Q==="right"?(this._mainTitle.setAttribute("x",ie),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}if(isValid(G)||isValid(w.verticalAlign)){const Q=w.verticalAlign?w.verticalAlign:G;Q==="middle"&&isValid(te)?(this._mainTitle.setAttribute("y",te/2),this._mainTitle.setAttribute("textBaseline","middle")):Q==="bottom"&&isValid(te)?(this._mainTitle.setAttribute("y",te),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}}if(this._subTitle){if(isValid(V)||isValid(I.align)){const Q=I.align?I.align:V,ie=(C=(T=I.width)!==null&&T!==void 0?T:w.width)!==null&&C!==void 0?C:me;Q==="center"?(this._subTitle.setAttribute("x",ie/2),this._subTitle.setAttribute("textAlign","center")):Q==="right"?(this._subTitle.setAttribute("x",ie),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}if(isValid(G)||isValid(w.verticalAlign)){const Q=I.verticalAlign?I.verticalAlign:G,ie=this._mainTitle?isValid(te)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.height(),te):this._mainTitle.AABBBounds.y2:0,le=(E=I.height)!==null&&E!==void 0?E:B;Q==="middle"&&isValid(le)?(this._subTitle.setAttribute("y",ie+le/2),this._subTitle.setAttribute("textBaseline","middle")):Q==="bottom"&&isValid(le)?(this._subTitle.setAttribute("y",ie+le),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",ie),this._subTitle.setAttribute("textBaseline","top"))}}}};Title$1.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};const DEFAULT_INDICATOR_THEME={title:{style:{text:"",fontSize:20,fill:"black",fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}},content:{style:{text:"",fontSize:16,fill:"black",fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}}};function loadIndicatorComponent(){registerGroup(),registerText(),registerRichtext()}loadIndicatorComponent();let Indicator$1=class extends AbstractComponent{constructor(){super(...arguments),this.name="indicator"}_renderText(e,i,n,o,l,u){if(i.visible!==!1){const d=merge$1({},get(DEFAULT_INDICATOR_THEME,l),i.style,{visible:i.visible});d.lineHeight=isValid(d.lineHeight)?d.lineHeight:d.fontSize,i.formatMethod&&(d._originText=d.text,d.text=i.formatMethod(d.text,d));const f=createTextGraphicByType(d);return f.name=u,e.appendChild(f),i.autoFit&&isValidNumber(n)&&this._setLocalAutoFit(n,f,i),i.autoLimit&&isValidNumber(o)&&f.setAttribute("maxLineWidth",n),f}}render(){var e,i;if(this.removeAllChild(!0),this.attribute.visible!==!0)return;const{title:n={},content:o,size:l,limitRatio:u=1/0}=this.attribute,d=Math.min(l.width,l.height)*u,f=this.createOrUpdateChild("indicator-container",{x:0,y:0,zIndex:1,pickable:(e=this.attribute.pickable)===null||e===void 0||e},"group");if(isValid(n)&&(this._title=this._renderText(f,n,d,u,"title.style","indicator-title")),isValid(o)){const _=array(o),y=[];_.forEach((b,S)=>{b.visible!==!1&&y.push(this._renderText(f,b,d,u,"content.style","indicator-content-"+S))}),this._content=y}this._setGlobalAutoFit(d),this._setYPosition();const g=(i=f==null?void 0:f.AABBBounds.height())!==null&&i!==void 0?i:0;f.setAttribute("y",l.height/2-g/2),f.setAttribute("x",l.width/2)}_setLocalAutoFit(e,i,n){var o,l,u,d,f,g,_,y,b;if(((o=n.fitStrategy)!==null&&o!==void 0?o:"default")!=="default")return;const S=measureTextSize((u=(l=n.style)===null||l===void 0?void 0:l.text)!==null&&u!==void 0?u:"",(d=n.style)!==null&&d!==void 0?d:{},(g=(f=this.stage)===null||f===void 0?void 0:f.getTheme())===null||g===void 0?void 0:g.text).width;if(S>0){const v=e*((_=n.fitPercent)!==null&&_!==void 0?_:.5)/S,A=Math.floor(((b=(y=n.style)===null||y===void 0?void 0:y.fontSize)!==null&&b!==void 0?b:20)*v);i.setAttribute("fontSize",A),i.setAttribute("lineHeight",isValid(n.style.lineHeight)?n.style.lineHeight:A)}}_setGlobalAutoFit(e){var i,n,o,l,u,d,f;const g=e/2,_=[];let y=0;const b=(i=this.attribute.title)!==null&&i!==void 0?i:{};b.autoFit&&b.fitStrategy==="inscribed"?(this._title.setAttribute("fontSize",12),_.push({text:this._title,spec:(n=this.attribute.title)!==null&&n!==void 0?n:{}})):y+=(d=(u=(l=(o=this._title)===null||o===void 0?void 0:o.AABBBounds)===null||l===void 0?void 0:l.height)===null||u===void 0?void 0:u.call(l))!==null&&d!==void 0?d:0;const S=(f=b.space)!==null&&f!==void 0?f:0;if(y+=S,array(this.attribute.content).filter(L=>L.visible!==!1).forEach((L,R)=>{var w,D,I,O;const B=this._content[R];L.autoFit&&L.fitStrategy==="inscribed"?(B.setAttribute("fontSize",12),_.push({text:B,spec:L})):y+=(I=(D=(w=B==null?void 0:B.AABBBounds)===null||w===void 0?void 0:w.height)===null||D===void 0?void 0:D.call(w))!==null&&I!==void 0?I:0;const N=(O=L.space)!==null&&O!==void 0?O:0;y+=N}),_.length<=0)return;const v=12/_.reduce((L,R)=>Math.max(L,R.text.AABBBounds.width()),0)*_.length,A=y/2,x=v**2+1,T=2*A*v,C=A**2-g**2,E=2*(v*((-T+Math.sqrt(T**2-4*x*C))/(2*x))+A),P=(E-y)/_.length;isValidNumber(E)&&_.forEach(L=>{var R;const w=(R=L.spec.style)===null||R===void 0?void 0:R.lineHeight;L.text.setAttribute("fontSize",P),L.text.setAttribute("lineHeight",isValid(w)?w:P)})}_setYPosition(){var e,i,n,o,l,u;let d=0;const f=(o=(n=(i=(e=this._title)===null||e===void 0?void 0:e.AABBBounds)===null||i===void 0?void 0:i.height)===null||n===void 0?void 0:n.call(i))!==null&&o!==void 0?o:0,g=(u=(l=this.attribute.title)===null||l===void 0?void 0:l.space)!==null&&u!==void 0?u:0;array(this.attribute.content).filter(_=>_.visible!==!1).forEach((_,y)=>{var b;const S=this._content[y];S.setAttribute("y",f+g+d);const v=(b=_.space)!==null&&b!==void 0?b:0;d+=S.AABBBounds.height()+v})}};const iconPlay="M 414.5 0.0238 c 228.9128 0 414.4762 185.5634 414.4762 414.4762 s -185.5634 414.4762 -414.4762 414.4762 S 0.0238 643.4128 0.0238 414.5 S 185.5872 0.0238 414.5 0.0238 z m 0 73.1429 C 225.9865 73.1667 73.1667 225.9865 73.1667 414.5 s 152.8198 341.3333 341.3333 341.3333 s 341.3333 -152.8198 341.3333 -341.3333 S 603.0135 73.1667 414.5 73.1667 z m -73.1429 161.4994 a 48.7619 48.7619 0 0 1 25.9901 7.5093 l 201.7524 127.1223 a 48.7619 48.7619 0 0 1 0.3657 82.2613 l -201.7524 129.6335 A 48.7619 48.7619 0 0 1 292.5952 540.1838 v -256.7314 a 48.7619 48.7619 0 0 1 48.7619 -48.7619 z m 24.381 92.9402 v 167.9116 l 131.9497 -84.7726 L 365.7381 327.6063 z",iconPause="M 414.5 0.0238 c 228.9128 0 414.4762 185.5634 414.4762 414.4762 s -185.5634 414.4762 -414.4762 414.4762 S 0.0238 643.4128 0.0238 414.5 S 185.5872 0.0238 414.5 0.0238 z m 0 73.1429 C 225.9865 73.1667 73.1667 225.9865 73.1667 414.5 s 152.8198 341.3333 341.3333 341.3333 s 341.3333 -152.8198 341.3333 -341.3333 S 603.0135 73.1667 414.5 73.1667 z m -48.7619 195.0476 v 316.9524 h -73.1429 V 268.2143 h 73.1429 z m 158.4762 0 v 316.9524 h -73.1429 V 268.2143 h 73.1429 z",iconLeft="M 521.29 734.276 L 230.929 448.019 L 521.29 161.762 c 37.685 -37.153 38.003 -97.625 0.707 -134.384 c -37.297 -36.758 -98.646 -36.435 -136.331 0.718 l -357.43 352.378 c -0.155 0.153 -0.297 0.314 -0.451 0.468 c -0.084 0.082 -0.172 0.157 -0.256 0.239 c -18.357 18.092 -27.581 41.929 -27.743 65.902 c -0.004 0.311 -0.017 0.623 -0.018 0.934 c 0.001 0.316 0.014 0.632 0.018 0.948 c 0.165 23.97 9.389 47.803 27.743 65.892 c 0.083 0.082 0.171 0.157 0.255 0.239 c 0.154 0.154 0.296 0.315 0.452 0.468 l 357.43 352.378 c 37.685 37.153 99.034 37.476 136.331 0.718 c 37.297 -36.758 36.979 -97.231 -0.707 -134.384 z",iconDown="M 734.276 28.71 L 448.019 319.071 L 161.762 28.71 c -37.153 -37.685 -97.625 -38.003 -134.384 -0.707 c -36.758 37.297 -36.435 98.646 0.718 136.331 l 352.378 357.43 c 0.153 0.155 0.314 0.297 0.468 0.451 c 0.082 0.084 0.157 0.172 0.239 0.256 c 18.092 18.357 41.929 27.581 65.902 27.743 c 0.311 0.004 0.623 0.017 0.934 0.018 c 0.316 -0.001 0.632 -0.014 0.948 -0.018 c 23.97 -0.165 47.803 -9.389 65.892 -27.743 c 0.082 -0.083 0.157 -0.171 0.239 -0.255 c 0.154 -0.154 0.315 -0.296 0.468 -0.452 l 352.378 -357.43 c 37.153 -37.685 37.476 -99.034 0.718 -136.331 c -36.758 -37.297 -97.231 -36.979 -134.384 0.707 z",iconUp="m 161.724 521.29 l 286.257 -290.361 l 286.257 290.361 c 37.153 37.685 97.625 38.003 134.384 0.707 c 36.758 -37.297 36.435 -98.646 -0.718 -136.331 l -352.378 -357.43 c -0.153 -0.155 -0.314 -0.297 -0.468 -0.451 c -0.082 -0.084 -0.157 -0.172 -0.239 -0.256 c -18.092 -18.357 -41.929 -27.581 -65.902 -27.743 c -0.311 -0.004 -0.623 -0.017 -0.934 -0.018 c -0.316 0.001 -0.632 0.014 -0.948 0.018 c -23.97 0.165 -47.803 9.389 -65.892 27.743 c -0.082 0.083 -0.157 0.171 -0.239 0.255 c -0.154 0.154 -0.315 0.296 -0.468 0.452 l -352.378 357.43 c -37.153 37.685 -37.476 99.034 -0.718 136.331 c 36.758 37.297 97.231 36.979 134.384 -0.707 z",iconRight="M 30 163 L 320.361 449.257 L 30 735.514 c -37.685 37.153 -38.003 97.625 -0.707 134.384 c 37.297 36.758 98.646 36.435 136.331 -0.718 l 357.43 -352.378 c 0.155 -0.153 0.297 -0.314 0.451 -0.468 c 0.084 -0.082 0.172 -0.157 0.256 -0.239 c 18.357 -18.092 27.581 -41.929 27.743 -65.902 c 0.004 -0.311 0.017 -0.623 0.018 -0.934 c -0.001 -0.316 -0.014 -0.632 -0.018 -0.948 c -0.165 -23.97 -9.389 -47.803 -27.743 -65.892 c -0.083 -0.082 -0.171 -0.157 -0.255 -0.239 c -0.154 -0.154 -0.296 -0.315 -0.452 -0.468 l -357.43 -352.378 c -37.685 -37.153 -99.034 -37.476 -136.331 -0.718 c -37.297 36.758 -36.979 97.231 0.707 134.384 z";class PlayerIcon extends Symbol$1{constructor(e){super(e)}}var ControllerEventEnum;(function(r){r.OnPlay="onPlay",r.OnPause="onPause",r.OnForward="onForward",r.OnBackward="onBackward"})(ControllerEventEnum||(ControllerEventEnum={}));var ControllerTypeEnum;(function(r){r.Start="start",r.Pause="pause",r.Forward="forward",r.Backward="backward"})(ControllerTypeEnum||(ControllerTypeEnum={}));class Controller extends AbstractComponent{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Controller.defaultAttributes,e)),this._isPaused=!0,this.updateAttributes=()=>{this._startAttr={style:Object.assign(Object.assign(Object.assign({symbolType:iconPlay},Controller.defaultControllerAttr),{visible:this.attribute.start.visible}),this.attribute.start.style)},this._pauseAttr={style:Object.assign(Object.assign(Object.assign({symbolType:iconPause},Controller.defaultControllerAttr),{visible:this.attribute.pause.visible}),this.attribute.pause.style)},this._forwardAttr={style:Object.assign(Object.assign(Object.assign({},Controller.defaultControllerAttr),{visible:this.attribute.forward.visible}),this.attribute.forward.style)},this._backwardAttr={style:Object.assign(Object.assign(Object.assign({},Controller.defaultControllerAttr),{visible:this.attribute.backward.visible}),this.attribute.backward.style)},this.updateLayout()},this.updateLayout=()=>{var n,o,l,u;this._layout=this.attribute.layout,this._layout==="horizontal"?(this._backwardAttr.style.symbolType=(n=this._backwardAttr.style.symbolType)!==null&&n!==void 0?n:iconLeft,this._forwardAttr.style.symbolType=(o=this._forwardAttr.style.symbolType)!==null&&o!==void 0?o:iconRight):this._layout==="vertical"&&(this._backwardAttr.style.symbolType=(l=this._backwardAttr.style.symbolType)!==null&&l!==void 0?l:iconUp,this._forwardAttr.style.symbolType=(u=this._forwardAttr.style.symbolType)!==null&&u!==void 0?u:iconDown)},this._initPlay=()=>{isNil(this._playController)&&(this._playController=new PlayerIcon(Object.assign({},this._startAttr.style)),this.add(this._playController))},this._initBackward=()=>{isNil(this._backwardController)&&(this._backwardController=new PlayerIcon(Object.assign({},this._backwardAttr.style)),this.add(this._backwardController))},this._initForward=()=>{isNil(this._forwardController)&&(this._forwardController=new PlayerIcon(Object.assign({},this._forwardAttr.style)),this.add(this._forwardController))},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._playController.addEventListener("pointerdown",n=>{n.stopPropagation(),this._isPaused===!0?this.play():this.pause()}),this._backwardController.addEventListener("pointerdown",n=>{n.stopPropagation(),this.backward()}),this._forwardController.addEventListener("pointerdown",n=>{n.stopPropagation(),this.forward()}))},this.renderPlay=()=>{this._isPaused?this._playController.setAttributes(Object.assign({symbolType:this._playController.getComputedAttribute("symbolType")},this._startAttr.style)):this._playController.setAttributes(Object.assign({symbolType:this._playController.getComputedAttribute("symbolType")},this._pauseAttr.style))},this.renderBackward=()=>{this._backwardController.setAttributes(this._backwardAttr.style)},this.renderForward=()=>{this._forwardController.setAttributes(this._forwardAttr.style)},this.play=()=>{this._dispatchEvent(ControllerEventEnum.OnPlay)},this.pause=()=>{this._dispatchEvent(ControllerEventEnum.OnPause)},this.forward=()=>{this._dispatchEvent(ControllerEventEnum.OnForward)},this.backward=()=>{this._dispatchEvent(ControllerEventEnum.OnBackward)},this.togglePlay=()=>{this._playController.setAttributes(this._startAttr.style),this._isPaused=!0},this.togglePause=()=>{this._playController.setAttributes(this._pauseAttr.style),this._isPaused=!1},this.updateAttributes(),this._initPlay(),this._initBackward(),this._initForward(),this._initEvents()}render(){this.updateAttributes(),this.renderPlay(),this.renderBackward(),this.renderForward()}}Controller.defaultControllerAttr={visible:!0,x:0,y:0,size:20,fill:"#91caff",pickMode:"imprecise",cursor:"pointer"},Controller.defaultAttributes={[ControllerTypeEnum.Start]:{},[ControllerTypeEnum.Pause]:{},[ControllerTypeEnum.Backward]:{},[ControllerTypeEnum.Forward]:{}};const defaultControllerAttributes={visible:!0,style:{x:0,y:0,dx:0,dy:0,size:20},order:0,space:10},RailDefaultSize=[200,10];var DirectionEnum;(function(r){r.Default="default",r.Reverse="reverse"})(DirectionEnum||(DirectionEnum={}));var PlayerEventEnum;(function(r){r.change="change",r.play="play",r.pause="pause",r.backward="backward",r.forward="forward",r.end="end",r.OnChange="change",r.OnPlay="play",r.OnPause="pause",r.OnBackward="backward",r.OnForward="forward",r.OnEnd="end"})(PlayerEventEnum||(PlayerEventEnum={}));const isReachEndByDefault=({direction:r,maxIndex:e,dataIndex:i})=>r===DirectionEnum.Default&&i===e,isReachEndByReverse=({direction:r,minIndex:e,dataIndex:i})=>r===DirectionEnum.Reverse&&i===e,isReachEnd=({direction:r,maxIndex:e,minIndex:i,dataIndex:n})=>isReachEndByDefault({direction:r,maxIndex:e,dataIndex:n})||isReachEndByReverse({direction:r,minIndex:i,dataIndex:n}),isReachStartByDefault=({direction:r,minIndex:e,dataIndex:i})=>r===DirectionEnum.Default&&i===e,isReachStartByReverse=({direction:r,maxIndex:e,dataIndex:i})=>r===DirectionEnum.Reverse&&i===e,isReachStart=({direction:r,maxIndex:e,minIndex:i,dataIndex:n})=>isReachStartByDefault({direction:r,minIndex:i,dataIndex:n})||isReachStartByReverse({direction:r,maxIndex:e,dataIndex:n}),isHorizontal$1=r=>r==="top"||r==="bottom",forwardStep=(r,e,i,n)=>r==="default"?Math.min(e+1,n):Math.max(e-1,i);class BasePlayer extends AbstractComponent{getMinIndex(){return this._minIndex}getMaxIndex(){return this._maxIndex}getDataIndex(){return this._dataIndex}constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},BasePlayer.defaultAttributes,e)),this._data=[],this._dataIndex=0,this._layoutInfo={},this._updateSliderAttrs=()=>{var n,o;let l;isValidNumber(this._handlerStyle.size)?l=this._handlerStyle.size:this._handlerStyle.size&&this._handlerStyle.size.length&&(l=max$1(this._handlerStyle.size[0],this._handlerStyle.size[1]));const u={visible:this._sliderVisible,min:this._minIndex,max:this._maxIndex,value:this._dataIndex,railWidth:this._railStyle.width,railHeight:this._railStyle.height,railStyle:this._railStyle,trackStyle:this._trackStyle,handlerSize:isValidNumber(l)?l:void 0,handlerStyle:this._handlerStyle,dy:this.attribute.slider.dy,dx:this.attribute.slider.dx,slidable:!0,range:!1,handlerText:{visible:!1},startText:{visible:!1},endText:{visible:!1},disableTriggerEvent:this.attribute.disableTriggerEvent};if(isHorizontal$1(this._orient)){const d=Math.max(0,this._layoutInfo.slider.size),f=(n=this._railStyle.height)!==null&&n!==void 0?n:RailDefaultSize[1];u.layout="horizontal",u.railHeight=f,u.railWidth=d,u.x=this._layoutInfo.slider.x,u.y=this._layoutInfo.slider.y}else{const d=Math.max(0,this._layoutInfo.slider.size),f=(o=this._railStyle.width)!==null&&o!==void 0?o:RailDefaultSize[1];u.layout="vertical",u.railWidth=f,u.railHeight=d,u.x=this._layoutInfo.slider.x,u.y=this._layoutInfo.slider.y}return u},this._initSlider=()=>{const n=this._updateSliderAttrs();this._slider=new Slider(n),this._sliderVisible&&this.add(this._slider)},this._updateControllerAttrs=()=>{const n={start:this._start,pause:this._pause,forward:this._forward,backward:this._backward,disableTriggerEvent:this.attribute.disableTriggerEvent};return n.layout=isHorizontal$1(this._orient)?"horizontal":"vertical",n.start=Object.assign(Object.assign({},n.start),{style:Object.assign(Object.assign({},n.start.style),{x:this._layoutInfo.start.x,y:this._layoutInfo.start.y})}),n.pause=Object.assign(Object.assign({},n.pause),{style:Object.assign(Object.assign({},n.pause.style),{x:this._layoutInfo.start.x,y:this._layoutInfo.start.y})}),n.backward=Object.assign(Object.assign({},n.backward),{style:Object.assign(Object.assign({},n.backward.style),{x:this._layoutInfo.backward.x,y:this._layoutInfo.backward.y})}),n.forward=Object.assign(Object.assign({},n.forward),{style:Object.assign(Object.assign({},n.forward.style),{x:this._layoutInfo.forward.x,y:this._layoutInfo.forward.y})}),n},this._initController=()=>{const n=this._updateControllerAttrs();this._controller=new Controller(n),this._controllerVisible&&this.add(this._controller)},this._initAttributes(),this._initDataIndex(),this._initLayoutInfo(),this._initController(),this._initSlider()}_initAttributes(){this._size=this.attribute.size,this._orient=this.attribute.orient,this._data=this.attribute.data,this._minIndex=0,this._maxIndex=this._data.length-1;const{slider:e={},controller:i={}}=this.attribute;this._sliderVisible=e.visible,this._railStyle=Object.assign({},e.railStyle),this._trackStyle=Object.assign({},e.trackStyle),this._handlerStyle=Object.assign({},e.handlerStyle),this._controllerVisible=i.visible,this._start=Object.assign({},i.start),this._pause=Object.assign({},i.pause),this._forward=Object.assign({},i.forward),this._backward=Object.assign({},i.backward)}_initDataIndex(){var e;this._dataIndex=(e=this.attribute.dataIndex)!==null&&e!==void 0?e:0}_initLayoutInfo(){var e,i,n;const o=[this._start,this._backward,this._forward].sort((b,S)=>b.order-S.order),l=o.filter(b=>b.position!=="end"),u=o.filter(b=>b.position==="end"),d=(e=isHorizontal$1(this._orient)?this._railStyle.height:this._railStyle.width)!==null&&e!==void 0?e:RailDefaultSize[1],f=o.reduce((b,S)=>{const v=S.style.size,A=isNumber(v)?v:max$1(v[0],v[1]);return b+S.space+A},0),g=this._sliderVisible?(isHorizontal$1(this._orient)?(i=this._size)===null||i===void 0?void 0:i.width:(n=this._size)===null||n===void 0?void 0:n.height)-f:0,_=g-this.attribute.slider.space,y=l.reduce((b,S)=>{const{key:v,space:A,style:{size:x}}=S,T=isNumber(x)?x:max$1(x[0],x[1]);return this._layoutInfo[v]=Object.assign(Object.assign({},this._layoutInfo[v]),{size:T,x:isHorizontal$1(this._orient)?b+A:(this._size.width-T)/2,y:isHorizontal$1(this._orient)?(this._size.height-T)/2:b+A}),b+A+T},0);this._layoutInfo.slider=Object.assign(Object.assign({},this._layoutInfo.slider),{size:_,x:isHorizontal$1(this._orient)?y+this.attribute.slider.space:(this._size.width-d)/2,y:isHorizontal$1(this._orient)?(this._size.height-d)/2:y+this.attribute.slider.space}),u.reduce((b,S)=>{const{key:v,space:A,style:{size:x}}=S,T=isNumber(x)?x:max$1(x[0],x[1]);return this._layoutInfo[v]=Object.assign(Object.assign({},this._layoutInfo[v]),{size:T,x:isHorizontal$1(this._orient)?b+A:(this._size.width-T)/2,y:isHorizontal$1(this._orient)?(this._size.height-T)/2:b+A}),b+A+T},y+g)}render(){this._initLayoutInfo(),this.renderSlider(),this.renderController()}renderSlider(){const e=this._updateSliderAttrs();this._slider.setAttributes(e)}renderController(){const e=this._updateControllerAttrs();this._controller.setAttributes(e)}dispatchCustomEvent(e,i){this._dispatchEvent(e,{eventType:e,index:i,value:this._data[i]})}}BasePlayer.defaultAttributes={visible:!0,data:[],interval:1e3,orient:"bottom",align:"center",size:{height:20,width:300},slider:{visible:!0,space:10,dx:0,dy:0,railStyle:{cornerRadius:5},trackStyle:{},handlerStyle:{}},controller:{visible:!0,start:Object.assign(Object.assign({},defaultControllerAttributes),{key:"start",position:"start",space:0}),pause:Object.assign(Object.assign({},defaultControllerAttributes),{key:"pause",position:"start"}),forward:Object.assign(Object.assign({},defaultControllerAttributes),{key:"forward",position:"end"}),backward:Object.assign(Object.assign({},defaultControllerAttributes),{key:"backward",position:"start"})}};function loadBasePlayer(){loadSliderComponent(),registerGroup(),registerSymbol()}function loadDiscretePlayerComponent(){loadBasePlayer()}function loadContinuousPlayerComponent(){loadBasePlayer()}loadDiscretePlayerComponent();class DiscretePlayer extends BasePlayer{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},e)),this._activeIndex=-1,this._isReachEnd=!1,this._initAttributes=()=>{var n,o,l;super._initAttributes(),this._alternate=(n=this.attribute.alternate)!==null&&n!==void 0&&n,this._interval=(o=this.attribute.interval)!==null&&o!==void 0?o:1e3,this._direction=(l=this.attribute.direction)!==null&&l!==void 0?l:DirectionEnum.Default},this._initDataIndex=()=>{var n;this._dataIndex=isNil(this.attribute.dataIndex)?this._direction==="default"?this._minIndex:this._maxIndex:(n=this.attribute.dataIndex)!==null&&n!==void 0?n:0,this._slider.setAttribute("value",this._dataIndex)},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._controller.addEventListener(ControllerEventEnum.OnPlay,n=>{n.stopPropagation(),this.play()}),this._controller.addEventListener(ControllerEventEnum.OnPause,n=>{n.stopPropagation(),this.pause()}),this._controller.addEventListener(ControllerEventEnum.OnForward,n=>{n.stopPropagation(),this.forward()}),this._controller.addEventListener(ControllerEventEnum.OnBackward,n=>{n.stopPropagation(),this.backward()}),this._slider.addEventListener("change",n=>{const o=Math.floor(n.detail.value)+.5;this._dataIndex=n.detail.value>=o?Math.ceil(n.detail.value):Math.floor(n.detail.value),this._slider.setValue(this._dataIndex),this.dispatchCustomEvent(PlayerEventEnum.change)}))},this.play=()=>{this._isPlaying||this._data.length!==1&&(this._controller.togglePause(),this._isPlaying=!0,(isReachEnd({dataIndex:this._dataIndex,maxIndex:this._maxIndex,minIndex:this._minIndex,direction:this._direction})||isReachStart({dataIndex:this._dataIndex,maxIndex:this._maxIndex,minIndex:this._minIndex,direction:this._direction}))&&(this._direction===DirectionEnum.Default?this._updateDataIndex(this._minIndex):this._updateDataIndex(this._maxIndex)),this.dispatchCustomEvent(PlayerEventEnum.play),this._isReachEnd=!1,this._tickTime=Date.now(),this._rafId=vglobal.getRequestAnimationFrame()(this._play.bind(this,!0)))},this._play=n=>{const o=Date.now();if(this._isReachEnd&&o-this._tickTime>=this._interval)return this._isReachEnd=!1,void this._playEnd();n&&this._activeIndex!==this._dataIndex?(this.dispatchCustomEvent(PlayerEventEnum.change),this._activeIndex=this._dataIndex):o-this._tickTime>=this._interval&&(this._tickTime=o,this._updateDataIndex(forwardStep(this._direction,this._dataIndex,this._minIndex,this._maxIndex)),this._activeIndex=this._dataIndex,this.dispatchCustomEvent(PlayerEventEnum.change)),(this._direction==="default"&&this._dataIndex>=this._maxIndex||this._direction==="reverse"&&this._dataIndex<=this._minIndex)&&(this._isReachEnd=!0),this._rafId=vglobal.getRequestAnimationFrame()(this._play.bind(this,!1))},this._updateDataIndex=n=>{this._dataIndex=n,this._slider.setValue(this._dataIndex)},this._playEnd=()=>{this._isPlaying=!1,this._controller.togglePlay(),vglobal.getCancelAnimationFrame()(this._rafId),this._activeIndex=-1,this.dispatchCustomEvent(PlayerEventEnum.end)},this.pause=()=>{this._isPlaying&&(this._isPlaying=!1,vglobal.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(PlayerEventEnum.pause))},this.backward=()=>{const{loop:n=!1}=this.attribute;let o;o=n?this._dataIndex-1<this._minIndex?this._maxIndex:this._dataIndex-1:Math.max(this._dataIndex-1,this._minIndex),this._updateDataIndex(o),this.dispatchCustomEvent(PlayerEventEnum.change),this.dispatchCustomEvent(PlayerEventEnum.backward)},this.forward=()=>{const{loop:n=!1}=this.attribute;let o;o=n?this._dataIndex+1>this._maxIndex?this._minIndex:this._dataIndex+1:Math.min(this._dataIndex+1,this._maxIndex),this._updateDataIndex(o),this.dispatchCustomEvent(PlayerEventEnum.change),this.dispatchCustomEvent(PlayerEventEnum.forward)},this._initAttributes(),this._initDataIndex(),this._initEvents()}setAttributes(e,i){super.setAttributes(e,i),this._initAttributes()}dispatchCustomEvent(e){super.dispatchCustomEvent(e,this._dataIndex)}}var __awaiter$2=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};loadContinuousPlayerComponent();class ContinuousPlayer extends BasePlayer{constructor(e){super(e),this._isPlaying=!1,this._startTime=Date.now(),this._initAttributes=()=>{var i;super._initAttributes(),this._maxIndex=this._data.length,this._slider.setAttribute("max",this._maxIndex),this._isPlaying=!1,this._elapsed=0,this._interval=(i=this.attribute.interval)!==null&&i!==void 0?i:1e3;const n=this._data.length;this.attribute.totalDuration&&this._data.length?(this._totalDuration=this.attribute.totalDuration,this._interval=this._totalDuration/(n??1)):(this._totalDuration=this._interval*n,this._interval=this.attribute.interval)},this._initDataIndex=()=>{var i;this._dataIndex=(i=this.attribute.dataIndex)!==null&&i!==void 0?i:this._minIndex},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._controller.addEventListener(ControllerEventEnum.OnPlay,i=>{i.stopPropagation(),this.play()}),this._controller.addEventListener(ControllerEventEnum.OnPause,i=>{i.stopPropagation(),this.pause()}),this._controller.addEventListener(ControllerEventEnum.OnForward,i=>{i.stopPropagation(),this.forward()}),this._controller.addEventListener(ControllerEventEnum.OnBackward,i=>{i.stopPropagation(),this.backward()}),this._slider.addEventListener("change",i=>{var n;i.stopPropagation();const o=(n=i.detail)===null||n===void 0?void 0:n.value,l=o/this._maxIndex;this._elapsed=l*this._totalDuration,this._startTime=Date.now()-this._elapsed,this._dispatchChange(o)}))},this._getSliderValue=()=>{const i=this._elapsed/this._totalDuration;return Math.min(i*this._maxIndex,this._maxIndex)},this._updateSlider=()=>{const i=this._getSliderValue();this._dataIndex=Math.floor(i),this._slider.setValue(Math.min(i,this._maxIndex)),this._dispatchChange(Math.floor(i))},this._dispatchChange=i=>{const n=Math.floor(i);n!==this._activeIndex&&(this._dataIndex=n,this._activeIndex=n,n!==this._maxIndex&&this.dispatchCustomEvent(PlayerEventEnum.change))},this.play=()=>__awaiter$2(this,void 0,void 0,function*(){this._isPlaying||(this._controller.togglePause(),this._isPlaying=!0,this._elapsed>=this._totalDuration&&(this._elapsed=0),this._startTime=Date.now()-this._elapsed,this.dispatchCustomEvent(PlayerEventEnum.play),this._rafId=vglobal.getRequestAnimationFrame()(this._play.bind(this)))}),this._play=()=>{this._elapsed=Date.now()-this._startTime;const i=this._getSliderValue();this._updateSlider(),i>=this._maxIndex?this._playEnd():this._rafId=vglobal.getRequestAnimationFrame()(this._play.bind(this))},this._playEnd=()=>{this._isPlaying=!1,vglobal.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(PlayerEventEnum.end)},this.pause=()=>{this._isPlaying&&(this._isPlaying=!1,this._elapsed=Date.now()-this._startTime,vglobal.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(PlayerEventEnum.pause))},this.backward=()=>{const i=Date.now(),n=1*this._interval,o=this._elapsed-n;o<=0?(this._elapsed=0,this._startTime=i):(this._elapsed=o,this._startTime=this._startTime+this._interval),this._updateSlider(),this.dispatchCustomEvent(PlayerEventEnum.backward)},this.forward=()=>{const i=Date.now(),n=1*this._interval,o=this._elapsed+n;o>=this._totalDuration?(this._startTime=i-this._totalDuration,this._elapsed=this._totalDuration):(this._startTime=this._startTime-n,this._elapsed=o),this._updateSlider(),this.dispatchCustomEvent(PlayerEventEnum.forward)},this._initAttributes(),this._initDataIndex(),this._initEvents()}dispatchCustomEvent(e){super.dispatchCustomEvent(e,this._dataIndex)}render(){super.render()}}var IOperateType;(function(r){r.drawStart="drawStart",r.drawEnd="drawEnd",r.drawing="drawing",r.moving="moving",r.moveStart="moveStart",r.moveEnd="moveEnd",r.brushClear="brushClear"})(IOperateType||(IOperateType={}));const DEFAULT_BRUSH_ATTRIBUTES={trigger:"pointerdown",updateTrigger:"pointermove",endTrigger:"pointerup",resetTrigger:"pointerupoutside",hasMask:!0,brushMode:"single",brushType:"rect",brushStyle:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",strokeWidth:2},brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:10,interactiveRange:{y1:-1/0,y2:1/0,x1:-1/0,x2:1/0}},DEFAULT_SIZE_THRESHOLD=5;function loadBrushComponent(){registerGroup(),registerPolygon()}const delayMap$1={debounce,throttle};loadBrushComponent();let Brush$1=class je extends AbstractComponent{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},je.defaultAttributes,e)),this.name="brush",this._activeDrawState=!1,this._cacheDrawPoints=[],this._isDrawedBeforeEnd=!1,this._activeMoveState=!1,this._operatingMaskMoveDx=0,this._operatingMaskMoveDy=0,this._operatingMaskMoveRangeX=[-1/0,1/0],this._operatingMaskMoveRangeY=[-1/0,1/0],this._brushMaskAABBBoundsDict={},this._onBrushStart=n=>{var o;if(this._outOfInteractiveRange(n))return;n.stopPropagation();const l=(o=this.attribute.brushMoved)===null||o===void 0||o;this._activeMoveState=l&&this._isPosInBrushMask(n),this._activeDrawState=!this._activeMoveState,this._activeDrawState&&this._initDraw(n),this._activeMoveState&&this._initMove(n)},this._onBrushing=n=>{this._outOfInteractiveRange(n)||((this._activeDrawState||this._activeMoveState)&&n.stopPropagation(),this._activeDrawState&&this._drawing(n),this._activeMoveState&&this._moving(n))},this._onBrushingWithDelay=this.attribute.delayTime===0?this._onBrushing:delayMap$1[this.attribute.delayType](this._onBrushing,this.attribute.delayTime),this._onBrushEnd=n=>{var o;if(!this._activeDrawState&&!this._activeMoveState)return;n.preventDefault();const{removeOnClick:l=!0}=this.attribute;this._activeDrawState&&!this._isDrawedBeforeEnd&&l?(!((o=this._operatingMask)===null||o===void 0)&&o._AABBBounds.empty()&&this._dispatchEvent(IOperateType.brushClear,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:n}),this._container.incrementalClearChild(),this._brushMaskAABBBoundsDict={}):(this._activeDrawState&&this._dispatchEvent(IOperateType.drawEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:n}),this._activeMoveState&&this._dispatchEvent(IOperateType.moveEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:n})),this._activeDrawState=!1,this._activeMoveState=!1,this._isDrawedBeforeEnd=!1,this._operatingMask&&this._operatingMask.setAttribute("pickable",!1)}}_bindBrushEvents(){if(this.attribute.disableTriggerEvent)return;const{trigger:e=DEFAULT_BRUSH_ATTRIBUTES.trigger,updateTrigger:i=DEFAULT_BRUSH_ATTRIBUTES.updateTrigger,endTrigger:n=DEFAULT_BRUSH_ATTRIBUTES.endTrigger,resetTrigger:o=DEFAULT_BRUSH_ATTRIBUTES.resetTrigger}=this.attribute;this.stage.addEventListener(e,this._onBrushStart),this.stage.addEventListener(i,this._onBrushingWithDelay),this.stage.addEventListener(n,this._onBrushEnd),this.stage.addEventListener(o,this._onBrushEnd)}_isPosInBrushMask(e){const i=this.eventPosToStagePos(e),n=this._container.getChildren();for(let o=0;o<n.length;o++){const{points:l=[],dx:u=0,dy:d=0}=n[o].attribute,f=l.map(g=>({x:g.x+u,y:g.y+d}));if(polygonContainPoint(f,i.x,i.y))return this._operatingMask=n[o],!0}return!1}_initDraw(e){const{brushMode:i}=this.attribute,n=this.eventPosToStagePos(e);this._cacheDrawPoints=[n],this._isDrawedBeforeEnd=!1,i==="single"&&(this._brushMaskAABBBoundsDict={},this._container.incrementalClearChild()),this._addBrushMask(),this._dispatchEvent(IOperateType.drawStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:e})}_initMove(e){var i,n;this._cacheMovePoint=this.eventPosToStagePos(e),this._operatingMaskMoveDx=(i=this._operatingMask.attribute.dx)!==null&&i!==void 0?i:0,this._operatingMaskMoveDy=(n=this._operatingMask.attribute.dy)!==null&&n!==void 0?n:0;const{interactiveRange:o}=this.attribute,{minY:l=-1/0,maxY:u=1/0,minX:d=-1/0,maxX:f=1/0}=o,{x1:g,x2:_,y1:y,y2:b}=this._operatingMask.globalAABBBounds,S=d-g,v=f-_,A=l-y,x=u-b;this._operatingMaskMoveRangeX=[S,v],this._operatingMaskMoveRangeY=[A,x],this._operatingMask.setAttribute("pickable",!0),this._dispatchEvent(IOperateType.moveStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:e})}_drawing(e){var i,n;const o=this.eventPosToStagePos(e),{sizeThreshold:l=DEFAULT_SIZE_THRESHOLD,brushType:u}=this.attribute,d=this._cacheDrawPoints.length;if(d>0){const S=(i=this._cacheDrawPoints[this._cacheDrawPoints.length-1])!==null&&i!==void 0?i:{};if(o.x===S.x&&o.y===S.y)return}u==="polygon"||d<=1?this._cacheDrawPoints.push(o):this._cacheDrawPoints[d-1]=o;const f=this._computeMaskPoints();this._operatingMask.setAttribute("points",f);const{x1:g=0,x2:_=0,y1:y=0,y2:b=0}=(n=this._operatingMask)===null||n===void 0?void 0:n._AABBBounds;this._isDrawedBeforeEnd=!this._operatingMask._AABBBounds.empty()&&(Math.abs(_-g)>l||Math.abs(y-b)>l),this._isDrawedBeforeEnd&&(this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(IOperateType.drawing,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:e}))}_moving(e){const i=this._cacheMovePoint,n=this.eventPosToStagePos(e);if(n.x===(i==null?void 0:i.x)&&n.y===(i==null?void 0:i.y))return;const o=n.x-i.x,l=n.y-i.y,u=Math.min(this._operatingMaskMoveRangeX[1],Math.max(this._operatingMaskMoveRangeX[0],o))+this._operatingMaskMoveDx,d=Math.min(this._operatingMaskMoveRangeY[1],Math.max(this._operatingMaskMoveRangeY[0],l))+this._operatingMaskMoveDy;this._operatingMask.setAttributes({dx:u,dy:d}),this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(IOperateType.moving,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:e})}_computeMaskPoints(){const{brushType:e,xRange:i=[0,0],yRange:n=[0,0]}=this.attribute;let o=[];const l=this._cacheDrawPoints[0],u=this._cacheDrawPoints[this._cacheDrawPoints.length-1];return o=e==="rect"?[l,{x:u.x,y:l.y},u,{x:l.x,y:u.y}]:e==="x"?[{x:l.x,y:n[0]},{x:u.x,y:n[0]},{x:u.x,y:n[1]},{x:l.x,y:n[1]}]:e==="y"?[{x:i[0],y:l.y},{x:i[0],y:u.y},{x:i[1],y:u.y},{x:i[1],y:l.y}]:cloneDeep(this._cacheDrawPoints),o}_addBrushMask(){var e;const{brushStyle:i,hasMask:n}=this.attribute,o=graphicCreator.polygon(Object.assign(Object.assign({points:cloneDeep(this._cacheDrawPoints),cursor:"move",pickable:!1},i),{opacity:n?(e=i.opacity)!==null&&e!==void 0?e:1:0}));o.name=`brush-${Date.now()}`,this._operatingMask=o,this._container.add(o),this._brushMaskAABBBoundsDict[o.name]=o.AABBBounds}_outOfInteractiveRange(e){const{interactiveRange:i}=this.attribute,{minY:n=-1/0,maxY:o=1/0,minX:l=-1/0,maxX:u=1/0}=i,d=this.eventPosToStagePos(e);return d.x>u||d.x<l||d.y>o||d.y<n}eventPosToStagePos(e){return this.stage.eventPointTransform(e)}render(){this._bindBrushEvents();const e=this.createOrUpdateChild("brush-container",{},"group");this._container=e}releaseBrushEvents(){const{delayType:e="throttle",delayTime:i=0,trigger:n=DEFAULT_BRUSH_ATTRIBUTES.trigger,updateTrigger:o=DEFAULT_BRUSH_ATTRIBUTES.updateTrigger,endTrigger:l=DEFAULT_BRUSH_ATTRIBUTES.endTrigger,resetTrigger:u=DEFAULT_BRUSH_ATTRIBUTES.resetTrigger}=this.attribute;this.stage.removeEventListener(n,this._onBrushStart),this.stage.removeEventListener(o,this._onBrushingWithDelay),this.stage.removeEventListener(l,this._onBrushEnd),this.stage.removeEventListener(u,this._onBrushEnd)}};Brush$1.defaultAttributes=DEFAULT_BRUSH_ATTRIBUTES;const mergeRowAttrs=(r,...e)=>{const i=[r.shape,...e.map(l=>l==null?void 0:l.shape)],n=[r.key,...e.map(l=>l==null?void 0:l.key)],o=[r.value,...e.map(l=>l==null?void 0:l.value)];return merge$1(r,...e,{shape:i.every(isNil)?void 0:merge$1({},...i),key:n.every(isNil)?void 0:merge$1({},...n),value:o.every(isNil)?void 0:merge$1({},...o)})},getRichTextAttribute=r=>{const{width:e,height:i,wordBreak:n="break-word",textAlign:o,textBaseline:l,text:u}=r;return Array.isArray(u)?{width:e,height:i,wordBreak:n,textAlign:o,textBaseline:l,singleLine:!1,textConfig:array(u).map(d=>Object.assign(Object.assign({},r),{text:d}))}:{width:e,height:i,wordBreak:n,textAlign:o,textBaseline:l,singleLine:!1,textConfig:u==null?void 0:u.text}},defaultAttributes={panel:{visible:!0,cornerRadius:[3,3,3,3],fill:"white",shadow:!0,shadowBlur:12,shadowColor:"rgba(0, 0, 0, 0.1)",shadowOffsetX:0,shadowOffsetY:4,shadowSpread:0,stroke:"white"},titleStyle:{value:{fill:"#4E5969",fontFamily:DEFAULT_TEXT_FONT_FAMILY,fontSize:14,lineHeight:18,textAlign:"left",textBaseline:"middle"},spaceRow:6},contentStyle:{shape:{fill:"black",size:8,symbolType:"circle",spacing:6},key:{fill:"#4E5969",fontFamily:DEFAULT_TEXT_FONT_FAMILY,fontSize:12,lineHeight:18,textAlign:"left",textBaseline:"middle",spacing:26},value:{fill:"#4E5969",fontFamily:DEFAULT_TEXT_FONT_FAMILY,fontSize:12,lineHeight:18,textAlign:"right",textBaseline:"middle",spacing:0},spaceRow:6},padding:10,positionX:"right",positionY:"bottom",offsetX:10,offsetY:10,parentBounds:new AABBBounds().setValue(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),autoCalculatePosition:!0,autoMeasure:!0,pickable:!1,childrenPickable:!1,zIndex:500},TOOLTIP_POSITION_ATTRIBUTES=["pointerX","pointerY","offsetX","offsetY","positionX","positionY","parentBounds"];function loadTooltipComponent(){registerGroup(),registerRect(),registerSymbol(),registerText(),registerRichtext()}loadTooltipComponent();let Tooltip$1=class Ee extends AbstractComponent{constructor(e,i){super(i!=null&&i.skipDefault?e:merge$1({},Ee.defaultAttributes,e),i),this.name="tooltip"}render(){var e;const{visible:i,content:n,panel:o,keyWidth:l,valueWidth:u,hasContentShape:d,autoCalculatePosition:f,autoMeasure:g,align:_}=this.attribute;if(!i)return void this.hideAll();g&&Ee.measureTooltip(this.attribute),f&&Ee.calculateTooltipPosition(this.attribute);const y=normalizePadding$1(this.attribute.padding);this._tooltipPanel=this.createOrUpdateChild("tooltip-background",Object.assign({visible:!0},o),"rect"),this._tooltipTitleContainer=this.createOrUpdateChild("tooltip-title",{visible:!0,x:y[3],y:y[0]},"group");const b=Ee.getTitleAttr(this.attribute);this._tooltipTitleSymbol=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-shape",merge$1({symbolType:"circle"},b.shape,{visible:isVisible(b)&&isVisible(b.shape)}),"symbol"),typeof b.value.text!="object"||b.value.text===null||b.value.text.type!=="rich"&&b.value.text.type!=="html"?b.value.multiLine?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({visible:isVisible(b)&&isVisible(b.value)},getRichTextAttribute(b.value)),"richtext"):this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({text:(e=b.value.text)!==null&&e!==void 0?e:"",visible:isVisible(b)&&isVisible(b.value)},b.value),"text"):b.value.text.type==="rich"?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({visible:isVisible(b)&&isVisible(b.value)},getRichTextAttribute(b.value)),"richtext"):b.value.text.type==="html"&&(this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({html:Object.assign(Object.assign({dom:b.value.text.text},DEFAULT_HTML_TEXT_SPEC),b.value),visible:isVisible(b)&&isVisible(b.value),width:b.value.width,height:b.value.height,wordBreak:b.value.wordBreak,textAlign:b.value.textAlign,textBaseline:b.value.textBaseline,singleLine:!1,textConfig:[]},b.value),"richtext"));const S=isVisible(b.shape)?b.shape.size+b.shape.spacing:0,{textAlign:v,textBaseline:A}=b.value,x=o.width-y[3]-y[0]-S;v==="center"?this._tooltipTitle.setAttribute("x",S+x/2):v==="right"||v==="end"?this._tooltipTitle.setAttribute("x",S+x):this._tooltipTitle.setAttribute("x",S),A==="bottom"?this._tooltipTitle.setAttribute("y",b.height):A==="middle"?this._tooltipTitle.setAttribute("y",b.height/2):this._tooltipTitle.setAttribute("y",0);const T=isVisible(b)?b.height+b.spaceRow:0;if(this._tooltipContent=this.createOrUpdateChild("tooltip-content",{visible:!0},"group"),this._tooltipContent.removeAllChild(!0),n&&n.length){this._tooltipContent.setAttribute("x",y[3]),this._tooltipContent.setAttribute("y",y[0]+T);let C=0;n.forEach((E,P)=>{const L=Ee.getContentAttr(this.attribute,P);if(!isVisible(L))return;const R=`tooltip-content-${P}`,w=this._tooltipContent.createOrUpdateChild(R,{visible:!0,x:0,y:C},"group"),D=L.shape.size+L.shape.spacing;let I=_==="right"?(d?D:0)+(isVisible(L.key)?l+L.key.spacing:0)+(isVisible(L.value)?u:0):0;this._createShape(_==="right"?I-L.shape.size/2:I+L.shape.size/2,L,w,R),d&&(_==="right"?I-=D:I+=D);const O=this._createKey(L,w,R);O&&(alignTextInLine(_,O,L.key.textAlign,I,l),O.setAttribute("y",0),_==="right"?I-=l+L.key.spacing:I+=l+L.key.spacing);const B=this._createValue(L,w,R);if(B){let N="right";isValid(L.value.textAlign)?N=L.value.textAlign:isVisible(L.key)||_==="right"||(N="left"),B.setAttribute("textAlign",N),alignTextInLine(_,B,N,I,u),B.setAttribute("y",0)}C+=L.height+L.spaceRow})}}_createShape(e,i,n,o){var l;if(isVisible(i.shape))return n.createOrUpdateChild(`${o}-shape`,Object.assign({visible:!0,x:e,y:i.shape.size/2+(((l=calculateLineHeight(i.key.lineHeight,i.key.fontSize))!==null&&l!==void 0?l:i.key.fontSize)-i.shape.size)/2},i.shape),"symbol")}_createKey(e,i,n){var o;if(isVisible(e.key)){let l;return l=e.key.multiLine?i.createOrUpdateChild(`${n}-key`,Object.assign(Object.assign({visible:!0},getRichTextAttribute(e.key)),{textBaseline:"top"}),"richtext"):typeof e.key.text!="object"||e.key.text===null||e.key.text.type!=="rich"&&e.key.text.type!=="html"?i.createOrUpdateChild(`${n}-key`,Object.assign(Object.assign({visible:!0,text:(o=e.key.text)!==null&&o!==void 0?o:""},e.key),{textBaseline:"top"}),"text"):e.key.text.type==="rich"?i.createOrUpdateChild(`${n}-value`,Object.assign(Object.assign({visible:!0},getRichTextAttribute(e.key)),{textBaseline:"top"}),"richtext"):i.createOrUpdateChild(`${n}-value`,{html:Object.assign(Object.assign({dom:e.key.text.text},DEFAULT_HTML_TEXT_SPEC),e.key)},"richtext"),l}}_createValue(e,i,n){var o;if(isVisible(e.value)){let l;return l=e.value.multiLine?i.createOrUpdateChild(`${n}-value`,Object.assign(Object.assign({visible:!0},getRichTextAttribute(e.value)),{textBaseline:"top"}),"richtext"):typeof e.value.text!="object"||e.value.text===null||e.value.text.type!=="rich"&&e.value.text.type!=="html"?i.createOrUpdateChild(`${n}-value`,Object.assign(Object.assign({visible:!0,text:(o=e.value.text)!==null&&o!==void 0?o:""},e.value),{textBaseline:"top"}),"text"):e.value.text.type==="rich"?i.createOrUpdateChild(`${n}-value`,Object.assign(Object.assign({visible:!0},getRichTextAttribute(e.value)),{textBaseline:"top"}),"richtext"):i.createOrUpdateChild(`${n}-value`,{html:Object.assign({dom:e.value.text.text,container:"",width:30,height:30,style:{}},e.value)},"richtext"),l}}setAttributes(e,i){const n=Object.keys(e);this.attribute.autoCalculatePosition&&n.every(o=>TOOLTIP_POSITION_ATTRIBUTES.includes(o))?(this._mergeAttributes(e,n),isNil(this.attribute.panel.width)&&this.attribute.autoMeasure&&Ee.measureTooltip(this.attribute),Ee.calculateTooltipPosition(this.attribute),super.setAttributes({x:this.attribute.x,y:this.attribute.y},i)):super.setAttributes(e,i)}static calculateTooltipPosition(e){const{width:i=0,height:n=0}=e.panel,{offsetX:o,offsetY:l,pointerX:u,pointerY:d,positionX:f,positionY:g,parentBounds:_}=e;let y=u,b=d;return f==="left"?y-=i+o:f==="center"?y-=i/2:y+=o,g==="top"?b-=n+l:g==="middle"?b-=n/2:b+=l,y+i>_.x2&&(y-=i+o),b+n>_.y2&&(b-=n+l),y<_.x1&&(y=_.x1),b<_.y1&&(b=_.y1),e.x=y,e.y=b,e}static measureTooltip(e){const{content:i,contentStyle:n}=e,o=normalizePadding$1(e.padding),l=Ee.getTitleAttr(e);let u=0,d=o[0]+o[2],f=0;const{value:g,shape:_}=l,{visible:y=!1,symbolType:b=""}=_??{};if(isValid(g)&&typeof l.value.text!="object"){const{width:S,height:v}=initTextMeasure$1(g).quickMeasure(g.text);u=S,f=v}if(y&&builtinSymbolsMap[b]&&(u+=_.size+_.spacing,f=Math.max(_.size,f)),e.title&&(e.title.width=u,e.title.height=f),isVisible(l)&&(d+=f+l.spaceRow),i&&i.length){const S=[];if(i.forEach((v,A)=>{const x=Ee.getContentAttr(e,A);(v.key||v.value)&&isVisible(x)&&S.push([v,x])}),S.length){let v=!1;const A=[],x=[],T=[];S.forEach(([L,R],w)=>{var D;const{key:I,value:O,shape:B,spaceRow:N}=R,$=isVisible(B),H=(D=B==null?void 0:B.symbolType)!==null&&D!==void 0?D:"",F=initTextMeasure$1(I),V=initTextMeasure$1(O);let G=0;if(isVisible(I)){const{width:Y,height:J}=F.quickMeasure(I.text);x.push(Y),G=Math.max(G,J)}if(isVisible(O)){const{width:Y,height:J}=V.quickMeasure(O.text);T.push(Y),G=Math.max(G,J)}$&&builtinSymbolsMap[H]&&(v=!0,A.push(B.size),G=Math.max(B.size,G)),L.height=G,d+=G,w<S.length-1&&(d+=N??n.spaceRow)});const C=A.length?Math.max(...A):0,E=x.length?Math.max(...x):0,P=T.length?Math.max(...T):0;u=Math.max(E+P+n.key.spacing+n.value.spacing+(v?C+n.shape.spacing:0),u),i.forEach(L=>{L.width=u}),e.hasContentShape=v,e.keyWidth=E,e.valueWidth=P}}return e.panel.width=u+o[1]+o[3],e.panel.height=d,e}static getTitleAttr(e){return mergeRowAttrs({},Ee.defaultAttributes.titleStyle,Ee.defaultAttributes.title,e.titleStyle,e.title)}static getContentAttr(e,i){return mergeRowAttrs({},Ee.defaultAttributes.contentStyle,e.contentStyle,e.content[i])}};Tooltip$1.defaultAttributes=defaultAttributes;const isClose=isNumberClose;function normalizeStartEndAngle(r,e){let i=0,n=2*Math.PI;const o=isValid(r),l=isValid(e);for(o||l?l?o?(i=r,n=e):(i=e-2*Math.PI,n=e):(i=r,n=r+2*Math.PI):(i=0,n=2*Math.PI);n<=i;)n+=2*Math.PI;for(;i>2*Math.PI;)i-=2*Math.PI,n-=2*Math.PI;for(;n<0;)i+=2*Math.PI,n+=2*Math.PI;return{startAngle:i,endAngle:n}}function outOfBounds(r,e,i){return r.x1>e||r.x2<e||r.y1>i||r.y2<i}function min(r,e){const i=[];return r.forEach(n=>{const o=+n[e];isValidNumber(o)&&i.push(o)}),i.length===0?null:minInArray(i)}function max(r,e){const i=[];return r.forEach(n=>{const o=+n[e];isValidNumber(o)&&i.push(o)}),i.length===0?null:maxInArray(i)}function sum$1(r,e){return r.reduce((i,n)=>{const o=e?+n[e]:+n;return isValidNumber(o)&&(i+=o),i},0)}function average$1(r,e){let i=0,n=0;return r.forEach(o=>{const l=e?+o[e]:+o;isValidNumber(l)&&(i+=l,n++)}),i/n}function variance(r,e){const i=average$1(r,e);return r.length<=1?0:r.reduce((o,l)=>o+(e?+l[e]:+l-i)**2,0)/(r.length-1)}function standardDeviation(r,e){return Math.sqrt(variance(r,e))}function median(r,e){return median$1(r.map(i=>i[e]))}function regression(r,e,i){const{predict:n}=regressionLinear(r,f=>f[e],f=>f[i]),o=min(r,e),l=max(r,e),u=n(o),d=n(l);return[{[e]:o,[i]:u},{[e]:l,[i]:d}]}function radiusLabelOrientAttribute(r){let e="center",i="middle";return e=(r=normalizeAngle(r))>=Math.PI*(7/6)&&r<=Math.PI*(11/6)?"right":r>=Math.PI*(1/6)&&r<=Math.PI*(5/6)?"left":"center",i=r>=Math.PI*(5/3)||r<=Math.PI*(1/3)?"bottom":r>=Math.PI*(2/3)&&r<=Math.PI*(4/3)?"top":"middle",{align:e,baseline:i}}function vectorAngle(r,e){const i=distance(r),n=distance(e),o=Math.asin((r.x*e.y-e.x*r.y)/i/n),l=Math.acos((r.x*e.x+r.y*e.y)/i/n);return o<0?-l:l}function distance(r,e={x:0,y:0}){return PointService.distancePP(r,e)}function getPercentValue(r,e=2){const i=r.reduce((g,_)=>g+(isNaN(_)?0:_),0);if(i===0)return 0;const n=Math.pow(10,e),o=r.map(g=>(isNaN(g)?0:g)/i*n*100),l=100*n,u=o.map(g=>Math.floor(g));let d=u.reduce((g,_)=>g+_,0);const f=o.map((g,_)=>g-u[_]);for(;d<l;){let g=Number.NEGATIVE_INFINITY,_=null;for(let y=0;y<f.length;y++)f[y]>g&&(g=f[y],_=y);++u[_],f[_]=0,++d}return u.map(g=>g/n)}function isValidPoint(r){return isValidNumber(r.x)&&isValidNumber(r.y)}function eachSeries(r,e,i){let n=!1;if(e&&isFunction(e)){for(const o of r)for(const l of o.getSeries(i))if(n=!!e.call(null,l),n)return n}return n}function getSeries(r,e){const i=[];for(const n of r)for(const o of n.getSeries(e))i.push(o);return i}const getFirstSeries=(r,e)=>{for(let i=0;i<r.length;i++){const n=r[i].getSeries();for(let o=0;o<n.length;o++){const l=n[o];if(e&&l&&l.coordinate===e||!e&&l)return l}}return null};function field$2(r){return function(e){let i;return i=isArray(r)?r.reduce((n,o)=>n==null?void 0:n[o],e):e==null?void 0:e[r],i}}var SeriesTypeEnum;(function(r){r.area="area",r.line="line",r.bar="bar",r.bar3d="bar3d",r.rangeColumn="rangeColumn",r.rangeColumn3d="rangeColumn3d",r.rangeArea="rangeArea",r.dot="dot",r.geo="geo",r.link="link",r.map="map",r.pie="pie",r.pie3d="pie3d",r.radar="radar",r.rose="rose",r.scatter="scatter",r.circularProgress="circularProgress",r.wordCloud="wordCloud",r.wordCloud3d="wordCloud3d",r.funnel="funnel",r.funnel3d="funnel3d",r.linearProgress="linearProgress",r.boxPlot="boxPlot",r.sankey="sankey",r.gaugePointer="gaugePointer",r.gauge="gauge",r.treemap="treemap",r.sunburst="sunburst",r.circlePacking="circlePacking",r.waterfall="waterfall",r.heatmap="heatmap",r.correlation="correlation",r.liquid="liquid",r.venn="venn",r.mosaic="mosaic",r.pictogram="pictogram"})(SeriesTypeEnum||(SeriesTypeEnum={}));var SeriesMarkNameEnum;(function(r){r.label="label",r.point="point",r.line="line",r.area="area",r.bar="bar",r.bar3d="bar3d",r.boxPlot="boxPlot",r.outlier="outlier",r.circlePacking="circlePacking",r.group="group",r.gridBackground="gridBackground",r.grid="grid",r.dot="dot",r.title="title",r.subTitle="subTitle",r.symbol="symbol",r.funnel="funnel",r.funnel3d="funnel3d",r.transform="transform",r.transform3d="transform3d",r.transformLabel="transformLabel",r.outerLabel="outerLabel",r.outerLabelLine="outerLabelLine",r.pin="pin",r.pinBackground="pinBackground",r.pointer="pointer",r.segment="segment",r.track="track",r.cell="cell",r.cellBackground="cellBackground",r.link="link",r.arrow="arrow",r.pie="pie",r.pie3d="pie3d",r.labelLine="labelLine",r.progress="progress",r.minLabel="minLabel",r.maxLabel="maxLabel",r.rose="rose",r.node="node",r.sunburst="sunburst",r.nonLeaf="nonLeaf",r.leaf="leaf",r.nonLeafLabel="nonLeafLabel",r.leaderLine="leaderLine",r.stackLabel="stackLabel",r.word="word",r.fillingWord="fillingWord",r.wordMask="wordMask",r.nodePoint="nodePoint",r.ripplePoint="ripplePoint",r.centerPoint="centerPoint",r.centerLabel="centerLabel",r.barBackground="barBackground",r.lineLabel="lineLabel",r.areaLabel="areaLabel",r.liquidGroup="liquidGroup",r.liquid="liquid",r.liquidBackground="liquidBackground",r.liquidOutline="liquidOutline",r.circle="circle",r.overlap="overlap",r.overlapLabel="overlapLabel",r.pictogram="pictogram"})(SeriesMarkNameEnum||(SeriesMarkNameEnum={}));function getDirectionFromSeriesSpec(r){var e,i;const{type:n}=r;return n===SeriesTypeEnum.sankey?(e=r.direction)!==null&&e!==void 0?e:"horizontal":(i=r.direction)!==null&&i!==void 0?i:"vertical"}const newTokenToLegacyToken={primaryFontColor:"titleFontColor",tertiaryFontColor:"labelFontColor",axisLabelFontColor:"axisFontColor",axisMarkerFontColor:"labelReverseFontColor",dataZoomHandleStrokeColor:"dataZoomHandlerStrokeColor",sliderHandleColor:"dataZoomHandlerFillColor",sliderRailColor:"dataZoomBackgroundColor",sliderTrackColor:"dataZoomSelectedColor",playerControllerColor:"dataZoomSelectedColor",popupBackgroundColor:"tooltipBackgroundColor",hoverBackgroundColor:"axisGridColor"},legacyTokenToNewToken={titleFontColor:"primaryFontColor",labelFontColor:"tertiaryFontColor",axisFontColor:"axisLabelFontColor",labelReverseFontColor:"axisMarkerFontColor",dataZoomHandlerStrokeColor:"dataZoomHandleStrokeColor",dataZoomHandlerFillColor:"sliderHandleColor",dataZoomBackgroundColor:"sliderRailColor",dataZoomSelectedColor:"sliderTrackColor",tooltipBackgroundColor:"popupBackgroundColor"};function getUpgradedTokenValue(r,e){const i=newTokenToLegacyToken[e];if(i&&r[i])return r[i];if(r[e])return r[e];const n=legacyTokenToNewToken[e];return n?r[n]:void 0}function getDataScheme(r,e){var i;if(!r)return[];const n=getColorSchemeBySeries(r,e);if(!n||isArray(n))return(i=n)!==null&&i!==void 0?i:[];if(isObject$1(n)){const{dataScheme:o}=n;return o?isProgressiveDataColorScheme(o)?o.map(l=>Object.assign(Object.assign({},l),{scheme:l.scheme.map(u=>isColorKey(u)?queryColorFromColorScheme(r,u,e):u).filter(isValid)})):o.map(l=>isColorKey(l)?queryColorFromColorScheme(r,l,e):l).filter(isValid):[]}return[]}function computeActualDataScheme(r,e){var i,n;return isProgressiveDataColorScheme(r)?(n=(i=r.find(o=>isValid(o.isAvailable)?isFunction(o.isAvailable)?o.isAvailable(e):!!o.isAvailable:!isValid(o.maxDomainLength)||(e==null?void 0:e.length)<=o.maxDomainLength))===null||i===void 0?void 0:i.scheme)!==null&&n!==void 0?n:r[r.length-1].scheme:r}function queryColorFromColorScheme(r,e,i){var n;const o=getColorSchemeBySeries(r,i);if(!o)return;let l;const{palette:u}=o;if(isObject$1(u)&&(l=(n=getUpgradedTokenValue(u,e.key))!==null&&n!==void 0?n:e.default),!l)return;if(isNil(e.a)&&isNil(e.l)||!isString(l))return l;let d=new Color(l);if(isValid(e.l)){const{r:f,g,b:_}=d.color,{h:y,s:b}=rgbToHsl(f,g,_),S=hslToRgb(y,b,e.l),v=new Color(`rgb(${S.r}, ${S.g}, ${S.b})`);v.setOpacity(d.color.opacity),d=v}return isValid(e.a)&&d.setOpacity(e.a),d.toRGBA()}const getActualColor=(r,e,i)=>{if(e&&isColorKey(r)){const n=queryColorFromColorScheme(e,r,i);if(n)return n}return r};function isColorKey(r){return r&&r.type==="palette"&&!!r.key}function isProgressiveDataColorScheme(r){return!(!isArray(r)||r.length===0)&&r.every(e=>isValid(e.scheme))}function transformColorSchemeToStandardStruct(r){return isArray(r)?{dataScheme:r}:r}function getColorSchemeBySeries(r,e){var i,n;const{type:o}=e??{};let l;if(!e||isNil(o))l=r==null?void 0:r.default;else{const u=getDirectionFromSeriesSpec(e);l=(n=(i=r==null?void 0:r[`${o}_${u}`])!==null&&i!==void 0?i:r==null?void 0:r[o])!==null&&n!==void 0?n:r==null?void 0:r.default}return l}class ColorOrdinalScale extends OrdinalScale{range(e){return e?(this._range=e,this._resetRange(),this):super.range()}domain(e){return e?(super.domain(e),this._resetRange(),this):super.domain()}_resetRange(){if(!isProgressiveDataColorScheme(this._range))return void super.range(this._range);const e=computeActualDataScheme(this._range,this._domain);super.range(e)}}const defaultScaleMap={linear:LinearScale,band:BandScale,point:PointScale,ordinal:OrdinalScale,threshold:ThresholdScale,colorOrdinal:ColorOrdinalScale};function createScale(r){const e=defaultScaleMap[r];return e?new e:null}function createScaleWithSpec(r,e){if("scale"in r&&r.scale)return isString(r.scale)&&(e!=null&&e.globalScale)?e.globalScale.registerMarkAttributeScale(r,e.seriesId):r.scale;const i=createScale(r.type);return i&&initScaleWithSpec(i,r),i}function initScaleWithSpec(r,e){r&&e&&(e.domain&&r.domain(e.domain),e.range&&r.range(e.range),e.specified&&r.specified&&r.specified(e.specified))}function valueInScaleRange(r,e,i){if(!e)return r;const n=e.range(),o=i&&e._calculateWholeRange?e._calculateWholeRange(n):e.range(),l=Math.min(o[0],o[o.length-1]),u=Math.max(o[0],o[o.length-1]);return Math.min(Math.max(l,r),u)}function isSpecValueWithScale(r){return isValid(r==null?void 0:r.field)&&isValid(r==null?void 0:r.scale)}function isValidOrient(r){switch(r){case"left":case"right":case"top":case"bottom":return!0;default:return!1}}function isPercent(r){return!!isString(r)&&!!r.endsWith("%")&&couldBeValidNumber(r.substring(0,r.length-1))}function isPercentOffset(r){return!!isObject$1(r)&&("percent"in r||"offset"in r)}function calcLayoutNumber(r,e,i,n=0){var o,l;return isNumber(r)?r:isPercent(r)?Number(r.substring(0,r.length-1))*e/100:isFunction(r)?r(i):isObject$1(r)?e*((o=r.percent)!==null&&o!==void 0?o:0)+((l=r.offset)!==null&&l!==void 0?l:0):n}function calcPadding(r,e,i){var n,o,l,u;const d={top:0,bottom:0,left:0,right:0};return Object.values(r).every(f=>isNumber(f))?(d.top=(n=r.top)!==null&&n!==void 0?n:0,d.right=(o=r.right)!==null&&o!==void 0?o:0,d.bottom=(l=r.bottom)!==null&&l!==void 0?l:0,d.left=(u=r.left)!==null&&u!==void 0?u:0,d):([{orients:["left","right"],size:e.width},{orients:["top","bottom"],size:e.height}].forEach(f=>{f.orients.forEach(g=>{d[g]=calcLayoutNumber(r[g],f.size,i)})}),d)}function boundsInRect(r,e){return r?{width:Math.ceil(Math.min(r.x2-r.x1,e.width)),height:Math.ceil(Math.min(r.y2-r.y1,e.height))}:{width:0,height:0}}function normalizeLayoutPaddingSpec(r){let e={};return isArray(r)?(isNil(r[0])||(e.top=e.left=e.bottom=e.right=r[0]),isNil(r[1])||(e.left=e.right=r[1]),isNil(r[2])||(e.bottom=r[2]),isNil(r[3])||(e.left=r[3]),e):isNumber(r)||isPercent(r)||isFunction(r)||isPercentOffset(r)?(e.top=e.left=e.bottom=e.right=r,e):(isObject$1(r)&&(e=Object.assign({},r)),e)}function convertPoint(r,e,i){return i?{x:r.x+e.x,y:r.y+e.y}:r}const getActualNumValue=(r,e)=>{const i=Number(r),n=r.toString();return isNaN(i)&&n[n.length-1]==="%"?e*(Number(n.slice(0,n.length-1))/100):i},dataScheme=[{maxDomainLength:10,scheme:["#1664FF","#1AC6FF","#FF8A00","#3CC780","#7442D4","#FFC400","#304D77","#B48DEB","#009488","#FF7DDA"]},{scheme:["#1664FF","#B2CFFF","#1AC6FF","#94EFFF","#FF8A00","#FFCE7A","#3CC780","#B9EDCD","#7442D4","#DDC5FA","#FFC400","#FAE878","#304D77","#8B959E","#B48DEB","#EFE3FF","#009488","#59BAA8","#FF7DDA","#FFCFEE"]}],colorScheme$1={default:{dataScheme,palette:{backgroundColor:"#ffffff",borderColor:"#e3e5e8",shadowColor:"rgba(33,37,44,0.1)",hoverBackgroundColor:"#f1f2f5",sliderRailColor:"#f1f3f4",sliderHandleColor:"#ffffff",sliderTrackColor:"#0040ff",popupBackgroundColor:"#ffffff",primaryFontColor:"#21252c",secondaryFontColor:"#606773",tertiaryFontColor:"#89909d",axisLabelFontColor:"#89909d",disableFontColor:"#bcc1cb",axisMarkerFontColor:"#ffffff",axisGridColor:"#f1f2f5",axisDomainColor:"#d9dde4",dataZoomHandleStrokeColor:"#aeb5be",dataZoomChartColor:"#c9ced8",playerControllerColor:"#0040ff",scrollBarSliderColor:"rgba(0,0,0,0.3)",axisMarkerBackgroundColor:"#21252c",markLabelBackgroundColor:"#f1f2f5",markLineStrokeColor:"#606773",dangerColor:"#e33232",warningColor:"#ffc528",successColor:"#07a35a",infoColor:"#3073f2",discreteLegendPagerTextColor:"rgb(51, 51, 51)",discreteLegendPagerHandlerColor:"rgb(47, 69, 84)",discreteLegendPagerHandlerDisableColor:"rgb(170, 170, 170)",emptyCircleColor:"#e3e5e8",linearProgressTrackColor:"#E7EBED"}}},area={label:{visible:!1,offset:5,position:"top",style:{stroke:{type:"palette",key:"backgroundColor"},lineWidth:2}},point:{style:{symbolType:"circle"}},seriesMark:"area"},bar={label:{visible:!1,position:"outside",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}},bar3d={bar3d:{style:{length:3}},label:{visible:!1,style:{offset:12,position:"outside"}}},circularProgress={outerRadius:.8,innerRadius:.6,progress:{style:{fillOpacity:1}},track:{style:{fillOpacity:.2}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},dot={dot:{style:{size:10,fillOpacity:1}},symbol:{style:{size:10}},title:{style:{textAlign:"left",textBaseline:"middle",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},subTitle:{style:{textAlign:"left",textBaseline:"top",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},getFunnelTheme=r=>{const e={label:{style:{fill:"white",textBaseline:"middle",lineWidth:2}},outerLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"}},line:{style:{stroke:{type:"palette",key:"axisDomainColor"}}}},transformLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle"}}};return e[r?"transform3d":"transform"]={style:{fill:{type:"palette",key:"axisGridColor"}}},e},funnel$1=getFunnelTheme(),funnel3d=getFunnelTheme(!0),gauge={outerRadius:.8,innerRadius:.6,padAngle:1.146,segment:{style:{fillOpacity:1}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},pointerPath="M-0.020059 -0.978425 C-0.018029 -0.9888053 -0.013378 -1 0 -1 C0.01342 -1 0.01812 -0.989146 0.0201 -0.978425 C0.02161 -0.9702819 0.0692 -0.459505 0.09486 -0.184807 C0.10298 -0.097849 0.1089 -0.034548 0.11047 -0.018339 C0.11698 0.04908 0.07373 0.11111 0.00002 0.11111 C-0.07369 0.11111 -0.117184 0.04991 -0.110423 -0.018339 C-0.103662 -0.086591 -0.022089 -0.9680447 -0.020059 -0.978425Z",circlePath="M1 0 C1 0.55228 0.55228 1 0 1 C-0.552285 1 -1 0.55228 -1 0 C-1 -0.552285 -0.552285 -1 0 -1 C0.55228 -1 1 -0.552285 1 0Z",gaugePointer={pointer:{type:"path",width:.4,height:.4,style:{path:pointerPath}},pin:{width:.025,height:.025,style:{path:circlePath,fill:"#888"}},pinBackground:{width:.06,height:.06,style:{path:circlePath,fill:"#ddd"}}},line={label:{visible:!1,position:"top",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}},linearProgress={bandWidth:30,progress:{style:{fillOpacity:1}},track:{style:{fill:{type:"palette",key:"linearProgressTrackColor"},fillOpacity:1}}},link={arrow:{style:{size:10}}},map$1={defaultFillColor:"#f3f3f3",area:{style:{lineWidth:.5,strokeOpacity:1,stroke:"black",fillOpacity:1}},label:{interactive:!1,style:{fontSize:{type:"token",key:"l6FontSize"},lineHeight:{type:"token",key:"l6LineHeight"},textBaseline:"middle",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},stroke:{type:"palette",key:"backgroundColor"}}}},pie$1={outerRadius:.6,pie:{style:{fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside",style:{fontWeight:"normal",stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1}},innerLabel:{style:{lineWidth:2}},emptyCircle:{style:{fill:{type:"palette",key:"emptyCircleColor"},fillOpacity:1}}},pie3d={outerRadius:.6,pie3d:{style:{height:10,fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside"}},radar={label:{visible:!1,offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}},scatter={point:{style:{size:8,symbolType:"circle",lineWidth:0,fillOpacity:.8}},label:{visible:!1,offset:5,position:"top",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}},waterfall$1={seriesFieldName:{total:"total",increase:"increase",decrease:"decrease"},leaderLine:{style:{stroke:"black",lineWidth:1,lineDash:[4,4]}},stackLabel:{visible:!0,offset:12,position:"withChange",style:{fill:"black",fontSize:{type:"token",key:"l4FontSize"}}},label:{visible:!1,offset:12,position:"inside",style:{lineWidth:2}}},wordCloud={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}},wordCloud3d={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}},treemap={gapWidth:1,nodePadding:[5],nonLeaf:{visible:!1,style:{fillOpacity:.5}},label:{style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},nonLeafLabel:{padding:24,style:{fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},textBaseline:"middle",textAlign:"center"}}},PREFIX="__VCHART",DEFAULT_CHART_WIDTH=500,DEFAULT_CHART_HEIGHT=500,ARC_TRANSFORM_VALUE=`${PREFIX}_ARC_TRANSFORM_VALUE`,ARC_RATIO=`${PREFIX}_ARC_RATIO`,ARC_START_ANGLE=`${PREFIX}_ARC_START_ANGLE`,ARC_END_ANGLE=`${PREFIX}_ARC_END_ANGLE`,ARC_K=`${PREFIX}_ARC_K`,ARC_MIDDLE_ANGLE=`${PREFIX}_ARC_MIDDLE_ANGLE`,ARC_QUADRANT=`${PREFIX}_ARC_QUADRANT`,ARC_RADIAN=`${PREFIX}_ARC_RADIAN`,POLAR_START_RADIAN=-Math.PI/2,POLAR_END_RADIAN=3*Math.PI/2,POLAR_START_ANGLE=-90,POLAR_END_ANGLE=270,POLAR_DEFAULT_RADIUS=.6,sunburst={innerRadius:0,outerRadius:1,startAngle:POLAR_START_ANGLE,endAngle:POLAR_END_ANGLE,gap:0,labelLayout:{align:"center",offset:0,rotate:"radial"},sunburst:{style:{stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1,cursor:"pointer"}},label:{visible:!0,style:{cursor:"pointer",fill:{type:"palette",key:"primaryFontColor"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},rangeColumn={label:{visible:!1,offset:5,position:"inside",style:{lineWidth:2,fill:{type:"palette",key:"axisMarkerFontColor"}},minLabel:{position:"end"},maxLabel:{position:"start"}}},circlePacking={layoutPadding:5,circlePacking:{visible:!0,style:{cursor:"pointer",stroke:{type:"palette",key:"backgroundColor"}}},label:{visible:!0,style:{cursor:"pointer",fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},heatmap={cell:{style:{shape:"square",fillOpacity:1}},cellBackground:{visible:!1}},sankey={link:{style:{fillOpacity:.15,round:!0}}},rose={rose:{style:{fillOpacity:1}},label:{style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"},textAlign:"center",textBaseline:"middle"}}},boxPlot={boxPlot:{style:{lineWidth:1}},label:{style:{lineWidth:2}}},correlation$1={centerLabel:{visible:!0,position:"center",style:{fill:"#fff",text:""}},label:{visible:!0,position:"bottom",style:{fill:"#000"}}},liquid={outlinePadding:10,liquidBackground:{style:{lineWidth:0,fillOpacity:.2}},liquidOutline:{style:{lineWidth:2}}},venn={circle:{style:{opacity:.8},state:{hover:{opacity:1}}},overlap:{style:{opacity:.8},state:{hover:{opacity:1,stroke:"white",lineWidth:2}}},label:{visible:!0,style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"}}},overlapLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},mosaic={label:{visible:!1,position:"center",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},bar:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}}},series={scatter,line,area,bar,bar3d,pie:pie$1,pie3d,map:map$1,radar,dot,link,wordCloud,wordCloud3d,funnel:funnel$1,funnel3d,linearProgress,circularProgress,waterfall:waterfall$1,gauge,gaugePointer,treemap,sunburst,rangeColumn,circlePacking,heatmap,sankey,rose,boxPlot,correlation:correlation$1,liquid,venn,mosaic},markByType={text:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1}}},markByName={label:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1,lineJoin:"bevel"}},area:{style:{fillOpacity:.2}},line:{style:{lineWidth:2,lineCap:"round",lineJoin:"round"}},point:{style:{size:8,stroke:{type:"palette",key:"backgroundColor"},lineWidth:1,fillOpacity:1}},word:{style:{fontWeight:null,fontSize:null}},fillingWord:{style:{fontWeight:null,fontSize:null}},sunburst:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},circlePacking:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},funnel3d:{style:{stroke:!1}},barBackground:{visible:!1,style:{fill:{type:"palette",key:"primaryFontColor",a:.06},stroke:"transparent"}}},axisBand={domainLine:{visible:!0},grid:{visible:!1},subGrid:{visible:!1},tick:{visible:!0},subTick:{visible:!1}},axisX={label:{space:8},title:{space:8},maxHeight:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},axisY={label:{space:12,autoLimit:!0},title:{space:12,autoRotate:!0},maxWidth:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},axisZ=Object.assign(Object.assign({},axisX),{label:{space:0}}),commonAxis={domainLine:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,inside:!1,tickSize:4,alignWithLabel:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},subTick:{visible:!1,tickSize:2,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},label:{visible:!0,inside:!1,space:10,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}},title:{space:10,padding:0,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor"},fontWeight:"normal",fillOpacity:1}}},axisLinear={domainLine:{visible:!1},grid:{visible:!0},subGrid:{visible:!1},tick:{visible:!1},subTick:{visible:!1}},axisRadius={grid:{smooth:!0,visible:!0},subGrid:{smooth:!0,visible:!1}},axisAngle={grid:{visible:!0,style:{lineDash:[6,6]}},label:{space:5}},brush={style:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",lineWidth:2},brushMode:"single",brushType:"rect",brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:0},crosshair={trigger:"hover",bandField:{visible:!1,line:{type:"rect",visible:!0,style:{fill:{type:"palette",key:"axisGridColor"},opacity:.7,lineWidth:0,stroke:{type:"palette",key:"markLineStrokeColor"},lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}},linearField:{visible:!1,line:{type:"line",visible:!0,style:{stroke:{type:"palette",key:"markLineStrokeColor"},fill:"transparent",opacity:.7,lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}}},DataZoomHandlerSymbolType=`M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3
C-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C0.3-1.4,0.3-1.4,0.3-1.4z;`,getHandlerTheme=()=>({style:{symbolType:DataZoomHandlerSymbolType,fill:{type:"palette",key:"sliderHandleColor"},scaleX:1.2,scaleY:1.2,stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},lineWidth:1}}),getBackgroundChartTheme=r=>({area:{style:{visible:r,stroke:!1,fill:{type:"palette",key:"dataZoomChartColor"}}},line:{style:{visible:r,stroke:{type:"palette",key:"dataZoomChartColor"},lineWidth:1}}}),dataZoom={padding:[12,0],showDetail:"auto",brushSelect:!1,middleHandler:{visible:!1,background:{size:6,style:{stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},cornerRadius:2}},icon:{style:{size:4,fill:{type:"palette",key:"sliderHandleColor"},stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}}},background:{size:20,style:{fill:{type:"palette",key:"sliderRailColor"},lineWidth:0}},selectedBackground:{style:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.1,outerBorder:{stroke:{type:"palette",key:"sliderTrackColor"},strokeOpacity:.2,distance:-.5,lineWidth:1}}},selectedBackgroundChart:getBackgroundChartTheme(!1),startHandler:getHandlerTheme(),endHandler:getHandlerTheme(),startText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},endText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},backgroundChart:getBackgroundChartTheme(!0)},getTextStyle$1=(r,e)=>({fontSize:{type:"token",key:r},fill:{type:"palette",key:e},fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}),indicator={title:{visible:!0,autoLimit:!1,autoFit:!1,style:getTextStyle$1("l1FontSize","primaryFontColor")},content:{visible:!0,style:getTextStyle$1("l2FontSize","tertiaryFontColor")}},DEFAULT_CONTINUOUS_LEGEND_THEME={orient:"right",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"primaryFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},endText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},handlerText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6}},getColorLegendTheme=r=>{const e={width:200,height:8,style:{fill:{type:"palette",key:"sliderRailColor"}}};return r?(e.width=200,e.height=8):(e.width=8,e.height=200),Object.assign(Object.assign({},DEFAULT_CONTINUOUS_LEGEND_THEME),{rail:e,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:"#ffffff"},shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"}}}})},colorLegend$1={horizontal:getColorLegendTheme(!0),vertical:getColorLegendTheme(!1)},discreteLegend$1={orient:"bottom",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"primaryFontColor"},fontWeight:"normal"},space:12},pager:{textStyle:{fill:{type:"palette",key:"discreteLegendPagerTextColor"}},handler:{style:{fill:{type:"palette",key:"discreteLegendPagerHandlerColor"}},state:{disable:{fill:{type:"palette",key:"discreteLegendPagerHandlerDisableColor"}}}}},item:{visible:!0,spaceCol:10,spaceRow:6,padding:2,background:{state:{selectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}},unSelectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}}}},shape:{space:6,style:{lineWidth:0,fillOpacity:1,opacity:1},state:{unSelected:{fillOpacity:.2,opacity:1}}},label:{space:6,style:{fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},opacity:1},state:{unSelected:{fill:{type:"palette",key:"disableFontColor"},opacity:1}}}},allowAllCanceled:!1},getSizeLegendTheme=r=>{const e={style:{fill:{type:"palette",key:"sliderRailColor"}}};return r?(e.width=200,e.height=4):(e.height=200,e.width=4),Object.assign(Object.assign({},DEFAULT_CONTINUOUS_LEGEND_THEME),{sizeBackground:{fill:{type:"palette",key:"dataZoomChartColor"}},track:{style:{fill:{type:"palette",key:"sliderTrackColor",a:.8}}},rail:e,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:{type:"palette",key:"sliderTrackColor"}},fill:{type:"palette",key:"sliderHandleColor"}}}})},sizeLegend$1={horizontal:getSizeLegendTheme(!0),vertical:getSizeLegendTheme(!1)},mapLabel={visible:!0,offset:12,position:"top",space:10,nameLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},valueLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},background:{visible:!0,padding:{top:4,bottom:4,left:6,right:6},style:{cornerRadius:2,lineWidth:1,fill:"white",stroke:"grey"}},leader:{visible:!1,style:{lineWidth:1,stroke:"red"}}},getCommonLabelTheme=()=>({style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fontStyle:"normal",fill:{type:"palette",key:"primaryFontColor"}},labelBackground:{padding:{top:2,bottom:2,right:4,left:4},style:{cornerRadius:3,fill:{type:"palette",key:"markLabelBackgroundColor"}}}}),markArea={area:{style:{fill:{type:"palette",key:"axisDomainColor",a:.25}}},label:getCommonLabelTheme()},getSymbolTheme=r=>({visible:r,symbolType:"triangle",size:10,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}}),labelTheme=getCommonLabelTheme();labelTheme.refY=5;const markLine={line:{style:{lineDash:[3,3],stroke:{type:"palette",key:"markLineStrokeColor"}}},startSymbol:getSymbolTheme(!1),endSymbol:getSymbolTheme(!0),label:labelTheme},markPoint={itemLine:{decorativeLine:{visible:!1},startSymbol:{size:5,visible:!0,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},endSymbol:{style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},line:{style:{stroke:{type:"palette",key:"markLineStrokeColor"}}}},itemContent:{offsetY:-50}},player={visible:!0,position:"start",padding:{top:20,bottom:20},slider:{space:10,trackStyle:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.8},railStyle:{fill:{type:"palette",key:"sliderRailColor"}},handlerStyle:{size:15,stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fill:{type:"palette",key:"playerControllerColor"}}},controller:{start:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},pause:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},backward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},forward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}}}},title$1={padding:{top:4,bottom:20},textStyle:{fontSize:{type:"token",key:"l3FontSize"},lineHeight:{type:"token",key:"l3LineHeight"},fill:{type:"palette",key:"primaryFontColor"}},subtextStyle:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fill:{type:"palette",key:"tertiaryFontColor"}}},tooltip$1={offset:{x:10,y:10},panel:{padding:{top:10,left:10,right:10,bottom:10},backgroundColor:{type:"palette",key:"popupBackgroundColor"},border:{color:{type:"palette",key:"popupBackgroundColor"},width:0,radius:3},shadow:{x:0,y:4,blur:12,spread:0,color:{type:"palette",key:"shadowColor"}}},spaceRow:6,titleLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0},shape:{size:8,spacing:6},keyLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle",spacing:26},valueLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0}},poptip={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:{type:"token",key:"l5FontSize"},fontWeight:"bold",fill:{type:"palette",key:"primaryFontColor"}},contentStyle:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"primaryFontColor"}},panel:{visible:!0,fill:{type:"palette",key:"popupBackgroundColor"},cornerRadius:3,lineWidth:0,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"},size:0,space:12}},totalLabel={visible:!1,offset:5,overlap:{clampForce:!0,strategy:[]},smartInvert:!1,animation:!1,style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"primaryFontColor"}}},scrollBar={horizontal:{height:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}},vertical:{width:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}}},component={discreteLegend:discreteLegend$1,colorLegend:colorLegend$1,sizeLegend:sizeLegend$1,axis:commonAxis,axisBand,axisLinear,axisX,axisY,axisZ,axisAngle,axisRadius,markLine,markArea,markPoint,polarMarkLine:markLine,polarMarkArea:markArea,polarMarkPoint:markPoint,geoMarkPoint:markPoint,tooltip:tooltip$1,dataZoom,crosshair,player,brush,indicator,title:title$1,mapLabel,poptip,totalLabel,scrollBar};function queryToken(r,e){return r&&e.key in r?r[e.key]:e.default}function isTokenKey(r){return r&&r.type==="token"&&!!r.key}const token={fontFamily:"PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",fontSize:14,l1FontSize:32,l1LineHeight:"150%",l2FontSize:20,l2LineHeight:"140%",l3FontSize:16,l3LineHeight:"150%",l4FontSize:14,l4LineHeight:"150%",l5FontSize:12,l5LineHeight:"130%",l6FontSize:10,l6LineHeight:"120%"},lightTheme={name:"light",background:{type:"palette",key:"backgroundColor"},padding:20,fontFamily:{type:"token",key:"fontFamily"},colorScheme:colorScheme$1,token,mark:markByType,markByName,series,component,animationThreshold:2e3},colorScheme={default:{dataScheme,palette:{backgroundColor:"#202226",borderColor:"#404349",shadowColor:"rgba(0,0,0,0.1)",hoverBackgroundColor:"#404349",sliderRailColor:"#404349",sliderHandleColor:"#202226",sliderTrackColor:"#4284FF",popupBackgroundColor:"#404349",primaryFontColor:"#fdfdfd",secondaryFontColor:"#bbbdc3",tertiaryFontColor:"#888c93",axisLabelFontColor:"#888c93",disableFontColor:"#55595f",axisMarkerFontColor:"#202226",axisGridColor:"#404349",axisDomainColor:"#4b4f54",dataZoomHandleStrokeColor:"#bbbdc3",dataZoomChartColor:"#55595F",playerControllerColor:"#4284FF",scrollBarSliderColor:"rgba(255,255,255,0.3)",axisMarkerBackgroundColor:"#fdfdfd",markLabelBackgroundColor:"#404349",markLineStrokeColor:"#bbbdc3",dangerColor:"#eb4b4b",warningColor:"#f0bd30",successColor:"#14b267",infoColor:"#4284ff",discreteLegendPagerTextColor:"#BBBDC3",discreteLegendPagerHandlerColor:"#BBBDC3",discreteLegendPagerHandlerDisableColor:"#55595F",emptyCircleColor:"#bbbdc3",linearProgressTrackColor:"#404349"}}},darkTheme$1={name:"dark",colorScheme,component:{dataZoom:{selectedBackground:{style:{fillOpacity:.4,outerBorder:{strokeOpacity:.4}}}}}},setProperty=(r,e,i)=>{if(isNil(e))return r;const n=e[0];return isNil(n)?r:e.length===1?(r[n]=i,r):(isNil(r[n])&&(typeof e[1]=="number"?r[n]=[]:r[n]={}),setProperty(r[n],e.slice(1),i))},getProperty=(r,e,i)=>{if(!isNil(e))return get(r,e,i)};function mergeSpec(r,...e){let i=-1;const n=e.length;for(;++i<n;){const o=e[i];baseMerge(r,o,!0,!0)}return r}function mergeSpecWithFilter(r,e,i,n){Object.keys(r).forEach(o=>{if(isObject$1(e))e.type===o&&(isArray(r[o])?r[o].length>=e.index&&(r[o][e.index]=n?mergeSpec({},r[o][e.index],i):i):r[o]=n?mergeSpec({},r[o],i):i);else if(isArray(r[o])){const l=r[o].findIndex(u=>u.id===e);l>=0&&(r[o][l]=n?mergeSpec({},r[o][l],i):i)}else r.id===e&&(r[o]=n?mergeSpec({},r[o],i):i)})}let Factory$1=class be{static registerChart(e,i){be._charts[e]=i}static registerSeries(e,i){be._series[e]=i}static registerComponent(e,i,n){be._components[e]={cmp:i,alwaysCheck:n}}static registerMark(e,i){be._marks[e]=i}static registerRegion(e,i){be._regions[e]=i}static registerTransform(e,i){be.transforms[e]=i}static registerLayout(e,i){be._layout[e]=i}static registerAnimation(e,i){be._animations[e]=i}static registerImplement(e,i){be._implements[e]=i}static registerChartPlugin(e,i){be._chartPlugin[e]=i}static registerComponentPlugin(e,i){be._componentPlugin[e]=i}static createChart(e,i,n){return be._charts[e]?new be._charts[e](i,n):null}static createChartSpecTransformer(e,i){if(!be._charts[e])return null;const n=be._charts[e];return new n.transformerConstructor(Object.assign({seriesType:n.seriesType},i))}static createRegion(e,i,n){return be._regions[e]?new be._regions[e](i,n):null}static createRegionSpecTransformer(e,i){return be._regions[e]?new be._regions[e].transformerConstructor(i):null}static createSeries(e,i,n){return be._series[e]?new be._series[e](i,n):null}static createSeriesSpecTransformer(e,i){return be._series[e]?new be._series[e].transformerConstructor(i):null}static createMark(e,i,n){if(!be._marks[e])return null;const o=new be._marks[e](i,n);return o.type==="group"&&o.setMarkConfig({interactive:!1}),o}static getComponents(){return Object.values(be._components)}static getComponentInKey(e){return be._components[e].cmp}static getLayout(){return Object.values(be._layout)}static getLayoutInKey(e){return be._layout[e]}static getSeries(){return Object.values(be._series)}static getSeriesInType(e){return be._series[e]}static getRegionInType(e){return be._regions[e]}static getAnimationInKey(e){return be._animations[e]}static getImplementInKey(e){return be._implements[e]}static getSeriesMarkMap(e){return be._series[e]?be._series[e].mark:{}}static getChartPlugins(){return Object.values(be._chartPlugin)}static getComponentPlugins(){return Object.values(be._componentPlugin)}static getComponentPluginInType(e){return be._componentPlugin[e]}static registerFormatter(e){this._formatter=e}static getFormatter(){return this._formatter}};Factory$1._charts={},Factory$1._series={},Factory$1._components={},Factory$1._marks={},Factory$1._regions={},Factory$1._animations={},Factory$1._implements={},Factory$1._chartPlugin={},Factory$1._componentPlugin={},Factory$1.transforms={fields,filter,fold},Factory$1.dataParser={csv:csvParser,dsv:dsvParser,tsv:tsvParser},Factory$1._layout={};function mergeTheme(r,...e){return mergeSpec(transformThemeToMerge(r),...e.map(transformThemeToMerge))}function transformThemeToMerge(r){var e;if(!r)return r;const i=transformColorSchemeToMerge(r.colorScheme);return Object.assign({},r,{colorScheme:i,token:(e=r.token)!==null&&e!==void 0?e:{},series:Object.assign({},r.series)})}function transformColorSchemeToMerge(r){return r&&(r=Object.keys(r).reduce((e,i)=>{const n=r[i];return e[i]=transformColorSchemeToStandardStruct(n),e},{})),r}function transformSeriesThemeToMerge(r,e,i,n){const o=Factory$1.getSeriesMarkMap(e);if(!o)return r;const l={};return Object.values(o).forEach(({type:u,name:d})=>{l[d]=mergeSpec({},i==null?void 0:i[array(u)[0]],n==null?void 0:n[d],r==null?void 0:r[d])}),Object.assign(Object.assign({},r),l)}const IGNORE_KEYS=["animationThreshold","colorScheme","name","padding"];function preprocessTheme(r,e,i,n){if(!r)return r;e||(e=r.colorScheme),i||(i=r.token);const o={};return Object.keys(r).forEach(l=>{const u=r[l];IGNORE_KEYS.includes(l)?o[l]=u:isPlainObject(u)?isColorKey(u)?o[l]=getActualColor(u,e,n):isTokenKey(u)?o[l]=queryToken(i,u):o[l]=preprocessTheme(u,e,i,n):o[l]=u}),o}const builtinThemes={[lightTheme.name]:lightTheme},defaultThemeName=lightTheme.name,themes=new Map(Object.keys(builtinThemes).map(r=>[r,builtinThemes[r]])),transformedThemes=new Map(Object.keys(builtinThemes).map(r=>[r,preprocessTheme(builtinThemes[r])])),hasThemeMerged=new Map(Object.keys(builtinThemes).map(r=>[r,r===defaultThemeName])),registerTheme=(r,e)=>{if(!r)return;const i=getMergedTheme(e);themes.set(r,i),transformedThemes.set(r,preprocessTheme(i)),hasThemeMerged.set(r,!0)},getTheme=(r=defaultThemeName,e=!1)=>(hasThemeMerged.has(r)&&!hasThemeMerged.get(r)&&registerTheme(r,themes.get(r)),e?transformedThemes.get(r):themes.get(r)),removeTheme=r=>themes.delete(r)&&transformedThemes.delete(r)&&hasThemeMerged.delete(r),themeExist=r=>!!isString(r)&&themes.has(r),getMergedTheme=r=>{var e;const i=(e=r.type)!==null&&e!==void 0?e:defaultThemeName,n=getTheme(i);return mergeTheme({},n,r)};class InstanceManager{static registerInstance(e){InstanceManager.instances.set(e.id,e)}static unregisterInstance(e){InstanceManager.instances.delete(e.id)}static getInstance(e){return InstanceManager.instances.get(e)}static instanceExist(e){return InstanceManager.instances.has(e)}static forEach(e,i=[],n){const o=array(i);return InstanceManager.instances.forEach((l,u,d)=>{o.includes(u)||e(l,u,d)},n)}}InstanceManager.instances=new Map;let ThemeManager$1=class Le{static registerTheme(e,i){registerTheme(e,i)}static getTheme(e,i=!1){return getTheme(e,i)}static removeTheme(e){return removeTheme(e)}static themeExist(e){return themeExist(e)}static getDefaultTheme(){return Le.themes.get(defaultThemeName)}static setCurrentTheme(e){Le.themeExist(e)&&(Le._currentThemeName=e,InstanceManager.forEach(i=>i==null?void 0:i.setCurrentTheme(e)))}static getCurrentTheme(e=!1){return Le.getTheme(Le._currentThemeName,e)}static getCurrentThemeName(){return Le._currentThemeName}};ThemeManager$1.themes=themes,ThemeManager$1._currentThemeName=defaultThemeName;function getThemeObject(r,e){return isString(r)?ThemeManager$1.themeExist(r)?ThemeManager$1.getTheme(r,e):{}:isObject$1(r)?r:{}}function specTransform(r,e={data:i=>i}){if(!r)return r;if(r.constructor===Object){const i={};for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(e[n]){i[n]=e[n](r[n]);continue}i[n]=specTransform(r[n],e)}return i}return isArray(r)?r.map(i=>specTransform(i,e)):r}function functionTransform(r,e){if(!r)return r;if(isPlainObject(r)){const i={};for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(isString(r[n])&&e.getFunction(r[n])){i[n]=e.getFunction(r[n]);continue}i[n]=functionTransform(r[n],e)}return i}return isArray(r)?r.map(i=>functionTransform(i,e)):r}const initTextMeasure=(r,e,i)=>initTextMeasure$1(r,e,i,{fontFamily:token.fontFamily,fontSize:token.fontSize}),measureText=(r,e,i,n)=>initTextMeasure(e,i,n).measure(r),DEFAULT_DATA_INDEX=`${PREFIX}_DEFAULT_DATA_INDEX`,DEFAULT_DATA_KEY=`${PREFIX}_DEFAULT_DATA_KEY`,DEFAULT_DATA_SERIES_FIELD=`${PREFIX}_DEFAULT_DATA_SERIES_FIELD`,DEFAULT_SERIES_STYLE_NAME=`${PREFIX}_DEFAULT_SERIES_STYLE_NAME`,STACK_FIELD_KEY=`${PREFIX}_STACK_KEY`,STACK_FIELD_START=`${PREFIX}_STACK_START`,STACK_FIELD_END=`${PREFIX}_STACK_END`,STACK_FIELD_START_PERCENT=`${PREFIX}_STACK_START_PERCENT`,STACK_FIELD_END_PERCENT=`${PREFIX}_STACK_END_PERCENT`,STACK_FIELD_START_OffsetSilhouette=`${PREFIX}_STACK_START_OffsetSilhouette`,STACK_FIELD_END_OffsetSilhouette=`${PREFIX}_STACK_END_OffsetSilhouette`,STACK_FIELD_TOTAL=`${PREFIX}_STACK_TOTAL`,STACK_FIELD_TOTAL_PERCENT=`${PREFIX}_STACK_TOTAL_PERCENT`,STACK_FIELD_TOTAL_TOP=`${PREFIX}_STACK_TOTAL_TOP`,STACK_FIELD_TOTAL_BOTTOM=`${PREFIX}_STACK_TOTAL_BOTTOM`,SEGMENT_FIELD_START=`${PREFIX}_SEGMENT_START`,SEGMENT_FIELD_END=`${PREFIX}_SEGMENT_END`;function mergeFields(r,e){for(let i=0;i<e.length;i++){const n=e[i],o=findFields(r,n.key);o?o.operations=[...new Set(o.operations.concat(n.operations))]:r.push(n)}return r}function findFields(r,e){return r.find(i=>i.key===e)}function getFieldAlias(r,e){var i;if(!r)return e??null;const n=r.getFields();return n&&n[e]?(i=n[e].alias)!==null&&i!==void 0?i:e:e??null}function getRegionStackGroup(r,e,i){const n=r.getStackSort(),o={};let l=null;return n&&(l={},r.getSeries().forEach(u=>{const d=u.getSeriesField();if(d){const f=u.getRawDataStatisticsByField(d);f.values&&(l[d]||(l[d]={lastIndex:0,sort:{}}),f.values.forEach((g,_)=>{g in l[d].sort||(l[d].sort[g]=l[d].lastIndex,l[d].lastIndex++)}))}})),r.getSeries().forEach(u=>{var d;const f=u.getStackData(),g=u.getStackValue(),_=u.getStackValueField(),y=!i||i(u);f&&_&&y&&(o[g]=(d=o[g])!==null&&d!==void 0?d:{groupField:f.groupField,nodes:{}},stackGroup(u,f,o[g],_,e,l))}),n?sortStackValueGroup(o):o}function sortStackValueGroup(r,e){var i;for(const n in r)!((i=r[n].sortDatums)===null||i===void 0)&&i.length?(r[n].sortDatums.sort((o,l)=>o.index-l.index),r[n].values=r[n].sortDatums.map(o=>o.datum)):sortStackValueGroup(r[n].nodes);return r}function stackTotal(r,e){if("values"in r&&r.values.length){const i=sum$1(r.values,e),n=max(r.values,STACK_FIELD_END_PERCENT);r.values.forEach(o=>{o[STACK_FIELD_TOTAL]=i,o[STACK_FIELD_TOTAL_PERCENT]=n})}else for(const i in r.nodes)stackTotal(r.nodes[i],e)}function stackOffsetSilhouette(r){if(!r.values.length)return;const e=r.values[r.values.length-1][STACK_FIELD_END]/2;for(let i=0;i<r.values.length;i++)r.values[i][STACK_FIELD_START_OffsetSilhouette]=r.values[i][STACK_FIELD_START]-e,r.values[i][STACK_FIELD_END_OffsetSilhouette]=r.values[i][STACK_FIELD_END]-e}function stack(r,e,i,n,o={key:STACK_FIELD_KEY,start:STACK_FIELD_START,end:STACK_FIELD_END,startPercent:STACK_FIELD_START_PERCENT,endPercent:STACK_FIELD_END_PERCENT,max:STACK_FIELD_TOTAL_TOP,min:STACK_FIELD_TOTAL_BOTTOM}){const l=n&&isValid(o.min),u=n&&isValid(o.max);if(r.values.length>0){let d=0,f=0,g=1,_=0,y=null,b=null;const S=r.values.length;for(let v=0;v<S;v++){const A=r.values[e?S-1-v:v];_=A[o.end],_>=0?(A[o.start]=d,d+=A[o.end],A[o.end]=d):(A[o.start]=f,f+=A[o.end],A[o.end]=f),A[o.key]=r.key,u&&(delete A[o.max],(!b||A[o.end]>b[o.end])&&(b=A)),l&&(delete A[o.min],(!y||A[o.start]<y[o.start])&&(y=A))}if(u&&b&&(b[o.max]=!0),l&&y&&(y[o.min]=!0),i)for(let v=0;v<S;v++){const A=r.values[e?S-1-v:v];_=A[o.end];const x=_>=0?d:f;g=_>=0?1:-1,A[o.startPercent]=x===0?0:Math.min(1,A[o.start]/x)*g,A[o.endPercent]=x===0?0:Math.min(1,A[o.end]/x)*g}}for(const d in r.nodes)stack(r.nodes[d],e,i,n,o)}function stackGroup(r,e,i,n,o,l,u){var d;if("values"in e)if(o&&e.values.forEach(f=>f[STACK_FIELD_END]=toValidNumber(f[n])),i.series.push({s:r,values:e.values}),l){const f=r.getSeriesField();e.values.forEach(g=>{i.sortDatums.push({series:r,datum:g,index:f?l[f].sort[g[f]]:0})})}else i.values.push(...e.values);else for(const f in e.nodes){const g=u?`${u}_${f}`:f;i.nodes[f]||(i.nodes[f]={values:[],series:[],nodes:{},sortDatums:[],key:g},isValid((d=e.nodes[f])===null||d===void 0?void 0:d.groupField)&&(i.nodes[f].groupField=e.nodes[f].groupField)),stackGroup(r,e.nodes[f],i.nodes[f],n,o,l,g)}}const findHierarchyNode=(r,e,i="key",n="children")=>{for(let o=0;o<r.length;o++){const l=r[o];if(l[i]===e)return l;if(l[n]){const u=findHierarchyNode(l[n],e,i,n);if(u)return u}}return null},findHierarchyNodeParent=(r,e,i="key",n="children")=>{for(let o=0;o<r.length;o++){const l=r[o];if(l[n])for(let u=0;u<l[n].length;u++){const d=l[n][u];if(d[i]===e)return l;const f=findHierarchyNodeParent([d],e,i,n);if(f)return f}}return null},findHierarchyPath=(r,e,i="key",n="children")=>{const o=[],l=(u,d)=>{for(const f of u){if(f[i]===e)return o.push(...d,f[i].toString()),!0;if(f[n]){const g=l(f[n],[...d,f[i]]);if(g===!0)return g}}return!1};return l(r,[]),o};function isHierarchyItem(r,e="value",i="children"){return!!isObject$1(r)&&!!r.hasOwnProperty(i)&&Array.isArray(r[i])}function filterHierarchyDataByRange(r,e,i,n="value",o="children"){return Array.isArray(r)?r.map(l=>{const u=Object.assign({},l);return Array.isArray(u[o])&&(u[o]=filterHierarchyDataByRange(u[o],e,i,n,o)),u}).filter(l=>+l[n]>=e&&+l[n]<=i||l[o]&&l[o].length>0):r}function transformComponentStyle(r={}){const e=Object.assign({},r);if(isFunction(r.style)?e.style=(i,n,o,l)=>transformToGraphic(r.style(i,n,o,l)):isEmpty(r.style)||(e.style=transformToGraphic(r.style)),!isEmpty(r.state)){const i={};Object.keys(r.state).forEach(n=>{isFunction(r.state[n])?i[n]=(o,l,u,d)=>transformToGraphic(r.state[n](o,l,u,d)):isEmpty(r.state[n])||(i[n]=transformToGraphic(r.state[n]))}),e.state=i}return e}function transformStateStyle(r){if(isEmpty(r))return null;const e={};return Object.keys(r).forEach(i=>{isFunction(r[i])?e[i]=(n,o,l,u)=>transformToGraphic(r[i](n,o,l,u)):isEmpty(r[i])||(e[i]=transformToGraphic(r[i]))}),e}function transformAxisLabelStateStyle(r){if(isEmpty(r))return null;const e={};return Object.keys(r).forEach(i=>{isFunction(r[i])?e[i]=(n,o,l,u)=>transformToGraphic(r[i](n.rawValue,o,n,l,u)):isEmpty(r[i])||(e[i]=transformToGraphic(r[i]))}),e}function transformIndicatorStyle(r,e){if(isEmpty(r))return null;const i={};return Object.keys(r).forEach(n=>{isFunction(r[n])?i[n]=r[n](e):i[n]=r[n]}),transformToGraphic(i)}function transformToGraphic(r){return r!=null&&r.angle&&(r.angle=degreeToRadian(r.angle)),r}var BuiltInEncodeNames;(function(r){r.enter="enter",r.update="update",r.exit="exit",r.group="group",r.connectNulls="connectNulls"})(BuiltInEncodeNames||(BuiltInEncodeNames={}));var DiffState;(function(r){r.enter="enter",r.update="update",r.exit="exit",r.unChange="unChange"})(DiffState||(DiffState={}));var GrammarMarkType;(function(r){r.arc="arc",r.arc3d="arc3d",r.area="area",r.image="image",r.line="line",r.path="path",r.rect="rect",r.rect3d="rect3d",r.rule="rule",r.shape="shape",r.symbol="symbol",r.text="text",r.richtext="richtext",r.polygon="polygon",r.pyramid3d="pyramid3d",r.circle="circle",r.cell="cell",r.interval="interval",r.group="group",r.glyph="glyph",r.component="component",r.largeRects="largeRects",r.largeSymbols="largeSymbols"})(GrammarMarkType||(GrammarMarkType={}));var ComponentEnum;(function(r){r.axis="axis",r.grid="grid",r.legend="legend",r.slider="slider",r.label="label",r.datazoom="datazoom",r.player="player",r.title="title",r.scrollbar="scrollbar"})(ComponentEnum||(ComponentEnum={}));var DataFilterRank;(function(r){r[r.player=1]="player",r[r.rollUp=2]="rollUp",r[r.drillDown=3]="drillDown",r[r.slider=4]="slider",r[r.datazoom=5]="datazoom",r[r.legend=6]="legend",r[r.scrollbar=7]="scrollbar",r[r.brush=8]="brush",r[r.normal=9]="normal"})(DataFilterRank||(DataFilterRank={}));var AxisEnum;(function(r){r.lineAxis="lineAxis",r.circleAxis="circleAxis"})(AxisEnum||(AxisEnum={}));var GridEnum;(function(r){r.lineAxisGrid="lineAxisGrid",r.circleAxisGrid="circleAxisGrid"})(GridEnum||(GridEnum={}));var LegendEnum;(function(r){r.discreteLegend="discreteLegend",r.colorLegend="colorLegend",r.sizeLegend="sizeLegend"})(LegendEnum||(LegendEnum={}));var CrosshairEnum;(function(r){r.lineCrosshair="lineCrosshair",r.rectCrosshair="rectCrosshair",r.sectorCrosshair="sectorCrosshair",r.circleCrosshair="circleCrosshair",r.polygonCrosshair="polygonCrosshair",r.ringCrosshair="ringCrosshair"})(CrosshairEnum||(CrosshairEnum={}));var LabelEnum;(function(r){r.symbolLabel="symbolLabel",r.rectLabel="rectLabel",r.lineLabel="lineLabel",r.dataLabel="dataLabel"})(LabelEnum||(LabelEnum={}));var PlayerEnum;(function(r){r.continuousPlayer="continuousPlayer",r.discretePlayer="discretePlayer"})(PlayerEnum||(PlayerEnum={}));var LayoutState;(function(r){r.before="before",r.layouting="layouting",r.reevaluate="reevaluate",r.after="after"})(LayoutState||(LayoutState={}));var HOOK_EVENT;(function(r){r.BEFORE_EVALUATE_DATA="beforeEvaluateData",r.AFTER_EVALUATE_DATA="afterEvaluateData",r.BEFORE_EVALUATE_SCALE="beforeEvaluateScale",r.AFTER_EVALUATE_SCALE="afterEvaluateScale",r.BEFORE_PARSE_VIEW="beforeParseView",r.AFTER_PARSE_VIEW="afterParseView",r.BEFORE_TRANSFORM="beforeTransform",r.AFTER_TRANSFORM="afterTransform",r.BEFORE_CREATE_VRENDER_STAGE="beforeCreateVRenderStage",r.AFTER_CREATE_VRENDER_STAGE="afterCreateVRenderStage",r.BEFORE_CREATE_VRENDER_LAYER="beforeCreateVRenderLayer",r.AFTER_CREATE_VRENDER_LAYER="afterCreateVRenderLayer",r.BEFORE_STAGE_RESIZE="beforeStageResize",r.AFTER_STAGE_RESIZE="afterStageResize",r.BEFORE_VRENDER_DRAW="beforeVRenderDraw",r.AFTER_VRENDER_DRAW="afterVRenderDraw",r.BEFORE_MARK_JOIN="beforeMarkJoin",r.AFTER_MARK_JOIN="afterMarkJoin",r.BEFORE_MARK_UPDATE="beforeMarkUpdate",r.AFTER_MARK_UPDATE="afterMarkUpdate",r.BEFORE_MARK_STATE="beforeMarkState",r.AFTER_MARK_STATE="afterMarkState",r.BEFORE_MARK_ENCODE="beforeMarkEncode",r.AFTER_MARK_ENCODE="afterMarkEncode",r.BEFORE_DO_LAYOUT="beforeDoLayout",r.AFTER_DO_LAYOUT="afterDoLayout",r.BEFORE_MARK_LAYOUT_END="beforeMarkLayoutEnd",r.AFTER_MARK_LAYOUT_END="afterMarkLayoutEnd",r.BEFORE_DO_RENDER="beforeDoRender",r.AFTER_DO_RENDER="afterDoRender",r.BEFORE_MARK_RENDER_END="beforeMarkRenderEnd",r.AFTER_MARK_RENDER_END="afterMarkRenderEnd",r.BEFORE_CREATE_VRENDER_MARK="beforeCreateVRenderMark",r.AFTER_CREATE_VRENDER_MARK="afterCreateVRenderMark",r.BEFORE_ADD_VRENDER_MARK="beforeAddVRenderMark",r.AFTER_ADD_VRENDER_MARK="afterAddVRenderMark",r.AFTER_VRENDER_NEXT_RENDER="afterVRenderNextRender",r.BEFORE_ELEMENT_UPDATE_DATA="beforeElementUpdateData",r.AFTER_ELEMENT_UPDATE_DATA="afterElementUpdateData",r.BEFORE_ELEMENT_STATE="beforeElementState",r.AFTER_ELEMENT_STATE="afterElementState",r.BEFORE_ELEMENT_ENCODE="beforeElementEncode",r.AFTER_ELEMENT_ENCODE="afterElementEncode",r.ANIMATION_START="animationStart",r.ANIMATION_END="animationEnd",r.ELEMENT_ANIMATION_START="elementAnimationStart",r.ELEMENT_ANIMATION_END="elementAnimationEnd",r.ALL_ANIMATION_START="allAnimationStart",r.ALL_ANIMATION_END="allAnimationEnd"})(HOOK_EVENT||(HOOK_EVENT={}));var GrammarTypeEnum;(function(r){r.signal="signal",r.data="data",r.scale="scale",r.coordinate="coordinate",r.mark="mark"})(GrammarTypeEnum||(GrammarTypeEnum={}));var InteractionStateEnum;(function(r){r.active="active",r.selected="selected",r.highlight="highlight",r.blur="blur"})(InteractionStateEnum||(InteractionStateEnum={}));const BridgeElementKey="__vgrammar_scene_item__",CollectionMarkType=[GrammarMarkType.line,GrammarMarkType.area],Mark3DType=[GrammarMarkType.arc3d,GrammarMarkType.rect3d,GrammarMarkType.pyramid3d],DefaultKey="key",DefaultMarkData=[{}],DefaultGroupKeys=["key"],DefaultReuse=!0,DefaultMorph=!0,DefaultMorphAll=!1,DefaultSplitPath=null,DefaultEnableExitAnimation=!0,ImmediateAnimationState="VGRAMMAR_IMMEDIATE_ANIMATION",DefaultAnimationStartTime=0,DefaultAnimationDuration=1e3,DefaultAnimationDelay=0,DefaultAnimationDelayAfter=0,DefaultAnimationLoop=!1,DefaultAnimationOneByOne=!1,DefaultAnimationEasing="quintInOut",DefaultAnimationControlOptions={stopWhenStateChange:!1,immediatelyApply:!0},DefaultAnimationParameters="VGRAMMAR_ANIMATION_PARAMETERS",MARK_OVERLAP_HIDE_KEY="_mo_hide_";function parseReference(r,e){return array(r).reduce((i,n)=>{const o=isString(n)?e.getGrammarById(n):n;return o&&i.push(o),i},[])}function isSignalReferenceType(r){return!isFunction(r)&&!!(r!=null&&r.signal)}function isSignalFunctionType(r){return!isFunction(r)&&!!(r!=null&&r.callback)}function parseFunctionType(r,e){if(isNil(r))return[];if(isSignalReferenceType(r)){const i=r.signal;if(isString(i))return array(e.getGrammarById(i));if((i==null?void 0:i.grammarType)==="signal")return[i]}else if(isSignalFunctionType(r))return parseReference(r.dependency,e);return[]}function isFunctionType(r){return isFunction(r)||(r==null?void 0:r.signal)||!!(r!=null&&r.callback)}function invokeFunctionType(r,e,i,n){if(isNil(r))return r;if(isFunction(r))return n?r.call(null,i,n,e):r.call(null,i,e);if(r.signal){const o=r.signal;return isString(o)?e==null?void 0:e[o]:o.output()}return r.callback?n?r.callback.call(null,i,n,e):r.callback.call(null,i,e):r}function invokeParameterFunctionType(r,e){if(isNil(r))return r;if(isFunction(r))return r.call(null,e);if(r.signal){const i=r.signal;return isString(i)?e==null?void 0:e[i]:i.output()}return r.callback?r.callback.call(null,e):r}function getGrammarOutput(r,e){return isGrammar(r)?r.output():e[r]}function isSignal(r){return r&&(r.signal||r.callback)}const isGrammar=r=>r&&!isNil(r.grammarType),parseField=r=>isFunction(r)?r:e=>e[r];function isScaleEncode(r){return!!(r!=null&&r.scale)}function isFieldEncode(r){return!!(r!=null&&r.field)}function parseEncodeType(r,e){if(!r)return[];let i=[];return r.scale&&(i=isGrammar(r.scale)?[r.scale]:array(e.getScaleById(r.scale))),i.concat(parseFunctionType(r,e))}function isValidPointsChannel(r,e){switch(e){case"line":return r.some(i=>["x","y","defined"].includes(i));case"area":return r.some(i=>["x","y","x1","y1","defined"].includes(i));case"largeRects":return r.some(i=>["x","y","width","y1"].includes(i));case"largeSymbols":return r.some(i=>["x","y"].includes(i))}return!1}function getRulePoints(r){const{x:e,y:i,x1:n,y1:o}=r;return isValidNumber(e)&&isValidNumber(i)&&isValidNumber(n)&&isValidNumber(o)?[{x:e,y:i},{x:n,y:o}]:[]}function getLinePoints(r,e,i,n){return!r||!r.length||r.length===1&&!1?[]:r.some(o=>isValidPointsChannel(Object.keys(o.nextAttrs),"line"))?r.map((o,l)=>{var u;const d=o.nextAttrs,{x:f,y:g,x1:_,y1:y,defined:b}=(u=i==null?void 0:i[l])!==null&&u!==void 0?u:{};return isNil(d.x)&&(d.x=f),isNil(d.y)&&(d.y=g),isNil(d.defined)&&b===!1&&(d.defined=!1),d.context=o.key,n&&(isNil(d.x1)&&(d.x1=_),isNil(d.y1)&&(d.y1=y)),d}):i??[]}function getLargeRectsPoints(r,e,i=[]){if(!r||!r.length||r.length===1&&!1)return[];const n=new Float32Array(4*r.length);return r.forEach((o,l)=>{var u,d,f,g;const _=o.nextAttrs,y=(u=_.x)!==null&&u!==void 0?u:i[4*l],b=(d=_.y)!==null&&d!==void 0?d:i[4*l+1],S=(f=_.width)!==null&&f!==void 0?f:i[4*l+2],v=(g=_.y1)!==null&&g!==void 0?g:i[4*l+3];n[4*l]=y,n[4*l+1]=b,n[4*l+2]=S,n[4*l+3]=v-b}),n}function getLargeSymbolsPoints(r,e,i=[]){if(!r||!r.length||r.length===1&&!1)return[];const n=new Float32Array(2*r.length);return r.forEach((o,l)=>{var u,d;const f=o.nextAttrs,g=(u=f.x)!==null&&u!==void 0?u:i[2*l],_=(d=f.y)!==null&&d!==void 0?d:i[2*l+1];n[2*l]=g,n[2*l+1]=_}),n}function isPositionOrSizeChannel(r,e){if(["x","y","dx","dy"].includes(e))return!0;switch(r){case GrammarMarkType.arc:return["innerRadius","outerRadius","startAngle","endAngle"].includes(e);case GrammarMarkType.group:case GrammarMarkType.rect:case GrammarMarkType.image:return["width","height","y1"].includes(e);case GrammarMarkType.path:case GrammarMarkType.shape:return["path","customPath"].includes(e);case GrammarMarkType.line:return e==="defined";case GrammarMarkType.area:return["x1","y1","defined"].includes(e);case GrammarMarkType.rule:return["x1","y1"].includes(e);case GrammarMarkType.symbol:return e==="size";case GrammarMarkType.polygon:return e==="points";case GrammarMarkType.text:return e==="text"}return!1}function isPointsMarkType(r){return[GrammarMarkType.line,GrammarMarkType.area,GrammarMarkType.largeRects,GrammarMarkType.largeSymbols].includes(r)}function invokeEncoderToItems(r,e,i,n,o){i&&(isFunctionType(i)?e.forEach(l=>{const u=invokeFunctionType(i,n,l.datum,r);Object.assign(l.nextAttrs,u)}):Object.keys(i).forEach(l=>{var u,d;const f=i[l],g=o&&!isPositionOrSizeChannel(r.mark.markType,l)?[e[0]]:e;if(isScaleEncode(f)){const _=getGrammarOutput(f.scale,n),y=(u=f==null?void 0:f.offset)!==null&&u!==void 0?u:0,b=!isNil(f.band)&&_.bandwidth?_.bandwidth()*f.band:null,S=isString(f==null?void 0:f.field),v=S?field$3(f.field):null;let A=S?null:isNil(f==null?void 0:f.value)?0:(d=_.scale)===null||d===void 0?void 0:d.call(_,f.value);g.forEach(x=>{var T;S&&(A=(T=_.scale)===null||T===void 0?void 0:T.call(_,v(x.datum))),x.nextAttrs[l]=isNumber(A)||isNumber(b)?A+y+b:A})}else if(isFieldEncode(f)){const _=field$3(f.field);g.forEach(y=>{y.nextAttrs[l]=_(y.datum)})}else g.forEach(_=>{_.nextAttrs[l]=invokeFunctionType(f,n,_.datum,r)})}))}function invokeEncoder(r,e,i,n){if(!r)return null;if(isFunctionType(r))return invokeFunctionType(r,n,e,i);const o={};return Object.keys(r).forEach(l=>{var u,d,f;const g=r[l];if(isScaleEncode(g)){const _=getGrammarOutput(g.scale,n),y=(u=g==null?void 0:g.offset)!==null&&u!==void 0?u:0,b=!isNil(g.band)&&_.bandwidth?_.bandwidth()*g.band:null,S=isString(g==null?void 0:g.field),v=S?field$3(g.field):null,A=S?(d=_.scale)===null||d===void 0?void 0:d.call(_,v(e)):isNil(g==null?void 0:g.value)?0:(f=_.scale)===null||f===void 0?void 0:f.call(_,g.value);o[l]=isNumber(A)||isNumber(b)?A+y+b:A}else if(isFieldEncode(g)){const _=field$3(g.field);o[l]=_(e)}else o[l]=invokeFunctionType(g,n,e,i)}),o}class GlyphMeta{constructor(e,i,n,o){this.channelEncoder={},this.marks=e,i&&this.registerChannelEncoder(i),n&&this.registerDefaultEncoder(n),this.progressiveChannels&&this.registerProgressiveChannels(o)}getMarks(){return this.marks}registerChannelEncoder(e,i){return isString(e)?this.channelEncoder[e]=i:Object.assign(this.channelEncoder,e),this}registerFunctionEncoder(e){return this.functionEncoder=e,this}registerDefaultEncoder(e){return this.defaultEncoder=e,this}registerProgressiveChannels(e){return this.progressiveChannels=array(e),this}getChannelEncoder(){return this.channelEncoder}getFunctionEncoder(){return this.functionEncoder}getDefaultEncoder(){return this.defaultEncoder}getProgressiveChannels(){return this.progressiveChannels}}class Factory{static registerPlotMarks(e,i){Factory._plotMarks[e]=i}static createPlotMark(e,i){return Factory._plotMarks[e]?new Factory._plotMarks[e](i):null}static registerMark(e,i){Factory._marks[e]=i}static createMark(e,i,n){return Factory._marks[e]?new Factory._marks[e](i,e,n):null}static hasMark(e){return!!Factory._marks[e]}static getMark(e){return Factory._marks[e]}static registerComponent(e,i){Factory._components[e]=i}static createComponent(e,i,n,o){const l=Factory._components[e];return l?new l(i,n,o):null}static hasComponent(e){return!!Factory._components[e]}static registerGraphicComponent(e,i){Factory._graphicComponents[e]=i}static createGraphicComponent(e,i,n){const o=Factory._graphicComponents[e];return o?o(i,n):null}static registerTransform(e,i,n){Factory._transforms[e]=Object.assign(i,{type:e,isBuiltIn:!!n})}static getTransform(e){return Factory._transforms[e]}static unregisterRuntimeTransforms(){Object.keys(Factory._transforms).forEach(e=>{Factory._transforms[e]&&!Factory._transforms[e].isBuiltIn&&(Factory._transforms[e]=null)})}static registerGrammar(e,i,n){Factory._grammars[e]={grammarClass:i,specKey:n??e}}static createGrammar(e,i,n){var o;const l=(o=Factory._grammars[e])===null||o===void 0?void 0:o.grammarClass;return l?new l(i,n):null}static getGrammars(){return this._grammars}static getGlyph(e){return Factory._glyphs[e]}static createInteraction(e,i,n){const o=Factory._interactions[e];return o?new o(i,n):null}static hasInteraction(e){return!!Factory._interactions[e]}}Factory._plotMarks={},Factory._marks={},Factory._components={},Factory._graphicComponents={},Factory._transforms={},Factory._grammars={},Factory._glyphs={},Factory._animations={},Factory._interactions={},Factory._graphics={},Factory._stageEventPlugins={},Factory.registerGlyph=(r,e,i,n,o)=>(Factory._glyphs[r]=new GlyphMeta(e,i,n,o),Factory._glyphs[r]),Factory.registerAnimationType=(r,e)=>{Factory._animations[r]=e},Factory.getAnimationType=r=>Factory._animations[r],Factory.registerInteraction=(r,e)=>{Factory._interactions[r]=e},Factory.registerGraphic=(r,e)=>{Factory._graphics[r]=e},Factory.getGraphicType=r=>Factory._graphics[r],Factory.createGraphic=(r,e)=>{const i=Factory._graphics[r];return i?i(e):null},Factory.registerDefaultLayout=r=>{Factory.defaultLayout=r},Factory.getDefaultLayout=()=>Factory.defaultLayout,Factory.registerStageEventPlugin=(r,e)=>{Factory._stageEventPlugins[r]=e},Factory.getStageEventPlugin=r=>Factory._stageEventPlugins[r];const isMarkType=r=>!!GrammarMarkType[r];function createGraphicItem(r,e,i={}){var n;const o=Factory.getGraphicType(e)?Factory.createGraphic(e,i):Factory.createGraphicComponent(e,i,{skipDefault:(n=r==null?void 0:r.spec)===null||n===void 0?void 0:n.skipTheme});return o||Logger.getInstance().error(`create ${e} graphic failed!`),o}function createGlyphGraphicItem(r,e,i={}){if(!Factory.getGraphicType(GrammarMarkType.glyph))return;const n=Factory.createGraphic(GrammarMarkType.glyph,i),o=e.getMarks(),l=Object.keys(o).map(u=>{if(Factory.getGraphicType(o[u])){const d=Factory.createGraphic(o[u]);if(d)return d.name=u,d}});return n.setSubGraphic(l),n}const removeGraphicItem=r=>{r&&(r[BridgeElementKey]=null,r.release(),r.parent&&r.parent.removeChild(r))},commonAttributes=["fillOpacity"],transformCommonAttribute=(r,e,i)=>{var n;return e==="fillOpacity"?(r.fillOpacity=(n=i.fillOpacity)!==null&&n!==void 0?n:1,["fillOpacity"]):[]};function storeOriginAttributes(r,e,i,n,o,l){const u=o.getGraphicAttribute(r,!1,l);if(u)return e.forEach(f=>{f in n&&(u[f]=n[f])}),u;const d={};return e.forEach(f=>{d[f]=n[f]}),i[r]=d,d}const transformsByType={rect3d:[{channels:["x","y","z","x1","y1","width","height","length"],transform:(r,e,i)=>{var n,o,l,u,d,f,g,_,y,b,S,v;isValidNumber(e.width)||!isValidNumber(e.x1)&&isValidNumber(i.width)?(r.x=Math.min((n=i.x)!==null&&n!==void 0?n:0,(o=i.x1)!==null&&o!==void 0?o:1/0),r.width=i.width):isValidNumber(e.x1)||!isValidNumber(e.width)&&isValidNumber(i.x1)?(r.x=Math.min(i.x,i.x1),r.width=Math.abs(i.x1-i.x)):(r.x=Math.min((l=i.x)!==null&&l!==void 0?l:0,(u=i.x1)!==null&&u!==void 0?u:1/0),r.width=i.width),isValidNumber(e.height)||!isValidNumber(e.y1)&&isValidNumber(i.height)?(r.y=Math.min((d=i.y)!==null&&d!==void 0?d:0,(f=i.y1)!==null&&f!==void 0?f:1/0),r.height=i.height):isValidNumber(e.y1)||!isValidNumber(e.height)&&isValidNumber(i.y1)?(r.y=Math.min(i.y,i.y1),r.height=Math.abs(i.y1-i.y)):(r.y=Math.min((g=i.y)!==null&&g!==void 0?g:0,(_=i.y1)!==null&&_!==void 0?_:1/0),r.height=i.height),isValidNumber(e.length)||!isValidNumber(e.z1)&&isValidNumber(i.length)?(r.z=Math.min((y=i.z)!==null&&y!==void 0?y:0,(b=i.z1)!==null&&b!==void 0?b:1/0),r.length=i.length):isValidNumber(e.z1)||!isValidNumber(e.length)&&isValidNumber(i.z1)?(r.z=Math.min(i.z,i.z1),r.length=Math.abs(i.z1-i.z)):(r.z=Math.min((S=i.z)!==null&&S!==void 0?S:0,(v=i.z1)!==null&&v!==void 0?v:1/0),r.length=i.length)},storedAttrs:"sizeAttrs"}],[GrammarMarkType.text]:[{channels:["text","limit","autoLimit","maxLineWidth","textType","_originText"],transform:(r,e,i)=>{var n,o,l,u;const d=(n=i.limit)!==null&&n!==void 0?n:1/0,f=(o=i.autoLimit)!==null&&o!==void 0?o:1/0,g=Math.min(d,f),_=isPlainObject(i.text)&&!isNil(i.text.text),y=_?i.text.text:i.text;r.maxLineWidth=g===1/0?i.maxLineWidth:g,_||i.textType?i.text.type==="rich"||i.textType==="rich"?r.textConfig=y:i.text.type==="html"?(r.html=y,r.text=(l=i._originText)!==null&&l!==void 0?l:"",r.renderable=!1):i.text.type==="react"?(r.react=y,r.text=(u=i._originText)!==null&&u!==void 0?u:"",r.renderable=!1):r.text=y:r.text=y},storedAttrs:"limitAttrs"}],[GrammarMarkType.rule]:[{channels:["x","y","x1","y1"],transform:(r,e,i)=>{const n=getRulePoints(i);r.points=n,r.x=0,r.y=0},storedAttrs:"pointAttrs"}],[GrammarMarkType.symbol]:[{channels:["shape","symbolType"],transform:(r,e,i)=>{var n;r.symbolType=(n=e.shape)!==null&&n!==void 0?n:e.symbolType}},{channels:["image","fill","background"],transform:(r,e,i)=>{e.image?(r.background=e.image,r.fill=!1):i.image?(r.background=i.image,r.fill=!1):(r.fill=i.fill,r.background=i.background)},storedAttrs:"imageAttrs"}]};function cloneTransformAttributes(r,e){var i;return((i=transformsByType[r])!==null&&i!==void 0?i:[]).reduce((n,o)=>(o.channels.forEach(l=>{has(e,l)&&(n[l]=e[l])}),n),{})}const transformAttributes=(r,e,i,n)=>{const o={},l=e?Object.keys(e):[],u=isString(r)?transformsByType[r]:r;if(u&&u.length){const d=[];l.forEach(f=>{let g=!1;u.forEach((_,y)=>{if(_.channels.includes(f)){if(!d[y])if(_.storedAttrs){const b=storeOriginAttributes(_.storedAttrs,_.channels,o,e,i,n);_.transform(o,e,b)}else _.transform(o,e,null);d[y]=!0,g=!0}}),g||(commonAttributes.includes(f)?transformCommonAttribute(o,f,e):o[f]=e[f])})}else l.forEach(d=>{commonAttributes.includes(d)?transformCommonAttribute(o,d,e):o[d]=e[d]});return o},isStopsEqual=(r,e)=>{var i,n;if(r===e)return!0;const o=(i=r&&r.length)!==null&&i!==void 0?i:0;return o===((n=e&&e.length)!==null&&n!==void 0?n:0)&&o!==0&&r.every((l,u)=>!l&&!e[u]||l&&e[u]&&l.color===e[u].color&&l.offset===e[u].offset)},isColorAttrEqual=(r,e)=>{if(r===e)return!0;if(typeof r!=typeof e||isString(r)||r.gradient!==e.gradient)return!1;const i=Object.keys(r),n=Object.keys(e);return i.length===n.length&&i.every(o=>o==="stops"?isStopsEqual(r[o],e[o]):r[o]===e[o])},isLineDashEqual=(r,e)=>r.length===e.length&&r.join("-")===e.join("-"),isSegmentAttrEqual=(r,e,i)=>!(!isNil(r)||!isNil(e))||!isNil(r)&&!isNil(e)&&(i==="lineDash"?isLineDashEqual(r,e):i==="stroke"||i==="fill"?isColorAttrEqual(r,e):r===e),fillAttrs=["fill","fillOpacity","background","texture","texturePadding","textureSize","textureColor"],strokeAttrs=["stroke","strokeOpacity","lineDash","lineDashOffset","lineCap","lineJoin","lineWidth","miterLimit"],areaAttrs=fillAttrs.concat(strokeAttrs);function getLineSegmentConfigs(r,e,i){var n;if(!r||r.length<=1)return null;const o=((n=i==null?void 0:i.mark)===null||n===void 0?void 0:n.markType)==="area"?areaAttrs:strokeAttrs,l=[];let u=null;return r.forEach((d,f)=>{u&&o.every(g=>isSegmentAttrEqual(u[g],d[g],g))||(l.length&&(l[l.length-1].endIndex=f),u=d,l.push({attrs:u,startIndex:f}))}),l.length>=2?l.map(d=>{const f=parseCollectionMarkAttributes(d.attrs);return f.points=e.slice(d.startIndex,isNil(d.endIndex)?e.length:d.endIndex),f}):null}function getConnectLineSegmentConfigs(r,e,i){if(!r||r.length<=1)return null;const n=!!i&&i.mark.getSpec().enableSegments;let o,l,u=[],d=null;if(r.forEach((f,g)=>{d=e[g],d&&d.defined!==!1?(o||(l={items:[],points:[]},u.push(l)),l.points.push(d),l.items.push(f),o===!1&&(l.isConnect=!0,l={items:[],points:[]},u.push(l)),o=!0):o=!1}),u=u.filter(f=>f.points.length>0),u.length>=2){const f=[];return u.forEach(g=>{if(g.isConnect)return void f.push({points:g.points,isConnect:!0});if(n){const y=getLineSegmentConfigs(g.items,g.points,i);if(y)return void y.forEach(b=>{f.push(b)})}const _=parseCollectionMarkAttributes(g.items[0]);_.points=g.points,f.push(_)}),f}return n?getLineSegmentConfigs(r,e,i):null}function getLinePointsFromSegments(r){return r?r.reduce((e,i)=>e.concat(i.points),[]):null}function parseCollectionMarkAttributes(r){const e={};if(!r)return e;const i=["x","y","x1","y1","defined","size","width","height","context"];return Object.keys(r).forEach(n=>{i.includes(n)||(e[n]=r[n])}),e}function removeSegmentAttrs(r,e){var i;if(!r||!r.segments||!r.segments.length)return r;const n=((i=e==null?void 0:e.mark)===null||i===void 0?void 0:i.markType)==="area"?["fillOpacity","strokeOpacity"]:["strokeOpacity"],o={};return Object.keys(r).forEach(l=>{n.includes(l)||(o[l]=r[l])}),o}let Element$1=class{constructor(e){this.data=null,this.states=[],this.diffState=DiffState.enter,this.isReserved=!1,this.runtimeStatesEncoder=null,this.items=[],this.getStateAttrs=(i,n)=>{var o,l,u,d;const f=!isNil((o=this.runtimeStatesEncoder)===null||o===void 0?void 0:o[i]),g=f?Object.assign(Object.assign({},(l=this.mark.getSpec().encode)===null||l===void 0?void 0:l[i]),this.runtimeStatesEncoder[i]):(u=this.mark.getSpec().encode)===null||u===void 0?void 0:u[i];if(!g)return{};if(isFunction(g))return g(this.getDatum(),this,i,n);if(!f&&(!((d=this.graphicItem.states)===null||d===void 0)&&d[i]))return this.graphicItem.states[i];const _=this.items.map(b=>Object.assign({},b,{nextAttrs:{}}));invokeEncoderToItems(this,_,g,this.mark.parameters());const y=this.transformElementItems(_,this.mark.markType);return this.graphicItem.states?this.graphicItem.states[i]||(this.graphicItem.states[i]=y):this.graphicItem.states={[i]:y},y},this.mark=e}initGraphicItem(e={}){if(this.graphicItem)return;const i=this.mark.getAttributeTransforms();if(this.graphicItem=this.mark.addGraphicItem(i?transformAttributes(i,e,this):e,this.groupKey),!this.graphicItem)return;const{graphicName:n}=this.mark.getSpec();isString(n)?this.graphicItem.name=n:isFunction(n)&&(this.graphicItem.name=n(this)),this.graphicItem[BridgeElementKey]=this,i&&(this.graphicItem.onBeforeAttributeUpdate=o=>this.mark?transformAttributes(i,o,this):o),this.clearGraphicAttributes(),this.mark.needAnimate()&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(Object.assign({},e)),this.setFinalGraphicAttributes(Object.assign({},e)))}updateGraphicItem(){var e;if(!this.graphicItem)return;this.diffState===DiffState.exit?this.graphicItem.releaseStatus="willRelease":this.graphicItem.releaseStatus=void 0;const i=(e=this.mark.animate)===null||e===void 0?void 0:e.getAnimationConfigs("state");i&&i.length!==0&&(this.graphicItem.stateAnimateConfig=i[0].originConfig)}getGraphicItem(){return this.graphicItem}removeGraphicItem(){var e,i;this.graphicItem&&((i=(e=this.graphicItem.animates)===null||e===void 0?void 0:e.forEach)===null||i===void 0||i.call(e,n=>n.stop())),this.graphicItem&&(removeGraphicItem(this.graphicItem),this.graphicItem[BridgeElementKey]=null,this.graphicItem=null)}resetGraphicItem(){this.graphicItem&&(this.graphicItem=null)}getBounds(){var e;return(e=this.graphicItem)===null||e===void 0?void 0:e.AABBBounds}getStates(){return this.states}updateData(e,i,n){var o;this.mark.emit(HOOK_EVENT.BEFORE_ELEMENT_UPDATE_DATA,{groupKey:e,data:i,key:n},this),this.data=i;const l=parseField(n);return this.items=i.map(u=>({datum:u,key:l(u),view:this.mark.view,nextAttrs:{}})),this.groupKey=e,this.key=this.mark.isCollectionMark()?e:(o=this.items)===null||o===void 0?void 0:o[0].key,this.mark.emit(HOOK_EVENT.AFTER_ELEMENT_UPDATE_DATA,{groupKey:e,data:i,key:n},this),this.items}state(e,i){var n;const o=this.mark.isCollectionMark(),l=this.states,u=array(invokeFunctionType(e,i,this.getDatum(),this)),d=(n=this.mark.getSpec())===null||n===void 0?void 0:n.stateSort;d&&u.length&&u.sort(d);const f=u.length!==l.length||u.some((g,_)=>g!==l[_]);this.states=u,!o&&f&&this.diffState===DiffState.unChange&&(this.diffState=DiffState.update)}encodeGraphic(e){this.coordinateTransformEncode(this.items);const i=this.transformElementItems(this.items,this.mark.markType);e&&Object.assign(i,e),this.graphicItem?(this.graphicItem.clearStates(),this.graphicItem.states={},this.graphicItem.stateProxy=null,MARK_OVERLAP_HIDE_KEY in this.graphicItem.attribute&&"visible"in i&&delete this.graphicItem.attribute[MARK_OVERLAP_HIDE_KEY],this.applyGraphicAttributes(i)):this.initGraphicItem(i),this.diffState!==DiffState.enter&&this.diffState!==DiffState.update||!this.states.length||this.useStates(this.states),this.mark.markType===GrammarMarkType.shape&&(this.graphicItem.datum=this.items[0].datum),this.items.forEach(n=>{n.nextAttrs={}}),this._setCustomizedShape()}_setCustomizedShape(){var e;if(!this.graphicItem)return;const i=(e=this.mark.getSpec())===null||e===void 0?void 0:e.setCustomizedShape;i&&(this.graphicItem.pathProxy=n=>i(this.data,n,new CustomPath2D))}encodeItems(e,i,n=!1,o){const l=this.mark.isCollectionMark(),u=i[BuiltInEncodeNames.update],d=i[BuiltInEncodeNames.enter],f=i[BuiltInEncodeNames.exit],g=this.mark.isLargeMode()||l&&!this.mark.getSpec().enableSegments;this.diffState===DiffState.enter?(d&&invokeEncoderToItems(this,e,d,o,g),u&&invokeEncoderToItems(this,e,u,o,g)):this.diffState===DiffState.update?((l&&d||n)&&invokeEncoderToItems(this,e,d,o,g),u&&invokeEncoderToItems(this,e,u,o,g)):this.diffState===DiffState.exit&&f&&(n&&invokeEncoderToItems(this,e,d,o,g),invokeEncoderToItems(this,e,f,o,g))}coordinateTransformEncode(e){if(!this.mark.coord||this.mark.markType==="arc"||this.mark.disableCoordinateTransform===!0)return;const i=this.mark.coord.output();e.forEach(n=>{const o=n.nextAttrs,l=i.convert(o);Object.assign(o,l)})}hasStateAnimation(){var e;const i=(e=this.mark.animate)===null||e===void 0?void 0:e.getAnimationConfigs("state");return i&&i.length>0}clearStates(e){const i=isBoolean(e)?e:this.hasStateAnimation();this.states=[],this.graphicItem&&this.graphicItem.clearStates(i),this.runtimeStatesEncoder&&(this.runtimeStatesEncoder={})}_updateRuntimeStates(e,i){this.runtimeStatesEncoder||(this.runtimeStatesEncoder={}),this.runtimeStatesEncoder[e]=i}hasState(e){return this.states&&e&&this.states.includes(e)}updateStates(e){if(!this.graphicItem)return!1;let i=this.states.slice();const n=this.mark.getSpec().encode;let o=!1,l=!1;return Object.keys(e).forEach(u=>{var d;if(!u)return;const f=e[u];if(isObject$1(f)&&!isEqual(f,(d=this.runtimeStatesEncoder)===null||d===void 0?void 0:d[u]))i.includes(u)?o=!0:i.push(u),this._updateRuntimeStates(u,f),l=!0;else if(f)!i.includes(u)&&(n!=null&&n[u])&&(i.push(u),l=!0);else if(i.length){const g=i.filter(_=>_!==u);g.length!==i.length&&(l=!0,i=g),this.runtimeStatesEncoder&&this.runtimeStatesEncoder[u]&&(this.runtimeStatesEncoder[u]=null)}}),o&&this.graphicItem.clearStates(),!!l&&(this.useStates(i),!0)}addState(e,i){var n;if(!this.graphicItem)return!1;if(i&&isString(e)&&!isEqual(i,(n=this.runtimeStatesEncoder)===null||n===void 0?void 0:n[e])){const u=this.states.slice();return u.includes(e)?this.graphicItem.clearStates():u.push(e),this._updateRuntimeStates(e,i),this.useStates(u),!0}const o=this.mark.getSpec().encode,l=array(e).reduce((u,d)=>(d&&!u.includes(d)&&(o!=null&&o[d])&&u.push(d),u),this.states.slice());return l.length!==this.states.length&&(this.useStates(l),!0)}removeState(e){if(!this.graphicItem)return!1;const i=array(e);if(!i.length)return!1;const n=this.states.filter(o=>!i.includes(o));return n.length!==this.states.length&&(this.runtimeStatesEncoder&&i.forEach(o=>{this.runtimeStatesEncoder[o]=null}),this.useStates(n),!0)}useStates(e,i){var n;if(!this.graphicItem)return!1;this.mark.emit(HOOK_EVENT.BEFORE_ELEMENT_STATE,{states:e},this);const o=(n=this.mark.getSpec())===null||n===void 0?void 0:n.stateSort;o&&e.sort(o),this.states=e;const l=isBoolean(i)?i:this.hasStateAnimation();return this.graphicItem.stateProxy=this.getStateAttrs,this.graphicItem.useStates(this.states,l),this.mark.emit(HOOK_EVENT.AFTER_ELEMENT_STATE,{states:e},this),!0}diffAttributes(e){const i={},n=this.getFinalGraphicAttributes();for(const o in e)has(n,o)&&isEqual(n[o],e[o])||(i[o]=e[o]);return i}transformElementItems(e,i,n){var o,l,u,d,f;const g=e[0];if(!g.nextAttrs||Object.keys(g.nextAttrs).length===0)return{};let _=g.nextAttrs;if(isPointsMarkType(i)&&e&&e.length&&isNil((o=g.nextAttrs)===null||o===void 0?void 0:o.points)&&(n===!0||isValidPointsChannel(Object.keys(g.nextAttrs),this.mark.markType))){const y=this.mark.getSpec(),b=this.getGraphicAttribute("points",!1),S=this.getGraphicAttribute("segments",!1),v=y.enableSegments,A=(l=this.mark.getSpec().encode)===null||l===void 0?void 0:l[BuiltInEncodeNames.connectNulls],x=e.map(C=>C.nextAttrs),T=this.mark.isProgressive();if(_=parseCollectionMarkAttributes(_),i===GrammarMarkType.line||i===GrammarMarkType.area){const C=getLinePoints(e,!0,b,i===GrammarMarkType.area);if(T)_.segments=((f=(d=(u=this.graphicItem)===null||u===void 0?void 0:u.attribute)===null||d===void 0?void 0:d.segments)!==null&&f!==void 0?f:[]).concat([{points:C}]);else if(A){if(_.segments=getConnectLineSegmentConfigs(x,C,this),_.segments&&_.segments.some(E=>E.isConnect)){const E=invokeEncoder(A,this.getDatum(),this,this.mark.parameters());E&&_.segments.forEach(P=>{P.isConnect&&Object.assign(P,E)})}_.points=C}else if(v){const E=C&&C.length!==0?C:getLinePointsFromSegments(S),P=getLineSegmentConfigs(x,E,this);P?(_.segments=P,_.points=null):(_.segments=null,_.points=E),_=removeSegmentAttrs(_,this)}else _.points=C,_.segments=null}else i===GrammarMarkType.largeRects?_.points=getLargeRectsPoints(e,!0,b):i===GrammarMarkType.largeSymbols&&(_.points=getLargeSymbolsPoints(e,!0,b))}return _}applyGraphicAttributes(e){var i,n,o;if(!isEmpty(e))if(this.mark.needAnimate()){const l=this.diffAttributes(e),u=(i=this.getPrevGraphicAttributes())!==null&&i!==void 0?i:{},d=(n=this.getFinalGraphicAttributes())!==null&&n!==void 0?n:{};Object.keys(l).forEach(y=>{u[y]=this.getGraphicAttribute(y),d[y]=l[y]}),this.setNextGraphicAttributes(l),this.setPrevGraphicAttributes(u),this.setFinalGraphicAttributes(d);const f=(o=this.mark.animate)===null||o===void 0?void 0:o.getElementAnimators(this).filter(y=>{var b;return!(!((b=y.animationOptions.timeline.controlOptions)===null||b===void 0)&&b.ignoreLoopFinalAttributes)||!y.animationOptions.timeline.loop}),g=(f||[]).reduce((y,b)=>Object.assign(y,b.getEndAttributes()),{}),_=Object.assign({},g,d);this.graphicItem.setAttributes(_)}else this.graphicItem.setAttributes(e)}getGraphicAttribute(e,i=!1){var n;if(!this.graphicItem)return;if(i){let u;const d=this.getPrevGraphicAttributes();if(!isNil(u=get(d,e)))return u}const o=this.mark.getAttributeTransforms();let l=[e];if(o&&o.length){const u=o.find(d=>d.storedAttrs&&d.channels.includes(e));u&&(l=[u.storedAttrs,e])}return get((n=this.graphicItem)===null||n===void 0?void 0:n.attribute,l)}setGraphicAttribute(e,i,n=!0){if(!this.graphicItem)return;const o=this.getFinalGraphicAttributes(),l=this.getPrevGraphicAttributes();n&&o&&(o[e]=i),l&&!has(l,e)&&(l[e]=this.graphicItem.attribute[e]),this.graphicItem.setAttribute(e,i)}setGraphicAttributes(e,i=!0){if(!this.graphicItem)return;const n=this.getFinalGraphicAttributes(),o=this.getPrevGraphicAttributes();Object.keys(e).forEach(l=>{n&&i&&(n[l]=e[l]),o&&!has(o,l)&&(o[l]=this.graphicItem.attribute[l])}),this.graphicItem.setAttributes(e)}getFinalGraphicAttributes(){return this.graphicItem.finalAttrs}setFinalGraphicAttributes(e){this.graphicItem.finalAttrs=e}getPrevGraphicAttributes(){return this.graphicItem.prevAttrs}setPrevGraphicAttributes(e){this.graphicItem.prevAttrs=e}getNextGraphicAttributes(){return this.graphicItem.nextAttrs}getFinalAnimationAttribute(e){var i,n;return(n=(i=this.getFinalGraphicAttributes())===null||i===void 0?void 0:i[e])!==null&&n!==void 0?n:this.getGraphicAttribute(e)}getFinalAnimationAttributes(){var e;return(e=this.getFinalGraphicAttributes())!==null&&e!==void 0?e:this.graphicItem.attribute}setNextGraphicAttributes(e){this.graphicItem.nextAttrs=e}clearChangedGraphicAttributes(){this.graphicItem&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null))}clearGraphicAttributes(){this.graphicItem&&(this.graphicItem.prevAttrs&&this.setPrevGraphicAttributes(null),this.graphicItem.nextAttrs&&this.setNextGraphicAttributes(null),this.graphicItem.finalAttrs&&this.setFinalGraphicAttributes(null))}remove(){this.graphicItem&&(removeGraphicItem(this.graphicItem),this.graphicItem=null)}release(){this.removeGraphicItem(),this.mark=null,this.data=null,this.items=null}getItemAttribute(e){var i,n;if(!((i=this.items)===null||i===void 0)&&i.length)return this.mark.isCollectionMark()?isNil(e)?this.items.map(o=>o.nextAttrs):this.items.map(o=>{var l;return(l=o.nextAttrs)===null||l===void 0?void 0:l[e]}):isNil(e)?this.items[0].nextAttrs:(n=this.items[0].nextAttrs)===null||n===void 0?void 0:n[e]}setItemAttributes(e){var i;!((i=this.items)===null||i===void 0)&&i.length&&(this.mark.isCollectionMark()?isArray(e)&&this.items.forEach((n,o)=>{Object.assign(n.nextAttrs,e[o])}):Object.assign(this.items[0].nextAttrs,e))}getItem(){var e,i;return this.mark&&this.mark.isCollectionMark()?(e=this.items)!==null&&e!==void 0?e:[]:(i=this.items)===null||i===void 0?void 0:i[0]}getDatum(){var e,i;return this.mark&&this.mark.isCollectionMark()?(e=this.data)!==null&&e!==void 0?e:[]:(i=this.data)===null||i===void 0?void 0:i[0]}};class BaseInteraction{constructor(e,i){this.references=new Map,this.view=e,this.depend(i==null?void 0:i.dependency)}getStartState(){return null}depend(e){this.references.clear(),array(e).map(i=>isString(i)?this.view.getGrammarById(i):i).filter(i=>!isNil(i)).forEach(i=>{var n;this.references.set(i,((n=this.references.get(i))!==null&&n!==void 0?n:0)+1)})}parameters(){const e={};return this.references.forEach((i,n)=>{isValid(n.id())&&(e[n.id()]=n.output())}),e}bind(){const e=this.getEvents();(e??[]).forEach(i=>{i.type&&i.handler&&(isArray(i.type)?i.type.forEach(n=>{n&&n!=="none"&&this.view.addEventListener(n,i.handler)}):i.type!=="none"&&this.view.addEventListener(i.type,i.handler))})}unbind(){const e=this.getEvents();(e??[]).forEach(i=>{i.type&&i.handler&&(isArray(i.type)?i.type.forEach(n=>{n&&n!=="none"&&this.view.removeEventListener(n,i.handler)}):i.type!=="none"&&this.view.removeEventListener(i.type,i.handler))})}start(e){}reset(e){}dispatchEvent(e,i){this.view.emit(`${this.type}:${e}`,i),e==="start"&&this.options.onStart?this.options.onStart(i):e==="reset"&&this.options.onReset?this.options.onReset(i):e==="update"&&this.options.onUpdate?this.options.onUpdate(i):e==="end"&&this.options.onEnd&&this.options.onEnd(i)}}class ElementActive extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementActive.type,this.handleStart=n=>{this.start(n.element)},this.handleReset=n=>{this.reset(n.element)},this.options=Object.assign({},ElementActive.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector)}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}getStartState(){return this.options.state}start(e){e&&this._marks&&this._marks.includes(e.mark)&&(e.addState(this.options.state),this._prevActiveElement=e)}reset(e){const i=e??this._prevActiveElement;i&&this._marks&&this._marks.includes(i.mark)&&i.removeState(this.options.state)}}ElementActive.type="element-active",ElementActive.defaultOptions={state:InteractionStateEnum.active,trigger:"pointerover",triggerOff:"pointerout"};const generateFilterValue=r=>r.filterField?e=>{var i;return(i=e.getDatum())===null||i===void 0?void 0:i[r.filterField]}:e=>e[r.filterType],groupMarksByState=(r,e)=>{if(!e||!r)return null;const i={};return r.forEach(n=>{const o=n&&n.getSpec(),l=o&&o.encode;l&&e.forEach(u=>{u&&l[u]&&(i[u]||(i[u]=[]),i[u].push(n))})}),i},parseTriggerOffOfSelect=r=>{const e=array(r),i=[],n=[];return e.forEach(o=>{o==="empty"?i.push("view"):isString(o)&&o!=="none"?o.includes("view:")?(n.push(o.replace("view:","")),i.push("view")):(n.push(o),i.push("self")):isNumber(o)&&i.push("timeout")}),{eventNames:n,resetType:i}};class ElementSelect extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementSelect.type,this._resetType=[],this.resetAll=()=>{const{state:n,reverseState:o}=this.options;this._statedElements&&this._statedElements.length&&(this.clearAllStates(n,o),this.dispatchEvent("reset",{elements:this._statedElements,options:this.options}),this._statedElements=[])},this.handleStart=n=>{this.start(n.element)},this.handleReset=n=>{if(!this._statedElements||!this._statedElements.length)return;const o=n.element,l=o&&this._marks&&this._marks.includes(o.mark);(this._resetType.includes("view")&&!l||this._resetType.includes("self")&&l)&&this.resetAll()},this.options=Object.assign({},ElementSelect.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector),this._stateMarks=groupMarksByState(this._marks,[this.options.state,this.options.reverseState])}getStartState(){return this.options.state}getEvents(){const e=this.options.triggerOff,i=this.options.trigger,n=[{type:i,handler:this.handleStart}],{eventNames:o,resetType:l}=parseTriggerOffOfSelect(e);return o.forEach(u=>{u&&(isArray(i)?!i.includes(u):u!==i)&&n.push({type:u,handler:this.handleReset})}),this._resetType=l,n}start(e){const{state:i,reverseState:n,isMultiple:o}=this.options;if(e&&this._marks&&this._marks.includes(e.mark))if(e.hasState(i)){if(this._resetType.includes("self")){const l=this._statedElements&&this._statedElements.filter(u=>u!==e);l&&l.length?this._statedElements=this.updateStates(l,this._statedElements,i,n):this.resetAll()}}else this._timer&&clearTimeout(this._timer),e.addState(i),this._statedElements=this.updateStates(o&&this._statedElements?[...this._statedElements,e]:[e],this._statedElements,i,n),this.dispatchEvent("start",{elements:this._statedElements,options:this.options}),this._resetType.includes("timeout")&&(this._timer=setTimeout(()=>{this.resetAll()},this.options.triggerOff));else this._resetType.includes("view")&&this._statedElements&&this._statedElements.length&&this.resetAll()}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.state,this.options.reverseState]):this.resetAll()}}ElementSelect.type="element-select",ElementSelect.defaultOptions={state:InteractionStateEnum.selected,trigger:"click"};class ElementHighlight extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementHighlight.type,this.handleStart=n=>{this.start(n.element)},this.handleReset=n=>{if(!this._statedElements||!this._statedElements.length)return;const o=n.element;if(o){const l=this._marks&&this._marks.includes(o.mark);this._resetType!=="view"||l?this._resetType==="self"&&l&&this.resetAll():this.resetAll()}},this.options=Object.assign({},ElementHighlight.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector),this._stateMarks=groupMarksByState(this._marks,[this.options.highlightState,this.options.blurState])}getStartState(){return this.options.highlightState}getEvents(){const e=this.options.triggerOff,i=[{type:this.options.trigger,handler:this.handleStart}];let n=e;return isString(e)&&e.includes("view:")?(n=e.replace("view:",""),this._resetType="view"):this._resetType="self",i.push({type:n,handler:this.handleReset}),i}resetAll(){const{highlightState:e,blurState:i}=this.options;this._lastElement&&(this.clearAllStates(e,i),this.dispatchEvent("reset",{elements:[this._lastElement],options:this.options}),this._lastElement=null,this._statedElements=null)}start(e){if(e&&this._marks&&this._marks.includes(e.mark)){const{highlightState:i,blurState:n}=this.options;if(this._lastElement===e)return;this._statedElements=this.updateStates([e],this._statedElements,i,n),this._lastElement=e,this.dispatchEvent("start",{elements:[e],options:this.options})}else this._lastElement&&this._resetType==="view"&&this.resetAll()}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}ElementHighlight.type="element-highlight",ElementHighlight.defaultOptions={highlightState:InteractionStateEnum.highlight,blurState:InteractionStateEnum.blur,trigger:"pointerover",triggerOff:"pointerout"};class ElementHighlightByKey extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementHighlightByKey.type,this.handleStart=n=>{this.start(n.element)},this.handleReset=n=>{n.element&&this._marks&&this._marks.includes(n.element.mark)&&this.resetAll()},this.options=Object.assign({},ElementHighlightByKey.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}resetAll(){const e=[this.options.highlightState,this.options.blurState];this._marks.forEach(i=>{i.elements.forEach(n=>{n.removeState(e)})})}start(e){if(e&&this._marks&&this._marks.includes(e.mark)){const i=e.key;if(isNil(i))return;this._marks.forEach(n=>{n.elements.forEach(o=>{o.key===i?o.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):o.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}ElementHighlightByKey.type="element-highlight-by-key",ElementHighlightByKey.defaultOptions={highlightState:InteractionStateEnum.highlight,blurState:InteractionStateEnum.blur,trigger:"pointerover",triggerOff:"pointerout"};class ElementHighlightByGroup extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementHighlightByGroup.type,this.handleStart=n=>{this.start(n.element)},this.handleReset=n=>{const o=n.element;o&&this._marks&&this._marks.includes(o.mark)&&this.resetAll()},this.options=Object.assign({},ElementHighlightByGroup.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}resetAll(){const e=[this.options.highlightState,this.options.blurState];this._marks.forEach(i=>{i.elements.forEach(n=>{n.removeState(e)})})}start(e){if(e&&this._marks&&this._marks.includes(e.mark)){const i=e.groupKey;if(isNil(i))return;this._marks.forEach(n=>{n.elements.forEach(o=>{o.groupKey===i?o.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):o.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}ElementHighlightByGroup.type="element-highlight-by-group",ElementHighlightByGroup.defaultOptions={highlightState:InteractionStateEnum.highlight,blurState:InteractionStateEnum.blur,trigger:"pointerover",triggerOff:"pointerout"};class ElementActiveByLegend extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementActiveByLegend.type,this.handleStart=n=>{var o,l;this.start((l=(o=n.detail)===null||o===void 0?void 0:o.data)===null||l===void 0?void 0:l.id)},this.handleReset=n=>{this.resetAll()},this.options=Object.assign({},ElementActiveByLegend.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector)}getEvents(){return[{type:LegendEvent.legendItemHover,handler:this.handleStart},{type:LegendEvent.legendItemUnHover,handler:this.handleReset}]}getStartState(){return this.options.state}start(e){const i=e;if(isNil(i))return;const n=generateFilterValue(this.options);this._marks.forEach(o=>{o.elements.forEach(l=>{n(l)===i?l.addState(this.options.state):l.removeState(this.options.state)})})}resetAll(){this._marks.forEach(e=>{e.elements.forEach(i=>{i.removeState(this.options.state)})})}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState(this.options.state):this.resetAll()}}ElementActiveByLegend.type="element-active-by-legend",ElementActiveByLegend.defaultOptions={state:InteractionStateEnum.active,filterType:"groupKey"};class ElementHighlightByLegend extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementHighlightByLegend.type,this.handleStart=(n,o)=>{var l,u;this.start((u=(l=n.detail)===null||l===void 0?void 0:l.data)===null||u===void 0?void 0:u.id)},this.handleReset=n=>{this.resetAll()},this.options=Object.assign({},ElementHighlightByLegend.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:LegendEvent.legendItemHover,handler:this.handleStart},{type:LegendEvent.legendItemUnHover,handler:this.handleReset}]}start(e){if(isNil(e))return;const i=generateFilterValue(this.options);this._marks.forEach(n=>{n.elements.forEach(o=>{i(o)===e?o.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):o.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}resetAll(){const e=[this.options.highlightState,this.options.blurState];this._marks.forEach(i=>{i.elements.forEach(n=>{n.removeState(e)})})}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}ElementHighlightByLegend.type="element-highlight-by-legend",ElementHighlightByLegend.defaultOptions={highlightState:InteractionStateEnum.highlight,blurState:InteractionStateEnum.blur,filterType:"groupKey"};class ElementHighlightByName extends BaseInteraction{constructor(e,i){super(e,i),this.type=ElementHighlightByName.type,this.handleStart=(n,o)=>{if(this.options.shouldStart?this.options.shouldStart(n):this._filterByName(n)){const l=this._parseTargetKey(n,o);this.start(l)}},this.handleReset=n=>{(this.options.shouldReset?this.options.shouldReset(n):this._filterByName(n))&&this.resetAll()},this.options=Object.assign({},ElementHighlightByName.defaultOptions,i),this._marks=e.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}_filterByName(e){var i;const n=array(this.options.graphicName);return((i=e==null?void 0:e.target)===null||i===void 0?void 0:i.name)&&n.includes(e.target.name)}_parseTargetKey(e,i){return this.options.parseData?this.options.parseData(e):e.target.type==="text"?e.target.attribute.text:null}start(e){if(isNil(e))return;const i=generateFilterValue(this.options);this._marks.forEach(n=>{n.elements.forEach(o=>{i(o)===e?o.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):o.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}resetAll(){const e=[this.options.blurState,this.options.highlightState];this._marks.forEach(i=>{i.elements.forEach(n=>{n.removeState(e)})})}reset(e){e?this._marks&&this._marks.includes(e.mark)&&e.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}ElementHighlightByName.type="element-highlight-by-name",ElementHighlightByName.defaultOptions={trigger:"pointerover",triggerOff:"pointerout",highlightState:InteractionStateEnum.highlight,blurState:InteractionStateEnum.blur,filterType:"groupKey"};function getBandWidthOfScale(r){if(r)return r.type===ScaleEnum.Band?r.bandwidth():r.type===ScaleEnum.Point?r.step():void 0}class ToggleStateMixin{updateStates(e,i,n,o){return e&&e.length?(n&&o?i&&i.length?(this.toggleReverseStateOfElements(e,i,o),this.toggleStateOfElements(e,i,n)):this.addBothStateOfElements(e,n,o):n&&(i&&i.length?this.toggleStateOfElements(e,i,n):this.addStateOfElements(e,n)),e):null}toggleReverseStateOfElements(e,i,n){i.forEach(o=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(o.mark)&&o.addState(n)}),e.forEach(o=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(o.mark)&&o.removeState(n)})}toggleStateOfElements(e,i,n){i.forEach(o=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(o.mark)&&o.removeState(n)}),e.forEach(o=>{n&&this._stateMarks[n]&&this._stateMarks[n].includes(o.mark)&&o.addState(n)})}addBothStateOfElements(e,i,n){this._marks.forEach(o=>{var l;const u=n&&this._stateMarks[n]&&this._stateMarks[n].includes(o),d=i&&this._stateMarks[i]&&this._stateMarks[i].includes(o);(u||d)&&((l=o.elements)===null||l===void 0||l.forEach(f=>{e&&e.includes(f)?d&&f.addState(i):u&&f.addState(n)}))})}addStateOfElements(e,i){this._marks.forEach(n=>{var o;const l=i&&this._stateMarks[i]&&this._stateMarks[i].includes(n);l&&((o=n.elements)===null||o===void 0||o.forEach(u=>{e&&e.includes(u)&&l&&u.addState(i)}))})}clearAllStates(e,i){this._statedElements&&this._statedElements.length&&this._marks.forEach(n=>{n&&n.elements&&(i&&this._stateMarks[i]&&this._stateMarks[i].includes(n)&&n.elements.forEach(o=>{o.removeState(i)}),e&&this._stateMarks[e]&&this._stateMarks[e].includes(n)&&n.elements.forEach(o=>{this._statedElements.includes(o)&&o.removeState(e)}))})}}const registerElementActive=()=>{Factory.registerInteraction(ElementActive.type,ElementActive)},registerElementSelect=()=>{mixin(ElementSelect,ToggleStateMixin),Factory.registerInteraction(ElementSelect.type,ElementSelect)},registerElementHighlight=()=>{mixin(ElementHighlight,ToggleStateMixin),Factory.registerInteraction(ElementHighlight.type,ElementHighlight)},registerElementHighlightByKey=()=>{Factory.registerInteraction(ElementHighlightByKey.type,ElementHighlightByKey)},registerElementHighlightByGroup=()=>{Factory.registerInteraction(ElementHighlightByGroup.type,ElementHighlightByGroup)},registerElementActiveByLegend=()=>{Factory.registerInteraction(ElementActiveByLegend.type,ElementActiveByLegend)},registerElementHighlightByLegend=()=>{Factory.registerInteraction(ElementHighlightByLegend.type,ElementHighlightByLegend)},registerElementHighlightByName=()=>{Factory.registerInteraction(ElementHighlightByName.type,ElementHighlightByName)},parseOptionValue=(r,e)=>isGrammar(r)?r.output():r&&isObject$1(r)?isFunction(r.callback)?i=>r.callback(i,e):isFunction(r.value)?r.value(e):r:r,parseOptions=(r,e)=>r&&(isObject$1(r)?Object.keys(r).reduce((i,n)=>{const o=r[n];return i[n]=parseOptionValue(o,e),i},{}):r.map(i=>parseOptionValue(i,e)));let grammarBaseId=-1;class GrammarBase extends EventEmitter{constructor(e){super(),this.spec={},this.references=new Map,this.targets=[],this.transforms=[],this.view=e,this.uid=++grammarBaseId}parse(e){return this.id(e.id),this.name(e.name),this.depend(e.dependency),this}depend(e){var i;if(!((i=this.spec)===null||i===void 0)&&i.dependency){const o=array(this.spec.dependency).map(l=>isString(l)?this.view.getGrammarById(l):l);this.detach(o)}this.spec.dependency=e;const n=array(e).map(o=>isString(o)?this.view.getGrammarById(o):o);return this.attach(n),this.commit(),this}addEventListener(e,i,n){let o=i;return n&&n.trap===!1||(o=i,o.raw=i),n&&n.target&&(o.target=n.target),this.on(e,o),this}removeEventListener(e,i){return i?this.off(e,i):this.off(e),this}emit(e,...i){var n,o;return(o=(n=this.view)===null||n===void 0?void 0:n.emit)===null||o===void 0||o.call(n,e,...i),super.emit(e,...i)}emitGrammarEvent(e,...i){return super.emit(e,...i)}evaluateTransform(e,i,n){if(!e||!e.length)return i;let o=i,l=0;const u=e.length;for(;l<u;){const d=e[l];this.emit(HOOK_EVENT.BEFORE_TRANSFORM,d.type),o=d.transform(d.isRawOptions?d.options:parseOptions(d.options,n),o,n,this.view),l++,this.emit(HOOK_EVENT.AFTER_TRANSFORM,d.type)}return o}set(e){return!1}id(e){return arguments.length?(this.view.grammars.unrecord(this),this._id=e,this.view.grammars.record(this),this):this._id}name(e){return arguments.length?(this._name=e,this):this._name}attach(e,i=1){return array(e).filter(n=>!isNil(n)).forEach(n=>{var o;isNil(e)||(n.targets.includes(this)||n.targets.push(this),this.references.set(n,((o=this.references.get(n))!==null&&o!==void 0?o:0)+i))}),this}detach(e,i=1){return array(e).filter(n=>!isNil(n)).forEach(n=>{const o=this.references.get(n)-i;o>0?this.references.set(n,o-1):(this.references.delete(n),n.targets.includes(this)&&(n.targets=n.targets.filter(l=>l!==this)))}),this}detachAll(){this.references.forEach((e,i)=>{this.detach(i,e)})}link(e){this.grammarSource=e}run(){var e;const i=(e=this.grammarSource)===null||e===void 0?void 0:e.output(),n=this.parameters();return this.evaluate(i,n)}commit(){this.view.commit(this)}parameters(){const e={};return this.references.forEach((i,n)=>{isValid(n.id())&&(e[n.id()]=n.output())}),e}getSpec(){return this.spec}reuse(e){return this}clear(){this.spec=null,this.view=null}release(){this.clear()}setFunctionSpec(e,i){return isNil(this.spec[i])||this.detach(parseFunctionType(this.spec[i],this.view)),this.spec[i]=e,this.attach(parseFunctionType(e,this.view)),this.commit(),this}}const parseSimpleOptionValue=(r,e,i)=>{var n;if(r==="callback"&&isFunction(e))return{references:[],value:{callback:e,dependency:[]}};if(!isNil(e.data)){const o=i.getDataById(e.data);return{references:[o],value:o}}if(!isNil(e.customized)){const o=i.getCustomizedById(e.customized);return{references:[o],value:o}}if(!isNil(e.scale)){const o=i.getScaleById(e.scale);return{references:[o],value:o}}if(isSignal(e)){const o=parseFunctionType(e,i);return{references:o,value:e.callback?{value:e.callback,dependency:o}:(n=o==null?void 0:o[0])!==null&&n!==void 0?n:e}}return{value:e}},parseTransformOption=(r,e,i)=>{if(isNil(e))return{value:e};if(isArray(e)){const n=e.map(o=>parseSimpleOptionValue(r,o,i));return{references:n.reduce((o,l)=>(l.references&&o.concat(l.references),o),[]),value:n.map(o=>o.value)}}return parseSimpleOptionValue(r,e,i)},parseTransform=(r,e)=>{const i=Factory.getTransform(r.type);if(!i)return;const n={};let o=[];return Object.keys(r).forEach(l=>{var u;if(l==="type")return;const d=r[l];if(l==="dependency")return void((d==null?void 0:d.length)&&(o=o.concat(parseReference(d,e))));const f=parseTransformOption(l,d,e);f&&(!((u=f.references)===null||u===void 0)&&u.length&&(o=o.concat(f.references)),n[l]=f.value)}),{markPhase:i.markPhase,transform:i.transform,canProgressive:i.canProgressive,type:i.type,options:n,references:o}},parseTransformSpec=(r,e)=>{if(r!=null&&r.length){const i=[];let n=[];return r.forEach(o=>{var l;const u=parseTransform(o,e);u&&(!((l=u.references)===null||l===void 0)&&l.length&&(n=n.concat(u.references)),i.push(u))}),{transforms:i,refs:n}}return null},jsonParser=(r,e={},i)=>{if(!isString(r))return array(r);try{return array(JSON.parse(r))}catch{return[]}},parsers={csv:csvParser,dsv:dsvParser,tsv:tsvParser,json:jsonParser},parseFormat=(r,e)=>{if(!e||!parsers[e.type])return array(r);const i=e.type==="dsv"?{delimiter:e.delimiter}:{};return parsers[e.type](r,i,new DataView(new DataSet))};class Data extends GrammarBase{constructor(e,i,n){super(e),this.grammarType="data",this.spec={},this._dataIDKey=`VGRAMMAR_DATA_ID_KEY_${this.uid}`,this._loadTasks=[],this._postFilters=[],this.ingest=o=>{const l=invokeParameterFunctionType(o.format,this.parameters());return this._input=parseFormat(o.values,l),this._input},this.load=o=>{if(o.values)return this.ingest(o)},this.relay=o=>o[0],this._loadTasks=[],isNil(i)||this.values(i,n)}parse(e){return super.parse(e),this._isLoaded=!1,this.source(e.source,e.format,!1),this.url(e.url,e.format,!1),this.values(e.values,e.format,!1),this.transform(e.transform),this.parseLoad(e),this.commit(),this}parseDataSource(e){const i=[],n=[],o=e.format?parseFunctionType(e.format,this.view)[0]:null;if(o&&i.push(o),e.values){const l=parseFunctionType(e.values,this.view)[0];l&&i.push(l),n.push({type:"ingest",transform:this.ingest,isRawOptions:!0,options:{values:e.values,format:e.format}})}else if(e.url){const l=parseFunctionType(e.url,this.view)[0];l&&i.push(l),n.push({type:"load",transform:this.load,options:{url:l??e.url,format:o??e.format}})}else if(e.source){const l=[];array(e.source).forEach(u=>{const d=isGrammar(u)?u:this.view.getDataById(u);d&&(i.push(d),l.push(d))}),l.length&&(n.push({type:"relay",transform:this.relay,options:l}),this.grammarSource=l[0])}return{transforms:n,refs:i}}evaluate(e,i){this.view.emit(HOOK_EVENT.BEFORE_EVALUATE_DATA);const n=this._isLoaded?this.transforms:this._loadTasks.concat(this.transforms);this.grammarSource&&(this._input=e);const o=this.evaluateTransform(n,this._input,i),l=this._evaluateFilter(o,i);return this.setValues(l),this._isLoaded=!0,this.view.emit(HOOK_EVENT.AFTER_EVALUATE_DATA),this}output(){return this._values}getDataIDKey(){return this._dataIDKey}values(e,i,n=!0){const o=Object.assign({},this.spec,{values:e,format:i});return isNil(e)||(o.url=void 0,o.source=void 0),n?this.parseLoad(o):this}url(e,i,n=!0){const o=Object.assign({},this.spec,{url:e,format:i});return isNil(e)||(o.values=void 0,o.source=void 0),n?this.parseLoad(o):this}source(e,i,n=!0){const o=Object.assign({},this.spec,{source:e,format:i});return isNil(e)||(o.values=void 0,o.url=void 0),n?this.parseLoad(o):this}parseLoad(e){this.detach(this.parseDataSource(this.spec).refs),this.spec=e;const i=this.parseDataSource(this.spec);return this.attach(i.refs),this._loadTasks=i.transforms,this._isLoaded=!1,this.commit(),this}setValues(e){this._values=array(e).map((i,n)=>{const o=i===Object(i)?i:{data:i};return o[this._dataIDKey]=n,o})}field(e){return this._values.map(i=>i[e])}transform(e){const i=parseTransformSpec(this.spec.transform,this.view);i&&(this.detach(i.refs),this.transforms=[]),this.spec.transform=e;const n=parseTransformSpec(this.spec.transform,this.view);return n&&(this.attach(n.refs),this.transforms=n.transforms),this.commit(),this}getValue(){return this._values}getInput(){return this._input}addDataFilter(e){return this._postFilters=this._postFilters.concat(array(e)),this._postFilters.sort((i,n)=>{var o,l;return((o=i.rank)!==null&&o!==void 0?o:0)-((l=n.rank)!==null&&l!==void 0?l:0)}),this}removeDataFilter(e){const i=array(e);return this._postFilters=this._postFilters.filter(n=>!i.includes(n)),this}_evaluateFilter(e,i){return this._postFilters.reduce((n,o)=>o.filter(n,i),e)}reuse(e){return e.grammarType!==this.grammarType||(this._isLoaded=!1,this._values=e.output()),this}clear(){super.clear(),this._input=null,this._values=null}}function moveToHead(r,e,i,n){let o,l;const u=r[e];for(;e>i&&(l=Math.floor((e-1)/2),o=r[l],u&&o&&n(u,o)<0);)r[e]=o,e=l;return r[e]=u}function moveToTail(r,e,i,n){const o=e,l=r.length,u=r[e];let d,f=2*e+1;for(;f<l;)d=f+1,d<l&&n(r[f],r[d])>=0&&(f=d),r[e]=r[f],f=2*(e=f)+1;return r[e]=u,moveToHead(r,e,o,n)}class Heap{constructor(e){this.compare=e,this.nodes=[]}size(){return this.nodes.length}last(){return this.nodes[0]}validate(){for(let e=this.nodes.length-1;e>0;e-=1){const i=Math.floor((e-1)/2);if(this.compare(this.nodes[i],this.nodes[e])>0)return!1}return!0}push(e){if(this.nodes.includes(e)){const i=this.nodes.indexOf(e);return moveToHead(this.nodes,i,0,this.compare),moveToTail(this.nodes,i,null,this.compare)}return this.nodes.push(e),moveToHead(this.nodes,this.nodes.length-1,0,this.compare)}remove(e){if(this.nodes.includes(e)){const i=this.nodes.indexOf(e);this.nodes=this.nodes.slice(0,i).concat(this.nodes.slice(i+1)),moveToHead(this.nodes,i,0,this.compare),moveToTail(this.nodes,i,null,this.compare)}}pop(){const e=this.nodes.pop();let i;return this.nodes.length?(i=this.nodes[0],this.nodes[0]=e,moveToTail(this.nodes,0,null,this.compare)):i=e,i}clear(){this.nodes=[]}}class UniqueList{constructor(e){this.list=[],this.ids={},this.idFunc=e||identity$1}add(e){const i=this.idFunc(e);return this.ids[i]||(this.ids[i]=1,this.list.push(e)),this}remove(e){const i=this.idFunc(e);return this.ids[i]&&(this.ids[i]=0,this.list=this.list.filter(n=>n!==e)),this}forEach(e,i){i?this.list.slice().reverse().forEach(e):this.list.forEach(e)}filter(e){return this.list.filter(e)}get length(){return this.list.length}getElementByIndex(e){return this.list[e]}}class Dataflow{constructor(){this.grammars=[],this.logger=Logger.getInstance(),this._curRank=0,this._committed=new UniqueList(e=>e.uid),this._heap=new Heap((e,i)=>(e==null?void 0:e.qrank)-(i==null?void 0:i.qrank)),this._beforeRunner=null,this._afterRunner=null,this._updateCounter=0,this._finishFirstRender=!1}add(e){if(e)return this._setRankOfGrammar(e),this.commit(e),!this.grammars.includes(e)&&(this.grammars.push(e),!0)}remove(e){e&&(this._committed.remove(e),this._heap.remove(e),this.grammars=this.grammars.filter(i=>i!==e))}_setRankOfGrammar(e){e&&(e.rank=++this._curRank)}_reRank(e){const i=[e];for(;i.length;){const n=i.pop();this._setRankOfGrammar(n);const o=n.targets;o&&o.forEach(l=>{i.push(l),l===e&&this.logger.error("Cycle detected in dataflow graph.")})}}_enqueue(e){e&&(e.qrank=e.rank,this._heap.push(e))}_logGrammarRunInfo(e){if(this.logger.canLogError()){const i=[{key:"id",value:e.id()},{key:"name",value:e.name()}].reduce((n,o,l)=>isNil(o.value)?n:`${n}${l?" , ":""}${o.key}: ${o.value}`,"");this.logger.debug("Run Operator: ",e,i)}}hasCommitted(){return!!this._committed.length}commit(e){return this._committed.add(e),this}_beforeEvaluate(){this.grammars.forEach(e=>{e.targets.some(i=>(i==null?void 0:i.rank)<(e==null?void 0:e.rank))&&this._reRank(e)}),this._committed.forEach(e=>this._enqueue(e)),this._committed=new UniqueList(e=>e.uid)}_enqueueTargets(e){e.targets&&e.targets.length&&this._finishFirstRender&&e.targets.forEach(i=>this._enqueue(i))}evaluate(){if(this._beforeRunner&&this._beforeRunner(this),!this._committed.length)return this.logger.info("Dataflow invoked, but nothing to do."),!1;this._updateCounter+=1;let e,i,n=0;for(this.logger.canLogInfo()&&(i=Date.now(),this.logger.debug(`-- START PROPAGATION (${this._updateCounter}) -----`)),this._beforeEvaluate();this._heap.size()>0;)e=this._heap.pop(),e&&(e.rank===e.qrank?(e.run(),this._logGrammarRunInfo(e),this._enqueueTargets(e),n+=1):this._enqueue(e));return this.logger.canLogInfo()&&(i=Date.now()-i,this.logger.info(`> ${n} grammars updated; ${i} ms`)),this._afterRunner&&this._afterRunner(this),this._finishFirstRender=!0,!0}runBefore(e){this._beforeRunner=e}runAfter(e){this._afterRunner=e}release(){this._heap&&(this._heap.clear(),this._heap=null),this.logger=null,this._committed=null}}const traverseMarkTree=(r,e,i,n,o)=>{const l=u=>{if(o||!u||n&&!n(u)||i.call(null,u),u.markType===GrammarMarkType.group){const d=u[e];d&&d.forEach(f=>{l(f)})}o&&(!u||n&&!n(u)||i.call(null,u))};l(r)};class CanvasRenderer{constructor(e){this.handleAfterNextRender=()=>{this._stage&&!this._viewOptions.disableDirtyBounds&&this._stage.enableDirtyBounds(),this._view.emit(HOOK_EVENT.AFTER_VRENDER_DRAW),this._view.emit(HOOK_EVENT.AFTER_VRENDER_NEXT_RENDER)},this._view=e}initialize(e,i,n,o){return this._width=e,this._height=i,this._viewOptions=n,this._eventConfig=o,this.initStage(),this}stage(){var e;return(e=this._stage)!==null&&e!==void 0?e:null}gestureController(){var e;return(e=this._gestureController)!==null&&e!==void 0?e:null}canvas(){return this._stage?this._stage.window.getNativeHandler().nativeCanvas:null}context(){return this._stage?this._stage.window.getContext().nativeContext:null}combineIncrementalLayers(){return this._stage&&waitForAllSubLayers(this._stage).then(()=>{this._stage&&this._stage.defaultLayer.combineSubLayer()}),this}background(e){if(this._stage)return this._stage.background=e,this}setDpr(e,i){var n,o;return(o=(n=this._stage)===null||n===void 0?void 0:n.setDpr)===null||o===void 0||o.call(n,e),i&&this.renderNextFrame(),this}shouldResize(e,i){return e!==this._width||i!==this._height}resize(e,i){return this._view.emit(HOOK_EVENT.BEFORE_STAGE_RESIZE),this.shouldResize(e,i)&&(this._width=e,this._height=i,this._stage&&this._stage.resize(e,i)),this._view.emit(HOOK_EVENT.AFTER_STAGE_RESIZE),this}setViewBox(e,i=!0){return this._stage?(!e||this._viewBox&&e.x1===this._viewBox.x1&&e.x2===this._viewBox.x2&&e.y1===this._viewBox.y1&&e.y2===this._viewBox.y2||(this._viewBox=e,this._stage.setViewBox(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1,i)),this):this}render(e=!1){return this._view.emit(HOOK_EVENT.BEFORE_VRENDER_DRAW),this.initStage(),this._stage.disableDirtyBounds(),this._stage.afterNextRender(this.handleAfterNextRender),e&&(this._stage.render(),this._view.emit(HOOK_EVENT.AFTER_VRENDER_DRAW)),this}renderNextFrame(){return this.initStage(),this._stage.renderNextFrame(),this}toCanvas(){return this._stage?this._stage.toCanvas():null}preventRender(e){this._stage&&this._stage.preventRender(e)}release(){var e;this._view.traverseMarkTree(i=>{i.release()}),this._dragController&&this._dragController.release(),this._gestureController&&this._gestureController.release(),this._stage!==((e=this._viewOptions)===null||e===void 0?void 0:e.stage)&&this._stage.release(),this._stage=null,this._layer=null,this._dragController=null,this._gestureController=null}createStage(){var e,i,n,o,l;this._view.emit(HOOK_EVENT.BEFORE_CREATE_VRENDER_STAGE);const u=this._viewOptions,d=(e=u.stage)!==null&&e!==void 0?e:createStage({width:this._width,height:this._height,renderStyle:u.renderStyle,viewBox:u.viewBox,dpr:u.dpr,canvas:u.renderCanvas,canvasControled:u.canvasControled,container:u.container,title:u.rendererTitle,beforeRender:u.beforeRender,afterRender:u.afterRender,disableDirtyBounds:!0,autoRender:!0,pluginList:u.pluginList,enableHtmlAttribute:u.enableHtmlAttribute,optimize:u.optimize,ticker:u.ticker,supportsTouchEvents:u.supportsTouchEvents,supportsPointerEvents:u.supportsPointerEvents,event:{clickInterval:this._eventConfig.clickInterval,autoPreventDefault:!!this._eventConfig.autoPreventDefault},ReactDOM:u.ReactDOM,autoRefresh:u.autoRefresh});!((i=u.options3d)===null||i===void 0)&&i.enable&&d.set3dOptions(u.options3d),d.enableIncrementalAutoRender(),this._viewBox=u.viewBox,this._view.emit(HOOK_EVENT.AFTER_CREATE_VRENDER_STAGE),this._view.emit(HOOK_EVENT.BEFORE_CREATE_VRENDER_LAYER);const f=(n=u.layer)!==null&&n!==void 0?n:d.defaultLayer;if(this._view.emit(HOOK_EVENT.AFTER_CREATE_VRENDER_LAYER),!((o=this._eventConfig)===null||o===void 0)&&o.drag&&Factory.getStageEventPlugin("drag")&&(this._dragController=new(Factory.getStageEventPlugin("drag"))(d)),((l=this._eventConfig)===null||l===void 0?void 0:l.gesture)&&Factory.getStageEventPlugin("gesture")){const g=isObject$1(this._eventConfig.gesture)?this._eventConfig.gesture:{};this._gestureController=new(Factory.getStageEventPlugin("gesture"))(d,g)}return{stage:d,layer:f}}initStage(){if(!this._stage){const{stage:e,layer:i}=this.createStage();this._stage=e,this._layer=i;const n=this._view.background();this.background(n)}}}const EVENT_SOURCE_WINDOW="window",EVENT_SOURCE_VIEW="view",BROWSER="browser",SIGNAL_WIDTH="width",SIGNAL_HEIGHT="height",SIGNAL_VIEW_WIDTH="viewWidth",SIGNAL_VIEW_HEIGHT="viewHeight",SIGNAL_PADDING="padding",SIGNAL_VIEW_BOX="viewBox",SIGNAL_AUTOFIT="autoFit",NAME_PREFIX="@",ID_PREFIX="#";function getExtendedEvents(r,e,i,n){var o,l;let u=(o=e.target)===null||o===void 0?void 0:o[BridgeElementKey];if(!u&&n===EVENT_SOURCE_VIEW){let d=e.target;const f=(l=r.rootMark)===null||l===void 0?void 0:l.graphicItem;for(;d!=null&&d.parent&&d.parent!==f;)if(d=d.parent,d[BridgeElementKey]){u=d[BridgeElementKey];break}}return e.element=u,e}class Signal extends GrammarBase{constructor(){super(...arguments),this.grammarType="signal",this.spec={value:null,update:null}}parse(e){return super.parse(e),this.value(e.value),this.update(e.update),this.commit(),this}evaluate(e,i){return this._signal=this.spec.update?invokeFunctionType(this.spec.update,i,this._signal):this.spec.value,this.spec.value=this._signal,this}output(){return this._signal}getValue(){return this.output()}set(e){if(isArray(e)&&isArray(this.value)&&e.length===this.value.length){for(let i=0;i<e.length;i++)if(this.value[i]!==e[i])return this._signal=e,this.spec.value=e,!0;return!1}return this._signal!==e&&(this._signal=e,this.spec.value=e,!0)}update(e){return isNil(e)||this.value(void 0),this.setFunctionSpec(e,"update")}value(e){return isNil(e)||this.update(void 0),this.spec.value=e,this.commit(),this}reuse(e){return e.grammarType!==this.grammarType||(this._signal=e.output()),this}clear(){super.clear(),this._signal=null}}let markBaseId=-1;const BuiltInSignalID=[SIGNAL_WIDTH,SIGNAL_HEIGHT,SIGNAL_PADDING,SIGNAL_VIEW_WIDTH,SIGNAL_VIEW_HEIGHT,SIGNAL_VIEW_BOX,SIGNAL_AUTOFIT],builtInSignals=(r,e,i)=>{var n,o,l,u,d;return[{id:SIGNAL_WIDTH,value:(n=r[SIGNAL_WIDTH])!==null&&n!==void 0?n:0},{id:SIGNAL_HEIGHT,value:(o=r[SIGNAL_HEIGHT])!==null&&o!==void 0?o:0},{id:SIGNAL_PADDING,value:normalizePadding((u=(l=r[SIGNAL_PADDING])!==null&&l!==void 0?l:e[SIGNAL_PADDING])!==null&&u!==void 0?u:i==null?void 0:i.padding)},{id:SIGNAL_VIEW_WIDTH,update:{callback:(f,g)=>{const _=normalizePadding(g[SIGNAL_PADDING]);return g[SIGNAL_WIDTH]-_.left-_.right},dependency:[SIGNAL_WIDTH,SIGNAL_PADDING]}},{id:SIGNAL_VIEW_HEIGHT,update:{callback:(f,g)=>{const _=normalizePadding(g[SIGNAL_PADDING]);return g[SIGNAL_HEIGHT]-_.top-_.bottom},dependency:[SIGNAL_HEIGHT,SIGNAL_PADDING]}},{id:SIGNAL_VIEW_BOX,update:{callback:(f,g)=>{const _=normalizePadding(g[SIGNAL_PADDING]);return(f||new Bounds).setValue(_.left,_.top,_.left+g[SIGNAL_VIEW_WIDTH],_.top+g[SIGNAL_VIEW_HEIGHT])},dependency:[SIGNAL_VIEW_WIDTH,SIGNAL_VIEW_HEIGHT,SIGNAL_PADDING]}},{id:SIGNAL_AUTOFIT,value:(d=r[SIGNAL_AUTOFIT])!==null&&d!==void 0?d:e[SIGNAL_AUTOFIT]}]},normalizePadding=r=>{var e,i,n,o;return isNumber(r)?{top:r,bottom:r,left:r,right:r}:{top:(e=r==null?void 0:r.top)!==null&&e!==void 0?e:0,bottom:(i=r==null?void 0:r.bottom)!==null&&i!==void 0?i:0,left:(n=r==null?void 0:r.left)!==null&&n!==void 0?n:0,right:(o=r==null?void 0:r.right)!==null&&o!==void 0?o:0}},normalizeMarkTree=r=>{var e;const i=(n,o)=>{var l,u;n.group=o;const d=(l=n.id)!==null&&l!==void 0?l:"VGRAMMAR_MARK_"+ ++markBaseId;n.id=d,((u=n.marks)!==null&&u!==void 0?u:[]).forEach(f=>i(f,d))};return((e=r.marks)!==null&&e!==void 0?e:[]).forEach(n=>i(n,"root")),r},normalizeRunningConfig=r=>{var e,i,n,o,l;const{reuse:u=DefaultReuse,morph:d=DefaultMorph,morphAll:f=DefaultMorphAll,animation:g={},enableExitAnimation:_=DefaultEnableExitAnimation}=r??{};return{reuse:u,morph:d,morphAll:f,animation:{easing:(e=g.easing)!==null&&e!==void 0?e:DefaultAnimationEasing,delay:(i=g.delay)!==null&&i!==void 0?i:DefaultAnimationDelay,duration:(n=g.duration)!==null&&n!==void 0?n:DefaultAnimationDuration,oneByOne:(o=g.oneByOne)!==null&&o!==void 0?o:DefaultAnimationOneByOne,splitPath:(l=g.splitPath)!==null&&l!==void 0?l:DefaultSplitPath},enableExitAnimation:_}};function configureEnvironment(r){r.mode&&vglobal.setEnv(r.mode,r.modeParams||{})}function groupData(r,e,i){const n=new Map;if(!r||r.length===0)return{keys:[],data:n};if(!e)return n.set(DefaultKey,i?r.slice().sort(i):r.slice()),{keys:DefaultGroupKeys,data:n};const o=parseField(e);if(r.length===1){const u=o(r[0]);return n.set(u,[r[0]]),{keys:[u],data:n}}const l=new Set;return r.forEach(u=>{var d;const f=o(u),g=(d=n.get(f))!==null&&d!==void 0?d:[];g.push(u),n.set(f,g),l.add(f)}),i&&l.forEach(u=>{n.get(u).sort(i)}),{keys:Array.from(l),data:n}}class Differ{constructor(e,i,n){this.prevData=e!=null&&e.length?groupData(e,i??null,n):null}setCurrentData(e){this.currentData=e}getCurrentData(){return this.currentData}doDiff(){if(this.callback)if(this.currentData&&this.prevData){const e=new Map(this.prevData.data);this.currentData.keys.forEach(i=>{this.callback(i,this.currentData.data.get(i),e.get(i)),e.delete(i)}),this.prevData.keys.forEach(i=>{e.has(i)&&this.callback(i,null,e.get(i))})}else this.currentData?this.currentData.keys.forEach(e=>{this.callback(e,this.currentData.data.get(e),null)}):this.prevData&&this.prevData.keys.forEach(e=>{this.callback(e,null,this.prevData.data.get(e))})}setCallback(e){this.callback=e}updateToCurrent(){this.prevData=this.currentData,this.currentData=null}reset(){this.prevData=null}}function diffSingle(r,e,i){const n={enter:[],exit:[],update:[]},o=new Differ(r,i);return o.setCallback((l,u,d)=>{isNil(u)?n.exit.push({prev:d[0]}):isNil(d)?n.enter.push({next:u[0]}):n.update.push({next:u[0],prev:d[0]})}),o.setCurrentData(groupData(e,i)),o.doDiff(),n}class Mark extends GrammarBase{constructor(e,i,n){super(e),this.grammarType="mark",this.elements=[],this.elementMap=new Map,this.isUpdated=!0,this._isReentered=!1,this.differ=new Differ([]),this.markType=i,this.spec.type=i,this.spec.encode={update:{}},this.spec.group=n,n&&(this.group=n,this.attach(n),n.appendChild(this))}parse(e){var i,n,o;if(super.parse(e),this.spec.group){const u=isString(this.spec.group)?this.view.getMarkById(this.spec.group):this.spec.group;this.detach(u)}const l=isString(e.group)?this.view.getMarkById(e.group):e.group;return this.attach(l),this.join((i=e.from)===null||i===void 0?void 0:i.data,e.key,e.sort,e.groupBy,e.groupSort),this.coordinate(e.coordinate),this.state(e.state,this.spec.stateSort),Object.keys((n=this.spec.encode)!==null&&n!==void 0?n:{}).forEach(u=>{this.encodeState(u,{},!0)}),Object.keys((o=e.encode)!==null&&o!==void 0?o:{}).forEach(u=>{this.encodeState(u,e.encode[u])}),this.animation(e.animation),this.animationState(e.animationState),this.morph(e.morph,e.morphKey,e.morphElementKey),this.layout(e.layout),this.configure(e),this.transform(e.transform),this.parseAddition(e),this.spec=e,this.markType=e.type,this.commit(),this}parameters(){var e;return(e=this._finalParameters)!==null&&e!==void 0?e:super.parameters()}parseAddition(e){return this}reuse(e){var i;if(e.grammarType!==this.grammarType)return this;const n=e;return this.markType=n.markType,this.coord=n.coord,this.elementMap=n.elementMap,this.elements=n.elements,this.elementMap.forEach(o=>o.mark=this),this.differ=n.differ,(i=this.reuseAnimate)===null||i===void 0||i.call(this,n),this._context=n._context,this.graphicItem=n.graphicItem,this.graphicIndex=n.graphicIndex,this.graphicParent=n.graphicParent,this.needClear=n.needClear,this.isUpdated=n.isUpdated,this}needLayout(){return!isNil(this.spec.layout)}handleLayoutEnd(){}handleRenderEnd(){this.needClear&&(this.cleanExitElements(),this.elementMap.forEach(e=>{e.diffState===DiffState.exit?e.clearGraphicAttributes():e.clearChangedGraphicAttributes()}),this.differ.updateToCurrent(),this.needClear=!1)}evaluateMainTasks(e,i){var n,o;if(this.needSkipBeforeLayout()&&this.view.getLayoutState()===LayoutState.before)return this;const l=(n=this.view.renderer)===null||n===void 0?void 0:n.stage();this.init(l,i);const u=this.evaluateTransform(this._getTransformsBeforeJoin(),e??DefaultMarkData,i),d=u==null?void 0:u.progressive;if(d?this.renderContext={large:!1}:(this.evaluateGroup(u),this.renderContext=this.parseRenderContext(u,i)),(o=this.renderContext)===null||o===void 0?void 0:o.progressive)this.differ.reset(),this.elementMap.clear(),this.evaluateProgressive();else{let f=null;if(d){if(this.renderContext.parameters=i,this.renderContext.beforeTransformProgressive=u.progressive,f=u.progressive.output(),u.progressive.canAnimate&&u.progressive.unfinished())return this.update(this.spec),this}else f=u;this.emit(HOOK_EVENT.BEFORE_MARK_JOIN),this.evaluateJoin(f),this.emit(HOOK_EVENT.AFTER_MARK_JOIN),this.emit(HOOK_EVENT.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,i),this.emit(HOOK_EVENT.AFTER_MARK_STATE),this.emit(HOOK_EVENT.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),i),this.emit(HOOK_EVENT.AFTER_MARK_ENCODE)}return this.update(this.spec),this}evaluateGroup(e){if(this.markType===GrammarMarkType.group)return;const i=groupData(e??DefaultMarkData,this.spec.groupBy,this.spec.groupSort);this._groupEncodeResult=null,this._groupedData=i}_getTransformsAfterEncodeItems(){return this.transforms&&this.transforms.filter(e=>e.markPhase==="afterEncodeItems")}_getTransformsAfterEncode(){return this.transforms&&this.transforms.filter(e=>isNil(e.markPhase)||e.markPhase==="afterEncode")}_getTransformsBeforeJoin(){return this.transforms?this.transforms.filter(e=>e.markPhase==="beforeJoin"):[]}evaluate(e,i){var n;return this.evaluateMainTasks(e,i),!((n=this.renderContext)===null||n===void 0)&&n.progressive||this.evaluateTransform(this._getTransformsAfterEncode(),this.elements,i),this}output(){return this}join(e,i,n,o,l){return this.grammarSource&&(this.detach(this.grammarSource),this.grammarSource=null),this.spec.from=null,isNil(e)||(isString(e)?this.grammarSource=this.view.getDataById(e):this.grammarSource=e,this.spec.from={data:e},this.attach(this.grammarSource)),this.spec.key=i,this.spec.sort=n,this.spec.groupBy=o,this.spec.groupSort=l,this.commit(),this}coordinate(e){return isString(e)?this.coord=this.view.getCoordinateById(e):this.coord=e,this.attach(this.coord),this.commit(),this}state(e,i){return this.spec.stateSort=i,this.setFunctionSpec(e,"state")}encode(e,i,n){return this.encodeState(DiffState.update,e,i,n)}encodeState(e,i,n,o){if(e===DiffState.enter&&(this._isReentered=!0),this.spec.encode[e]){const l=this.spec.encode[e];if(isFunctionType(l))this.detach(parseEncodeType(l,this.view));else{const u=isString(i);u&&o||!u&&n?(Object.keys(l).forEach(d=>{this.detach(parseEncodeType(l[d],this.view))}),this.spec.encode[e]={}):u?this.detach(parseEncodeType(l[i],this.view)):Object.keys(i).forEach(d=>{this.detach(parseEncodeType(l[d],this.view))})}}return i&&(this.spec.encode[e]||(this.spec.encode[e]={}),isString(i)?(this.spec.encode[e][i]=n,this.attach(parseEncodeType(n,this.view))):isFunctionType(i)?(this.spec.encode[e]=i,this.attach(parseEncodeType(i,this.view))):i&&(Object.assign(this.spec.encode[e],i),Object.values(i).forEach(l=>{this.attach(parseEncodeType(l,this.view))}))),this.commit(),this}_getEncoders(){var e;return(e=this.spec.encode)!==null&&e!==void 0?e:{}}animation(e){return this.spec.animation=e,this}animationState(e){return this.setFunctionSpec(e,"animationState")}layout(e){return this.spec.layout=e,this.commit(),this}morph(e,i,n){return this.spec.morph=e,this.spec.morphKey=i,this.spec.morphElementKey=n,this}transform(e){const i=parseTransformSpec(this.spec.transform,this.view);i&&(this.detach(i.refs),this.transforms=[]);const n=parseTransformSpec(e,this.view);return n&&(this.attach(n.refs),this.transforms=n.transforms),this.spec.transform=e,this.commit(),this}configure(e){const i=["clip","clipPath","zIndex","interactive","context","setCustomizedShape","large","largeThreshold","progressiveStep","progressiveThreshold","support3d","morph","morphKey","morphElementKey","attributeTransforms","skipTheme","enableSegments","stateSort","graphicName","overflow"];return e===null?(i.forEach(n=>{isNil(this.spec[n])||(this.spec[n]=void 0)}),this):(i.forEach(n=>{isNil(e[n])||(this.spec[n]=e[n])}),this)}context(e){return this.spec.context=e,this._context=e,this}isCollectionMark(){return CollectionMarkType.includes(this.markType)}needAnimate(){var e;return!(!((e=this.renderContext)===null||e===void 0)&&e.progressive)&&!isNil(this.spec.animation)}getAllElements(){const e=this.elements.slice();return this.elementMap.forEach(i=>{i.diffState!==DiffState.exit||e.includes(i)||e.push(i)}),this.spec.sort&&e.sort((i,n)=>this.spec.sort(i.getDatum(),n.getDatum())),e}getScales(){const e={};return this.references.forEach((i,n)=>{n.grammarType===GrammarTypeEnum.scale&&(e[n.id()]=n.output())}),e}getScalesByChannel(){const e=this.spec.encode;if(!e)return{};const i={},n=this.parameters();return Object.keys(e).forEach(o=>{const l=e[o];l&&!isFunctionType(l)&&Object.keys(l).forEach(u=>{isScaleEncode(l[u])&&(i[u]=getGrammarOutput(l[u].scale,n))})}),i}getFieldsByChannel(){const e=this.spec.encode;if(!e)return{};const i={};return Object.keys(e).forEach(n=>{const o=e[n];isFunctionType(o)||Object.keys(o).forEach(l=>{isFieldEncode(o[l])&&(i[l]=o[l].field)})}),i}init(e,i){var n,o,l,u,d;if(this._delegateEvent||(this._delegateEvent=(_,y)=>{const b=getExtendedEvents(this.view,_,y,EVENT_SOURCE_VIEW),S=_.element;(S==null?void 0:S.mark)===this&&this.emitGrammarEvent(y,b,S)},this.initEvent()),(n=this.initAnimate)===null||n===void 0||n.call(this,this.spec),!this.group){const _=getGrammarOutput(this.spec.group,i);this.group=_,_&&_.appendChild(this)}const f=this.group?this.group.getGroupGraphicItem():e.defaultLayer,g=(u=(l=(o=this.group)===null||o===void 0?void 0:o.children)===null||l===void 0?void 0:l.indexOf(this))!==null&&u!==void 0?u:0;if(this.markType!==GrammarMarkType.group){if(!this.graphicItem){const _=createGraphicItem(this,GrammarMarkType.group,{pickable:!1,zIndex:(d=this.spec.zIndex)!==null&&d!==void 0?d:0,overflow:this.spec.overflow});(this.spec.support3d||Mark3DType.includes(this.markType))&&_.setMode("3d"),_.name=`${this.id()||this.markType}`,this.graphicItem=_}this.graphicParent=this.graphicItem,!f||this.graphicIndex===g&&this.graphicItem.parent===f||f.insertIntoKeepIdx(this.graphicItem,g)}else this.graphicParent=f,this.graphicParent.setAttributes({overflow:this.spec.overflow});this.graphicIndex=g}update(e){var i;if(this.emit(HOOK_EVENT.BEFORE_MARK_UPDATE),this._context=this.spec.context,this.isUpdated=!0,this.renderContext.progressive||(i=this.updateAnimate)===null||i===void 0||i.call(this,e),this.markType!==GrammarMarkType.group){if(isNil(e.zIndex)||this.graphicItem.setAttribute("zIndex",e.zIndex),isNil(e.clip)||this.graphicItem.setAttribute("clip",e.clip),!isNil(e.clipPath)){const n=isArray(e.clipPath)?e.clipPath:e.clipPath(this.elements);n&&n.length?this.graphicItem.setAttribute("path",n):this.graphicItem.setAttributes({path:n,clip:!1})}isNil(e.overflow)||this.graphicItem.setAttribute("overflow",e.overflow),this.elementMap.forEach(n=>{n.updateGraphicItem()})}else this.elementMap.forEach(n=>{n.updateGraphicItem()});this.emit(HOOK_EVENT.AFTER_MARK_UPDATE)}createElement(){return new Element$1(this)}evaluateJoin(e){var i,n,o,l;this.needClear=!0;const u=parseField((o=(i=this.spec.key)!==null&&i!==void 0?i:(n=this.grammarSource)===null||n===void 0?void 0:n.getDataIDKey())!==null&&o!==void 0?o:()=>DefaultKey),d=parseField((l=this.spec.groupBy)!==null&&l!==void 0?l:()=>DefaultKey),f=this.spec.sort,g=this.isCollectionMark(),_=new Set(this.elements.filter(S=>S.diffState===DiffState.enter)),y=[];this.differ.setCallback((S,v,A)=>{var x;const T=S;let C;if(isNil(v))C=this.elementMap.get(T),C&&(C.diffState=DiffState.exit);else if(isNil(A)){if(C=this.elementMap.has(T)?this.elementMap.get(T):this.createElement(),C.diffState===DiffState.exit){C.diffState=DiffState.enter;const P=(x=this.animate)===null||x===void 0?void 0:x.getElementAnimators(C,DiffState.exit);P&&P.forEach(L=>L.stop("start"))}C.diffState=DiffState.enter;const E=g?S:d(v[0]);C.updateData(E,v,u),this.elementMap.set(T,C),y.push(C)}else if(C=this.elementMap.get(T),C){C.diffState=DiffState.update;const E=g?S:d(v[0]);C.updateData(E,v,u),y.push(C)}_.delete(C)});const b=e??DefaultMarkData;g?this.differ.setCurrentData(this._groupedData):this.differ.setCurrentData(groupData(b,S=>`${d(S)}-${u(S)}`,void 0)),this.differ.doDiff(),_.forEach(S=>{this.elementMap.delete(g?S.groupKey:`${S.groupKey}-${S.key}`),S.remove(),S.release()}),this.elements=y,f&&this.elements.length>=2&&this.elements.sort((S,v)=>f(S.getDatum(),v.getDatum()))}evaluateState(e,i,n){i&&e.forEach(o=>{o.state(i,n)})}evaluateGroupEncode(e,i,n){if(!this._groupedData||!i)return;const o={};return this._groupedData.keys.forEach(l=>{const u=e.find(d=>d.groupKey===l);u&&(o[l]=invokeEncoder(i,u.items&&u.items[0]&&u.items[0].datum,u,n))}),this._groupEncodeResult=o,o}getChannelsFromConfig(e){const i=this.spec;return isNil(i.interactive)?null:{pickable:i.interactive}}evaluateEncode(e,i,n,o){const l=this.getChannelsFromConfig();if(i){this.emit(HOOK_EVENT.BEFORE_ELEMENT_ENCODE,{encoders:i,parameters:n},this);const u=o?null:this.evaluateGroupEncode(e,i[BuiltInEncodeNames.group],n);e.forEach(d=>{this.markType===GrammarMarkType.glyph&&this._groupEncodeResult?d.items.forEach(f=>{f.nextAttrs=Object.assign(f.nextAttrs,l,this._groupEncodeResult[d.groupKey])}):u!=null&&u[d.groupKey]&&!this.isCollectionMark()?d.items.forEach(f=>{f.nextAttrs=Object.assign(f.nextAttrs,l,u[d.groupKey])}):l&&d.items.forEach(f=>{f.nextAttrs=Object.assign(f.nextAttrs,l)}),d.encodeItems(d.items,i,this._isReentered,n),this.isCollectionMark()&&(u!=null&&u[d.groupKey])&&isValid(u[d.groupKey].defined)&&(d.items.forEach(f=>{f.nextAttrs.defined=u[d.groupKey].defined}),delete u[d.groupKey].defined)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),e,n),e.forEach(d=>{d.encodeGraphic(this.isCollectionMark()?u==null?void 0:u[d.groupKey]:null)}),this.emit(HOOK_EVENT.AFTER_ELEMENT_ENCODE,{encoders:i,parameters:n},this)}else e.forEach(u=>{u.initGraphicItem(l)})}addGraphicItem(e,i,n){var o;const l=n??createGraphicItem(this,this.markType,e);if(l){if(!((o=this.renderContext)===null||o===void 0)&&o.progressive){let u;if(this._groupedData){const d=this._groupedData.keys.indexOf(i);d>=0&&(u=this.graphicParent.getChildAt(d))}else u=this.graphicParent.at(0);this.isCollectionMark()?(l.incremental=1,u.appendChild(l)):u.incrementalAppendChild(l)}else this.graphicParent.appendChild(l);return l}}parseRenderContext(e,i){const n=this.markType!==GrammarMarkType.group&&this.spec.progressiveStep>0&&this.spec.progressiveThreshold>0&&this.spec.progressiveStep<this.spec.progressiveThreshold,o=this.spec.large&&this.spec.largeThreshold>0&&e.length>=this.spec.largeThreshold;if(n){const l=this._groupedData;return l&&l.keys&&l.keys.some(u=>l.data.get(u).length>this.spec.progressiveThreshold)?{large:o,parameters:i,progressive:{data:e,step:this.spec.progressiveStep,currentIndex:0,totalStep:l.keys.reduce((u,d)=>Math.max(Math.ceil(l.data.get(d).length/this.spec.progressiveStep),u),1),groupedData:l.data}}:{large:o}}return{large:o}}isProgressive(){return this.renderContext&&(!!this.renderContext.progressive||!!this.renderContext.beforeTransformProgressive)}canAnimateAfterProgressive(){return this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.canAnimate()}isDoingProgressive(){return this.renderContext&&(this.renderContext.progressive&&this.renderContext.progressive.currentIndex<this.renderContext.progressive.totalStep||this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.unfinished())}clearProgressive(){this.renderContext&&this.renderContext.progressive&&(this.elements=[],this.graphicParent.children.forEach(e=>{e.incrementalClearChild()}),this.graphicParent.removeAllChild()),this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.release(),this.renderContext=null}restartProgressive(){this.renderContext&&this.renderContext.progressive&&(this.renderContext.progressive.currentIndex=0)}evaluateJoinProgressive(){var e,i,n;const o=this.renderContext.progressive.currentIndex,l=parseField((n=(e=this.spec.key)!==null&&e!==void 0?e:(i=this.grammarSource)===null||i===void 0?void 0:i.getDataIDKey())!==null&&n!==void 0?n:()=>DefaultKey),u=[];if(this.isCollectionMark())return this._groupedData.keys.forEach((f,g)=>{const _=this.renderContext.progressive.groupedData.get(f),y=this.renderContext.progressive.step,b=_.slice(o*y,(o+1)*y);if(o===0){const S=this.createElement();S.diffState=DiffState.enter,S.updateData(f,b,l),u.push(S)}else{const S=this.elements[g];S.updateData(f,b,l),u.push(S)}}),u;const d={};return this._groupedData.keys.forEach(f=>{const g=this.renderContext.progressive.groupedData.get(f),_=this.renderContext.progressive.step,y=g.slice(o*_,(o+1)*_),b=[];y.forEach(S=>{const v=this.createElement();v.diffState=DiffState.enter,v.updateData(f,[S],l),b.push(v),u.push(v)}),d[f]=b}),{groupElements:d,elements:u}}evaluateEncodeProgressive(e,i,n){const o=this.renderContext.progressive.currentIndex;if(o===0){if(this.evaluateEncode(e,i,n),o===0&&this._groupEncodeResult&&!this.isCollectionMark()&&this.markType!==GrammarMarkType.glyph){const l=e[0],u=l.getGraphicItem(),d=u==null?void 0:u.parent;d&&this._groupEncodeResult[l.groupKey]&&d.setTheme({common:this._groupEncodeResult[l.groupKey]})}}else this.evaluateEncode(e,i,n,!0)}evaluateProgressive(){var e,i,n;if(!((e=this.renderContext)===null||e===void 0)&&e.beforeTransformProgressive){const f=this.renderContext.beforeTransformProgressive;f.progressiveRun();const g=f.output();if(f.canAnimate){if(f.unfinished())return;this.evaluateGroup(g)}return this.emit(HOOK_EVENT.BEFORE_MARK_JOIN),this.evaluateJoin(g),this.emit(HOOK_EVENT.AFTER_MARK_JOIN),this.emit(HOOK_EVENT.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,this.renderContext.parameters),this.emit(HOOK_EVENT.AFTER_MARK_STATE),this.emit(HOOK_EVENT.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),this.renderContext.parameters),void this.emit(HOOK_EVENT.AFTER_MARK_ENCODE)}if(!(!((i=this.renderContext)===null||i===void 0)&&i.progressive))return;const o=this.renderContext.parameters;this.emit(HOOK_EVENT.BEFORE_MARK_JOIN);const l=this.evaluateJoinProgressive(),u=Array.isArray(l)?l:l.elements;if(this.emit(HOOK_EVENT.AFTER_MARK_JOIN),this.renderContext.progressive.currentIndex===0?(this.graphicParent.removeAllChild(),this._groupedData.keys.forEach(f=>{const g=createGraphicItem(this,GrammarMarkType.group,{pickable:!1,zIndex:this.spec.zIndex});g.incremental=this.renderContext.progressive.step,this.graphicParent.appendChild(g)}),this.elements=u):this.elements=this.elements.concat(u),this.emit(HOOK_EVENT.BEFORE_MARK_STATE),this.evaluateState(u,this.spec.state,o),this.emit(HOOK_EVENT.AFTER_MARK_STATE),this.emit(HOOK_EVENT.BEFORE_MARK_ENCODE),Array.isArray(l))this.evaluateEncodeProgressive(u,this._getEncoders(),o);else{const f=l.groupElements;Object.keys(f).forEach(g=>{this.evaluateEncodeProgressive(f[g],this._getEncoders(),o)})}this.emit(HOOK_EVENT.AFTER_MARK_ENCODE);const d=(n=this._getTransformsAfterEncode())===null||n===void 0?void 0:n.filter(f=>f.canProgressive===!0);d!=null&&d.length&&this.evaluateTransform(d,this.elements,o),this.renderContext.progressive.currentIndex+=1}isLargeMode(){return this.renderContext&&this.renderContext.large}cleanExitElements(){this.elementMap.forEach((e,i)=>{e.diffState!==DiffState.exit||e.isReserved||(this.elementMap.delete(i),e.remove(),e.release())})}getGroupGraphicItem(){if(this.elements&&this.elements[0]&&this.elements[0].getGraphicItem)return this.elements[0].getGraphicItem()}getBounds(){var e;return this.graphicItem?this.graphicItem.AABBBounds:(e=this.getGroupGraphicItem())===null||e===void 0?void 0:e.AABBBounds}getMorphConfig(){var e;return{morph:(e=this.spec.morph)!==null&&e!==void 0&&e,morphKey:this.spec.morphKey,morphElementKey:this.spec.morphElementKey}}getAttributeTransforms(){var e;return(e=this.spec.attributeTransforms)!==null&&e!==void 0?e:transformsByType[this.markType]}getContext(){return this._context}needSkipBeforeLayout(){var e,i;if(((e=this.spec.layout)===null||e===void 0?void 0:e.skipBeforeLayouted)===!0)return!0;let n=this.group;for(;n;){if(((i=n.getSpec().layout)===null||i===void 0?void 0:i.skipBeforeLayouted)===!0)return!0;n=n.group}return!1}initEvent(){if(this._delegateEvent){const e=this.view.renderer.stage();e&&e.on("*",this._delegateEvent)}}releaseEvent(){if(this._delegateEvent){const e=this.view.renderer.stage();e&&e.off("*",this._delegateEvent)}}clear(){var e;this.releaseEvent(),this.transforms=null,this.elementMap=null,this.elements=null,this.graphicItem=null,this.animate=null,(e=this.group)===null||e===void 0||e.removeChild(this),this.group=null,super.clear()}prepareRelease(){var e;this.differ.setCurrentData(null),(e=this.animate)===null||e===void 0||e.stop(),this.elementMap.forEach(i=>i.diffState=DiffState.exit),this._finalParameters=this.parameters()}release(){this.releaseEvent(),this.elements.forEach(e=>e.release()),this.differ=null,this.elements=[],this.elementMap.clear(),this._finalParameters=null,this.animate&&this.animate.release(),this.graphicItem&&removeGraphicItem(this.graphicItem),this.detachAll(),super.release()}}let GroupMark$1=class extends Mark{constructor(e,i){super(e,GrammarMarkType.group,i),this.children=[]}parseRenderContext(){return{large:!1}}appendChild(e){return this.children.push(e),this}removeChild(e){return this.children=this.children.filter(i=>i!==e),this}includesChild(e,i=!0){return!!this.children.includes(e)||!!i&&this.children.some(n=>n.markType===GrammarMarkType.group&&n.includesChild(e,!0))}updateLayoutChildren(){return this.children.length?(this.layoutChildren||(this.layoutChildren=[]),this.layoutChildren=this.children.filter(e=>e.needLayout()),this):this}getAttributeTransforms(){return transformsByType.rect}evaluateJoin(e){if(!this.elements.length){const i=this.createElement();i.updateData(DefaultKey,DefaultMarkData,()=>""),this.elements=[i],this.elementMap.set(DefaultKey,i)}}getChannelsFromConfig(e){const i=this.spec,n={};if(isNil(i.clip)||(n.clip=i.clip),isNil(i.zIndex)||(n.zIndex=i.zIndex),!isNil(i.clipPath)){const o=isFunction(i.clipPath)?i.clipPath([e]):i.clipPath;o&&o.length?n.path=o:(n.path=null,n.clip=!1)}return isNil(i.interactive)||(n.pickable=i.interactive),n}evaluateGroupEncode(e,i,n){var o;const l=this.elements[0],u={},d=[Object.assign({},(o=l.items)===null||o===void 0?void 0:o[0],{nextAttrs:u})];return invokeEncoderToItems(l,d,i,n),this._groupEncodeResult=u,u}evaluateEncode(e,i,n,o){const l=this.getChannelsFromConfig();if(i){this.emit(HOOK_EVENT.BEFORE_ELEMENT_ENCODE,{encoders:i,parameters:n},this);const u=o?null:this.evaluateGroupEncode(e,i[BuiltInEncodeNames.group],n);e.forEach(d=>{d.items.forEach(f=>{f.nextAttrs=Object.assign(f.nextAttrs,l,u)}),d.encodeItems(d.items,i,this._isReentered,n)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),e,n),e.forEach(d=>{d.encodeGraphic()}),this.emit(HOOK_EVENT.AFTER_ELEMENT_ENCODE,{encoders:i,parameters:n},this)}else e.forEach(u=>{u.initGraphicItem(l)})}addGraphicItem(e,i,n){const o=n??createGraphicItem(this,this.markType,e);if(o)return this.emit(HOOK_EVENT.BEFORE_ADD_VRENDER_MARK,{graphicItem:o}),o.name=`${this.id()||this.markType}`,this.graphicParent.insertIntoKeepIdx(o,this.graphicIndex),this.emit(HOOK_EVENT.AFTER_ADD_VRENDER_MARK,{graphicItem:o}),o}};class RecordedGrammars{constructor(e,i){this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}},this._size=0,this._mapKey=isString(e)?n=>n[e]:e,this._warning=i}record(e){var i,n;const o=e.grammarType,l=this._mapKey(e);return this._grammarMap[o]?(this._grammars[o].push(e),isNil(l)||(this._grammarMap[o][l]?(i=this._warning)===null||i===void 0||i.call(this,l,e):this._grammarMap[o][l]=e)):(this._grammars.customized.push(e),isNil(l)||(this._grammarMap.customized[l]?(n=this._warning)===null||n===void 0||n.call(this,l,e):this._grammarMap.customized[l]=e)),this._size+=1,this}unrecord(e){const i=e.grammarType,n=this._mapKey(e);return this._grammarMap[i]?(this._grammars[i]=this._grammars[i].filter(o=>o!==e),isNil(n)||this._grammarMap[i][n]!==e||delete this._grammarMap[i][n]):(this._grammars.customized=this._grammars.customized.filter(o=>o!==e),isNil(n)||this._grammarMap.customized[n]!==e||delete this._grammarMap.customized[n]),this._size-=1,this}size(){return this._size}getSignal(e){var i;return(i=this._grammarMap.signal[e])!==null&&i!==void 0?i:null}getData(e){var i;return(i=this._grammarMap.data[e])!==null&&i!==void 0?i:null}getScale(e){var i;return(i=this._grammarMap.scale[e])!==null&&i!==void 0?i:null}getCoordinate(e){var i;return(i=this._grammarMap.coordinate[e])!==null&&i!==void 0?i:null}getMark(e){var i;return(i=this._grammarMap.mark[e])!==null&&i!==void 0?i:null}getCustomized(e){var i;return(i=this._grammarMap.customized[e])!==null&&i!==void 0?i:null}getGrammar(e){return this._grammarMap.data[e]?this._grammarMap.data[e]:this._grammarMap.signal[e]?this._grammarMap.signal[e]:this._grammarMap.scale[e]?this._grammarMap.scale[e]:this._grammarMap.coordinate[e]?this._grammarMap.coordinate[e]:this._grammarMap.mark[e]?this._grammarMap.mark[e]:this._grammarMap.customized[e]?this._grammarMap.customized[e]:null}getAllSignals(){return this._grammars.signal}getAllData(){return this._grammars.data}getAllScales(){return this._grammars.scale}getAllCoordinates(){return this._grammars.coordinate}getAllMarks(){return this._grammars.mark}getAllCustomized(){return this._grammars.customized}traverse(e){var i;Object.values((i=this._grammars)!==null&&i!==void 0?i:{}).forEach(n=>(n??[]).forEach(o=>{e.call(null,o)}))}find(e){let i=null;return this.traverse(n=>e.call(null,n)===!0&&(i=n,!0)),i}filter(e){const i=[];return this.traverse(n=>{e.call(null,n)===!0&&i.push(n)}),i}clear(){this._size=0,this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}}}release(){this._size=0,this._grammars=null,this._grammarMap=null}}class RecordedTreeGrammars extends RecordedGrammars{constructor(){super(...arguments),this._markNodes=[]}record(e){if(super.record(e),e.grammarType==="mark"){const i=e,n={mark:i,parent:null,children:[]};this._markNodes.forEach(o=>{const l=o.mark;l.markType===GrammarMarkType.group&&l.includesChild(i,!1)?(o.children.push(n),n.parent=o):i.markType===GrammarMarkType.group&&i.includesChild(l,!1)&&(n.children.push(o),o.parent=n)}),this._markNodes.push(n)}return this}unrecord(e){if(super.unrecord(e),e.grammarType==="mark"){const i=e,n=this._markNodes.find(o=>o.mark===i);this._markNodes.forEach(o=>{o.mark.markType===GrammarMarkType.group&&o.children.includes(n)?(o.children=o.children.filter(l=>l!==n),n.parent=null):i.markType===GrammarMarkType.group&&n.children.includes(o)&&(n.children=n.children.filter(l=>l!==o),o.parent=null)}),this._markNodes=this._markNodes.filter(o=>o!==n)}return this}getAllMarkNodes(){return this._markNodes}clear(){super.clear(),this._markNodes=[]}release(){super.release(),this._markNodes=null}}class Text extends Mark{addGraphicItem(e,i){const n=e&&e.limitAttrs,o=n&&(n.textType==="rich"||n.text&&n.text.type==="rich"),l=createGraphicItem(this,o?GrammarMarkType.richtext:GrammarMarkType.text,e);return super.addGraphicItem(e,i,l)}release(){super.release()}}Text.markType=GrammarMarkType.text;const axis={label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#89909d",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],start:{x:0,y:0},end:{x:100,y:0},x:0,y:0},circleAxis={title:{space:4,padding:[0,0,0,0],textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1},text:"theta"},label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#6F6F6F",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],startAngle:0,endAngle:2*Math.PI,radius:100,innerRadius:0,center:{x:0,y:0},x:0,y:0},grid={style:{stroke:"#f1f2f5"}},circleGrid={style:{stroke:"#f1f2f5"}},discreteLegend={layout:"vertical",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:10,spaceRow:10,shape:{space:4,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",stroke:"#D8D8D8",fillOpacity:.5}}},label:{space:4,style:{fontSize:12,fill:"black",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",fillOpacity:.5}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"},state:{selectedHover:{fillOpacity:.7,fill:"gray"},unSelectedHover:{fillOpacity:.2,fill:"gray"}}},focus:!1,focusIconStyle:{size:10,fill:"#333",cursor:"pointer"},visible:!0,padding:{top:2,bottom:2,left:2,right:2}},autoPage:!0,pager:{space:12,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!1,items:[{index:0,id:"",label:"",shape:{fill:"#6690F2",stroke:"#6690F2",symbolType:"circle"}}]},colorLegend={title:{visible:!1,text:""},colors:[],layout:"horizontal",railWidth:200,railHeight:8,railStyle:{cornerRadius:5}},sizeLegend={title:{visible:!1,text:""},trackStyle:{fill:"#ccc"},layout:"horizontal",align:"bottom",railWidth:200,railHeight:6,min:0,max:1,value:[0,1]},lineCrosshair={start:{x:0,y:0},end:{x:0,y:0}},rectCrosshair={start:{x:0,y:0},end:{x:0,y:0},rectStyle:{width:10,height:10}},sectorCrosshair={center:{x:0,y:0},radius:100,startAngle:0,endAngle:Math.PI/6},circleCrosshair={center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI},polygonCrosshair={center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI,sides:6},slider={layout:"horizontal",railWidth:200,railHeight:10,railStyle:{cornerRadius:5},range:{draggableTrack:!0},startText:{visible:!0,text:"",space:8},endText:{visible:!0,text:"",space:8},min:0,max:1,value:[0,1]},dataLabel={size:{width:400,height:400},dataLabels:[]},lineDataLabel$1={type:"line-data",data:[{text:""}],position:"top",overlap:{avoidBaseMark:!1,clampForce:!1},smartInvert:!1},lineLabel={type:"line",data:[{text:"",data:{}}],position:"start",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},areaLabel={type:"area",data:[{text:"",data:{}}],position:"end",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},rectLabel={type:"rect",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},symbolLabel$1={type:"symbol",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{avoidBaseMark:!0,size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},arcLabel={type:"arc",data:[{text:"",fill:"#606773",data:{}}],width:800,height:600,position:"outside",zIndex:302},pointLabel$1={data:[{text:"",fill:"#606773",data:{}}],overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},datazoom={orient:"bottom",showDetail:"auto",brushSelect:!0,start:0,end:1,position:{x:0,y:0},size:{width:500,height:40},previewData:[]},continuousPlayer={},discretePlayer={},tooltip={},title={textStyle:{fill:"#21252c"},subtextStyle:{fill:"#606773"}},scrollbar={width:12,height:12,padding:[2,2],railStyle:{fill:"rgba(0, 0, 0, .1)"}},defaultComponentTheme={axis,circleAxis,grid,circleGrid,discreteLegend,colorLegend,sizeLegend,lineCrosshair,rectCrosshair,sectorCrosshair,circleCrosshair,polygonCrosshair,slider,dataLabel,pointLabel:pointLabel$1,lineLabel,areaLabel,rectLabel,symbolLabel:symbolLabel$1,arcLabel,lineDataLabel:lineDataLabel$1,datazoom,continuousPlayer,discretePlayer,tooltip,title,scrollbar},DEFAULT_PADDING=5,defaultMarkTheme={symbol:{shape:"circle",size:8},text:{fontSize:14,fill:"#000000"}},darkComponents=Object.assign({},defaultComponentTheme);darkComponents.axis=Object.assign({},darkComponents.axis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),darkComponents.circleAxis=Object.assign({},darkComponents.circleAxis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),darkComponents.grid=Object.assign({},darkComponents.grid,{style:{stroke:"#404349"}}),darkComponents.circleGrid=Object.assign({},darkComponents.circleGrid,{style:{stroke:"#404349"}}),darkComponents.rectLabel=Object.assign({},darkComponents.rectLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),darkComponents.lineLabel=Object.assign({},darkComponents.lineLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),darkComponents.symbolLabel=Object.assign({},darkComponents.symbolLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),darkComponents.title=Object.assign({},darkComponents.title,{textStyle:{fill:"#fdfdfd"},subtextStyle:{fill:"#888c93"}});const darkTheme={name:"dark",padding:DEFAULT_PADDING,background:"#202226",palette:{default:["#5383F4","#7BCF8E","#FF9D2C","#FFDB26","#7568D9","#80D8FB","#1857A3","#CAB0E8","#FF8867","#B9E493","#2CB4A8","#B9E4E3"]},marks:defaultMarkTheme,components:darkComponents},defaultTheme={name:"default",padding:DEFAULT_PADDING,palette:{default:["#6690F2","#70D6A3","#B4E6E2","#63B5FC","#FF8F62","#FFDC83","#BCC5FD","#A29BFE","#63C4C7","#F68484"]},marks:defaultMarkTheme,components:defaultComponentTheme};class ThemeManager{static registerTheme(e,i){e&&ThemeManager._themes.set(e,i)}static unregisterTheme(e){ThemeManager._themes.delete(e)}static getTheme(e){return ThemeManager._themes.get(e)}static getDefaultTheme(){return ThemeManager.getTheme("default")}}ThemeManager._themes=new Map,ThemeManager.registerTheme("default",defaultTheme),ThemeManager.registerTheme("dark",darkTheme);class Component extends Mark{constructor(e,i,n,o){super(e,GrammarMarkType.component,n),this._componentDatum={[DefaultKey]:0},this.componentType=i,this.spec.type="component",this.spec.componentType=i,this.mode=o,this._updateComponentEncoders()}configureComponent(e){return this.spec.componentConfig=e,this.commit(),this}addGraphicItem(e,i,n){const o=n??Factory.createGraphicComponent(this.componentType,e,{mode:this.mode,skipDefault:this.spec.skipTheme});return o&&(this.emit(HOOK_EVENT.BEFORE_ADD_VRENDER_MARK,{graphicItem:o}),this.graphicParent.appendChild(o),this.emit(HOOK_EVENT.AFTER_ADD_VRENDER_MARK,{graphicItem:o})),o}join(e){return super.join(e,DefaultKey)}encodeState(e,i,n){return super.encodeState(e,i,n),this._updateComponentEncoders(),this}parseRenderContext(){return{large:!1}}_prepareRejoin(){this._componentDatum[DefaultKey]+=1}evaluateJoin(e){return this.spec.key=DefaultKey,e?(e[DefaultKey]=this._componentDatum[DefaultKey],this._componentDatum=e):this._componentDatum={[DefaultKey]:this._componentDatum[DefaultKey]},super.evaluateJoin([this._componentDatum])}_updateComponentEncoders(){this._encoders=this.spec.encode}_getEncoders(){var e;return(e=this._encoders)!==null&&e!==void 0?e:{}}}const EmptyKey=Symbol.for("key");class ViewDiff{diffGrammar(e,i){return diffSingle(e,i,n=>{var o;return(o=n.id())!==null&&o!==void 0?o:Symbol()})}diffMark(e,i,n){const o={enter:[],exit:[],update:[]};let l=[],u=[];e.forEach(y=>{y.markType!==GrammarMarkType.group&&(n.morph&&y.getMorphConfig().morph||n.morphAll||n.reuse)?l.push(y):o.exit.push({prev:[y]})}),i.forEach(y=>{y.markType!==GrammarMarkType.group&&(n.morph&&y.getMorphConfig().morph||n.morphAll||n.reuse)?u.push(y):o.enter.push({next:[y]})});const d=this.diffUpdateByGroup(l,u,y=>y.getMorphConfig().morphKey,y=>y.getMorphConfig().morphKey);l=d.prev,u=d.next,o.update=o.update.concat(d.update);const f=this.diffUpdateByGroup(l,u,y=>y.id(),y=>y.id());l=f.prev,u=f.next,o.update=o.update.concat(f.update);const g=groupData(l,y=>{var b,S;return(S=(b=y.group)===null||b===void 0?void 0:b.id)===null||S===void 0?void 0:S.call(b)}),_=groupData(u,y=>{var b,S;return(S=(b=y.group)===null||b===void 0?void 0:b.id)===null||S===void 0?void 0:S.call(b)});return Object.keys(_).forEach(y=>{const b=g.data.get(y),S=_.data.get(y);if(b&&S){for(let v=0;v<Math.max(b.length,S.length);v+=1){const A=b[v],x=S[v];A&&x?o.update.push({prev:[A],next:[x]}):A?o.exit.push({prev:[A]}):x&&o.enter.push({next:[x]})}l=l.filter(v=>!b.includes(v)),u=u.filter(v=>!S.includes(v))}}),l.forEach(y=>o.exit.push({prev:[y]})),u.forEach(y=>o.enter.push({next:[y]})),o}diffUpdateByGroup(e,i,n,o){const l=groupData(e,_=>{var y;return(y=n(_))!==null&&y!==void 0?y:EmptyKey}),u=groupData(i,_=>{var y;return(y=o(_))!==null&&y!==void 0?y:EmptyKey});let d=e,f=i;const g=[];return u.keys.forEach(_=>{if(_!==EmptyKey){const y=l.data.get(_),b=u.data.get(_);y&&b&&(g.push({prev:y,next:b}),d=d.filter(S=>!y.includes(S)),f=f.filter(S=>!b.includes(S)))}}),{prev:d,next:f,update:g}}}class View extends EventEmitter{static useRegisters(e){e.forEach(i=>{i()})}constructor(e={},i={}){super(),this._observer=null,this._onResize=debounce((...n)=>{const o=this._getContainerSize();o&&this.resize(o.width,o.height)},100),this.delegateEvent=(n,o)=>{const l=getExtendedEvents(this,n,o,EVENT_SOURCE_VIEW);this.emit(o,l,n.element)},this.handleProgressiveFrame=()=>{this._progressiveMarks.length&&this._progressiveMarks.forEach(n=>{n.isDoingProgressive()&&n.evaluateProgressive()}),this.doPreProgressive()},this._config=i,this._options=Object.assign({mode:BROWSER},e),this.initialize()}getGrammarById(e){return this.grammars.getGrammar(e)}getSignalById(e){return this.grammars.getSignal(e)}getDataById(e){return this.grammars.getData(e)}getScaleById(e){return this.grammars.getScale(e)}getCoordinateById(e){return this.grammars.getCoordinate(e)}getMarkById(e){return this.grammars.getMark(e)}getCustomizedById(e){return this.grammars.getCustomized(e)}getGrammarsByName(e){return this.grammars.filter(i=>i.name()===e)}getGrammarsByType(e){return this.grammars.filter(i=>i.grammarType===e)}getMarksByType(e){return this.grammars.getAllMarks().filter(i=>i.markType===e)}getMarksByName(e){return this.grammars.getAllMarks().filter(i=>i.name()===e)}getMarksBySelector(e){if(!e)return null;const i=array(e),n=[];return i.forEach(o=>{if(isGrammar(o))return void n.push(o);if(o[0]===ID_PREFIX){const u=this.getMarkById(o.slice(1));return void(u&&n.push(u))}const l=o[0]===NAME_PREFIX?this.getMarksByName(o.slice(1)):isMarkType(o)?this.getMarksByType(o):null;l&&l.length&&l.forEach(u=>{n.push(u)})}),n}updateSignal(e,i){isString(e)&&(e=this.getSignalById(e)),e.set(i),this.commit(e)}signal(e,i){const n=new Signal(this);return arguments.length>=1&&n.value(e),arguments.length>=2&&n.update(i),this.grammars.record(n),this._dataflow.add(n),n}data(e){const i=new Data(this,e);return this.grammars.record(i),this._dataflow.add(i),i}scale(e){const i=Factory.createGrammar("scale",this,e);return i&&(this.grammars.record(i),this._dataflow.add(i)),i}coordinate(e){const i=Factory.createGrammar("coordinate",this,e);return i&&(this.grammars.record(i),this._dataflow.add(i)),i}mark(e,i,n){const o=isString(i)?this.getMarkById(i):i;let l;switch(e){case GrammarMarkType.group:l=new GroupMark$1(this,o);break;case GrammarMarkType.glyph:const u=Factory.getMark(GrammarMarkType.glyph);u&&(l=new u(this,n==null?void 0:n.glyphType,o));break;case GrammarMarkType.component:l=Factory.hasComponent(n==null?void 0:n.componentType)?Factory.createComponent(n==null?void 0:n.componentType,this,o,n==null?void 0:n.mode):new Component(this,n==null?void 0:n.componentType,o,n==null?void 0:n.mode);break;case GrammarMarkType.text:l=new Text(this,e,o);break;default:l=Factory.hasMark(e)?Factory.createMark(e,this,o):new Mark(this,e,o)}return this.grammars.record(l),this._dataflow.add(l),l}group(e){return this.mark(GrammarMarkType.group,e)}glyph(e,i){return this.mark(GrammarMarkType.glyph,i,{glyphType:e})}component(e,i,n="2d"){return this.mark(GrammarMarkType.component,i,{componentType:e,mode:n})}axis(e,i="2d"){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.axis,mode:i})}grid(e,i="2d"){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.grid,mode:i})}legend(e){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.legend})}slider(e){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.slider})}label(e){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.label})}datazoom(e){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.datazoom})}player(e){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.player})}title(e){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.title})}scrollbar(e){return this.mark(GrammarMarkType.component,e,{componentType:ComponentEnum.scrollbar})}customized(e,i){const n=Factory.createGrammar(e,this,i==null?void 0:i.type);if(n)return n.parse(i),this.grammars.record(n),this._dataflow.add(n),n}addGrammar(e){return this.grammars.find(i=>i.uid===e.uid)||(this.grammars.record(e),this._dataflow.add(e),e.parse(e.getSpec()),this._needBuildLayoutTree=!0),this}removeGrammar(e){const i=isString(e)?this.getGrammarById(e):e;return i&&this.grammars.find(n=>n.uid===i.uid)?(i.grammarType==="mark"&&i.prepareRelease(),this._cachedGrammars.record(i),this._dataflow.remove(i),this.grammars.unrecord(i),this._needBuildLayoutTree=!0,this):this}removeAllGrammars(){return this.grammars.traverse(e=>{e.grammarType==="signal"&&BuiltInSignalID.includes(e.id())||e.grammarType==="mark"&&e.id()==="root"||this.removeGrammar(e)}),this}removeAllGraphicItems(){return this.traverseMarkTree(e=>{e.graphicItem&&(removeGraphicItem(e.graphicItem),e.elementMap.forEach(i=>{i.resetGraphicItem()}),e.graphicItem=null)}),this}parseSpec(e){var i,n,o,l,u,d,f,g;if(this.emit(HOOK_EVENT.BEFORE_PARSE_VIEW),this._spec=e,normalizeMarkTree(e),e.theme?this.theme(e.theme):this.theme(ThemeManager.getDefaultTheme()),e.width&&this.width(e.width),e.height&&this.height(e.height),this.padding((n=(i=e.padding)!==null&&i!==void 0?i:this._options.padding)!==null&&n!==void 0?n:this._theme.padding),!this.width()||!this.height()){const y=this._getContainerSize();y&&(this.updateSignal(SIGNAL_WIDTH,y.width),this.updateSignal(SIGNAL_HEIGHT,y.height))}!((o=e.signals)===null||o===void 0)&&o.length&&e.signals.forEach(y=>{this.signal().parse(y)}),!((l=e.data)===null||l===void 0)&&l.length&&e.data.forEach(y=>{this.data(null).parse(y)}),!((u=e.coordinates)===null||u===void 0)&&u.length&&e.coordinates.forEach(y=>{var b;(b=this.coordinate(y.type))===null||b===void 0||b.parse(y)}),!((d=e.scales)===null||d===void 0)&&d.length&&e.scales.forEach(y=>{var b;(b=this.scale(y.type))===null||b===void 0||b.parse(y)});const _=Factory.getGrammars();return Object.keys(_).forEach(y=>{const{specKey:b}=_[y];e[b]&&e[b].length&&e[b].forEach(S=>{this.customized(y,S)})}),e.marks&&e.marks.length&&e.marks.forEach(y=>{this.parseMarkSpec(y)}),e.events&&e.events.length&&e.events.forEach(y=>{var b;(b=this.event)===null||b===void 0||b.call(this,y)}),e.interactions&&e.interactions.length&&e.interactions.forEach(y=>{this.interaction(y.type,y)}),e.animation===!1?(f=this.animate)===null||f===void 0||f.disable():(g=this.animate)===null||g===void 0||g.enable(),this.emit(HOOK_EVENT.AFTER_PARSE_VIEW),this._needBuildLayoutTree=!0,this._layoutState=LayoutState.before,this}updateSpec(e){return this.removeAllInteractions(),this.removeAllGrammars(),this.parseSpec(e)}parseBuiltIn(){builtInSignals(this._options,this._config,this.getCurrentTheme()).forEach(e=>{const i=this.signal().parse(e);e.value&&i.set(e.value)}),this.parseMarkSpec({id:"root",type:"group",encode:{enter:{x:0,y:0},update:{width:{signal:"width"},height:{signal:"height"}}}}),this.rootMark=this.getMarkById("root")}parseMarkSpec(e){var i;const n=e.type===GrammarMarkType.glyph?{glyphType:e.glyphType}:e.type===GrammarMarkType.component?{componentType:e.componentType,mode:e.mode}:null;this.mark(e.type,e.group,n).parse(e),(i=e.marks)===null||i===void 0||i.forEach(o=>{this.parseMarkSpec(o)})}theme(e){var i,n,o,l,u,d;isString(e)?this._theme=(i=ThemeManager.getTheme(e))!==null&&i!==void 0?i:ThemeManager.getDefaultTheme():this._theme=e;const{background:f,padding:g}=(n=this._spec)!==null&&n!==void 0?n:{};return this._theme?(this.background((o=f??this._options.background)!==null&&o!==void 0?o:this._theme.background),this.padding((l=g??this._options.padding)!==null&&l!==void 0?l:this._theme.padding),(d=(u=this.renderer.stage())===null||u===void 0?void 0:u.setTheme)===null||d===void 0||d.call(u,Object.assign({},this._theme.marks))):(this.background(f??this._options.background),this.padding(g??this._options.padding)),this}getCurrentTheme(){return this._theme}setCurrentTheme(e,i=!0){return this.theme(e),this.grammars.getAllMarks().forEach(n=>{n.commit()}),i?(this.evaluate(),this.renderer.render(!0)):this._dataflow.evaluate(),this}background(e){return arguments.length?(this._background=e,this.renderer.background(e),e):this._background}width(e){const i=this.getSignalById(SIGNAL_WIDTH);return arguments.length?(this._options.width=e,this.updateSignal(i,e),e):i.output()}height(e){const i=this.getSignalById(SIGNAL_HEIGHT);return arguments.length?(this._options.height=e,this.updateSignal(i,e),e):i.output()}viewWidth(e){const i=this.getSignalById(SIGNAL_VIEW_WIDTH);if(arguments.length){const n=this.padding();return this.width(e+n.left+n.right),e}return i.output()}viewHeight(e){const i=this.getSignalById(SIGNAL_VIEW_HEIGHT);if(arguments.length){const n=this.padding();return this.height(e+n.top+n.bottom),e}return i.output()}padding(e){const i=this.getSignalById(SIGNAL_PADDING);if(arguments.length){const n=normalizePadding(e);return this.updateSignal(i,n),n}return normalizePadding(i.output())}autoFit(e){const i=this.getSignalById(SIGNAL_AUTOFIT);return arguments.length?(this.updateSignal(i,e),e):i.output()}getViewBox(){const e=this.getSignalById(SIGNAL_VIEW_BOX);return e==null?void 0:e.output()}updateLayoutTag(){return this._layoutState=LayoutState.before,this}getLayoutState(){return this._layoutState}buildLayoutTree(){const e={},i=[];this.traverseMarkTree(n=>{e[n.id()]=!0,n.group&&e[n.group.id()]||i.push(n),n.markType===GrammarMarkType.group&&n.updateLayoutChildren()},n=>n.needLayout()),this._layoutMarks=i}doLayout(){var e;const i=this._options.doLayout||Factory.getDefaultLayout();i&&(!((e=this._layoutMarks)===null||e===void 0)&&e.length)&&(this.emit(HOOK_EVENT.BEFORE_DO_LAYOUT),i(this._layoutMarks,this._options,this),this.emit(HOOK_EVENT.AFTER_DO_LAYOUT))}handleLayoutEnd(){this.emit(HOOK_EVENT.BEFORE_MARK_LAYOUT_END),this._layoutMarks.forEach(e=>{traverseMarkTree(e,"layoutChildren",i=>{i.handleLayoutEnd()},i=>i!==e)}),this.emit(HOOK_EVENT.AFTER_MARK_LAYOUT_END)}handleRenderEnd(){this.emit(HOOK_EVENT.BEFORE_MARK_RENDER_END),traverseMarkTree(this.rootMark,"children",e=>{e.handleRenderEnd()}),this.emit(HOOK_EVENT.AFTER_MARK_RENDER_END)}commit(e){return this._dataflow.commit(e),this}run(e){return this.evaluate(e),this}doRender(e){this.emit(HOOK_EVENT.BEFORE_DO_RENDER),this.renderer&&(!this._progressiveMarks&&this.animate?this.animate.animate():this.traverseMarkTree(i=>{i.cleanExitElements()},null,!0),this.renderer.render(e),this.handleRenderEnd()),this.emit(HOOK_EVENT.AFTER_DO_RENDER)}evaluate(e){var i,n;const o=normalizeRunningConfig(e),l=this._cachedGrammars.size()>0;l&&(this.reuseCachedGrammars(o),this.detachCachedGrammar());const u=this._resizeRenderer(),d=this._dataflow.hasCommitted();return l||d||this._layoutState||u?(this.clearProgressive(),this._dataflow.evaluate(),this._needBuildLayoutTree&&(this.buildLayoutTree(),this._needBuildLayoutTree=!1),this._layoutState&&(this._layoutState=LayoutState.layouting,this.doLayout(),this._dataflow.hasCommitted()&&(this._layoutState=LayoutState.reevaluate,this._dataflow.evaluate()),this._layoutState=LayoutState.after,!((i=this._layoutMarks)===null||i===void 0)&&i.length&&this.handleLayoutEnd()),this._layoutState=null,this.findProgressiveMarks(),this._resizeRenderer(),(n=this.morph)===null||n===void 0||n.call(this,o),this.releaseCachedGrammars(o),this.doRender(!0),this.doPreProgressive(),this):this}reuseCachedGrammars(e){if(e.reuse){const i=n=>{n.next.reuse(n.prev),n.prev.detachAll(),n.prev.clear(),this._cachedGrammars.unrecord(n.prev)};this._differ.diffGrammar(this._cachedGrammars.getAllSignals(),this.grammars.getAllSignals().filter(n=>!BuiltInSignalID.includes(n.id()))).update.forEach(i),this._differ.diffGrammar(this._cachedGrammars.getAllData(),this.grammars.getAllData()).update.forEach(i),this._differ.diffGrammar(this._cachedGrammars.getAllScales(),this.grammars.getAllScales()).update.forEach(i),this._differ.diffGrammar(this._cachedGrammars.getAllCoordinates(),this.grammars.getAllCoordinates()).update.forEach(i)}this._differ.diffMark(this._cachedGrammars.getAllMarks(),this.grammars.getAllMarks().filter(i=>i.id()!=="root"),e).update.forEach(i=>{var n;const o=i.prev.length===1&&i.next.length===1&&i.prev[0].markType===i.next[0].markType,l=i.prev.every(u=>u.getMorphConfig().morph)&&i.next.every(u=>u.getMorphConfig().morph);this.morph&&(e.morph&&l||e.morphAll)?(n=this.addMorphMarks)===null||n===void 0||n.call(this,{prev:i.prev,next:i.next}):o&&e.reuse&&(i.next[0].reuse(i.prev[0]),i.prev[0].detachAll(),i.prev[0].clear(),this._cachedGrammars.unrecord(i.prev[0]))})}detachCachedGrammar(){this._cachedGrammars.traverse(e=>{var i,n;if(e.detachAll(),e.grammarType==="mark"){const o=e;(n=(i=o.group)===null||i===void 0?void 0:i.removeChild)===null||n===void 0||n.call(i,o)}})}releaseCachedGrammars(e){this._cachedGrammars.traverse(o=>{o.grammarType!=="mark"&&o.release()});const i=this._cachedGrammars.getAllMarkNodes();i.forEach(o=>{var l;(l=o.mark.animate)===null||l===void 0||l.stop(),e.enableExitAnimation&&this.animate&&this.animate.animateAddition(o.mark)});const n=o=>{if(o.mark.view&&(!o.mark.animate||o.mark.animate.getAnimatorCount()===0)&&(!o.children||o.children.length===0)){o.mark.release();const l=o.parent;l&&(o.parent.children=o.parent.children.filter(u=>u!==o),o.parent=null,n(l))}};i.forEach(o=>{const l=o.mark;l.animate&&l.animate.getAnimatorCount()!==0?l.addEventListener("animationEnd",()=>{l.animate&&l.animate.getAnimatorCount()===0&&n(o)}):n(o)}),this._cachedGrammars.clear()}runAfter(e){return this._dataflow.runAfter(()=>{e.call(null,this)}),this}runBefore(e){return this._dataflow.runBefore(()=>{e.call(null,this)}),this}getImageBuffer(){var e,i;if(this._options.mode!=="node")return void this.logger.error(new TypeError("getImageBuffer() now only support node environment."));const n=(i=(e=this.renderer)===null||e===void 0?void 0:e.stage)===null||i===void 0?void 0:i.call(e);return n?(n.render(),n.window.getImageBuffer()):(this.logger.error(new ReferenceError("render is not defined")),null)}traverseMarkTree(e,i,n){return traverseMarkTree(this.rootMark,"children",e,i,n),this}_bindResizeEvent(){var e,i,n,o,l,u;if(this.autoFit()){const d=(l=(o=(n=(i=(e=this.renderer)===null||e===void 0?void 0:e.stage)===null||i===void 0?void 0:i.call(e))===null||n===void 0?void 0:n.window)===null||o===void 0?void 0:o.getContainer)===null||l===void 0?void 0:l.call(o);if(d){const f=window.ResizeObserver;this._observer=new f(this._onResize),(u=this._observer)===null||u===void 0||u.observe(d)}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this.autoFit()&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}_getContainerSize(){var e,i,n,o,l,u,d,f,g,_,y;const b=(l=(o=(n=(i=(e=this.renderer)===null||e===void 0?void 0:e.stage)===null||i===void 0?void 0:i.call(e))===null||n===void 0?void 0:n.window)===null||o===void 0?void 0:o.getContainer)===null||l===void 0?void 0:l.call(o);if(b){const{width:S,height:v}=getContainerSize(b);return{width:(f=(d=(u=this._spec)===null||u===void 0?void 0:u.width)!==null&&d!==void 0?d:this._options.width)!==null&&f!==void 0?f:S,height:(y=(_=(g=this._spec)===null||g===void 0?void 0:g.height)!==null&&_!==void 0?_:this._options.height)!==null&&y!==void 0?y:v}}return null}resize(e,i,n=!0){let o=!1;return e!==this.width()&&(o=!0,this.updateSignal(SIGNAL_WIDTH,e)),i!==this.height()&&(o=!0,this.updateSignal(SIGNAL_HEIGHT,i)),o&&(n?this.evaluate({morph:!1}):this._dataflow.evaluate()),this}_resizeRenderer(){const e=this.width(),i=this.height();return!!this.renderer.shouldResize(e,i)&&(this.renderer.resize(e,i),this.emit("resize",{},{width:e,height:i}),!0)}interaction(e,i){const n=Factory.createInteraction(e,this,i);return n&&(n.bind(),this._boundInteractions||(this._boundInteractions=[]),this._boundInteractions.push(n)),n}removeInteraction(e,i){if(this._boundInteractions){const n=this._boundInteractions.filter(o=>{var l;return isNil(i)?isString(e)?o.type===e:e?o===e:void 0:((l=o.options)===null||l===void 0?void 0:l.id)===i});n.length&&n.forEach(o=>{o.unbind()})}return this}removeAllInteractions(){return this._boundInteractions&&(this._boundInteractions.forEach(e=>{e.unbind()}),this._boundInteractions=null),this}initializeEventConfig(e){const i=Object.assign({defaults:{}},e),n=(o,l)=>{l.forEach(u=>{isArray(o[u])&&(o[u]=o[u].reduce((d,f)=>(d[f]=!0,d),{}))})};return n(i.defaults,["prevent","allow"]),n(i,[EVENT_SOURCE_VIEW,EVENT_SOURCE_WINDOW]),i}initEvent(){const e=this.renderer.stage();e&&e.on("*",this.delegateEvent)}releaseStageEvent(){const e=this.renderer.stage();e&&e.off("*",this.delegateEvent)}addEventListener(e,i,n){let o=i;return n&&n.trap===!1||(o=i,o.raw=i),n&&n.target&&(o.target=n.target),this.on(e,o),this}removeEventListener(e,i){return i?this.off(e,i):this.off(e),this}initializeRenderer(){const e=this._options.width,i=this._options.height;this.renderer=new CanvasRenderer(this),this.renderer.initialize(e,i,this._options,this._eventConfig).background(this._background)}initialize(){var e,i;this.grammars=new RecordedGrammars(n=>n.id(),(n,o)=>this.logger.warn(`Grammar id '${n}' has been occupied`,o)),this._cachedGrammars=new RecordedTreeGrammars(n=>n.id()),this._options.logger&&Logger.setInstance(this._options.logger),this.logger=Logger.getInstance((e=this._options.logLevel)!==null&&e!==void 0?e:0),this._dataflow=new Dataflow,this.animate=(i=this.initAnimate)===null||i===void 0?void 0:i.call(this,this),this._differ=new ViewDiff,this._options.hooks&&(Object.keys(this._options.hooks).forEach(n=>{this.on(n,this._options.hooks[n])}),this.hooks=this._options.hooks),this.container=null,this.renderer=null,this._eventListeners=[],this._eventConfig=this.initializeEventConfig(this._options.eventConfig),this._theme=this._options.disableTheme?null:ThemeManager.getDefaultTheme(),this.parseBuiltIn(),configureEnvironment(this._options),this.initializeRenderer(),this._eventConfig.disable||this.initEvent(),this._bindResizeEvent(),this._needBuildLayoutTree=!0,this._layoutState=LayoutState.before,this.theme(this._theme)}pauseProgressive(){return!1}resumeProgressive(){return!1}restartProgressive(){return!1}findProgressiveMarks(){const e=[];return this.traverseMarkTree(i=>{e.push(i)},i=>i.markType!==GrammarMarkType.group&&i.isProgressive()),e.length?(this._progressiveMarks=e,this.renderer&&this.renderer.combineIncrementalLayers(),e):(this._progressiveMarks=null,null)}doPreProgressive(){if(this._progressiveMarks&&this._progressiveMarks.some(e=>e.isDoingProgressive())){const e=vglobal.getRequestAnimationFrame();this._progressiveRafId=e(this.handleProgressiveFrame)}else this._progressiveMarks&&this.animate&&this._progressiveMarks.every(e=>e.canAnimateAfterProgressive())?this.animate.animate():this._progressiveMarks&&(this._progressiveMarks=null)}clearProgressive(){this._progressiveRafId&&vglobal.getCancelAnimationFrame()(this._progressiveRafId),this._progressiveMarks&&this._progressiveMarks.length&&(this._progressiveMarks.forEach(e=>{e.clearProgressive()}),this._progressiveMarks=null)}release(){var e,i,n,o;this.removeAllInteractions(),this.releaseStageEvent(),this._unBindResizeEvent(),this.clearProgressive(),Factory.unregisterRuntimeTransforms(),Logger.setInstance(null),(e=this.animate)===null||e===void 0||e.stop(),this.grammars.release(),this._cachedGrammars.release(),this._dataflow.release(),this._dataflow=null,(n=(i=this.renderer)===null||i===void 0?void 0:i.release)===null||n===void 0||n.call(i),this.renderer=null,this._boundInteractions=null,this.removeAllListeners(),(o=this._eventListeners)===null||o===void 0||o.forEach(l=>{l.source.removeEventListener(l.type,l.handler)}),this._eventListeners=null}}const registerArcGraphic=()=>{registerShadowRoot(),registerArc(),Factory.registerGraphic(GrammarMarkType.arc,createArc),registerArcDataLabel()},registerArc3dGraphic=()=>{registerShadowRoot(),registerArc3d(),Factory.registerGraphic(GrammarMarkType.arc3d,createArc3d)},registerPyramid3dGraphic=()=>{registerShadowRoot(),registerPyramid3d(),Factory.registerGraphic(GrammarMarkType.pyramid3d,createPyramid3d)},registerAreaGraphic=()=>{registerShadowRoot(),registerArea(),Factory.registerGraphic(GrammarMarkType.area,createArea),registerLineDataLabel(),registerSymbolDataLabel()},registerGroupGraphic=()=>{registerShadowRoot(),registerGroup(),Factory.registerGraphic(GrammarMarkType.group,createGroup)},registerImageGraphic=()=>{registerShadowRoot(),registerImage(),Factory.registerGraphic(GrammarMarkType.image,createImage)},registerLineGraphic=()=>{registerShadowRoot(),registerLine(),registerLineDataLabel(),registerSymbolDataLabel(),Factory.registerGraphic(GrammarMarkType.line,createLine)},registerPathGraphic=()=>{registerShadowRoot(),registerPath(),Factory.registerGraphic(GrammarMarkType.path,createPath)},registerRectGraphic=()=>{registerShadowRoot(),registerRect(),registerRectDataLabel(),Factory.registerGraphic(GrammarMarkType.rect,createRect)},registerRect3dGraphic=()=>{registerShadowRoot(),registerRect3d(),Factory.registerGraphic(GrammarMarkType.rect3d,createRect3d)},registerRuleGraphic=()=>{registerShadowRoot(),registerLine(),Factory.registerGraphic(GrammarMarkType.rule,createLine)},registerSymbolGraphic=()=>{registerShadowRoot(),registerSymbol(),registerSymbolDataLabel(),Factory.registerGraphic(GrammarMarkType.symbol,createSymbol)},registerTextGraphic=()=>{registerShadowRoot(),registerText(),registerRichtext(),Factory.registerGraphic(GrammarMarkType.text,createText)},registerPolygonGraphic=()=>{registerShadowRoot(),registerPolygon(),Factory.registerGraphic(GrammarMarkType.polygon,createPolygon)},registerRichTextGraphic=()=>{registerShadowRoot(),registerRichtext(),Factory.registerGraphic(GrammarMarkType.richtext,createRichText)},registerCellGraphic=()=>{registerShadowRoot(),registerSymbol(),registerSymbolDataLabel(),Factory.registerGraphic(GrammarMarkType.cell,createSymbol)},registerGlyphGraphic=()=>{registerShadowRoot(),registerGlyph(),Factory.registerGraphic(GrammarMarkType.glyph,createGlyph)};class GlyphElement extends Element$1{constructor(e){super(e),this.getStateAttrs=(i,n)=>{var o,l,u,d;const f=!isNil((o=this.runtimeStatesEncoder)===null||o===void 0?void 0:o[i]),g=f?Object.assign(Object.assign({},(l=this.mark.getSpec().encode)===null||l===void 0?void 0:l[i]),this.runtimeStatesEncoder[i]):(u=this.mark.getSpec().encode)===null||u===void 0?void 0:u[i],_={};if(!g)return _;if(isFunction(g))return _.attributes=g(this.getDatum(),this,i,n),_;if(!f&&(!((d=this.graphicItem.glyphStates)===null||d===void 0)&&d[i]))return this.graphicItem.glyphStates[i];if(g){const y=this.items[0],b=[Object.assign({},y,{nextAttrs:{}})];return invokeEncoderToItems(this,b,g,this.mark.parameters()),this.coordinateTransformEncode(b),_.attributes=b[0].nextAttrs,this.graphicItem.glyphStates?this.graphicItem.glyphStates[i]||(this.graphicItem.glyphStates[i]=_):this.graphicItem.glyphStates={[i]:_},_}return _},this.glyphMeta=this.mark.getGlyphMeta()}getGlyphGraphicItems(){return this.glyphGraphicItems}initGraphicItem(e={}){if(this.graphicItem)return;this.graphicItem=this.mark.addGraphicItem(e,this.groupKey),this.graphicItem[BridgeElementKey]=this,this.graphicItem.onBeforeAttributeUpdate=this._onGlyphAttributeUpdate(!1);const i=this.glyphMeta.getMarks();this.glyphGraphicItems={},this.graphicItem.getSubGraphic().forEach(n=>{const o=i[n.name];this.glyphGraphicItems[n.name]=n,n.onBeforeAttributeUpdate=l=>this.mark?transformAttributes(o,l,this,n.name):l}),this.clearGraphicAttributes()}useStates(e,i){if(!this.graphicItem)return!1;this.mark.emit(HOOK_EVENT.BEFORE_ELEMENT_STATE,{states:e},this),this.states=e.slice();const n=isBoolean(i)?i:this.hasStateAnimation();return this.graphicItem.glyphStateProxy=this.getStateAttrs,this.graphicItem.useStates(this.states,n),this.mark.emit(HOOK_EVENT.AFTER_ELEMENT_STATE,{states:e},this),!0}encodeGraphic(){this.coordinateTransformEncode(this.items);const e=this.transformElementItems(this.items,this.mark.markType),i=!this.graphicItem;this.graphicItem?(this.graphicItem.clearStates(),this.graphicItem.states={},this.graphicItem.stateProxy=null):this.initGraphicItem(),this.diffState===DiffState.enter||i?(this.graphicItem.onBeforeAttributeUpdate=this._onGlyphAttributeUpdate(!0),this.applyGraphicAttributes(e),this.graphicItem.onBeforeAttributeUpdate=this._onGlyphAttributeUpdate(!1)):this.applyGraphicAttributes(e),this.diffState!==DiffState.enter&&this.diffState!==DiffState.update||!this.states.length||(Object.values(this.glyphGraphicItems).forEach(n=>{n.states={}}),this.useStates(this.states)),this.items.map(n=>{n.nextAttrs={}})}encodeCustom(e){var i;let n={};const o=this.glyphMeta.getChannelEncoder(),l=this.glyphMeta.getFunctionEncoder();if(l&&(n=l.call(null,Object.assign({},(i=this.graphicItem)===null||i===void 0?void 0:i.attribute,e),this.getDatum(),this,this.mark.getGlyphConfig())),o){let u;Object.keys(o).forEach(d=>{var f;if(!isNil(e[d])){u||(u=Object.assign({},(f=this.graphicItem)===null||f===void 0?void 0:f.attribute,e));const g=o[d].call(null,d,e[d],u,this.getDatum(),this,this.mark.getGlyphConfig());Object.keys(g??{}).forEach(_=>{var y;n[_]=Object.assign((y=n[_])!==null&&y!==void 0?y:{},g[_])})}})}return n}encodeDefault(){const e={};if(this.glyphMeta.getDefaultEncoder()){const i=this.glyphMeta.getDefaultEncoder().call(null,this.getDatum(),this,this.mark.getGlyphConfig());Object.assign(e,i)}return e}_onGlyphAttributeUpdate(e=!1){return i=>{if(!this.mark)return i;const n=this.glyphMeta.getMarks(),o=transformAttributes(this.mark.getAttributeTransforms(),i,this),l=e?this.encodeDefault():null,u=this.encodeCustom(i);return Object.keys(n).forEach(d=>{const f=n[d],g=this.glyphGraphicItems[d],_=u==null?void 0:u[d],y=Object.assign({},_);if(e){const A=l==null?void 0:l[d];Object.keys(A??{}).forEach(x=>{has(this.items[0].nextAttrs,x)||has(y,x)||(y[x]=A[x])})}const b=Object.assign({},cloneTransformAttributes(f,i),y),S=this._generateGlyphItems(f,this.items,b);this.coordinateTransformEncode(S);const v=this.transformElementItems(S,f);this.applyGlyphGraphicAttributes(v,d,g),f===GrammarMarkType.shape&&(g.datum=S[0].datum)}),o}}_generateGlyphItems(e,i,n){const o=i.map(l=>Object.assign({},l,{nextAttrs:n}));return CollectionMarkType.includes(e)&&this.mark.getSpec().enableSegments&&o.forEach((l,u)=>{l.nextAttrs=Object.assign({},i[u].nextAttrs,n)}),o}getGraphicAttribute(e,i=!1,n){if(!this.graphicItem)return;const o=this.getPrevGraphicAttributes(n);return i&&has(o,e)?o[e]:(n?this.glyphGraphicItems[n]:this.graphicItem).attribute[e]}setGraphicAttribute(e,i,n=!0,o){if(!this.graphicItem)return;const l=o?this.glyphGraphicItems[o]:this.graphicItem,u=this.getFinalGraphicAttributes(o),d=this.getPrevGraphicAttributes(o);n&&(u[e]=i),has(d,e)||(d[e]=l.attribute[e]),l.setAttribute(e,i)}setGraphicAttributes(e,i=!0,n){if(!this.graphicItem)return;const o=n?this.glyphGraphicItems[n]:this.graphicItem,l=this.getFinalGraphicAttributes(n),u=this.getPrevGraphicAttributes(n);Object.keys(e).forEach(d=>{i&&(l[d]=e[d]),has(u,d)||(u[d]=o.attribute[d])}),o.setAttributes(e)}diffAttributes(e,i){const n={},o=this.getFinalGraphicAttributes(i);for(const l in e)has(o,l)&&isEqual(o[l],e[l])||(n[l]=e[l]);return n}applyGlyphGraphicAttributes(e,i,n){var o,l;if(this.mark.needAnimate()){const u=this.diffAttributes(e,i),d=(o=this.getPrevGraphicAttributes(i))!==null&&o!==void 0?o:{},f=(l=this.getFinalGraphicAttributes(i))!==null&&l!==void 0?l:{};Object.keys(u).forEach(g=>{d[g]=n.attribute[g],f[g]=u[g]}),this.setNextGraphicAttributes(u,i),this.setPrevGraphicAttributes(d,i),this.setFinalGraphicAttributes(f,i),n.setAttributes(u)}else n.setAttributes(e)}getFinalGraphicAttributes(e){return(e?this.glyphGraphicItems[e]:this.graphicItem).finalAttrs}setFinalGraphicAttributes(e,i){(i?this.glyphGraphicItems[i]:this.graphicItem).finalAttrs=e}getPrevGraphicAttributes(e){return(e?this.glyphGraphicItems[e]:this.graphicItem).prevAttrs}setPrevGraphicAttributes(e,i){(i?this.glyphGraphicItems[i]:this.graphicItem).prevAttrs=e}getNextGraphicAttributes(e){return(e?this.glyphGraphicItems[e]:this.graphicItem).nextAttrs}setNextGraphicAttributes(e,i){(i?this.glyphGraphicItems[i]:this.graphicItem).nextAttrs=e}clearChangedGraphicAttributes(){this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null),Object.keys(this.glyphGraphicItems).forEach(e=>{this.setPrevGraphicAttributes(null,e),this.setNextGraphicAttributes(null,e)})}clearGraphicAttributes(){this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null),this.setFinalGraphicAttributes(null),Object.keys(this.glyphGraphicItems).forEach(e=>{this.setPrevGraphicAttributes(null,e),this.setNextGraphicAttributes(null,e),this.setFinalGraphicAttributes(null,e)})}remove(){this.glyphGraphicItems=null,super.remove()}release(){this.glyphGraphicItems&&(Object.values(this.glyphGraphicItems).forEach(e=>{e[BridgeElementKey]=null}),this.glyphGraphicItems=null),super.release()}}class GlyphMark extends Mark{constructor(e,i,n){super(e,GrammarMarkType.glyph,n),this.glyphType=i,this.glyphMeta=Factory.getGlyph(i)}configureGlyph(e){return this.spec.glyphConfig=e,this.commit(),this}getGlyphMeta(){return this.glyphMeta}getGlyphConfig(){return this.spec.glyphConfig}addGraphicItem(e,i){const n=createGlyphGraphicItem(this,this.glyphMeta,e);return super.addGraphicItem(e,i,n)}createElement(){return new GlyphElement(this)}}GlyphMark.markType=GrammarMarkType.glyph;const registerGlyphMark=()=>{Factory.registerMark(GrammarMarkType.glyph,GlyphMark)},scaleIn$1=r=>(e,i,n)=>{var o,l,u;const d=(u=(o=e.getGraphicAttribute("direction",!1))!==null&&o!==void 0?o:(l=e.mark.getGlyphConfig())===null||l===void 0?void 0:l.direction)!==null&&u!==void 0?u:"vertical",f=r(e,d,i);if(!isValidNumber(f))return{};const g=e.getGraphicAttribute("x",!1),_=e.getGraphicAttribute("y",!1),y=e.getGraphicAttribute("min",!1),b=e.getGraphicAttribute("max",!1),S=e.getGraphicAttribute("q1",!1),v=e.getGraphicAttribute("q3",!1),A=e.getGraphicAttribute("median",!1),x={from:{x:g,y:_},to:{x:g,y:_}};return isValidNumber(y)&&(x.from.min=f,x.to.min=y),isValidNumber(b)&&(x.from.max=f,x.to.max=b),isValidNumber(S)&&(x.from.q1=f,x.to.q1=S),isValidNumber(v)&&(x.from.q3=f,x.to.q3=v),isValidNumber(A)&&(x.from.median=f,x.to.median=A),x},scaleOut$1=r=>(e,i,n)=>{var o,l,u;const d=(u=(o=e.getGraphicAttribute("direction",!1))!==null&&o!==void 0?o:(l=e.mark.getGlyphConfig())===null||l===void 0?void 0:l.direction)!==null&&u!==void 0?u:"vertical",f=r(e,d,i);if(!isValidNumber(f))return{};const g=e.getGraphicAttribute("x",!0),_=e.getGraphicAttribute("y",!0),y=e.getGraphicAttribute("min",!0),b=e.getGraphicAttribute("max",!0),S=e.getGraphicAttribute("q1",!0),v=e.getGraphicAttribute("q3",!0),A=e.getGraphicAttribute("median",!0),x={from:{x:g,y:_},to:{x:g,y:_}};return isValidNumber(y)&&(x.to.min=f,x.from.min=y),isValidNumber(b)&&(x.to.max=f,x.from.max=b),isValidNumber(S)&&(x.to.q1=f,x.from.q1=S),isValidNumber(v)&&(x.to.q3=f,x.from.q3=v),isValidNumber(A)&&(x.to.median=f,x.from.median=A),x},computeBoxplotCenter=(r,e,i)=>{var n,o,l,u,d,f,g,_,y,b,S,v;if(i&&isValidNumber(i.center))return i.center;let A,x,T,C,E;if(isHorizontal$2(e)){A=(o=(n=r.getGraphicAttribute("points",!1,"median"))===null||n===void 0?void 0:n[0])===null||o===void 0?void 0:o.x,x=(u=(l=r.getGraphicAttribute("points",!1,"max"))===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.x,T=(f=(d=r.getGraphicAttribute("points",!1,"min"))===null||d===void 0?void 0:d[0])===null||f===void 0?void 0:f.x;const P=r.getGraphicAttribute("width",!1,"box"),L=r.getGraphicAttribute("x",!1,"box");C=L,E=L+P}else{A=(_=(g=r.getGraphicAttribute("points",!1,"median"))===null||g===void 0?void 0:g[0])===null||_===void 0?void 0:_.y,x=(b=(y=r.getGraphicAttribute("points",!1,"max"))===null||y===void 0?void 0:y[0])===null||b===void 0?void 0:b.y,T=(v=(S=r.getGraphicAttribute("points",!1,"min"))===null||S===void 0?void 0:S[0])===null||v===void 0?void 0:v.y;const P=r.getGraphicAttribute("height",!1,"box"),L=r.getGraphicAttribute("y",!1,"box");C=L,E=L+P}return isValidNumber(A)?A:isValidNumber(C)&&isValidNumber(E)?(C+E)/2:isValidNumber(x)&&isValidNumber(T)?(x+T)/2:isValidNumber(T)?T:isValidNumber(x)?x:NaN},encodeBoxplotSize=(r,e,i,n)=>{var o,l,u,d,f,g,_,y;const b={shaft:{},box:{},max:{},min:{},median:{}},S=(o=r.x)!==null&&o!==void 0?o:i.getGraphicAttribute("x",!1),v=(l=r.y)!==null&&l!==void 0?l:i.getGraphicAttribute("y",!1),A=(u=r.width)!==null&&u!==void 0?u:i.getGraphicAttribute("width",!1),x=(d=r.height)!==null&&d!==void 0?d:i.getGraphicAttribute("height",!1),T=(f=r.boxWidth)!==null&&f!==void 0?f:i.getGraphicAttribute("boxWidth",!1),C=(g=r.boxHeight)!==null&&g!==void 0?g:i.getGraphicAttribute("boxHeight",!1),E=(_=r.ruleWidth)!==null&&_!==void 0?_:i.getGraphicAttribute("ruleWidth",!1),P=(y=r.ruleHeight)!==null&&y!==void 0?y:i.getGraphicAttribute("ruleHeight",!1);return n&&isHorizontal$2(n.direction)?(isValidNumber(C)?(Object.assign(b.box,{y:v-C/2,y1:v+C/2}),Object.assign(b.median,{y:v-C/2,y1:v+C/2})):(Object.assign(b.box,{y:v-x/2,y1:v+x/2}),Object.assign(b.median,{y:v-x/2,y1:v+x/2})),isValidNumber(P)?(Object.assign(b.max,{y:v-P/2,y1:v+P/2}),Object.assign(b.min,{y:v-P/2,y1:v+P/2})):(Object.assign(b.max,{y:v-x/2,y1:v+x/2}),Object.assign(b.min,{y:v-x/2,y1:v+x/2}))):(isValidNumber(T)?(Object.assign(b.box,{x:S-T/2,x1:S+T/2}),Object.assign(b.median,{x:S-T/2,x1:S+T/2})):(Object.assign(b.box,{x:S-A/2,x1:S+A/2}),Object.assign(b.median,{x:S-A/2,x1:S+A/2})),isValidNumber(E)?(Object.assign(b.max,{x:S-E/2,x1:S+E/2}),Object.assign(b.min,{x:S-E/2,x1:S+E/2})):(Object.assign(b.max,{x:S-A/2,x1:S+A/2}),Object.assign(b.min,{x:S-A/2,x1:S+A/2}))),b},boxplotScaleIn=scaleIn$1(computeBoxplotCenter),boxplotScaleOut=scaleOut$1(computeBoxplotCenter);function registerBoxplotGlyph(){Factory.registerGlyph("boxplot",{shaft:"rule",box:"rect",max:"rule",min:"rule",median:"rule"}).registerProgressiveChannels(["x","y","q1","q3","min","max","median","angle","width","height","boxWidth","boxHeight","ruleWidth","ruleHeight"]).registerFunctionEncoder(encodeBoxplotSize).registerChannelEncoder("x",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?null:{shaft:{x:e,x1:e}}).registerChannelEncoder("y",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{shaft:{y:e,y1:e}}:null).registerChannelEncoder("q1",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{box:{x:e}}:{box:{y:e}}).registerChannelEncoder("q3",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{box:{x1:e}}:{box:{y1:e}}).registerChannelEncoder("min",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{shaft:{x:e},min:{x:e,x1:e,visible:!0}}:{shaft:{y:e},min:{y:e,y1:e,visible:!0}}).registerChannelEncoder("max",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{shaft:{x1:e},max:{x:e,x1:e,visible:!0}}:{shaft:{y1:e},max:{y:e,y1:e,visible:!0}}).registerChannelEncoder("median",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{median:{x:e,x1:e,visible:!0}}:{median:{y:e,y1:e,visible:!0}}).registerChannelEncoder("angle",(r,e,i,n,o,l)=>{var u;const d=l&&isHorizontal$2(l.direction)?[(i.min+i.max)/2,i.y]:[i.x,(i.min+i.max)/2],f=(u=i.anchor)!==null&&u!==void 0?u:d;return{shaft:{angle:e,anchor:f},box:{angle:e,anchor:f},max:{angle:e,anchor:f},min:{angle:e,anchor:f},median:{angle:e,anchor:f}}}).registerDefaultEncoder(()=>({max:{visible:!1},min:{visible:!1},median:{visible:!1}})),Factory.registerAnimationType("boxplotScaleIn",boxplotScaleIn),Factory.registerAnimationType("boxplotScaleOut",boxplotScaleOut),registerGlyphMark(),registerGlyphGraphic(),registerRectGraphic(),registerRuleGraphic()}const computeBarBoxplotCenter=(r,e,i)=>{var n,o,l,u;if(isValidNumber(i==null?void 0:i.center))return i.center;let d,f,g,_,y;if(isHorizontal$2(e)){d=(o=(n=r.getGraphicAttribute("points",!1,"median"))===null||n===void 0?void 0:n[0])===null||o===void 0?void 0:o.x;const b=r.getGraphicAttribute("width",!1,"minMaxBox"),S=r.getGraphicAttribute("x",!1,"minMaxBox");g=S,f=S+b;const v=r.getGraphicAttribute("width",!1,"q1q3Box"),A=r.getGraphicAttribute("x",!1,"q1q3Box");_=A,y=A+v}else{d=(u=(l=r.getGraphicAttribute("points",!1,"median"))===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.y;const b=r.getGraphicAttribute("height",!1,"minMaxBox"),S=r.getGraphicAttribute("y",!1,"minMaxBox");g=S,f=S+b;const v=r.getGraphicAttribute("height",!1,"q1q3Box"),A=r.getGraphicAttribute("y",!1,"q1q3Box");_=A,y=A+v}return isValidNumber(d)?d:isValidNumber(_)&&isValidNumber(y)?(_+y)/2:isValidNumber(f)&&isValidNumber(g)?(f+g)/2:isValidNumber(g)?g:isValidNumber(f)?f:NaN},encodeBarBoxplotSize=(r,e,i,n)=>{var o,l,u,d,f,g,_,y;const b={minMaxBox:{},q1q3Box:{},median:{}},S=(o=r.x)!==null&&o!==void 0?o:i.getGraphicAttribute("x",!1),v=(l=r.y)!==null&&l!==void 0?l:i.getGraphicAttribute("y",!1),A=(u=r.width)!==null&&u!==void 0?u:i.getGraphicAttribute("width",!1),x=(d=r.minMaxWidth)!==null&&d!==void 0?d:i.getGraphicAttribute("minMaxWidth",!1),T=(f=r.q1q3Width)!==null&&f!==void 0?f:i.getGraphicAttribute("q1q3Width",!1),C=(g=r.height)!==null&&g!==void 0?g:i.getGraphicAttribute("height",!1),E=(_=r.minMaxHeight)!==null&&_!==void 0?_:i.getGraphicAttribute("minMaxHeight",!1),P=(y=r.q1q3Height)!==null&&y!==void 0?y:i.getGraphicAttribute("q1q3Height",!1);return n&&isHorizontal$2(n.direction)?(isValidNumber(E)?Object.assign(b.minMaxBox,{y:v-E/2,y1:v+E/2}):Object.assign(b.minMaxBox,{y:v-C/2,y1:v+C/2}),isValidNumber(P)?(Object.assign(b.q1q3Box,{y:v-P/2,y1:v+P/2}),Object.assign(b.median,{y:v-P/2,y1:v+P/2})):(Object.assign(b.q1q3Box,{y:v-C/2,y1:v+C/2}),Object.assign(b.median,{y:v-C/2,y1:v+C/2}))):(isValidNumber(x)?Object.assign(b.minMaxBox,{x:S-x/2,x1:S+x/2}):Object.assign(b.minMaxBox,{x:S-A/2,x1:S+A/2}),isValidNumber(T)?(Object.assign(b.q1q3Box,{x:S-T/2,x1:S+T/2}),Object.assign(b.median,{x:S-T/2,x1:S+T/2})):(Object.assign(b.q1q3Box,{x:S-A/2,x1:S+A/2}),Object.assign(b.median,{x:S-A/2,x1:S+A/2}))),b},barBoxplotScaleIn=scaleIn$1(computeBarBoxplotCenter),barBoxplotScaleOut=scaleOut$1(computeBarBoxplotCenter);function registerBarBoxplotGlyph(){Factory.registerGlyph("barBoxplot",{minMaxBox:"rect",q1q3Box:"rect",median:"rule"}).registerProgressiveChannels(["x","y","q1","q3","min","max","median","angle","width","height","minMaxWidth","q1q3Width","minMaxHeight","q1q3Height"]).registerFunctionEncoder(encodeBarBoxplotSize).registerChannelEncoder("q1",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{q1q3Box:{x:e}}:{q1q3Box:{y:e}}).registerChannelEncoder("q3",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{q1q3Box:{x1:e}}:{q1q3Box:{y1:e}}).registerChannelEncoder("min",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{minMaxBox:{x:e}}:{minMaxBox:{y:e}}).registerChannelEncoder("max",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{minMaxBox:{x1:e}}:{minMaxBox:{y1:e}}).registerChannelEncoder("median",(r,e,i,n,o,l)=>l&&isHorizontal$2(l.direction)?{median:{x:e,x1:e,visible:!0}}:{median:{y:e,y1:e,visible:!0}}).registerChannelEncoder("angle",(r,e,i,n,o,l)=>{var u;const d=(u=i.anchor)!==null&&u!==void 0?u:[i.x,(i.min+i.max)/2];return{minMaxBox:{angle:e,anchor:d},q1q3Box:{angle:e,anchor:d},median:{angle:e,anchor:d}}}).registerChannelEncoder("lineWidth",(r,e,i,n,o,l)=>({minMaxBox:{lineWidth:0},q1q3Box:{lineWidth:0}})).registerChannelEncoder("minMaxFillOpacity",(r,e,i,n,o,l)=>({minMaxBox:{fillOpacity:e}})).registerChannelEncoder("stroke",(r,e,i,n,o,l)=>({minMaxBox:{stroke:!1},q1q3Box:{stroke:!1}})).registerDefaultEncoder(()=>({minMaxBox:{lineWidth:0},q1q3Box:{lineWidth:0},median:{visible:!1}})),Factory.registerAnimationType("barBoxplotScaleIn",barBoxplotScaleIn),Factory.registerAnimationType("barBoxplotScaleOut",barBoxplotScaleOut),registerGlyphMark(),registerGlyphGraphic(),registerRectGraphic(),registerRuleGraphic()}const registerRippleGlyph=()=>{Factory.registerGlyph("ripplePoint",{symbol:"symbol",ripple0:"symbol",ripple1:"symbol",ripple2:"symbol"}).registerFunctionEncoder((r,e,i,n)=>{var o;const l=Math.max(0,Math.min(r.ripple,1)),u=(o=r.size)!==null&&o!==void 0?o:i.getGraphicAttribute("size"),d=.5*u;return{ripple0:{size:u+d*l,fillOpacity:.75-.25*l},ripple1:{size:u+d*(1+l),fillOpacity:.5-.25*l},ripple2:{size:u+d*(2+l),fillOpacity:.25-.25*l}}}).registerDefaultEncoder(()=>({ripple0:{fillOpacity:.75},ripple1:{fillOpacity:.5},ripple2:{fillOpacity:.25}})),registerGlyphMark(),registerGlyphGraphic(),registerSymbolGraphic()},getHorizontalPath=(r,e)=>{var i;const n=(i=r.curvature)!==null&&i!==void 0?i:.5,o=typeof e=="number"?r.thickness*e:r.thickness;let l=r.x0,u=r.x1,d=r.y0,f=r.y1,g=l+n*(u-l),_=u+n*(l-u),y=T=>T;r.round!==!1&&(l=Math.round(l),u=Math.round(u),d=Math.round(d),f=Math.round(f),g=Math.round(g),_=Math.round(_),y=Math.round),r.pathType==="line"||r.pathType,r.align==="center"?(d=y(r.y0-o/2),f=y(r.y1-o/2)):r.align==="end"?(d=y(r.y0+r.thickness/2-o),f=y(r.y1+r.thickness/2-o)):(d=y(r.y0-r.thickness/2),f=y(r.y1-r.thickness/2));const b=y(d+o),S=y(f+o),v=Math.abs(u-l)>1e-6,A=r.endArrow&&v?`L${u},${y(f-o/2)}L${y(u+o)},${y((f+S)/2)}L${u},${y(S+o/2)}`:"",x=r.startArrow&&v?`L${l},${y(b+o/2)}L${y(l-o)},${y((d+b)/2)}L${l},${y(d-o/2)}`:"";return r.pathType==="line"?`M${l},${d}L${u},${f}${A}L${u},${S}L${l},${b}${x}Z`:r.pathType==="polyline"?`M${l},${d}L${g},${d}L${g},${f}L${u},${f}
    ${A}L${u},${S}L${g},${S}L${g},${b}L${l},${b}${x}Z`:`M${l},${d}C${g},${d},${_},${f},${u},${f}
  ${A}L${u},${S}C${_},${S},${g},${b},${l},${b}${x}Z`},getVerticalPath=(r,e)=>{var i;const n=(i=r.curvature)!==null&&i!==void 0?i:.5,o=typeof e=="number"?r.thickness*e:r.thickness;let l=r.y0,u=r.y1,d=r.x0,f=r.x1,g=l+n*(u-l),_=u+n*(l-u),y=T=>T;r.round!==!1&&(y=Math.round,l=Math.round(l),u=Math.round(u),d=Math.round(d),f=Math.round(f),g=Math.round(g),_=Math.round(_)),r.pathType==="line"||r.pathType,r.align==="center"?(d=y(r.x0-o/2),f=y(r.x1-o/2)):r.align==="end"?(d=y(r.x0+r.thickness/2-o),f=y(r.x1+r.thickness/2-o)):(d=y(r.x0-r.thickness/2),f=y(r.x1-r.thickness/2));const b=y(d+o),S=y(f+o),v=Math.abs(u-l)>1e-6,A=r.endArrow&&v?`L${y(f-o/2)},${u}L${y((f+S)/2)},${y(u+o)}L${y(S+o/2)},${u}`:"",x=r.startArrow&&v?`L${y(b+o/2)},${l}L${y((b+d)/2)},${y(l-o)}L${y(d-o/2)},${l}`:"";return r.pathType==="line"?`M${d},${l}L${f},${u}${A}L${S},${u}L${b},${l}${x}Z`:r.pathType==="polyline"?`M${d},${l}L${d},${g}L${f},${g}L${f},${u}
    ${A}L${S},${u}L${S},${g}L${b},${g}L${b},${l}${x}Z`:`M${d},${l}C${d},${g},${f},${_},${f},${u}
  ${A}L${S},${u}C${S},${_},${b},${g},${b},${l}${x}Z`},encoder=(r,e,i,n)=>{var o;const l=(o=r.direction)!==null&&o!==void 0?o:n==null?void 0:n.direction,u=["vertical","TB","BT"].includes(l)?getVerticalPath:getHorizontalPath,d=typeof r.ratio=="number"&&r.ratio>=0&&r.ratio<=1,f=Object.keys(r);return["x0","y0","x1","y1"].every(g=>f.includes(g))?{back:{path:d?u(r,1):""},front:{path:u(r,d?r.ratio:1)}}:{}},linkPathGrowIn=(r,e,i)=>{const n={x0:r.getGraphicAttribute("x0",!1),x1:r.getGraphicAttribute("x1",!1),y0:r.getGraphicAttribute("y0",!1),y1:r.getGraphicAttribute("y1",!1),thickness:r.getGraphicAttribute("thickness",!1),round:r.getGraphicAttribute("round",!1),align:r.getGraphicAttribute("align",!1),pathType:r.getGraphicAttribute("pathType",!1),endArrow:r.getGraphicAttribute("endArrow",!1),startArrow:r.getGraphicAttribute("startArrow",!1)};return Object.keys(n).forEach(o=>{isNil(n[o])&&delete n[o]}),{from:Object.assign({},n,{x1:n.x0,y1:n.y0}),to:n}},linkPathGrowOut=(r,e,i)=>{const n={x0:r.getGraphicAttribute("x0",!0),x1:r.getGraphicAttribute("x1",!0),y0:r.getGraphicAttribute("y0",!0),y1:r.getGraphicAttribute("y1",!0),thickness:r.getGraphicAttribute("thickness",!0),round:r.getGraphicAttribute("round",!0),align:r.getGraphicAttribute("align",!0),pathType:r.getGraphicAttribute("pathType",!0),endArrow:r.getGraphicAttribute("endArrow",!0),startArrow:r.getGraphicAttribute("startArrow",!0)};return Object.keys(n).forEach(o=>{isNil(n[o])&&delete n[o]}),{from:n,to:Object.assign({},n,{x1:n.x0,y1:n.y0})}},linkPathUpdate=(r,e,i)=>{const n={thickness:r.getGraphicAttribute("thickness",!1),round:r.getGraphicAttribute("round",!1),align:r.getGraphicAttribute("align",!1),pathType:r.getGraphicAttribute("pathType",!1),endArrow:r.getGraphicAttribute("endArrow",!1),startArrow:r.getGraphicAttribute("startArrow",!1)};return Object.keys(n).forEach(o=>{isNil(n[o])&&delete n[o]}),{from:Object.assign(Object.assign({x0:r.getGraphicAttribute("x0",!0),x1:r.getGraphicAttribute("x1",!0),y0:r.getGraphicAttribute("y0",!0),y1:r.getGraphicAttribute("y1",!0)},n),n),to:Object.assign({x0:r.getGraphicAttribute("x0",!1),x1:r.getGraphicAttribute("x1",!1),y0:r.getGraphicAttribute("y0",!1),y1:r.getGraphicAttribute("y1",!1)},n)}},registerLinkPathGlyph=()=>{Factory.registerGlyph("linkPath",{back:"path",front:"path"}).registerFunctionEncoder(encoder).registerChannelEncoder("backgroundStyle",(r,e)=>({back:e})).registerDefaultEncoder(()=>({back:{zIndex:0},front:{zIndex:1}})),Factory.registerAnimationType("linkPathGrowIn",linkPathGrowIn),Factory.registerAnimationType("linkPathGrowOut",linkPathGrowOut),Factory.registerAnimationType("linkPathUpdate",linkPathUpdate),registerGlyphMark(),registerGlyphGraphic(),registerPathGraphic()};class ScaleComponent extends Component{parseAddition(e){return super.parseAddition(e),this.scale(e.scale),this}scale(e){if(this.spec.scale){const n=isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this.detach(n),this.spec.scale=void 0}const i=isString(e)?this.view.getScaleById(e):e;return this.spec.scale=i,this.attach(i),this._updateComponentEncoders(),this.commit(),this}getScale(){return isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale}}const generateLineAxisAttributes=(r,e,i,n)=>{var o,l,u,d;const f=(l=(o=e==null?void 0:e.components)===null||o===void 0?void 0:o.axis)!==null&&l!==void 0?l:{};if(!r)return merge$1({},f,i??{});const g=[((d=(u=r.tickData)===null||u===void 0?void 0:u.call(r,n))!==null&&d!==void 0?d:[]).map(_=>({id:_.index,label:_.tick,value:_.value,rawValue:_.tick}))];return merge$1({},f,{items:g},i??{})},generateCircleAxisAttributes=(r,e,i,n)=>{var o,l,u,d;const f=(l=(o=e==null?void 0:e.components)===null||o===void 0?void 0:o.circleAxis)!==null&&l!==void 0?l:{};if(!r)return merge$1({},f,i??{});const g=[((d=(u=r.tickData)===null||u===void 0?void 0:u.call(r,n))!==null&&d!==void 0?d:[]).map(_=>({id:_.index,label:_.tick,value:_.value,rawValue:_.tick}))];return merge$1({},f,{items:g},i??{})},generateCoordinateAxisAttribute=(r,e,i,n,o,l)=>{var u;const d=r.getCoordinateAxisPosition();o&&o.position==="auto"&&(o.position=i?"content":d);const f=r.getCoordinateAxisPoints(n);if(f){const y={start:f[0],end:f[1],verticalFactor:(d==="top"||d==="left"?-1:1)*(i?-1:1)*(!((u=r.getSpec().range)===null||u===void 0)&&u.reversed?-1:1)};if(l&&e.type==="polar"){const b=e.angle();y.center=e.origin(),y.startAngle=b[0],y.endAngle=b[1]}return y}const g=e.radius(),_=e.angle();return{center:e.origin(),radius:g[1],innerRadius:g[0],inside:i,startAngle:_[0],endAngle:_[1]}};class Axis extends ScaleComponent{constructor(e,i,n){super(e,ComponentEnum.axis,i),this.spec.componentType=ComponentEnum.axis,this.mode=n}parseAddition(e){return super.parseAddition(e),this.axisType(e.axisType),this.tickCount(e.tickCount),this.inside(e.inside),this.baseValue(e.baseValue),this}scale(e){return super.scale(e),this._axisComponentType=null,this}axisType(e){return this.spec.axisType=e,this._axisComponentType=null,this._prepareRejoin(),this.commit(),this}addGraphicItem(e,i){const n=merge$1({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},e),o=Factory.createGraphicComponent(this._getAxisComponentType(),n,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(n,i,o)}tickCount(e){const i=isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return i&&i.tickCount(e),this.setFunctionSpec(e,"tickCount")}inside(e){return this.setFunctionSpec(e,"inside")}baseValue(e){return this.setFunctionSpec(e,"baseValue")}getAxisComponentType(){return this._axisComponentType}_updateComponentEncoders(){const e=isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale,i=Object.assign({update:{}},this.spec.encode),n=Object.keys(i).reduce((o,l)=>{const u=i[l];return u&&(o[l]={callback:(d,f,g)=>{var _,y;const b=this.spec.skipTheme?null:this.view.getCurrentTheme();let S=invokeEncoder(u,d,f,g);const v=invokeFunctionType(this.spec.inside,g,d,f),A=invokeFunctionType(this.spec.baseValue,g,d,f),x=(_=e==null?void 0:e.getCoordinate)===null||_===void 0?void 0:_.call(e);x&&(S=Object.assign(generateCoordinateAxisAttribute(e,x,v,A,this.spec.layout),S));const T=(y=e==null?void 0:e.getScale)===null||y===void 0?void 0:y.call(e),C=invokeFunctionType(this.spec.tickCount,g,d,f);switch(this._getAxisComponentType()){case AxisEnum.lineAxis:return generateLineAxisAttributes(T,b,S,C);case AxisEnum.circleAxis:return generateCircleAxisAttributes(T,b,S,C)}return S}}),o},{});this._encoders=n}_getAxisComponentType(){var e;if(this._axisComponentType)return this._axisComponentType;let i=this.spec.axisType;if(isNil(i)){const n=isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;i=!((e=n==null?void 0:n.getCoordinate)===null||e===void 0)&&e.call(n)?n.getCoordinateAxisPoints()?"line":"circle":"line"}return this._axisComponentType=i==="circle"?AxisEnum.circleAxis:AxisEnum.lineAxis,this._axisComponentType}}Axis.componentType=ComponentEnum.axis;const registerLineAxis=()=>{Factory.registerGraphicComponent(AxisEnum.lineAxis,(r,e)=>new LineAxis(r,e)),Factory.registerComponent(ComponentEnum.axis,Axis)},registerCircleAxis=()=>{Factory.registerGraphicComponent(AxisEnum.circleAxis,r=>new CircleAxis(r)),Factory.registerComponent(ComponentEnum.axis,Axis)};var __rest$j=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const generateLabelAttributes=(r,e,i,n,o,l={})=>{var u;const d=(u=l.components)===null||u===void 0?void 0:u.dataLabel,f=r.map((_,y)=>{var b,S,v,A,x;const T=Object.assign(Object.assign({},o),{labelIndex:y}),C=(b=invokeFunctionType(n,T,_))!==null&&b!==void 0?b:{},{components:E={}}=l;let P={};switch(_.markType){case GrammarMarkType.line:case GrammarMarkType.area:P=C.type==="line"?E.lineLabel:C.type==="area"?E.areaLabel:E.lineDataLabel;break;case GrammarMarkType.rect:case GrammarMarkType.rect3d:case GrammarMarkType.interval:P=E.rectLabel;break;case GrammarMarkType.symbol:case GrammarMarkType.circle:case GrammarMarkType.cell:P=E.symbolLabel;break;case GrammarMarkType.arc:case GrammarMarkType.arc3d:P=E.arcLabel;break;case GrammarMarkType.polygon:case GrammarMarkType.path:default:P=E.pointLabel}const L=(S=C.data)!==null&&S!==void 0?S:[],R=(A=(v=P==null?void 0:P.data)===null||v===void 0?void 0:v[0])!==null&&A!==void 0?A:{};if(L&&L.length>0)L.forEach((I,O)=>{if(_.elements[O]){const B=invokeEncoder(i,I,_.elements[O],T);merge$1(I,R,B)}});else{const I=(O,B)=>{const{data:N}=O,$=__rest$j(O,["data"]);return Object.assign(Object.assign({},merge$1({},B,$)),{data:N})};_.elements.forEach(O=>{if(O.getGraphicItem().releaseStatus!=="willRelease")if(_.isCollectionMark())O.getDatum().forEach(B=>{const N=invokeEncoder(i,B,O,T);L.push(I(N,R))});else{const B=invokeEncoder(i,O.getDatum(),O,T);L.push(I(B,R))}})}const w=(x=_.graphicItem)===null||x===void 0?void 0:x.name,D=merge$1({},P,{baseMarkGroupName:w,getBaseMarks:()=>_.elements.map(I=>I.getGraphicItem())},C??{});return D.data=L??P.data,D}).filter(_=>!isNil(_)),g=merge$1({},d,{size:e});return g.dataLabels=f,g};let Label$1=class extends Component{constructor(e,i){super(e,ComponentEnum.label,i),this.spec.componentType=ComponentEnum.label}parseAddition(e){return super.parseAddition(e),this.labelStyle(e.labelStyle),this.size(e.size),this.target(e.target),this}labelStyle(e){return this.setFunctionSpec(e,"labelStyle")}size(e){return this.setFunctionSpec(e,"size")}target(e){if(this.spec.target){const i=array(this.spec.target).map(n=>isString(n)?this.view.getMarkById(n):n);this.detach(i)}if(this.spec.target=e,e){const i=array(e).map(n=>isString(n)?this.view.getMarkById(n):n);this.attach(i)}return this.commit(),this}_updateComponentEncoders(){const e=Object.assign({update:{}},this.spec.encode),i=Object.keys(e).reduce((n,o)=>{const l=e[o];return l&&(n[o]={callback:(u,d,f)=>{var g,_,y,b;const S=array(this.spec.target).map(T=>isString(T)?this.view.getMarkById(T):T),v=(_=(g=this.group)===null||g===void 0?void 0:g.getGroupGraphicItem)===null||_===void 0?void 0:_.call(g);let A=invokeFunctionType(this.spec.size,f);A||(A=v?{width:(y=v.attribute.width)!==null&&y!==void 0?y:v.AABBBounds.width(),height:(b=v.attribute.height)!==null&&b!==void 0?b:v.AABBBounds.height()}:{width:1/0,height:1/0});const x=this.spec.skipTheme?null:this.view.getCurrentTheme();return generateLabelAttributes(S,A,l,this.spec.labelStyle,f,x)}}),n},{});this._encoders=i}};Label$1.componentType=ComponentEnum.label;const registerLabel$1=()=>{Factory.registerGraphicComponent(ComponentEnum.label,r=>new DataLabel(r)),Factory.registerComponent(ComponentEnum.label,Label$1)},generateLineAxisGridAttributes=(r,e,i,n)=>{var o,l,u,d;const f=(l=(o=e==null?void 0:e.components)===null||o===void 0?void 0:o.grid)!==null&&l!==void 0?l:{};if(!r)return merge$1({},f,i??{});const g=((d=(u=r.tickData)===null||u===void 0?void 0:u.call(r,n))!==null&&d!==void 0?d:[]).map(_=>({id:_.index,label:_.tick,value:_.value,rawValue:_.tick}));return merge$1({},f,{items:g},i??{})},generateCircleAxisGridAttributes=(r,e,i,n)=>{var o,l,u,d;const f=(l=(o=e==null?void 0:e.components)===null||o===void 0?void 0:o.circleGrid)!==null&&l!==void 0?l:{};if(!r)return merge$1({},f,i??{});const g=((d=(u=r.tickData)===null||u===void 0?void 0:u.call(r,n))!==null&&d!==void 0?d:[]).map(_=>({id:_.index,label:_.tick,value:_.value,rawValue:_.tick}));return merge$1({},f,{items:g},i??{})};class Grid extends ScaleComponent{constructor(e,i,n){super(e,ComponentEnum.grid,i),this.spec.componentType=ComponentEnum.grid,this.mode=n}parseAddition(e){return super.parseAddition(e),this.target(e.target),this.gridType(e.gridType),this.gridShape(e.gridShape),this}scale(e){return super.scale(e),this._gridComponentType=null,this}gridType(e){return this.spec.gridType=e,this._gridComponentType=null,this._prepareRejoin(),this.commit(),this}gridShape(e){return this.spec.gridShape=e,this.commit(),this}target(e){if(this.spec.target){const n=isString(this.spec.target)?this.view.getMarkById(this.spec.target):this.spec.target;this.detach(n)}this.spec.target=e;const i=isString(e)?this.view.getMarkById(e):e;return this.attach(i),this._targetAxis=i,this._gridComponentType=null,this._updateComponentEncoders(),this.commit(),this}tickCount(e){const i=isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return i&&i.tickCount(e),this.setFunctionSpec(e,"tickCount")}inside(e){return this.setFunctionSpec(e,"inside")}baseValue(e){return this.setFunctionSpec(e,"baseValue")}addGraphicItem(e,i){const n=merge$1({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},e),o=Factory.createGraphicComponent(this._getGridComponentType(),n,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(n,i,o)}_updateComponentEncoders(){const e=Object.assign({update:{}},this.spec.encode),i=Object.keys(e).reduce((n,o)=>{const l=e[o];return l&&(n[o]={callback:(u,d,f)=>{var g,_,y,b;const S=this.spec.skipTheme?null:this.view.getCurrentTheme();let v,A=invokeEncoder(l,u,d,f);const x=invokeFunctionType(this.spec.baseValue,f,u,d);if(this._targetAxis){const E=(g=this._targetAxis.getSpec())===null||g===void 0?void 0:g.scale;v=isString(E)?this.view.getScaleById(E):E;const P=this._targetAxis.elements[0];if(P)switch(this._getGridComponentType()){case GridEnum.lineAxisGrid:A=Object.assign({x:P.getGraphicAttribute("x"),y:P.getGraphicAttribute("y"),start:P.getGraphicAttribute("start"),end:P.getGraphicAttribute("end"),verticalFactor:(_=P.getGraphicAttribute("verticalFactor"))!==null&&_!==void 0?_:1},A);break;case GridEnum.circleAxisGrid:A=Object.assign({x:P.getGraphicAttribute("x"),y:P.getGraphicAttribute("y"),center:P.getGraphicAttribute("center"),radius:P.getGraphicAttribute("radius"),innerRadius:P.getGraphicAttribute("innerRadius"),inside:P.getGraphicAttribute("inside"),startAngle:P.getGraphicAttribute("startAngle"),endAngle:P.getGraphicAttribute("endAngle")},A)}}else{v=isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;const E=invokeFunctionType(this.spec.inside,f,u,d),P=(y=v==null?void 0:v.getCoordinate)===null||y===void 0?void 0:y.call(v);P&&(A=Object.assign(generateCoordinateAxisAttribute(v,P,E,x,this.spec.layout,!0),A))}this._getGridComponentType()===GridEnum.lineAxisGrid&&(A=this.spec.gridShape!=="line"&&this.spec.gridShape?Object.assign({center:A.start,closed:!0},A,{type:this.spec.gridShape}):Object.assign({},A,{type:"line"}));const T=(b=v==null?void 0:v.getScale)===null||b===void 0?void 0:b.call(v),C=invokeFunctionType(this.spec.tickCount,f,u,d);switch(this._getGridComponentType()){case GridEnum.lineAxisGrid:return generateLineAxisGridAttributes(T,S,A,C);case GridEnum.circleAxisGrid:return generateCircleAxisGridAttributes(T,S,A,C)}return A}}),n},{});this._encoders=i}_getGridComponentType(){var e;if(this._gridComponentType)return this._gridComponentType;if(this.spec.gridType)this.spec.gridType==="circle"?this._gridComponentType=GridEnum.circleAxisGrid:this._gridComponentType=GridEnum.lineAxisGrid;else if(this._targetAxis)switch(this._targetAxis.getAxisComponentType()){case AxisEnum.circleAxis:this._gridComponentType=GridEnum.circleAxisGrid;break;case AxisEnum.lineAxis:default:this._gridComponentType=GridEnum.lineAxisGrid}else if(this.spec.scale){const i=isString(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this._gridComponentType=!((e=i==null?void 0:i.getCoordinate)===null||e===void 0)&&e.call(i)?i.getCoordinateAxisPoints()?GridEnum.lineAxisGrid:GridEnum.circleAxisGrid:GridEnum.lineAxisGrid}else this._gridComponentType=GridEnum.lineAxisGrid;return this._gridComponentType}}Grid.componentType=ComponentEnum.grid;const registerLineGrid=()=>{Factory.registerGraphicComponent(GridEnum.lineAxisGrid,(r,e)=>new LineAxisGrid(r,e)),Factory.registerComponent(ComponentEnum.grid,Grid)},registerCircleGrid=()=>{Factory.registerGraphicComponent(GridEnum.circleAxisGrid,(r,e)=>new CircleAxisGrid(r,e)),Factory.registerComponent(ComponentEnum.grid,Grid)},transform$7=(r,e,i)=>e.filter(n=>r.callback(n,i)),transform$6=(r,e,i)=>{const n=r.callback,o=r.as;if(!r.all)return e.forEach(u=>{const d=n(u,i);if(!isNil(o)){if(isNil(u))return;u[o]=d}return d}),e;const l=n(e,i);return isNil(o)||isNil(e)?l:(e[o]=l,e)};function sum(r){return r.reduce((e,i)=>e+i,0)}function average(r){return r.length===0?0:sum(r)/r.length}const samplerMap={min:minInArray,max:maxInArray,average,sum};function lttb(r,e,i,n){const o=Math.floor(e.length/r),l=[],u=e.length;let d,f,g,_=0,y=0;l[y++]=_;for(let b=1;b<u-1;b+=o){const S=Math.min(b+o,u-1),v=Math.min(b+2*o,u),A=(v+S)/2;let x=0;for(let L=S;L<v;L++){const R=e[L][n];Number.isNaN(R)||(x+=R)}x/=v-S;const T=b,C=Math.min(b+o,u),E=b-1,P=e[_][n];d=-1,g=T;for(let L=T;L<C;L++){const R=e[L][n];Number.isNaN(n)||(f=Math.abs((E-A)*(R-P)-(E-L)*(x-P)),f>d&&(d=f,g=L))}l[y++]=g,_=g}return l[y-1]!==u-1&&(l[y++]=u-1),l.map(b=>i?e[b].i:b)}function sample(r,e,i,n,o){let l=Math.floor(e.length/r);const u=[],d=e.length;let f=0,g=[];u.push(f),e[f][o]=e[f][o];for(let _=1;_<d-1;_+=l){l>d-_&&(l=d-_,g.length=l),g=[];for(let b=0;b<l;b++)g.push(e[_+b][o]);const y=samplerMap[n](g);f=Math.min(Math.round(_+g.length/2)||0,d-1),e[f][o]=y,u.push(f)}return u.map(_=>i?e[_].i:_)}function sampleMin(r,e,i,n){return sample(r,e,i,"min",n)}function sampleMax(r,e,i,n){return sample(r,e,i,"max",n)}function sampleAverage(r,e,i,n){return sample(r,e,i,"average",n)}function sampleSum(r,e,i,n){return sample(r,e,i,"sum",n)}const transform$5=(r,e)=>{let i=r.size;const n=r.factor||1;if(Array.isArray(i)&&(i=Math.floor(i[1]-i[0])),i*=n,i<=0)return[];if(e.length<=i)return e;if(r.skipfirst)return e.slice(0,1);const{mode:o,yfield:l,groupBy:u}=r,d=l??"y";let f=lttb;if(o==="min"?f=sampleMin:o==="max"?f=sampleMax:o==="average"?f=sampleAverage:o==="sum"&&(f=sampleSum),e.length){const g={};if(u){for(let y=0,b=e.length;y<b;y++){const S=e[y],v=S[u];g[v]?g[v].push({[d]:S[d],i:y}):(g[v]=[],g[v].push({[d]:S[d],i:y}))}let _=[];return Object.keys(g).forEach(y=>{const b=g[y];if(b.length<=i){const S=b.map(v=>v.i);_=_.concat(S)}else{const S=f(i,b,!0,d);_=_.concat(S),b.forEach(v=>e[v.i][d]=v[d])}}),_.sort((y,b)=>y-b),_.map(y=>e[y])}return f(i,e,!1,d).map(_=>e[_])}return[]};function reset(r){return r.forEach(e=>{e.getGraphicAttribute(MARK_OVERLAP_HIDE_KEY)&&(e.setGraphicAttribute("visible",!0),e.setGraphicAttribute(MARK_OVERLAP_HIDE_KEY,!1))}),r}function overlapX(r,e,i,n){if(n){let o=-1/0,l=0;const u=isNil(e);let d=e;r.forEach(f=>{if(f.getGraphicAttribute("visible")===!1)return;const g=f.getGraphicAttribute("size")/2,_=f.getGraphicAttribute("x");u&&(d=(g+l)*i),Math.abs(_-o)<d+l+g?f.getGraphicAttribute("forceShow")||(f.setGraphicAttribute(MARK_OVERLAP_HIDE_KEY,!0),f.setGraphicAttribute("visible",!1)):o=_,l=g})}}function overlapY(r,e,i,n){if(n){let o=-1/0,l=0;const u=isNil(e);let d=e;r.forEach(f=>{if(f.getGraphicAttribute("visible")===!1)return;const g=f.getGraphicAttribute("size")/2,_=f.getGraphicAttribute("y");u&&(d=(g+l)*i),Math.abs(_-o)<d+l+g?f.getGraphicAttribute("forceShow")||(f.setGraphicAttribute(MARK_OVERLAP_HIDE_KEY,!0),f.setGraphicAttribute("visible",!1)):o=_,l=g})}}function overlapXY(r,e,i,n){if(n){let l=-1/0,u=0,d=0;const f=isNil(e);let g=e;r.forEach(_=>{if(_.getGraphicAttribute("visible")===!1)return;const y=_.getGraphicAttribute("size")/2,b=_.getGraphicAttribute("x"),S=_.getGraphicAttribute("y");f&&(g=(y+u)*i),d=(-1/0-b)**2+(l-S)**2,d<(g+u+y)**2?_.getGraphicAttribute("forceShow")||(_.setGraphicAttribute(MARK_OVERLAP_HIDE_KEY,!0),_.setGraphicAttribute("visible",!1)):l=S,u=y})}}const transform$4=(r,e)=>{if(!e||e.length===0)return;let{radius:i}=r;isNil(i)&&e[0].mark.markType==="symbol"&&(i=!0);const{direction:n,delta:o,deltaMul:l=1,groupBy:u}=r,d=f=>{reset(f);const g=r.sort?f.slice().sort((_,y)=>_.getGraphicAttribute("x")-y.getGraphicAttribute("x")):f;n===0?overlapXY(g,o,l,i):n===1?overlapX(g,o,l,i):overlapY(g,o,l,i)};if(u){const f=e.reduce((g,_)=>{const y=_.getDatum()[u];return g[y]?g[y].push(_):g[y]=[_],g},{});Object.keys(f).forEach(g=>{d(f[g])})}else d(e);return e},registerFilterTransform=()=>{Factory.registerTransform("filter",{transform:transform$7,markPhase:"beforeJoin"},!0)},registerMapTransform=()=>{Factory.registerTransform("map",{transform:transform$6,markPhase:"beforeJoin"},!0)},registerSampleTransform=()=>{Factory.registerTransform("sampling",{transform:transform$5,markPhase:"afterEncode"},!0)},registerMarkOverlapTransform=()=>{Factory.registerTransform("markoverlap",{transform:transform$4,markPhase:"afterEncode"},!0)},clipIn=(r,e,i)=>{var n;const o=r.getGraphicAttribute("clipRangeByDimension",!1),l=(n=r.getGraphicAttribute("clipRange",!1))!==null&&n!==void 0?n:1;return e&&e.clipDimension?{from:{clipRange:0,clipRangeByDimension:e.clipDimension},to:{clipRange:l,clipRangeByDimension:o}}:{from:{clipRange:0},to:{clipRange:l}}},clipOut=(r,e,i)=>{var n;const o=r.getGraphicAttribute("clipRangeByDimension",!0),l=(n=r.getGraphicAttribute("clipRange",!0))!==null&&n!==void 0?n:1;return e&&e.clipDimension?{from:{clipRange:l,clipRangeByDimension:e.clipDimension},to:{clipRange:0,clipRangeByDimension:o}}:{from:{clipRange:l},to:{clipRange:0}}},fadeIn=(r,e,i)=>{var n,o,l,u;const d=(n=r.getFinalAnimationAttributes())!==null&&n!==void 0?n:{};return{from:{opacity:0,fillOpacity:0,strokeOpacity:0},to:{opacity:(o=d.opacity)!==null&&o!==void 0?o:1,fillOpacity:(l=d.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(u=d.strokeOpacity)!==null&&u!==void 0?u:1}}},fadeOut=(r,e,i)=>{var n,o,l;return{from:{opacity:(n=r.getGraphicAttribute("opacity",!0))!==null&&n!==void 0?n:1,fillOpacity:(o=r.getGraphicAttribute("fillOpacity",!0))!==null&&o!==void 0?o:1,strokeOpacity:(l=r.getGraphicAttribute("strokeOpacity",!0))!==null&&l!==void 0?l:1},to:{opacity:0,fillOpacity:0,strokeOpacity:0}}},growCenterIn=(r,e,i)=>{switch(e==null?void 0:e.direction){case"x":{const n=r.getFinalAnimationAttribute("x"),o=r.getFinalAnimationAttribute("x1"),l=r.getFinalAnimationAttribute("width");return{from:isValid(l)?{x:n+l/2,x1:void 0,width:0}:{x:(n+o)/2,x1:(n+o)/2,width:void 0},to:{x:n,x1:o,width:l}}}case"y":{const n=r.getFinalAnimationAttribute("y"),o=r.getFinalAnimationAttribute("y1"),l=r.getFinalAnimationAttribute("height");return{from:isValid(l)?{y:n+l/2,y1:void 0,height:0}:{y:(n+o)/2,y1:(n+o)/2,height:void 0},to:{y:n,y1:o,height:l}}}default:{const n=r.getFinalAnimationAttribute("x"),o=r.getFinalAnimationAttribute("x1"),l=r.getFinalAnimationAttribute("width"),u=r.getFinalAnimationAttribute("y"),d=r.getFinalAnimationAttribute("y1"),f=r.getFinalAnimationAttribute("height"),g={};return isValid(l)?(g.x=n+l/2,g.width=0,g.x1=void 0):(g.x=(n+o)/2,g.x1=(n+o)/2,g.width=void 0),isValid(f)?(g.y=u+f/2,g.height=0,g.y1=void 0):(g.y=(u+d)/2,g.y1=(u+d)/2,g.height=void 0),{from:g,to:{x:n,y:u,x1:o,y1:d,width:l,height:f}}}}},growCenterOut=(r,e,i)=>{switch(e==null?void 0:e.direction){case"x":{const n=r.getFinalAnimationAttribute("x"),o=r.getFinalAnimationAttribute("x1"),l=r.getFinalAnimationAttribute("width");return{to:isValid(l)?{x:n+l/2,x1:void 0,width:0}:{x:(n+o)/2,x1:(n+o)/2,width:void 0}}}case"y":{const n=r.getFinalAnimationAttribute("y"),o=r.getFinalAnimationAttribute("y1"),l=r.getFinalAnimationAttribute("height");return{to:isValid(l)?{y:n+l/2,y1:void 0,height:0}:{y:(n+o)/2,y1:(n+o)/2,height:void 0}}}default:{const n=r.getFinalAnimationAttribute("x"),o=r.getFinalAnimationAttribute("y"),l=r.getFinalAnimationAttribute("x1"),u=r.getFinalAnimationAttribute("y1"),d=r.getFinalAnimationAttribute("width"),f=r.getFinalAnimationAttribute("height"),g={};return isValid(d)?(g.x=n+d/2,g.width=0,g.x1=void 0):(g.x=(n+l)/2,g.x1=(n+l)/2,g.width=void 0),isValid(f)?(g.y=o+f/2,g.height=0,g.y1=void 0):(g.y=(o+u)/2,g.y1=(o+u)/2,g.height=void 0),{to:g}}}};function growWidthInIndividual(r,e,i){const n=r.getFinalAnimationAttribute("x"),o=r.getFinalAnimationAttribute("x1"),l=r.getFinalAnimationAttribute("width");if(e&&e.orient==="negative"){const d=isValid(l)?Math.max(n,n+l):Math.max(n,o);return{from:{x:d,x1:isNil(o)?void 0:d,width:isNil(l)?void 0:0},to:{x:n,x1:o,width:l}}}const u=isValid(l)?Math.min(n,n+l):Math.min(n,o);return{from:{x:u,x1:isNil(o)?void 0:u,width:isNil(l)?void 0:0},to:{x:n,x1:o,width:l}}}function growWidthInOverall(r,e,i){var n;const o=r.getFinalAnimationAttribute("x"),l=r.getFinalAnimationAttribute("x1"),u=r.getFinalAnimationAttribute("width");let d;return e&&e.orient==="negative"?isNumber(e.overall)?d=e.overall:i.group?(d=(n=i.groupWidth)!==null&&n!==void 0?n:i.group.getBounds().width(),i.groupWidth=d):d=i.width:d=isNumber(e==null?void 0:e.overall)?e==null?void 0:e.overall:0,{from:{x:d,x1:isNil(l)?void 0:d,width:isNil(u)?void 0:0},to:{x:o,x1:l,width:u}}}const growWidthIn=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growWidthInOverall(r,e,i):growWidthInIndividual(r,e)};function growWidthOutIndividual(r,e,i){const n=r.getFinalAnimationAttribute("x"),o=r.getFinalAnimationAttribute("x1"),l=r.getFinalAnimationAttribute("width");if(e&&e.orient==="negative"){const d=isValid(l)?Math.max(n,n+l):Math.max(n,o);return{to:{x:d,x1:isNil(o)?void 0:d,width:isNil(l)?void 0:0}}}const u=isValid(l)?Math.min(n,n+l):Math.min(n,o);return{to:{x:u,x1:isNil(o)?void 0:u,width:isNil(l)?void 0:0}}}function growWidthOutOverall(r,e,i){var n;const o=r.getFinalAnimationAttribute("x1"),l=r.getFinalAnimationAttribute("width");let u;return e&&e.orient==="negative"?isNumber(e.overall)?u=e.overall:i.group?(u=(n=i.groupWidth)!==null&&n!==void 0?n:i.group.getBounds().width(),i.groupWidth=u):u=i.width:u=isNumber(e==null?void 0:e.overall)?e.overall:0,{to:{x:u,x1:isNil(o)?void 0:u,width:isNil(l)?void 0:0}}}const growWidthOut=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growWidthOutOverall(r,e,i):growWidthOutIndividual(r,e)};function growHeightInIndividual(r,e,i){const n=r.getFinalAnimationAttribute("y"),o=r.getFinalAnimationAttribute("y1"),l=r.getFinalAnimationAttribute("height");if(e&&e.orient==="negative"){const d=isValid(l)?Math.max(n,n+l):Math.max(n,o);return{from:{y:d,y1:isNil(o)?void 0:d,height:isNil(l)?void 0:0},to:{y:n,y1:o,height:l}}}const u=isValid(l)?Math.min(n,n+l):Math.min(n,o);return{from:{y:u,y1:isNil(o)?void 0:u,height:isNil(l)?void 0:0},to:{y:n,y1:o,height:l}}}function growHeightInOverall(r,e,i){var n;const o=r.getFinalAnimationAttribute("y"),l=r.getFinalAnimationAttribute("y1"),u=r.getFinalAnimationAttribute("height");let d;return e&&e.orient==="negative"?isNumber(e.overall)?d=e.overall:i.group?(d=(n=i.groupHeight)!==null&&n!==void 0?n:i.group.getBounds().height(),i.groupHeight=d):d=i.height:d=isNumber(e==null?void 0:e.overall)?e.overall:0,{from:{y:d,y1:isNil(l)?void 0:d,height:isNil(u)?void 0:0},to:{y:o,y1:l,height:u}}}const growHeightIn=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growHeightInOverall(r,e,i):growHeightInIndividual(r,e)};function growHeightOutIndividual(r,e,i){const n=r.getFinalAnimationAttribute("y"),o=r.getFinalAnimationAttribute("y1"),l=r.getFinalAnimationAttribute("height");if(e&&e.orient==="negative"){const d=isValid(l)?Math.max(n,n+l):Math.max(n,o);return{to:{y:d,y1:isNil(o)?void 0:d,height:isNil(l)?void 0:0}}}const u=isValid(l)?Math.min(n,n+l):Math.min(n,o);return{to:{y:u,y1:isNil(o)?void 0:u,height:isNil(l)?void 0:0}}}function growHeightOutOverall(r,e,i){var n;const o=r.getFinalAnimationAttribute("y1"),l=r.getFinalAnimationAttribute("height");let u;return e&&e.orient==="negative"?isNumber(e.overall)?u=e.overall:i.group?(u=(n=i.groupHeight)!==null&&n!==void 0?n:i.group.getBounds().height(),i.groupHeight=u):u=i.height:u=isNumber(e==null?void 0:e.overall)?e.overall:0,{to:{y:u,y1:isNil(o)?void 0:u,height:isNil(l)?void 0:0}}}const growHeightOut=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growHeightOutOverall(r,e,i):growHeightOutIndividual(r,e)},growAngleInIndividual=(r,e,i)=>{const n=r.getFinalAnimationAttributes();return e&&e.orient==="anticlockwise"?{from:{startAngle:n==null?void 0:n.endAngle},to:{startAngle:n==null?void 0:n.startAngle}}:{from:{endAngle:n==null?void 0:n.startAngle},to:{endAngle:n==null?void 0:n.endAngle}}},growAngleInOverall=(r,e,i)=>{const n=r.getFinalAnimationAttributes();if(e&&e.orient==="anticlockwise"){const l=isNumber(e.overall)?e.overall:2*Math.PI;return{from:{startAngle:l,endAngle:l},to:{startAngle:n==null?void 0:n.startAngle,endAngle:n==null?void 0:n.endAngle}}}const o=isNumber(e==null?void 0:e.overall)?e.overall:0;return{from:{startAngle:o,endAngle:o},to:{startAngle:n==null?void 0:n.startAngle,endAngle:n==null?void 0:n.endAngle}}},growAngleIn=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growAngleInOverall(r,e):growAngleInIndividual(r,e)},growAngleOutIndividual=(r,e,i)=>{const n=r.getFinalAnimationAttributes();return e&&e.orient==="anticlockwise"?{from:{startAngle:r.getGraphicAttribute("startAngle",!0)},to:{startAngle:n==null?void 0:n.endAngle}}:{from:{endAngle:r.getGraphicAttribute("endAngle",!0)},to:{endAngle:n==null?void 0:n.startAngle}}},growAngleOutOverall=(r,e,i)=>{if(e&&e.orient==="anticlockwise"){const o=isNumber(e.overall)?e.overall:2*Math.PI;return{from:{startAngle:r.getGraphicAttribute("startAngle",!0),endAngle:r.getGraphicAttribute("endAngle",!0)},to:{startAngle:o,endAngle:o}}}const n=isNumber(e==null?void 0:e.overall)?e.overall:0;return{from:{startAngle:r.getGraphicAttribute("startAngle",!0),endAngle:r.getGraphicAttribute("endAngle",!0)},to:{startAngle:n,endAngle:n}}},growAngleOut=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growAngleOutOverall(r,e):growAngleOutIndividual(r,e)},growRadiusInIndividual=(r,e,i)=>{const n=r.getFinalAnimationAttributes();return e&&e.orient==="inside"?{from:{innerRadius:n==null?void 0:n.outerRadius},to:{innerRadius:n==null?void 0:n.innerRadius}}:{from:{outerRadius:n==null?void 0:n.innerRadius},to:{outerRadius:n==null?void 0:n.outerRadius}}},growRadiusInOverall=(r,e,i)=>{const n=r.getFinalAnimationAttributes(),o=isNumber(e==null?void 0:e.overall)?e.overall:0;return{from:{innerRadius:o,outerRadius:o},to:{innerRadius:n==null?void 0:n.innerRadius,outerRadius:n==null?void 0:n.outerRadius}}},growRadiusIn=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growRadiusInOverall(r,e):growRadiusInIndividual(r,e)},growRadiusOutIndividual=(r,e,i)=>{const n=r.getFinalAnimationAttributes();return e&&e.orient==="inside"?{from:{innerRadius:r.getGraphicAttribute("innerRadius",!0)},to:{innerRadius:n==null?void 0:n.outerRadius}}:{from:{outerRadius:r.getGraphicAttribute("outerRadius",!0)},to:{outerRadius:n==null?void 0:n.innerRadius}}},growRadiusOutOverall=(r,e,i)=>{const n=isNumber(e==null?void 0:e.overall)?e.overall:0;return{from:{innerRadius:r.getGraphicAttribute("innerRadius",!0),outerRadius:r.getGraphicAttribute("outerRadius",!0)},to:{innerRadius:n,outerRadius:n}}},growRadiusOut=(r,e,i)=>{var n;return((n=e==null?void 0:e.overall)!==null&&n!==void 0&&n)!==!1?growRadiusOutOverall(r,e):growRadiusOutIndividual(r,e)},getCenterPoints=(r,e,i)=>{const n=r.getGraphicAttribute("points",!1),o={x:0,y:0};return n.forEach(l=>{o.x+=l.x,o.y+=l.y}),o.x/=n.length,o.y/=n.length,e&&e.center&&(isValidNumber(e.center.x)&&(o.x=e.center.x),isValidNumber(e.center.y)&&(o.y=e.center.y)),r.mark.markType==="area"&&(o.x1=o.x,o.y1=o.y),n.map(l=>Object.assign({},l,o))},growPointsIn=(r,e,i)=>({from:{points:getCenterPoints(r,e)},to:{points:r.getGraphicAttribute("points",!1)}}),growPointsOut=(r,e,i)=>({from:{points:r.getGraphicAttribute("points",!0)},to:{points:getCenterPoints(r,e)}}),changePointsX=(r,e,i)=>r.getGraphicAttribute("points",!1).map(n=>{var o;if(e&&e.orient==="negative"){let l=i.width;return i.group&&(l=(o=i.groupWidth)!==null&&o!==void 0?o:i.group.getBounds().width(),i.groupWidth=l),Object.assign(Object.assign({},n),{x:l,y:n.y,x1:l,y1:n.y1,defined:n.defined!==!1})}return Object.assign(Object.assign({},n),{x:0,y:n.y,x1:0,y1:n.y1,defined:n.defined!==!1})}),growPointsXIn=(r,e,i)=>({from:{points:changePointsX(r,e,i)},to:{points:r.getGraphicAttribute("points",!1)}}),growPointsXOut=(r,e,i)=>({from:{points:r.getGraphicAttribute("points",!0)},to:{points:changePointsX(r,e,i)}}),changePointsY=(r,e,i)=>r.getGraphicAttribute("points",!1).map(n=>{var o;if(e&&e.orient==="negative"){let l=i.height;return i.group&&(l=(o=i.groupHeight)!==null&&o!==void 0?o:i.group.getBounds().height(),i.groupHeight=l),Object.assign(Object.assign({},n),{x:n.x,y:l,x1:n.x1,y1:l,defined:n.defined!==!1})}return Object.assign(Object.assign({},n),{x:n.x,y:0,x1:n.x1,y1:0,defined:n.defined!==!1})}),growPointsYIn=(r,e,i)=>({from:{points:changePointsY(r,e,i)},to:{points:r.getGraphicAttribute("points",!1)}}),growPointsYOut=(r,e,i)=>({from:{points:r.getGraphicAttribute("points",!0)},to:{points:changePointsY(r,e,i)}}),moveIn=(r,e,i)=>{var n,o;const{offset:l=0,orient:u,direction:d,point:f,excludeChannels:g=[]}=e??{};let _=0,y=0;u==="negative"&&(i.group?(_=(n=i.groupWidth)!==null&&n!==void 0?n:i.group.getBounds().width(),y=(o=i.groupHeight)!==null&&o!==void 0?o:i.group.getBounds().height(),i.groupWidth=_,i.groupHeight=y):(_=i.width,y=i.height)),_+=l,y+=l;const b=isFunction(f)?f.call(null,r.getDatum(),r,i):f,S=b&&isValidNumber(b.x)?b.x:_,v=b&&isValidNumber(b.y)?b.y:y,A=g.includes("x")?r.getGraphicAttribute("x"):r.getFinalAnimationAttribute("x"),x=g.includes("y")?r.getGraphicAttribute("y"):r.getFinalAnimationAttribute("y");switch(d){case"x":return{from:{x:S},to:{x:A}};case"y":return{from:{y:v},to:{y:x}};default:return{from:{x:S,y:v},to:{x:A,y:x}}}},moveOut=(r,e,i)=>{var n,o;const{offset:l=0,orient:u,direction:d,point:f}=e??{},g=i.group?i.group.getBounds():null,_=(n=g==null?void 0:g.width())!==null&&n!==void 0?n:i.width,y=(o=g==null?void 0:g.height())!==null&&o!==void 0?o:i.height,b=(u==="negative"?_:0)+l,S=(u==="negative"?y:0)+l,v=isFunction(f)?f.call(null,r.getDatum(),r,i):f,A=v&&isValidNumber(v.x)?v.x:b,x=v&&isValidNumber(v.y)?v.y:S;switch(d){case"x":return{from:{x:r.getGraphicAttribute("x",!0)},to:{x:A}};case"y":return{from:{y:r.getGraphicAttribute("y",!0)},to:{y:x}};default:return{from:{x:r.getGraphicAttribute("x",!0),y:r.getGraphicAttribute("y",!0)},to:{x:A,y:x}}}},scaleIn=(r,e,i)=>{var n,o,l,u;const d=r.getFinalAnimationAttributes();switch(e==null?void 0:e.direction){case"x":return{from:{scaleX:0},to:{scaleX:(n=d==null?void 0:d.scaleX)!==null&&n!==void 0?n:1}};case"y":return{from:{scaleY:0},to:{scaleY:(o=d==null?void 0:d.scaleY)!==null&&o!==void 0?o:1}};default:return{from:{scaleX:0,scaleY:0},to:{scaleX:(l=d==null?void 0:d.scaleX)!==null&&l!==void 0?l:1,scaleY:(u=d==null?void 0:d.scaleY)!==null&&u!==void 0?u:1}}}},scaleOut=(r,e,i)=>{var n,o,l,u;switch(e==null?void 0:e.direction){case"x":return{from:{scaleX:(n=r.getGraphicAttribute("scaleX",!0))!==null&&n!==void 0?n:1},to:{scaleX:0}};case"y":return{from:{scaleY:(o=r.getGraphicAttribute("scaleY",!0))!==null&&o!==void 0?o:1},to:{scaleY:0}};default:return{from:{scaleX:(l=r.getGraphicAttribute("scaleX",!0))!==null&&l!==void 0?l:1,scaleY:(u=r.getGraphicAttribute("scaleY",!0))!==null&&u!==void 0?u:1},to:{scaleX:0,scaleY:0}}}},BUILT_IN_EXCLUDE_CHANNELS={symbol:["_mo_hide_","visible"]},update=(r,e,i)=>{const n=Object.assign({},r.getPrevGraphicAttributes()),o=Object.assign({},r.getNextGraphicAttributes());let l;e&&array(e.excludeChannels).forEach(d=>{delete n[d],delete o[d]}),r.mark&&r.mark.markType&&(l=BUILT_IN_EXCLUDE_CHANNELS[r.mark.markType])&&l.forEach(d=>{delete n[d],delete o[d]}),Object.keys(o).forEach(d=>{isEqual(n[d],o[d])&&(delete n[d],delete o[d])});const u=r.getFinalGraphicAttributes();return Object.keys(n).forEach(d=>{isNil(o[d])&&(isNil(u[d])||isEqual(n[d],u[d])?delete n[d]:o[d]=u[d])}),{from:n,to:o}},rotateIn=(r,e,i)=>{var n;const o=(n=r.getFinalAnimationAttribute("angle"))!==null&&n!==void 0?n:0;let l=0;return l=isNumberClose(o/(2*Math.PI),0)?Math.round(o/(2*Math.PI))*Math.PI*2:isValidNumber(e==null?void 0:e.angle)?e.angle:(e==null?void 0:e.orient)==="anticlockwise"?Math.ceil(o/(2*Math.PI))*Math.PI*2:Math.floor(o/(2*Math.PI))*Math.PI*2,{from:{angle:l},to:{angle:o}}},rotateOut=(r,e,i)=>{var n;const o=(n=r.getGraphicAttribute("angle",!0))!==null&&n!==void 0?n:0;let l=0;return l=isNumberClose(o/(2*Math.PI),0)?Math.round(o/(2*Math.PI))*Math.PI*2:isValidNumber(e==null?void 0:e.angle)?e.angle:(e==null?void 0:e.orient)==="anticlockwise"?Math.ceil(o/(2*Math.PI))*Math.PI*2:Math.floor(o/(2*Math.PI))*Math.PI*2,{from:{angle:o},to:{angle:l}}},registerClipInAnimation=()=>{Factory.registerAnimationType("clipIn",clipIn)},registerClipOutAnimation=()=>{Factory.registerAnimationType("clipOut",clipOut)},registerFadeInAnimation=()=>{Factory.registerAnimationType("fadeIn",fadeIn)},registerFadeOutAnimation=()=>{Factory.registerAnimationType("fadeOut",fadeOut)},registerGrowCenterInAnimation=()=>{Factory.registerAnimationType("growCenterIn",growCenterIn)},registerGrowCenterOutAnimation=()=>{Factory.registerAnimationType("growCenterOut",growCenterOut)},registerGrowHeightInAnimation=()=>{Factory.registerAnimationType("growHeightIn",growHeightIn)},registerGrowHeightOutAnimation=()=>{Factory.registerAnimationType("growHeightOut",growHeightOut)},registerGrowWidthInAnimation=()=>{Factory.registerAnimationType("growWidthIn",growWidthIn)},registerGrowWidthOutAnimation=()=>{Factory.registerAnimationType("growWidthOut",growWidthOut)},registerGrowPointsInAnimation=()=>{Factory.registerAnimationType("growPointsIn",growPointsIn)},registerGrowPointsOutAnimation=()=>{Factory.registerAnimationType("growPointsOut",growPointsOut)},registerGrowPointsXInAnimation=()=>{Factory.registerAnimationType("growPointsXIn",growPointsXIn)},registerGrowPointsXOutAnimation=()=>{Factory.registerAnimationType("growPointsXOut",growPointsXOut)},registerGrowPointsYInAnimation=()=>{Factory.registerAnimationType("growPointsYIn",growPointsYIn)},registerGrowPointsYOutAnimation=()=>{Factory.registerAnimationType("growPointsYOut",growPointsYOut)},registerGrowAngleInAnimation=()=>{Factory.registerAnimationType("growAngleIn",growAngleIn)},registerGrowAngleOutAnimation=()=>{Factory.registerAnimationType("growAngleOut",growAngleOut)},registerGrowRadiusInAnimation=()=>{Factory.registerAnimationType("growRadiusIn",growRadiusIn)},registerGrowRadiusOutAnimation=()=>{Factory.registerAnimationType("growRadiusOut",growRadiusOut)},registerMoveInAnimation=()=>{Factory.registerAnimationType("moveIn",moveIn)},registerMoveOutAnimation=()=>{Factory.registerAnimationType("moveOut",moveOut)},registerScaleInAnimation=()=>{Factory.registerAnimationType("scaleIn",scaleIn)},registerScaleOutAnimation=()=>{Factory.registerAnimationType("scaleOut",scaleOut)},registerRotateInAnimation=()=>{Factory.registerAnimationType("rotateIn",rotateIn)},registerRotateOutAnimation=()=>{Factory.registerAnimationType("rotateOut",rotateOut)},registerUpdateAnimation=()=>{Factory.registerAnimationType("update",update)};class Cell extends Mark{encodeState(e,i,n){return super.encodeState(e,i,n),this._updateComponentEncoders(e),this}_updateComponentEncoders(e){this._encoders||(this._encoders={});const i=this.spec.encode[e];if(i&&e==="update"){const n=this.parameters(),o=isFunctionType(i)?null:Object.keys(i).reduce((l,u)=>(isScaleEncode(i[u])&&(l[u]=getGrammarOutput(i[u].scale,n)),l),{});this._encoders[e]={callback:(l,u,d)=>{const f=invokeEncoder(i,l,u,d);if(isNil(f.size)){const g=o.x?getBandWidthOfScale(o.x):void 0,_=o.y?getBandWidthOfScale(o.y):void 0;isNil(g)&&isNil(_)?f.size=10:isNil(g)?f.size=_:isNil(_)&&(f.size=g),f.size=[g,_]}return isNil(f.shape)&&(f.shape="rect"),f}}}else this._encoders[e]=i}_getEncoders(){var e;return(e=this._encoders)!==null&&e!==void 0?e:{}}getAttributeTransforms(){return[{channels:["size","padding"],transform:(e,i,n)=>{if(isNumber(n.padding)&&n.padding>0)e.size=isArray(n.size)?n.size.map(o=>Math.max(o-n.padding,1)):Math.max(n.size-n.padding,1);else if(isArray(n.padding)&&n.padding.length===2){const o=isArray(n.size)?n.size:[n.size,n.size];e.size=[Math.max(o[0]-n.padding[0],1),Math.max(o[1]-n.padding[1],1)]}else e.size=n.size},storedAttrs:"paddingAttrs"}].concat(transformsByType.symbol)}release(){super.release(),this._encoders=null}}Cell.markType=GrammarMarkType.cell;const registerCellMark$1=()=>{Factory.registerMark(GrammarMarkType.cell,Cell)};class ViewAnimate{constructor(e){this._animations=[],this._additionalAnimateMarks=[],this.isEnabled=!0,this._onAnimationStart=i=>{this._additionalAnimateMarks=this._additionalAnimateMarks.filter(n=>{var o;return(o=n==null?void 0:n.animate)===null||o===void 0?void 0:o.isAnimating()}),this._animations.length===0&&this._additionalAnimateMarks.length===0&&this._view.emit(HOOK_EVENT.ALL_ANIMATION_START,{}),this._animations=this._animations.concat({config:i.animationConfig,mark:i.mark})},this._onAnimationEnd=i=>{this._additionalAnimateMarks=this._additionalAnimateMarks.filter(n=>{var o;return(o=n==null?void 0:n.animate)===null||o===void 0?void 0:o.isAnimating()}),this._animations=this._animations.filter(n=>n.config!==i.animationConfig||n.mark!==i.mark),this._animations.length===0&&this._additionalAnimateMarks.length===0&&this._view.emit(HOOK_EVENT.ALL_ANIMATION_END,{})},this._view=e,this._view.addEventListener(HOOK_EVENT.ANIMATION_START,this._onAnimationStart),this._view.addEventListener(HOOK_EVENT.ANIMATION_END,this._onAnimationEnd)}stop(){return this._view.traverseMarkTree(e=>{var i,n;e.animate&&((n=(i=e.animate).stop)===null||n===void 0||n.call(i))}),this._additionalAnimateMarks.forEach(e=>{var i,n;e.view&&e.animate&&((n=(i=e.animate).stop)===null||n===void 0||n.call(i))}),this._additionalAnimateMarks=[],this}pause(){return this._view.traverseMarkTree(e=>{var i,n;e.animate&&((n=(i=e.animate).pause)===null||n===void 0||n.call(i))}),this._additionalAnimateMarks.forEach(e=>{var i,n;e.view&&e.animate&&((n=(i=e.animate).pause)===null||n===void 0||n.call(i))}),this}resume(){return this._view.traverseMarkTree(e=>{var i,n;e.animate&&((n=(i=e.animate).resume)===null||n===void 0||n.call(i))}),this._additionalAnimateMarks.forEach(e=>{var i,n;e.view&&e.animate&&((n=(i=e.animate).resume)===null||n===void 0||n.call(i))}),this}enable(){return this.isEnabled=!0,this._view.traverseMarkTree(e=>{var i,n;e.animate&&((n=(i=e.animate).enable)===null||n===void 0||n.call(i))}),this}disable(){return this.isEnabled=!1,this._view.traverseMarkTree(e=>{var i,n;e.animate&&((n=(i=e.animate).disable)===null||n===void 0||n.call(i))}),this._additionalAnimateMarks.forEach(e=>{var i,n;e.view&&e.animate&&((n=(i=e.animate).stop)===null||n===void 0||n.call(i))}),this._additionalAnimateMarks=[],this}enableAnimationState(e){return this._view.traverseMarkTree(i=>{var n,o;i.animate&&((o=(n=i.animate).enableAnimationState)===null||o===void 0||o.call(n,e))}),this}disableAnimationState(e){return this._view.traverseMarkTree(i=>{var n,o;i.animate&&((o=(n=i.animate).disableAnimationState)===null||o===void 0||o.call(n,e))}),this}isAnimating(){return this._animations.length!==0||this._additionalAnimateMarks.some(e=>{var i;return((i=e==null?void 0:e.animate)===null||i===void 0?void 0:i.isAnimating())||!1})}animate(){return this.isEnabled?(this._view.traverseMarkTree(e=>{e.isUpdated&&e.animate&&e.animate.animate(),e.cleanExitElements(),e.isUpdated=!1},null,!0),this):this}animateAddition(e){var i;const n=(i=e.animate)===null||i===void 0?void 0:i.animate();return n&&n.isAnimating()&&this._additionalAnimateMarks.push(e),this}release(){this._additionalAnimateMarks=[],this._animations=[],this._view.removeEventListener(HOOK_EVENT.ALL_ANIMATION_START,this._onAnimationStart),this._view.removeEventListener(HOOK_EVENT.ALL_ANIMATION_END,this._onAnimationEnd),this._view=null}}class ViewAnimateMixin{initAnimate(e){return this.animate=new ViewAnimate(e),this.animate}}const registerViewAnimateAPI=()=>{mixin(View,ViewAnimateMixin)},transformAnimationAttributes=(r,e)=>{if(!r)return null;if(r.from){const i=r.from,n=Object.keys(i);n.forEach(l=>{isNil(i[l])&&delete i[l]});const o=isValidPointsChannel(n,e.mark.markType)&&!isValid(i.segments);if(o){const l=e.items.map(u=>Object.assign({},u,{nextAttrs:Object.assign({},i)}));r.from=e.transformElementItems(l,e.mark.markType,o)}}if(r.to){const i=r.to,n=Object.keys(i);n.forEach(l=>{isNil(i[l])&&delete i[l]});const o=isValidPointsChannel(n,e.mark.markType)&&!isValid(i.segments);if(o){const l=e.items.map(u=>Object.assign({},u,{nextAttrs:Object.assign({},i)}));r.to=e.transformElementItems(l,e.mark.markType,o)}}return r};function typeAnimationAttributes(r,e,i,n){const o=isFunction(e.options)?e.options.call(null,r.getDatum(),r,n):e.options;if(!e.type||!Factory.getAnimationType(e.type))return null;const l=Factory.getAnimationType(e.type)(r,o,i);return transformAnimationAttributes(l,r)}const parseChannelValue=(r,e,i,n,o)=>isFunction(i)?i(r.getDatum(),r,o):i;function channelAnimationAttributes(r,e,i,n){const o=e.channel;let l=null;return isArray(o)?l=o.reduce((u,d)=>(u.from[d]=r.getGraphicAttribute(d,!0),u.to[d]=r.getGraphicAttribute(d,!1),u),{from:{},to:{}}):isObject$1(o)&&(l=Object.keys(o).reduce((u,d)=>{var f,g;const _=!isNil((f=o[d])===null||f===void 0?void 0:f.from),y=!isNil((g=o[d])===null||g===void 0?void 0:g.to);return(_||y)&&(u.from[d]=_?parseChannelValue(r,0,o[d].from,0,n):void 0,u.to[d]=y?parseChannelValue(r,0,o[d].to,0,n):r.getGraphicAttribute(d,!1)),u},{from:{},to:{}})),transformAnimationAttributes(l,r)}class CustomInterpolator extends ACustomAnimate{constructor(e,i,n,o,l){super(e,i,n,o,l),this._interpolator=l==null?void 0:l.interpolator,this._element=l==null?void 0:l.element}onBind(){var e,i;this.from=(e=this.from)!==null&&e!==void 0?e:{},this.to=(i=this.to)!==null&&i!==void 0?i:{}}getEndProps(){return this.to}onUpdate(e,i,n){this._interpolator&&this._element&&this._interpolator.call(this,i,this.from,this.to,n,this._element.getDatum(),this._element,this.params.parameters)}}class AttributeAnimate extends ACustomAnimate{getEndProps(){return this.to}onBind(){var e;const i=(e=this.target.constructor.NOWORK_ANIMATE_ATTR)!==null&&e!==void 0?e:NOWORK_ANIMATE_ATTR,n=Object.keys(i).filter(d=>i[d]!==0);this.subAnimate.animate.preventAttrs(n);const o=Object.assign({},this.from),l=Object.assign({},this.to),u=[];Object.keys(l).forEach(d=>{n.includes(d)?(o[d]=l[d],this.from[d]=l[d]):isNil(o[d])?o[d]=this.target.getComputedAttribute(d):u.push(d)}),this.target.animates.forEach(d=>{d!==this.subAnimate.animate&&d.preventAttrs(u)}),this._fromAttribute=o,this._toAttribute=l}onStart(){if(this._fromAttribute){const e={};Object.keys(this._fromAttribute).forEach(i=>{this.subAnimate.animate.validAttr(i)&&(e[i]=this._fromAttribute[i])}),this.target.setAttributes(e,!1,{type:AttributeUpdateType.ANIMATE_UPDATE,animationState:{ratio:0,end:!1}})}}onEnd(){if(this._toAttribute){const e={};Object.keys(this._toAttribute).forEach(i=>{this.subAnimate.animate.validAttr(i)&&(e[i]=this._toAttribute[i])}),this.target.setAttributes(e,!1,{type:AttributeUpdateType.ANIMATE_END})}}update(e,i,n){this.updateCount===0&&this.onFirstRun(),this.updateCount+=1;const o=this.step.getLastProps();Object.keys(o).forEach(l=>{this.subAnimate.animate.validAttr(l)&&(n[l]=o[l])}),this.onUpdate(e,i,n),e&&this.onEnd()}onUpdate(e,i,n){this.target.stepInterpolate(this.subAnimate,this.subAnimate.animate,n,this.step,i,e,this._toAttribute,this._fromAttribute)}}Animate$1.mode|=AnimateMode.SET_ATTR_IMMEDIATELY;let GlobalAnimatorId=0;const isCustomAnimateCtor=r=>{var e;if(isNil(r)||isNil(r.prototype))return!1;const i=(e=r.prototype)!==null&&e!==void 0?e:{};return i instanceof ACustomAnimate||"onBind"in i&&"onStart"in i&&"onEnd"in i&&"onUpdate"in i};class Animator{constructor(e,i,n){this.id=GlobalAnimatorId++,this.isAnimating=!1,this.runnings=[],this.element=e,this.animationOptions=n,this.unit=i}callback(e){return this.callbackFunction=e,this}animate(e,i){return this.isAnimating=!0,this.animateElement(e,i),this.runnings.length===0&&this.animationEnd(),this}stop(e,i=!0){return this.runnings.forEach(n=>n.stop(e)),this.animationEnd(i),this}pause(){return this.runnings.forEach(e=>e.pause()),this}resume(){return this.runnings.forEach(e=>e.resume()),this}startAt(e){return this.runnings.forEach(i=>{const n=this.unit.initialDelay;i.startAt(n+e)}),this}getTotalAnimationTime(){var e;const i=this.unit.initialDelay+this.unit.loopDuration*this.unit.loopCount;return(e=this.unit.totalTime)!==null&&e!==void 0?e:i}getEndAttributes(){return this.runnings.reduce((e,i)=>Object.assign(e,i.getEndProps()),{})}animationEnd(e=!0){var i;this.isAnimating=!1,this.runnings=null,e&&((i=this.callbackFunction)===null||i===void 0||i.call(null))}animateElement(e,i){const n=this.element.getGraphicItem();if(!n)return;const o=n.animate();this.runnings.push(o),o.startAt(this.unit.initialDelay),o.wait(this.unit.loopDelay),this.unit.timeSlices.forEach(l=>{this.animateTimeSlice(o,l,e,i)}),o.wait(this.unit.loopDelayAfter),o.loop(this.unit.loopCount-1),isValidNumber(this.unit.totalTime)&&setTimeout(()=>{o&&o.stop("end")},this.unit.totalTime),o.onEnd(()=>{this.runnings=this.runnings.filter(l=>l!==o),this.runnings.length===0&&this.animationEnd()})}animateTimeSlice(e,i,n,o){const l=i.delay,u=i.delayAfter,d=i.duration,f=i.effects;if(l>0&&e.wait(l),f.length<0)e.wait(d);else{const g=f.map((_,y)=>{var b;const S=(b=_.type?typeAnimationAttributes(this.element,_,n,o):_.channel?channelAnimationAttributes(this.element,_,n,o):void 0)!==null&&b!==void 0?b:{},v=S.custom||(_==null?void 0:_.custom),A=(S==null?void 0:S.customParameters)||(_==null?void 0:_.customParameters);S.from&&Object.keys(S.from).length&&this.unit&&this.animationOptions.timeline.controlOptions.immediatelyApply&&this.element.mark.markType!=="component"&&this.element.getGraphicItem().setAttributes(S.from);const x=isCustomAnimateCtor(v);return!isNil(v)&&!isCustomAnimateCtor(v)?new CustomInterpolator(S.from,S.to,d,_.easing,{interpolator:v,element:this.element,parameters:A}):x?new v(S.from,S.to,d,_.easing,A):S.to?new AttributeAnimate(S.from,S.to,d,_.easing):void 0}).filter(_=>!isNil(_));g.length===1?e.play(g[0]):g.length>1&&e.play(new AnimateGroup(d,g))}u>0&&e.wait(u)}}function transformToTimelineConfig(r){var e,i,n,o,l,u,d,f,g,_,y,b;if(isNil(r.timeSlices)){const v=r;return{startTime:(e=v.startTime)!==null&&e!==void 0?e:DefaultAnimationStartTime,totalTime:v.totalTime,oneByOne:(i=v.oneByOne)!==null&&i!==void 0?i:DefaultAnimationOneByOne,loop:(n=v.loop)!==null&&n!==void 0?n:DefaultAnimationLoop,controlOptions:merge$1({},DefaultAnimationControlOptions,(o=v.controlOptions)!==null&&o!==void 0?o:{}),timeSlices:[{duration:(l=v.duration)!==null&&l!==void 0?l:DefaultAnimationDuration,delay:(u=v.delay)!==null&&u!==void 0?u:DefaultAnimationDelay,delayAfter:(d=v.delayAfter)!==null&&d!==void 0?d:DefaultAnimationDelayAfter,effects:[{type:v.type,channel:v.channel,custom:v.custom,easing:(f=v.easing)!==null&&f!==void 0?f:DefaultAnimationEasing,customParameters:v.customParameters,options:v.options}]}]}}const S=array(r.timeSlices).filter(v=>v.effects&&array(v.effects).filter(A=>A.channel||A.type).length);if(S.length)return{startTime:(g=r.startTime)!==null&&g!==void 0?g:DefaultAnimationStartTime,totalTime:r.totalTime,oneByOne:(_=r.oneByOne)!==null&&_!==void 0?_:DefaultAnimationOneByOne,loop:(y=r.loop)!==null&&y!==void 0?y:DefaultAnimationLoop,controlOptions:merge$1({},DefaultAnimationControlOptions,(b=r.controlOptions)!==null&&b!==void 0?b:{}),timeSlices:S.map(v=>{var A,x;return{duration:v.duration,delay:(A=v.delay)!==null&&A!==void 0?A:DefaultAnimationDelay,delayAfter:(x=v.delayAfter)!==null&&x!==void 0?x:DefaultAnimationDelayAfter,effects:array(v.effects).filter(T=>T.channel||T.type).map(T=>{var C;return{type:T.type,channel:T.channel,custom:T.custom,easing:(C=T.easing)!==null&&C!==void 0?C:DefaultAnimationEasing,customParameters:T.customParameters,options:T.options}})}}),partitioner:r.partitioner,sort:r.sort}}function normalizeAnimationConfig(r){let e=[];return Object.keys(r).forEach(i=>{e=e.concat(normalizeStateAnimationConfig(i,r[i]))}),e}function normalizeStateAnimationConfig(r,e,i=0){const n=[];let o=i;return array(e).forEach(l=>{var u;const d=transformToTimelineConfig(l);d&&(n.push({state:r,id:(u=d.id)!==null&&u!==void 0?u:`${r}-${o}`,timeline:d,originConfig:l}),o+=1)}),n}function invokeAnimateSpec(r,e,i){return isFunction(r)?r.call(null,e.getDatum(),e,i):r}class Arranger{constructor(e){this.parallelArrangers=[this],this.totalTime=0,this.startTime=0,this.endTime=0,this.animators=e.filter(i=>!isNil(i)),this.totalTime=this.animators.reduce((i,n)=>Math.max(i,n.getTotalAnimationTime()),0)}parallel(e){const i=Array.from(new Set(this.parallelArrangers.concat(e.parallelArrangers)));return i.forEach(n=>{n.parallelArrangers=i}),this.arrangeTime(),this}after(e){return this.afterArranger=e,this.arrangeTime(),this}arrangeTime(){const e=this.parallelArrangers.reduce((n,o)=>Math.max(n,o.totalTime),this.totalTime),i=this.parallelArrangers.reduce((n,o)=>{var l,u;return Math.max(n,(u=(l=o.afterArranger)===null||l===void 0?void 0:l.endTime)!==null&&u!==void 0?u:0)},0);this.parallelArrangers.forEach(n=>{n.startTime=i,n.endTime=i+e,n.animators.forEach(o=>{o.startAt(i)})})}}class Animate{constructor(e,i){this.state=null,this.immediateConfigs=[],this.isEnabled=!0,this.disabledStates=[],this.animators=new Map,this.elementRecorder=new WeakMap,this.timelineCount={},this.mark=e,this.configs=normalizeAnimationConfig(i??{})}getAnimationConfigs(e){var i;return this.isEnabled?((i=this.configs)!==null&&i!==void 0?i:[]).filter(n=>n.state===e):[]}updateConfig(e){this.configs=normalizeAnimationConfig(e??{})}updateState(e){this.state=e}animate(){if(!this.isEnabled||!this.configs||!this.configs.length)return;const e=this.mark.getAllElements(),i=this.mark.parameters();return e.forEach(n=>{var o;n.isReserved&&n.diffState!==DiffState.exit&&(n.isReserved=!1);const l=(o=this.elementRecorder.get(n))===null||o===void 0?void 0:o.prevState;(this.configs.some(u=>l!==n.diffState&&u.state===l&&u.timeline.controlOptions.stopWhenStateChange)||n.diffState===DiffState.exit)&&this.clearElementAnimation(n,!1)}),this.configs.forEach(n=>{this.animateByTimeline(n,e,i)}),this.mark.cleanExitElements(),this}runAnimationByState(e){if(!this.isEnabled)return;const i=this.configs.filter(u=>u.state===e),n=this.mark.getAllElements(),o=this.mark.parameters(),l=i.reduce((u,d)=>u.concat(this.animateByTimeline(d,n,o,!0)),[]);return new Arranger(l)}stopAnimationByState(e){const i=this.animators.get(e);return i&&i.forEach(n=>n.stop()),this}pauseAnimationByState(e){const i=this.animators.get(e);return i&&i.forEach(n=>n.pause()),this}resumeAnimationByState(e){const i=this.animators.get(e);return i&&i.forEach(n=>n.resume()),this}run(e){if(!this.isEnabled)return;const i=normalizeStateAnimationConfig(ImmediateAnimationState,e,this.immediateConfigs.length);this.immediateConfigs=this.immediateConfigs.concat(i);const n=this.mark.getAllElements(),o=this.mark.parameters(),l=i.reduce((u,d)=>u.concat(this.animateByTimeline(d,n,o,!0)),[]);return new Arranger(l)}stop(){return this.animators.forEach(e=>{e.forEach(i=>i.stop())}),this}pause(){return this.animators.forEach(e=>e.forEach(i=>i.pause())),this}resume(){return this.animators.forEach(e=>e.forEach(i=>i.resume())),this}reverse(){return this}restart(){return this}record(){return this}recordEnd(){return this}isAnimating(){let e=!1;return this.animators.forEach(i=>{e=e||i.some(n=>n.isAnimating)}),e}isElementAnimating(e){var i;const n=(i=this.elementRecorder.get(e))===null||i===void 0?void 0:i.count;return isNil(n)||Object.values(n).every(o=>o===0)}getAnimatorCount(){let e=0;return this.animators.forEach(i=>e+=i.length),e}getAllAnimators(){const e=[];return this.animators.forEach(i=>{e.push(...i)}),e}getElementAnimators(e,i){var n;const o=array(e);let l=[];return i?l=(n=this.animators.get(i))!==null&&n!==void 0?n:[]:this.animators.forEach(u=>{l=l.concat(u)}),l.filter(u=>o.includes(u.element))}enable(){return this.isEnabled=!0,this}disable(){return this.isEnabled=!1,this.stop(),this.animators.clear(),this}enableAnimationState(e){const i=array(e);return this.disabledStates=this.disabledStates.filter(n=>!i.includes(n)),this}disableAnimationState(e){const i=array(e);return this.disabledStates=this.disabledStates.concat(i),this}release(){this.stop(),this.animators.clear(),this.configs=null,this.animators=null,this.elementRecorder=null,this.timelineCount=null}animateByTimeline(e,i,n,o=!1){var l;const u=[],d=i.filter(f=>{const g=!(f.isReserved&&f.diffState===DiffState.exit),_=this.getAnimationState(f),y=!this.disabledStates.includes(_),b=o||_===e.state,S=!e.timeline.partitioner||e.timeline.partitioner(f.getDatum(),f,n);return g&&y&&b&&S});if(d.length){isNil(this.timelineCount[e.id])&&(this.timelineCount[e.id]=0),e.timeline.sort&&d.sort((g,_)=>e.timeline.sort(g.getDatum(),_.getDatum(),g,_,n));const f={width:this.mark.view.width(),height:this.mark.view.height(),group:(l=this.mark.group)!==null&&l!==void 0?l:null,mark:this.mark,view:this.mark.view,elementCount:d.length,elementIndex:0};d.forEach(g=>{var _;((_=this.animators.get(e.state))!==null&&_!==void 0?_:[]).filter(y=>y.element===g&&y.animationOptions.id===e.id).forEach(y=>{y.stop(null,!1),this.handleAnimatorEnd(y,!1)})}),d.forEach((g,_)=>{f.elementIndex=_;const y=Object.assign({[DefaultAnimationParameters]:f},n),b=this.getAnimationUnit(e.timeline,g,_,d.length,y);u.push(this.animateElement(e,b,g,f,y))})}return u}animateElement(e,i,n,o,l){var u,d;const f=new Animator(n,i,e);if(f.animate(o,l),!f.isAnimating)return;n.diffState===DiffState.exit&&(n.isReserved=!0);const g=this.timelineCount[e.id]===0;this.timelineCount[e.id]+=1;const _=(u=this.elementRecorder.get(n))!==null&&u!==void 0?u:{prevState:e.state,count:{}};_.prevState=e.state,_.count[e.state]=((d=_.count[e.state])!==null&&d!==void 0?d:0)+1,this.elementRecorder.set(n,_);const y=this.animators.get(e.state);y?y.push(f):this.animators.set(e.state,[f]),f.callback(()=>{this.handleAnimatorEnd(f)});const b={mark:this.mark,animationState:e.state,animationConfig:e.originConfig};return g&&this.mark.emit(HOOK_EVENT.ANIMATION_START,b),this.mark.emit(HOOK_EVENT.ELEMENT_ANIMATION_START,b,n),f}getAnimationState(e){const i=invokeFunctionType(this.state,this.mark.parameters(),e.getDatum(),e);return i??e.diffState}getAnimationUnit(e,i,n,o,l){const u=[],d=invokeAnimateSpec(e.startTime,i,l),f=invokeAnimateSpec(e.totalTime,i,l),g=invokeAnimateSpec(e.oneByOne,i,l),_=invokeAnimateSpec(e.loop,i,l);let y=0;e.timeSlices.forEach(S=>{var v;const A=invokeAnimateSpec(S.delay,i,l),x=invokeAnimateSpec(S.delayAfter,i,l),T=(v=invokeAnimateSpec(S.duration,i,l))!==null&&v!==void 0?v:f/o,C=array(S.effects).map(E=>Object.assign({},E,{customParameters:invokeAnimateSpec(E.customParameters,i,l)}));u.push({effects:C,duration:T,delay:A,delayAfter:x}),y+=A+T+x});const b=isNumber(g)?g:g===!0?y:0;return{initialDelay:d,loopCount:isNumber(_)?_:_===!0?1/0:1,loopDelay:b*n,loopDelayAfter:b*(o-n-1),loopAnimateDuration:y,loopDuration:y+b*(o-1),totalTime:f,timeSlices:u}}clearElementAnimation(e,i=!0){this.animators.forEach(n=>{n.forEach(o=>{o.element===e&&(o.animationOptions.state===DiffState.exit?o.stop("start",!1):o.stop("end",!1),this.handleAnimatorEnd(o,i))})}),this.elementRecorder.delete(e)}clearAllElements(){const e=this.mark.getAllElements();e&&e.forEach((i,n)=>{this.clearElement(i,n===e.length-1)})}clearElement(e,i=!0){this.clearElementAnimation(e),e.getGraphicItem()&&(e.clearGraphicAttributes(),e.diffState===DiffState.exit&&(e.isReserved=!1),i&&this.mark.cleanExitElements())}handleAnimatorEnd(e,i=!0){const n=e.element,o=e.animationOptions,l=o.state,u=l===ImmediateAnimationState,d=this.elementRecorder.get(n).count;d[l]-=1,this.animators.set(l,this.animators.get(l).filter(y=>y!==e)),this.animators.get(l).length===0&&this.animators.delete(l),this.timelineCount[o.id]-=1;const f=this.timelineCount[o.id]===0,g=u?this.immediateConfigs.find(y=>y.id===o.id).originConfig:this.configs.find(y=>y.id===o.id).originConfig;f&&(delete this.timelineCount[o.id],u&&(this.immediateConfigs=this.immediateConfigs.filter(y=>y.id!==o.id))),i&&(Object.keys(this.timelineCount).length===0?this.clearAllElements():l===DiffState.exit&&d[DiffState.exit]===0&&this.clearElement(n));const _={mark:this.mark,animationState:l,animationConfig:g};f&&this.mark.emit(HOOK_EVENT.ANIMATION_END,_),this.mark.emit(HOOK_EVENT.ELEMENT_ANIMATION_END,_,n)}}class MarkAnimateMixin{constructor(){this.animate=new Animate(this,{})}initAnimate(e){this.animate||(this.animate=new Animate(this,e.animation),this.needAnimate()&&this.animate.updateState(e.animationState))}reuseAnimate(e){this.animate=e.animate,this.animate.mark=this}updateAnimate(e){this.animate.updateConfig(e.animation),this.animate.updateState(e.animationState)}}const registerMarkAnimateAPI=()=>{mixin(Mark,MarkAnimateMixin)},registerGesturePlugin=()=>{Factory.registerStageEventPlugin("gesture",Gesture)},registerAnimate$1=()=>{registerViewAnimateAPI(),registerMarkAnimateAPI()},BASE_EVENTS=["pointerdown","pointerup","pointerupoutside","pointertap","pointerover","pointermove","pointerenter","pointerleave","pointerout","mousedown","mouseup","mouseupoutside","rightdown","rightup","rightupoutside","click","dblclick","mousemove","mouseover","mouseout","mouseenter","mouseleave","wheel","touchstart","touchend","touchendoutside","touchmove","touchcancel","tap","dragstart","drag","dragenter","dragleave","dragover","dragend","drop","pan","panstart","panend","press","pressup","pressend","pinch","pinchstart","pinchend","swipe"];var ChartEvent;(function(r){r.initialized="initialized",r.rendered="rendered",r.renderFinished="renderFinished",r.animationFinished="animationFinished",r.regionSeriesDataFilterOver="regionSeriesDataFilterOver",r.afterInitData="afterInitData",r.afterInitEvent="afterInitEvent",r.afterInitMark="afterInitMark",r.rawDataUpdate="rawDataUpdate",r.viewDataFilterOver="viewDataFilterOver",r.viewDataUpdate="viewDataUpdate",r.viewDataStatisticsUpdate="viewDataStatisticsUpdate",r.markDeltaYUpdate="markDeltaYUpdate",r.viewDataLabelUpdate="viewDataLabelUpdate",r.scaleDomainUpdate="scaleDomainUpdate",r.scaleUpdate="scaleUpdate",r.dataZoomChange="dataZoomChange",r.drill="drill",r.layoutStart="layoutStart",r.layoutEnd="layoutEnd",r.layoutRectUpdate="layoutRectUpdate",r.playerPlay="playerPlay",r.playerPause="playerPause",r.playerEnd="playerEnd",r.playerChange="playerChange",r.playerForward="playerForward",r.playerBackward="playerBackward",r.scrollBarChange="scrollBarChange",r.brushStart="brushStart",r.brushChange="brushChange",r.brushEnd="brushEnd",r.brushClear="brushClear",r.legendSelectedDataChange="legendSelectedDataChange",r.legendFilter="legendFilter",r.legendItemClick="legendItemClick",r.legendItemHover="legendItemHover",r.legendItemUnHover="legendItemUnHover",r.tooltipShow="tooltipShow",r.tooltipHide="tooltipHide",r.tooltipRelease="tooltipRelease",r.afterResize="afterResize",r.afterRender="afterRender",r.afterLayout="afterLayout"})(ChartEvent||(ChartEvent={}));var Event_Source_Type;(function(r){r.chart="chart",r.window="window",r.canvas="canvas"})(Event_Source_Type||(Event_Source_Type={}));var Event_Bubble_Level;(function(r){r.vchart="vchart",r.chart="chart",r.model="model",r.mark="mark"})(Event_Bubble_Level||(Event_Bubble_Level={}));const isInBound=(r,e,i)=>r.x>=e.x&&r.x<=i.x&&r.y>=e.y&&r.y<=i.y,isInRegionBound=(r,e,i)=>{const n=r.getRegionsInIds(array(e.layout.layoutBindRegionID));return n==null?void 0:n.some(o=>{const l=o.getLayoutRect(),u=o.getLayoutStartPoint();return isInBound(i,{x:u.x,y:u.y},{x:l.width+u.x,y:l.height+u.y})})},isSameDimensionInfo=(r,e)=>{var i,n;return r===e||!isNil(r)&&!isNil(e)&&r.value===e.value&&((i=r.axis)===null||i===void 0?void 0:i.id)===((n=e.axis)===null||n===void 0?void 0:n.id)},resolveTooltipFilterRange=(r,e)=>{const i=r.tooltipFilterRange,n=typeof i=="function"?i({scale:e}):i;return isValidNumber(n)?[-n,n]:n},getDimensionData=(r,e,i,n)=>{var o;const l=e.getScale(),u=isDiscrete(l.type),d=[],f=e.getOption().getChart().getSeriesInIndex(e.getSpecInfo().seriesIndexes);for(const g of f)if(g.coordinate===i){const _=array(n(g)),y=(o=g.getViewData())===null||o===void 0?void 0:o.latestData;if(_&&y)if(u){const b=[],S=[];y.forEach((v,A)=>{var x;((x=v[_[0]])===null||x===void 0?void 0:x.toString())===(r==null?void 0:r.toString())&&(b.push(v),S.push(A))}),d.push({series:g,datum:b,key:getDimensionDataKey(g,S)})}else if(isValid(_[1])){const b=[],S=[];y.forEach((v,A)=>{var x;(((x=v[_[0]])===null||x===void 0?void 0:x.toString())===(r==null?void 0:r.toString())||isValid(v[_[0]])&&isValid(v[_[1]])&&r>=v[_[0]]&&r<v[_[1]])&&(b.push(v),S.push(A))}),d.push({series:g,datum:b,key:getDimensionDataKey(g,S)})}else{const b=e.getSpec(),S=resolveTooltipFilterRange(b,l);let v=[],A=[];if(S)y.forEach((x,T)=>{if(isValid(x[_[0]])){const C=x[_[0]]-r;C>=S[0]&&C<=S[1]&&(v.push(x),A.push(T))}});else{let x=1/0,T=0;y.forEach((C,E)=>{if(isValid(C[_[0]])){const P=Math.abs(C[_[0]]-r),L=Math.sign(C[_[0]]-r);P<x?(x=P,v=[C],A=[E],T=L):P===x&&L===T&&(v.push(C),A.push(E))}})}d.push({series:g,datum:v,key:getDimensionDataKey(g,A)})}}return d},getDimensionDataKey=(r,e)=>`${r.id}_${e.join("_")}`,getAxis=(r,e,i)=>{const n=r.getAllComponents().filter(o=>o.specKey==="axes"&&e(o)&&isInRegionBound(r,o,i));return n.length?n:null},angleStandardize=(r,e)=>{const i=2*Math.PI,n=minInArray(e),o=maxInArray(e);return r<n?r+=Math.ceil((n-r)/i)*i:r>o&&(r-=Math.ceil((r-o)/i)*i),r},getPolarDimensionInfo=(r,e)=>{if(!r)return null;const i=getAxis(r,f=>f.getOrient()==="angle",e),n=getAxis(r,f=>f.getOrient()==="radius",e);if(!(i&&i.length||n&&n.length))return null;const o=[],l=f=>f.getDimensionField()[0],{x:u,y:d}=e;return i&&i.forEach(f=>{var g;const _=f.getScale();if(_&&isDiscrete(_.type)){const y=_.domain(),b=_.range(),S=f.getCenter(),v={x:u-f.getLayoutStartPoint().x-S.x,y:d-f.getLayoutStartPoint().y-S.y};let A=vectorAngle({x:1,y:0},v);A=angleStandardize(A,b);const x=distance(v),T=(g=n[0])===null||g===void 0?void 0:g.getScale(),C=T==null?void 0:T.range();if((A-(b==null?void 0:b[0]))*(A-(b==null?void 0:b[1]))>0||(x-(C==null?void 0:C[0]))*(x-(C==null?void 0:C[1]))>0)return;const E=f.invert(A);if(isNil(E))return;let P=y.findIndex(R=>(R==null?void 0:R.toString())===E.toString());P<0&&(P=void 0);const L=getDimensionData(E,f,"polar",l);o.push({index:P,value:E,position:_.scale(E),axis:f,data:L})}}),n&&n.forEach(f=>{var g;const _=f.getScale(),y=_==null?void 0:_.range();if(_&&isDiscrete(_.type)){const b=f.getCenter(),S={x:u-f.getLayoutStartPoint().x-b.x,y:d-f.getLayoutStartPoint().y-b.y};let v=vectorAngle({x:1,y:0},S);v<-Math.PI/2&&(v=2*Math.PI+v);const A=distance(S),x=(g=i[0])===null||g===void 0?void 0:g.getScale(),T=x==null?void 0:x.range();if((v-(T==null?void 0:T[0]))*(v-(T==null?void 0:T[1]))>0||(A-(y==null?void 0:y[0]))*(A-(y==null?void 0:y[1]))>0)return;const C=_.invert(A);if(isNil(C))return;let E=_.domain().findIndex(L=>(L==null?void 0:L.toString())===C.toString());E<0&&(E=void 0);const P=getDimensionData(C,f,"polar",l);o.push({index:E,value:C,position:_.scale(C),axis:f,data:P})}}),o.length?o:null};function isXAxis(r){return r==="bottom"||r==="top"}function isYAxis(r){return r==="left"||r==="right"}function isZAxis(r){return r==="z"}function autoAxisType(r,e){return e?isXAxis(r)?"linear":"band":isXAxis(r)?"band":"linear"}function getOrient(r,e){return isValidOrient(r.orient)||e&&e.includes(r.orient)?r.orient:"left"}function getDirectionByOrient(r){return r==="top"||r==="bottom"?"horizontal":"vertical"}function transformInverse(r,e){let i=r.inverse;return e&&!isXAxis(r.orient)&&(i=!isValid(r.inverse)||!r.inverse),i}function getCartesianAxisInfo(r,e){var i;const n=(i=r.type)!==null&&i!==void 0?i:autoAxisType(r.orient,e);return{axisType:n,componentName:`${ComponentTypeEnum.cartesianAxis}-${n}`}}const discreteXAxisGetDimensionField=r=>r.fieldX[0],discreteYAxisGetDimensionField=r=>r.fieldY[0],continuousXAxisGetDimensionField=r=>{var e;return[r.fieldX[0],(e=r.fieldX2)!==null&&e!==void 0?e:r.fieldX[1]]},continuousYAxisGetDimensionField=r=>{var e;return[r.fieldY[0],(e=r.fieldY2)!==null&&e!==void 0?e:r.fieldY[1]]},getDimensionFieldFunc=(r,e)=>r?e?discreteXAxisGetDimensionField:continuousXAxisGetDimensionField:e?discreteYAxisGetDimensionField:continuousYAxisGetDimensionField,getCartesianDimensionInfo=(r,e,i)=>{var n,o;if(!r)return null;const{x:l,y:u}=e,d=(n=getAxis(r,v=>isXAxis(v.getOrient()),e))!==null&&n!==void 0?n:[],f=(o=getAxis(r,v=>isYAxis(v.getOrient()),e))!==null&&o!==void 0?o:[];if(!d.length&&!f.length)return null;const g=new Set,_=new Set,y=new Set;[d,f].forEach(v=>v.forEach(A=>{isDiscrete(A.getScale().type)?g.add(A):_.add(A),i&&A.getSpec().hasDimensionTooltip&&y.add(A)}));const b=[],S=v=>{const A=v==="x",x=A?l:u;(A?d:f).forEach(T=>{if(y.size>0){if(y.has(T)){const C=getDimensionInfoByPosition(T,x,getDimensionFieldFunc(A,isDiscrete(T.getScale().type)));C&&b.push(C)}}else{const C=g.size>0;if((C?g:_).has(T)){const E=getDimensionInfoByPosition(T,x,getDimensionFieldFunc(A,C));E&&b.push(E)}}})};return r.getSpec().direction==="horizontal"?(S("y"),b.length===0&&S("x")):(S("x"),b.length===0&&S("y")),b.length?b:null},getDimensionInfoByPosition=(r,e,i)=>{const n=r.positionToData(e,!0);return isNil(n)?null:getDimensionInfoByValue(r,n,i)},getDimensionInfoByValue=(r,e,i)=>{const n=r.getScale();if(isNil(e))return null;let o=n.domain().findIndex(u=>(u==null?void 0:u.toString())===e.toString());o<0&&(o=void 0);const l=getDimensionData(e,r,"cartesian",i??(isXAxis(r.getOrient())?discreteXAxisGetDimensionField:discreteYAxisGetDimensionField));return{index:o,value:e,position:n.scale(e),axis:r,data:l}};class DimensionEvent{constructor(e,i){this._eventDispatcher=e,this._mode=i}get chart(){var e,i;return this._chart||(this._chart=(i=(e=this._eventDispatcher.globalInstance).getChart)===null||i===void 0?void 0:i.call(e)),this._chart}register(e,i){var n,o;((o=(n=this.chart)===null||n===void 0?void 0:n.getOption().onError)!==null&&o!==void 0?o:error$1)("Method not implemented.")}unregister(){var e,i;((i=(e=this.chart)===null||e===void 0?void 0:e.getOption().onError)!==null&&i!==void 0?i:error$1)("Method not implemented.")}getTargetDimensionInfo(e,i){var n,o;const l=(n=getCartesianDimensionInfo(this.chart,{x:e,y:i}))!==null&&n!==void 0?n:[],u=(o=getPolarDimensionInfo(this.chart,{x:e,y:i}))!==null&&o!==void 0?o:[],d=[].concat(l,u);return d.length===0?null:d}dispatch(e,i){var n;const o=(n=this.chart)===null||n===void 0?void 0:n.getAllComponents().filter(f=>f.specKey==="axes"&&(!(i!=null&&i.filter)||i.filter(f))),l=o.filter(f=>{const g=f.getScale();return isDiscrete(g.type)}),u=l.length?l:o.filter(f=>{const g=f.getOrient();return isXAxis(g)||g==="angle"}),d=[];return u.forEach(f=>{const g=getDimensionInfoByValue(f,e);g&&d.push(g)}),this._callback.call(null,{action:"enter",dimensionInfo:d}),d}}class DimensionClickEvent extends DimensionEvent{constructor(){super(...arguments),this.onClick=e=>{if(!e)return;const i=e.event.viewX,n=e.event.viewY,o=this.getTargetDimensionInfo(i,n);o&&this._callback.call(null,Object.assign(Object.assign({},e),{action:"click",dimensionInfo:o.slice()}))}}register(e,i){this._callback=i.callback,this._eventDispatcher.register("pointertap",{query:Object.assign(Object.assign({},i.query),{source:Event_Source_Type.chart}),callback:this.onClick})}unregister(){this._eventDispatcher.unregister("pointertap",{query:null,callback:this.onClick})}}class DimensionHoverEvent extends DimensionEvent{constructor(){super(...arguments),this._cacheDimensionInfo=null,this.onMouseMove=e=>{if(!e)return;const i=e.event.viewX,n=e.event.viewY,o=this.getTargetDimensionInfo(i,n);o===null&&this._cacheDimensionInfo!==null?(this._callback.call(null,Object.assign(Object.assign({},e),{action:"leave",dimensionInfo:this._cacheDimensionInfo.slice()})),this._cacheDimensionInfo=o):o===null||this._cacheDimensionInfo!==null&&o.length===this._cacheDimensionInfo.length&&!o.some((l,u)=>!isSameDimensionInfo(l,this._cacheDimensionInfo[u]))?o!==null&&this._callback.call(null,Object.assign(Object.assign({},e),{action:"move",dimensionInfo:o.slice()})):(this._callback.call(null,Object.assign(Object.assign({},e),{action:"enter",dimensionInfo:o.slice()})),this._cacheDimensionInfo=o)},this.onMouseOut=e=>{e&&(this._callback.call(null,Object.assign(Object.assign({},e),{action:"leave",dimensionInfo:this._cacheDimensionInfo?this._cacheDimensionInfo.slice():[]})),this._cacheDimensionInfo=null)}}register(e,i){this._callback=i.callback,this._eventDispatcher.register("pointermove",{query:Object.assign(Object.assign({},i.query),{source:Event_Source_Type.chart}),callback:this.onMouseMove}),this._eventDispatcher.register("pointerout",{query:Object.assign(Object.assign({},i.query),{source:Event_Source_Type.canvas}),callback:this.onMouseOut}),isMobileLikeMode(this._mode)&&this._eventDispatcher.register("pointerdown",{query:Object.assign(Object.assign({},i.query),{source:Event_Source_Type.chart}),callback:this.onMouseMove})}unregister(){this._eventDispatcher.unregister("pointermove",{query:null,callback:this.onMouseMove}),isMobileLikeMode(this._mode)&&this._eventDispatcher.unregister("pointerdown",{query:null,callback:this.onMouseMove})}}var DimensionEventEnum;(function(r){r.dimensionHover="dimensionHover",r.dimensionClick="dimensionClick"})(DimensionEventEnum||(DimensionEventEnum={}));const ComposedEventMapper={[DimensionEventEnum.dimensionHover]:DimensionHoverEvent,[DimensionEventEnum.dimensionClick]:DimensionClickEvent};let Event$1=class{getComposedEventMap(){return this._composedEventMap}constructor(e,i){this._composedEventMap=new Map,this._eventDispatcher=e,this._mode=i}on(e,i,n){const o=typeof i=="function"?{query:null,callback:i}:{query:i,callback:n};if(ComposedEventMapper[e]){const l=new ComposedEventMapper[e](this._eventDispatcher,this._mode);l.register(e,o),this._composedEventMap.set(n,{eventType:e,event:l})}else this._eventDispatcher.register(e,o);return this}off(e,i,n){var o,l;const u=n??i;if(ComposedEventMapper[e])if(u)(o=this._composedEventMap.get(u))===null||o===void 0||o.event.unregister(),this._composedEventMap.delete(u);else for(const d of this._composedEventMap.entries())d[1].eventType===e&&((l=this._composedEventMap.get(d[0]))===null||l===void 0||l.event.unregister(),this._composedEventMap.delete(d[0]));else if(u){const d={callback:u,query:null,filter:{nodeName:null,type:e,level:null,source:i.source,markName:null,filter:null,userId:null}};this._eventDispatcher.unregister(e,d)}else this._eventDispatcher.unregister(e);return this}emit(e,i,n){return this._eventDispatcher.dispatch(e,i,n),this}prevent(e,i){return this._eventDispatcher.prevent(e,i),this}allow(e){return this._eventDispatcher.allow(e),this}release(){this._eventDispatcher.clear(),this._composedEventMap.clear()}};class Bubble{constructor(){this._map=new Map,this._levelNodes=new Map,this._levelNodes.set(Event_Bubble_Level.vchart,[]),this._levelNodes.set(Event_Bubble_Level.chart,[]),this._levelNodes.set(Event_Bubble_Level.model,[]),this._levelNodes.set(Event_Bubble_Level.mark,[])}addHandler(e,i){var n;const o={level:i,handler:e};return(n=this._levelNodes.get(i))===null||n===void 0||n.push(o),this._map.set(e.callback,o),this}removeHandler(e){const i=this._map.get(e.callback);if(!i)return this;this._map.delete(e.callback);const n=this._levelNodes.get(i.level),o=n==null?void 0:n.findIndex(l=>l.handler.callback===e.callback);return o!==void 0&&o>=0&&(n==null||n.splice(o,1)),this}preventHandler(e){return e&&(e.prevented=!0),this}allowHandler(e){return e&&(e.prevented=!1),this}getHandlers(e){var i;return((i=this._levelNodes.get(e))===null||i===void 0?void 0:i.map(n=>n.handler))||[]}getAllHandlers(){return Array.from(this._map.values()).map(e=>e.handler)||[]}getCount(){return this._map.size}release(){this._map.clear(),this._levelNodes.clear()}}const componentTypeMap={cartesianAxis:"axis","cartesianAxis-band":"axis","cartesianAxis-linear":"axis","cartesianAxis-time":"axis",polarAxis:"axis","polarAxis-band":"axis","polarAxis-linear":"axis",discreteLegend:"legend",continuousLegend:"legend",colorLegend:"legend",sizeLegend:"legend"};class EventDispatcher{constructor(e,i){this._viewBubbles=new Map,this._windowBubbles=new Map,this._canvasBubbles=new Map,this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this._onDelegate=n=>{var o,l;const u=this.globalInstance.getChart(),d=isValid(n.modelId)&&(u==null?void 0:u.getModelById(n.modelId))||void 0,f=isValid(n.markId)&&(u==null?void 0:u.getMarkById(n.markId))||null,g=new Map;let _=(o=n.item)===null||o===void 0?void 0:o.mark;for(_&&isValid(_.id())&&g.set(_.id(),n.item);_!=null&&_.elements;){const v=_.id();isValid(v)&&!g.has(v)&&g.set(v,_.elements[0]),_=_.group}const y=get(n.event,"target");let b=n.datum;d&&d.modelType==="component"&&(b=(l=d.getDatum(y))!==null&&l!==void 0?l:b);const S={event:n.event,item:n.item,source:n.source,datum:b,itemMap:g,chart:u,model:d,mark:f??void 0,node:get(n.event,"target")};this.dispatch(n.type,S)},this._onDelegateInteractionEvent=n=>{const o=this.globalInstance.getChart(),l=n.event;let u=null;l.elements&&(u=l.elements);const d={event:n.event,chart:o,items:u,datums:u&&u.map(f=>f.getDatum())};this.dispatch(n.type,d)},this.globalInstance=e,this._compiler=i}register(e,i){var n,o,l,u,d;this._parseQuery(i);const f=this.getEventBubble(((n=i.filter)===null||n===void 0?void 0:n.source)||Event_Source_Type.chart),g=this.getEventListeners(((o=i.filter)===null||o===void 0?void 0:o.source)||Event_Source_Type.chart);if(f.get(e)||f.set(e,new Bubble),f.get(e).addHandler(i,(l=i.filter)===null||l===void 0?void 0:l.level),this._isValidEvent(e)&&!g.has(e)){const _=this._onDelegate.bind(this);this._compiler.addEventListener((u=i.filter)===null||u===void 0?void 0:u.source,e,_),g.set(e,_)}else if(this._isInteractionEvent(e)&&!g.has(e)){const _=this._onDelegateInteractionEvent.bind(this);this._compiler.addEventListener((d=i.filter)===null||d===void 0?void 0:d.source,e,_),g.set(e,_)}return this}unregister(e,i){var n,o,l,u;let d=!1;const f=this.getEventBubble(((n=i==null?void 0:i.filter)===null||n===void 0?void 0:n.source)||Event_Source_Type.chart),g=this.getEventListeners(((o=i==null?void 0:i.filter)===null||o===void 0?void 0:o.source)||Event_Source_Type.chart);if(i){const _=f.get(e);_==null||_.removeHandler(i),(_==null?void 0:_.getCount())===0&&(_==null||_.release(),f.delete(e),d=!0),!((l=i==null?void 0:i.wrappedCallback)===null||l===void 0)&&l.cancel&&i.wrappedCallback.cancel()}else{const _=f.get(e);_==null||_.release(),f.delete(e),d=!0}if(d&&this._isValidEvent(e)){const _=g.get(e);this._compiler.removeEventListener(((u=i==null?void 0:i.filter)===null||u===void 0?void 0:u.source)||Event_Source_Type.chart,e,_),g.delete(e)}return this}dispatch(e,i,n){const o=this.getEventBubble(i.source||Event_Source_Type.chart).get(e);if(!o)return this;let l=!1;if(n){const u=o.getHandlers(n);l=this._invoke(u,e,i)}else{const u=[Event_Bubble_Level.mark,Event_Bubble_Level.model,Event_Bubble_Level.chart,Event_Bubble_Level.vchart];let d=0;for(;!l&&d<u.length;)l=this._invoke(o.getHandlers(u[d]),e,i),d++}return this}prevent(e,i){return["canvas","chart","window"].forEach(n=>{const o=this.getEventBubble(n).get(e);o&&o.getAllHandlers().forEach(l=>{i&&l.callback===i||o.preventHandler(l)})}),this}allow(e){return["canvas","chart","window"].forEach(i=>{const n=this.getEventBubble(i).get(e);n&&n.getAllHandlers().forEach(o=>n.allowHandler(o))}),this}clear(){[Event_Source_Type.chart,Event_Source_Type.window,Event_Source_Type.canvas].forEach(e=>{const i=this.getEventListeners(e);for(const n of i.entries())this._compiler.removeEventListener(e,n[0],n[1]);i.clear()}),[this._viewBubbles,this._windowBubbles,this._canvasBubbles].forEach(e=>{for(const i of e.values())i.release();e.clear()})}release(){this.clear(),this.globalInstance=null,this._compiler=null}_filter(e,i,n){var o,l,u;if(isFunction(e.filter)&&!e.filter(n)||e.nodeName&&get(n,"node.name")!==e.nodeName||e.markName&&((o=n==null?void 0:n.mark)===null||o===void 0?void 0:o.name)!==e.markName)return!1;let d=(l=n.model)===null||l===void 0?void 0:l.type;return componentTypeMap[d]&&(d=componentTypeMap[d]),(!e.type||d===e.type)&&!(e.level==="mark"&&!e.type&&!(n!=null&&n.mark))&&!(e.level==="model"&&!e.type&&!(n!=null&&n.model))&&(!isValid(e.userId)||((u=n.model)===null||u===void 0?void 0:u.userId)===e.userId)}_prepareParams(e,i){if(e.markName&&i.mark&&i.itemMap){const n=i.mark.getProductId(),o=i.itemMap.get(n),l=o==null?void 0:o.getDatum();return Object.assign(Object.assign({},i),{item:o,datum:l})}return Object.assign({},i)}_invoke(e,i,n){return e.map(o=>{var l,u,d;const f=o.filter;if(!o.prevented&&(!o.query||this._filter(f,i,n))){const g=(o.wrappedCallback||o.callback).call(null,this._prepareParams(f,n)),_=g??((l=o.query)===null||l===void 0?void 0:l.consume);return _&&((u=n.event)===null||u===void 0||u.stopPropagation(),(d=n.event)===null||d===void 0||d.preventDefault()),!!_}}).some(o=>o===!0)}_getQueryLevel(e){return e?e.level?e.level:isValid(e.id)?Event_Bubble_Level.model:Event_Bubble_Level.vchart:Event_Bubble_Level.vchart}_parseQuery(e){var i;const n=e.query;n!=null&&n.throttle?e.wrappedCallback=throttle(e.callback,n.throttle):n!=null&&n.debounce&&(e.wrappedCallback=debounce(e.callback,n.debounce));let o=this._getQueryLevel(n),l=null,u=Event_Source_Type.chart,d=null,f=null,g=null;return n!=null&&n.nodeName&&(d=n.nodeName),n!=null&&n.markName&&(f=n.markName),!(n!=null&&n.type)||o!==Event_Bubble_Level.model&&o!==Event_Bubble_Level.mark||(l=n.type),n!=null&&n.source&&(u=n.source),isValid(n==null?void 0:n.id)&&(g=n==null?void 0:n.id,o=Event_Bubble_Level.model),e.filter={level:o,markName:f,type:l,source:u,nodeName:d,userId:g,filter:(i=n==null?void 0:n.filter)!==null&&i!==void 0?i:null},e}getEventBubble(e){switch(e){case Event_Source_Type.chart:return this._viewBubbles;case Event_Source_Type.window:return this._windowBubbles;case Event_Source_Type.canvas:return this._canvasBubbles;default:return this._viewBubbles}}getEventListeners(e){switch(e){case Event_Source_Type.chart:return this._viewListeners;case Event_Source_Type.window:return this._windowListeners;case Event_Source_Type.canvas:return this._canvasListeners;default:return this._viewListeners}}_isValidEvent(e){return BASE_EVENTS.includes(e)||Object.values(HOOK_EVENT).includes(e)}_isInteractionEvent(e){let i;return e&&(i=e.split(":")[0],i)&&Factory.hasInteraction(i)}}function registerDataSetInstanceTransform(r,e,i){r.getTransform(e)||r.registerTransform(e,i)}function registerDataSetInstanceParser(r,e,i){r.getParser(e)||r.registerParser(e,i)}const geoSourceMap=new Map;let mapDataSet;function initMapDataSet(){mapDataSet||(mapDataSet=new DataSet,registerDataSetInstanceParser(mapDataSet,"geojson",geoJSONParser),registerDataSetInstanceParser(mapDataSet,"topojson",topoJSONParser),registerDataSetInstanceTransform(mapDataSet,"simplify",simplify))}function registerMapSource(r,e,i={type:"geojson",centroid:!0}){geoSourceMap.has(r)&&warn(`map type of '${r}' already exists, will be overwritten.`),initMapDataSet();const n=new DataView(mapDataSet),o=merge$1({},{centroid:!0,simplify:!1},i);i.type==="topojson"?n.parse(e,{type:"topojson",options:o}):n.parse(e,{type:"geojson",options:o});const{simplify:l}=i;l===!0?n.transform({type:"simplify"}):isObject$1(l)&&n.transform({type:"simplify",options:l}),geoSourceMap.set(r,n)}function unregisterMapSource(r){geoSourceMap.has(r)?geoSourceMap.delete(r):warn(`map type of '${r}' does not exists.`)}function getMapSource(r){return geoSourceMap.get(r)}function copyOneDataView(r,e=!1){let i=e;return r.latestData instanceof DataView&&(i=!1),i?cloneDeep(r.latestData):r.latestData&&r.latestData.slice()}const copyDataView=(r,e)=>r.length===0?[]:r.length===1?copyOneDataView(r[0],e==null?void 0:e.deep):r.map(i=>copyOneDataView(i,e==null?void 0:e.deep));function dataViewFromDataView(r,e,i){e=e instanceof DataSet?e:r.dataSet,registerDataSetInstanceTransform(e,"copyDataView",copyDataView);const n=new DataView(e,i);return n.parse([r],{type:"dataview"}),n.transform({type:"copyDataView",level:TransformLevel.copyDataView}),n}function dataToDataView(r,e,i=[]){var n;if(r instanceof DataView)return r;const{id:o,values:l=[],fromDataIndex:u,fromDataId:d,transforms:f=[]}=r,g=r.parser?cloneDeep(r.parser):{clone:!0},_=cloneDeep(r.fields);let y;g.clone=g.clone!==!1;const b=i.find(S=>S.name===o);if(b)y=b;else{const S={name:o};if(_&&(S.fields=_),y=new DataView(e,S),typeof d=="string"){const v=i.find(A=>A.name===d);if(!v)return warn(`no data matches fromDataId ${d}`),null;y.parse([v],{type:"dataview"}),y.transform({type:"copyDataView"})}else if(typeof u=="number"){const v=i[u];if(!v)return warn(`no data matches fromDataIndex ${u}`),null;y.parse([v],{type:"dataview"}),y.transform({type:"copyDataView"})}else Array.isArray(l)?y.parse(l,g):!isString(l)||g&&!["csv","dsv","tsv"].includes(g.type)?(y.parse([]),warn("values should be array")):y.parse(l,(n=g)!==null&&n!==void 0?n:{type:"csv"});f&&f.length&&f.forEach(v=>{e.getTransform(v.type)&&y.transform(v)})}return y}function updateDataViewInData(r,e,i){r&&(e.fields&&r.setFields(e.fields,i),r.parseNewData(e.values,e.parser))}var TransformLevel;(function(r){r[r.copyDataView=-10]="copyDataView",r[r.treemapFilter=-8]="treemapFilter",r[r.treemapFlatten=-7]="treemapFlatten",r[r.dotObjFlat=-7]="dotObjFlat",r[r.linkDotInfo=-7]="linkDotInfo",r[r.sankeyLayout=-7]="sankeyLayout",r[r.dataZoomFilter=-6]="dataZoomFilter",r[r.legendFilter=-5]="legendFilter"})(TransformLevel||(TransformLevel={}));var AnimationStateEnum;(function(r){r.appear="appear",r.disappear="disappear",r.enter="enter",r.update="update",r.state="state",r.exit="exit",r.normal="normal",r.none="none"})(AnimationStateEnum||(AnimationStateEnum={}));var GrammarType;(function(r){r.data="data",r.signal="signal",r.mark="mark"})(GrammarType||(GrammarType={}));function toRenderMode(r){switch(r){case RenderModeEnum["desktop-browser"]:case RenderModeEnum["mobile-browser"]:return"browser";case RenderModeEnum.node:case RenderModeEnum.worker:return"node";case RenderModeEnum.miniApp:case RenderModeEnum["desktop-miniApp"]:return"feishu";case RenderModeEnum.lynx:return"lynx";case RenderModeEnum.wx:return"wx";case RenderModeEnum.tt:return"tt";case RenderModeEnum.harmony:return"harmony"}return"browser"}var __rest$i=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class Compiler{getVGrammarView(){return this._view}getModel(){return this._model}constructor(e,i){this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this.isInited=!1,this._released=!1,this._model={[GrammarType.signal]:{},[GrammarType.data]:{},[GrammarType.mark]:{}},this._compileChart=null,this.handleStageRender=()=>{var n,o;(o=(n=this._compileChart)===null||n===void 0?void 0:n.getEvent())===null||o===void 0||o.emit(ChartEvent.afterRender,{chart:this._compileChart})},this._container=e,this._option=i}getRenderer(){var e;return(e=this._view)===null||e===void 0?void 0:e.renderer}getCanvas(){var e;return(e=this._view)===null||e===void 0?void 0:e.renderer.canvas()}getStage(){var e;return(e=this._view)===null||e===void 0?void 0:e.renderer.stage()}initView(){var e,i,n,o;if(this._released||(this.isInited=!0,this._view))return;const l=new Logger((e=this._option.logLevel)!==null&&e!==void 0?e:LoggerLevel.Error);!((i=this._option)===null||i===void 0)&&i.onError&&l.addErrorHandler((...x)=>{var T,C;(C=(T=this._option)===null||T===void 0?void 0:T.onError)===null||C===void 0||C.call(T,...x)});const u=this._option,{performanceHook:d,autoRefreshDpr:f,dpr:g,mode:_,gestureConfig:y,interactive:b,clickInterval:S,autoPreventDefault:v}=u,A=__rest$i(u,["performanceHook","autoRefreshDpr","dpr","mode","gestureConfig","interactive","clickInterval","autoPreventDefault"]);this._view=new View(Object.assign(Object.assign({width:this._width,height:this._height,container:(n=this._container.dom)!==null&&n!==void 0?n:null,renderCanvas:(o=this._container.canvas)!==null&&o!==void 0?o:null,hooks:d},A),{dpr:g,autoRefresh:isValid(f)?f:!isValid(g),mode:toRenderMode(_),autoFit:!1,eventConfig:{gesture:isValid(y)?y:isMobileLikeMode(_),disable:b===!1,clickInterval:S,autoPreventDefault:v},doLayout:()=>{var x;(x=this._compileChart)===null||x===void 0||x.onLayout(this._view)},logger:l,logLevel:l.level()})),this._setCanvasStyle(),this.getStage().hooks.afterRender.tap("chart-event",this.handleStageRender),b!==!1&&this._viewListeners.forEach(x=>{var T;(T=this._view)===null||T===void 0||T.addEventListener(x.type,x.callback)})}_setCanvasStyle(){if(this._view&&this._container.dom&&!isString(this._container.dom)){this._container.dom.style.display="block",this._container.dom.style.position="relative";const e=this.getCanvas();e&&(e.style.display="block")}}compileInteractions(){var e;if(this._view.removeAllInteractions(),(e=this._interactions)===null||e===void 0?void 0:e.length){const i={};this._interactions.forEach(n=>{var o;if(n.regionId){const l=`${n.regionId}-${n.type}-${(o=n.id)!==null&&o!==void 0?o:""}`,u=i[l];i[l]=u?Object.assign(Object.assign(Object.assign({},u),n),{selector:[...u.selector,...n.selector]}):n}else this._view.interaction(n.type,n)}),Object.keys(i).forEach(n=>{const o=this._view.interaction(i[n].type,i[n]);if(this._compileChart){const l=this._compileChart.getRegionsInIds([i[n].regionId])[0];l&&l.interaction.addVgrammarInteraction(o.getStartState(),o)}})}}compile(e,i){if(this._released)return;const{chart:n}=e;this._compileChart=n,this.initView(),this._view&&(n.compile(),n.afterCompile(),this.updateDepend(),this.compileInteractions())}clearNextRender(){return!!this._nextRafId&&(vglobal.getCancelAnimationFrame()(this._nextRafId),this._nextRafId=null,!0)}clear(e,i=!1){const{chart:n}=e;this.clearNextRender(),n.clear(),this.releaseGrammar(i)}renderNextTick(e){this._released||this._nextRafId||(this._nextRafId=vglobal.getRequestAnimationFrame()(()=>{this._nextRafId=null,this.render(e)}))}render(e){var i,n;this._released||(this.initView(),this._view&&((i=this._view)===null||i===void 0||i.run(e),this.clearNextRender()&&((n=this._view)===null||n===void 0||n.run(e))))}updateViewBox(e,i=!0){this._view&&this._view.renderer.setViewBox(e,i)}resize(e,i,n=!0){this._view&&(this._width=e,this._height=i,this._view.resize(e,i),n&&this.render({morph:!1}))}setBackground(e){var i;(i=this._view)===null||i===void 0||i.background(e)}setSize(e,i){this._width=e,this._height=i,this._view&&(this._view.width(e),this._view.height(i))}setViewBox(e,i=!0){this._view&&this._view.renderer.setViewBox(e,i)}addEventListener(e,i,n){var o,l;if(this._option.interactive!==!1){if(e===Event_Source_Type.chart){const u=(function(d,f){var g,_,y;const b=(_=(g=f==null?void 0:f.mark)===null||g===void 0?void 0:g.getContext())!==null&&_!==void 0?_:{},S=isValid(b.modelId)?b.modelId:null,v=isValid(b.markId)?b.markId:null,A=isValid(b.modelUserId)?b.modelUserId:null,x=isValid(b.markUserId)?b.markUserId:null,T={event:d,type:i,source:e,item:f,datum:((y=f==null?void 0:f.getDatum)===null||y===void 0?void 0:y.call(f))||null,markId:v,modelId:S,markUserId:x,modelUserId:A};n.call(null,T)}).bind(this);this._viewListeners.set(n,{type:i,callback:u}),(o=this._view)===null||o===void 0||o.addEventListener(i,u)}else if(e===Event_Source_Type.window){const u=(function(f){const g={event:f,type:i,source:e,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};n.call(null,g)}).bind(this);this._windowListeners.set(n,{type:i,callback:u});const d=this._getGlobalThis();d==null||d.addEventListener(i,u)}else if(e===Event_Source_Type.canvas){const u=(function(f){const g={event:f,type:i,source:e,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};n.call(null,g)}).bind(this);this._canvasListeners.set(n,{type:i,callback:u});const d=(l=this.getStage())===null||l===void 0?void 0:l.window;d==null||d.addEventListener(i,u)}}}removeEventListener(e,i,n){var o,l,u,d,f;if(this._option.interactive!==!1){if(e===Event_Source_Type.chart){const g=(o=this._viewListeners.get(n))===null||o===void 0?void 0:o.callback;g&&((l=this._view)===null||l===void 0||l.removeEventListener(i,g)),this._viewListeners.delete(n)}else if(e===Event_Source_Type.window){const g=this._getGlobalThis(),_=(u=this._windowListeners.get(n))===null||u===void 0?void 0:u.callback;_&&(g==null||g.removeEventListener(i,_)),this._windowListeners.delete(n)}else if(e===Event_Source_Type.canvas){const g=(d=this.getStage())===null||d===void 0?void 0:d.window,_=(f=this._canvasListeners.get(n))===null||f===void 0?void 0:f.callback;g&&_&&(g==null||g.removeEventListener(i,_)),this._canvasListeners.delete(n)}}}releaseEvent(){const e=this.getStage();e&&e.hooks.afterRender.unTap("chart-event",this.handleStageRender),this._viewListeners.clear(),this._windowListeners.clear(),this._canvasListeners.clear()}release(){var e;this.clearNextRender(),this.releaseEvent(),this._option=this._container=null,this._releaseModel(),(e=this._view)===null||e===void 0||e.release(),this._view=null,this.isInited=!1,this._compileChart=null,this._released=!0}releaseGrammar(e=!1){var i,n;this._releaseModel(),e&&((i=this._view)===null||i===void 0||i.removeAllGraphicItems()),(n=this._view)===null||n===void 0||n.removeAllGrammars()}_releaseModel(){Object.keys(this._model).forEach(e=>{Object.values(this._model[e]).forEach(i=>{Object.values(i).forEach(n=>{n.removeProduct(!0)})}),this._model[e]={}})}addGrammarItem(e){const i=e.getProduct();if(isNil(i))return;const n=i.id(),o=e.grammarType;isNil(this._model[o][n])&&(this._model[o][n]={}),this._model[o][n][e.id]=e}removeGrammarItem(e,i){var n;const o=e.getProduct();if(isNil(o))return;const l=o.id(),u=e.grammarType,d=this._model[u][l];isValid(d)&&(delete d[e.id],Object.keys(d).length===0&&delete this._model[u][l]),i||(n=this._view)===null||n===void 0||n.removeGrammar(o)}addInteraction(e){this._interactions||(this._interactions=[]),this._interactions.push(e)}removeInteraction(e){this._interactions&&(this._interactions=this._interactions.filter(i=>i.seriesId!==e))}updateDepend(e){return isValid(e)&&e.length>0?e.every(i=>i.updateDepend()):(Object.values(this._model).forEach(i=>{Object.values(i).forEach(n=>{const o=Object.values(n),l=o[0].getProduct(),u=o.reduce((d,f)=>f.getDepend().length>0?d.concat(f.getDepend()):d,[]).filter(d=>!!d).map(d=>d.getProduct());l.depend(u)})}),!0)}_getGlobalThis(){var e;return isTrueBrowser(this._option.mode)?globalThis:(e=this.getStage())===null||e===void 0?void 0:e.window}}var __awaiter$1=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})};function URLToImage(r="vchart",e){const i=document.createElement("a");i.setAttribute("href",e),i.setAttribute("target","_blank"),i.setAttribute("download",`${r}.png`),i.dispatchEvent(new MouseEvent("click"))}function OffscreenCanvasToDataURL(r){return new Promise(e=>{r.convertToBlob().then(i=>{const n=new FileReader;n.readAsDataURL(i),n.onload=()=>{e(n.result)}})})}function getCanvasDataURL(r,e){var i;return __awaiter$1(this,void 0,void 0,function*(){if(!r)return"";try{if(OffscreenCanvas!==void 0&&r instanceof OffscreenCanvas)return OffscreenCanvasToDataURL(r)}catch(n){((i=e==null?void 0:e.onError)!==null&&i!==void 0?i:error$1)(`getCanvasDataURL error : ${n.toString()}`)}return r.toDataURL()})}function setDefaultCrosshairForCartesianChart(r){r.crosshair=array(r.crosshair||{}).map(e=>mergeSpec({[r.direction==="horizontal"?"yField":"xField"]:{visible:!0,line:{visible:!0,type:"rect"}}},e))}function calculateChartSize(r,e,i){var n;const{width:o,height:l}=r;if(isValid(o)&&isValid(l))return{width:o,height:l};let u=i.width,d=i.height;const f=e.container,g=e.canvas;if(f){const{width:_,height:y}=getContainerSize(f,i.width,i.height);u=_,d=y}else if(g&&isTrueBrowser(e.mode)){let _;_=isString(g)?vglobal.getElementById(g):g;const{width:y,height:b}=getContainerSize(_,i.width,i.height);u=y,d=b}else if(isMiniAppLikeMode(e.mode)&&(!((n=e.modeParams)===null||n===void 0)&&n.domref)){const _=e.modeParams.domref;u=_.width,d=_.height}return u=o??u,d=l??d,{width:u,height:d}}function mergeUpdateResult(r,...e){const i=n=>e.reduce((o,l)=>o||(l==null?void 0:l[n]),r[n]);return Object.assign(r,{change:i("change"),reCompile:i("reCompile"),reMake:i("reMake"),reRender:i("reRender"),reSize:i("reSize"),reTransformSpec:i("reTransformSpec"),changeTheme:i("changeTheme"),changeBackground:i("changeBackground")}),r}function getTrimPaddingConfig(r,e){return r==="line"||r==="area"||r==="common"&&e.series.every(i=>i.type==="area"||i.type==="line")?{paddingInner:1,paddingOuter:0}:{paddingOuter:0}}var STATE_VALUE_ENUM;(function(r){r.STATE_NORMAL="normal",r.STATE_HOVER="hover",r.STATE_HOVER_REVERSE="hover_reverse",r.STATE_DIMENSION_HOVER="dimension_hover",r.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",r.STATE_SELECTED="selected",r.STATE_SELECTED_REVERSE="selected_reverse",r.STATE_SANKEY_EMPHASIS="selected",r.STATE_SANKEY_EMPHASIS_REVERSE="blur"})(STATE_VALUE_ENUM||(STATE_VALUE_ENUM={}));var STATE_VALUE_ENUM_REVERSE;(function(r){r.STATE_HOVER_REVERSE="hover_reverse",r.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",r.STATE_SELECTED_REVERSE="selected_reverse"})(STATE_VALUE_ENUM_REVERSE||(STATE_VALUE_ENUM_REVERSE={}));class MarkSet{constructor(){this._children=[],this._markNameMap={},this._infoMap=new Map}getMarkNameMap(){return this._markNameMap}addMark(e,i){isNil(e)||(this._children.push(e),this._markNameMap[e.name]=e,this._infoMap.set(e,merge$1({},MarkSet.defaultMarkInfo,i)))}removeMark(e){const i=this._children.findIndex(n=>n.name===e);i>=0&&(this._infoMap.delete(this._children[i]),delete this._markNameMap[e],this._children.splice(i,1))}clear(){this._children=[],this._markNameMap={},this._infoMap.clear()}forEach(e){this._children.forEach(e)}includes(e,i){return this._children.includes(e,i)}get(e){return isNaN(Number(e))?this._markNameMap[e]:this._children[e]}getMarks(){return this._children.slice()}getMarksInType(e){const i=array(e);return this._children.filter(n=>i.includes(n.type))}getMarkInId(e){return this._children.find(i=>i.id===e)}getMarkWithInfo(e){return this._children.find(i=>Object.keys(e).every(n=>e[n]===this._infoMap.get(i)[n]))}}MarkSet.defaultMarkInfo={};class DimensionTrigger{get hover(){return this._hover}get select(){return this._select}constructor(e){this._marks=new MarkSet,this._markReverse=new MarkSet,this.onHover=i=>{switch(i.action){case"enter":this.interaction.getEventElement(STATE_VALUE_ENUM.STATE_DIMENSION_HOVER).forEach(n=>this.interaction.addEventElement(STATE_VALUE_ENUM.STATE_DIMENSION_HOVER_REVERSE,n)),this.interaction.clearEventElement(STATE_VALUE_ENUM.STATE_DIMENSION_HOVER,!1),this.getEventElement(i).forEach(n=>this.interaction.addEventElement(STATE_VALUE_ENUM.STATE_DIMENSION_HOVER,n)),this.interaction.reverseEventElement(STATE_VALUE_ENUM.STATE_DIMENSION_HOVER);break;case"leave":this.interaction.clearEventElement(STATE_VALUE_ENUM.STATE_DIMENSION_HOVER,!0),i=null}},this._option=e,this.event=this._option.model.getOption().getChart().getEvent(),this.interaction=e.interaction,this.initConfig(e.mode)}setStateKeys(e){}registerMark(e){isEmpty(e.stateStyle[STATE_VALUE_ENUM.STATE_DIMENSION_HOVER])||this._marks.addMark(e),isEmpty(e.stateStyle[STATE_VALUE_ENUM.STATE_DIMENSION_HOVER_REVERSE])||this._markReverse.addMark(e)}init(){this.initEvent()}release(){this.releaseEvent()}initEvent(){this.event.on(DimensionEventEnum.dimensionHover,this.onHover)}releaseEvent(){this.event.release()}initConfig(e){}getEventElement(e,i=!1){const n=[];return e.dimensionInfo.forEach(o=>{o.data.forEach(l=>{(i?this._markReverse:this._marks).getMarks().filter(u=>u.model===l.series&&u.getVisible()).forEach(u=>{const d=u.getProduct();if(!d||!d.elements)return;const f=d.elements.filter(g=>{const _=g.getDatum();let y;return y=isArray(_)?_.every((b,S)=>b===l.datum[S]):l.datum.some(b=>b===_),i?!y:y});n.push(...f)})})}),n}}function isStateAttrChangeable(r,e,i){var n;const o=(n=e[r])===null||n===void 0?void 0:n.style;return isGradientAttribute(r,o)||isFunction(o)?!0:!(!(o!=null&&o.scale)||o.field===i)}function isGradientAttribute(r,e){return(r==="fill"||r==="stroke")&&(e==null?void 0:e.gradient)&&(e==null?void 0:e.stops)}const DEFAULT_STATE_VALUE_ENUM={};Object.values(STATE_VALUE_ENUM).forEach(r=>{DEFAULT_STATE_VALUE_ENUM[r]=!0});function stateInDefaultEnum(r){return!!DEFAULT_STATE_VALUE_ENUM[r]}const DEFAULT_STATE_VALUE_TO_REVERSE={[STATE_VALUE_ENUM.STATE_HOVER]:STATE_VALUE_ENUM.STATE_HOVER_REVERSE,[STATE_VALUE_ENUM.STATE_SELECTED]:STATE_VALUE_ENUM.STATE_SELECTED_REVERSE,[STATE_VALUE_ENUM.STATE_DIMENSION_HOVER]:STATE_VALUE_ENUM.STATE_DIMENSION_HOVER_REVERSE};function stateToReverse(r){return DEFAULT_STATE_VALUE_TO_REVERSE[r]}class Interaction{constructor(){this._stateMarks=new Map,this._stateElements=new Map,this._vgrammarInteractions=new Map,this._disableTriggerEvent=!1}addVgrammarInteraction(e,i){e&&(this._vgrammarInteractions.get(e)?this._vgrammarInteractions.get(e).push(i):this._vgrammarInteractions.set(e,[i]))}static markStateEnable(e,i){return!isEmpty(e.stateStyle[i])}setDisableActiveEffect(e){this._disableTriggerEvent=e}registerMark(e,i){var n;this._stateMarks.has(e)||this._stateMarks.set(e,[]),(n=this._stateMarks.get(e))===null||n===void 0||n.push(i)}getStateMark(e){return this._stateMarks.get(e)}filterEventMark(e,i){var n;return!(!e.mark||!(!((n=this._stateMarks.get(i))===null||n===void 0)&&n.includes(e.mark)))}getEventElement(e){var i;return(i=this._stateElements.get(e))!==null&&i!==void 0?i:[]}getEventElementData(e){return this.getEventElement(e).map(i=>i.getDatum())}exchangeEventElement(e,i){var n;if(this._disableTriggerEvent)return;const o=stateToReverse(e);(n=this._stateElements.get(e))===null||n===void 0||n.forEach(l=>{l.removeState(e),o&&this.addEventElement(o,l)}),i.getStates().includes(e)||(i.addState(e),o&&i.removeState(o)),this._stateElements.set(e,[i])}removeEventElement(e,i){var n,o;if(this._disableTriggerEvent)return;i.removeState(e);const l=(o=(n=this._stateElements.get(e))===null||n===void 0?void 0:n.filter(d=>d!==i))!==null&&o!==void 0?o:[];this._stateElements.set(e,l);const u=stateToReverse(e);u&&(l.length===0?this.clearEventElement(u,!1):this.addEventElement(u,i))}addEventElement(e,i){var n;if(this._disableTriggerEvent)return;i.getStates().includes(e)||i.addState(e);const o=(n=this._stateElements.get(e))!==null&&n!==void 0?n:[];o.push(i),this._stateElements.set(e,o)}clearEventElement(e,i){var n;if(!this._disableTriggerEvent&&((n=this._stateElements.get(e))===null||n===void 0||n.forEach(o=>{o.removeState(e)}),this._stateElements.set(e,[]),i)){const o=stateToReverse(e);o&&this.clearEventElement(o,!1)}}clearAllEventElement(){if(!this._disableTriggerEvent)for(const[e,i]of this._stateElements)i.forEach(n=>{n.clearStates()}),this._stateElements.set(e,[])}reverseEventElement(e){if(this._disableTriggerEvent)return;const i=stateToReverse(e);if(!i)return;const n=this.getStateMark(i);if(!n)return;const o=this.getEventElement(e);o.length&&(this.getEventElement(i).length||(o.length===1?n.forEach(l=>{l.getProduct().elements.filter(u=>u!==o[0]).forEach(u=>{this.addEventElement(i,u)})}):n.forEach(l=>{l.getProduct().elements.filter(u=>!o.includes(u)).forEach(u=>{this.addEventElement(i,u)})})))}startInteraction(e,i){const n=this._vgrammarInteractions.get(e);n&&n.forEach(o=>{o.start(i)})}resetInteraction(e,i){const n=this._vgrammarInteractions.get(e);n&&n.forEach(o=>{o.reset(i)})}resetAllInteraction(){for(const[e,i]of this._vgrammarInteractions)i&&i.forEach(n=>{n.reset(null)})}}const USER_LAYOUT_RECT_LEVEL=9,DEFAULT_LAYOUT_RECT_LEVEL=0;var LayoutZIndex;(function(r){r[r.SeriesGroup=0]="SeriesGroup",r[r.Axis_Grid=50]="Axis_Grid",r[r.CrossHair_Grid=100]="CrossHair_Grid",r[r.Region=450]="Region",r[r.Mark=300]="Mark",r[r.Node=400]="Node",r[r.Axis=100]="Axis",r[r.MarkLine=500]="MarkLine",r[r.MarkArea=100]="MarkArea",r[r.MarkPoint=500]="MarkPoint",r[r.DataZoom=500]="DataZoom",r[r.ScrollBar=500]="ScrollBar",r[r.Player=500]="Player",r[r.Legend=500]="Legend",r[r.CrossHair=500]="CrossHair",r[r.Indicator=500]="Indicator",r[r.Title=500]="Title",r[r.Label=500]="Label",r[r.Brush=500]="Brush",r[r.CustomMark=500]="CustomMark",r[r.Interaction=700]="Interaction"})(LayoutZIndex||(LayoutZIndex={}));var LayoutLevel;(function(r){r[r.Indicator=10]="Indicator",r[r.Region=20]="Region",r[r.Axis=30]="Axis",r[r.DataZoom=40]="DataZoom",r[r.Player=40]="Player",r[r.ScrollBar=40]="ScrollBar",r[r.Legend=50]="Legend",r[r.Title=70]="Title",r[r.CustomMark=70]="CustomMark"})(LayoutLevel||(LayoutLevel={}));var AttributeLevel;(function(r){r[r.Default=0]="Default",r[r.Theme=1]="Theme",r[r.Chart=2]="Chart",r[r.Base_Series=3]="Base_Series",r[r.Series=4]="Series",r[r.Mark=5]="Mark",r[r.User_Chart=6]="User_Chart",r[r.User_Series=7]="User_Series",r[r.User_Mark=8]="User_Mark",r[r.User_SeriesStyle=9]="User_SeriesStyle",r[r.Built_In=99]="Built_In"})(AttributeLevel||(AttributeLevel={}));class CompilableBase{getOption(){return this._option}constructor(e){this._option=e,this.getCompiler=this._option.getCompiler}getVGrammarView(){var e;return(e=this.getCompiler())===null||e===void 0?void 0:e.getVGrammarView()}release(){this._option=null,this.getCompiler=null}}class GrammarItem extends CompilableBase{constructor(){super(...arguments),this.id=createID(),this._compiledProductId=null,this._depend=[]}getProduct(){if(isValid(this._product))return this._product;const e=this.getVGrammarView(),i=this.getProductId();return isValid(i)&&isValid(e)&&(this._product=this._lookupGrammar(i)),this._product}getProductId(){var e;return(e=this._compiledProductId)!==null&&e!==void 0?e:this.generateProductId()}getDepend(){return this._depend}setDepend(...e){this._depend=e}compile(e){this._compileProduct(e),this._afterCompile(e)}_afterCompile(e){var i;isValid(this._product)&&((i=this.getCompiler())===null||i===void 0||i.addGrammarItem(this))}updateDepend(){if(isValid(this._product)){const e=this.getDepend().map(i=>i.getProduct()).filter(isValid);return this._product.depend(e),e.length===this.getDepend().length}return!1}release(){this.removeProduct(),super.release(),this._depend=[]}removeProduct(e){this.getCompiler().removeGrammarItem(this,e),this._product=null,this._compiledProductId=null}}class CompilableSignal extends GrammarItem{getValue(){return this._value}getUpdateFunc(){return this._updateFunc}constructor(e,i,n,o){super(e),this.grammarType=GrammarType.signal,this.name=i,this._value=n,this._updateFunc=o}updateSignal(e,i){this._value=e,this._updateFunc=i,this.compile()}_compileProduct(){const e=this.getVGrammarView();if(e){if(!this.getProduct()){const i=this.getProductId();this._product=e.signal().id(i),this._compiledProductId=i}isValid(this._value)&&this._product.value(this._value),isValid(this._updateFunc)&&this._product.update(this._updateFunc)}}generateProductId(){return this.name}_lookupGrammar(e){var i;return(i=this.getCompiler().getVGrammarView())===null||i===void 0?void 0:i.getSignalById(e)}}class SignalManager extends CompilableBase{constructor(){super(...arguments),this._signalMap={}}getSignalMap(){return this._signalMap}getSignal(e){return this._signalMap[e]}updateSignal(e,i,n){this._signalMap[e]?this._signalMap[e].updateSignal(i,n):(this._signalMap[e]=new CompilableSignal(this._option,e,i,n),this._signalMap[e].compile())}compile(){Object.values(this._signalMap).forEach(e=>{e.compile()})}release(){super.release(),Object.values(this._signalMap).forEach(e=>{e.release()}),this._signalMap={}}}class StateManager extends SignalManager{getStateMap(){return this._stateMap}_getDefaultStateMap(){return{}}constructor(e){super(e),e.stateKeyToSignalName?this.stateKeyToSignalName=e.stateKeyToSignalName:this.stateKeyToSignalName=()=>"state_signal",this.initStateMap()}initStateMap(e){this._stateMap=e??this._getDefaultStateMap()}compile(e){const i=e??this._stateMap;Object.keys(i).forEach(n=>{const o=this.stateKeyToSignalName(n),l=i[n];this.updateSignal(o,l)})}updateState(e,i){if(e&&(merge$1(this._stateMap,e),this.compile(e),!i))return this.getCompiler().renderNextTick()}}class AnimateManager extends StateManager{constructor(){super(...arguments),this.id=createID(),this.stateKeyToSignalName=e=>`${PREFIX}_animate_${this.id}_${e}`}getAnimationStateSignalName(){return this.stateKeyToSignalName("animationState")}updateAnimateState(e,i){e===AnimationStateEnum.update?this.updateState({animationState:{callback:(n,o)=>o.diffState}},i):e===AnimationStateEnum.appear?this.updateState({animationState:{callback:(n,o)=>o.diffState==="exit"?AnimationStateEnum.none:AnimationStateEnum.appear}},i):this.updateState({animationState:{callback:(n,o)=>e}},i)}_getDefaultStateMap(){return{animationState:{callback:(e,i)=>i.diffState==="exit"?AnimationStateEnum.exit:i.diffState==="update"?AnimationStateEnum.update:AnimationStateEnum.appear}}}}class BaseModelSpecTransformer{constructor(e){this._option=e,this.type=e.type}_initTheme(e,i){return this._theme=this.getTheme(e,i),this._mergeThemeToSpec(e,i)}getTheme(e,i){}transformSpec(e,i,n){this._transformSpecBeforeMergingTheme(e,i,n);const o=this._initTheme(e,i);return this._transformSpecAfterMergingTheme(o.spec,i,n),o}_transformSpecBeforeMergingTheme(e,i,n){}_transformSpecAfterMergingTheme(e,i,n){}_mergeThemeToSpec(e,i){const n=this._theme;if(this._shouldMergeThemeToSpec()){const o=this._getDefaultSpecFromChart(i),l=u=>mergeSpec({},n,o,u);return isArray(e)?{spec:e.map(u=>l(u)),theme:n}:{spec:l(e),theme:n}}return{spec:e,theme:n}}_shouldMergeThemeToSpec(){return!0}_getDefaultSpecFromChart(e){}}class BaseModel extends CompilableBase{getSpec(){return this._spec||{}}getSpecPath(){var e;return(e=this._option)===null||e===void 0?void 0:e.specPath}getSpecInfoPath(){var e,i,n;return(i=(e=this._option)===null||e===void 0?void 0:e.specInfoPath)!==null&&i!==void 0?i:(n=this._option)===null||n===void 0?void 0:n.specPath}getData(){return this._data}get layout(){return this._layout}getOption(){return this._option}getMarks(){var e,i;return(i=(e=this._marks)===null||e===void 0?void 0:e.getMarks())!==null&&i!==void 0?i:[]}getMarkNameMap(){var e;return(e=this._marks)===null||e===void 0?void 0:e.getMarkNameMap()}getMarkSet(){return this._marks}getChart(){return this._option.getChart()}get _theme(){var e;return(e=this.getSpecInfo())===null||e===void 0?void 0:e.theme}constructor(e,i){var n;super(i),this.transformerConstructor=BaseModelSpecTransformer,this.type="null",this.modelType="null",this.userId=void 0,this._data=null,this._layout=null,this.specKey="",this._marks=new MarkSet,this._lastLayoutRect=null,this.id=createID(),this.userId=e.id,this._spec=e,this.effect={},this.event=new Event$1(i.eventDispatcher,i.mode),(n=i.map)===null||n===void 0||n.set(this.id,this)}_releaseEvent(){this.event.release()}created(){this.setAttrFromSpec()}init(e){}afterInit(){}getVisible(){var e;return((e=this._spec)===null||e===void 0?void 0:e.visible)!==!1}onLayoutStart(e,i,n){var o;(o=this._layout)===null||o===void 0||o.onLayoutStart(e,i,n)}onLayoutEnd(e){var i;(i=this._layout)===null||i===void 0||i.onLayoutEnd(e),this.getMarks().forEach(n=>n.updateLayoutState(!0,!0))}onEvaluateEnd(e){}onDataUpdate(){}beforeRelease(){}release(){var e;this._releaseEvent(),this._spec=void 0,this.getMarks().forEach(i=>i.release()),(e=this._data)===null||e===void 0||e.release(),this._data=null,this._marks.clear(),super.release()}updateSpec(e){const i=this._compareSpec(e,this._spec);return this._spec=e,i}_compareSpec(e,i){return{change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1}}reInit(e){e&&(this._spec=e),this.setAttrFromSpec()}updateLayoutAttribute(){}setAttrFromSpec(){var e;(e=this._layout)===null||e===void 0||e.setAttrFromSpec(this._spec,this._option.getChartViewRect())}_convertMarkStyle(e){return Object.assign({},e)}setMarkStyle(e,i,n,o){isValid(e)&&isValid(i)&&e.setStyle(this._convertMarkStyle(i),n,o)}initMarkStyleWithSpec(e,i,n){if(!isValid(e)||!isValid(i))return;const{style:o,state:l}=i,u=Object.assign({},i);o&&(u.style=this._convertMarkStyle(o)),l&&(u.state={},Object.keys(l).forEach(d=>{u.state[d]=this._convertMarkStyle(l[d])})),e.initStyleWithSpec(u,n)}stateKeyToSignalName(e,i){let n=`${PREFIX}_${this.modelType}_${this.type}_${this.id}_${e}`;return i&&(n+=`_${i}`),n}compileData(){var e;(e=this._data)===null||e===void 0||e.compile()}compileMarks(e){this.getMarks().forEach(i=>{i.compile({group:e})})}_createMark(e,i={},n){const{type:o,name:l}=e,u=Factory$1.createMark(o,l,Object.assign({model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._option.globalScale},i));return u&&(u.created(),n&&u.setMarkConfig(n)),u}_getDataIdKey(){}getColorScheme(){var e,i;return(i=(e=this._option).getTheme)===null||i===void 0?void 0:i.call(e).colorScheme}getSpecInfo(){var e,i,n;const o=(n=(i=(e=this._option).getSpecInfo)===null||i===void 0?void 0:i.call(e))!==null&&n!==void 0?n:{};return getProperty(o,this.getSpecInfoPath())}getSpecIndex(){const e=this.getSpecPath();if(!(e!=null&&e.length))return 0;const i=Number(e[e.length-1]);return isNaN(i)?0:i}}class LayoutItem{getSpec(){return this._spec||{}}getLayoutStartPoint(){return this._layoutStartPoint}get layoutRectLevelMap(){return this._layoutRectLevelMap}get minWidth(){return this._minWidth}set minWidth(e){this._minWidth=e}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth=e}get minHeight(){return this._minHeight}set minHeight(e){this._minHeight=e}get maxHeight(){return this._maxHeight}set maxHeight(e){this._maxHeight=e}getLastComputeOutBounds(){return this._lastComputeOutBounds}get layoutOrient(){return this._layoutOrient}set layoutOrient(e){this._layoutOrient=e}get model(){return this._model}get type(){return this._model.type}constructor(e,i){var n;this.layoutClip=!1,this.autoIndent=!1,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:0,height:0},this._layoutRectLevelMap={width:DEFAULT_LAYOUT_RECT_LEVEL,height:DEFAULT_LAYOUT_RECT_LEVEL},this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._lastComputeRect=null,this._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0},this.getLayoutRect=()=>this._layoutRect,this.layoutType="normal",this._layoutOrient="left",this.layoutPaddingLeft=0,this.layoutPaddingTop=0,this.layoutPaddingRight=0,this.layoutPaddingBottom=0,this.layoutOffsetX=0,this.layoutOffsetY=0,this.layoutLevel=LayoutLevel.Region,this._model=e,this._option=i,this.layoutLevel=i.layoutLevel,this.layoutType=i.layoutType,i.layoutOrient&&(this.layoutOrient=i.layoutOrient),this._spec=(n=e==null?void 0:e.getSpec)===null||n===void 0?void 0:n.call(e)}_setLayoutAttributeFromSpec(e,i){var n,o,l,u;if(this._spec&&this._spec.visible!==!1){const d=normalizeLayoutPaddingSpec(e.padding),f=calcPadding(d,i,i);this.layoutPaddingLeft=f.left,this.layoutPaddingRight=f.right,this.layoutPaddingTop=f.top,this.layoutPaddingBottom=f.bottom,this._minHeight=isNil(e.minHeight)?(n=this._minHeight)!==null&&n!==void 0?n:null:calcLayoutNumber(e.minHeight,i.height,i),this._maxHeight=isNil(e.maxHeight)?(o=this._maxHeight)!==null&&o!==void 0?o:null:calcLayoutNumber(e.maxHeight,i.height,i),this._minWidth=isNil(e.minWidth)?(l=this._minWidth)!==null&&l!==void 0?l:null:calcLayoutNumber(e.minWidth,i.width,i),this._maxWidth=isNil(e.maxWidth)?(u=this._maxWidth)!==null&&u!==void 0?u:null:calcLayoutNumber(e.maxWidth,i.width,i),e.width&&this.setLayoutRect({width:calcLayoutNumber(e.width,i.width,i)},{width:USER_LAYOUT_RECT_LEVEL}),e.height&&this.setLayoutRect({height:calcLayoutNumber(e.height,i.height,i)},{height:USER_LAYOUT_RECT_LEVEL}),isNil(e.offsetX)||(this.layoutOffsetX=calcLayoutNumber(e.offsetX,i.width,i)),isNil(e.offsetY)||(this.layoutOffsetY=calcLayoutNumber(e.offsetY,i.height,i)),e.alignSelf&&(this.alignSelf=e.alignSelf)}}setAttrFromSpec(e,i){var n,o,l,u;this._spec=e,this.layoutType=(n=e.layoutType)!==null&&n!==void 0?n:this.layoutType,this.layoutLevel=(o=e.layoutLevel)!==null&&o!==void 0?o:this.layoutLevel,this.layoutOrient=(l=e.orient)!==null&&l!==void 0?l:this.layoutOrient,this._setLayoutAttributeFromSpec(e,i),this.layoutClip=(u=e.clip)!==null&&u!==void 0?u:this.layoutClip}onLayoutStart(e,i,n){this._setLayoutAttributeFromSpec(this._spec,i)}onLayoutEnd(e){}_getAbsoluteSpecValue(e){const i={top:null,bottom:null,left:null,right:null};return["top","bottom","left","right"].forEach(n=>{isNil(this._spec[n])||(i[n]=calcLayoutNumber(this._spec[n],n==="top"||n==="bottom"?e.height:e.width,e))}),i}absoluteLayoutInRect(e){const{top:i,bottom:n,left:o,right:l}=this._getAbsoluteSpecValue(e),u={width:e.width-this.layoutPaddingLeft-this.layoutPaddingRight,height:e.height-this.layoutPaddingTop-this.layoutPaddingBottom};isNil(o)||(u.width-=o),isNil(l)||(u.width-=l),isNil(i)||(u.height-=i),isNil(n)||(u.height-=n),this.setLayoutRect(u);const{width:d,height:f}=this.computeBoundsInRect(this.getLayoutRect());this.setLayoutRect({width:d,height:f});const g={x:e.x,y:e.y};this._spec.center===!0?(g.x=e.x+.5*e.width-.5*d,g.y=e.y+.5*e.height-.5*f):(isNil(o)?isNil(l)||(g.x=e.x+e.width-this.layoutPaddingRight-l-d):g.x=e.x+o+this.layoutPaddingLeft,isNil(i)?isNil(n)||(g.y=e.y+e.height-this.layoutPaddingBottom-n-f):g.y=e.y+i+this.layoutPaddingTop),this.setLayoutStartPosition(g)}setLayoutStartPosition(e){var i,n;this._option.transformLayoutPosition&&(e=this._option.transformLayoutPosition(e)),isValidNumber(e.x)&&(this._layoutStartPoint.x=e.x),isValidNumber(e.y)&&(this._layoutStartPoint.y=e.y),(n=(i=this._model).afterSetLayoutStartPoint)===null||n===void 0||n.call(i,this._layoutStartPoint)}setLayoutRect({width:e,height:i},n){var o,l,u,d;isValidNumber(e)&&((o=n==null?void 0:n.width)!==null&&o!==void 0?o:DEFAULT_LAYOUT_RECT_LEVEL)>=this._layoutRectLevelMap.width&&(this._layoutRect.width=e,this._layoutRectLevelMap.width=(l=n==null?void 0:n.width)!==null&&l!==void 0?l:DEFAULT_LAYOUT_RECT_LEVEL),isValidNumber(i)&&((u=n==null?void 0:n.height)!==null&&u!==void 0?u:DEFAULT_LAYOUT_RECT_LEVEL)>=this._layoutRectLevelMap.height&&(this._layoutRect.height=i,this._layoutRectLevelMap.height=(d=n==null?void 0:n.height)!==null&&d!==void 0?d:DEFAULT_LAYOUT_RECT_LEVEL),this.setRectInSpec(this._layoutRect)}getLayout(){return{x:this._layoutStartPoint.x,y:this._layoutStartPoint.y,width:this._layoutRect.width,height:this._layoutRect.height}}mergeLayoutRect({width:e,height:i}){const n={width:e,height:i};return this._layoutRectLevelMap.width>DEFAULT_LAYOUT_RECT_LEVEL&&(n.width=this._layoutRect.width),this._layoutRectLevelMap.height>DEFAULT_LAYOUT_RECT_LEVEL&&(n.height=this._layoutRect.height),n}getOrientPosAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"x":"y"}getOrientSizeAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"width":"height"}changeBoundsBySetting(e){return this._layoutRectLevelMap.width>DEFAULT_LAYOUT_RECT_LEVEL&&(e.x2=e.x1+this._layoutRect.width),this._layoutRectLevelMap.height>DEFAULT_LAYOUT_RECT_LEVEL&&(e.y2=e.y1+this._layoutRect.height),e.x1-=this._layoutStartPoint.x,e.x2-=this._layoutStartPoint.x,e.y1-=this._layoutStartPoint.y,e.y2-=this._layoutStartPoint.y,e}setRectInSpec(e){const i=Object.assign({},e);return this._layoutRectLevelMap.width<USER_LAYOUT_RECT_LEVEL?(isNil(this._minWidth)||(i.width=Math.max(i.width,this._minWidth)),isNil(this._maxWidth)||(i.width=Math.min(i.width,this._maxWidth))):i.width=this._layoutRect.width,this._layoutRectLevelMap.height<USER_LAYOUT_RECT_LEVEL?(isNil(this._minHeight)||(i.height=Math.max(i.height,this._minHeight)),isNil(this._maxHeight)||(i.height=Math.min(i.height,this._maxHeight))):i.height=this._layoutRect.height,i}computeBoundsInRect(e){if(this._lastComputeRect=e,!(this.layoutType!=="region-relative"&&this.layoutType!=="region-relative-overlap"||(this._layoutRectLevelMap.width!==USER_LAYOUT_RECT_LEVEL||this.layoutOrient!=="left"&&this.layoutOrient!=="right")&&(this._layoutRectLevelMap.height!==USER_LAYOUT_RECT_LEVEL||this.layoutOrient!=="bottom"&&this.layoutOrient!=="top")))return this._layoutRect;const i=Object.assign({},this._model.getBoundsInRect(this.setRectInSpec(e),e));this.changeBoundsBySetting(i),this.autoIndent&&i.x2-i.x1>0&&i.y2-i.y1>0&&(this._lastComputeOutBounds.x1=Math.ceil(-i.x1),this._lastComputeOutBounds.x2=Math.ceil(i.x2-e.width),this._lastComputeOutBounds.y1=Math.ceil(-i.y1),this._lastComputeOutBounds.y2=Math.ceil(i.y2-e.height));let n=this.setRectInSpec(boundsInRect(i,e));return this._option.transformLayoutRect&&(n=this._option.transformLayoutRect(n)),n}getModelId(){return this._model.id}getModelVisible(){return this._model.getVisible()}}class LayoutModel extends BaseModel{constructor(){super(...arguments),this.layoutType="normal",this.layoutLevel=0,this.layoutZIndex=0,this._forceLayoutTag=!1,this._layout=null,this._orient=null,this._layoutRect={width:0,height:0},this._layoutStartPos={x:0,y:0},this._isLayout=!0,this.getGraphicBounds=()=>this._layout?{x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}:{x1:0,x2:0,y1:0,y2:0},this._transformLayoutRect=null,this._transformLayoutPosition=null}get layoutOrient(){return this._orient}set layoutOrient(e){this._orient=e,this._layout&&(this._layout.layoutOrient=e)}initLayout(){this.layoutType!=="none"&&(this._layout=new LayoutItem(this,{layoutType:this.layoutType,layoutLevel:this.layoutLevel,layoutOrient:this._orient,transformLayoutRect:this._transformLayoutRect,transformLayoutPosition:this._transformLayoutPosition}),this._orient&&this._orient!=="radius"&&this._orient!=="angle"&&this._layout&&(this._layout.layoutOrient=this._orient))}onLayoutStart(e,i,n){this._isLayout=!0,super.onLayoutStart(e,i,n)}onLayoutEnd(e){super.onLayoutEnd(e),this.updateLayoutAttribute();const i=this.getLayoutRect();!this._forceLayoutTag&&isEqual(this._lastLayoutRect,i)||(this._lastLayoutRect=Object.assign({},i)),this._forceLayoutTag=!1,this._isLayout=!1}afterSetLayoutStartPoint(e){}_forceLayout(){var e;this._isLayout||(this._forceLayoutTag=!0,(e=this._option.globalInstance.getChart())===null||e===void 0||e.setLayoutTag(!0))}getLayoutStartPoint(){return this._layout?this._layout.getLayoutStartPoint():this._layoutStartPos}setLayoutStartPosition(e){return this._layout?this._layout.setLayoutStartPosition(e):this._layoutStartPos=merge$1(this._layoutStartPos,e)}getLayoutRect(){return this._layout?this._layout.getLayoutRect():this._layoutRect}setLayoutRect(e,i){return this._layout?this._layout.setLayoutRect(e):this._lastLayoutRect=merge$1(this._layoutRect,e)}getLastComputeOutBounds(){var e;return(e=this._layout)===null||e===void 0?void 0:e.getLastComputeOutBounds()}setAttrFromSpec(){var e,i,n,o,l;super.setAttrFromSpec(),this.layoutClip=(e=this._spec.clip)!==null&&e!==void 0?e:this.layoutClip,this.layoutZIndex=(i=this._spec.zIndex)!==null&&i!==void 0?i:this.layoutZIndex,this.layoutType=(n=this._spec.layoutType)!==null&&n!==void 0?n:this.layoutType,this._orient=(o=this._spec.orient)!==null&&o!==void 0?o:this._orient,this.layoutLevel=(l=this._spec.layoutLevel)!==null&&l!==void 0?l:this.layoutLevel}}class RegionSpecTransformer extends BaseModelSpecTransformer{_initTheme(e,i){return{spec:e,theme:this._theme}}}class Region extends LayoutModel{getMaxWidth(){return this._layout.maxWidth}setMaxWidth(e){this._layout.maxWidth=e}getMaxHeight(){return this._layout.maxHeight}setMaxHeight(e){this._layout.maxHeight=e}getGroupMark(){return this._groupMark}getInteractionMark(){return this._interactionMark}getStackInverse(){return this._spec.stackInverse===!0}getStackSort(){return this._spec.stackSort===!0}constructor(e,i){var n;super(e,i),this.transformerConstructor=RegionSpecTransformer,this.modelType="region",this.specKey="region",this.type=Region.type,this._series=[],this.layoutType="region",this.layoutZIndex=LayoutZIndex.Region,this.interaction=new Interaction,this.seriesDataFilterOver=()=>{this.event.emit(ChartEvent.regionSeriesDataFilterOver,{model:this,chart:this.getChart()}),this._series.forEach(o=>{o.getViewDataFilter()&&o.reTransformViewData()})},this.getBoundsInRect=()=>({x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}),this.userId=e.id,this.coordinate=(n=e.coordinate)!==null&&n!==void 0?n:"cartesian",this._option.animation&&(this.animate=new AnimateManager({getCompiler:i.getCompiler})),this.interaction.setDisableActiveEffect(this._option.disableTriggerEvent)}_getClipDefaultValue(){var e,i,n,o;const l=this._option.getChart().getSpec(),u=(i=(e=l.dataZoom)===null||e===void 0?void 0:e.some)===null||i===void 0?void 0:i.call(e,f=>{var g;return((g=f.filterMode)!==null&&g!==void 0?g:"filter")==="axis"}),d=(o=(n=l.scrollBar)===null||n===void 0?void 0:n.some)===null||o===void 0?void 0:o.call(n,f=>{var g;return((g=f.filterMode)!==null&&g!==void 0?g:"axis")==="axis"});return!(!u&&!d)||this._layout.layoutClip}created(){var e,i;this.initLayout(),super.created();const n=(e=this._spec.clip)!==null&&e!==void 0?e:this._getClipDefaultValue();this._groupMark=this._createGroupMark("regionGroup",this.userId,this.layoutZIndex),this._spec.roam&&this._groupMark.setMarkConfig({interactive:!0}),this._interactionMark=this._createGroupMark("regionInteractionGroup",((i=this.userId)!==null&&i!==void 0?i:this.type)+"_interaction",LayoutZIndex.Interaction),isEmpty(this._spec.style)||(this._backgroundMark=this._createMark({type:"rect",name:"regionBackground"}),n&&(this._foregroundMark=this._createMark({type:"rect",name:"regionForeground"})),[this._backgroundMark,this._foregroundMark].forEach(o=>{o&&(o.created(),this.setMarkStyle(o,{width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height},"normal",AttributeLevel.Built_In),this._groupMark.addMark(o))}),this._backgroundMark&&this._backgroundMark.setMarkConfig({zIndex:LayoutZIndex.SeriesGroup-1}),this._foregroundMark&&this._foregroundMark.setMarkConfig({zIndex:LayoutZIndex.Mark+1})),this.createTrigger()}_createGroupMark(e,i,n){var o,l;const u=this._createMark({type:"group",name:e});u.setUserId(i),u.setMarkConfig({zIndex:n});const d=(o=this._spec.clip)!==null&&o!==void 0?o:this._getClipDefaultValue();return this.setMarkStyle(u,{x:()=>this.getLayoutStartPoint().x,y:()=>this.getLayoutStartPoint().y,width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height,clip:d},"normal",AttributeLevel.Built_In),this.setMarkStyle(u,{cornerRadius:(l=this._spec.style)===null||l===void 0?void 0:l.cornerRadius},"normal",AttributeLevel.User_Mark),this._marks.addMark(u),u}init(e){super.init(e),this.initMark(),this.initSeriesDataflow(),this.initInteraction(),this.initTrigger()}initMark(){this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}_initBackgroundMarkStyle(){var e,i;this._backgroundMark&&(this.setMarkStyle(this._backgroundMark,Object.assign({fillOpacity:!((e=this._spec.style)===null||e===void 0)&&e.fill?1:0},this._spec.style),"normal",AttributeLevel.User_Mark),((i=this._spec.clip)!==null&&i!==void 0?i:this._getClipDefaultValue())&&this.setMarkStyle(this._backgroundMark,{strokeOpacity:0},"normal",AttributeLevel.Built_In))}_initForegroundMarkStyle(){this._foregroundMark&&this.setMarkStyle(this._foregroundMark,Object.assign(Object.assign({},this._spec.style),{fillOpacity:0,pickable:!1}),"normal",AttributeLevel.User_Mark)}_compareSpec(e,i){const n=super._compareSpec(e,i);return isEqual(i==null?void 0:i.style,e==null?void 0:e.style)||(n.reMake=!0),n}reInit(e){super.reInit(e),this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}addSeries(e){e&&(this._series.includes(e)||this._series.push(e))}removeSeries(e){if(!e)return;const i=this._series.findIndex(n=>n===e);i>=0&&this._series.splice(i,1)}getSeries(e={}){return this._series.filter(i=>{var n,o;return(!e.name||(i==null?void 0:i.name)===e.name)&&(!e.userId||array(e.userId).includes(i.userId))&&(!isValid(e.specIndex)||array(e.specIndex).includes(i.getSpecIndex()))&&(!e.id||i.id===e.id)&&(!e.type||i.type===e.type)&&(!e.coordinateType||i.coordinate===e.coordinateType)&&(!e.dataName||((o=(n=i.getRawData)===null||n===void 0?void 0:n.call(i))===null||o===void 0?void 0:o.name)===e.dataName)})}getSeriesInName(e){return this.getSeries({name:e})[0]}getSeriesInUserId(e){return this.getSeries({userId:e})[0]}getSeriesInId(e){return this.getSeries({id:e})[0]}getSeriesInType(e){return this.getSeries({type:e})}getSeriesInCoordinateType(e){return this.getSeries({coordinateType:e})}getSeriesInDataName(e){return this.getSeries({dataName:e})}onRender(e){}initSeriesDataflow(){const e=this._series.map(i=>{var n;return(n=i.getViewDataFilter())!==null&&n!==void 0?n:i.getViewData()}).filter(i=>!!i);this._option.dataSet.multipleDataViewAddListener(e,"change",this.seriesDataFilterOver)}release(){super.release(),this._series=[]}createTrigger(){const e=Object.assign(Object.assign({},this._option),{model:this,interaction:this.interaction});this._trigger=new DimensionTrigger(e)}initTrigger(){this._series.forEach(e=>{e.getMarksWithoutRoot().forEach(i=>{this._trigger.registerMark(i)})}),this._trigger.init()}initInteraction(){this._option.disableTriggerEvent||this._series.forEach(e=>{e.getMarksWithoutRoot().forEach(i=>{for(const n in STATE_VALUE_ENUM_REVERSE)isEmpty(i.stateStyle[STATE_VALUE_ENUM_REVERSE[n]])||this.interaction.registerMark(STATE_VALUE_ENUM_REVERSE[n],i)})})}compileMarks(e){this.getMarks().forEach(i=>{var n;i.compile({group:e,context:{model:this}}),(n=i.getProduct())===null||n===void 0||n.layout((o,l,u,d)=>{})})}compile(){var e;(e=this.animate)===null||e===void 0||e.compile(),this.compileMarks()}onLayoutEnd(e){this._series.forEach(i=>i.onLayoutEnd(e)),super.onLayoutEnd(e)}}Region.type="region",Region.transformerConstructor=RegionSpecTransformer,Region.specKey="region";function getPositionItems(r){const e=[],i=[],n=[];return r.forEach(o=>{isNil(o.getSpec().position)||o.getSpec().position==="start"?e.push(o):o.getSpec().position==="middle"?i.push(o):o.getSpec().position==="end"&&n.push(o)}),{startItems:e,endItems:n,middleItems:i}}function adjustItemsToCenter(r,e,i){e?r.forEach(n=>{const o=last(n),l=o.getLayoutStartPoint().y+o.getLayoutRect().height-n[0].getLayoutStartPoint().y,u=(i-l)/2;n.forEach(d=>{d.setLayoutStartPosition({x:d.getLayoutStartPoint().x,y:d.getLayoutStartPoint().y+u})})}):r.forEach(n=>{const o=last(n),l=o.getLayoutStartPoint().x+o.getLayoutRect().width-n[0].getLayoutStartPoint().x,u=(i-l)/2;n.forEach(d=>{d.setLayoutStartPosition({x:d.getLayoutStartPoint().x+u,y:d.getLayoutStartPoint().y})})})}function alignSelfOfItems(r,e,i,n){let o;r.forEach((l,u)=>{l.length>1&&(o=i[u],l.forEach(d=>{if(!d.alignSelf||d.alignSelf==="start")return;const f=d.getLayoutStartPoint(),g=d.alignSelf==="middle"?.5:1,_=e?o-(d.getLayoutRect().width+d.layoutPaddingLeft+d.layoutPaddingRight):o-(d.getLayoutRect().height+d.layoutPaddingTop+d.layoutPaddingBottom);e?d.setLayoutStartPosition({x:f.x+n*_*g,y:f.y}):d.setLayoutStartPosition({x:f.x,y:f.y+n*_*g})}))})}function layoutLeftRightStartOrMiddleItems(r,e,i,n,o){if(r.length){let l=0;const u=o==="right",d=u?-1:1;let f=u?e.rightCurrent:e.leftCurrent,g=e.topCurrent;const _=[];let y=[];const b=[];r.forEach(S=>{const v=e.getItemComputeLayoutRect(S),A=S.computeBoundsInRect(v);S.setLayoutRect(A);const x=A.height+S.layoutPaddingTop+S.layoutPaddingBottom,T=A.width+S.layoutPaddingLeft+S.layoutPaddingRight,C=u?-A.width-S.layoutPaddingRight:S.layoutPaddingLeft;S.setLayoutStartPosition({x:f+S.layoutOffsetX+C,y:g+S.layoutOffsetY+S.layoutPaddingTop}),g+=x,g>i&&y.length?(b.push(l),f+=d*l,l=T,g=e.topCurrent+x,S.setLayoutStartPosition({x:f+S.layoutOffsetX+C,y:e.topCurrent+S.layoutOffsetY+S.layoutPaddingTop}),_.push(y),y=[S]):(l=Math.max(l,T),y.push(S))}),b.push(l),_.push(y),alignSelfOfItems(_,!0,b,d),n&&adjustItemsToCenter(_,!0,i),u?e.rightCurrent=f+d*l:e.leftCurrent=f+d*l}}function layoutLeftRightEndItems(r,e,i,n){if(r.length){let o=0;const l=n==="right",u=l?-1:1;let d=l?e.rightCurrent:e.leftCurrent,f=e.bottomCurrent;const g=[];let _=[];const y=[];r.forEach(b=>{const S=e.getItemComputeLayoutRect(b),v=b.computeBoundsInRect(S);b.setLayoutRect(v);const A=v.height+b.layoutPaddingTop+b.layoutPaddingBottom,x=v.width+b.layoutPaddingLeft+b.layoutPaddingRight,T=l?-v.width-b.layoutPaddingRight:b.layoutPaddingLeft;f<A&&_.length?(y.push(o),d+=u*o,o=x,f=e.bottomCurrent,b.setLayoutStartPosition({x:d+b.layoutOffsetX+T,y:f+b.layoutOffsetY-v.height-b.layoutPaddingBottom}),g.push(_),_=[b]):(b.setLayoutStartPosition({x:d+b.layoutOffsetX+T,y:f+b.layoutOffsetY-v.height-b.layoutPaddingBottom}),o=Math.max(o,x),f-=A,_.push(b))}),y.push(o),g.push(_),alignSelfOfItems(g,!0,y,u),l?e.rightCurrent=d+u*o:e.leftCurrent=d+u*o}}function layoutTopBottomStartOrMiddleItems(r,e,i,n,o){if(r.length){const l=o==="top",u=l?1:-1;let d=0,f=e.leftCurrent,g=l?e.topCurrent:e.bottomCurrent;const _=[];let y=[];const b=[];r.forEach(S=>{const v=e.getItemComputeLayoutRect(S),A=S.computeBoundsInRect(v);S.setLayoutRect(A);const x=A.height+S.layoutPaddingTop+S.layoutPaddingBottom,T=A.width+S.layoutPaddingLeft+S.layoutPaddingRight,C=l?S.layoutPaddingTop:-A.height-S.layoutPaddingBottom;S.setLayoutStartPosition({x:f+S.layoutOffsetX+S.layoutPaddingLeft,y:g+S.layoutOffsetY+C}),f+=T,f>i&&y.length?(b.push(d),f=e.leftCurrent+T,g+=u*d,d=x,S.setLayoutStartPosition({x:e.leftCurrent+S.layoutOffsetX+S.layoutPaddingLeft,y:g+S.layoutOffsetY+C}),_.push(y),y=[S]):(d=Math.max(d,x),y.push(S))}),b.push(d),_.push(y),alignSelfOfItems(_,!1,b,u),n&&adjustItemsToCenter(_,!1,i),l?e.topCurrent=g+u*d:e.bottomCurrent=g+u*d}}function layoutTopBottomEndItems(r,e,i,n){if(r.length){const o=n==="top",l=o?1:-1;let u=0,d=e.rightCurrent,f=o?e.topCurrent:e.bottomCurrent;const g=[];let _=[];const y=[];r.forEach(b=>{const S=e.getItemComputeLayoutRect(b),v=b.computeBoundsInRect(S);b.setLayoutRect(v);const A=v.height+b.layoutPaddingTop+b.layoutPaddingBottom,x=v.width+b.layoutPaddingLeft+b.layoutPaddingRight,T=o?b.layoutPaddingTop:-v.height-b.layoutPaddingBottom;d<x&&_.length?(d=e.rightCurrent,f+=l*u,u=A,b.setLayoutStartPosition({x:e.rightCurrent+b.layoutOffsetX-v.width-b.layoutPaddingRight,y:f+b.layoutOffsetY+T}),g.push(_),_=[b]):(_.push(b),b.setLayoutStartPosition({x:d+b.layoutOffsetX-v.width-b.layoutPaddingRight,y:f+b.layoutOffsetY+T}),u=Math.max(u,A),d-=x)}),y.push(u),g.push(_),alignSelfOfItems(g,!1,y,l),o?e.topCurrent=f+l*u:e.bottomCurrent=f+l*u}}function layoutLeftInlineItems(r,e,i){const{startItems:n,middleItems:o,endItems:l}=getPositionItems(r);n.length&&layoutLeftRightStartOrMiddleItems(n,e,i,!1,"left"),o.length&&layoutLeftRightStartOrMiddleItems(o,e,i,!0,"left"),l.length&&layoutLeftRightEndItems(l,e,i,"left")}function layoutRightInlineItems(r,e,i){const{startItems:n,middleItems:o,endItems:l}=getPositionItems(r);n.length&&layoutLeftRightStartOrMiddleItems(n,e,i,!1,"right"),o.length&&layoutLeftRightStartOrMiddleItems(o,e,i,!0,"right"),l.length&&layoutLeftRightEndItems(l,e,i,"right")}function layoutTopInlineItems(r,e,i){const{startItems:n,middleItems:o,endItems:l}=getPositionItems(r);n.length&&layoutTopBottomStartOrMiddleItems(n,e,i,!1,"top"),o.length&&layoutTopBottomStartOrMiddleItems(o,e,i,!0,"top"),l.length&&layoutTopBottomEndItems(l,e,i,"top")}function layoutBottomInlineItems(r,e,i){const{startItems:n,middleItems:o,endItems:l}=getPositionItems(r);n.length&&layoutTopBottomStartOrMiddleItems(n,e,i,!1,"bottom"),o.length&&layoutTopBottomStartOrMiddleItems(o,e,i,!0,"bottom"),l.length&&layoutTopBottomEndItems(l,e,i,"bottom")}let Layout$1=class{constructor(e,i){this.leftCurrent=0,this.topCurrent=0,this.rightCurrent=0,this.bottomCurrent=0,this._onError=i==null?void 0:i.onError}_layoutInit(e,i,n,o){this._chartLayoutRect=n,this._chartViewBox=o,this.leftCurrent=n.x,this.topCurrent=n.y,this.rightCurrent=n.x+n.width,this.bottomCurrent=n.height+n.y,i.sort((l,u)=>u.layoutLevel-l.layoutLevel)}_layoutNormalItems(e){this.layoutNormalInlineItems(e.filter(i=>i.layoutType==="normal-inline")),this.layoutNormalItems(e.filter(i=>i.layoutType==="normal"))}_groupItems(e){const i=e.filter(d=>d.layoutType==="region"),n=e.filter(d=>d.layoutType==="region-relative"),o=e.filter(d=>d.layoutType==="region-relative-overlap"),l=n.concat(o),u={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}};return o.forEach(d=>{u[d.layoutOrient].items.push(d)}),{regionItems:i,relativeItems:n,relativeOverlapItems:o,allRelatives:l,overlapItems:u}}layoutItems(e,i,n,o){this._layoutInit(e,i,n,o),this._layoutNormalItems(i);const l={left:this.leftCurrent,top:this.topCurrent,right:this.rightCurrent,bottom:this.bottomCurrent},{regionItems:u,relativeItems:d,relativeOverlapItems:f,allRelatives:g,overlapItems:_}=this._groupItems(i);this.layoutRegionItems(u,d,f,_),this._processAutoIndent(u,d,f,_,g,l),this.layoutAbsoluteItems(i.filter(y=>y.layoutType==="absolute"))}_processAutoIndent(e,i,n,o={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}},l,u){if(l.some(d=>d.autoIndent)){const{top:d,bottom:f,left:g,right:_}=this._checkAutoIndent(l,u);(d||f||g||_)&&(this.topCurrent=u.top+d,this.bottomCurrent=u.bottom-f,this.leftCurrent=u.left+g,this.rightCurrent=u.right-_,this.layoutRegionItems(e,i,n,o))}}layoutNormalItems(e){e.forEach(i=>{const n=this.getItemComputeLayoutRect(i),o=i.computeBoundsInRect(n);i.setLayoutRect(o),i.layoutOrient==="left"?(i.setLayoutStartPosition({x:this.leftCurrent+i.layoutOffsetX+i.layoutPaddingLeft,y:this.topCurrent+i.layoutOffsetY+i.layoutPaddingTop}),this.leftCurrent+=o.width+i.layoutPaddingLeft+i.layoutPaddingRight):i.layoutOrient==="top"?(i.setLayoutStartPosition({x:this.leftCurrent+i.layoutOffsetX+i.layoutPaddingLeft,y:this.topCurrent+i.layoutOffsetY+i.layoutPaddingTop}),this.topCurrent+=o.height+i.layoutPaddingTop+i.layoutPaddingBottom):i.layoutOrient==="right"?(i.setLayoutStartPosition({x:this.rightCurrent+i.layoutOffsetX-o.width-i.layoutPaddingRight,y:this.topCurrent+i.layoutOffsetY+i.layoutPaddingTop}),this.rightCurrent-=o.width+i.layoutPaddingLeft+i.layoutPaddingRight):i.layoutOrient==="bottom"&&(i.setLayoutStartPosition({x:this.leftCurrent+i.layoutOffsetX+i.layoutPaddingRight,y:this.bottomCurrent+i.layoutOffsetY-o.height-i.layoutPaddingBottom}),this.bottomCurrent-=o.height+i.layoutPaddingTop+i.layoutPaddingBottom)})}layoutNormalInlineItems(e){const i=e.filter(f=>f.layoutOrient==="left"),n=e.filter(f=>f.layoutOrient==="right"),o=e.filter(f=>f.layoutOrient==="top"),l=e.filter(f=>f.layoutOrient==="bottom"),u=this._chartLayoutRect.width+this._chartLayoutRect.x,d=this._chartLayoutRect.height+this._chartLayoutRect.y;i.length&&layoutLeftInlineItems(i,this,d),o.length&&layoutTopInlineItems(o,this,u),n.length&&layoutRightInlineItems(n,this,d),l.length&&layoutBottomInlineItems(l,this,u)}_layoutRelativeOverlap(e,i){i.items.forEach(n=>{const o=this.getItemComputeLayoutRect(n),l=n.computeBoundsInRect(o);i.rect.width=Math.max(l.width+n.layoutPaddingLeft+n.layoutPaddingRight,i.rect.width),i.rect.height=Math.max(l.height+n.layoutPaddingTop+n.layoutPaddingBottom,i.rect.height)}),i.items.forEach(n=>{n.setLayoutRect(i.rect),e==="left"?n.setLayoutStartPosition({x:this.leftCurrent+n.layoutOffsetX}):e==="right"?n.setLayoutStartPosition({x:this.rightCurrent-i.rect.width+n.layoutOffsetX}):e==="top"?n.setLayoutStartPosition({x:this.topCurrent+n.layoutOffsetY}):n.setLayoutStartPosition({x:this.bottomCurrent-i.rect.height+n.layoutOffsetY})}),e==="left"?this.leftCurrent+=i.rect.width:e==="right"?this.rightCurrent-=i.rect.width:e==="top"?this.topCurrent+=i.rect.height:this.bottomCurrent-=i.rect.height}_layoutRelativeItem(e,i){const n=e.computeBoundsInRect(i);e.layoutOrient==="left"||e.layoutOrient==="right"?e.setLayoutRect({width:n.width}):e.setLayoutRect({height:n.height}),e.layoutOrient==="left"?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft}),this.leftCurrent+=n.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient==="right"?(this.rightCurrent-=n.width+e.layoutPaddingLeft+e.layoutPaddingRight,e.setLayoutStartPosition({x:this.rightCurrent+e.layoutOffsetX+e.layoutPaddingLeft})):e.layoutOrient==="top"?(e.setLayoutStartPosition({y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.topCurrent+=n.height+e.layoutPaddingTop+e.layoutPaddingBottom):e.layoutOrient==="bottom"&&(this.bottomCurrent-=n.height+e.layoutPaddingTop+e.layoutPaddingBottom,e.setLayoutStartPosition({y:this.bottomCurrent+e.layoutOffsetY+e.layoutPaddingTop}))}_layoutRegionItem(e,i,n){const o=Math.max(Math.min(i,...e.map(u=>{var d;return(d=u.maxWidth)!==null&&d!==void 0?d:Number.MAX_VALUE})),0),l=Math.max(Math.min(n,...e.map(u=>{var d;return(d=u.maxHeight)!==null&&d!==void 0?d:Number.MAX_VALUE})),0);return e.forEach(u=>{const d=o-u.layoutPaddingLeft-u.layoutPaddingRight,f=l-u.layoutPaddingTop-u.layoutPaddingBottom;u.setLayoutRect({width:d,height:f}),u.setLayoutStartPosition({x:this.leftCurrent+u.layoutOffsetX+u.layoutPaddingLeft,y:this.topCurrent+u.layoutOffsetY+u.layoutPaddingTop})}),{regionHeight:l,regionWidth:o}}layoutRegionItems(e,i,n,o={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}}){let l=this.rightCurrent-this.leftCurrent,u=this.bottomCurrent-this.topCurrent;i.filter(g=>g.layoutOrient==="left"||g.layoutOrient==="right").forEach(g=>{this._layoutRelativeItem(g,this.getItemComputeLayoutRect(g))}),this._layoutRelativeOverlap("left",o.left),this._layoutRelativeOverlap("right",o.right),l=this.rightCurrent-this.leftCurrent,i.filter(g=>g.layoutOrient==="top"||g.layoutOrient==="bottom").forEach(g=>{this._layoutRelativeItem(g,this.getItemComputeLayoutRect(g))}),this._layoutRelativeOverlap("top",o.top),this._layoutRelativeOverlap("bottom",o.bottom),u=this.bottomCurrent-this.topCurrent;const{regionWidth:d,regionHeight:f}=this._layoutRegionItem(e,l,u);i.concat(n).forEach(g=>{if(["left","right"].includes(g.layoutOrient)){const _=this.filterRegionsWithID(e,g.layoutBindRegionID[0]);g.setLayoutRect({height:_.getLayoutRect().height}),g.setLayoutStartPosition({y:_.getLayoutStartPoint().y+g.layoutOffsetY+g.layoutPaddingTop}),g.layoutOrient==="right"&&g.setLayoutStartPosition({x:g.getLayoutStartPoint().x+d-l})}else if(["top","bottom"].includes(g.layoutOrient)){const _=this.filterRegionsWithID(e,g.layoutBindRegionID[0]);g.setLayoutRect({width:_.getLayoutRect().width}),g.setLayoutStartPosition({x:_.getLayoutStartPoint().x+g.layoutOffsetX+g.layoutPaddingLeft}),g.layoutOrient==="bottom"&&g.setLayoutStartPosition({y:g.getLayoutStartPoint().y+f-u})}})}layoutAbsoluteItems(e){e.forEach(i=>{i.absoluteLayoutInRect(this._chartLayoutRect)})}filterRegionsWithID(e,i){var n;const o=e.find(l=>l.getModelId()===i);return o||((n=this._onError)!==null&&n!==void 0?n:error$1)("can not find target region item, invalid id"),o}getItemComputeLayoutRect(e){return{width:this.rightCurrent-this.leftCurrent-e.layoutPaddingLeft-e.layoutPaddingRight,height:this.bottomCurrent-this.topCurrent-e.layoutPaddingTop-e.layoutPaddingBottom}}_checkAutoIndent(e,i){const n={top:0,left:0,bottom:0,right:0};return e.forEach(o=>{if(!o.getModelVisible()||!o.autoIndent)return;const l=o.layoutOrient==="left"||o.layoutOrient==="right",u=o.getLastComputeOutBounds(),d=this._getOutInLayout(u,o,i);l?(n.top=Math.max(n.top,d.top),n.bottom=Math.max(n.bottom,d.bottom)):(n.left=Math.max(n.left,d.left),n.right=Math.max(n.right,d.right))}),n}_getOutInLayout(e,i,n){const{x:o,y:l}=i.getLayoutStartPoint(),{width:u,height:d}=i.getLayoutRect();return{left:n.left-(o-e.x1),right:o+u+e.x2-n.right,top:n.top-(l-e.y1),bottom:l+d+e.y2-n.bottom}}};Layout$1.type="base";const GradientType=["linear","radial","conical"],DEFAULT_LINEAR_GRADIENT_CONFIG={x0:0,y0:0,x1:1,y1:1},DEFAULT_RADIAL_GRADIENT_CONFIG={x0:0,y0:0,x1:1,y1:1,r0:0,r1:1},DEFAULT_CONICAL_GRADIENT_CONFIG={x:.5,y:.5,startAngle:0,endAngle:2*Math.PI},DEFAULT_GRADIENT_CONFIG={linear:DEFAULT_LINEAR_GRADIENT_CONFIG,radial:DEFAULT_RADIAL_GRADIENT_CONFIG,conical:DEFAULT_CONICAL_GRADIENT_CONFIG},MultiDatumMark=["line","area","trail"];function isMultiDatumMark(r){return MultiDatumMark.includes(r)}function curveTypeTransform(r,e){return r==="monotone"?e==="horizontal"?"monotoneY":"monotoneX":r}function is3DMark(r){return["arc3d","rect3d","pyramid3d"].includes(r)}class MarkStateManager extends StateManager{getStateInfoList(){return this._stateInfoList}constructor(e,i){super(e),this._stateInfoList=[],this._mark=i}_getDefaultStateMap(){return{markUpdateRank:1}}getStateInfo(e){return this._stateInfoList.find(i=>i.stateValue===e)}addStateInfo(e){if(this.getStateInfo(e.stateValue))return;e.level=e.level||0;let i=!0;for(let n=0;n<this._stateInfoList.length;n++){const o=this._stateInfoList[n].level;if(o&&o>e.level){this._stateInfoList.splice(n,0,e),i=!1;break}}i&&this._stateInfoList.push(e)}_clearStateBeforeSet(e){e.datums=null,e.items=null,e.fields=null,e.filter=null}changeStateInfo(e){const i=this.getStateInfo(e.stateValue);if(i){if(e.datums!==void 0&&(this._clearStateBeforeSet(i),i.datums=e.datums,i.datumKeys=e.datumKeys),e.items!==void 0&&(this._clearStateBeforeSet(i),i.items=e.items),e.fields!==void 0)if(this._clearStateBeforeSet(i),e.fields===null)i.fields=e.fields;else{i.fields=i.fields||{};for(const n in e.fields){const o=e.fields[n];i.fields[n]=i.fields[n]||{};const l=i.fields[n];isValid(o.domain)&&(l.domain=o.domain),isValid(o.type)&&(l.type=o.type)}}e.filter&&(this._clearStateBeforeSet(i),i.filter=e.filter)}else this.addStateInfo(e)}clearStateInfo(e){e.forEach(i=>{this.getStateInfo(i)&&this.changeStateInfo({stateValue:i,datumKeys:null,datums:null,fields:null,items:null,filter:null,cache:{}})})}checkOneState(e,i,n,o){var l;o=isBoolean(isMultiDatumMark)?o:!e.mark||isMultiDatumMark(e.mark.markType);let u=!1,d=!1;if(isValid(n.datums)&&n.datums.length>0)u=this.checkDatumState(n,i,o),d=!0;else if(n.items)u=(l=this.checkItemsState(n,e))!==null&&l!==void 0&&l,d=!0;else if(n.fields)u=this.checkFieldsState(n,i,e,o),d=!0;else if(!u&&n.filter){const f={mark:this._mark,renderNode:e,type:e.mark.markType};u=n.filter(i,f),d=!0}return d?u?"in":"out":"skip"}checkState(e,i){const n=e.getStates().filter(l=>stateInDefaultEnum(l)).map(l=>[l,10]),o=!e.mark||isMultiDatumMark(e.mark.markType);for(let l=0;l<this._stateInfoList.length;l++){const u=this._stateInfoList[l],d=this.checkOneState(e,i,u,o);d!=="skip"&&d==="in"&&n.push([u.stateValue,u.level])}return n.map(l=>l[0])}checkDatumState(e,i,n){let o=!1;const l=n?i[0]:i;if(isArray(e.datums)){const u=e.datumKeys||Object.keys(e.datums[0]).filter(d=>!d.startsWith(PREFIX));o=e.datums.some(d=>n&&isArray(d==null?void 0:d.items)?u.every(f=>{var g,_;return((_=(g=d==null?void 0:d.items)===null||g===void 0?void 0:g[0])===null||_===void 0?void 0:_[f])===(l==null?void 0:l[f])}):u.every(f=>(d==null?void 0:d[f])===(l==null?void 0:l[f])))}else isObject$1(e.datums)?o=(e.datumKeys||Object.keys(e.datums).filter(u=>!u.startsWith(PREFIX))).every(u=>{var d,f;return n?((d=e.datums.items)===null||d===void 0?void 0:d[0][u])===l[u]:((f=e.datums)===null||f===void 0?void 0:f[u])===l[u]}):o=i===e.datums;return o}checkItemsState(e,i){var n;return(n=e.items)===null||n===void 0?void 0:n.includes(i)}checkFieldsState(e,i,n,o){var l;let u=!0;for(const d in e.fields){const f=e.fields[d],g=f.type,_=f.domain,y=o?(l=i[0])===null||l===void 0?void 0:l[d]:i[d];if(isContinuous(g)&&_.length>1){if(this.checkLinearFieldState(_,d,i,n,o)){u=!1;break}u=!0}else{if(!_.some(b=>b===y)){u=!1;break}u=!0}}return u}checkLinearFieldState(e,i,n,o,l){var u;const d=l?(u=n[0])===null||u===void 0?void 0:u[i]:n[i];return d<e[0]||d>e[e.length-1]}updateLayoutState(e){return this._stateMap.markUpdateRank++,this.updateState({markUpdateRank:this._stateMap.markUpdateRank},e)}compileState(e,i){e.state({callback:(n,o)=>this.checkState(o,n)},i)}}class CompilableData extends GrammarItem{getDataView(){return this._data}setDataView(e){this._data=e}getLatestData(){var e;return(e=this._data)===null||e===void 0?void 0:e.latestData}constructor(e,i){super(e),this.grammarType=GrammarType.data,this._data=null,this._data=i}release(){super.release(),this._data=null}updateData(e){const i=this.getProduct(),n=this.getLatestData();if(i&&n&&(i.values(n),!e))return this.getCompiler().renderNextTick()}_compileProduct(){const e=this.getLatestData();isNil(e)||(isNil(this.getProduct())?this._initProduct(e):this._product.values(e))}_initProduct(e){var i,n;const o=this.getVGrammarView();if(!o||!e)return;const l=this.getProductId();this._product=(n=(i=o==null?void 0:o.data)===null||i===void 0?void 0:i.call(o,e))===null||n===void 0?void 0:n.id(l),this._compiledProductId=l}generateProductId(){var e;return`${(e=this.getDataView())===null||e===void 0?void 0:e.name}`}_lookupGrammar(e){var i,n;return(n=(i=this.getCompiler().getVGrammarView())===null||i===void 0?void 0:i.getDataById)===null||n===void 0?void 0:n.call(i,e)}}class MarkData extends CompilableData{constructor(e){super(e),this._mark=e.mark}setCompiledProductId(e){this._compiledProductId=e}generateProductId(){const e=super.generateProductId();return isValid(e)?e:`${PREFIX}_markData_${this._mark.id}`}_compileProduct(){var e;const i=(e=this._data)===null||e===void 0?void 0:e.latestData;isNil(i)||isValid(this.getProduct())||this._initProduct(i)}}var __rest$h=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class CompilableMark extends GrammarItem{getMarkConfig(){return this._markConfig}setMarkConfig(e){Object.keys(e).forEach(i=>{this._markConfig[i]=e[i]})}getVisible(){return this._visible}setVisible(e){this._visible=e}getUserId(){return this._userId}setUserId(e){isValid(e)&&(this._userId=e)}getDataView(){var e;return(e=this._data)===null||e===void 0?void 0:e.getDataView()}setDataView(e,i){isNil(this._data)&&this.initMarkData(Object.assign(Object.assign({},this._option),{mark:this})),isValid(i)&&this._data.setCompiledProductId(i),this._data.setDataView(e)}getData(){return this._data}setData(e){this._data=e}hasState(e){return e in this.state.getStateMap()}getState(e){return this.state.getStateMap()[e]}getAnimationConfig(){return this._animationConfig}setAnimationConfig(e){this._animationConfig=e}setSkipBeforeLayouted(e){this._skipBeforeLayouted=e}getSkipBeforeLayouted(){return this._skipBeforeLayouted}getGroupKey(){return this._groupKey}setGroupKey(e){this._groupKey=e}setStateSortCallback(e){this._stateSort=e}constructor(e,i,n){super(e),this.grammarType=GrammarType.mark,this.type=void 0,this.name="mark",this._markConfig={zIndex:LayoutZIndex.Mark,morph:!1},this._visible=!0,this.stateStyle={},this._unCompileChannel={},this._skipBeforeLayouted=!1,this.name=i,this.model=n,this.key=e.key,this.state=new MarkStateManager(Object.assign(Object.assign({},e),{stateKeyToSignalName:this.stateKeyToSignalName.bind(this)}),this),this._event=new Event$1(n.getOption().eventDispatcher,n.getOption().mode)}setTransform(e){this._transform=e}initMarkData(e){this._data=new MarkData(e)}stateKeyToSignalName(e){return`${PREFIX}_${this.type}_${this.id}_${e}`}getAttribute(e,i,n,o){}_compileProduct(e){const i=this.getProduct();if(!this.getVisible())return void(isValid(i)&&this.removeProduct());isValid(i)||this.getCompiler().isInited&&(this._initProduct(e==null?void 0:e.group),isNil(this._product)||(this.compileSignal(),this.compileData(),this.compileState(),this.compileEncode(),this.compileAnimation(),this.compileContext(e==null?void 0:e.context),this.compileTransform()))}_initProduct(e){const i=this.getVGrammarView(),n=this.getProductId();this._product=i.mark(this.type,e??i.rootMark).id(n),this.name&&this._product&&this._product.name(this.name),this._compiledProductId=n}generateProductId(){return this._userId?`${this._userId}`:`${this.name}_${this.id}`}compileData(){if(isNil(this._data))return;this._data.compile();const e=this._data.getProduct();isValid(this._product)&&isValid(e)&&this._product.join(e,this.key,void 0,this.getGroupKey())}updateStaticEncode(){if(!this._product)return;const{enterStyles:e,updateStyles:i}=this._separateStyle();this._product.encodeState("group",e,!0),this._product.encode(i,!0)}_separateStyle(){const e=this.stateStyle,i=STATE_VALUE_ENUM.STATE_NORMAL,n=e[i],o=(__rest$h(e,[typeof i=="symbol"?i:i+""]),this._option.noSeparateStyle?null:{}),l={};return Object.keys(n).forEach(u=>{this._unCompileChannel[u]||(this._option.noSeparateStyle||isStateAttrChangeable(u,n,this.getGroupKey())?l[u]={callback:this.compileCommonAttributeCallback(u,"normal"),dependency:[this.stateKeyToSignalName("markUpdateRank")]}:o[u]=this.compileCommonAttributeCallback(u,"normal"))}),{enterStyles:o,updateStyles:l}}compileEncode(){const e=this.stateStyle,i=STATE_VALUE_ENUM.STATE_NORMAL,n=(e[i],__rest$h(e,[typeof i=="symbol"?i:i+""])),{enterStyles:o,updateStyles:l}=this._separateStyle();this._product.encode(l,!0),this._product.encodeState("group",o,!0),Object.keys(n).forEach(u=>{const d={};Object.keys(n[u]).forEach(f=>{this._unCompileChannel[f]||(d[f]={callback:this.compileCommonAttributeCallback(f,u),dependency:[this.stateKeyToSignalName("markUpdateRank")]})}),this._product.encodeState(u,d,!0)}),this._skipBeforeLayouted&&this._product.layout({skipBeforeLayouted:this._skipBeforeLayouted})}compileState(){this.state.compileState(this._product,this._stateSort)}compileAnimation(){var e,i,n,o;if(this._animationConfig){let l;if(this.type==="component")l=(e=this.model.animate)===null||e===void 0?void 0:e.getAnimationStateSignalName();else{const u=(n=(i=this.model).getRegion)===null||n===void 0?void 0:n.call(i);l=(o=u==null?void 0:u.animate)===null||o===void 0?void 0:o.getAnimationStateSignalName()}this._product.animation(this._animationConfig),this._product.animationState({callback:(u,d,f)=>{var g;return(g=f[l])===null||g===void 0?void 0:g.callback(u,d)},dependency:l}),this._animationConfig.normal&&(this._animationConfig.appear?this._event.on(HOOK_EVENT.ANIMATION_END,({event:u})=>{u.mark===this.getProduct()&&u.animationState===AnimationStateEnum.appear&&this.runAnimationByState(AnimationStateEnum.normal)}):this._event.on(HOOK_EVENT.AFTER_DO_RENDER,()=>{this.runAnimationByState(AnimationStateEnum.normal)}))}}compileContext(e){const i=Object.assign(Object.assign({},this._markConfig),{context:Object.assign({markId:this.id,modelId:this.model.id,markUserId:this._userId,modelUserId:this.model.userId},e)});this._product.configure(i)}compileSignal(){this.state.compile()}_computeAttribute(e,i){return(n,o)=>{}}compileCommonAttributeCallback(e,i){const n=this._computeAttribute(e,i),o={mark:null,parent:null,element:null};return(l,u)=>(o.mark=u.mark,o.parent=u.mark.group,o.element=u,n(l,o))}compileTransform(){var e;!((e=this._transform)===null||e===void 0)&&e.length&&this.getProduct().transform(this._transform)}_lookupGrammar(e){var i;return(i=this.getCompiler().getVGrammarView())===null||i===void 0?void 0:i.getMarkById(e)}updateState(e,i){return this.state.updateState(e,i)}updateLayoutState(e,i){return i&&this.getMarks().length>0&&this.getMarks().forEach(n=>n.state.updateLayoutState(!0)),this.state.updateLayoutState(e)}updateMarkState(e){if(!this._product)return;const i=this.state.getStateInfo(e);this._product.elements.forEach(n=>{this.state.checkOneState(n,n.getDatum(),i)==="in"?n.addState(e):n.removeState(e)})}getMarks(){return[]}runAnimationByState(e){var i,n;return(n=(i=this.getProduct())===null||i===void 0?void 0:i.animate)===null||n===void 0?void 0:n.runAnimationByState(e)}stopAnimationByState(e){var i,n;return(n=(i=this.getProduct())===null||i===void 0?void 0:i.animate)===null||n===void 0?void 0:n.stopAnimationByState(e)}pauseAnimationByState(e){var i,n;return(n=(i=this.getProduct())===null||i===void 0?void 0:i.animate)===null||n===void 0?void 0:n.pauseAnimationByState(e)}resumeAnimationByState(e){var i,n;return(n=(i=this.getProduct())===null||i===void 0?void 0:i.animate)===null||n===void 0?void 0:n.resumeAnimationByState(e)}getProductElements(){const e=this.getProduct();if(e)return e.elements}release(){super.release(),this.state.release()}}var __rest$g=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class BaseMark extends CompilableMark{constructor(e,i){var n;super(i,e,i.model),this._extensionChannel={},this._computeExChannel={},this._attributeContext=i.attributeContext,(n=i.map)===null||n===void 0||n.set(this.id,this)}created(){this._initStyle()}initStyleWithSpec(e,i){e&&(isValid(e.id)&&(this._userId=e.id),isBoolean(e.interactive)&&(this._markConfig.interactive=e.interactive),isValid(e.zIndex)&&(this._markConfig.zIndex=e.zIndex),isBoolean(e.visible)&&this.setVisible(e.visible),this._initSpecStyle(e,this.stateStyle,i))}_transformStyleValue(e,i){if(e.scale){const n=e.scale,o=n.range();return n.range(o.map(i)),e}return typeof e=="function"?(...n)=>i(e(...n)):i(e)}convertAngleToRadian(e){return this._transformStyleValue(e,degreeToRadian)}isUserLevel(e){return[AttributeLevel.User_Mark,AttributeLevel.User_Series,AttributeLevel.User_Chart,AttributeLevel.User_SeriesStyle].includes(e)}setStyle(e,i="normal",n=0,o=this.stateStyle){if(isNil(e))return;o[i]===void 0&&(o[i]={});const l=this.isUserLevel(n);Object.keys(e).forEach(u=>{let d=e[u];isNil(d)||(d=this._filterAttribute(u,d,i,n,l,o),this.setAttribute(u,d,i,n,o))})}getStyle(e,i="normal"){var n;return(n=this.stateStyle[i][e])===null||n===void 0?void 0:n.style}_filterAttribute(e,i,n,o,l,u=this.stateStyle){let d=this._styleConvert(i);if(l)switch(e){case"angle":d=this.convertAngleToRadian(d);break;case"innerPadding":case"outerPadding":d=this._transformStyleValue(d,f=>-f);break;case"curveType":d=this._transformStyleValue(d,f=>curveTypeTransform(f,this._option.model.direction))}return d}setReferer(e,i,n,o=this.stateStyle){var l;if(e)if(i&&n){const u=(l=o[n])!==null&&l!==void 0?l:{[i]:{}};o[n][i]=Object.assign(Object.assign({},u[i]),{referer:e})}else Object.entries(o).forEach(([u,d])=>{Object.entries(d).forEach(([f,g])=>{o[u][f].referer=e})})}setPostProcess(e,i,n="normal"){var o;!((o=this.stateStyle[n])===null||o===void 0)&&o[e]&&(this.stateStyle[n][e].postProcess=i)}getAttribute(e,i,n="normal",o){return this._computeAttribute(e,n)(i,o)}setAttribute(e,i,n="normal",o=0,l=this.stateStyle){var u;l[n]===void 0&&(l[n]={}),l[n][e]===void 0&&(l[n][e]={level:o,style:i,referer:void 0});const d=(u=l[n][e])===null||u===void 0?void 0:u.level;isValid(d)&&d<=o&&mergeSpec(l[n][e],{style:i,level:o}),n!=="normal"&&e in this._extensionChannel&&this._extensionChannel[e].forEach(f=>{l[n][f]===void 0&&(l[n][f]=l.normal[f])})}_getDefaultStyle(){return{visible:!0,x:0,y:0}}_styleConvert(e){if(!e)return e;if(isValidScaleType(e.type)||e.scale){const i=createScaleWithSpec(e,{globalScale:this._option.globalScale,seriesId:this._option.seriesId});if(i)return{scale:i,field:e.field,changeDomain:e.changeDomain}}return e}_computeAttribute(e,i){var n;let o=(n=this.stateStyle[i])===null||n===void 0?void 0:n[e];o||(o=this.stateStyle.normal[e]);const l=this._computeStateAttribute(o,e,i),u=isFunction(o==null?void 0:o.postProcess),d=e in this._computeExChannel;if(u&&d){const f=this._computeExChannel[e];return(g,_)=>{let y=l(g,_);return y=o.postProcess(y,g,this._attributeContext,_,this.getDataView()),f(e,g,i,_,y)}}if(u)return(f,g)=>o.postProcess(l(f,g),f,this._attributeContext,g,this.getDataView());if(d){const f=this._computeExChannel[e];return(g,_)=>f(e,g,i,_,l(g,_))}return l}_computeStateAttribute(e,i,n){var o;return e?e.referer?e.referer._computeAttribute(i,n):e.style?typeof e.style=="function"?(l,u)=>e.style(l,this._attributeContext,u,this.getDataView()):GradientType.includes(e.style.gradient)?this._computeGradientAttr(e.style):["outerBorder","innerBorder"].includes(i)?this._computeBorderAttr(e.style):isValidScaleType((o=e.style.scale)===null||o===void 0?void 0:o.type)?(l,u)=>{let d=l;return this.model.modelType==="series"&&this.model.getMarkData&&(d=this.model.getMarkData(l)),e.style.scale.scale(d[e.style.field])}:(l,u)=>e.style:(l,u)=>e.style:(l,u)=>{}}_initStyle(){const e=this._getDefaultStyle();this.setStyle(e,"normal",0)}_initSpecStyle(e,i,n){e.style&&this.setStyle(e.style,"normal",AttributeLevel.User_Mark,i);const o=e.state;o&&Object.keys(o).forEach(l=>{const u=o[l];if("style"in u){const d=u.style;let f={stateValue:l};"level"in u&&(f.level=u.level),"filter"in u&&(f=isFunction(u.filter)?Object.assign({filter:u.filter},f):Object.assign(Object.assign({},u.filter),f)),this.state.addStateInfo(f),this.setStyle(d,l,AttributeLevel.User_Mark,i)}else this.setStyle(u,l,AttributeLevel.User_Mark,i)})}_computeGradientAttr(e){var i,n;const{gradient:o,scale:l,field:u}=e,d=__rest$g(e,["gradient","scale","field"]);let f=l,g=u;if(!(l&&u||this.model.modelType!=="series")){const{scale:b,field:S}=this.model.getColorAttribute();l||(f=b),g||(g=S)}const _=computeActualDataScheme(getDataScheme(this.model.getColorScheme(),this.model.modelType==="series"?(n=(i=this.model).getSpec)===null||n===void 0?void 0:n.call(i):void 0),this.model.getDefaultColorDomain()),y=Object.assign(Object.assign({},DEFAULT_GRADIENT_CONFIG[o]),d);return(b,S)=>{const v={},A=this.getDataView();return Object.keys(y).forEach(x=>{const T=y[x];x==="stops"?v.stops=T.map(C=>{const{opacity:E,color:P,offset:L}=C;let R=P??(f==null?void 0:f.scale(b[g]));return isFunction(P)&&(R=P(b,this._attributeContext,S,A)),isValid(E)&&(R=Color.SetOpacity(R,E)),{offset:isFunction(L)?L(b,this._attributeContext,S,A):L,color:R||_[0]}}):isFunction(T)?v[x]=T(b,this._attributeContext,S,A):v[x]=T}),v.gradient=o,v}}_computeBorderAttr(e){const{scale:i,field:n}=e,o=__rest$g(e,["scale","field"]);return(l,u)=>{var d,f,g;const _={};if(Object.keys(o).forEach(y=>{const b=o[y];isFunction(b)?_[y]=b(l,this._attributeContext,u,this.getDataView()):_[y]=b}),"stroke"in _)GradientType.includes((g=o.stroke)===null||g===void 0?void 0:g.gradient)&&(_.stroke=this._computeGradientAttr(o.stroke)(l,u));else{const y=computeActualDataScheme(getDataScheme(this.model.getColorScheme(),this.model.modelType==="series"?(f=(d=this.model).getSpec)===null||f===void 0?void 0:f.call(d):void 0),this.model.getDefaultColorDomain());let b=i,S=n;if(!(i&&n||this.model.modelType!=="series")){const{scale:v,field:A}=this.model.getColorAttribute();i||(b=v),S||(S=A),_.stroke=(b==null?void 0:b.scale(l[S]))||y[0]}}return _}}}class GroupMark extends BaseMark{constructor(){super(...arguments),this.type=GroupMark.type,this._marks=[]}getMarks(){return this._marks}_getDefaultStyle(){return Object.assign({},super._getDefaultStyle())}isMarkExist(e){return this._marks.find(i=>i.id===e.id)!==void 0}addMark(e){return this.isMarkExist(e)?(warn("Mark already exists, add mark failed."),!1):(this._marks.push(e),!0)}removeMark(e){const i=this._marks.findIndex(n=>n.id===e.id||n.name===e.name);return i===-1?(warn("Mark does not exists, removeMark failed."),!1):(this._marks.splice(i,1),!0)}getMarkInType(e){return this._marks.filter(i=>i.type===e)}getMarkInId(e){return this._marks.find(i=>i.id===e)}getMarkInUserId(e){let i;if(this._marks.forEach(n=>{n.getUserId()===e&&(i=n)}),!i)for(let n=0;n<this._marks.length;n++){const o=this._marks[n];if(o.type==="group"&&(i=o.getMarkInUserId(e)),i)break}return i}getMarkInName(e){return this._marks.filter(i=>i.name===e)}_compileProduct(e){super._compileProduct(e),this._product.configure({zIndex:this._markConfig.zIndex}),e!=null&&e.ignoreChildren||this.getMarks().forEach(i=>{i.getProduct()&&i.removeProduct(),i.compile({group:this._product})})}}GroupMark.type="group";const registerGroupMark=()=>{registerGroupGraphic(),Factory$1.registerMark(GroupMark.type,GroupMark)},VCHART_UTILS={measureText};class ExpressionFunction{static instance(){return ExpressionFunction.instance_||(ExpressionFunction.instance_=new ExpressionFunction),ExpressionFunction.instance_}constructor(){this.functions={}}registerFunction(e,i){e&&i&&(this.functions[e]=i)}unregisterFunction(e){e&&delete this.functions[e]}getFunction(e){return this.functions[e]||null}getFunctionNameList(){return Object.keys(this.functions)}}const registerBrowserEnv=()=>{loadBrowserEnv(container)},registerNodeEnv=()=>{loadNodeEnv(container)};class BasePluginService{constructor(){this.id=createID(),this._plugins=[]}add(e){if(!e||e.length===0)return null;const i=[];return e.forEach(n=>{this._plugins.find(o=>o.id===n.id)?warn("plugin"):(this._plugins.push(n),i.push(n),n.onAdd&&n.onAdd(this))}),i}load(e){const i=this.add(e);i&&i.length&&this.activate(e)}activate(e){e.length&&e.forEach(i=>{i.init&&i.init()})}get(e){return this._plugins.find(i=>i.id===e)}getAll(){return this._plugins.slice()}release(e){const i=this.get(e);i&&(i.release(this),this._plugins=this._plugins.filter(n=>n!==i))}releaseAll(){this._plugins.forEach(e=>{e.release(this)}),this._plugins=[]}clear(e){const i=this.get(e);i&&i.clear(this)}clearAll(){this._plugins.forEach(e=>{var i;(i=e.clear)===null||i===void 0||i.call(e,this)})}}class ChartPluginService extends BasePluginService{constructor(e){super(),this.globalInstance=e}onInit(e){this._plugins.forEach(i=>{i.onInit&&i.onInit(this,e)})}onBeforeResize(e,i){this._plugins.forEach(n=>{n.onBeforeResize&&n.onBeforeResize(this,e,i)})}onAfterChartSpecTransform(e,i){this._plugins.forEach(n=>{n.onAfterChartSpecTransform&&n.onAfterChartSpecTransform(this,e,i)})}onAfterModelSpecTransform(e,i,n){this._plugins.forEach(o=>{o.onAfterModelSpecTransform&&o.onAfterModelSpecTransform(this,e,i,n)})}onBeforeInitChart(e,i){this._plugins.forEach(n=>{n.onBeforeInitChart&&n.onBeforeInitChart(this,e,i)})}releaseAll(){super.releaseAll(),this.globalInstance=null}}const svgSourceMap=new Map;function getSVGSource(r){return svgSourceMap.get(r)}var __awaiter=function(r,e,i,n){return new(i||(i=Promise))(function(o,l){function u(g){try{f(n.next(g))}catch(_){l(_)}}function d(g){try{f(n.throw(g))}catch(_){l(_)}}function f(g){var _;g.done?o(g.value):(_=g.value,_ instanceof i?_:new i(function(y){y(_)})).then(u,d)}f((n=n.apply(r,e||[])).next())})},__rest$f=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class VChart{static useRegisters(e){e.forEach(i=>{typeof i=="function"?i():console.error("Invalid function:",i)})}static useChart(e){e.forEach(i=>Factory$1.registerChart(i.type,i))}static useSeries(e){e.forEach(i=>Factory$1.registerSeries(i.type,i))}static useComponent(e){e.forEach(i=>Factory$1.registerComponent(i.type,i))}static useMark(e){e.forEach(i=>{var n;return Factory$1.registerMark((n=i.constructorType)!==null&&n!==void 0?n:i.type,i)})}static useLayout(e){e.forEach(i=>Factory$1.registerLayout(i.type,i))}static registerDataSetTransform(e,i){Factory$1.registerTransform(e,i)}static registerFunction(e,i){e&&i&&ExpressionFunction.instance().registerFunction(e,i)}static unregisterFunction(e){e&&ExpressionFunction.instance().unregisterFunction(e)}static getFunction(e){return e?ExpressionFunction.instance().getFunction(e):null}static getFunctionList(){return ExpressionFunction.instance().getFunctionNameList()}static registerMap(e,i,n){const o=Factory$1.getImplementInKey("registerMap");o&&o(e,i,n)}static unregisterMap(e){const i=Factory$1.getImplementInKey("unregisterMap");i&&i(e)}static getMap(e){return getMapSource(e)}static registerSVG(e,i,n){const o=Factory$1.getImplementInKey("registerSVG");o&&o(e,i,n)}static unregisterSVG(e){const i=Factory$1.getImplementInKey("unregisterSVG");i&&i(e)}static getSVG(e){return getSVGSource(e)}static hideTooltip(e=[]){InstanceManager.forEach(i=>{var n;return(n=i==null?void 0:i.hideTooltip)===null||n===void 0?void 0:n.call(i)},e)}static getLogger(){return Logger.getInstance()}getSpec(){return this._spec}getSpecInfo(){return this._specInfo}getDataSet(){return this._dataSet}constructor(e,i){var n,o,l,u,d,f,g,_;this.id=createID(),this._userEvents=[],this._autoSize=!0,this._option={mode:RenderModeEnum["desktop-browser"],onError:L=>{throw new Error(L)},optimize:{disableCheckGraphicWidthOutRange:!0}},this._observer=null,this._context={},this._doResize=()=>{const{width:L,height:R}=this.getCurrentSize();this._currentSize.width===L&&this._currentSize.height===R||(this._currentSize={width:L,height:R},this.resizeSync(L,R))},this._renderSync=(L={})=>{var R;const w=this;return this._beforeRender(L)&&((R=this._compiler)===null||R===void 0||R.render(L.morphConfig),this._afterRender()),w},this._updateSpec=(L,R=!1,w)=>{var D,I;const O=this._spec,B={changeBackground:!1,reTransformSpec:!1,change:!1,reMake:!1,reCompile:!1,reSize:!1,changeTheme:!1};if(!this._setNewSpec(L,R))return;isEqual(O.theme,this._spec.theme)?isEqual(this._spec.background,O.background)||(B.reMake=!0,B.changeBackground=!0):B.changeTheme=!0;const N=this._shouldChartResize(O);if(B.reSize=N,this._spec.type!==O.type)return(I=(D=this._compiler)===null||D===void 0?void 0:D.getVGrammarView())===null||I===void 0||I.updateLayoutTag(),B.reMake=!0,B.reTransformSpec=!0,B.change=!0,B.changeTheme=!0,B;this._initChartSpec(this._spec,"updateSpec");const $=mergeUpdateResult(this._chart.updateSpec(this._spec),B);return w?Object.assign(Object.assign({},$),w):$},this._option=merge$1(this._option,{animation:e.animation!==!1},i),this._onError=(n=this._option)===null||n===void 0?void 0:n.onError;const y=this._option,{dom:b,renderCanvas:S,mode:v,stage:A,poptip:x}=y,T=__rest$f(y,["dom","renderCanvas","mode","stage","poptip"]),C=isTrueBrowser(v);if(C?registerBrowserEnv():v==="node"&&registerNodeEnv(),C&&b&&(this._container=isString(b)?vglobal.getElementById(b):b),S&&(this._canvas=S),A&&(this._stage=A),v!=="node"&&!this._container&&!this._canvas&&!this._stage)return void((o=this._option)===null||o===void 0||o.onError("please specify container or renderCanvas!"));this._viewBox=this._option.viewBox,this._currentThemeName=ThemeManager$1.getCurrentThemeName(),this._setNewSpec(e),this._updateCurrentTheme(),this._currentSize=this.getCurrentSize();const E=[];!x&&E.push("poptipForText"),e.type==="sankey"&&E.push("scrollbar");const P=Object.assign({},T.performanceHook||{});Object.keys(P).forEach(L=>{T.performanceHook[L]=(...R)=>{P[L](...R,this)}}),this._compiler=new Compiler({dom:(l=this._container)!==null&&l!==void 0?l:"none",canvas:S},Object.assign(Object.assign({mode:this._option.mode,stage:A,pluginList:E},T),{background:this._getBackground(),onError:this._onError})),this._compiler.setSize(this._currentSize.width,this._currentSize.height),this._eventDispatcher=new EventDispatcher(this,this._compiler),this._event=new Event$1(this._eventDispatcher,v),this._compiler.initView(),this._setFontFamilyTheme((u=this._currentTheme)===null||u===void 0?void 0:u.fontFamily),this._initDataSet(this._option.dataSet),this._autoSize=!!C&&((f=(d=e.autoFit)!==null&&d!==void 0?d:this._option.autoFit)===null||f===void 0||f),this._bindResizeEvent(),this._bindVGrammarViewEvent(),this._initChartPlugin(),InstanceManager.registerInstance(this),(_=(g=this._option.performanceHook)===null||g===void 0?void 0:g.afterCreateVChart)===null||_===void 0||_.call(g,this)}_setNewSpec(e,i){return!!e&&(isString(e)&&(e=JSON.parse(e)),i&&this._originalSpec&&(e=mergeSpec({},this._originalSpec,e)),this._originalSpec=e,this._spec=this._getSpecFromOriginalSpec(),!0)}_getSpecFromOriginalSpec(){var e;const i=specTransform(this._originalSpec);return i.data=(e=i.data)!==null&&e!==void 0?e:[],i}_initChartSpec(e,i){var n,o;VChart.getFunctionList()&&VChart.getFunctionList().length&&(e=functionTransform(e,VChart)),this._spec=e,this._chartSpecTransformer||(this._chartSpecTransformer=Factory$1.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),(n=this._chartSpecTransformer)===null||n===void 0||n.transformSpec(this._spec),this._chartPluginApply("onAfterChartSpecTransform",this._spec,i),this._specInfo=(o=this._chartSpecTransformer)===null||o===void 0?void 0:o.transformModelSpec(this._spec),this._chartPluginApply("onAfterModelSpecTransform",this._spec,this._specInfo,i)}_updateSpecInfo(){var e;this._chartSpecTransformer||(this._chartSpecTransformer=Factory$1.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),this._specInfo=(e=this._chartSpecTransformer)===null||e===void 0?void 0:e.createSpecInfo(this._spec)}_initChart(e){var i,n,o;if(!this._compiler)return void((i=this._option)===null||i===void 0||i.onError("compiler is not initialized"));if(this._chart)return void((n=this._option)===null||n===void 0||n.onError("chart is already initialized"));const l=Factory$1.createChart(e.type,e,this._getChartOption(e.type));l?(this._chart=l,this._chart.setCanvasRect(this._currentSize.width,this._currentSize.height),this._chart.created(this._chartSpecTransformer),this._chart.init(),this._event.emit(ChartEvent.initialized,{chart:l,vchart:this})):(o=this._option)===null||o===void 0||o.onError("init chart fail")}_releaseData(){this._dataSet&&(this._dataSet.dataViewMap={},this._dataSet=null)}_bindVGrammarViewEvent(){if(!this._compiler)return;const e=this._compiler.getVGrammarView();e.addEventListener(HOOK_EVENT.ALL_ANIMATION_END,()=>{this._event.emit(ChartEvent.animationFinished,{chart:this._chart,vchart:this})}),e.addEventListener(HOOK_EVENT.AFTER_VRENDER_NEXT_RENDER,()=>{this._event.emit(ChartEvent.renderFinished,{chart:this._chart,vchart:this})})}_bindResizeEvent(){var e,i;if(this._autoSize){if(this._onResize=throttle(this._doResize,(e=this._option.resizeDelay)!==null&&e!==void 0?e:100),this._container){const n=window.ResizeObserver;n&&(this._observer=new n(this._onResize),(i=this._observer)===null||i===void 0||i.observe(this._container))}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this._autoSize&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}getCurrentSize(){var e,i,n,o;return calculateChartSize(this._spec,{container:this._container,canvas:this._canvas,mode:this._getMode(),modeParams:this._option.modeParams},{width:(i=(e=this._currentSize)===null||e===void 0?void 0:e.width)!==null&&i!==void 0?i:DEFAULT_CHART_WIDTH,height:(o=(n=this._currentSize)===null||n===void 0?void 0:n.height)!==null&&o!==void 0?o:DEFAULT_CHART_HEIGHT})}_initDataSet(e){this._dataSet=e instanceof DataSet?e:new DataSet,registerDataSetInstanceParser(this._dataSet,"dataview",dataViewParser),registerDataSetInstanceParser(this._dataSet,"array",arrayParser),registerDataSetInstanceTransform(this._dataSet,"copyDataView",copyDataView);for(const i in Factory$1.transforms)registerDataSetInstanceTransform(this._dataSet,i,Factory$1.transforms[i]);for(const i in Factory$1.dataParser)registerDataSetInstanceParser(this._dataSet,i,Factory$1.dataParser[i])}updateCustomConfigAndRerender(e,i,n={}){if(!this._isReleased&&e)return isFunction(e)&&(e=e()),e.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._reCompile(e),i?this._renderSync(n):this._renderAsync(n)}_updateCustomConfigAndRecompile(e,i={}){return!!e&&(this._reCompile(e),this._beforeRender(i))}_reCompile(e,i){var n,o,l,u,d,f,g,_,y,b;if(e.reMake&&(this._releaseData(),this._initDataSet(),(n=this._chart)===null||n===void 0||n.release(),this._chart=null),e.reTransformSpec&&(this._chartSpecTransformer=null),e.changeTheme?(this._setCurrentTheme(),this._setFontFamilyTheme((o=this._currentTheme)===null||o===void 0?void 0:o.fontFamily)):e.changeBackground&&((l=this._compiler)===null||l===void 0||l.setBackground(this._getBackground())),e.reMake)(u=this._compiler)===null||u===void 0||u.releaseGrammar(((d=this._option)===null||d===void 0?void 0:d.animation)===!1||((f=this._spec)===null||f===void 0?void 0:f.animation)===!1),this._userEvents.forEach(S=>{var v;return(v=this._event)===null||v===void 0?void 0:v.on(S.eType,S.query,S.handler)}),e.reSize&&this._doResize();else if(e.reCompile&&((g=this._compiler)===null||g===void 0||g.clear({chart:this._chart,vChart:this},((_=this._option)===null||_===void 0?void 0:_.animation)===!1||((y=this._spec)===null||y===void 0?void 0:y.animation)===!1),(b=this._compiler)===null||b===void 0||b.compile({chart:this._chart,vChart:this},{})),e.reSize){const{width:S,height:v}=this.getCurrentSize();this._chart.onResize(S,v,!1),this._compiler.resize(S,v,!1)}}_beforeRender(e={}){var i,n,o,l,u,d,f,g;if(this._isReleased)return!1;if(this._chart)return!0;const{transformSpec:_,actionSource:y}=e;return _&&this._initChartSpec(this._spec,"render"),this._chartPluginApply("onBeforeInitChart",this._spec,y),(n=(i=this._option.performanceHook)===null||i===void 0?void 0:i.beforeInitializeChart)===null||n===void 0||n.call(i,this),this._initChart(this._spec),(l=(o=this._option.performanceHook)===null||o===void 0?void 0:o.afterInitializeChart)===null||l===void 0||l.call(o,this),!(!this._chart||!this._compiler)&&((d=(u=this._option.performanceHook)===null||u===void 0?void 0:u.beforeCompileToVGrammar)===null||d===void 0||d.call(u),this._compiler.compile({chart:this._chart,vChart:this},{performanceHook:this._option.performanceHook}),(g=(f=this._option.performanceHook)===null||f===void 0?void 0:f.afterCompileToVGrammar)===null||g===void 0||g.call(f),!0)}_afterRender(){return!this._isReleased&&(this._updateAnimateState(),this._event.emit(ChartEvent.rendered,{chart:this._chart,vchart:this}),!0)}renderSync(e){return this._renderSync({morphConfig:e,transformSpec:!0,actionSource:"render"})}renderAsync(e){return __awaiter(this,void 0,void 0,function*(){return this._renderAsync({morphConfig:e,transformSpec:!0,actionSource:"render"})})}_renderAsync(e={}){return __awaiter(this,void 0,void 0,function*(){return this._renderSync(e)})}_updateAnimateState(e){var i,n;if(this._option.animation){const o=e?AnimationStateEnum.appear:AnimationStateEnum.update;(i=this._chart)===null||i===void 0||i.getAllRegions().forEach(l=>{var u;(u=l.animate)===null||u===void 0||u.updateAnimateState(o,!0)}),(n=this._chart)===null||n===void 0||n.getAllComponents().forEach(l=>{var u;(u=l.animate)===null||u===void 0||u.updateAnimateState(o,!0)})}}release(){var e,i,n,o;!((e=this._onResize)===null||e===void 0)&&e.cancel&&this._onResize.cancel(),this._chartPluginApply("releaseAll"),this._chartPlugin=null,this._chartSpecTransformer=null,(i=this._chart)===null||i===void 0||i.release(),(n=this._eventDispatcher)===null||n===void 0||n.release(),(o=this._compiler)===null||o===void 0||o.release(),this._unBindResizeEvent(),this._releaseData(),this._onError=null,this._onResize=null,this._container=null,this._currentTheme=null,this._option=null,this._chart=null,this._compiler=null,this._spec=null,this._specInfo=null,this._originalSpec=null,this._userEvents=null,this._event=null,this._eventDispatcher=null,this._isReleased=!0,InstanceManager.unregisterInstance(this)}updateData(e,i,n,o){return __awaiter(this,void 0,void 0,function*(){return this.updateDataSync(e,i,n,o)})}_updateDataById(e,i,n){const o=this._spec.data.find(l=>l.name===e||l.id===e);o?o.id===e?o.values=i:o.name===e&&o.parse(i,n):isArray(i)?this._spec.data.push({id:e,values:i}):this._spec.data.push(i)}updateDataInBatches(e){return __awaiter(this,void 0,void 0,function*(){return this._chart?(this._chart.updateFullData(e.map(({id:i,data:n,options:o})=>({id:i,values:n,parser:o}))),this._chart.updateGlobalScaleDomain(),this._compiler.render(),this):(this._spec.data=array(this._spec.data),e.forEach(({id:i,data:n,options:o})=>{this._updateDataById(i,n,o)}),this)})}updateDataSync(e,i,n,o){return isNil(this._dataSet)?this:this._chart?(o!=null&&o.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateData(e,i,!0,n),this._compiler.render(),this):(this._spec.data=array(this._spec.data),this._updateDataById(e,i,n),this)}updateFullDataSync(e,i=!0,n){if(this._chart)return n!=null&&n.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateFullData(e),i&&this._compiler.render(),this;const o=array(this._spec.data);return array(e).forEach(l=>{const{id:u,values:d,parser:f,fields:g}=l,_=o.find(y=>y.name===u);if(_)_ instanceof DataView?(_.setFields(cloneDeep(g)),_.parse(d,cloneDeep(f))):(_.values=d,isValid(f)&&(_.parser=f),isValid(g)&&(_.fields=g));else{const y=dataToDataView(l,this._dataSet,o);isArray(this._spec.data)&&this._spec.data.push(y)}}),this}updateFullData(e,i=!0){return __awaiter(this,void 0,void 0,function*(){return this.updateFullDataSync(e,i)})}updateSpec(e,i=!1,n,o){return __awaiter(this,void 0,void 0,function*(){const l=this._updateSpec(e,i,o);return l?(yield this.updateCustomConfigAndRerender(l,!1,{morphConfig:n,transformSpec:l.reTransformSpec,actionSource:"updateSpec"}),this):this})}updateSpecSync(e,i=!1,n,o){const l=this._updateSpec(e,i,o);return l?(this.updateCustomConfigAndRerender(l,!0,{morphConfig:n,transformSpec:l.reTransformSpec,actionSource:"updateSpec"}),this):this}updateSpecAndRecompile(e,i=!1,n={}){const o=this._updateSpec(e,i);return this._updateCustomConfigAndRecompile(o,Object.assign({actionSource:"updateSpecAndRecompile"},n))}updateModelSpec(e,i,n=!1,o){return __awaiter(this,void 0,void 0,function*(){return this.updateModelSpecSync(e,i,n,o)})}updateModelSpecSync(e,i,n=!1,o){if(!i||!this._spec)return this;if(isString(i)&&(i=JSON.parse(i)),isFunction(e)||mergeSpecWithFilter(this._spec,e,i,n),this._chart){const l=this._chart.getModelInFilter(e);if(l)return this._updateModelSpec(l,i,!0,n,o)}return this}_updateModelSpec(e,i,n=!1,o=!1,l){o&&(i=mergeSpec({},e.getSpec(),i));const u=e.updateSpec(i);return e.reInit(i),(u.change||u.reCompile||u.reMake||u.reSize||u.reRender)&&this._chart.reDataFlow(),this.updateCustomConfigAndRerender(u,n,{morphConfig:l,transformSpec:!1,actionSource:"updateModelSpec"})}resize(e,i){return __awaiter(this,void 0,void 0,function*(){return this.resizeSync(e,i)})}resizeSync(e,i){var n,o;return this._beforeResize(e,i)?((o=(n=this._compiler).resize)===null||o===void 0||o.call(n,e,i),this._afterResize()):this}_beforeResize(e,i){var n,o,l,u;if(!this._chart||!this._compiler)return!1;const d=this._chart.getCanvasRect();return(!d||d.width!==e||d.height!==i)&&(this._chartPluginApply("onBeforeResize",e,i),(o=(n=this._option.performanceHook)===null||n===void 0?void 0:n.beforeResizeWithUpdate)===null||o===void 0||o.call(n),this._chart.onResize(e,i,!1),(u=(l=this._option.performanceHook)===null||l===void 0?void 0:l.afterResizeWithUpdate)===null||u===void 0||u.call(l),!0)}_afterResize(){return this._isReleased||this._event.emit(ChartEvent.afterResize,{chart:this._chart}),this}updateViewBox(e,i=!0,n=!0){return this._chart&&this._compiler?(this._viewBox=e,this._chart.updateViewBox(e,n),n&&(this._compiler.render(),this._chart.onEvaluateEnd()),this._compiler.updateViewBox(e,i),this):this}on(e,i,n){var o;this._userEvents&&(this._userEvents.push({eType:e,query:typeof i=="function"?null:i,handler:typeof i=="function"?i:n}),(o=this._event)===null||o===void 0||o.on(e,i,n))}off(e,i){var n;if(this._userEvents&&this._userEvents.length!==0)if(i){const o=this._userEvents.findIndex(l=>l.eType===e&&l.handler===i);o>=0&&(this._userEvents.splice(o,1),(n=this._event)===null||n===void 0||n.off(e,i))}else this._userEvents.forEach(o=>{var l;o.eType===e&&((l=this._event)===null||l===void 0||l.off(e,o.handler))}),this._userEvents=this._userEvents.filter(o=>o.eType!==e)}updateState(e,i){this._chart&&this._chart.updateState(e,i)}setSelected(e,i,n){this._chart&&this._chart.setSelected(e,i,n)}setHovered(e,i,n){this._chart&&this._chart.setHovered(e,i,n)}clearState(e){this._chart&&this._chart.clearState(e)}clearAllStates(){this._chart&&this._chart.clearAllStates()}clearSelected(){this._chart&&this._chart.clearSelected()}clearHovered(){this._chart&&this._chart.clearHovered()}_updateCurrentTheme(e){var i,n,o;const l=this._option.theme,u=(i=this._spec)===null||i===void 0?void 0:i.theme,d=(n=this._spec)===null||n===void 0?void 0:n.type;e&&(this._currentThemeName=e);const f=(_,y)=>{var b;return!((b=y.chart)===null||b===void 0)&&b[_]&&(y=mergeTheme({},y,y.chart[_])),y};let g;if(isEmpty(l)&&isEmpty(u))g=getThemeObject(this._currentThemeName,!0),this._currentTheme=f(d,g);else if(isString(l)&&(!u||isString(u))||isString(u)&&(!l||isString(l))){const _=mergeTheme({},getThemeObject(this._currentThemeName,!0),getThemeObject(l,!0),getThemeObject(u,!0));this._currentTheme=f(d,_)}else{const _=mergeTheme({},getThemeObject(this._currentThemeName),getThemeObject(l),getThemeObject(u));this._currentTheme=preprocessTheme(f(d,_))}setPoptipTheme(get(this._currentTheme,"component.poptip")),(o=this._compiler)===null||o===void 0||o.setBackground(this._getBackground())}_shouldChartResize(e){var i,n;let o=!1;isNil(this._spec.width)?!isNil(e.width)&&(this._spec.width=e.width):this._spec.width!==e.width&&(o=!0),isNil(this._spec.height)?!isNil(e.height)&&(this._spec.height=e.height):this._spec.height!==e.height&&(o=!0);const l=this._autoSize;return this._autoSize=!!isTrueBrowser(this._option.mode)&&((n=(i=this._spec.autoFit)!==null&&i!==void 0?i:this._option.autoFit)===null||n===void 0||n),this._autoSize!==l&&(o=!0),o}_getBackground(){return(typeof this._spec.background=="string"||isObject$1(this._spec.background)&&this._spec.background.gradient?this._spec.background:null)||this._currentTheme.background||this._option.background}getCurrentTheme(){return getThemeObject(this._currentThemeName)}getCurrentThemeName(){return this._currentThemeName}setCurrentTheme(e){return __awaiter(this,void 0,void 0,function*(){return this.setCurrentThemeSync(e)})}setCurrentThemeSync(e){var i;if(!ThemeManager$1.themeExist(e))return this;const n=this._setCurrentTheme(e);return this._setFontFamilyTheme((i=this._currentTheme)===null||i===void 0?void 0:i.fontFamily),this.updateCustomConfigAndRerender(n,!0,{transformSpec:!1,actionSource:"setCurrentTheme"}),this}_setCurrentTheme(e){var i;return this._updateCurrentTheme(e),this._initChartSpec(this._getSpecFromOriginalSpec(),"setCurrentTheme"),(i=this._chart)===null||i===void 0||i.setCurrentTheme(),{change:!0,reMake:!1}}_setFontFamilyTheme(e){var i;e&&((i=this.getStage())===null||i===void 0||i.setTheme({text:{fontFamily:e}}))}_getTooltipComponent(){var e;return(e=this._chart)===null||e===void 0?void 0:e.getComponentsByType(ComponentTypeEnum.tooltip)[0]}setTooltipHandler(e){var i,n;this._context.tooltipHandler=e;const o=this._getTooltipComponent();o&&((n=(i=o.tooltipHandler)===null||i===void 0?void 0:i.release)===null||n===void 0||n.call(i),o.tooltipHandler=e)}getTooltipHandlerByUser(){var e;return(e=this._context)===null||e===void 0?void 0:e.tooltipHandler}getTooltipHandler(){const e=this._getTooltipComponent();return e?e.tooltipHandler:this._context.tooltipHandler}showTooltip(e,i){var n;const o=this._getTooltipComponent();return(n=isValid(e)&&(o==null?void 0:o.showTooltip(e,i))!=="none")!==null&&n!==void 0&&n}hideTooltip(){var e;const i=this._getTooltipComponent();return(e=i==null?void 0:i.hideTooltip())!==null&&e!==void 0&&e}getLegendDataById(e){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(e);return n?n.getLegendData():[]}getLegendDataByIndex(e=0){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(ComponentTypeEnum.discreteLegend);return n&&n[e]?n[e].getLegendData():[]}getLegendSelectedDataById(e){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(e);return n?n.getSelectedData():[]}getLegendSelectedDataByIndex(e=0){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(ComponentTypeEnum.discreteLegend);return n&&n[e]?n[e].getSelectedData():[]}setLegendSelectedDataById(e,i){var n;const o=(n=this._chart)===null||n===void 0?void 0:n.getComponentByUserId(e);o&&o.setSelectedData(i)}setLegendSelectedDataByIndex(e=0,i){var n;const o=(n=this._chart)===null||n===void 0?void 0:n.getComponentsByType(ComponentTypeEnum.discreteLegend);o&&o[e]&&o[e].setSelectedData(i)}getDataURL(){var e;return __awaiter(this,void 0,void 0,function*(){const i=this.getStage();if(this._chart&&i){i.render();const n=this._chart.getCanvas();return yield getCanvasDataURL(n,{onError:this._onError})}return(e=this._option)===null||e===void 0||e.onError(new ReferenceError("render is not defined")),null})}exportImg(e){var i,n;return __awaiter(this,void 0,void 0,function*(){if(!isTrueBrowser(this._option.mode))return void((i=this._option)===null||i===void 0||i.onError(new TypeError("non-browser environment can not export img")));const o=yield this.getDataURL();o?URLToImage(e,o):(n=this._option)===null||n===void 0||n.onError(new ReferenceError("render is not defined"))})}exportCanvas(){var e;const i=this.getStage();if(this._chart&&i)return i.toCanvas();(e=this._option)===null||e===void 0||e.onError(new ReferenceError("render is not defined"))}getImageBuffer(){var e,i;if(this._option.mode!=="node")return void((e=this._option)===null||e===void 0||e.onError(new TypeError("getImageBuffer() now only support node environment.")));const n=this.getStage();return n?(n.render(),n.window.getImageBuffer()):((i=this._option)===null||i===void 0||i.onError(new ReferenceError("render is not defined")),null)}setLayout(e){var i;this._option.layout=e,(i=this._chart)===null||i===void 0||i.setLayout(e)}reLayout(){var e;(e=this._chart)===null||e===void 0||e.setLayoutTag(!0)}getCompiler(){return this._compiler}getChart(){return this._chart}getStage(){return this._compiler.getStage()}getCanvas(){var e;return(e=this._compiler)===null||e===void 0?void 0:e.getCanvas()}getContainer(){var e;if(isValid(this._container))return this._container;let i;return i=isString(this._canvas)?vglobal.getElementById(this._canvas):this._canvas,isValid(i)?i.parentElement:(e=this.getCanvas())===null||e===void 0?void 0:e.parentElement}getComponents(){return this._chart.getAllComponents()}getScale(e){var i;const n=(i=this._chart)===null||i===void 0?void 0:i.getGlobalScale();return n==null?void 0:n.getScale(e)}setDimensionIndex(e,i={}){var n;return(n=this._chart)===null||n===void 0?void 0:n.setDimensionIndex(e,i)}stopAnimation(){var e,i,n;(n=(i=(e=this._compiler)===null||e===void 0?void 0:e.getVGrammarView())===null||i===void 0?void 0:i.animate)===null||n===void 0||n.stop()}pauseAnimation(){var e,i,n;(n=(i=(e=this._compiler)===null||e===void 0?void 0:e.getVGrammarView())===null||i===void 0?void 0:i.animate)===null||n===void 0||n.pause()}resumeAnimation(){var e,i,n;(n=(i=(e=this._compiler)===null||e===void 0?void 0:e.getVGrammarView())===null||i===void 0?void 0:i.animate)===null||n===void 0||n.resume()}convertDatumToPosition(e,i={},n=!1,o){var l;if(!this._chart||isEmpty(e))return null;const{seriesId:u,seriesIndex:d=0}=i;let f;if(isValid(u)?f=this._chart.getSeriesInUserId(u):isValid(d)&&(f=(l=this._chart.getSeriesInIndex([d]))===null||l===void 0?void 0:l[0]),f){const g=Object.keys(e),_=f.getViewData().latestData.find(S=>g.every(v=>S[v]==e[v])),y=f.getRegion().getLayoutStartPoint();let b;return b=_?f.dataToPosition(_,o):f.dataToPosition(e,o),b?convertPoint(b,y,n):null}return null}convertValueToPosition(e,i,n=!1){var o,l;if(!this._chart||isNil(e)||isEmpty(i))return null;if(!isArray(e)){const{axisId:g,axisIndex:_}=i;let y;if(isValid(g)?y=this._chart.getComponentsByKey("axes").find(S=>S.userId===g):isValid(_)&&(y=(o=this._chart.getComponentsByKey("axes"))===null||o===void 0?void 0:o[_]),!y)return warn("Please check whether the `axisId` or `axisIndex` is set!"),null;const b=y==null?void 0:y.valueToPosition(e);if(n){const S=y.getLayoutStartPoint(),v=y.getOrient();return b+(v==="bottom"||v==="top"?S.x:S.y)}return b}const{seriesId:u,seriesIndex:d}=i;let f;return isValid(u)?f=this._chart.getSeriesInUserId(u):isValid(d)&&(f=(l=this._chart.getSeriesInIndex([d]))===null||l===void 0?void 0:l[0]),f?convertPoint(f.valueToPosition(e[0],e[1]),f.getRegion().getLayoutStartPoint(),n):(warn("Please check whether the `seriesId` or `seriesIndex` is set!"),null)}getFunction(e){return ExpressionFunction.instance().getFunction(e)}registerFunction(e,i){e&&i&&ExpressionFunction.instance().registerFunction(e,i)}unregisterFunction(e){e&&ExpressionFunction.instance().unregisterFunction(e)}getFunctionList(){return ExpressionFunction.instance().getFunctionNameList()}setRuntimeSpec(e){this._spec=e,this._updateSpecInfo()}updateIndicatorDataById(e,i){var n;const o=(n=this._chart)===null||n===void 0?void 0:n.getComponentByUserId(e);o&&o.updateDatum(i)}updateIndicatorDataByIndex(e=0,i){var n;const o=(n=this._chart)===null||n===void 0?void 0:n.getComponentsByType(ComponentTypeEnum.indicator);o&&o[e]&&o[e].updateDatum(i)}geoZoomByIndex(e=0,i,n){this._geoZoomByQuery({regionIndex:e},i,n)}geoZoomById(e,i,n){this._geoZoomByQuery({regionId:e},i,n)}_geoZoomByQuery(e,i,n){var o,l;const u=(o=this._chart)===null||o===void 0?void 0:o.getRegionsInQuerier(e)[0],d=(l=this._chart)===null||l===void 0?void 0:l.getComponentsByType(ComponentTypeEnum.geoCoordinate),f=d==null?void 0:d.find(g=>{var _;return(_=g.getRegions())===null||_===void 0?void 0:_.includes(u)});f&&f.dispatchZoom(i,n)}_initChartPlugin(){const e=Factory$1.getChartPlugins();e.length>0&&(this._chartPlugin=new ChartPluginService(this),this._chartPlugin.load(e.map(i=>new i)),this._chartPluginApply("onInit",this._spec))}_chartPluginApply(e,...i){this._chartPlugin&&this._chartPlugin[e]&&this._chartPlugin[e].apply(this._chartPlugin,i)}_getMode(){return this._option.mode||RenderModeEnum["desktop-browser"]}_getChartOption(e){return{type:e,globalInstance:this,eventDispatcher:this._eventDispatcher,dataSet:this._dataSet,container:this._container,canvas:this._canvas,map:new Map,mode:this._getMode(),modeParams:this._option.modeParams,getCompiler:()=>this._compiler,performanceHook:this._option.performanceHook,viewBox:this._viewBox,animation:this._option.animation,getTheme:()=>{var i;return(i=this._currentTheme)!==null&&i!==void 0?i:{}},getSpecInfo:()=>{var i;return(i=this._specInfo)!==null&&i!==void 0?i:{}},layout:this._option.layout,onError:this._onError,disableTriggerEvent:this._option.disableTriggerEvent===!0}}}VChart.InstanceManager=InstanceManager,VChart.ThemeManager=ThemeManager$1,VChart.globalConfig={uniqueTooltip:!0},VChart.Utils=VCHART_UTILS,VChart.vglobal=vglobal;Factory$1.registerRegion("region",Region),Factory$1.registerLayout("base",Layout$1),registerGroupMark(),View.useRegisters([registerGesturePlugin]),registerElementHighlight(),registerElementSelect(),registerTheme(darkTheme$1.name,darkTheme$1),Logger.getInstance(LoggerLevel.Error);const addVChartProperty=(r,e)=>{const i=e.beforeCall();return r&&r.forEach((n,o)=>e.call(n,o,i)),i.keyMap&&(i.keyMap.clear(),i.keyMap=null),r};function getComponentThemeFromOption(r,e){return get(e,`component.${r}`)}function getFormatFunction(r,e,i,n){if(r)return{formatFunc:r,args:[i,n]};const o=Factory$1.getFormatter();return e&&o?{formatFunc:o,args:[i,n,e]}:{}}const getSpecInfo=(r,e,i,n)=>{if(isNil(r[e]))return;const o=isArray(r[e]),l=o?r[e]:[r[e]],u=[];return l.forEach((d,f)=>{!d||n&&!n(d)||u.push({spec:d,specPath:o?[e,f]:[e],specInfoPath:["component",e,f],type:i})}),u},getTooltipContentValue=(r,e,i,n)=>{let o;if(o=isFunction(r)?r(e,i):isPlainObject(r)&&isValid(r.field)?get(e,r.field):r,n){const{formatFunc:l,args:u}=getFormatFunction(void 0,n,r,e);l&&u&&(o=l(...u))}return o},getTooltipPatternValue=(r,e,i)=>isNil(r)?r:isFunction(r)?r(e,i):r;function getFirstDatumFromTooltipData(r){var e;const i=!((e=r[0])===null||e===void 0)&&e.series?[{data:r,value:""}]:r;for(const{data:n}of i)for(const{datum:o}of n)for(const l of o??[])if(l)return l}var __rest$e=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const getTooltipActualActiveType=r=>{var e,i,n;if((r==null?void 0:r.visible)===!1)return[];const o={mark:((e=r==null?void 0:r.mark)===null||e===void 0?void 0:e.visible)!==!1,dimension:((i=r==null?void 0:r.dimension)===null||i===void 0?void 0:i.visible)!==!1,group:((n=r==null?void 0:r.group)===null||n===void 0?void 0:n.visible)!==!1};return isValid(r==null?void 0:r.activeType)&&Object.keys(o).forEach(l=>{var u;o[l]=(u=r==null?void 0:r.activeType)===null||u===void 0?void 0:u.includes(l)}),Object.keys(o).filter(l=>o[l])},isActiveTypeVisible=(r,e)=>!e||e.visible!==!1&&(!e[r]||e[r].visible!==!1)&&!(e.activeType&&!(isArray(e.activeType)?e.activeType.includes(r):e.activeType===r));function isEmptyPos(r){return isNil(r.mark)&&isNil(r.model)&&isNil(r.datum)}function addContentLine(r,e,i,n,o,l){const u=d=>{if(d){const f={datum:o},g=isNil(d.key)&&isNil(d.value)&&!isEmpty(d)?Object.assign(Object.assign(Object.assign({},n),i),d):Object.assign(Object.assign({},n),d),{key:_,keyFormatter:y,keyTimeFormat:b,keyTimeFormatMode:S,value:v,valueFormatter:A,valueTimeFormat:x,valueTimeFormatMode:T}=g,C=__rest$e(g,["key","keyFormatter","keyTimeFormat","keyTimeFormatMode","value","valueFormatter","valueTimeFormat","valueTimeFormatMode"]);f.key=getTimeString(getTooltipContentValue(_,o,l,y),b,S),f.value=getTimeString(getTooltipContentValue(v,o,l,A),x,T),Object.keys(C).forEach(E=>{f[E]=getTooltipContentValue(g[E],o,l)}),f.visible!==!1&&(isValid(f.key)||isValid(f.value))&&r.push(f)}};isArray(e)?e.forEach(d=>{u(d)}):u(e)}function parseContentFunction(r,e,i,n,o,l,u){isFunction(e)?addContentLine(r,e(o,u),i,n,l,u):e&&addContentLine(r,e,i,n,l,u)}function parseContent(r,e,i,n,o,l){if(o&&o.length){const u=[];return o.forEach(d=>{isArray(r)?r.forEach(f=>{parseContentFunction(u,f,e,i,n,d,l)}):isFunction(r)?parseContentFunction(u,r,e,i,n,d,l):r&&addContentLine(u,r,e,i,d,l)}),u}return null}function combineContents(r){if(!r||!r.length)return null;const e=[];return r.forEach(({content:i})=>{i&&i.forEach(n=>{e.push(n)})}),e.length?Object.assign(Object.assign({},r[0]),{content:e}):r[0]}const getTimeString=(r,e,i)=>{if(!e&&!i)return typeof r!="object"?r==null?void 0:r.toString():r;const n=TimeUtil.getInstance();return e=e||"%Y%m%d",((i=i||"local")==="local"?n.timeFormat:n.timeUTCFormat)(e,r)};class BaseSeriesTooltipHelper{constructor(e){this.activeTriggerSet={mark:new Set,group:new Set},this.ignoreTriggerSet={mark:new Set},this._getSeriesCacheInfo=()=>{var i,n,o;const{series:l}=this,u=l.getSeriesField();return{seriesFields:isValid(u)?array(u):(i=l.getSeriesKeys())!==null&&i!==void 0?i:[],dimensionFields:(n=l.getDimensionField())!==null&&n!==void 0?n:[],measureFields:(o=l.getMeasureField())!==null&&o!==void 0?o:[],type:l.type}},this._getDimensionData=i=>{const{dimensionFields:n}=this._seriesCacheInfo;return n[0]&&(i==null?void 0:i[n[0]])},this._getMeasureData=i=>{const{measureFields:n}=this._seriesCacheInfo;return n[0]&&(i==null?void 0:i[n[0]])},this._getSeriesFieldData=i=>{const{dimensionFields:n,seriesFields:o}=this._seriesCacheInfo;if(isValid(o[0])&&(i!=null&&i[o[0]]))return i==null?void 0:i[o[0]];const l=n[n.length-1];return n.length>1&&(o.length===0||this.series.getSeriesKeys().length),i==null?void 0:i[l]},this._getSeriesStyle=(i,n,o)=>{var l;for(const u of array(n)){const d=(l=this.series.getSeriesStyle(i))===null||l===void 0?void 0:l(u);if(isValid(d))return d}return o},this.markTooltipKeyCallback=(i,n)=>this._getSeriesFieldData(i),this.markTooltipValueCallback=(i,n)=>this._getMeasureData(i),this.shapeTypeCallback=(i,n)=>{var o;return(o=this._getSeriesStyle(i,"shape",null))!==null&&o!==void 0?o:this._getSeriesStyle(i,"symbolType",this.series.getDefaultShapeType())},this.shapeColorCallback=(i,n)=>this._getSeriesStyle(i,["fill","stroke"]),this.shapeStrokeCallback=(i,n)=>this._getSeriesStyle(i,["stroke","fill"]),this.dimensionTooltipTitleCallback=(i,n)=>this._getDimensionData(i),this.groupTooltipTitleCallback=(i,n)=>this._getSeriesFieldData(i),this.groupTooltipKeyCallback=(i,n)=>{const{seriesFields:o}=this._seriesCacheInfo;let l=this._seriesCacheInfo.dimensionFields;return o[0]&&(l=l.filter(u=>u!==o[0])),l.map(u=>i==null?void 0:i[u]).join("-")},this.getHasShape=i=>!!i,this.series=e,this.updateTooltipSpec()}updateTooltipSpec(){var e;const i=(e=this.series.getSpec())===null||e===void 0?void 0:e.tooltip;this.spec=i,this._seriesCacheInfo=this._getSeriesCacheInfo()}getShapeAttrs(e,i,n){var o,l,u,d,f,g,_,y,b,S,v,A;const x=i?"content":"title",T=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(o=n==null?void 0:n.style)===null||o===void 0?void 0:o.shape),n==null?void 0:n[e]),(l=n==null?void 0:n[e])===null||l===void 0?void 0:l[x]),(u=this.spec)===null||u===void 0?void 0:u[e]),(f=(d=this.spec)===null||d===void 0?void 0:d[e])===null||f===void 0?void 0:f[x]);return{shapeType:(g=T.shapeType)!==null&&g!==void 0?g:this.shapeTypeCallback,shapeFill:(y=(_=T.shapeFill)!==null&&_!==void 0?_:T.shapeColor)!==null&&y!==void 0?y:this.shapeColorCallback,shapeStroke:(b=T.shapeStroke)!==null&&b!==void 0?b:this.shapeStrokeCallback,shapeHollow:(S=T.shapeHollow)!==null&&S!==void 0&&S,shapeLineWidth:T.shapeLineWidth,shapeSize:(v=T.shapeSize)!==null&&v!==void 0?v:T.size,hasShape:(A=T.hasShape)!==null&&A!==void 0?A:this.getHasShape(i)}}enableByType(e){return!0}getDefaultContentList(e){return[this.getDefaultContentPattern(e)]}getContentList(e,i,n,o,l,u){var d;return parseContent((d=i==null?void 0:i.content)!==null&&d!==void 0?d:this.getDefaultContentList(e),this.getDefaultContentPattern(e),n,o,l,u)}getTitleResult(e,i,n,o,l){let u=isFunction(i)?i(o,l):i;if(u?isNil(u.value)&&(u=Object.assign(Object.assign({},this.getDefaultTitlePattern(e)),u)):u=this.getDefaultTitlePattern(e),u&&u.visible!==!1){const d=getFirstDatumFromTooltipData(o),f={visible:getTooltipContentValue(u.visible,d,l),value:getTimeString(getTooltipContentValue(u.value,d,l,u.valueFormatter),u.valueTimeFormat,u.valueTimeFormatMode),valueStyle:getTooltipContentValue(u.valueStyle,d,l),hasShape:u.hasShape};return Object.keys(n).forEach(g=>{f[g]=getTooltipContentValue(n[g],d,l)}),f}return{hasShape:!1,visible:!1}}getTooltipData(e,i,n,o,l){var u,d;if(!(this.enableByType(e)&&isActiveTypeVisible(e,this.spec)&&(e!=="dimension"||o&&o.length)))return null;const f=(d=(u=this.spec)===null||u===void 0?void 0:u[e])!==null&&d!==void 0?d:i==null?void 0:i[e],g=this.getShapeAttrs(e,!0,i),_=this.getShapeAttrs(e,!1,i);let y;return e==="dimension"?(y=[],this.getContentList(e,f,g,n,o,l).forEach(b=>{y.push(b)})):y=this.getContentList(e,f,g,n,o,l),{visible:!0,activeType:e,data:n,title:this.getTitleResult(e,f==null?void 0:f.title,_,n,l),content:y}}getDefaultTitlePattern(e){return{key:void 0,value:e==="group"?this.groupTooltipTitleCallback:this.dimensionTooltipTitleCallback}}getDefaultContentPattern(e){return{seriesId:this.series.id,key:e==="group"?this.groupTooltipKeyCallback:this.markTooltipKeyCallback,value:this.markTooltipValueCallback}}}const methods={min:r=>r.length?minInArray(r.map(e=>1*e)):0,max:r=>r.length?maxInArray(r.map(e=>1*e)):0,"array-min":r=>r.length?minInArray(r.map(e=>1*e)):0,"array-max":r=>r.length?maxInArray(r.map(e=>1*e)):0,values:r=>{const e={},i=[];for(const n of r)e[n]||(i.push(n),e[n]=1);return i}},dimensionStatistics=(r,e)=>{var i,n;let o=e.fields;if(isFunction(o)&&(o=o()),!(o!=null&&o.length)||!(r!=null&&r.length))return{};o=mergeFields([],o);const l=e.target==="parser"?"parserData":"latestData",u=r[0][l]?r[0][l]:r||[],d=(n=(i=r[0]).getFields)===null||n===void 0?void 0:n.call(i);return dimensionStatisticsOfSimpleData(u,o,d)},dimensionStatisticsOfSimpleData=(r,e,i)=>{const n={};let o=[],l=[];return e.forEach(u=>{const d=u.key;n[d]={};const f=i==null?void 0:i[d],g=u.operations,_=g.some(S=>S==="min"||S==="max"||S==="allValid");let y=!0;o.length=0,r&&r.forEach(S=>{S&&o.push(S[d])});const b=o.length;if(_){l.length=0,o.forEach((v,A)=>{couldBeValidNumber(v)&&l.push(v)});const S=o;o=l,l=S,y=o.length===b}else o=g.some(S=>S==="array-min"||S==="array-max")?o.reduce((S,v)=>(v&&v.forEach(A=>{couldBeValidNumber(A)&&S.push(A)}),S),[]):o.filter(S=>S!==void 0);u.filter&&(o=o.filter(u.filter)),g.forEach(S=>{if(u.customize)n[d][S]=u.customize;else{if(f&&f.lockStatisticsByDomain&&!isNil(f.domain)){if(S==="values")return void(n[d][S]=f.domain.slice())}else if(S==="allValid")return;n[d][S]=methods[S](o),S==="array-max"&&(n[d].max=n[d][S]),S==="array-min"&&(n[d].min=n[d][S])}}),_&&(n[d].allValid=y)}),n},invalidTravel=(r,e)=>{const{config:i}=e;if(!i)return r;const{invalidType:n,checkField:o}=i();return n!=="zero"||o&&o.length&&r.forEach(l=>{o.forEach(u=>{couldBeValidNumber(l[u])||(l[u]=0)})}),r};class SeriesData extends CompilableData{_compileProduct(){var e;const i=(e=this._data)===null||e===void 0?void 0:e.latestData;isNil(i)||isValid(this.getProduct())||this._initProduct([])}generateProductId(){var e;return(e=this._data)===null||e===void 0?void 0:e.name}}const DEFAULT_HIERARCHY_DEPTH=`${PREFIX}_HIERARCHY_DEPTH`,DEFAULT_HIERARCHY_ROOT=`${PREFIX}_HIERARCHY_ROOT`,DEFAULT_HIERARCHY_ROOT_INDEX=`${PREFIX}_HIERARCHY_ROOT_INDEX`;function initKeyMap(){return{keyMap:new Map,needDefaultSeriesField:!this._seriesField,defaultSeriesField:this._seriesField?null:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey)}}function addDataKey(r,e,i){r&&(i.needDefaultSeriesField&&(r[DEFAULT_DATA_SERIES_FIELD]=i.defaultSeriesField),r[DEFAULT_DATA_INDEX]=e,r[DEFAULT_DATA_KEY]=i.getKey(r,e,i))}function initHierarchyKeyMap(){return{keyMap:new Map,needDefaultSeriesField:!0,defaultSeriesField:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey),categoryField:this.getCategoryField()}}function addHierarchyDataKey(r,e,i,n=0,o,l){l===void 0&&(l=e),addDataKey(r,e,i),r[DEFAULT_HIERARCHY_DEPTH]=n,r[DEFAULT_HIERARCHY_ROOT]=o||r[i.categoryField],r[DEFAULT_HIERARCHY_ROOT_INDEX]=l,r.children&&r.children.length&&r.children.forEach((u,d)=>addHierarchyDataKey(u,d,i,r[DEFAULT_HIERARCHY_DEPTH]+1,r[DEFAULT_HIERARCHY_ROOT],l))}const baseSeriesMark={label:{name:"label",type:"text"}},RECT_X=`${PREFIX}_rect_x`,RECT_X1=`${PREFIX}_rect_x1`,RECT_Y=`${PREFIX}_rect_y`,RECT_Y1=`${PREFIX}_rect_y1`,defaultSeriesIgnoreCheckKeys={data:!0},defaultSeriesCompileCheckKeys={invalidType:!0,animation:!0,animationAppear:!0,animationEnter:!0,animationUpdate:!0,animationExit:!0,animationNormal:!0},Appear_ClipIn=r=>({type:"clipIn",options:{clipDimension:r.direction==="horizontal"?"y":"x"}}),Appear_FadeIn$8={type:"fadeIn"},Appear_Grow$5=r=>({type:r.direction==="horizontal"?"growPointsXIn":"growPointsYIn",options:{orient:r.direction==="horizontal"?"positive":"negative"}});function linePresetAnimation(r,e){switch(e){case"grow":return Appear_Grow$5(r);case"fadeIn":return Appear_FadeIn$8;default:return Appear_ClipIn(r)}}const DEFAULT_ANIMATION_CONFIG={appear:{duration:1e3,easing:"cubicOut"},update:{type:"update",duration:300,easing:"linear"},enter:{duration:300,easing:"linear"},exit:{duration:300,easing:"linear"},disappear:{duration:500,easing:"cubicIn"},state:{duration:300,easing:"linear"}},ScaleInOutAnimation={appear:{type:"scaleIn"},enter:{type:"scaleIn"},exit:{type:"scaleOut"},disappear:{type:"scaleOut"}},FadeInOutAnimation={appear:{type:"fadeIn"},enter:{type:"fadeIn"},exit:{type:"fadeOut"},disappear:{type:"fadeOut"}},registerScaleInOutAnimation=()=>{Factory$1.registerAnimation("scaleInOut",()=>ScaleInOutAnimation)},registerFadeInOutAnimation=()=>{Factory$1.registerAnimation("fadeInOut",()=>FadeInOutAnimation)},registerCartesianGroupClipAnimation=()=>{Factory$1.registerAnimation("cartesianGroupClip",r=>({appear:{custom:ClipDirectionAnimate,customParameters:(e,i)=>({animationType:"in",group:i.getGraphicItem(),direction:r.direction(),width:r.width(),height:r.height(),orient:r.orient()})},disappear:{custom:ClipDirectionAnimate,customParameters:(e,i)=>({animationType:"out",group:i.getGraphicItem(),direction:r.direction(),width:r.width(),height:r.height(),orient:r.orient()})}}))},lineOrAreaAnimation=(r,e)=>({appear:linePresetAnimation(r,e),enter:{type:"fadeIn"},exit:{type:"fadeOut"},update:[{type:"update",options:{excludeChannels:["points","defined","segments"]}},{channel:["points","segments"],custom:TagPointsUpdate,duration:DEFAULT_ANIMATION_CONFIG.update.duration,easing:DEFAULT_ANIMATION_CONFIG.update.easing,customParameters:{clipRangeByDimension:r.direction==="horizontal"?"y":"x"}}],disappear:{type:"clipOut"}}),registerLineAnimation=()=>{Factory$1.registerAnimation("line",lineOrAreaAnimation)},registerAreaAnimation=()=>{Factory$1.registerAnimation("area",lineOrAreaAnimation)},registerVGrammarCommonAnimation=()=>{View.useRegisters([registerScaleInAnimation,registerScaleOutAnimation,registerFadeInAnimation,registerFadeOutAnimation,registerMoveInAnimation,registerMoveOutAnimation,registerRotateInAnimation,registerRotateOutAnimation,registerUpdateAnimation])},registerVGrammarRectAnimation=()=>{View.useRegisters([registerGrowHeightInAnimation,registerGrowHeightOutAnimation,registerGrowWidthInAnimation,registerGrowWidthOutAnimation,registerGrowCenterInAnimation,registerGrowCenterOutAnimation])},registerVGrammarArcAnimation=()=>{View.useRegisters([registerGrowRadiusInAnimation,registerGrowRadiusOutAnimation,registerGrowAngleInAnimation,registerGrowAngleOutAnimation])},registerVGrammarLineOrAreaAnimation=()=>{View.useRegisters([registerGrowPointsInAnimation,registerGrowPointsOutAnimation,registerGrowPointsXInAnimation,registerGrowPointsXOutAnimation,registerGrowPointsYInAnimation,registerGrowPointsYOutAnimation,registerClipInAnimation,registerClipOutAnimation])},registerVGrammarPolygonAnimation=()=>{View.useRegisters([registerGrowPointsInAnimation,registerGrowPointsOutAnimation])},AnimationStates=[...Object.keys(DEFAULT_ANIMATION_CONFIG),"normal"];function animationConfig(r={},e,i){const n={};for(let o=0;o<AnimationStates.length;o++){const l=AnimationStates[o],u=e?e[l]:void 0;if(u===!1)continue;if(l==="normal"){u&&(n.normal=u);continue}if(l==="state"){u!==!1&&(n.state=u??DEFAULT_ANIMATION_CONFIG.state);continue}if(l!=="update"&&!u&&!r[l])continue;let d,f;d=isArray(r[l])?r[l]:[Object.assign(Object.assign({},DEFAULT_ANIMATION_CONFIG[l]),r[l])],l==="exit"&&d.forEach(g=>{g.controlOptions={stopWhenStateChange:!0}}),u?(f=isArray(u)?u.map((g,_)=>{var y;let b=g;return isChannelAnimation(b)&&delete b.type,b.oneByOne&&(b=produceOneByOne(b,(y=i==null?void 0:i.dataIndex)!==null&&y!==void 0?y:defaultDataIndex,i==null?void 0:i.dataCount)),b}):d.map((g,_)=>{var y;let b=mergeSpec({},d[_],u);return isChannelAnimation(b)&&delete b.type,b.oneByOne&&(b=produceOneByOne(b,(y=i==null?void 0:i.dataIndex)!==null&&y!==void 0?y:defaultDataIndex,i==null?void 0:i.dataCount)),b}),n[l]=f):n[l]=d}return n}function userAnimationConfig(r,e,i){var n,o,l,u,d,f;const g={};return isValid(e.animationAppear)&&(g.appear=(n=e.animationAppear[r])!==null&&n!==void 0?n:e.animationAppear),isValid(e.animationDisappear)&&(g.disappear=(o=e.animationDisappear[r])!==null&&o!==void 0?o:e.animationDisappear),isValid(e.animationEnter)&&(g.enter=(l=e.animationEnter[r])!==null&&l!==void 0?l:e.animationEnter),isValid(e.animationExit)&&(g.exit=(u=e.animationExit[r])!==null&&u!==void 0?u:e.animationExit),isValid(e.animationUpdate)&&(g.update=(d=e.animationUpdate[r])!==null&&d!==void 0?d:e.animationUpdate),isValid(e.animationState)&&(g.state=(f=e.animationState[r])!==null&&f!==void 0?f:e.animationState),e.animationNormal&&e.animationNormal[r]&&(g.normal=e.animationNormal[r]),uniformAnimationConfig(g,i)}function produceOneByOne(r,e,i){const{oneByOne:n,duration:o,delay:l,delayAfter:u}=r;return r.delay=(d,f,g)=>{const _=e(d,g),y=isFunction(o)?o(d,f,g):isValidNumber(o)?o:0,b=isFunction(l)?l(d,f,g):isValidNumber(l)?l:0;let S=isFunction(n)?n(d,f,g):n;return S===!1?b:(S=S===!0?0:S,b+_*(y+S))},r.delayAfter=(d,f,g)=>{const _=e(d,g),y=isFunction(o)?o(d,f,g):isValidNumber(o)?o:0,b=isFunction(u)?u(d,f,g):isValidNumber(u)?u:0;let S=isFunction(n)?n(d,f,g):n;return S===!1?b:(S=S===!0?0:S,b+((i?i():f.mark.elements.length)-_)*(y+S))},delete r.oneByOne,r}function defaultDataIndex(r,e){var i,n;return(i=r==null?void 0:r[DEFAULT_DATA_INDEX])!==null&&i!==void 0?i:(n=e==null?void 0:e.VGRAMMAR_ANIMATION_PARAMETERS)===null||n===void 0?void 0:n.elementIndex}function shouldMarkDoMorph(r,e){var i,n,o,l,u;if(r.animation===!1||((i=r.morph)===null||i===void 0?void 0:i.enable)===!1)return!1;const d=((o=(n=r.animationAppear)===null||n===void 0?void 0:n[e])!==null&&o!==void 0?o:r.animationAppear)!==!1,f=((u=(l=r.animationUpdate)===null||l===void 0?void 0:l[e])!==null&&u!==void 0?u:r.animationUpdate)!==!1;return!(!d||!f)}function isTimeLineAnimation(r){return isValid(r.timeSlices)}function isChannelAnimation(r){return!isTimeLineAnimation(r)&&isValid(r.channel)}function uniformAnimationConfig(r,e){if(!r)return r;const i=["custom","customParameters"];return traverseSpec(r=cloneDeep(r,null,i),n=>{var o;return isFunction(n)&&((o=n.prototype)===null||o===void 0?void 0:o.constructor)!==n?(...l)=>n(...l,e):n},i),r}function traverseSpec(r,e,i=[]){if(isArray(r))r.forEach((n,o)=>{r[o]=e(r[o],o),traverseSpec(r[o],e,i)});else if(isObject$1(r))for(const n in r)i.includes(n)||(r[n]=e(r[n],n),traverseSpec(r[n],e,i))}function isAnimationEnabledForSeries(r){var e,i,n,o;const l=r.getSpec();if(l.animation===!1||!isValid(r.getRegion().animate))return!1;let u=(e=l.animationThreshold)!==null&&e!==void 0?e:Number.MAX_SAFE_INTEGER;return(i=r.getMarks())===null||i===void 0||i.forEach(d=>{const f=d.getMarkConfig();f&&(f.large&&f.largeThreshold&&(u=Math.min(u,f.largeThreshold)),f.progressiveThreshold&&(u=Math.min(u,f.progressiveThreshold)))}),!(((o=(n=r.getRawData())===null||n===void 0?void 0:n.latestData)===null||o===void 0?void 0:o.length)>=u)}class BaseSeriesSpecTransformer extends BaseModelSpecTransformer{constructor(){super(...arguments),this.markLabelSpec={}}getLabelSpec(e){return this.markLabelSpec[e]}setLabelSpec(e,i){this.markLabelSpec[e]=array(i)}addLabelSpec(e,i,n=!1){this.markLabelSpec[e]||(this.markLabelSpec[e]=[]),n?this.markLabelSpec[e].unshift(i):this.markLabelSpec[e].push(i)}getTheme(e,i){var n,o,l;const u=getDirectionFromSeriesSpec(e),d=(n=this._option)===null||n===void 0?void 0:n.getTheme(),{markByName:f,mark:g}=d,_=this._option.type,y=Factory$1.getSeriesMarkMap(_)?transformSeriesThemeToMerge(get(d,`series.${_}`),_,g,f):{},b=get(d,`series.${_}_${u}`),S=((l=(o=this.stack)!==null&&o!==void 0?o:b==null?void 0:b.stack)!==null&&l!==void 0?l:y!=null&&y.stack)?get(d,`series.${_}_stack`):void 0;return mergeSpec({},y,b,S)}transformSpec(e,i,n){this._transformStack(e);const o=super.transformSpec(e,i,n);return this._transformLabelSpec(o.spec),Object.assign(Object.assign({},o),{markLabelSpec:this.markLabelSpec,stack:this.stack})}_transformLabelSpec(e){}_transformStack(e){isBoolean(e.stack)&&(this.stack=e.stack),isBoolean(e.percent)&&(this.stack=e.percent||this.stack),isNil(this.stack)&&this._supportStack&&e.seriesField&&(this.stack=!0)}_addMarkLabelSpec(e,i,n="label",o="initLabelMarkStyle",l=!0,u){e&&array(e[n]).forEach(d=>{var f,g,_;if(d&&d.visible){const{animation:y=!0,animationUpdate:b=!0,animationEnter:S=!0,animationExit:v=!0}=d,{animationUpdate:A=!0,animationEnter:x=!0,animationExit:T=!0}=e,C=!!((_=(g=(f=this._option)===null||f===void 0?void 0:f.animation)!==null&&g!==void 0?g:e.animation)!==null&&_!==void 0?_:d.animation)&&!!l;this.addLabelSpec(isFunction(i)?i(d):i,Object.assign(Object.assign({},d),{animation:!!C&&y,animationUpdate:!!(C&&A&&b)&&A,animationEnter:!!(C&&x&&S)&&x,animationExit:!!(C&&x&&v)&&T,getStyleHandler:E=>{var P;return(P=E[o])===null||P===void 0?void 0:P.bind(E)}}),u)}})}_getDefaultSpecFromChart(e){var i;const n=(i=super._getDefaultSpecFromChart(e))!==null&&i!==void 0?i:{},{outerRadius:o,innerRadius:l,direction:u}=e;return isValid(o)&&(n.outerRadius=o),isValid(l)&&(n.innerRadius=l),isValid(u)&&(n.direction=u),Object.keys(n).length>0?n:void 0}_mergeThemeToSpec(e,i){const n=this._theme;if(this._shouldMergeThemeToSpec()){const o=this._getDefaultSpecFromChart(i),l=u=>{const d=mergeSpec({},n,o,u),f=n.label;return f&&isObject$1(f)&&isArray(d.label)&&(d.label=d.label.map(g=>mergeSpec({},f,g))),d};return isArray(e)?{spec:e.map(u=>l(u)),theme:n}:{spec:l(e),theme:n}}return{spec:e,theme:n}}}function getDefaultInteractionConfigByMode(r){return r===RenderModeEnum["desktop-browser"]||r===RenderModeEnum["desktop-miniApp"]?{hover:{enable:!0,trigger:"pointermove",triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"pointertap"}}:isMobileLikeMode(r)||isMiniAppLikeMode(r)?{hover:{enable:!0,trigger:["pointerdown","pointermove"],triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"tap"}}:null}class BaseSeries extends BaseModel{getRegion(){return this._region}getLayoutStartPoint(){return this._region.getLayoutStartPoint()}getRootMark(){return this._rootMark}getSeriesMark(){return this._seriesMark}getRawData(){return this._rawData}getViewDataFilter(){return this._viewDataFilter}getViewData(){var e;return(e=this._data)===null||e===void 0?void 0:e.getDataView()}getViewDataProductId(){var e;return(e=this._data)===null||e===void 0?void 0:e.getProductId()}getViewDataStatistics(){return this._viewDataStatistics}getViewStackData(){return this._viewStackData}getSeriesField(){return this._seriesField}setSeriesField(e){isValid(e)&&(this._seriesField=e)}getGroups(){return this._groups}getStack(){var e;return(e=this.getSpecInfo())===null||e===void 0?void 0:e.stack}getStackValue(){var e;return(e=this._spec.stackValue)!==null&&e!==void 0?e:`${PREFIX}_series_${this.type}`}getPercent(){return this._spec.percent}getStackOffsetSilhouette(){return this._spec.stackOffsetSilhouette}get tooltipHelper(){return this._tooltipHelper||this.initTooltip(),this._tooltipHelper}getInvalidType(){return this._invalidType}setInvalidType(e){var i;this._invalidType=e,(i=this.getViewData())===null||i===void 0||i.reRunAllTransform()}getMarkAttributeContext(){return this._markAttributeContext}constructor(e,i){var n;super(e,i),this.specKey="series",this.type="series",this.layoutType="absolute",this.modelType="series",this.name=void 0,this.transformerConstructor=BaseSeriesSpecTransformer,this.coordinate="none",this._region=null,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:null,height:null},this.getLayoutRect=()=>{var o,l;return{width:(o=this._layoutRect.width)!==null&&o!==void 0?o:this._region.getLayoutRect().width,height:(l=this._layoutRect.height)!==null&&l!==void 0?l:this._region.getLayoutRect().height}},this._rootMark=null,this._seriesMark=null,this._viewDataMap=new Map,this._viewDataFilter=null,this._data=null,this.layoutZIndex=LayoutZIndex.SeriesGroup,this._invalidType="break",this._region=i.region,this._dataSet=i.dataSet,!((n=this._spec)===null||n===void 0)&&n.name&&(this.name=this._spec.name)}created(){super.created(),this._buildMarkAttributeContext(),this.initData(),this.initGroups(),this.initStatisticalData(),this.event.emit(ChartEvent.afterInitData,{model:this}),this.initRootMark(),this.initMark();const e=isAnimationEnabledForSeries(this);this._initExtensionMark({hasAnimation:e}),this.initMarkStyle(),this.initMarkState(),e&&this.initAnimation(),this._option.disableTriggerEvent||this.initInteraction(),this.afterInitMark(),this.initEvent(),this.event.emit(ChartEvent.afterInitEvent,{model:this})}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(e,i)=>{var n;return(n=this._option.globalScale.getScale(e))===null||n===void 0?void 0:n.scale(i)},seriesColor:e=>{var i;return isNil(e)&&(e=this.getSeriesKeys()[0]),(i=this._option.globalScale.getScale("color"))===null||i===void 0?void 0:i.scale(e)},getRegion:()=>this._region}}setAttrFromSpec(){super.setAttrFromSpec(),this.setSeriesField(this._spec.seriesField),isValid(this._spec.invalidType)&&(this._invalidType=this._spec.invalidType)}getInvalidCheckFields(){return[this.getStackValueField()]}initInvalidDataTransform(){var e,i;this._invalidType==="zero"&&(!((e=this._rawData)===null||e===void 0)&&e.dataSet)&&(registerDataSetInstanceTransform(this._rawData.dataSet,"invalidTravel",invalidTravel),(i=this._rawData)===null||i===void 0||i.transform({type:"invalidTravel",options:{config:()=>({invalidType:this._invalidType,checkField:this.getInvalidCheckFields()})}},!1))}initData(){var e,i,n;const o=(e=this._spec.data)!==null&&e!==void 0?e:this._option.getSeriesData(this._spec.dataId,this._spec.dataIndex);if(o&&(this._rawData=dataToDataView(o,this._dataSet,this._option.sourceDataList)),(n=(i=this._rawData)===null||i===void 0?void 0:i.target)===null||n===void 0||n.addListener("change",this.rawDataUpdate.bind(this)),this._addDataIndexAndKey(),this._rawData){this.getStack()&&(this._viewDataFilter=dataViewFromDataView(this._rawData,this._dataSet,{name:`${this.type}_${this.id}_viewDataFilter`}));const l=dataViewFromDataView(this.getStack()?this._viewDataFilter:this._rawData,this._dataSet,{name:`${this.type}_${this.id}_viewData`});this._data=new SeriesData(this._option,l),this.getStack()&&this._viewDataFilter.target.removeListener("change",l.reRunAllTransform)}this.initInvalidDataTransform()}initGroups(){const e=this.getGroupFields();e&&e.length&&(this._groups={fields:e})}initStatisticalData(){this._data&&this._statisticViewData()}getRawDataStatisticsByField(e,i){var n,o,l;if(this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[e]||i&&(isNil(this._rawStatisticsCache[e].min)||isNil(this._rawStatisticsCache[e].max))||!i&&isNil(this._rawStatisticsCache[e].values)){if(this._viewDataStatistics&&(!this._viewDataFilter||this._viewDataFilter.transformsArr.length<=1)&&this.getViewData().transformsArr.length<=1&&(!((n=this._viewDataStatistics.latestData)===null||n===void 0)&&n[e]))this._rawStatisticsCache[e]=this._viewDataStatistics.latestData[e];else if(this._rawData){const u=(o=this._rawData.getFields())===null||o===void 0?void 0:o[e];if(u&&u.lockStatisticsByDomain&&u.domain)this._rawStatisticsCache[e]={},i?(this._rawStatisticsCache[e].min=minInArray(u.domain),this._rawStatisticsCache[e].max=maxInArray(u.domain)):this._rawStatisticsCache[e].values=u.domain;else{const d=dimensionStatisticsOfSimpleData(this._rawData.latestData,[{key:e,operations:i?["min","max"]:["values"]}])[e];this._rawStatisticsCache[e]=merge$1((l=this._rawStatisticsCache[e])!==null&&l!==void 0?l:{},d)}}}return this._rawStatisticsCache[e]}_statisticViewData(){registerDataSetInstanceTransform(this._dataSet,"dimensionStatistics",dimensionStatistics);const e=`${this.type}_${this.id}_viewDataStatic`;this._viewDataStatistics=new DataView(this._dataSet,{name:e}),this._viewDataStatistics.parse([this._data.getDataView()],{type:"dataview"}),this._viewDataStatistics.transform({type:"dimensionStatistics",options:{fields:()=>{const i=this.getStatisticFields();return this._seriesField&&mergeFields(i,[{key:this._seriesField,operations:["values"]}]),i},target:"latest"}},!1),this._data.getDataView().target.removeListener("change",this._viewDataStatistics.reRunAllTransform),this.getStack()&&this.createdStackData()}createStatisticalData(e,i,n){registerDataSetInstanceTransform(this._dataSet,"dimensionStatistics",dimensionStatistics);const o=new DataView(this._dataSet,{name:e});return o.parse([i],{type:"dataview"}),o.transform({type:"dimensionStatistics",options:{operations:["max","min","values"],fields:()=>{var l;const u=mergeFields(this.getStatisticFields(),(l=n==null?void 0:n(i.name))!==null&&l!==void 0?l:[]);return this._seriesField&&mergeFields(u,[{key:this._seriesField,operations:["values"]}]),u},target:"latest"}},!1),o}createdStackData(){const e=`${this.type}_${this.id}_viewStackData`;this._viewStackData=new DataView(this._dataSet,{name:e}),this._viewStackData.parse([this._viewDataFilter],{type:"dataview"}),this._viewStackData.transform({type:"stackSplit",options:{fields:this.getStackGroupFields()}},!1)}_noAnimationDataKey(e,i){return i}generateDefaultDataKey(e){var i;return isNil(e)?(n,o,l)=>{if(this._spec.animation===!1){const f=this._noAnimationDataKey(n,o);if(f!==void 0)return f}const{keyMap:u}=l,d=this._getSeriesDataKey(n);return u.get(d)===void 0?(u.set(d,0),d):(u.set(d,u.get(d)+1),`${d}_${u.get(d)}`)}:isString(e)?n=>n[e]:isArray(e)&&e.every(n=>isString(n))?n=>e.map(o=>n[o]).join("-"):isFunction(e)?(n,o)=>e(n,o):((i=this._option)===null||i===void 0||i.onError(`invalid dataKey: ${e}`),(n,o)=>{})}_addDataIndexAndKey(){var e;!((e=this._rawData)===null||e===void 0)&&e.dataSet&&(registerDataSetInstanceTransform(this._rawData.dataSet,"addVChartProperty",addVChartProperty),this._rawData.transform({type:"addVChartProperty",options:{beforeCall:initKeyMap.bind(this),call:addDataKey}},!1))}updateRawData(e){this._rawData&&this._rawData.updateRawData(e)}rawDataUpdate(e){var i;(i=this._rawDataStatistics)===null||i===void 0||i.reRunAllTransform(),this._rawStatisticsCache=null,this.event.emit(ChartEvent.rawDataUpdate,{model:this})}viewDataFilterOver(e){this.event.emit(ChartEvent.viewDataFilterOver,{model:this})}viewDataUpdate(e){var i;this.event.emit(ChartEvent.viewDataUpdate,{model:this}),(i=this._data)===null||i===void 0||i.updateData(),this._viewDataStatistics&&this._viewDataStatistics.reRunAllTransform()}viewDataStatisticsUpdate(e){this.event.emit(ChartEvent.viewDataStatisticsUpdate,{model:this})}getDatumPositionValue(e,i){return!e||isNil(i)?null:e[i]}getDatumPositionValues(e,i){return!e||isNil(i)?[]:isString(i)?[e[i]]:i.map(n=>e[n])}setValueFieldToStack(){}setValueFieldToPercent(){}setValueFieldToStackOffsetSilhouette(){}initRootMark(){var e,i,n;this._rootMark=this._createMark({type:"group",name:`seriesGroup_${this.type}_${this.id}`},{parent:(i=(e=this._region).getGroupMark)===null||i===void 0?void 0:i.call(e),dataView:!1}),this._rootMark.setMarkConfig({zIndex:(n=this._spec.zIndex)!==null&&n!==void 0?n:this.layoutZIndex})}_getExtensionMarkNamePrefix(){return`${this.type}_${this.id}_extensionMark`}_initExtensionMark(e){var i;if(!this._spec.extensionMark)return;const n=this.getMarksWithoutRoot();e.depend=n,(i=this._spec.extensionMark)===null||i===void 0||i.forEach((o,l)=>{this._createExtensionMark(o,null,this._getExtensionMarkNamePrefix(),l,e)})}_createExtensionMark(e,i,n,o,l){var u;const d=this._createMark({type:e.type,name:isValid(e.name)?`${e.name}`:`${n}_${o}`},{skipBeforeLayouted:!0,markSpec:e,parent:i,dataView:!1,componentType:e.componentType,depend:l.depend,key:e.dataKey},{setCustomizedShape:e==null?void 0:e.customShape});if(d){if(isValid(e.id)&&d.setUserId(e.id),l.hasAnimation){const f=animationConfig({},userAnimationConfig(e.type,e,this._markAttributeContext));d.setAnimationConfig(f)}if(e.type==="group")n=`${n}_${o}`,(u=e.children)===null||u===void 0||u.forEach((f,g)=>{this._createExtensionMark(f,d,n,g,l)});else if(!(i||isNil(e.dataId)&&isNil(e.dataIndex))){const f=this._option.getSeriesData(e.dataId,e.dataIndex);f===this._rawData?d.setDataView(this.getViewData(),this.getViewDataProductId()):(d.setDataView(f),f.target.addListener("change",()=>{d.getData().updateData()}))}}}_updateExtensionMarkSpec(){var e;(e=this._spec.extensionMark)===null||e===void 0||e.forEach((i,n)=>{const o=this._marks.getMarkWithInfo({name:isValid(i.name)?`${i.name}`:`${this._getExtensionMarkNamePrefix()}_${n}`});o&&(this.initMarkStyleWithSpec(o,i),o.updateStaticEncode(),o.updateLayoutState())})}getStackData(){var e;return(e=this._viewStackData)===null||e===void 0?void 0:e.latestData}_parseSelectorOfInteraction(e,i){if(!i||!i.length)return[];const n=[];return e.markIds?i.filter(o=>{e.markIds.includes(o.getProductId())&&n.push(`#${o.getProductId()}`)}):e.markNames?i.forEach(o=>{e.markNames.includes(o.name)&&n.push(`#${o.getProductId()}`)}):i.forEach(o=>{n.push(`#${o.getProductId()}`)}),n}_parseDefaultInteractionConfig(e){if(!(e!=null&&e.length))return[];const i=getDefaultInteractionConfigByMode(this._option.mode);let n=Object.assign({},i==null?void 0:i.hover),o=Object.assign({},i==null?void 0:i.select);const l=this._spec.hover;isBoolean(l)?n.enable=l:isObject$1(l)&&(n.enable=!0,n=mergeSpec(n,l));const u=this._spec.select;isBoolean(u)?o.enable=u:isObject$1(u)&&(o.enable=!0,o=mergeSpec(o,u));const d=[];if(n.enable){const f=this._parseSelectorOfInteraction(n,e);f.length&&d.push(this._defaultHoverConfig(f,n))}if(o.enable){const f=this._parseSelectorOfInteraction(o,e);f.length&&d.push(this._defaultSelectConfig(f,o))}return d}_defaultHoverConfig(e,i){return{seriesId:this.id,regionId:this._region.id,selector:e,type:"element-highlight",trigger:i.trigger,triggerOff:i.triggerOff,blurState:STATE_VALUE_ENUM.STATE_HOVER_REVERSE,highlightState:STATE_VALUE_ENUM.STATE_HOVER}}_defaultSelectConfig(e,i){const n=i.mode==="multiple",o=isValid(i.triggerOff)?i.triggerOff:n?["empty"]:["empty",i.trigger];return{type:"element-select",seriesId:this.id,regionId:this._region.id,selector:e,trigger:i.trigger,triggerOff:o,reverseState:STATE_VALUE_ENUM.STATE_SELECTED_REVERSE,state:STATE_VALUE_ENUM.STATE_SELECTED,isMultiple:n}}_parseInteractionConfig(e){const i=this.getCompiler();if(!i)return;const{interactions:n}=this._spec,o=this._parseDefaultInteractionConfig(e);o&&o.length&&o.forEach(l=>{i.addInteraction(l)}),n&&n.length&&n.forEach(l=>{const u=this._parseSelectorOfInteraction(l,this.getMarks());u.length&&i.addInteraction(Object.assign(Object.assign({},l),{selector:u,seriesId:this.id,regionId:this._region.id}))})}initInteraction(){const e=this.getMarksWithoutRoot();this._parseInteractionConfig(e)}initAnimation(){}initMarkState(){this.initSeriesStyleState()}initSeriesStyleState(){var e;const i=this._spec.seriesStyle;if(!i||!i.length)return;const n=(e=this._seriesField)!==null&&e!==void 0?e:DEFAULT_DATA_SERIES_FIELD;this.getMarksWithoutRoot().forEach(o=>{const l={},u={},d={};i.forEach(g=>{var _;const y=(_=g[o.name])===null||_===void 0?void 0:_.style;y&&(l[g.name]=!0,d[g.name]=d[g.name]||{},Object.keys(y).forEach(b=>{u[b]=!0,d[g.name][b]=y[b]}))}),o.state.addStateInfo({stateValue:DEFAULT_SERIES_STYLE_NAME,level:-1,filter:g=>Array.isArray(g)?g.length!==0&&l[g[0][n]]===!0:l[g[n]]===!0});const f={};Object.keys(u).forEach(g=>{f[g]=_=>{var y,b;let S;if(Array.isArray(_)){if(_.length===0)return;S=(y=d[_[0][n]])===null||y===void 0?void 0:y[g]}return S=(b=d[_[n]])===null||b===void 0?void 0:b[g],isValid(S)?S:o.getAttribute(g,_)}}),this.setMarkStyle(o,f,DEFAULT_SERIES_STYLE_NAME,AttributeLevel.User_SeriesStyle)})}afterInitMark(){this.event.emit(ChartEvent.afterInitMark,{model:this}),this.setSeriesField(this._spec.seriesField),this.getMarks().forEach(e=>{var i,n;!((n=(i=e.stateStyle)===null||i===void 0?void 0:i.normal)===null||n===void 0)&&n.lineWidth&&e.setAttribute("stroke",this.getColorAttribute(),"normal",AttributeLevel.Base_Series)})}getMarksWithoutRoot(){return this.getMarks().filter(e=>{var i;return!(!((i=e.name)===null||i===void 0)&&i.includes("seriesGroup"))})}getMarksInType(e){return this._marks.getMarksInType(e)}getMarkInName(e){return this._marks.get(e)}getMarkInId(e){return this.getMarks().find(i=>i.id===e)}initEvent(){var e,i,n;(i=(e=this._data)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.target.addListener("change",this.viewDataUpdate.bind(this)),(n=this._viewDataStatistics)===null||n===void 0||n.target.addListener("change",this.viewDataStatisticsUpdate.bind(this))}_releaseEvent(){super._releaseEvent(),this.getCompiler().removeInteraction(this.id)}initTooltip(){this._tooltipHelper=new BaseSeriesTooltipHelper(this)}_compareExtensionMarksSpec(e,i,n){e.length!==i.length||i.some((o,l)=>o.type!==e[l].type||o.id!==e[l].id||o.name!==e[l].name)?n.reMake=!0:i.some((o,l)=>o.visible!==e[l].visible)&&(n.reCompile=!0)}_compareLabelSpec(e,i,n){e.length!==i.length||i.some((o,l)=>o.labelLayout!==e[l].labelLayout||o.visible!==e[l].visible)?n.reMake=!0:!n.reCompile&&i.some((o,l)=>!isEqual(o,e[l]))&&(n.reCompile=!0)}_compareSpec(e,i,n){const o=super._compareSpec(e,i),l=Object.keys(i||{}).sort(),u=Object.keys(e||{}).sort();if(!isEqual(l,u))return o.reMake=!0,o;const d=Object.assign(Object.assign(Object.assign(Object.assign({},defaultSeriesIgnoreCheckKeys),defaultSeriesCompileCheckKeys),n),{extensionMark:!0,label:!0,totalLabel:!0});return this._compareExtensionMarksSpec(array(e.extensionMark),array(i.extensionMark),o),!o.reMake&&this._compareLabelSpec(array(e.label),array(i.label),o),!o.reMake&&this._compareLabelSpec(array(e.totalLabel),array(i.totalLabel),o),o.reMake?o:(!o.reCompile&&this._marks.getMarks().some(f=>{var g,_;return d[f.name]=!0,((g=i[f.name])===null||g===void 0?void 0:g.visible)!==((_=e[f.name])===null||_===void 0?void 0:_.visible)})&&(o.reCompile=!0),!o.reCompile&&l.some(f=>defaultSeriesCompileCheckKeys[f]&&!isEqual(e[f],i[f]))&&(o.reCompile=!0),l.some(f=>!d[f]&&!isEqual(e[f],i[f]))&&(o.reMake=!0),o)}_updateSpecData(){!this._rawData||!this._spec.data||this._spec.data instanceof DataView||updateDataViewInData(this._rawData,this._spec.data,!0)}reInit(e){super.reInit(e);const i=this.getMarksWithoutRoot();i.forEach(n=>{this._spec[n.name]&&this.initMarkStyleWithSpec(n,this._spec[n.name])}),this.initMarkStyle(),i.forEach(n=>{n.updateStaticEncode(),n.updateLayoutState(!0)}),this._updateExtensionMarkSpec(),this._updateSpecData(),this._tooltipHelper&&this._tooltipHelper.updateTooltipSpec(),isAnimationEnabledForSeries(this)&&this.initAnimation()}onEvaluateEnd(e){this._data.updateData()}onRender(e){}release(){var e,i,n;super.release(),this._viewDataMap.clear();const o=(i=(e=this._rawData)===null||e===void 0?void 0:e.transformsArr)===null||i===void 0?void 0:i.findIndex(l=>l.type==="addVChartProperty");o>=0&&this._rawData.transformsArr.splice(o,1),(n=this._data)===null||n===void 0||n.release(),this._dataSet=this._data=this._rawData=this._rawDataStatistics=this._spec=this._region=this._viewDataStatistics=this._viewStackData=null}setLayoutStartPosition(e){isValidNumber(e.x)&&(this._layoutStartPoint.x=e.x),isValidNumber(e.y)&&(this._layoutStartPoint.y=e.y)}setLayoutRect({width:e,height:i},n){isValidNumber(e)&&(this._layoutRect.width=e),isValidNumber(i)&&(this._layoutRect.height=i)}getSeriesKeys(){var e,i;return this._seriesField?(i=(e=this.getRawDataStatisticsByField(this._seriesField))===null||e===void 0?void 0:e.values)!==null&&i!==void 0?i:[]:this.name?[this.name]:this.userId?[`${this.userId}`]:[`${this.type}_${this.id}`]}getSeriesStyle(e){return i=>{var n,o;return(o=(n=this._seriesMark)===null||n===void 0?void 0:n.getAttribute(i,e))!==null&&o!==void 0?o:void 0}}_getSeriesInfo(e,i){const n=this.getDefaultShapeType();return i.map(o=>({key:o,originalKey:o,style:this.getSeriesStyle({[e]:o}),shapeType:n}))}getSeriesInfoInField(e){var i,n;return this._getSeriesInfo(e,(n=(i=this.getRawDataStatisticsByField(e))===null||i===void 0?void 0:i.values)!==null&&n!==void 0?n:[])}getSeriesInfoList(){var e;return this._getSeriesInfo((e=this._seriesField)!==null&&e!==void 0?e:DEFAULT_DATA_SERIES_FIELD,this.getSeriesKeys())}_getDefaultColorScale(){var e,i;const n=this.getDefaultColorDomain(),o=this._getDataScheme();return(i=(e=new ColorOrdinalScale().domain(n)).range)===null||i===void 0?void 0:i.call(e,o)}_getDataScheme(){return getDataScheme(this.getColorScheme(),this.type)}getDefaultColorDomain(){var e,i;return this._seriesField?(i=(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesField])===null||i===void 0?void 0:i.values:[]}getColorAttribute(){var e,i;return{scale:(e=this._option.globalScale.getScale("color"))!==null&&e!==void 0?e:this._getDefaultColorScale(),field:(i=this._seriesField)!==null&&i!==void 0?i:DEFAULT_DATA_SERIES_FIELD}}getDimensionField(){return[]}getMeasureField(){return[]}onMarkPositionUpdate(){this.onMarkTreePositionUpdate(this.getMarksWithoutRoot())}onMarkTreePositionUpdate(e){}_createMark(e,i={},n={}){var o,l,u,d,f,g;const{key:_,groupKey:y,skipBeforeLayouted:b,themeSpec:S={},markSpec:v,dataView:A,dataProductId:x,parent:T,isSeriesMark:C,depend:E,stateSort:P,noSeparateStyle:L=!1}=i,R=super._createMark(e,{key:_??this._getDataIdKey(),seriesId:this.id,attributeContext:this._markAttributeContext,componentType:i.componentType,noSeparateStyle:L});if(isValid(R)){const w=this.getSpec()||{};this._marks.addMark(R,{name:e.name}),C&&(this._seriesMark=R),isNil(T)?(o=this._rootMark)===null||o===void 0||o.addMark(R):T!==!1&&T.addMark(R),isNil(A)?(R.setDataView(this.getViewData(),this.getViewDataProductId()),R.setSkipBeforeLayouted(!0)):A!==!1&&R.setDataView(A,x),isBoolean(b)&&R.setSkipBeforeLayouted(b),isValid(E)&&R.setDepend(...array(E)),isNil(y)||R.setGroupKey(y),P&&R.setStateSortCallback(P);const D=Object.assign(Object.assign({},n),{morph:(l=n.morph)!==null&&l!==void 0&&l,support3d:is3DMark(e.type)||((u=n.support3d)!==null&&u!==void 0?u:w.support3d||!!w.zField),morphKey:((d=w.morph)===null||d===void 0?void 0:d.morphKey)||`${this.getSpecIndex()}_${this.getMarks().length}`,morphElementKey:(g=(f=w.morph)===null||f===void 0?void 0:f.morphElementKey)!==null&&g!==void 0?g:n.morphElementKey});R.setMarkConfig(D),this.initMarkStyleWithSpec(R,mergeSpec({},S,v||w[R.name]))}return R}_getDataIdKey(){var e;return(e=super._getDataIdKey())!==null&&e!==void 0?e:DEFAULT_DATA_KEY}_getSeriesDataKey(e){let i="";if(!e)return i;const n=this.getDimensionField();i=n.map(l=>e[l]).join("_");const o=this.getSeriesField();return o&&!n.includes(o)&&(i+=`_${e[o]}`),i}addViewDataFilter(e){var i,n;(n=(i=this._viewDataFilter)!==null&&i!==void 0?i:this.getViewData())===null||n===void 0||n.transform(e,!1)}reFilterViewData(){var e,i;(i=(e=this._viewDataFilter)!==null&&e!==void 0?e:this.getViewData())===null||i===void 0||i.reRunAllTransform()}reTransformViewData(){var e,i;(i=(e=this._data)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform()}fillData(){var e;(e=this.getRawData())===null||e===void 0||e.reRunAllTransform()}compile(){this.compileData()}getDefaultShapeType(){return"circle"}getFieldAlias(e){var i;return e!==STACK_FIELD_END&&e!==STACK_FIELD_END_PERCENT&&e!==STACK_FIELD_START&&e!==STACK_FIELD_START_PERCENT||(e=this.getStackValueField()),(i=getFieldAlias(this.getRawData(),e))!==null&&i!==void 0?i:e}_getInvalidConnectType(){return this._invalidType==="zero"?"zero":this._invalidType==="link"?"connect":"none"}_getInvalidDefined(e){const i=this.getInvalidCheckFields();return!i.length||i.every(n=>couldBeValidNumber(e[n]))}_getRelatedComponentSpecInfo(e){var i;const n=this.getSpecIndex(),o=(i=this._option.getSpecInfo().component[e])===null||i===void 0?void 0:i.filter(l=>l.seriesIndexes.includes(n));return o??[]}_forEachStackGroup(e,i){var n,o;(i=i??((n=this._viewStackData)===null||n===void 0?void 0:n.latestData))&&(!((o=i.values)===null||o===void 0)&&o.length?e(i):i.nodes&&Object.values(i.nodes).forEach(l=>{this._forEachStackGroup(e,l)}))}isDatumInViewData(e){if(!e)return!1;const i=this.getViewData().latestData;return!!i&&(!!i.includes(e)||i.some(n=>Object.keys(e).every(o=>e[o]===n[o])))}getSeriesFieldValue(e,i){var n;return e[(n=i??this.getSeriesField())!==null&&n!==void 0?n:DEFAULT_DATA_SERIES_FIELD]}}BaseSeries.mark=baseSeriesMark,BaseSeries.transformerConstructor=BaseSeriesSpecTransformer;function isPolarAxisSeries(r){return[SeriesTypeEnum.rose,SeriesTypeEnum.radar,SeriesTypeEnum.circularProgress].includes(r)}function sortDataInAxisHelper(r,e,i){const n=r.getScale(0),o="isInverse"in r&&r.isInverse();isContinuous(n.type)?i.sort((l,u)=>(l[e]-u[e])*(o?-1:1)):i.sort((l,u)=>(n.index(l[e])-n.index(u[e]))*(o?-1:1))}function getGroupAnimationParams(r){return{dataIndex:e=>{var i,n;const o=r.direction==="horizontal"?r.fieldY[0]:r.fieldX[0],l=e==null?void 0:e[o],u=r.direction==="horizontal"?r.scaleY:r.scaleX;return((n=(i=u==null?void 0:u.domain)===null||i===void 0?void 0:i.call(u))!==null&&n!==void 0?n:[]).indexOf(l)||0},dataCount:()=>{var e,i,n;const o=r.direction==="horizontal"?r.scaleY:r.scaleX;return(n=((i=(e=o==null?void 0:o.domain)===null||e===void 0?void 0:e.call(o))!==null&&i!==void 0?i:[]).length)!==null&&n!==void 0?n:0}}}class CartesianSeries extends BaseSeries{constructor(){super(...arguments),this.coordinate="cartesian",this._bandPosition=.5,this._scaleConfig={bandPosition:this._bandPosition},this._direction="vertical",this._sortDataByAxis=!1,this._getPositionXEncoder=()=>{var e;return(e=this._positionXEncoder)===null||e===void 0?void 0:e.bind(this)},this._setPositionXEncoder=e=>{this._positionXEncoder=e.bind(this)},this._getPositionYEncoder=()=>{var e;return(e=this._positionYEncoder)===null||e===void 0?void 0:e.bind(this)},this._setPositionYEncoder=e=>{this._positionYEncoder=e.bind(this)}}_buildScaleConfig(){this._scaleConfig={bandPosition:this._bandPosition}}get fieldX(){return this._fieldX}setFieldX(e){this._fieldX=array(e)}get fieldY(){return this._fieldY}setFieldY(e){this._fieldY=array(e)}get fieldZ(){return this._fieldZ}setFieldZ(e){this._fieldZ=e&&array(e)}get fieldX2(){return this._fieldX2}setFieldX2(e){this._fieldX2=e}get fieldY2(){return this._fieldY2}setFieldY2(e){this._fieldY2=e}get direction(){return this._direction}get scaleX(){return this._scaleX}setScaleX(e){this._scaleX=e}get scaleY(){return this._scaleY}setScaleY(e){this._scaleY=e}get scaleZ(){return this._scaleZ}setScaleZ(e){this._scaleZ=e}getXAxisHelper(){return this._xAxisHelper}setXAxisHelper(e){this._xAxisHelper=e,this.onXAxisHelperUpdate()}getYAxisHelper(){return this._yAxisHelper}setYAxisHelper(e){this._yAxisHelper=e,this.onYAxisHelperUpdate()}getZAxisHelper(){return this._zAxisHelper}setZAxisHelper(e){this._zAxisHelper=e,this.onYAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}getStatisticFields(){const e=[];return[{axisHelper:this.getXAxisHelper(),fields:this._fieldX2?[...this._fieldX,this._fieldX2]:this._fieldX},{axisHelper:this.getYAxisHelper(),fields:this._fieldY2?[...this._fieldY,this._fieldY2]:this._fieldY},{axisHelper:this.getZAxisHelper(),fields:this._fieldZ}].forEach(i=>{i.axisHelper&&i.axisHelper.getScale&&i.fields&&i.fields.forEach(n=>{const o={key:n,operations:[]},l=i.axisHelper.getScale(0);isContinuous(l.type)?(o.operations=["max","min"],l.type==="log"&&(o.filter=u=>u>0)):o.operations=["values"],e.push(o)})}),this.getStack()&&e.push({key:this.getStackValueField(),operations:["allValid"]}),e}getGroupFields(){return this.direction==="vertical"?this._fieldX:this._fieldY}getStackGroupFields(){return this.getGroupFields()}getStackValue(){var e,i;const n=(e=this.direction==="horizontal"?this.getXAxisHelper():this.getYAxisHelper())===null||e===void 0?void 0:e.getAxisId();return(i=this._spec.stackValue)!==null&&i!==void 0?i:`${PREFIX}_series_${this.type}_${n}`}getStackValueField(){return this.direction==="horizontal"?array(this._spec.xField)[0]:array(this._spec.yField)[0]}setValueFieldToStack(){this.direction==="horizontal"?(this.setFieldX(STACK_FIELD_END),this.setFieldX2(STACK_FIELD_START)):(this.setFieldY(STACK_FIELD_END),this.setFieldY2(STACK_FIELD_START))}setValueFieldToPercent(){this.direction==="horizontal"?(this.setFieldX(STACK_FIELD_END_PERCENT),this.setFieldX2(STACK_FIELD_START_PERCENT)):(this.setFieldY(STACK_FIELD_END_PERCENT),this.setFieldY2(STACK_FIELD_START_PERCENT))}setValueFieldToStackOffsetSilhouette(){this.direction==="horizontal"?(this.setFieldX(STACK_FIELD_END_OffsetSilhouette),this.setFieldX2(STACK_FIELD_START_OffsetSilhouette)):(this.setFieldY(STACK_FIELD_END_OffsetSilhouette),this.setFieldY2(STACK_FIELD_START_OffsetSilhouette))}onXAxisHelperUpdate(){this.onMarkPositionUpdate()}onYAxisHelperUpdate(){this.onMarkPositionUpdate()}onZAxisHelperUpdate(){this.onMarkPositionUpdate()}setAttrFromSpec(){var e,i;super.setAttrFromSpec(),this.setFieldX(this._spec.xField),this.setFieldY(this._spec.yField),this.setFieldZ(this._spec.zField),this._specXField=array(this._spec.xField),this._specYField=array(this._spec.yField),isValid(this._spec.direction)&&(this._direction=this._spec.direction),this.setFieldX2((e=this._spec)===null||e===void 0?void 0:e.x2Field),this.setFieldY2((i=this._spec)===null||i===void 0?void 0:i.y2Field),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent(),this.getStackOffsetSilhouette()&&this.setValueFieldToStackOffsetSilhouette(),isValid(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}dataToPosition(e,i){return e?i&&!this.isDatumInViewData(e)?null:{x:this.dataToPositionX(e),y:this.dataToPositionY(e)}:null}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToX=this.valueToPositionX.bind(this),this._markAttributeContext.valueToY=this.valueToPositionY.bind(this),this._markAttributeContext.xBandwidth=(e=0)=>{var i,n,o;return(o=(n=(i=this.getXAxisHelper()).getBandwidth)===null||n===void 0?void 0:n.call(i,e))!==null&&o!==void 0?o:0},this._markAttributeContext.yBandwidth=(e=0)=>{var i,n,o;return(o=(n=(i=this.getYAxisHelper()).getBandwidth)===null||n===void 0?void 0:n.call(i,e))!==null&&o!==void 0?o:0},this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this)}valueToPosition(e,i){return{x:this.valueToPositionX(e),y:this.valueToPositionY(i)}}_axisPosition(e,i,n){return this._scaleConfig.datum=n,e.isContinuous?e.valueToPosition(i,this._scaleConfig):e.dataToPosition(array(i),this._scaleConfig)}valueToPositionX(e,i){return this._axisPosition(this._xAxisHelper,e,i)}valueToPositionY(e,i){return this._axisPosition(this._yAxisHelper,e,i)}_dataToPosition(e,i,n,o,l,u){const d=l();if(d)return d(e);if(!i)return u(g=>Number.NaN),Number.NaN;const f=(i.getFields?i.getFields():n).slice(0,o);return f&&f.length!==0?(i.isContinuous?u(g=>(this._scaleConfig.datum=g,i.valueToPosition(this.getDatumPositionValue(g,f[0]),this._scaleConfig))):u(g=>(this._scaleConfig.datum=g,i.dataToPosition(array(this.getDatumPositionValues(g,f)),this._scaleConfig))),l()(e)):(u(g=>null),null)}dataToPositionX(e){return this._dataToPosition(e,this._xAxisHelper,this.fieldX,void 0,this._getPositionXEncoder,this._setPositionXEncoder)}dataToPositionY(e){return this._dataToPosition(e,this._yAxisHelper,this.fieldY,void 0,this._getPositionYEncoder,this._setPositionYEncoder)}dataToPositionZ(e){if(!this._zAxisHelper)return Number.NaN;const{dataToPosition:i}=this._zAxisHelper;return i(this.getDatumPositionValues(e,this._fieldZ),{bandPosition:this._bandPosition})}dataToPositionX1(e){return this._xAxisHelper?this._fieldX2&&this._fieldX2 in e?this.valueToPositionX(this.getDatumPositionValues(e,this._fieldX2)):this.valueToPositionX(0):Number.NaN}dataToPositionY1(e){return this._yAxisHelper?this._fieldY2&&this._fieldY2 in e?this.valueToPositionY(this.getDatumPositionValues(e,this._fieldY2)):this.valueToPositionY(0):Number.NaN}positionToData(e){return e?{x:this.positionToDataX(e.x),y:this.positionToDataY(e.y)}:null}positionToDataX(e){return this._scaleX?this._scaleX.invert(e):null}positionToDataY(e){return this._scaleY?this._scaleY.invert(e):null}getRegionRectLeft(){if(!this._xAxisHelper)return Number.NaN;const{getScale:e}=this._xAxisHelper;return e(0).range()[0]}getRegionRectRight(){if(!this._xAxisHelper)return Number.NaN;const{getScale:e}=this._xAxisHelper;return e(0).range()[1]}afterInitMark(){super.afterInitMark(),this.setFieldX(this._fieldX),this.setFieldY(this._fieldY),this._buildScaleConfig()}getDimensionField(){return this._direction==="horizontal"?this._specYField:this._specXField}getDimensionContinuousField(){return this._direction==="horizontal"?[this.fieldY[0],this.fieldY2]:[this.fieldX[0],this.fieldX2]}getMeasureField(){return this._direction==="horizontal"?this._specXField:this._specYField}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(ChartEvent.scaleDomainUpdate,{filter:e=>{var i;return e.model.id===((i=this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper)===null||i===void 0?void 0:i.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var e,i,n;!((i=(e=this.getViewData())===null||e===void 0?void 0:e.latestData)===null||i===void 0)&&i.length&&(sortDataInAxisHelper(this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper,this._direction==="horizontal"?this._fieldY[0]:this._fieldX[0],this.getViewData().latestData),(n=this._data)===null||n===void 0||n.updateData(!0))}getInvalidCheckFields(){const e=[];return this._xAxisHelper&&this._xAxisHelper.isContinuous&&this._xAxisHelper.getAxisType()!==ComponentTypeEnum.geoCoordinate&&(this._xAxisHelper.getFields?this._xAxisHelper.getFields():this._specXField).forEach(i=>{e.push(i)}),this._yAxisHelper&&this._yAxisHelper.isContinuous&&this._yAxisHelper.getAxisType()!==ComponentTypeEnum.geoCoordinate&&(this._yAxisHelper.getFields?this._yAxisHelper.getFields():this._specYField).forEach(i=>{e.push(i)}),e}reInit(e){this._positionXEncoder&&(this._positionXEncoder=null),this._positionYEncoder&&(this._positionYEncoder=null),super.reInit(e)}}const DEFAULT_SMOOTH_INTERPOLATE="monotone",DEFAULT_LINEAR_INTERPOLATE="linear",DEFAULT_CLOSE_STROKE_JOIN="bevel",lineLikeSeriesMark={point:{name:"point",type:"symbol"},line:{name:"line",type:"line"}};class LineLikeSeriesMixin{addSamplingCompile(){if(this._spec.sampling){const{width:e,height:i}=this._region.getLayoutRect(),n=[],o=this._fieldY,l=this._fieldX;n.push({type:"sampling",size:this._direction==="horizontal"?i:e,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?l[0]:o[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(n)}}addOverlapCompile(){var e;if(this._spec.markOverlap){const i=[];i.push({type:"markoverlap",direction:this._direction==="horizontal"&&this.coordinate==="cartesian"?2:1,delta:this._spec.pointDis,deltaMul:this._spec.pointDisMul,groupBy:this._seriesField}),(e=this._symbolMark)===null||e===void 0||e.getProduct().transform(i)}}reCompileSampling(){this._spec.sampling&&this.compile()}initLineMark(e,i){var n,o;return this._lineMark=this._createMark(lineLikeSeriesMark.line,{groupKey:this._seriesField,isSeriesMark:i==null||i,stateSort:(n=this._spec.line)===null||n===void 0?void 0:n.stateSort},Object.assign(Object.assign({},e),{setCustomizedShape:(o=this._spec.line)===null||o===void 0?void 0:o.customShape,morphElementKey:this.getDimensionField()[0]})),this._lineMark}initLineMarkStyle(e,i){var n,o;const l=this._lineMark;if(l){if(this.setMarkStyle(l,{stroke:this.getColorAttribute()},"normal",AttributeLevel.Series),this._invalidType!=="zero"&&this.setMarkStyle(l,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",AttributeLevel.Series),this.event.on(ChartEvent.viewDataStatisticsUpdate,{filter:u=>u.model===this},()=>{this.encodeDefined(l,"defined")}),this.coordinate==="polar")this.setMarkStyle(l,{lineJoin:DEFAULT_CLOSE_STROKE_JOIN,curveType:DEFAULT_LINEAR_INTERPOLATE,closePath:!0},"normal",AttributeLevel.Series);else{const u=i??((o=(n=this.getSpec().line)===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.curveType),d=u===DEFAULT_SMOOTH_INTERPOLATE?e==="horizontal"?"monotoneY":"monotoneX":u;this.setMarkStyle(l,{curveType:d},"normal",AttributeLevel.Built_In)}this.setMarkStyle(l,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",AttributeLevel.Series)}return l}_getEventElement(e,i=!1){let n=[];return e.dimensionInfo.some(o=>(o.data.some(l=>l.series===this&&(n=l.datum,!0)),!n.length)),n}_dimensionTrigger(e){const i=this._getEventElement(e);switch(e.action){case"enter":this._symbolActiveMark.getDataView().parse(i),this._symbolActiveMark.getData().updateData(!1);break;case"leave":this._symbolActiveMark.getDataView().parse([]),this._symbolActiveMark.getData().updateData(!1)}}initSymbolMark(e,i){const n=this._spec.point||{};if(n.visible!==!1&&(this._symbolMark=this._createMark(lineLikeSeriesMark.point,{groupKey:this._seriesField,isSeriesMark:!!i,stateSort:n.stateSort},Object.assign(Object.assign({},e),{setCustomizedShape:n.customShape,morph:shouldMarkDoMorph(this._spec,lineLikeSeriesMark.point.name),morphElementKey:this.getDimensionField()[0]}))),this._spec.activePoint===!0){const o=new DataView(this._option.dataSet,{name:`${PREFIX}_series_${this.id}_active_point`});o.parse([]),this._symbolActiveMark=this._createMark({name:`active_point_${this.id}`,type:"symbol"},{groupKey:this._seriesField,isSeriesMark:!1,dataView:o,parent:this._region.getInteractionMark(),stateSort:n.stateSort},{setCustomizedShape:n.customShape,morph:!1}),this._symbolActiveMark.setVisible(!1)}return this._symbolMark}initSymbolMarkStyle(){const e=this._symbolMark;if(!e)return this._initSymbolActiveMarkAlone(),e;if(this._initSymbolMark(e),this._symbolActiveMark&&this._symbolMark.stateStyle.dimension_hover){this._symbolActiveMark.setVisible(!0),this.event.on(DimensionEventEnum.dimensionHover,this._dimensionTrigger.bind(this));for(const i in this._symbolMark.stateStyle){this._symbolActiveMark.stateStyle[i]={};for(const n in this._symbolMark.stateStyle[i])n!=="visible"&&(this._symbolActiveMark.stateStyle[i][n]={style:null,level:AttributeLevel.Series,referer:e})}this._symbolActiveMark.state.changeStateInfo({stateValue:STATE_VALUE_ENUM.STATE_DIMENSION_HOVER,filter:()=>!0})}return e}_initSymbolMark(e){e&&(this.setMarkStyle(e,{fill:this.getColorAttribute()},"normal",AttributeLevel.Series),this.setMarkStyle(e,{x:i=>this._invalidType==="zero"||this._getInvalidDefined(i)?this.dataToPositionX(i):Number.NaN,y:i=>this._invalidType==="zero"||this._getInvalidDefined(i)?this.dataToPositionY(i):Number.NaN,z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",AttributeLevel.Series))}_initSymbolActiveMarkAlone(){var e,i;const n=this._symbolActiveMark;n&&(this._initSymbolMark(n),n&&(!((i=(e=this._spec[lineLikeSeriesMark.point.name])===null||e===void 0?void 0:e.state)===null||i===void 0)&&i.dimension_hover)&&(n.setVisible(!0),this.event.on(DimensionEventEnum.dimensionHover,this._dimensionTrigger.bind(this)),this.initMarkStyleWithSpec(n,mergeSpec({},this._spec[lineLikeSeriesMark.point.name],{visible:!0})),this._symbolActiveMark.state.changeStateInfo({stateValue:STATE_VALUE_ENUM.STATE_DIMENSION_HOVER,filter:()=>!0})))}initLabelMarkStyle(e){var i;e&&(((i=e.getTarget())===null||i===void 0?void 0:i.type)!=="symbol"&&e.setRule("line-data"),this.setMarkStyle(e,{fill:this.getColorAttribute(),text:n=>n[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._invalidType!=="zero"&&this.setMarkStyle(e,{visible:this._getInvalidDefined.bind(this)},"normal",AttributeLevel.Series),this.event.on(ChartEvent.viewDataStatisticsUpdate,{filter:n=>n.model===this},()=>{this.encodeDefined(e,"visible")}))}initLineLabelMarkStyle(e){e&&this.setMarkStyle(e,{fill:this.getColorAttribute(),text:i=>i[this.getSeriesField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}encodeDefined(e,i){var n,o,l,u;if(!e)return;const d=this._isFieldAllValid();if(this._invalidType==="zero"||d){if(((o=(n=e.stateStyle.normal)===null||n===void 0?void 0:n[i])===null||o===void 0?void 0:o.style)===!0)return;this.setMarkStyle(e,{[i]:!0},"normal",AttributeLevel.Series)}else{if(((u=(l=e.stateStyle.normal)===null||l===void 0?void 0:l[i])===null||u===void 0?void 0:u.style)!==!0)return;this.setMarkStyle(e,{[i]:this._getInvalidDefined.bind(this)},"normal",AttributeLevel.Series)}e.getProduct()&&e.compileEncode()}_isFieldAllValid(){const e=this.getViewDataStatistics(),i=this.getStackValueField();return!!(e&&e.latestData&&i)&&e.latestData[i]&&e.latestData[i].allValid}}const lineSeriesMark=Object.assign(Object.assign({},baseSeriesMark),lineLikeSeriesMark);class BaseLineMark extends BaseMark{setStyle(e,i="normal",n=0,o=this.stateStyle){if(isNil(e))return;o[i]===void 0&&(o[i]={});const l=this._getIgnoreAttributes(),u=["strokeWidth","lineWidth","lineDash","strokeDash","lineJoin","stroke","strokeOpacity","opacity","fill","fillOpacity","texture","texturePadding","textureSize","textureColor"],d=this.isUserLevel(n);let f=!1;Object.keys(e).forEach(g=>{const _=e[g];if(isNil(_)||l.includes(g))return;d&&u.includes(g)&&(isValidScaleType(_==null?void 0:_.type)||_!=null&&_.scale||isFunction(_))&&(f=!0);const y=this._filterAttribute(g,_,i,n,d,o);this.setAttribute(g,y,i,n,o)}),f&&this.setMarkConfig({enableSegments:!0})}}class LineMark extends BaseLineMark{constructor(){super(...arguments),this.type=LineMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:1})}_getIgnoreAttributes(){var e,i;return((e=this.model)===null||e===void 0?void 0:e.type)===SeriesTypeEnum.radar&&((i=this.model)===null||i===void 0?void 0:i.coordinate)==="polar"?[]:["fill","fillOpacity"]}}LineMark.type="line";const registerLineMark=()=>{Factory$1.registerMark(LineMark.type,LineMark),registerLineGraphic(),registerVGrammarLineOrAreaAnimation()};class BaseSymbolMark extends BaseMark{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{size:1,symbolType:"circle",fill:void 0,lineWidth:0})}}class SymbolMark extends BaseSymbolMark{constructor(){super(...arguments),this.type=SymbolMark.type}}SymbolMark.type="symbol";const registerSymbolMark=()=>{Factory$1.registerMark(SymbolMark.type,SymbolMark),registerSymbolGraphic()};class LineLikeSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){var i,n,o;((i=e.point)===null||i===void 0?void 0:i.visible)!==!1&&((o=(n=e.point)===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.visible)!==!1?this._addMarkLabelSpec(e,"point"):this._addMarkLabelSpec(e,"line"),this._addMarkLabelSpec(e,"line","lineLabel","initLineLabelMarkStyle",void 0,!0)}}function isValidAlignDomain(r){return r.length>=2&&isValidNumber(r[0])&&isValidNumber(last(r))&&last(r)>=r[0]}function getScaleInfo(r,e){var i;const n=last(e)-e[0],o=last(e)*e[0]<0;let l=e[0]<=0?0-e[0]:0,u=last(e)>0?last(e)-0:0;n===0?e[0]<0?(l=1,u=0):e[0]>0&&(l=0,u=1):(l/=n,u/=n);const d=r.getDomainSpec(),f={total:n,negative:l,positive:u,includeZero:o,domain:e,extendable_min:!isValidNumber(d.min),extendable_max:!isValidNumber(d.max)};if(!((i=r._break)===null||i===void 0)&&i.scope){const g=e.findIndex(b=>b>=0);let _,y;g===0?(_=r._break.scope[g],y=[e[0],e[1]],f.positive=1,f.negative=0):last(e)<=0?(f.positive=0,f.negative=1,y=[e[e.length-2],e[e.length-1]]):(_=r._break.scope[g-1],y=[e[g-1],e[g]],f.negative=_[0]+(0-y[0])/(y[1]-y[0])*(_[1]-_[0]),f.positive=1-f.negative),f.break=!0,f.extendable_max=!1,f.extendable_min=!1,f.domain=y}return f}function inDifferentCrossZero(r,e){const{positive:i,negative:n,extendable_min:o,extendable_max:l,domain:u}=r,{positive:d,negative:f,extendable_min:g,extendable_max:_,domain:y}=e;if(d>0){if(!g)return!1;let b=n/i;l&&(b=n/Math.max(i,d),u[1]=-u[0]/b),y[0]=-y[1]*b}else if(f>0){if(!_)return!1;let b=i/n;o&&(b=i/Math.max(n,n),u[0]=-u[1]/b),y[1]=-y[0]*b}return!0}function inOnlyZeroDomain(r,e){const{extendable_min:i,extendable_max:n,domain:o}=r,{positive:l,negative:u,domain:d}=e;return(l!==0||u!==0)&&!(l>0&&!n)&&!(u>0&&!i)&&(o[0]=d[0],o[1]=d[1],!0)}function inAllCrossZero(r,e){const{positive:i,negative:n,extendable_max:o,domain:l}=r,{positive:u,negative:d,extendable_min:f,domain:g}=e;if(o&&f){const _=Math.max(n,d)/Math.max(i,u);l[1]=-l[0]/_,g[0]=-g[1]*_}else if(f){const _=n/i;g[0]=-g[1]*_}else{if(!o)return!1;{const _=d/u;l[1]=-l[0]/_}}return!0}function inNoCrossDifferentSide(r,e){const{extendable_min:i,domain:n}=r,{extendable_max:o,domain:l}=e;return!(!i||!o)&&(n[0]=-n[1],l[1]=-l[0],!0)}const zeroAlign=(r,e)=>{var i,n,o,l,u,d;const f=r.getScale(),g=e.getScale();if(!f||!g)return;const _=(o=(n=(i=r).getDomainAfterSpec)===null||n===void 0?void 0:n.call(i))!==null&&o!==void 0?o:[0,1],y=(d=(u=(l=e).getDomainAfterSpec)===null||u===void 0?void 0:u.call(l))!==null&&d!==void 0?d:[0,1];if(!(_&&y&&isValidAlignDomain(_)&&isValidAlignDomain(y)))return;const b=getScaleInfo(r,_),S=getScaleInfo(e,y);if(b.break===!0&&S.break===!0)return;const{positive:v,negative:A,extendable_min:x,extendable_max:T,includeZero:C}=b,{positive:E,negative:P,extendable_min:L,extendable_max:R,includeZero:w}=S;if(v===0&&A===0){if(!inOnlyZeroDomain(b,S))return}else if(E===0&&P===0){if(!inOnlyZeroDomain(S,b))return}else if(C||w)if(C&&!w){if(!inDifferentCrossZero(b,S))return}else if(w&&!C){if(!inDifferentCrossZero(S,b))return}else{if(A===P)return;if(A>P){if(!inAllCrossZero(b,S))return}else if(!inAllCrossZero(S,b))return}else{if(A===0&&E===0){if(!inNoCrossDifferentSide(b,S))return}else if(P===0&&v===0&&!inNoCrossDifferentSide(S,b))return;if(A===0&&P===0)if(_[0]===0&&y[0]>0){if(!L)return;y[0]=0}else{if(!(y[0]===0&&_[0]>0)||!x)return;_[0]=0}if(v===0&&E===0)if(_[1]===0&&y[1]>0){if(!R)return;y[1]=0}else{if(!(y[1]===0&&_[1]>0)||!T)return;_[1]=0}}f.domain(_),g.domain(y)},tickAlign=(r,e)=>{var i,n,o,l,u;if(!r)return r;const d=(i=e==null?void 0:e.targetAxis)===null||i===void 0?void 0:i.call(e);if(!d)return r;const f=(n=e==null?void 0:e.currentAxis)===null||n===void 0?void 0:n.call(e);if(!f)return r;const g=(o=f.getTickData())===null||o===void 0?void 0:o.getDataView();if(!g||!g.transformsArr.find(C=>C.type.includes("ticks")))return r;const _=f.getScale();if(!_)return r;const y=(u=(l=d.getTickData())===null||l===void 0?void 0:l.getDataView())===null||u===void 0?void 0:u.latestData;if(!(y!=null&&y.length))return r;const b=d.getScale();if(!b)return r;const S=b.domain(),v=last(S)-S[0];if(v===0)return r;const A=_.domain(),x=last(A)-A[0];if(v===0)return r;const T=y.map(C=>{const E=(C.value-S[0])/v;return x*E+A[0]});return convertDomainToTickData(T)};class BasePlugin{constructor(e){this.id=createID(),this.name=`${e}_${this.id}`}onAdd(e){this.service=e}release(){this.service=null}}class AxisSyncPlugin extends BasePlugin{constructor(){super(AxisSyncPlugin.type),this.type="AxisSyncPlugin"}_checkEnableSync(e){if(!isContinuous(e.getScale().type))return!1;const i=e.getSpec().sync;return!!(i!=null&&i.axisId)&&i}_getTargetAxis(e,i){const n=e.getOption().getChart().getComponentByUserId(i.axisId);return n!=null&&n.type.startsWith("cartesianAxis")?n:null}onInit(e,i){const n=this._checkEnableSync(i);if(!n||!n.zeroAlign)return;const o=this._getTargetAxis(i,n);o&&i.event.on(ChartEvent.scaleDomainUpdate,{filter:({model:l})=>l.id===i.id||l.id===o.id},()=>{zeroAlign(o,i)})}onDidCompile(e,i){const n=this._checkEnableSync(i);if(!n)return;const o=this._getTargetAxis(i,n);if(o&&n.tickAlign){registerDataSetInstanceTransform(i.getOption().dataSet,"tickAlign",tickAlign);const l={targetAxis:()=>o,currentAxis:()=>i};i.addTransformToTickData({type:"tickAlign",options:l,level:Number.MAX_SAFE_INTEGER},!1)}}}AxisSyncPlugin.pluginType="component",AxisSyncPlugin.type="AxisSyncPlugin";const DEFAULT_TITLE_STYLE={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}};function transformAxisLineStyle(r){return(r=transformComponentStyle(r)).startSymbol=transformComponentStyle(r.startSymbol),r.endSymbol=transformComponentStyle(r.endSymbol),r}function getAxisLabelOffset(r){let e=0;return get(r,"tick.visible")&&(e+=get(r,"tick.tickSize")),get(r,"label.visible")&&(e+=get(r,"label.space")),e}function getLinearAxisSpecDomain(r,e){var i,n,o,l,u,d;return{min:(o=(i=r.min)!==null&&i!==void 0?i:(n=r.range)===null||n===void 0?void 0:n.min)!==null&&o!==void 0?o:e==null?void 0:e.min,max:(d=(l=r.max)!==null&&l!==void 0?l:(u=r.range)===null||u===void 0?void 0:u.max)!==null&&d!==void 0?d:e==null?void 0:e.max}}function isValidCartesianAxis(r){const e=r==null?void 0:r.orient;return e==="top"||e==="bottom"||e==="left"||e==="right"||e==="z"}function isValidPolarAxis(r){const e=r==null?void 0:r.orient;return e==="angle"||e==="radius"}const getCartesianAxisTheme=(r,e,i)=>{var n;const o=(n=e==="band"?getComponentThemeFromOption("axisBand",i):["linear","log","symlog"].includes(e)?getComponentThemeFromOption("axisLinear",i):{})!==null&&n!==void 0?n:{},l=isXAxis(r)?getComponentThemeFromOption("axisX",i):isYAxis(r)?getComponentThemeFromOption("axisY",i):getComponentThemeFromOption("axisZ",i);return mergeSpec({},getComponentThemeFromOption("axis",i),o,l)},getPolarAxisTheme=(r,e,i)=>{var n;const o=(n=e==="band"?getComponentThemeFromOption("axisBand",i):e==="linear"?getComponentThemeFromOption("axisLinear",i):{})!==null&&n!==void 0?n:{},l=getComponentThemeFromOption(r==="angle"?"axisAngle":"axisRadius",i);return mergeSpec({},getComponentThemeFromOption("axis",i),o,l)},isDiscreteAxis=r=>r==="band"||r==="ordinal"||r==="point";function getAxisItem(r,e){return{id:r,label:r,value:e,rawValue:r}}function shouldUpdateAxis(r,e,i){return i||!r||r.getAxisId()===e.getAxisId()}class ComponentPluginService extends BasePluginService{constructor(e){super(),this.component=e}releaseAll(){super.releaseAll(),this.component=null}}function limitTagInBounds(r,e){const{x1:i,y1:n,x2:o,y2:l}=e,{x1:u,y1:d,x2:f,y2:g}=r.AABBBounds,{dx:_=0,dy:y=0}=r.attribute;let b=0,S=0;u<i&&(b=i-u),d<n&&(S=n-d),f>o&&(b=o-f),g>l&&(S=l-g),b&&r.setAttribute("dx",b+_),S&&r.setAttribute("dy",S+y)}function getDatumByValue(r,e,i,n){for(let o=0,l=r.length;o<l;o++){const u=r[o];if(u){const d=u[i],f=u[n||i];if(d<=e&&f>=e)return u}}return null}const getCartesianCrosshairTheme=(r,e)=>{var i,n;const o=array((i=e.axes)!==null&&i!==void 0?i:[]),{bandField:l,linearField:u,xField:d,yField:f}=(n=getComponentThemeFromOption(ComponentTypeEnum.crosshair,r))!==null&&n!==void 0?n:{},g=o.find(S=>isXAxis(S.orient));let _;_=isValid(g)?mergeSpec({},isDiscreteAxis(g.type)?l:u,d):d;const y=o.find(S=>isYAxis(S.orient));let b;return b=isValid(y)?mergeSpec({},isDiscrete(y.type)?l:u,f):f,{xField:_,yField:b}},getPolarCrosshairTheme=(r,e)=>{var i,n;const o=array((i=e.axes)!==null&&i!==void 0?i:[]),{bandField:l,linearField:u,categoryField:d,valueField:f}=(n=getComponentThemeFromOption(ComponentTypeEnum.crosshair,r))!==null&&n!==void 0?n:{},g=o.find(S=>S.orient==="angle");let _;_=isValid(g)?mergeSpec({},isDiscreteAxis(g.type)?l:u,d):d;const y=o.find(S=>S.orient==="radius");let b;return b=isValid(y)?mergeSpec({},isDiscrete(y.type)?l:u,f):f,{categoryField:_,valueField:b}};function getComponentThemeFromGlobalTheme(r,e,i,n){switch(r){case ComponentTypeEnum.cartesianBandAxis:return getCartesianAxisTheme(getOrient(i,["z"]),"band",e);case ComponentTypeEnum.cartesianLinearAxis:return getCartesianAxisTheme(getOrient(i,["z"]),"linear",e);case ComponentTypeEnum.cartesianLogAxis:return getCartesianAxisTheme(getOrient(i,["z"]),"log",e);case ComponentTypeEnum.cartesianSymlogAxis:return getCartesianAxisTheme(getOrient(i,["z"]),"symlog",e);case ComponentTypeEnum.cartesianAxis:case ComponentTypeEnum.cartesianTimeAxis:return getCartesianAxisTheme(getOrient(i),void 0,e);case ComponentTypeEnum.polarBandAxis:return getPolarAxisTheme(i.orient,"band",e);case ComponentTypeEnum.polarLinearAxis:return getPolarAxisTheme(i.orient,"linear",e);case ComponentTypeEnum.polarAxis:return getPolarAxisTheme(i.orient,void 0,e);case ComponentTypeEnum.cartesianCrosshair:return getCartesianCrosshairTheme(e,n);case ComponentTypeEnum.polarCrosshair:return getPolarCrosshairTheme(e,n);case ComponentTypeEnum.colorLegend:case ComponentTypeEnum.sizeLegend:case ComponentTypeEnum.discreteLegend:case ComponentTypeEnum.dataZoom:case ComponentTypeEnum.scrollBar:return getComponentThemeWithDirection(i,getComponentThemeFromOption(r,e));default:return getComponentThemeFromOption(r,e)}}const getComponentThemeWithDirection=(r,e)=>{var i;const n=(i=r.orient)!==null&&i!==void 0?i:e.orient,o=e[getDirectionByOrient(n)],l=mergeSpec({},e,o);return delete l.horizontal,delete l.vertical,l};class BaseComponentSpecTransformer extends BaseModelSpecTransformer{getTheme(e,i){return getComponentThemeFromGlobalTheme(this.type,this._option.getTheme(),e,i)}_mergeThemeToSpec(e,i){const{spec:n,theme:o}=super._mergeThemeToSpec(e,i);return this._adjustPadding(n),{spec:n,theme:o}}_adjustPadding(e){const{padding:i,noOuterPadding:n=!0,orient:o}=e;n&&i&&o&&(e.padding=Object.assign(Object.assign({},normalizeLayoutPaddingSpec(i)),{[o]:0}))}}var __rest$d=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class BaseComponent extends LayoutModel{static createComponent(e,i){const{spec:n}=e,o=__rest$d(e,["spec"]);return new this(n,Object.assign(Object.assign({},i),o))}getRegions(){return this._regions}created(){super.created(),this.initLayout(),this.pluginService=new ComponentPluginService(this)}constructor(e,i){super(e,i),this.name="component",this.modelType="component",this.transformerConstructor=BaseComponentSpecTransformer,this._delegateEvent=(n,o,l,u=null,d=null)=>{var f,g;o instanceof CustomEvent||this.event.emit(l,{model:this,node:n,event:o,item:u,datum:d,source:Event_Source_Type.chart,chart:(g=(f=this._option)===null||f===void 0?void 0:f.globalInstance)===null||g===void 0?void 0:g.getChart()},"model")},this._option.animation&&(this.animate=new AnimateManager({getCompiler:i.getCompiler}))}initLayout(){var e;super.initLayout(),this._regions=(e=this._regions)!==null&&e!==void 0?e:this._option.getRegionsInIndex(),this._layout&&(this._layout.layoutBindRegionID=this._regions.map(i=>i==null?void 0:i.id))}changeRegions(e){throw new Error("Method not implemented.")}_getNeedClearVRenderComponents(){throw new Error("Method not implemented.")}onRender(e){throw new Error("Method not implemented.")}getVRenderComponents(){return this._getNeedClearVRenderComponents()}callPlugin(e){this.pluginService&&this.pluginService.getAll().forEach(i=>e(i))}getContainer(){var e;return this._container||(this._container=(e=this._option)===null||e===void 0?void 0:e.globalInstance.getStage().find(i=>i.name==="root",!0)),this._container}_compareSpec(e,i){const n=super._compareSpec(e,i);return n.reMake||(n.reMake=["seriesId","seriesIndex","regionId","regionIndex"].some(o=>!isEqual(i==null?void 0:i[o],e[o]))),(i==null?void 0:i.visible)!==e.visible&&(n.reCompile=!0),n}release(){var e;super.release(),this.clear(),(e=this.pluginService)===null||e===void 0||e.releaseAll(),this.pluginService=null}clear(){var e;const i=this._getNeedClearVRenderComponents();i&&i.length&&i.forEach(n=>{var o;n&&((o=this.getContainer())===null||o===void 0||o.removeChild(n),n=null)}),this._container=null,(e=this.pluginService)===null||e===void 0||e.clearAll()}compile(){this.compileMarks(),this.reAppendComponents()}compileMarks(e){this.getMarks().forEach(i=>{i.compile({group:e,context:{model:this}})})}reAppendComponents(){const e=this._getNeedClearVRenderComponents();e&&e.length&&e.forEach(i=>{var n;i&&!i.stage&&((n=this.getContainer())===null||n===void 0||n.appendChild(i))})}getBoundsInRect(e,i){return{x1:0,x2:0,y1:0,y2:0}}getDatum(e){}}BaseComponent.transformerConstructor=BaseComponentSpecTransformer;class ComponentMark extends BaseMark{constructor(e,i){super(e,i),this.type="component",this._componentType=i.componentType,this._mode=i.mode}_initProduct(e){const i=this.getVGrammarView(),n=this.getProductId();this._product=i.mark(GrammarMarkType.component,e??i.rootMark,{componentType:this._componentType,mode:this._mode}).id(n),this._compiledProductId=n}}ComponentMark.type="component";const registerComponentMark=()=>{Factory$1.registerMark(ComponentMark.type,ComponentMark)},scaleParser=r=>r;var __rest$c=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class AxisComponent extends BaseComponent{getOrient(){return this._orient}getScale(){return this._scale}getScales(){return this._scales}getTickData(e=0){return this._tickData[e]}get visible(){return this._visible}getInverse(){return this._inverse}getCoordinateType(){return this._coordinateType}constructor(e,i){var n;super(e,i),this.specKey="axes",this._scales=[],this._tickData=[],this._visible=!0,this._tick=void 0,this._visible=(n=e.visible)===null||n===void 0||n,this._coordinateType="none"}_getNeedClearVRenderComponents(){return[]}getVRenderComponents(){var e,i,n,o;return[(i=(e=this._axisMark)===null||e===void 0?void 0:e.getProduct())===null||i===void 0?void 0:i.getGroupGraphicItem(),(o=(n=this._gridMark)===null||n===void 0?void 0:n.getProduct())===null||o===void 0?void 0:o.getGroupGraphicItem()].filter(isValid)}created(){var e,i,n,o,l,u,d,f,g,_,y,b,S,v,A,x,T,C;if(super.created(),this.setSeriesAndRegionsFromSpec(),this.initEvent(),this.initScales(),this.updateSeriesScale(),this._shouldComputeTickData()&&this._initData(),this._visible){const E=this._createMark({type:"component",name:`axis-${this.getOrient()}`},{componentType:this.getOrient()==="angle"?"circleAxis":"axis",mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});if(this._axisMark=E,E.setMarkConfig({zIndex:this.layoutZIndex}),isValid(this._spec.id)&&E.setUserId(this._spec.id),E.setMarkConfig({interactive:(e=this._spec.interactive)!==null&&e!==void 0?e:this.getDefaultInteractive()}),this._marks.addMark(E),(i=this._spec.grid)===null||i===void 0?void 0:i.visible){const P=this._createMark({type:"component",name:`axis-${this.getOrient()}-grid`},{componentType:this.getOrient()==="angle"?GridEnum.circleAxisGrid:GridEnum.lineAxisGrid,mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});P.setMarkConfig({zIndex:(d=(l=(o=(n=this._spec.grid)===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.zIndex)!==null&&l!==void 0?l:(u=this._spec.grid)===null||u===void 0?void 0:u.zIndex)!==null&&d!==void 0?d:LayoutZIndex.Axis_Grid,interactive:!1}),this._marks.addMark(P),this._gridMark=P}if(this._option.animation!==!1&&get(this._option.getChart().getSpec(),"animation")!==!1&&this._spec.animation===!0){const P=animationConfig((f=Factory$1.getAnimationInKey("axis"))===null||f===void 0?void 0:f(),{appear:(_=(g=this._spec.animationAppear)!==null&&g!==void 0?g:get(this._option.getChart().getSpec(),"animationAppear.axis"))!==null&&_!==void 0?_:get(this._option.getChart().getSpec(),"animationAppear"),disappear:(b=(y=this._spec.animationDisappear)!==null&&y!==void 0?y:get(this._option.getChart().getSpec(),"animationDisappear.axis"))!==null&&b!==void 0?b:get(this._option.getChart().getSpec(),"animationDisappear"),enter:(v=(S=this._spec.animationEnter)!==null&&S!==void 0?S:get(this._option.getChart().getSpec(),"animationEnter.axis"))!==null&&v!==void 0?v:get(this._option.getChart().getSpec(),"animationEnter"),exit:(x=(A=this._spec.animationExit)!==null&&A!==void 0?A:get(this._option.getChart().getSpec(),"animationExit.axis"))!==null&&x!==void 0?x:get(this._option.getChart().getSpec(),"animationExit"),update:(C=(T=this._spec.animationUpdate)!==null&&T!==void 0?T:get(this._option.getChart().getSpec(),"animationUpdate.axis"))!==null&&C!==void 0?C:get(this._option.getChart().getSpec(),"animationUpdate")});P.enter&&(P.update[0].customParameters={enter:P.enter[0]}),this._marks.forEach(L=>L.setAnimationConfig(P))}}}_shouldComputeTickData(){return this.getVisible()||this._spec.forceInitTick}_initData(){const e=this._initTickDataSet(this._tickTransformOption());e.target.addListener("change",this._forceLayout.bind(this)),this._tickData=[new CompilableData(this._option,e)]}collectData(e,i){const n=[];return eachSeries(this._regions,o=>{var l;let u=this.collectSeriesField(e,o);if(u=isArray(u)?isContinuous(this._scale.type)?u:[u[0]]:[u],e||(this._dataFieldText=o.getFieldAlias(u[0])),u){const d=o.getViewData();if(i)u.forEach(f=>{n.push(o.getRawDataStatisticsByField(f,!1))});else if(d&&d.latestData&&d.latestData.length){const f=(l=o.getViewDataStatistics)===null||l===void 0?void 0:l.call(o),g=this.type===ComponentTypeEnum.cartesianLinearAxis&&this._spec.breaks&&this._spec.breaks.length;u.forEach(_=>{var y;!((y=f==null?void 0:f.latestData)===null||y===void 0)&&y[_]&&(g?n.push(Object.assign(Object.assign({},f.latestData[_]),{values:d.latestData.map(b=>b[_])})):n.push(f.latestData[_]))})}}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),n}isSeriesDataEnable(){let e=!0;return eachSeries(this._regions,i=>{var n;isArray((n=i.getViewDataStatistics())===null||n===void 0?void 0:n.latestData)&&(e=!1)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),e}setSeriesAndRegionsFromSpec(){const{seriesId:e,seriesIndex:i,regionId:n,regionIndex:o}=this._spec;isValid(e)&&(this._seriesUserId=array(e)),isValid(n)&&(this._regionUserId=array(n)),isValid(i)&&(this._seriesIndex=array(i)),isValid(o)&&(this._regionIndex=array(o)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionIndex),this.layout.layoutBindRegionID=this._regions.map(l=>l.id)}getBindSeriesFilter(){return{userId:this._seriesUserId,specIndex:this._seriesIndex}}initEvent(){this.event.on(ChartEvent.scaleUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===this.id},this.effect.scaleUpdate.bind(this));const e=getSeries(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}).map(i=>i.getViewDataStatistics()).filter(i=>!!i);e.length>1?this._option.dataSet.multipleDataViewAddListener(e,"change",()=>{this.updateScaleDomain()}):e.length===1&&e[0].target.addListener("change",()=>{this.updateScaleDomain()}),eachSeries(this._regions,i=>{i.event.on(ChartEvent.rawDataUpdate,{filter:({model:n})=>(n==null?void 0:n.id)===i.id},()=>{this._clearRawDomain()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}updateScaleDomain(){}_clearRawDomain(){}onLayoutEnd(e){this.updateScaleRange(),this.event.emit(ChartEvent.scaleUpdate,{model:this,value:"range"}),super.onLayoutEnd(e)}computeData(e){e!=="force"||this._tickData&&this._tickData.length?!this._tickData||!this._tickData.length||e!=="force"&&isEqual(this._scale.range(),[0,1])||this._tickData.forEach(i=>{i.getDataView().reRunAllTransform(),i.updateData()}):eachSeries(this._regions,i=>{var n;(n=i.getViewData())===null||n===void 0||n.reRunAllTransform()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}initScales(){this._scales=[this._scale];const e=[];if(eachSeries(this._regions,i=>{const n=i.getGroups();n&&e.push(n)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),e.length!==0){const i=maxInArray(e.map(n=>n.fields.length));for(let n=1;n<i;n++){const o=this._scale.clone();this._scales.push(o)}}}_compareSpec(e,i){const n=super._compareSpec(e,i);return n.reMake?n:(n.reRender=!0,(i==null?void 0:i.type)!==(e==null?void 0:e.type)||(i==null?void 0:i.visible)!==(e==null?void 0:e.visible)?(n.reMake=!0,n):(n.reMake=["grid","subGrid","tick","subTick","label","domainLine","title"].some(o=>{var l,u;return((l=i==null?void 0:i[o])===null||l===void 0?void 0:l.visible)!==((u=e==null?void 0:e[o])===null||u===void 0?void 0:u.visible)}),n))}_getAxisAttributes(){const e=this._spec,i={orient:this.getOrient(),select:this._option.disableTriggerEvent!==!0&&e.select,hover:this._option.disableTriggerEvent!==!0&&e.hover};if(e.domainLine&&e.domainLine.visible?i.line=transformAxisLineStyle(e.domainLine):i.line={visible:!1},e.label&&e.label.visible){const n=pickWithout(e.label,["style","formatMethod","state"]);i.label=n,e.label.style&&(i.label.style=isFunction(e.label.style)?(o,l,u,d)=>{var f;const g=e.label.style(o.rawValue,l,o,u,d);return transformToGraphic(mergeSpec({},(f=this._theme.label)===null||f===void 0?void 0:f.style,g))}:transformToGraphic(e.label.style)),(e.label.formatMethod||e.label.formatter)&&(i.label.formatMethod=this._getLabelFormatMethod()),e.label.state&&(i.label.state=transformAxisLabelStateStyle(e.label.state))}else i.label={visible:!1};if(e.tick&&e.tick.visible?(i.tick={visible:e.tick.visible,length:e.tick.tickSize,inside:e.tick.inside,alignWithLabel:e.tick.alignWithLabel,dataFilter:e.tick.dataFilter},e.tick.style&&(i.tick.style=isFunction(e.tick.style)?(n,o,l,u)=>{var d;const f=e.tick.style(n,o,l,u);return transformToGraphic(mergeSpec({},(d=this._theme.tick)===null||d===void 0?void 0:d.style,f))}:transformToGraphic(e.tick.style)),e.tick.state&&(i.tick.state=transformStateStyle(e.tick.state))):i.tick={visible:!1},e.subTick&&e.subTick.visible?(i.subTick={visible:e.subTick.visible,length:e.subTick.tickSize,inside:e.subTick.inside,count:e.subTick.tickCount},e.subTick.style&&(i.subTick.style=isFunction(e.subTick.style)?(n,o,l,u)=>{var d;const f=e.subTick.style(n,o,l,u);return transformToGraphic(mergeSpec({},(d=this._theme.subTick)===null||d===void 0?void 0:d.style,f))}:transformToGraphic(e.subTick.style)),e.subTick.state&&(i.subTick.state=transformStateStyle(e.subTick.state))):i.subTick={visible:!1},e.title&&e.title.visible){const n=e.title,{autoRotate:o,angle:l,style:u={},background:d,state:f,shape:g}=n,_=__rest$c(n,["autoRotate","angle","style","background","state","shape"]);let y,b=l;e.orient!=="left"&&e.orient!=="right"||o&&isNil(b)&&(b=e.orient==="left"?-90:90,y=DEFAULT_TITLE_STYLE[e.orient]),i.title=Object.assign(Object.assign({},_),{autoRotate:!1,angle:b?degreeToRadian(b):null,textStyle:mergeSpec({},y,transformToGraphic(u)),pickable:u.pickable!==!1,childrenPickable:u.pickable!==!1,state:{}}),g&&g.visible?(i.title.shape=Object.assign(Object.assign({},g),{style:transformToGraphic(g.style)}),g.state&&(i.title.state.shape=transformStateStyle(g.state))):i.title.shape={visible:!1},d&&d.visible?(i.title.background=Object.assign(Object.assign({},d),{style:transformToGraphic(d.style)}),d.state&&(i.title.state.background=transformStateStyle(d.state))):i.title.background={visible:!1},f&&(i.title.state.text=transformStateStyle(f))}else i.title={visible:!1};return e.background&&e.background.visible?(i.panel={visible:!0},e.background.style&&(i.panel.style=transformToGraphic(e.background.style)),e.background.state&&(i.panel.state=transformStateStyle(e.background.state))):i.panel={visible:!1},i}_getGridAttributes(){const e=this._spec;return{alternateColor:e.grid.alternateColor,alignWithLabel:e.grid.alignWithLabel,style:isFunction(e.grid.style)?()=>(i,n)=>{var o,l;const u=e.grid.style((o=i.datum)===null||o===void 0?void 0:o.rawValue,n,i.datum);return transformToGraphic(mergeSpec({},(l=this._theme.grid)===null||l===void 0?void 0:l.style,u))}:transformToGraphic(e.grid.style),subGrid:e.subGrid.visible===!1?{visible:!1}:{type:"line",visible:e.subGrid.visible,alternateColor:e.subGrid.alternateColor,style:transformToGraphic(e.subGrid.style)}}}_getLabelFormatMethod(){const{formatMethod:e,formatter:i}=this._spec.label,{formatFunc:n}=getFormatFunction(e,i);return n?(o,l,u)=>n(l.rawValue,l,i):null}_initTickDataSet(e,i=0){registerDataSetInstanceParser(this._option.dataSet,"scale",scaleParser);const n=this.registerTicksTransform();return new DataView(this._option.dataSet,{name:`${this.type}_${this.id}_ticks_${i}`}).parse(this._scales[i],{type:"scale"}).transform({type:n,options:e},!1)}_tickTransformOption(){const e=this._tick||{},i=this._spec.label||{},{tickCount:n,forceTickCount:o,tickStep:l,tickMode:u}=e,{style:d,formatMethod:f,minGap:g}=i;return{sampling:this._spec.sampling!==!1,tickCount:n,forceTickCount:o,tickStep:l,tickMode:u,axisOrientType:this._orient,coordinateType:this._coordinateType,labelStyle:d,labelFormatter:f,labelGap:g}}addTransformToTickData(e,i){this._tickData.forEach(n=>{var o;(o=n==null?void 0:n.getDataView())===null||o===void 0||o.transform(e,i)})}dataToPosition(e){return this._scale.scale(e)}getDatum(e){var i,n;return e&&e.name===AXIS_ELEMENT_NAME.label?e.data:this._axisMark?(n=(i=this._axisMark.getProduct())===null||i===void 0?void 0:i.getGroupGraphicItem())===null||n===void 0?void 0:n.attribute.items:void 0}}AxisComponent.specKey="axes";const registerAxis=()=>{registerComponentMark(),Factory$1.registerAnimation("axis",()=>({appear:{custom:GroupFadeIn},update:{custom:GroupTransition},exit:{custom:GroupFadeOut}}))};var __rest$b=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const CartesianAxisPlugin=[AxisSyncPlugin];class CartesianAxis extends AxisComponent{getOrient(){return this._orient}getDefaultInteractive(){return!0}set autoIndentOnce(e){this._autoIndentOnce=e}getScales(){return this._scales}constructor(e,i){super(e,i),this.type=ComponentTypeEnum.cartesianAxis,this.name=ComponentTypeEnum.cartesianAxis,this._defaultBandPosition=.5,this._defaultBandInnerPadding=.1,this._defaultBandOuterPadding=.3,this.layoutType="region-relative",this.layoutZIndex=LayoutZIndex.Axis,this.layoutLevel=LayoutLevel.Axis,this._orient="left",this._autoIndentOnce=!1,this._hasAutoIndent=!1,this._scales=[],this._tick=void 0,this._layoutCache={width:0,height:0,_lastComputeOutBounds:{x1:0,x2:0,y1:0,y2:0}},this._innerOffset={top:0,bottom:0,left:0,right:0},this.effect={scaleUpdate:n=>{this.computeData(n==null?void 0:n.value),eachSeries(this._regions,o=>{const l=this.getOrient();isXAxis(l)?shouldUpdateAxis(o.getXAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&o.setXAxisHelper(this.axisHelper()):isYAxis(l)?shouldUpdateAxis(o.getYAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&o.setYAxisHelper(this.axisHelper()):isZAxis(l)&&shouldUpdateAxis(o.getZAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&o.setZAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=n=>{let{x:o,y:l}=n;return isValidNumber(o)&&(o+=+(this._orient==="left")*this.getLayoutRect().width),isValidNumber(l)&&(l+=+(this._orient==="top")*this.getLayoutRect().height),{x:o,y:l}},this._transformLayoutRect=n=>{if(!this._visible)return n;const o=this._latestBounds.clone().translate(-this.getLayoutStartPoint().x,-this.getLayoutStartPoint().y);switch(this._layout.layoutOrient){case"left":this._layout.layoutRectLevelMap.width===DEFAULT_LAYOUT_RECT_LEVEL&&(n.width=o.x1<0?-o.x1:0);break;case"right":this._layout.layoutRectLevelMap.width===DEFAULT_LAYOUT_RECT_LEVEL&&(n.width=o.x2>0?o.x2:0);break;case"top":this._layout.layoutRectLevelMap.height===DEFAULT_LAYOUT_RECT_LEVEL&&(n.height=o.y1<0?-o.y1:0);break;case"bottom":this._layout.layoutRectLevelMap.height===DEFAULT_LAYOUT_RECT_LEVEL&&(n.height=o.y2>0?o.y2:0)}return n.width=Math.ceil(n.width),n.height=Math.ceil(n.height),this._layout.setRectInSpec(this._layoutCacheProcessing(n))},this._updateAxisLayout=()=>{const n=this.getLayoutStartPoint(),o=this._getUpdateAttribute(!1),{grid:l}=o,u=__rest$b(o,["grid"]),d=this._axisMark.getProduct(),f=mergeSpec({x:n.x,y:n.y},this._axisStyle,u);d.encode(f),this._gridMark&&this._gridMark.getProduct().encode(mergeSpec({x:n.x,y:n.y},this._getGridAttributes(),l))},this._fixAxisOnZero=()=>{const{onZero:n,visible:o}=this._spec.domainLine;if(this.visible&&n&&o!==!1){const{onZeroAxisId:l,onZeroAxisIndex:u}=this._spec.domainLine,d=this._option.getComponentsByKey("axes"),f=isXAxis(this.getOrient()),g=y=>{var b;return(f?!isXAxis(y.getOrient()):isXAxis(y.getOrient()))&&isContinuous(y.getScale().type)&&(y.getTickData()?(b=y.getTickData().getLatestData())===null||b===void 0?void 0:b.find(S=>S.value===0):y.getScale().domain()[0]<=0&&last(y.getScale().domain())>=0)},_=d.filter(y=>g(y));if(_.length){let y;if(isValid(l))y=_.find(b=>b.id===l);else if(isValid(u)){const b=d[u];g(b)&&(y=b)}else y=_[0];if(y){const b=this._axisMark.getProduct(),S=y.valueToPosition(0);f?b.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dy:this._orient==="bottom"?-((y.getInverse()?y.getScale().range()[1]:y.getScale().range()[0])-S):S})}):b.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dx:this._orient==="left"?S:-((y.getInverse()?y.getScale().range()[0]:y.getScale().range()[1])-S)})})}}}},this._orient=getOrient(e,["z"]),isZAxis(this._orient)&&(this.layoutType="absolute"),this._dataSet=i.dataSet,this._coordinateType="cartesian"}static getSpecInfo(e){const i=e[this.specKey];if(!i)return null;const n=e.direction==="horizontal";if(!isArray(i)){if(!isValidCartesianAxis(i))return null;const{axisType:d,componentName:f}=getCartesianAxisInfo(i,n);return i.type=d,[{spec:i,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:f}]}let o=!0;if(i.filter(d=>d.orient==="z")[0]){const d=i.filter(g=>g.orient==="bottom")[0],f=i.filter(g=>isYAxis(g.orient))[0];o=i.length===3&&d&&f}let l=i.map((d,f)=>({spec:d,index:f}));o||(l=l.filter(({spec:d})=>d.orient!=="z"));const u=[];return l.forEach(({spec:d,index:f})=>{if(!isValidCartesianAxis(d))return;const{axisType:g,componentName:_}=getCartesianAxisInfo(d,n);d.type=g,u.push({spec:d,specPath:[this.specKey,f],specInfoPath:["component",this.specKey,f],type:_})}),u}static createComponent(e,i){const{spec:n}=e,o=__rest$b(e,["spec"]),l=Factory$1.getComponentInKey(o.type);return l?new l(n,Object.assign(Object.assign({},i),o)):(i.onError(`Component ${o.type} not found`),null)}initLayout(){super.initLayout(),this._layout.autoIndent=this._spec.autoIndent!==!1,this._layout.layoutOrient=this._orient}setLayout3dBox(e){this.layout3dBox=e}getNewScaleRange(){const{width:e,height:i}=this.getLayoutRect(),{left:n,right:o,top:l,bottom:u}=this._innerOffset;let d=[];return isXAxis(this.getOrient())?isValidNumber(e)&&(d=this._inverse?[e-o,n]:[n,e-o]):isZAxis(this.getOrient())?isValidNumber(e)&&(d=this._inverse?[e-o,n]:[n,e-o],this._scale.range(d)):isValidNumber(i)&&(d=this._inverse?[l,i-u]:[i-u,l]),d}updateScaleRange(){let e=!1;const i=this.getNewScaleRange(),n=this._scale.range();return i.length===n.length&&i.every((o,l)=>o===n[l])?e=!1:(e=!0,this._scale.range(i)),e}init(e){var i;super.init(e),(i=this.pluginService)===null||i===void 0||i.load(CartesianAxisPlugin.map(n=>new n)),this.callPlugin(n=>{this.pluginService&&n.onInit&&n.onInit(this.pluginService,this)})}setAttrFromSpec(){var e;if(super.setAttrFromSpec(),this.visible){isXAxis(this.getOrient())?isUndefined(this._spec.maxHeight)&&(this._spec.maxHeight="30%"):isUndefined(this._spec.maxWidth)&&(this._spec.maxWidth="30%");const n=this._getAxisAttributes();n.label.formatMethod=this._getLabelFormatMethod(),n.verticalFactor=this.getOrient()==="top"||this.getOrient()==="right"?-1:1,this._axisStyle=n}this._tick=this._spec.tick;const i=(e=this._option.getChart())===null||e===void 0?void 0:e.getSpec();this._inverse=transformInverse(this._spec,(i==null?void 0:i.direction)==="horizontal")}onLayoutStart(e,i,n){if(super.onLayoutStart(e,i,n),!isZAxis(this.getOrient())&&this._spec.innerOffset){const o=this._spec;isYAxis(this.getOrient())?["top","bottom"].forEach(l=>{this._innerOffset[l]=calcLayoutNumber(o.innerOffset[l],i.height,i)}):["left","right"].forEach(l=>{this._innerOffset[l]=calcLayoutNumber(o.innerOffset[l],i.width,i)})}}getSeriesStatisticsField(e){let i;return i=isXAxis(this.getOrient())?e.fieldX:isZAxis(this.getOrient())?e.fieldZ:e.fieldY,isContinuous(this._scale.type)?i:[i[0]]}_tickTransformOption(){var e,i,n,o;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimals:(e=this._tick)===null||e===void 0?void 0:e.noDecimals,labelLastVisible:(i=this._spec.label)===null||i===void 0?void 0:i.lastVisible,labelFirstVisible:(n=this._spec.label)===null||n===void 0?void 0:n.firstVisible,labelFlush:(o=this._spec.label)===null||o===void 0?void 0:o.flush})}axisHelper(){return{isContinuous:isContinuous(this._scale.type),dataToPosition:this.dataToPosition.bind(this),getScale:(e=0)=>this._scales[e],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse===!0,getSpec:()=>this._spec}}afterCompile(){var e;const i=(e=this._axisMark)===null||e===void 0?void 0:e.getProduct();i&&i.addEventListener(HOOK_EVENT.AFTER_ELEMENT_ENCODE,()=>{if(this._isLayout===!1&&(isXAxis(this.getOrient())?this.callPlugin(n=>{this.pluginService&&n.onDidLayoutHorizontal&&n.onDidLayoutHorizontal(this.pluginService,this)}):this.callPlugin(n=>{this.pluginService&&n.onDidLayoutVertical&&n.onDidLayoutVertical(this.pluginService,this)}),this._unitText)){const{x:n,y:o}=this.getLayoutStartPoint(),l=isXAxis(this._orient)?{x:maxInArray(this._scale.range())+n,y:o}:{x:n,y:minInArray(this._scale.range())+o};this._unitText.setAttributes(l)}}),this.callPlugin(n=>{this.pluginService&&n.onDidCompile&&n.onDidCompile(this.pluginService,this)})}onRender(e){}changeRegions(e){}update(e){}resize(e){}collectScale(){const e=[];return eachSeries(this._regions,i=>{e.push(this.getOrient()==="left"||this.getOrient()==="right"?i.scaleY:i.scaleX)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),e}collectSeriesField(e,i){var n,o;let l;return l=e>0?(o=(n=i.getGroups())===null||n===void 0?void 0:n.fields)===null||o===void 0?void 0:o[e]:isXAxis(this.getOrient())?i.getSpec().x2Field?[...i.fieldX,i.fieldX2]:i.fieldX:isZAxis(this.getOrient())?i.fieldZ:i.getSpec().y2Field?[...i.fieldY,i.fieldY2]:i.fieldY,l}updateSeriesScale(){const e=this.getOrient();eachSeries(this._regions,i=>{isXAxis(e)?shouldUpdateAxis(i.getXAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&(i.setScaleX(this._scale),i.setXAxisHelper(this.axisHelper())):isYAxis(e)?shouldUpdateAxis(i.getYAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&(i.setScaleY(this._scale),i.setYAxisHelper(this.axisHelper())):isZAxis(e)&&shouldUpdateAxis(i.getZAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&(i.setScaleZ(this._scale),i.setZAxisHelper(this.axisHelper()))},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getBoundsInRect(e){var i;let n={x1:0,y1:0,x2:0,y2:0};if(!this._visible)return n;this._verticalLimitSize=isXAxis(this.getOrient())?e.height:e.width,this.setLayoutRect(e),!this.updateScaleRange()&&isArray((i=this.getTickData())===null||i===void 0?void 0:i.getLatestData())||this.computeData("range");const o={skipLayout:!1},l=isXAxis(this.getOrient());this.pluginService&&(l?this.callPlugin(f=>{f.onWillLayoutHorizontal&&f.onWillLayoutHorizontal(this.pluginService,o,this)}):this.callPlugin(f=>{f.onWillLayoutVertical&&f.onWillLayoutVertical(this.pluginService,o,this)}));const u=this._axisMark.getProduct();let d=!1;if(!o.skipLayout){const f=this._getUpdateAttribute(!0),g=u.getGroupGraphicItem(),_=mergeSpec(Object.assign({},this.getLayoutStartPoint()),this._axisStyle,f,{line:{visible:!1}});let y=g.getBoundsWithoutRender(_);y.empty()&&(y=new Bounds().set(_.x,_.y,_.x,_.y)),d=!0,this._latestBounds=y,n=this._appendAxisUnit(y,l)}return d||(this._latestBounds=u.getBounds()),n}positionToData(e,i){const n=isXAxis(this.getOrient());i&&(e-=n?this.getLayoutStartPoint().x:this.getLayoutStartPoint().y),this._innerOffset&&(e=n?clamp(e,this._innerOffset.left,this.getLayoutRect().width-this._innerOffset.right):clamp(e,this._innerOffset.top,this.getLayoutRect().height-this._innerOffset.bottom));const o=this._scale.range();return(e-o[0])*(e-last(o))>0?null:this._scale.invert(e)}_getTitleLimit(e){var i,n,o,l,u;const d=this._spec.title;if(d.visible&&isNil((i=d.style)===null||i===void 0?void 0:i.maxLineWidth)){const f=(u=(o=(n=this._axisStyle.title)===null||n===void 0?void 0:n.angle)!==null&&o!==void 0?o:(l=d.style)===null||l===void 0?void 0:l.angle)!==null&&u!==void 0?u:0;if(e){const y=this.getLayoutRect().width,b=Math.abs(Math.cos(f));return b<1e-6?1/0:y/b}const g=this.getLayoutRect().height,_=Math.abs(Math.sin(f));return _<1e-6?1/0:g/_}return null}_getUpdateAttribute(e){var i;let n=0,o=0;if(!e){const x=this.getRegions();let{x:T,y:C}=x[0].getLayoutStartPoint(),E=T+x[0].getLayoutRect().width,P=C+x[0].getLayoutRect().height;for(let L=1;L<x.length;L++){const R=x[L],{x:w,y:D}=R.getLayoutStartPoint(),{width:I,height:O}=R.getLayoutRect();T=Math.min(T,w),E=Math.max(E,I+w),C=Math.min(C,D),P=Math.max(P,O+D)}n=Math.abs(P-C),o=Math.abs(E-T)}const{width:l,height:u}=this.getLayoutRect(),d=isXAxis(this._orient),f=isYAxis(this._orient),g=isZAxis(this._orient),_=this.layout3dBox?this.layout3dBox.length:0;let y={x:0,y:0},b=n,S=l;d?y={x:l,y:0}:f?(y={x:0,y:u},b=o,S=u):g&&(y={x:_,y:0});const v=this.getLabelItems(S),A={start:{x:0,y:0},end:y,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(d)},items:v};if(e||(A.grid={type:"line",start:{x:0,y:0},end:y,items:v[0],verticalFactor:this._axisStyle.verticalFactor,depth:_,length:b}),g){const x=(i=this.directionStr)!==null&&i!==void 0?i:"r2l",T=this.layout3dBox?this.layout3dBox.width:0;let C=[0,0],E=-Math.PI/2,P=0;x==="l2r"&&(P=this.layout3dBox.length,C=[0,0,0],E=Math.PI/2),A.z=P,A.alpha=E,A.anchor3d=C,e||(A.grid.depth=T)}else{let x=d?this.layout.minHeight:this.layout.minWidth;(d&&this._layout.layoutRectLevelMap.height===USER_LAYOUT_RECT_LEVEL||f&&this._layout.layoutRectLevelMap.width===USER_LAYOUT_RECT_LEVEL)&&(x=this._verticalLimitSize),A.verticalLimitSize=this._verticalLimitSize,A.verticalMinSize=x,A.label={overflowLimitLength:this._getLabelOverflowLimit(d)}}return A}getLabelItems(e){var i;const n=(i=this.getTickData())===null||i===void 0?void 0:i.getLatestData();return n&&n.length?[n.map(o=>{const l=this._getNormalizedValue([o.value],e);return getAxisItem(o.value,l)}).filter(o=>{const{value:l,rawValue:u}=o,d=this._scale.domain();return this.getSpec().type==="log"?l>=0&&l<=1:isContinuous(this._scale.type)?u>=d[0]&&u<=last(d):d.includes(u)})]:[]}initEvent(){super.initEvent(),this.visible&&(this.event.on(ChartEvent.layoutEnd,this._updateAxisLayout),this.event.on(ChartEvent.layoutEnd,this._fixAxisOnZero),this.event.on(ChartEvent.layoutRectUpdate,()=>{this._clearLayoutCache()}))}_getNormalizedValue(e,i){return i===0?0:this.dataToPosition(e)/i}_layoutCacheProcessing(e){return["width","height"].forEach(i=>{e[i]<this._layoutCache[i]?e[i]=this._layoutCache[i]:this._layoutCache[i]=e[i]}),this._autoIndentOnce&&this._hasAutoIndent?["x1","x2","y1","y2"].forEach(i=>{this.layout.getLastComputeOutBounds()[i]=this._layoutCache._lastComputeOutBounds[i]}):(this._hasAutoIndent=!0,["x1","x2","y1","y2"].forEach(i=>{this.layout.getLastComputeOutBounds()[i]<this._layoutCache._lastComputeOutBounds[i]?this.layout.getLastComputeOutBounds()[i]=this._layoutCache._lastComputeOutBounds[i]:this._layoutCache._lastComputeOutBounds[i]=this.layout.getLastComputeOutBounds()[i]})),e}_clearLayoutCache(){this._hasAutoIndent=!1,this._layoutCache.width=0,this._layoutCache.height=0,this._layoutCache._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0}}onDataUpdate(){this._clearLayoutCache()}_appendAxisUnit(e,i){var n;if(this._spec.unit&&this._spec.unit.visible){const{text:o,style:l}=this._spec.unit;let u,d;const{x:f,y:g}=this.getLayoutStartPoint();i?(u={x:maxInArray(this._scale.range())+f,y:g},d={textAlign:"left",textBaseline:"middle"}):(u={x:f,y:minInArray(this._scale.range())+g},d={textAlign:this._orient==="left"?"left":"right",textBaseline:"bottom"}),d=Object.assign(Object.assign(Object.assign({},d),l),{x:u.x,y:u.y,text:o}),this._unitText?this._unitText.setAttributes(d):(this._unitText=createText(d),this._unitText.name="axis-unit",(n=this.getContainer())===null||n===void 0||n.add(this._unitText));const _=this._unitText.AABBBounds;i?(e.x2+=_.x2>e.x2?_.x2-e.x2:0,e.y2+=_.y2>e.y2?_.y2-e.y2:0):(e.x1+=_.x1<e.x1?_.x1-e.x1:0,e.y1+=_.y1<e.y1?_.y1-e.y1:0)}return e}_getNeedClearVRenderComponents(){return this._unitText?[this._unitText]:[]}_getLabelOverflowLimit(e){var i,n;if(e&&((i=this._spec.label)===null||i===void 0?void 0:i.visible)!==!1&&((n=this._spec.label)===null||n===void 0?void 0:n.autoLimit)===!0){const o=this._option.getComponentsByKey("axes"),l=this.getRegions(),u=o.filter(y=>{const b=y.getOrient();return(b==="left"||b==="right")&&y.getRegions().some(S=>l.includes(S))});let d=0,f=0;const g=this.getLayoutStartPoint().x,_=g+this.getLayoutRect().width;return u.forEach(y=>{const b=y.getLayoutStartPoint().x;if(y.getOrient()==="left"&&b===g){const S=y.getLayoutRect().width;d=Math.max(d,S)}else if(b===_){const S=y.getLayoutRect().width;f=Math.max(f,S)}}),{left:d,right:f}}}}CartesianAxis.type=ComponentTypeEnum.cartesianAxis,CartesianAxis.specKey="axes";const setDomain=(r,e,i)=>i.reduce((n,o,l)=>(n.push([o,i.length===l+1?e:i[l+1]]),n),[[r,i[0]]]);function breakDomain(r,e){const i=r[0],n=r[r.length-1],o=e.filter(l=>l>i&&l<n);return o.length===0?[[i,n]]:setDomain(i,n,o)}const sorter=(r,e)=>r-e,fillBins=(r,e)=>{const i=[{count:0,sub:[],max:e[0],min:e[0]}];let n=0,o=0;for(;n<e.length;)r[o]<=e[n]?(i[n].count+=1,i[n].sub.push(r[o]),o+=1):(n+=1,i[n]={count:0,sub:[],max:e[n],min:e[n]});i.forEach(u=>{u.count&&(u.min=Math.min.apply(null,u.sub))});const l=r.slice(o);return i[n]={count:l.length,sub:l,min:e[e.length-1],max:Math.max.apply(null,l)},i};function breakScope(r,e,i="count"){const n=fillBins(r,e),o=i==="count"?r.length:n.reduce((f,g,_)=>g.count>0?f+g.max-g.min:f,0),l=[];let u=0,d=0;return n.forEach((f,g)=>{if(o===0)l.push([0,g/n.length-1]);else{const _=i==="count"?f.count:f.max-f.min,y=l[d-1]?l[d-1][1]:0,b=g===n.length-1?1:Math.min((u+_)/o,1);(y!==b||y!==0&&y!==1)&&(d+=1,l.push([y,b]),u+=_)}}),l}function breakData(r,e,i){return r.sort(sorter),e.sort(sorter),{domain:breakDomain(r,e),scope:breakScope(r,e,i)}}const e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);class LinearAxisMixin{constructor(){this._extend={},this.niceLabelFormatter=null}setExtraAttrFromSpec(){isValid(this._spec.nice)&&(this._nice=this._spec.nice),isValid(this._spec.zero)&&(this._zero=this._spec.zero),this._expand=this._spec.expand,this._domain=getLinearAxisSpecDomain(this._spec)}transformScaleDomain(){this.setScaleNice()}setLinearScaleNice(){var e;if(!this._nice)return!1;let i=5;const n=this._spec.tick||{};if(isValidNumber(n.forceTickCount))i=n.forceTickCount;else if(isFunction(n.tickCount)){const u=this._scale.range();let d=Math.abs(last(u)-u[0]);d===1&&this._option&&(d=isXAxis(this._orient)?this._option.getChartViewRect().width:this._option.getChartViewRect().height),i=n.tickCount({axisLength:d,labelStyle:this._spec.label&&this._spec.label.style})}else i=isValidNumber(n.tickCount)?n.tickCount:5;this._spec.niceType==="accurateFirst"&&(i=Math.max(5,i));const{min:o,max:l}=(e=this._domain)!==null&&e!==void 0?e:{};return isNil(o)&&isNil(l)&&isNil(this._softMaxValue)&&isNil(this._softMinValue)?this._scale.nice(i):(isValid(o)||isValid(this._softMinValue))&&isNil(l)&&isNil(this._softMaxValue)?this._scale.niceMax(i):!(!isNil(o)||!isNil(this._softMinValue)||!isValid(l)&&!isValid(this._softMaxValue))&&this._scale.niceMin(i)}setLogScaleNice(){var e;if(!this._nice)return!1;const{min:i,max:n}=(e=this._domain)!==null&&e!==void 0?e:{};return isNil(i)&&isNil(n)&&isNil(this._softMaxValue)&&isNil(this._softMinValue)?this._scale.nice():(isValid(i)||isValid(this._softMinValue))&&isNil(n)&&isNil(this._softMaxValue)?this._scale.niceMax():!(!isNil(i)||!isNil(this._softMinValue)||!isValid(n)&&!isValid(this._softMaxValue))&&this._scale.niceMin()}setScaleNice(){return this._spec.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}dataToPosition(e,i){return this.valueToPosition(e[0])}valueToPosition(e){return this._scale.scale(e)}computeLinearDomain(e){let i=[];if(e.length){const n=this._spec.breaks&&this._spec.breaks.length;let o,l,u=[];if(e.forEach(d=>{const{min:f,max:g}=d;o=o===void 0?f:Math.min(o,f),l=l===void 0?g:Math.max(l,g),n&&(u=u.concat(d.values))}),n){const d=[],f=[],g=isNil(this._domain.max)?l:this._domain.max;for(let _=0;_<this._spec.breaks.length;_++){const{range:y}=this._spec.breaks[_];y[0]<=y[1]&&y[1]<=g&&(d.push(y),f.push(this._spec.breaks[_]))}if(d.sort((_,y)=>_[0]-y[0]),d.length){const{domain:_,scope:y}=breakData(u,combineDomains(d),this._spec.breaks[0].scopeType);i=combineDomains(_),this._break={domain:_,scope:y,breakDomains:d,breaks:f}}else i=[o,l]}else i=[o,l]}else i[0]=0,i[1]=0;return this.setSoftDomainMinMax(i),this.expandDomain(i),this.includeZero(i),this.setDomainMinMax(i),i}expandDomain(e){if(!this._expand)return;let i=e[0],n=last(e);i===n&&(n===0?n=1:n>0?i=0:n<0&&(n=0)),isValid(this._expand.min)&&(e[0]=i-(n-i)*this._expand.min),isValid(this._expand.max)&&(e[e.length-1]=n+(n-i)*this._expand.max)}niceDomain(e){const{min:i,max:n}=getLinearAxisSpecDomain(this._spec);if(isValid(i)||isValid(n)||this._spec.type!=="linear")return e;if(Math.abs(minInArray(e)-maxInArray(e))<=1e-12){let o=e[0];const l=o>=0?1:-1;if(o=Math.abs(o),o<1)e[0]=0,e[e.length-1]=1;else{let u=o/5;const d=Math.floor(Math.log(u)/Math.LN10),f=u/Math.pow(10,d);u=(f>=e10?10:f>=e5?5:f>=e2?2:1)*Math.pow(10,d),e[0]=0,e[e.length-1]=10*u}l<0&&(e.reverse(),e[0]*=-1,e[e.length-1]*=-1)}return e}includeZero(e){this._zero&&(e[0]=Math.min(e[0],0),e[e.length-1]=Math.max(last(e),0))}setExtendDomain(e,i){if(i===void 0)return void delete this._extend[e];this._extend[e]=i;const n=this._scale.domain();this.extendDomain(n),this.includeZero(n),this.setDomainMinMax(n),this.niceDomain(n),this._scale.domain(n,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this.event.emit(ChartEvent.scaleUpdate,{model:this,value:"domain"})}extendDomain(e){let i;const n=e.length-1,o=e[0]-e[n]>0,l=o?n:0,u=o?0:n;for(const d in this._extend)i=this._extend[d],i>e[u]&&(e[u]=i),i<e[l]&&(e[l]=i)}getDomainSpec(){return this._domain}setDomainMinMax(e){if(!this._domain)return;const{min:i,max:n}=this._domain;isValid(i)&&(e[0]=i),isValid(n)&&(e[e.length-1]=n)}setSoftDomainMinMax(e){const{softMin:i,softMax:n}=this._spec;if(isValid(i)){let o=isFunction(i)?i(e):i;isNil(o)&&(o=e[0]),o<=e[0]&&(e[0]=o,this._softMinValue=o)}if(isValid(n)){let o=isFunction(n)?n(e):n;isNil(o)&&(o=last(e)),o>=last(e)&&(e[e.length-1]=o),this._softMaxValue=o}}setZero(e){this._zero!==e&&(this._zero=e,this.updateScaleDomain())}updateScaleDomain(){if(!this.isSeriesDataEnable())return;const e=this.collectData(),i=this.computeLinearDomain(e);this.updateScaleDomainByModel(i)}updateScaleDomainByModel(e){e=e??this._scale.domain(),this.extendDomain(e),this.includeZero(e),this.setDomainMinMax(e),this.niceDomain(e),this._scale.domain(e,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this._updateNiceLabelFormatter(e),this._domainAfterSpec=this._scale.domain(),this.event.emit(ChartEvent.scaleDomainUpdate,{model:this}),this.event.emit(ChartEvent.scaleUpdate,{model:this,value:"domain"})}getDomainAfterSpec(){return this._domainAfterSpec}_updateNiceLabelFormatter(e){const i=Math.abs(last(e)-e[0]),n=Math.max(-Math.floor(Math.log10(i)),0)+2,o=Math.pow(10,n);this.niceLabelFormatter=l=>isValidNumber(+l)?Math.round(+l*o)/o:l}}class CartesianLinearAxis extends CartesianAxis{constructor(){super(...arguments),this.type=ComponentTypeEnum.cartesianLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new LinearScale}setAttrFromSpec(){var e,i;super.setAttrFromSpec(),this.setExtraAttrFromSpec();const n=(i=(e=this._tickData)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.getDataView().transformsArr.find(o=>o.type===this.registerTicksTransform());n&&(n.options=this._tickTransformOption())}initScales(){var e,i;super.initScales();const n=[0,1];isValid((e=this._domain)===null||e===void 0?void 0:e.min)&&(n[0]=this._domain.min),isValid((i=this._domain)===null||i===void 0?void 0:i.max)&&(n[1]=this._domain.max),this._scale.domain(n)}_tickTransformOption(){var e;return Object.assign(Object.assign({},super._tickTransformOption()),{breakData:!((e=this._spec.breaks)===null||e===void 0)&&e.length?()=>this._break:null})}_getUpdateAttribute(e){var i,n;const o=super._getUpdateAttribute(e);if(!isZAxis(this._orient)&&(!((n=(i=this._break)===null||i===void 0?void 0:i.breaks)===null||n===void 0)&&n.length)){const{width:l,height:u}=this.getLayoutRect(),d=isXAxis(this._orient),f=d?l:u;o.breaks=this._break.breaks.map(g=>{const{range:_,breakSymbol:y,gap:b=6}=g,S=this.valueToPosition((_[0]+_[1])/2)/f;let v;v=isPercent(b)?Number(b.substring(0,b.length-1))/100:b/f;const A=isValidNumber(y==null?void 0:y.angle)?y.angle:d?60:15;return{range:[S-v/2,S+v/2],breakSymbol:Object.assign(Object.assign({visible:!0},y),{angle:A*Math.PI/180}),rawRange:_}})}return o}getNewScaleRange(){var e,i;let n=super.getNewScaleRange();return!((e=this._spec.breaks)===null||e===void 0)&&e.length&&(!((i=this._break)===null||i===void 0)&&i.scope)&&(n=combineDomains(this._break.scope).map(o=>n[0]+(last(n)-n[0])*o)),n}computeDomain(e){return this.computeLinearDomain(e)}axisHelper(){const e=super.axisHelper();return e.setExtendDomain=this.setExtendDomain.bind(this),e.valueToPosition=this.valueToPosition.bind(this),e}registerTicksTransform(){const e=`${this.type}-ticks`;return registerDataSetInstanceTransform(this._option.dataSet,e,continuousTicks),e}}CartesianLinearAxis.type=ComponentTypeEnum.cartesianLinearAxis,CartesianLinearAxis.specKey="axes",mixin(CartesianLinearAxis,LinearAxisMixin);const registerCartesianLinearAxis=()=>{registerLineAxis(),registerLineGrid(),registerAxis(),Factory$1.registerComponent(CartesianLinearAxis.type,CartesianLinearAxis)};class BandAxisMixin{constructor(){this._rawDomainIndex=[]}_initData(){var e;if(this._spec.showAllGroupLayers&&this._scales.length>1)for(let i=0;i<this._scales.length;i++){const n=((e=this._spec.layers)!==null&&e!==void 0?e:[])[this._scales.length-1-i]||{};if(n.visible!==!1&&n.tickCount!==0&&n.forceTickCount!==0){const o=this._initTickDataSet(Object.assign(Object.assign({},this._tickTransformOption()),n),i);o.target.addListener("change",this._forceLayout.bind(this));const l=new CompilableData(this._option,o);this._tickData.push(l),this._tickDataMap||(this._tickDataMap={}),this._tickDataMap[i]=l}}else{const i=this._initTickDataSet(this._tickTransformOption());i.target.addListener("change",this._forceLayout.bind(this));const n=new CompilableData(this._option,i);this._tickData=[n],this._tickDataMap={0:n}}}dataToPosition(e,i={}){var n,o;if(e.length===0||this._scales.length===0)return 0;const{position:l,bandScale:u}=this.getPosition(e);return l+u.bandwidth()*((o=(n=i.bandPosition)!==null&&n!==void 0?n:this._spec.bandPosition)!==null&&o!==void 0?o:this._defaultBandPosition)}valueToPosition(e){return this._scale.scale(e)}updateGroupScaleRange(){let e=this._scale;this._scales.forEach((i,n)=>{n>0&&(i.range([0,e.bandwidth()]),e=i)})}getPosition(e){let i=0,n=this._scale;if(this._scales.length===1||e.length===1)i=this.valueToPosition(e[0]);else{const o=Math.min(e.length,this._scales.length);for(let l=0;l<o;l++)i+=this._scales[l].scale(e[l]);n=this._scales[o-1]}return{position:i,bandScale:n}}calcScales(e,i){var n,o;const{bandPadding:l,paddingInner:u,paddingOuter:d}=this._spec,f=isArray(l),g=isArray(u),_=isArray(d);for(let y=0;y<this._scales.length;y++){const b=f?l[y]:l,S=g?u[y]:u,v=_?d[y]:d;this._scales[y].paddingInner((n=S??b)!==null&&n!==void 0?n:e,!0).paddingOuter((o=v??b)!==null&&o!==void 0?o:i,!0)}}computeBandDomain(e){if(!e.length)return[];if(e.length===1)return e[0].values;const i=new Set;for(let n=0;n<e.length;n++)for(let o=0;o<e[n].values.length;o++)i.add(e[n].values[o]);return Array.from(i)}updateScaleDomain(){var e;if(!this.isSeriesDataEnable())return;!(!((e=this._rawDomainIndex)===null||e===void 0)&&e.length)&&this._scales.length&&this._updateRawDomain();const i=this._spec.domain;for(let n=0;n<this._scales.length;n++)if(i&&i.length&&n===0)this._scales[n].domain(i);else{const o=this.collectData(n),l=this.computeBandDomain(o);this._scales[n].domain(l.sort((u,d)=>this._rawDomainIndex[n][u]-this._rawDomainIndex[n][d]))}this.transformScaleDomain(),this.event.emit(ChartEvent.scaleDomainUpdate,{model:this}),this.event.emit(ChartEvent.scaleUpdate,{model:this,value:"domain"})}getLabelItems(e){const i=[];let n=[];return this._scales.forEach((o,l)=>{var u;const d=this._tickDataMap[l],f=(u=d==null?void 0:d.getLatestData())===null||u===void 0?void 0:u.length,g=f?d.getLatestData().map(_=>_.value):o.domain();if(g&&g.length)if(n&&n.length){const _=[],y=[];n.forEach(b=>{g.forEach(S=>{const v=array(b).concat(S);if(y.push(v),f){const A=getAxisItem(S,this._getNormalizedValue(v,e));_.push(A)}})}),f&&i.push(_.filter(b=>b.value>=0&&b.value<=1)),n=y}else g.forEach(_=>{n.push(_)}),f&&i.push(d.getLatestData().map(_=>getAxisItem(_.value,this._getNormalizedValue([_.value],e))).filter(_=>_.value>=0&&_.value<=1))}),i.reverse()}_updateRawDomain(){this._rawDomainIndex=[];const e=this._spec.domain;for(let i=0;i<this._scales.length;i++)if(e&&e.length&&i===0)this._scales[i].domain(e);else{const n=this.collectData(i,!0),o=this.computeBandDomain(n);this._rawDomainIndex[i]={},o.forEach((l,u)=>this._rawDomainIndex[i][l]=u)}}_clearRawDomain(){this._rawDomainIndex=[]}}class CartesianBandAxis extends CartesianAxis{constructor(){super(...arguments),this.type=ComponentTypeEnum.cartesianBandAxis,this._scale=new BandScale}computeDomain(e){return this.computeBandDomain(e)}updateScaleRange(){const e=super.updateScaleRange();return this.updateGroupScaleRange(),e}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}axisHelper(){const e=(i=0)=>this._scales[i];return{isContinuous:!1,dataToPosition:this.dataToPosition.bind(this),getScale:e,getBandwidth:(i=0)=>e(i).bandwidth(),getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse,getSpec:()=>this._spec}}registerTicksTransform(){const e=`${this.type}-ticks`;return registerDataSetInstanceTransform(this._option.dataSet,e,linearDiscreteTicks),e}transformScaleDomain(){this.updateFixedWholeLength()}updateFixedWholeLength(){if(this._scale){const{bandSize:e,maxBandSize:i,minBandSize:n}=this._getOuterBandSizeFromSpec();if(e&&this._scale.bandwidth(e),i&&this._scale.maxBandwidth(i),n&&this._scale.minBandwidth(n),this._scale.isBandwidthFixed()&&this._spec.autoRegionSize&&(e||i)){const o=scaleWholeRangeSize(this._scale.domain().length,e??i,this._scale.paddingInner(),this._scale.paddingOuter());["bottom","top"].includes(this._orient)?this._regions.forEach(l=>l.setMaxWidth(o)):["left","right"].includes(this._orient)&&this._regions.forEach(l=>l.setMaxHeight(o))}}}_getOuterBandSizeFromSpec(){var e;let{bandSize:i,maxBandSize:n,minBandSize:o,bandSizeLevel:l=0}=this._spec;const{gap:u,extend:d=0}=(e=this._spec.bandSizeExtend)!==null&&e!==void 0?e:{};l=Math.min(l,this._scales.length-1);for(let f=l;f>0;f--){const g=this._scales[f],_=g.domain(),y=g.paddingInner(),b=g.paddingOuter(),S=v=>{const A=f===l?d:0;return isNil(u)||f<l?scaleWholeRangeSize(_.length,v,y,b)+A:(v+(isString(u)?v*(Number(u.substring(0,u.length-1))/100):u))*_.length/(this._scales[f-1].paddingInner()+1)+A};isValid(i)&&(i=S(i)),isValid(n)&&(n=S(n)),isValid(o)&&(o=S(o))}return{bandSize:i,maxBandSize:n,minBandSize:o}}}CartesianBandAxis.type=ComponentTypeEnum.cartesianBandAxis,CartesianBandAxis.specKey="axes",mixin(CartesianBandAxis,BandAxisMixin);const registerCartesianBandAxis=()=>{registerLineAxis(),registerLineGrid(),registerAxis(),Factory$1.registerComponent(CartesianBandAxis.type,CartesianBandAxis)};class CartesianTimeAxis extends CartesianLinearAxis{constructor(){super(...arguments),this.type=ComponentTypeEnum.cartesianTimeAxis,this._zero=!1,this.effect={scaleUpdate:e=>{this.computeData(e==null?void 0:e.value),eachSeries(this._regions,i=>{isXAxis(this.getOrient())?shouldUpdateAxis(i.getXAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&i.setXAxisHelper(this.axisHelper()):shouldUpdateAxis(i.getYAxisHelper(),this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&i.setYAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}setAttrFromSpec(){var e;super.setAttrFromSpec(),this._tick=mergeSpec({},this._spec.tick,(e=this._spec.layers)===null||e===void 0?void 0:e[0])}_initData(){var e;if(super._initData(),(e=this._spec.layers)===null||e===void 0?void 0:e[1]){const i=new DataView(this._option.dataSet,{name:`${this.type}_${this.id}_layer_1_ticks`}).parse(this._scale,{type:"scale"}).transform({type:`${this.type}-ticks`,options:Object.assign(Object.assign({},this._tickTransformOption()),{tickCount:this._spec.layers[1].tickCount,forceTickCount:this._spec.layers[1].forceTickCount,tickStep:this._spec.layers[1].tickStep})},!1);this._layerTickData=new CompilableData(this._option,i)}}computeData(e){super.computeData(e),this._layerTickData&&(this._layerTickData.getDataView().reRunAllTransform(),this._layerTickData.updateData())}_getLabelFormatMethod(){var e,i,n,o,l,u,d,f;const g=TimeUtil.getInstance(),_=((i=(e=this._spec.layers)===null||e===void 0?void 0:e[1])===null||i===void 0?void 0:i.timeFormat)||"%Y%m%d",y=(((o=(n=this._spec.layers)===null||n===void 0?void 0:n[1])===null||o===void 0?void 0:o.timeFormatMode)||"local")==="local"?g.timeFormat:g.timeUTCFormat,b=((u=(l=this._spec.layers)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.timeFormat)||"%Y%m%d",S=(((f=(d=this._spec.layers)===null||d===void 0?void 0:d[0])===null||f===void 0?void 0:f.timeFormatMode)||"local")==="local"?g.timeFormat:g.timeUTCFormat;return(v,A,x,T,C)=>{var E;let P;return P=C===0?S(b,v):y(_,v),!((E=this._spec.label)===null||E===void 0)&&E.formatMethod?this._spec.label.formatMethod(P,A):P}}getLabelItems(e){var i,n;const o=[],l=(i=this.getTickData())===null||i===void 0?void 0:i.getLatestData();l&&l.length&&o.push(l.map(d=>getAxisItem(d.value,this._getNormalizedValue([d.value],e))));const u=(n=this._layerTickData)===null||n===void 0?void 0:n.getLatestData();return u&&u.length&&o.push(u.map(d=>getAxisItem(d.value,this._getNormalizedValue([d.value],e)))),o}registerTicksTransform(){const e=`${this.type}-ticks`;return registerDataSetInstanceTransform(this._option.dataSet,e,continuousTicks),e}transformScaleDomain(){}}CartesianTimeAxis.type=ComponentTypeEnum.cartesianTimeAxis,CartesianTimeAxis.specKey="axes";const registerCartesianTimeAxis=()=>{registerLineAxis(),registerLineGrid(),registerAxis(),Factory$1.registerComponent(CartesianTimeAxis.type,CartesianTimeAxis)};class CartesianLogAxis extends CartesianLinearAxis{constructor(){super(...arguments),this.type=ComponentTypeEnum.cartesianLogAxis,this._zero=!1,this._scale=new LogScale}initScales(){var e;super.initScales(),this._scale.base((e=this._spec.base)!==null&&e!==void 0?e:10),this._scale.clamp(!0,null,!1)}registerTicksTransform(){const e=`${this.type}-ticks`;return registerDataSetInstanceTransform(this._option.dataSet,e,continuousTicks),e}transformScaleDomain(){}}CartesianLogAxis.type=ComponentTypeEnum.cartesianLogAxis,CartesianLogAxis.specKey="axes",mixin(CartesianLogAxis,LinearAxisMixin);const registerCartesianLogAxis=()=>{registerLineAxis(),registerLineGrid(),registerAxis(),Factory$1.registerComponent(CartesianLogAxis.type,CartesianLogAxis)};class CartesianSymlogAxis extends CartesianLinearAxis{constructor(){super(...arguments),this.type=ComponentTypeEnum.cartesianSymlogAxis,this._zero=!1,this._scale=new SymlogScale}initScales(){var e;super.initScales(),this._scale.constant((e=this._spec.constant)!==null&&e!==void 0?e:10)}registerTicksTransform(){const e=`${this.type}-ticks`;return registerDataSetInstanceTransform(this._option.dataSet,e,continuousTicks),e}transformScaleDomain(){}}CartesianSymlogAxis.type=ComponentTypeEnum.cartesianSymlogAxis,CartesianSymlogAxis.specKey="axes",mixin(CartesianSymlogAxis,LinearAxisMixin);const registerCartesianSymlogAxis=()=>{registerLineAxis(),registerLineGrid(),registerAxis(),Factory$1.registerComponent(CartesianSymlogAxis.type,CartesianSymlogAxis)};class LineSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.line,this.transformerConstructor=LineLikeSeriesSpecTransformer,this._sortDataByAxis=!1}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}initMark(){var e;const i={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},n=(e=this._spec.seriesMark)!==null&&e!==void 0?e:"line";this.initLineMark(i,n==="line"),this.initSymbolMark(i,n==="point")}initTooltip(){super.initTooltip();const{group:e,mark:i}=this._tooltipHelper.activeTriggerSet;this._lineMark&&e.add(this._lineMark),this._symbolMark&&(i.add(this._symbolMark),e.add(this._symbolMark))}initMarkStyle(){this.initLineMarkStyle(this._direction),this.initSymbolMarkStyle()}initAnimation(){var e,i,n,o;const l={direction:this.direction},u=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;if(this._lineMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("line"))===null||n===void 0?void 0:n(l,u),userAnimationConfig("line",this._spec,this._markAttributeContext))),this._symbolMark){const d=getGroupAnimationParams(this);this._symbolMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("scaleInOut"))===null||o===void 0?void 0:o(),userAnimationConfig("point",this._spec,this._markAttributeContext),d))}}onLayoutEnd(e){super.onLayoutEnd(e),this.reCompileSampling()}getSeriesStyle(e){var i;const n=((i=this._spec)===null||i===void 0?void 0:i.seriesMark)!=="point";return o=>{var l,u;return n&&o==="fill"&&(o="stroke"),(u=(l=this._seriesMark)===null||l===void 0?void 0:l.getAttribute(o,e))!==null&&u!==void 0?u:void 0}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._lineMark,this._symbolMark]}}LineSeries.type=SeriesTypeEnum.line,LineSeries.mark=lineSeriesMark,LineSeries.transformerConstructor=LineLikeSeriesSpecTransformer,mixin(LineSeries,LineLikeSeriesMixin);const registerLineSeries=()=>{registerSampleTransform(),registerMarkOverlapTransform(),registerLineMark(),registerSymbolMark(),registerLineAnimation(),registerScaleInOutAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(LineSeries.type,LineSeries)};class ChartData{get dataList(){return this._dataArr}constructor(e){this._dataArr=[],this._dataSet=e}parseData(e){this._dataArr=[];const i=array(e);for(let n=0;n<i.length;n++)this._dataArr.push(dataToDataView(i[n],this._dataSet,this._dataArr))}updateData(e,i=!1,n=!0){const o=array(e);return(!i||o.length===this._dataArr.length)&&(this._dataValueForEach(o,(l,u)=>{u.markRunning()}),this._dataValueForEach(o,(l,u)=>{updateDataViewInData(u,l,n)}),!0)}_dataValueForEach(e,i){e.forEach((n,o)=>{if(n instanceof DataView)return;const l=this.getSeriesData(n.id,o);l&&i(n,l,o)})}getSeriesData(e,i){if(!this._dataArr.length)return null;if(typeof e=="string"){const n=this._dataArr.filter(o=>o.name===e);if(n[0])return n[0];warn(`no data matches dataId ${e}!`)}if(typeof i=="number"){if(this._dataArr[i])return this._dataArr[i];warn(`no data matches dataIndex ${i}!`)}return this._dataArr[0]}}class GlobalScale{constructor(e,i){this._scaleSpecMap=new Map,this._scaleMap=new Map,this._modelScaleSpecMap=new Map,this._markAttributeScaleMap=new Map,this._spec=null,this._chart=null,this.getStatisticalFields=n=>{const o=[];return this._scaleSpecMap.forEach((l,u)=>{isDataDomainSpec(l.domain)&&l.domain.forEach(d=>{d.dataId===n&&d.fields.forEach(f=>{mergeFields(o,[{key:f,operations:isContinuous(l.type)?["max","min"]:["values"]}])})})}),this._markAttributeScaleMap.forEach((l,u)=>{const d=this.getScale(u);l.forEach(f=>{this._getSeriesBySeriesId(f.seriesId).getRawData().name===n&&f.field&&mergeFields(o,[{key:f.field,operations:isContinuous(d.type)?["max","min"]:["values"]}])})}),o},this._spec=e,this._chart=i,this._setAttrFromSpec()}_createFromSpec(e){if(!e.id)return null;let i=this._scaleMap.get(e.id);return i||(i=e.type==="ordinal"&&e.id==="color"?createScale("colorOrdinal"):createScale(e.type)),i?(isArray(e.range)&&i.range(e.range),isArray(e.domain)&&(isDataDomainSpec(e.domain)||i.domain(e.domain)),e.specified&&i.specified&&i.specified(e.specified),i):null}_setAttrFromSpec(){var e;if(!(!((e=this._spec)===null||e===void 0)&&e.length))return;const i=new Map,n=new Map;this._spec.forEach(o=>{const l=this._createFromSpec(o);l&&(i.set(o.id,l),n.set(o.id,o))}),this._modelScaleSpecMap.forEach(o=>{const l=this._createFromSpec(o);l&&(i.set(o.id,l),n.set(o.id,o))}),this._scaleSpecMap=n,this._scaleMap=i}updateSpec(e){const i={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(isEqual(e,this._spec))return i;i.change=!0;for(let n=0;n<e.length;n++){const o=e[n],l=this._scaleMap.get(o.id);if(!l)return i.reMake=!0,i;const u=this._spec.find(d=>d.id===o.id);if(!u.id||u.type!==o.type||!isEqual(u.specified,o.specified))return i.reMake=!0,i;o.range&&!isEqual(o.range,l.range())&&(l.range(o.range),i.reRender=!0),isDataDomainSpec(o.domain)?i.reRender=!0:isEqual(o.domain,l.domain())||(l.domain(o.domain),i.reRender=!0),this._scaleSpecMap.set(o.id,o)}return this._spec=e,i}registerModelScale(e){const i=this._createFromSpec(e);i&&(this._modelScaleSpecMap.set(e.id,e),this._scaleSpecMap.set(e.id,e),this._scaleMap.set(e.id,i))}removeModelScale(e){this._modelScaleSpecMap.forEach(i=>{e(i)&&(this._modelScaleSpecMap.delete(i.id),this._scaleSpecMap.delete(i.id),this._scaleMap.delete(i.id))})}getScale(e){return this._scaleMap.get(e)}getScaleSpec(e){return this._scaleSpecMap.get(e)}_getSeriesByRawDataId(e){const i=this._chart.getAllSeries();for(let n=0;n<i.length;n++){const o=i[n];if(o.getRawData().name===e)return o}return null}_getSeriesBySeriesId(e){const i=this._chart.getAllSeries();for(let n=0;n<i.length;n++){const o=i[n];if(o.id===e)return o}return null}updateScaleDomain(e){this._scaleSpecMap.forEach((i,n)=>{const o=this._scaleMap.get(n);if(!o)return;if(!isDataDomainSpec(i.domain))return i.domain&&i.domain.length!==0||o.domain(e),void this._updateMarkScale(n,o,o.domain().slice());let l;l=isContinuous(i.type)?[null,null]:new Set,i.domain.forEach(d=>{const f=this._getSeriesByRawDataId(d.dataId);if(!f)return;const g=isContinuous(i.type);d.fields.forEach(_=>{const y=f.getRawDataStatisticsByField(_,g);y&&(g?(isNil(l[0])?l[0]=y.min:l[0]=Math.min(y.min,l[0]),isNil(l[1])?l[1]=y.max:l[1]=Math.max(y.max,l[1])):y.values.forEach(b=>{l.add(b)}))})});const u=l;isContinuous(i.type)||(l=Array.from(l)),o.domain(l),this._updateMarkScale(n,o,u)})}_updateMarkScale(e,i,n){const o=this._markAttributeScaleMap.get(e);o&&o.length!==0&&o.forEach(l=>{if(!l.field||!l.markScale||l.markScale===i)return;if(isNil(l.changeDomain)||l.changeDomain==="none"||isNil(l.seriesId))return void(isContinuous(i.type)?l.markScale.domain(n):i.domain(Array.from(n)));const u=this._getSeriesBySeriesId(l.seriesId),d=isContinuous(i.type),f=u.getRawDataStatisticsByField(l.field,d);if(!isEmpty(f))return l.changeDomain==="expand"?(d?(n[0]=Math.min(n[0],f.min),n[1]=Math.max(n[1],f.max)):(f.values.forEach(g=>{n.add(g)}),n=Array.from(n)),void l.markScale.domain(n)):void(l.changeDomain!=="replace"||(d?l.markScale.domain([f.min,f.max]):l.markScale.domain(f.values)));isContinuous(i.type)?l.markScale.domain(n):i.domain(Array.from(n))})}registerMarkAttributeScale(e,i){const n=this._scaleMap.get(e.scale);let o=this._markAttributeScaleMap.get(e.scale);o||(o=[],this._markAttributeScaleMap.set(e.scale,o));let l=n;return(isNil(e.field)||!isNil(e.changeDomain)&&e.changeDomain!=="none"&&!isNil(i))&&(l=n.clone()),o.push(Object.assign(Object.assign({},e),{seriesId:i,markScale:l})),l}}var __rest$a=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class BaseChart extends CompilableBase{getSpec(){return this._spec}setSpec(e){this._spec=e}getOption(){return this._option}getLayoutRect(){return this._layoutRect}getViewRect(){return this._viewRect}getLayoutTag(){return this._layoutTag}setLayoutTag(e,i,n=!0){this._layoutTag=e;const o=this.getCompiler();return o!=null&&o.getVGrammarView()&&(o.getVGrammarView().updateLayoutTag(),e&&n&&o.renderNextTick(i)),this._layoutTag}getGlobalScale(){return this._globalScale}getEvent(){return this._event}get chartData(){return this._chartData}constructor(e,i){var n,o,l;super(i),this.type="chart",this.id=createID(),this._regions=[],this._series=[],this._components=[],this._layoutRect={x:0,y:0,width:DEFAULT_CHART_WIDTH,height:DEFAULT_CHART_HEIGHT},this._viewRect={width:DEFAULT_CHART_WIDTH,height:DEFAULT_CHART_HEIGHT},this._viewBox={x1:0,y1:0,x2:DEFAULT_CHART_WIDTH,y2:DEFAULT_CHART_HEIGHT},this._layoutTag=!0,this._idMap=new Map,this.state={layoutUpdateRank:1},this.padding={top:0,left:0,right:0,bottom:0},this.getAllSeries=()=>{var u;return(u=this._series)!==null&&u!==void 0?u:[]},this.getRegionsInIndex=u=>u&&u.length!==0?this._regions.filter((d,f)=>u.includes(f)):[this._regions[0]],this.getAllRegions=()=>this._regions,this.getRegionsInIds=u=>u?this._regions.filter(d=>u.includes(d.id)):[],this.getRegionsInQuerier=u=>u?this._regions.filter((d,f)=>array(u).some(g=>isValid(g.regionId)&&g.regionId===d.userId||g.regionIndex===f)):this._regions,this.getRegionsInUserId=u=>{if(u)return this._regions.find(d=>d.userId===u)},this.getRegionsInUserIdOrIndex=(u,d)=>this.getAllRegions().filter(f=>u!=null&&u.length?f.userId&&u.includes(f.userId):!(d!=null&&d.length)||d.includes(f.getSpecIndex())),this.getComponents=()=>this._components,this.getSeriesInIndex=u=>u&&u.length!==0?this._series.filter((d,f)=>u.includes(f)):[this._series[0]],this.getSeriesInIds=u=>u?this._series.filter(d=>u.includes(d.id)):[],this.getSeriesInUserId=u=>{if(u)return this._series.find(d=>d.userId===u)},this.getSeriesInUserIdOrIndex=(u,d)=>this.getAllSeries().filter(f=>u!=null&&u.length?f.userId&&u.includes(f.userId):!(d!=null&&d.length)||d.includes(f.getSpecIndex())),this.getComponentByIndex=(u,d)=>{const f=this._components.filter(g=>(g.specKey||g.type)===u);if(f&&f.length!==0)return f[d]},this.getComponentsByKey=u=>this._components.filter(d=>(d.specKey||d.type)===u),this.getComponentByUserId=u=>{const d=this._components.find(f=>f.userId===u);if(d)return d},this.getComponentsByType=u=>this._components.filter(d=>d.type===u),this._paddingSpec=normalizeLayoutPaddingSpec((n=e.padding)!==null&&n!==void 0?n:i.getTheme().padding),this._event=new Event$1(i.eventDispatcher,i.mode),this._dataSet=i.dataSet,this._chartData=new ChartData(this._dataSet),this._modelOption=Object.assign(Object.assign({},i),{mode:this._option.mode,map:this._idMap,getChartLayoutRect:()=>this._layoutRect,getChartViewRect:()=>this._viewRect,getChart:()=>this,globalScale:this._globalScale,onError:(o=this._option)===null||o===void 0?void 0:o.onError,disableTriggerEvent:((l=this._option)===null||l===void 0?void 0:l.disableTriggerEvent)===!0,getSeriesData:this._chartData.getSeriesData.bind(this._chartData)}),this._spec=e}created(e){this._chartData.parseData(this._spec.data),this._createGlobalScale(),this._createBackground(),this._createLayout(),e.forEachRegionInSpec(this._spec,this._createRegion.bind(this)),e.forEachSeriesInSpec(this._spec,this._createSeries.bind(this)),e.forEachComponentInSpec(this._spec,this._createComponent.bind(this),this._option.getSpecInfo())}init(){var e,i;(e=this._beforeInit)===null||e===void 0||e.call(this),this._regions.forEach(n=>n.init({})),this._series.forEach(n=>n.init({})),this._components.forEach(n=>n.init({dataSet:this._dataSet})),this._initEvent(),(i=this._initStack)===null||i===void 0||i.call(this),this.reDataFlow()}reDataFlow(){this._series.forEach(e=>{var i;return(i=e.getRawData())===null||i===void 0?void 0:i.markRunning()}),this._series.forEach(e=>e.fillData()),this.updateGlobalScaleDomain()}onResize(e,i,n=!0){const o={width:e,height:i};this._canvasRect=o,this._updateLayoutRect(this._option.viewBox),this.setLayoutTag(!0,null,n)}updateViewBox(e,i){this._option.viewBox=e,this._updateLayoutRect(e),this.setLayoutTag(!0,null,i)}_createBackground(){const e=this._spec.background;if(!e||typeof e!="object"||isValid(e.gradient))return;const i=pickWithout(e,["x","y","width","height","x1","y1","image"]);i.background=e.image,this._backgroundMark=Factory$1.createMark("group","chart-background",{model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._globalScale}),this._backgroundMark.created(),this._backgroundMark.setStyle(Object.assign(Object.assign({},i),{x:()=>this._viewBox.x1,y:()=>this._viewBox.y1,width:()=>this._viewBox.x2-this._viewBox.x1,height:()=>this._viewBox.y2-this._viewBox.y1})),this._backgroundMark.setMarkConfig({zIndex:LayoutZIndex.SeriesGroup-2})}_createRegion(e,i){if(!e)return;const{spec:n}=i,o=__rest$a(i,["spec"]),l=new e(n,Object.assign(Object.assign({},this._modelOption),o));l&&(l.created(),this._regions.push(l))}_createSeries(e,i){if(!e)return;const{spec:n}=i,o=__rest$a(i,["spec"]);let l;if(isValid(n.regionId)?l=this.getRegionsInUserId(n.regionId):isValid(n.regionIndex)&&(l=this.getRegionsInIndex([n.regionIndex])[0]),!l&&!(l=this._regions[0]))return;const u=new e(n,Object.assign(Object.assign(Object.assign({},this._modelOption),o),{type:n.type,region:l,globalScale:this._globalScale,sourceDataList:this._chartData.dataList}));u&&(u.created(),this._series.push(u),l.addSeries(u))}getSeriesById(e){return this._series.find(i=>i.id===e)}_createComponent(e,i){const n=e.createComponent(i,Object.assign(Object.assign({},this._modelOption),{type:e.type,getAllRegions:this.getAllRegions,getRegionsInIndex:this.getRegionsInIndex,getRegionsInIds:this.getRegionsInIds,getRegionsInUserIdOrIndex:this.getRegionsInUserIdOrIndex,getAllSeries:this.getAllSeries,getSeriesInIndex:this.getSeriesInIndex,getSeriesInIds:this.getSeriesInIds,getSeriesInUserIdOrIndex:this.getSeriesInUserIdOrIndex,getAllComponents:this.getComponents,getComponentByIndex:this.getComponentByIndex,getComponentByUserId:this.getComponentByUserId,getComponentsByKey:this.getComponentsByKey,getComponentsByType:this.getComponentsByType}));n&&(n.created(),this._components.push(n))}getAllComponents(){return this._components}getAllModels(){return[].concat(this.getAllSeries(),this.getAllComponents(),this.getAllRegions())}getModelInFilter(e){if(isString(e))return this.getAllModels().find(n=>n.userId===e);if(isFunction(e))return this.getAllModels().find(n=>e(n));let i=0;return this.getAllModels().find(n=>{var o;if(((o=n.specKey)!==null&&o!==void 0?o:n.type)===e.type){if(i===e.index)return!0;i++}return!1})}_createLayout(){this._updateLayoutRect(this._option.viewBox),this._initLayoutFunc()}setLayout(e){this._option.layout=e,this._initLayoutFunc()}_initLayoutFunc(){var e,i,n;if(this._layoutFunc=this._option.layout,!this._layoutFunc){let o=!1;(this._spec.zField||this._spec.series&&this._spec.series.some(u=>u.zField))&&(o=!0);const l=Factory$1.getLayoutInKey((i=(e=this._spec.layout)===null||e===void 0?void 0:e.type)!==null&&i!==void 0?i:o?"layout3d":"base");if(l){const u=new l(this._spec.layout,{onError:(n=this._option)===null||n===void 0?void 0:n.onError});this._layoutFunc=u.layoutItems.bind(u)}}}layout(e){var i,n,o,l;if((n=(i=this._option.performanceHook)===null||i===void 0?void 0:i.beforeLayoutWithSceneGraph)===null||n===void 0||n.call(i),this.getLayoutTag()){this._event.emit(ChartEvent.layoutStart,{chart:this,vchart:this._option.globalInstance}),this.onLayoutStart(e);const u=this.getLayoutElements();this._layoutFunc(this,u,this._layoutRect,this._viewBox),this._event.emit(ChartEvent.afterLayout,{elements:u,chart:this}),this.setLayoutTag(!1),this.onLayoutEnd(e),this._event.emit(ChartEvent.layoutEnd,{chart:this,vchart:this._option.globalInstance})}(l=(o=this._option.performanceHook)===null||o===void 0?void 0:o.afterLayoutWithSceneGraph)===null||l===void 0||l.call(o)}onLayoutStart(e){this.getAllModels().forEach(i=>i.onLayoutStart(this._layoutRect,this._viewRect,e))}onLayoutEnd(e){this.getAllModels().forEach(i=>{i.modelType!=="series"&&i.onLayoutEnd(e)})}onEvaluateEnd(e){[...this._components,...this._regions,...this._series].forEach(i=>i.onEvaluateEnd(e))}getLayoutElements(){return this.getAllModels().map(e=>e.layout).filter(e=>!!e)}getModelById(e){const i=this._idMap.get(e);if(i&&i instanceof BaseModel)return i}getModelByUserId(e){const i=this.getSeriesInUserId(e);if(i)return i;const n=this.getRegionsInUserId(e);return n||this.getComponentByUserId(e)||void 0}getAllMarks(){return Array.from(this._idMap.values()).filter(e=>e&&e instanceof BaseMark)}getMarkById(e){const i=this._idMap.get(e);if(i&&i instanceof BaseMark)return i}getMarkByUserName(e){return this.getAllMarks().filter(i=>i.name&&i.name===e)}updateData(e,i,n=!0,o){const l=this._dataSet.getDataView(e);l&&(l.markRunning(),l.parseNewData(i,o)),n&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(u=>u.onDataUpdate())}updateFullData(e,i=!0){array(e).forEach(n=>{const o=this._dataSet.getDataView(n.id);o&&o.markRunning()}),array(e).forEach(n=>{const o=this._dataSet.getDataView(n.id);o&&updateDataViewInData(o,n,!0)}),i&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(n=>n.onDataUpdate())}onRender(e){}setCanvasRect(e,i){this._canvasRect={width:e,height:i}}getCanvasRect(){return this._canvasRect||(this._canvasRect=calculateChartSize(this._spec,this._option,{width:DEFAULT_CHART_WIDTH,height:DEFAULT_CHART_HEIGHT})),this._canvasRect}getSeriesData(e,i){return this._chartData.getSeriesData(e,i)}_transformSpecScale(){var e;const i=this._spec.scales?[...this._spec.scales]:[];let n=i.find(l=>l.id==="color");const o=this.getColorScheme();if(!n&&(n={type:"ordinal",id:"color",domain:null,range:null},i.push(n),this._spec.color)){const l=this._spec.color;if(isArray(l))n.range=l;else{const u=l;Object.prototype.hasOwnProperty.call(u,"type")&&(n.type=u.type),Object.prototype.hasOwnProperty.call(u,"domain")&&(n.domain=u.domain),Object.prototype.hasOwnProperty.call(u,"range")&&(n.range=u.range),Object.prototype.hasOwnProperty.call(u,"specified")&&(n.specified=u.specified)}}return!((e=n.range)===null||e===void 0)&&e.length||(n.range=getDataScheme(o),n.rangeTheme=!0),i}_createGlobalScale(){this._globalScale=new GlobalScale(this._transformSpecScale(),this),this._modelOption.globalScale=this._globalScale}updateGlobalScaleDomain(){const e=new Set;this._series.forEach(n=>{const o=n.getSeriesKeys();o&&o.forEach(l=>e.add(l))});const i=Array.from(e);this._globalScale.updateScaleDomain(i)}updateGlobalScale(e){mergeUpdateResult(e,this._globalScale.updateSpec(this._transformSpecScale()))}updateGlobalScaleTheme(){const e=this._globalScale.getScaleSpec("color"),i=this.getColorScheme();e.rangeTheme&&(e.range=getDataScheme(i),this._globalScale.getScale("color").range(e.range))}_getSpecKeys(e){const i={width:!0,height:!0};return Object.keys(e).filter(n=>!i[n]).sort()}updateSpec(e){const i={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(this.setLayoutTag(!0,null,!1),e.type!==this.type)return i.reMake=!0,i;const n=this._getSpecKeys(this._spec),o=this._getSpecKeys(e);if(!isEqual(n,o))return i.reMake=!0,i;for(let u=0;u<n.length;u++){const d=n[u];if(isArray(this._spec[d])&&this._spec[d].length!==array(e[d]).length)return i.reMake=!0,i}const l=this._spec;return this._spec=e,this.updateChartConfig(i,l),i.reMake?i:(this.updateGlobalScale(i),i.reMake?i:(this.updateRegionSpec(i),i.reMake?i:(this.updateComponentSpec(i),i.reMake||(this.updateSeriesSpec(i),i.reMake||(this.reInit(),this.updateDataSpec(),this.updateGlobalScaleDomain())),i)))}updateChartConfig(e,i){var n,o;this._paddingSpec=normalizeLayoutPaddingSpec((n=this._spec.padding)!==null&&n!==void 0?n:(o=this._option)===null||o===void 0?void 0:o.getTheme().padding),this._updateLayoutRect(this._viewBox)}updateDataSpec(){this._spec.data&&this._chartData.updateData(this._spec.data,!1,!0)}updateRegionSpec(e){var i;!((i=this._spec)===null||i===void 0)&&i.region&&(this._spec.region.length===this._regions.length?this._regions.forEach(n=>{mergeUpdateResult(e,n.updateSpec(this._spec.region[n.getSpecIndex()]))}):e.reMake=!0)}updateComponentSpec(e){const i={},n={[ComponentTypeEnum.title]:!0,[ComponentTypeEnum.brush]:!0,[ComponentTypeEnum.mapLabel]:!0};this._components.forEach(l=>{var u,d;if(l.type===ComponentTypeEnum.label||l.type===ComponentTypeEnum.totalLabel)return;n[l.type]&&(n[l.type]=!1);const f=l.specKey||l.type,g=(u=this._spec[f])!==null&&u!==void 0?u:{};isArray(g)?(i[f]=i[f]||{specCount:g.length,componentCount:0},i[f].componentCount++,mergeUpdateResult(e,l.updateSpec((d=g[l.getSpecIndex()])!==null&&d!==void 0?d:{},g))):mergeUpdateResult(e,l.updateSpec(g))});for(const l in i)if(Object.prototype.hasOwnProperty.call(i,l)){const u=i[l];u.componentCount!==u.specCount&&(e.reMake=!0)}const o=l=>l&&l.visible!==!1;Object.keys(n).forEach(l=>{if(n[l]){const u=this._spec[l];(isArray(u)?u.some(o):o(u))&&(e.reMake=!0)}})}updateSeriesSpec(e){this._spec.series.length===this._series.length?this._series.forEach(i=>{const n=this._spec.series[i.getSpecIndex()];mergeUpdateResult(e,i.updateSpec(n))}):e.reMake=!0}getCanvas(){var e,i;return(i=(e=this.getCompiler())===null||e===void 0?void 0:e.getCanvas())!==null&&i!==void 0?i:null}_updateLayoutRect(e){let i=this.getCanvasRect();if(e){this._viewBox=e;const{x1:n=0,y1:o=0,x2:l,y2:u}=e;i={width:l-n,height:u-o}}else this._viewBox={x1:0,y1:0,x2:i.width,y2:i.height};this._viewRect=i,this.padding=calcPadding(this._paddingSpec,i,i),this._layoutRect.width=i.width-this.padding.left-this.padding.right,this._layoutRect.height=i.height-this.padding.top-this.padding.bottom,this._layoutRect.x=this.padding.left,this._layoutRect.y=this.padding.top,this._event.emit(ChartEvent.layoutRectUpdate,{chart:this})}setCurrentTheme(){this.updateChartConfig({change:!0,reMake:!1},this._spec),this.setLayoutTag(!0,null,!1),this.updateGlobalScaleTheme(),this.reInit()}reInit(){[...this._regions,...this._series,...this._components].forEach(e=>{const i=e.getSpecInfo();i&&i.spec&&e.reInit(i.spec)})}clear(){this.getAllModels().forEach(e=>{var i;return(i=e.clear)===null||i===void 0?void 0:i.call(e)})}compile(){this.compileBackground(),this.compileLayout(),this.compileRegions(),this.compileSeries(),this.compileComponents()}afterCompile(){this.getAllRegions().forEach(e=>{var i;(i=e.afterCompile)===null||i===void 0||i.call(e)}),this.getAllSeries().forEach(e=>{var i;(i=e.afterCompile)===null||i===void 0||i.call(e)}),this.getAllComponents().forEach(e=>{var i;(i=e.afterCompile)===null||i===void 0||i.call(e)})}compileLayout(){const{width:e,height:i}=this.getCanvasRect();this.getCompiler().setSize(e,i)}compileBackground(){var e;this._backgroundMark&&(this._backgroundMark.compile({context:{model:this}}),(e=this._backgroundMark.getProduct())===null||e===void 0||e.layout(()=>{}))}compileRegions(){var e,i,n,o;(i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeRegionCompile)===null||i===void 0||i.call(e),this.getAllRegions().forEach(l=>{l.compile()}),(o=(n=this._option.performanceHook)===null||n===void 0?void 0:n.afterRegionCompile)===null||o===void 0||o.call(n)}compileSeries(){var e,i,n,o;(i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeSeriesCompile)===null||i===void 0||i.call(e),this.getAllSeries().forEach(l=>{l.compile()}),(o=(n=this._option.performanceHook)===null||n===void 0?void 0:n.afterSeriesCompile)===null||o===void 0||o.call(n)}compileComponents(){var e,i,n,o;(i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeComponentCompile)===null||i===void 0||i.call(e),this.getAllComponents().forEach(l=>{l.compile()}),(o=(n=this._option.performanceHook)===null||n===void 0?void 0:n.afterComponentCompile)===null||o===void 0||o.call(n)}release(){[...this._components,...this._regions,...this._series].forEach(e=>{e.beforeRelease()}),super.release(),this.clear(),[...this._components,...this._regions,...this._series].forEach(e=>{e.release()}),this._components=this._regions=this._series=[],this._spec={},this._dataSet=this._globalScale=this._layoutFunc=null,this._layoutTag=!1,this._idMap.clear()}onLayout(e){const i=e.rootMark;this.layout({group:i,srView:e})}updateState(e,i){const n=this.getAllSeries();for(const o in e){if(isEmpty(e[o]))continue;const l=e[o];let u={stateValue:o};u=isFunction(l.filter)?Object.assign({filter:l.filter},u):Object.assign(Object.assign({},l.filter),u),l.level&&(u.level=l.level),n.forEach(d=>{d.getMarks().forEach(f=>{f.stateStyle[o]&&(i&&!i(d,f,o)||(f.state.changeStateInfo(u),f.updateMarkState(o)))})})}}setSelected(e,i,n){this._setStateInDatum(STATE_VALUE_ENUM.STATE_SELECTED,!0,e,i,n)}setHovered(e,i,n){this._setStateInDatum(STATE_VALUE_ENUM.STATE_HOVER,!0,e,i,n)}clearState(e){this.getAllRegions().forEach(i=>{i.interaction.clearEventElement(e,!0),i.interaction.resetInteraction(e,null)})}clearAllStates(){this.getAllRegions().forEach(e=>{e.interaction.clearAllEventElement(),e.interaction.resetAllInteraction()})}clearSelected(){this.clearState(STATE_VALUE_ENUM.STATE_SELECTED)}clearHovered(){this.clearState(STATE_VALUE_ENUM.STATE_HOVER)}_initEvent(){[ChartEvent.dataZoomChange,ChartEvent.scrollBarChange].forEach(e=>{this._event.on(e,({value:i})=>{this._disableMarkAnimation(["exit","update"]);const n=()=>{this._enableMarkAnimation(["exit","update"]),this._event.off(HOOK_EVENT.AFTER_MARK_RENDER_END,n)};this._event.on(HOOK_EVENT.AFTER_MARK_RENDER_END,n)})})}_enableMarkAnimation(e){this.getAllMarks().forEach(i=>{const n=i.getProduct();n&&n.animate&&n.animate.enableAnimationState(e)})}_disableMarkAnimation(e){this.getAllMarks().forEach(i=>{const n=i.getProduct();n&&n.animate&&n.animate.disableAnimationState(e)})}_setStateInDatum(e,i,n,o,l){const u=(n=n?array(n):null)?Object.keys(n[0]):null;this.getRegionsInQuerier(l).forEach(d=>{n?(d.getSeries().forEach(f=>{f.getMarks().forEach(g=>{if(g.getProduct()&&(!o||isFunction(o)&&o(f,g))){const _=g.getProduct().isCollectionMark(),y=g.getProduct().elements;let b=[];if(_)b=y.filter(S=>{const v=S.getDatum();n.every((A,x)=>u.every(T=>A[T]==v[x][T]))});else if(n.length>1){const S=n.slice();b=y.filter(v=>{if(S.length===0)return!1;const A=v.getDatum(),x=S.findIndex(T=>u.every(C=>T[C]==A[C]));return x>=0&&(S.splice(x,1),!0)})}else{const S=y.find(v=>u.every(A=>n[0][A]==v.getDatum()[A]));S&&(b=[S])}b.forEach(S=>{d.interaction.startInteraction(e,S)})}})}),i&&d.interaction.reverseEventElement(e)):d.interaction.clearEventElement(e,!0)})}setDimensionIndex(e,i){var n,o,l,u;let d=null;Array.from(this._event.getComposedEventMap().values()).forEach(g=>{const{eventType:_,event:y}=g;if(_===DimensionEventEnum.dimensionHover||_===DimensionEventEnum.dimensionClick){const b=y.dispatch(e,i);b!=null&&b.length&&(d=b)}});const f=isNil(e)||!d||d.every(g=>isDiscrete(g.axis.getScale().type)&&isNil(g.index));if(i.tooltip!==!1){const g=this.getComponentsByType(ComponentTypeEnum.tooltip)[0];if(g!=null&&g.getVisible())if(f)(o=(n=g).hideTooltip)===null||o===void 0||o.call(n);else{const _={};d.forEach(y=>{const{axis:b,value:S,data:v}=y,A=b.getOrient()==="left"||b.getOrient()==="right";v.forEach(x=>{var T,C,E;const P=A?x.series.fieldY[0]:x.series.fieldX[0];_[P]=(E=(C=(T=x.datum)===null||T===void 0?void 0:T[0])===null||C===void 0?void 0:C[P])!==null&&E!==void 0?E:S})}),g.showTooltip(_,i.showTooltipOption)}}if(i.crosshair!==!1){const g=this.getComponentsByType(ComponentTypeEnum.cartesianCrosshair)[0];g&&g.clearAxisValue&&g.setAxisValue&&(f?((l=g.clearAxisValue)===null||l===void 0||l.call(g),(u=g.hide)===null||u===void 0||u.call(g)):d.forEach(_=>{const{axis:y,value:b}=_;g.clearAxisValue(),g.setAxisValue(b,y),g.layoutByValue()}))}}getColorScheme(){var e,i;return(i=(e=this._option).getTheme)===null||i===void 0?void 0:i.call(e).colorScheme}}const getRelatedRegionInfo=(r,e)=>{var i;const n=r.spec,{regionId:o,regionIndex:l}=n;if(isValid(o)){const u=array(o);return(i=e.region)===null||i===void 0?void 0:i.filter(({spec:d})=>u.includes(d.id))}if(isValid(l))return array(l).map(u=>{var d;return(d=e.region)===null||d===void 0?void 0:d[u]}).filter(isValid)},getRelatedSeriesInfo=(r,e)=>{var i;const n=r.spec,{seriesId:o,seriesIndex:l}=n;if(isValid(o)){const u=array(o);return(i=e.series)===null||i===void 0?void 0:i.filter(({spec:d})=>u.includes(d.id))}if(isValid(l))return array(l).map(u=>{var d;return(d=e.series)===null||d===void 0?void 0:d[u]}).filter(isValid)};class BaseChartSpecTransformer{constructor(e){this._option=e,this.type=e.type,this.seriesType=e.seriesType}initChartSpec(e){return this.transformSpec(e),this.transformModelSpec(e)}transformSpec(e){e.region&&e.region.length!==0||(e.region=[{}]),e.tooltip===void 0&&(e.tooltip={}),isValid(e.stackInverse)&&e.region.forEach(i=>{!isValid(i.stackInverse)&&(i.stackInverse=e.stackInverse)}),isValid(e.stackSort)&&e.region.forEach(i=>{!isValid(i.stackSort)&&(i.stackSort=e.stackSort)})}generateTransform(e,i){return(n,o,l)=>{const{spec:u,specPath:d,specInfoPath:f,type:g}=o,_=new n.transformerConstructor(Object.assign(Object.assign({},this._option),{type:g})),y=_.transformSpec(u,e,l),b=Object.assign(Object.assign({},o),y);i?b.theme=_.getTheme(u,e):setProperty(e,d,y.spec),setProperty(l,f??d,b)}}transformModelSpec(e){return this.createSpecInfo(e,this.generateTransform(e,!1))}createSpecInfo(e,i){var n,o;i||(i=this.generateTransform(e,!0));const l={};return this.forEachRegionInSpec(e,i,l),this.forEachSeriesInSpec(e,i,l),(n=l.series)===null||n===void 0||n.forEach((u,d)=>{var f,g;const _=((g=(f=getRelatedRegionInfo(u,l))!==null&&f!==void 0?f:l.region)!==null&&g!==void 0?g:[])[0];_&&(_.seriesIndexes||(_.seriesIndexes=[]),_.seriesIndexes.push(d),u.regionIndexes=_.regionIndexes.slice())}),this.forEachComponentInSpec(e,i,l),Object.values((o=l.component)!==null&&o!==void 0?o:{}).forEach(u=>u.forEach((d,f)=>{var g,_,y;if(d){if(!d.regionIndexes){const b=(_=(g=getRelatedRegionInfo(d,l))!==null&&g!==void 0?g:l.region)!==null&&_!==void 0?_:[];d.regionIndexes=b.map(S=>S.regionIndexes[0])}if(!d.seriesIndexes){const b=getRelatedSeriesInfo(d,l);if(b)d.seriesIndexes=b.map(({seriesIndexes:S})=>S[0]);else{const S=new Set;((y=d.regionIndexes)!==null&&y!==void 0?y:[]).forEach(v=>{var A,x;const T=(A=l.region)===null||A===void 0?void 0:A[v];(x=T==null?void 0:T.seriesIndexes)===null||x===void 0||x.forEach(C=>S.add(C))}),d.seriesIndexes=Array.from(S)}}}})),l}_isValidSeries(e){return!0}_getDefaultSeriesSpec(e,i,n){var o,l,u,d;const f={dataKey:e.dataKey,hover:e.hover,select:e.select,label:e.label,seriesStyle:e.seriesStyle,animation:(o=e.animation)!==null&&o!==void 0?o:this._option.animation,animationThreshold:(l=e.animationThreshold)!==null&&l!==void 0?l:(d=(u=this._option).getTheme)===null||d===void 0?void 0:d.call(u).animationThreshold,animationAppear:e.animationAppear,animationDisappear:e.animationDisappear,animationEnter:e.animationEnter,animationUpdate:e.animationUpdate,animationExit:e.animationExit,animationNormal:e.animationNormal,animationState:e.animationState,extensionMark:e.extensionMark,large:e.large,largeThreshold:e.largeThreshold,progressiveStep:e.progressiveStep,progressiveThreshold:e.progressiveThreshold,background:e.seriesBackground,invalidType:e.invalidType,seriesField:e.seriesField,morph:e.morph,interactions:e.interactions},g=this.seriesType;return g&&(f.type=g,f[g]=e[g]),i&&i.length&&i.forEach(_=>{f[_]=e[_]}),n&&n.length&&n.forEach(_=>{f[_]=e[_]}),f}forEachRegionInSpec(e,i,n){var o;return((o=e.region)!==null&&o!==void 0?o:[]).map((l,u)=>i(Factory$1.getRegionInType("region"),{spec:l,specPath:["region",u],type:"region",regionIndexes:[u]},n))}forEachSeriesInSpec(e,i,n){var o;return((o=e.series)!==null&&o!==void 0?o:[]).map((l,u)=>i(Factory$1.getSeriesInType(l.type),{spec:l,specPath:["series",u],type:l.type,seriesIndexes:[u]},n))}forEachComponentInSpec(e,i,n){var o,l,u;const d=[],f=Factory$1.getComponents();let g,_,y,b;const S=[];for(let A=0;A<f.length;A++){const{cmp:x,alwaysCheck:T}=f[A];x.type.startsWith(ComponentTypeEnum.cartesianAxis)?g=x:x.type.startsWith(ComponentTypeEnum.polarAxis)?_=x:x.type===ComponentTypeEnum.geoCoordinate?y=x:(T||e[(o=x.specKey)!==null&&o!==void 0?o:x.type])&&(x.type===ComponentTypeEnum.tooltip?b=x:S.push(x))}let v=!1;if(g){const A=g.getSpecInfo(e,n);(A==null?void 0:A.length)>0&&(v=!0,A.forEach(x=>{const T=Factory$1.getComponentInKey(x.type);d.push(i(T,x,n))}))}if(_&&!v){const A=_.getSpecInfo(e,n);(A==null?void 0:A.length)>0&&(v=!0,A.forEach(x=>{const T=Factory$1.getComponentInKey(x.type);d.push(i(T,x,n))}))}return y&&!v&&((l=y.getSpecInfo(e,n))===null||l===void 0||l.forEach(A=>{d.push(i(y,A,n))})),S.forEach(A=>{var x;(x=A.getSpecInfo?A.getSpecInfo(e,n):getSpecInfo(e,A.specKey,A.type))===null||x===void 0||x.forEach(T=>{d.push(i(A,T,n))})}),b&&((u=getSpecInfo(e,b.specKey,b.type))===null||u===void 0||u.forEach(A=>{d.push(i(b,A,n))})),d}transformSeriesSpec(e){const i=this._getDefaultSeriesSpec(e);e.series&&e.series.length!==0?e.series.forEach(n=>{this._isValidSeries(n.type)&&Object.keys(i).forEach(o=>{o in n||(n[o]=i[o])})}):e.series=[i]}_findBandAxisBySeries(e,i,n){const o=(e==null?void 0:e.direction)==="horizontal"?["left","right"]:["top","bottom"];return n.find(l=>{if(!o.includes(l.orient))return!1;if(isValid(l.seriesId)){if(array(l.seriesId).includes(e==null?void 0:e.id))return!0}else if(isValid(l.seriesIndex)){if(array(l.seriesIndex).includes(i))return!0}else if(l.type==="band")return!0;return!0})}_applyAxisBandSize(e,i,n){const{barMaxWidth:o,barMinWidth:l,barWidth:u,barGapInGroup:d}=n;let f=!1;isNumber(l)?(e.minBandSize=l,f=!0):isNumber(u)?(e.minBandSize=u,f=!0):isNumber(o)&&(e.minBandSize=o,f=!0),f&&(e.bandSizeLevel=Number.MAX_VALUE,e.bandSizeExtend={extend:i,gap:isArray(d)?d[d.length-1]:d})}}class CartesianChartSpecTransformer extends BaseChartSpecTransformer{needAxes(){return!0}_isValidSeries(e){return!this.seriesType||e===this.seriesType}_getDefaultSeriesSpec(e,i){return super._getDefaultSeriesSpec(e,["xField","yField","zField","direction","stack","percent","stackOffsetSilhouette","totalLabel","sortDataByAxis"],i)}transformSpec(e){super.transformSpec(e),super.transformSeriesSpec(e),this._transformAxisSpec(e)}_setDefaultXAxisSpec(e){return{orient:"bottom"}}_setDefaultYAxisSpec(e){return{orient:"left"}}_setDefaultZAxisSpec(e){return{orient:"z"}}_transformAxisSpec(e){if(this.needAxes()){e.axes||(e.axes=[]);const i={x:!1,y:!1,z:!1};e.axes.forEach(n=>{const{orient:o}=n;let l=null;o!=="top"&&o!=="bottom"||(i.x=!0,l=this._setDefaultXAxisSpec(e)),o!=="left"&&o!=="right"||(i.y=!0,l=this._setDefaultYAxisSpec(e)),o==="z"&&(i.z=!0,l=this._setDefaultZAxisSpec(e)),l&&Object.keys(l).forEach(u=>{isNil(n[u])&&(n[u]=l[u])}),get(n,"trimPadding")&&mergeSpec(n,getTrimPaddingConfig(this.type,e))}),i.x||e.axes.push(this._setDefaultXAxisSpec(e)),i.y||e.axes.push(this._setDefaultYAxisSpec(e)),e.zField&&!i.z&&e.axes.push(this._setDefaultZAxisSpec(e))}}}class LineChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){var i;const n=super._getDefaultSeriesSpec(e,["point","line","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","lineLabel"]);return n.seriesMark=(i=e.seriesMark)!==null&&i!==void 0?i:"line",n}transformSpec(e){super.transformSpec(e),setDefaultCrosshairForCartesianChart(e)}}const stackSplit=(r,e)=>{const i={nodes:{}},{fields:n}=e;if(!(n!=null&&n.length))return i;const o=n.length-1;let l,u,d=i;return r.forEach(f=>{f.latestData&&f.latestData.forEach(g=>{d=i;for(let _=0;_<n.length;_++){const y=n[_],b=g[y];if(isNil(b))break;d.groupField=y,d.nodes[b]||(_===o?d.nodes[b]={values:[]}:(l={nodes:{}},d.nodes[b]=l)),_===o?(u=d.nodes[b],u.values.push(g)):d=d.nodes[b]}})}),i};class Stack{constructor(e,i){this.stackRegion=({model:n})=>{var o;const l=n.getSeries();if(!l.some(_=>_.getStack()))return;const u=l.some(_=>{var y,b;return(b=(y=_.getSpec())===null||y===void 0?void 0:y.totalLabel)===null||b===void 0?void 0:b.visible}),d=u||l.some(_=>_.getPercent()),f=l.some(_=>_.getStackOffsetSilhouette()),g=getRegionStackGroup(n,!0);for(const _ in g)for(const y in g[_].nodes)stack(g[_].nodes[y],n.getStackInverse(),d,u);if(f)for(const _ in g)for(const y in g[_].nodes)stackOffsetSilhouette(g[_].nodes[y]);u&&n.getSeries().forEach(_=>{const y=_.getStackData(),b=_.getStackValue(),S=_.getStackValueField();y&&S&&stackTotal(g[b],S)}),!((o=this._options)===null||o===void 0)&&o.afterStackRegion&&this._options.afterStackRegion(n,g)},this._chart=e,this._options=i}init(){this._chart.getAllRegions().forEach(e=>{e.event.on(ChartEvent.regionSeriesDataFilterOver,{filter:({model:i})=>(i==null?void 0:i.id)===e.id},this.stackRegion)})}stackAll(){this._chart.getAllRegions().forEach(e=>{this.stackRegion({model:e})})}}class StackChartMixin{_beforeInit(){this._dataSet&&registerDataSetInstanceTransform(this._dataSet,"stackSplit",stackSplit)}_initStack(){this._stack=new Stack(this),this._stack.init()}}class LineChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=LineChartSpecTransformer,this.type="line",this.seriesType=SeriesTypeEnum.line}}LineChart.type="line",LineChart.seriesType=SeriesTypeEnum.line,LineChart.transformerConstructor=LineChartSpecTransformer,mixin(LineChart,StackChartMixin);const registerLineChart=()=>{registerLineSeries(),Factory$1.registerChart(LineChart.type,LineChart)};class AreaMark extends BaseLineMark{constructor(){super(...arguments),this.type=AreaMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}_getIgnoreAttributes(){return[]}}AreaMark.type="area";const registerAreaMark=()=>{Factory$1.registerMark(AreaMark.type,AreaMark),registerAreaGraphic(),registerVGrammarLineOrAreaAnimation()};class AreaSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this._getSeriesStyle=(e,i,n)=>{var o,l,u,d;for(const f of array(i)){let g=(o=this.series.getSeriesStyle(e))===null||o===void 0?void 0:o(f);if(g!==!1||f!=="fill"&&f!=="stroke"||(g=f==="fill"?(u=(l=this.series.getSeriesStyle(e))===null||l===void 0?void 0:l("stroke"))===null||u===void 0?void 0:u[0]:(d=this.series.getSeriesStyle(e))===null||d===void 0?void 0:d("fill")),isValid(g))return g}return n}}}const areaSeriesMark=Object.assign(Object.assign(Object.assign({},baseSeriesMark),lineLikeSeriesMark),{area:{name:"area",type:"area"}}),registerAreaSeriesAnimation=()=>{registerAreaAnimation(),registerLineAnimation(),registerScaleInOutAnimation()};class AreaSeriesSpecTransformer extends LineLikeSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(e){var i,n,o;const l=((i=e.point)===null||i===void 0?void 0:i.visible)!==!1&&((o=(n=e.point)===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.visible)!==!1;this._addMarkLabelSpec(e,u=>{const d=u.position==="inside-middle";return!l||d?"area":"point"}),this._addMarkLabelSpec(e,"area","areaLabel","initLineLabelMarkStyle",void 0,!0)}_transformSpecAfterMergingTheme(e,i,n){var o,l,u,d,f;super._transformSpecAfterMergingTheme(e,i,n);const{area:g={},line:_={},seriesMark:y}=e,b=g.visible!==!1&&((o=g.style)===null||o===void 0?void 0:o.visible)!==!1,S=_.visible!==!1&&((l=_.style)===null||l===void 0?void 0:l.visible)!==!1;g.support3d=!(!g.support3d&&!_.support3d),g.zIndex=isValid(g.zIndex)||isValid(_.zIndex)?Math.max((u=g.zIndex)!==null&&u!==void 0?u:0,(d=_.zIndex)!==null&&d!==void 0?d:0):void 0,g.style&&delete g.style.stroke,g.state&&Object.keys(g.state).forEach(x=>{"style"in g.state[x]?delete g.state[x].style.stroke:delete g.state[x].stroke});let v=g,A=_;(y==="line"||S&&!b)&&(v=_,A=g),g.style=mergeSpec({},A.style,v.style),g.state=mergeSpec({},A.state,v.state),g.interactive===!1&&(g.style.fillPickable=!1),_.interactive===!1&&(_.style.strokePickable=!1),g.interactive=!(!g.interactive&&(f=_.interactive)!==null&&f!==void 0&&!f),e.area=g,e.line=_}}class AreaSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.area,this.transformerConstructor=AreaSeriesSpecTransformer,this._sortDataByAxis=!1}initMark(){var e;const i={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},n=this._spec.area||{},o=(e=this._spec.seriesMark)!==null&&e!==void 0?e:"area",l=this._isAreaVisible()||this._isLineVisible();this._areaMark=this._createMark(AreaSeries.mark.area,{groupKey:this._seriesField,isSeriesMark:l&&o!=="point",stateSort:n.stateSort},Object.assign(Object.assign({},i),{morphElementKey:this.getDimensionField()[0],setCustomizedShape:n.customShape})),this.initSymbolMark(i,o==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initSymbolMarkStyle()}initAreaMarkStyle(){var e,i,n,o,l;const u=(n=(i=(e=this.getSpec().area)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.curveType)!==null&&n!==void 0?n:(l=(o=this.getSpec().line)===null||o===void 0?void 0:o.style)===null||l===void 0?void 0:l.curveType,d=u===DEFAULT_SMOOTH_INTERPOLATE?this._direction==="horizontal"?"monotoneY":"monotoneX":u,f=this._areaMark;if(f){const g=this._isAreaVisible(),_=this._isLineVisible();g||_?f.setVisible(!0):f.setVisible(!1),this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:y=>{var b,S;return valueInScaleRange(this.dataToPositionX1(y),(S=(b=this._xAxisHelper)===null||b===void 0?void 0:b.getScale)===null||S===void 0?void 0:S.call(b,0))},y:this.dataToPositionY.bind(this),y1:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,orient:this._direction},"normal",AttributeLevel.Series):this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:this.dataToPositionX.bind(this),y1:y=>{var b,S;return valueInScaleRange(this.dataToPositionY1(y),(S=(b=this._yAxisHelper)===null||b===void 0?void 0:b.getScale)===null||S===void 0?void 0:S.call(b,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",AttributeLevel.Series),this.setMarkStyle(f,{fill:!!g&&this.getColorAttribute(),stroke:!!_&&this.getColorAttribute()},"normal",AttributeLevel.Series),this._invalidType!=="zero"&&this.setMarkStyle(f,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",AttributeLevel.Series),this.setMarkStyle(f,{curveType:d},"normal",AttributeLevel.Built_In),Object.keys(f.stateStyle).forEach(y=>{f.stateStyle[y].stroke&&f.setPostProcess("stroke",b=>[b,!1,!1,!1],y)})}}initAnimation(){var e,i,n,o;const l={direction:this.direction},u=(e=this._spec.animationAppear)===null||e===void 0?void 0:e.preset;if(this._lineMark&&this._lineMark.setAnimationConfig(animationConfig((i=Factory$1.getAnimationInKey("line"))===null||i===void 0?void 0:i(l,u),userAnimationConfig("line",this._spec,this._markAttributeContext))),this._areaMark&&this._areaMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("area"))===null||n===void 0?void 0:n(l,u),userAnimationConfig("area",this._spec,this._markAttributeContext))),this._symbolMark){const d=getGroupAnimationParams(this);this._symbolMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("scaleInOut"))===null||o===void 0?void 0:o(),userAnimationConfig("point",this._spec,this._markAttributeContext),d))}}_isAreaVisible(){var e;const i=this._spec.area||{};return i.visible!==!1&&((e=i.style)===null||e===void 0?void 0:e.visible)!==!1}_isLineVisible(){var e;const i=this._spec.line||{};return i.visible!==!1&&((e=i.style)===null||e===void 0?void 0:e.visible)!==!1}initTooltip(){this._tooltipHelper=new AreaSeriesTooltipHelper(this);const{group:e,mark:i}=this._tooltipHelper.activeTriggerSet;this._areaMark&&e.add(this._areaMark),this._lineMark&&e.add(this._lineMark),this._symbolMark&&(i.add(this._symbolMark),e.add(this._symbolMark))}viewDataStatisticsUpdate(e){super.viewDataStatisticsUpdate(e),this.encodeDefined(this._areaMark,"defined")}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}onLayoutEnd(e){super.onLayoutEnd(e),this.reCompileSampling()}getSeriesStyle(e){return i=>{var n,o,l,u,d;const f=(n=this._spec.seriesMark)!==null&&n!==void 0?n:"area";let g=(l=(o=this._seriesMark)===null||o===void 0?void 0:o.getAttribute(i,e))!==null&&l!==void 0?l:void 0;return i!=="fill"||g&&f!=="line"||(i="stroke",g=(d=(u=this._seriesMark)===null||u===void 0?void 0:u.getAttribute(i,e))!==null&&d!==void 0?d:void 0),i==="stroke"&&isArray(g)?g[0]:g}}}AreaSeries.type=SeriesTypeEnum.area,AreaSeries.mark=areaSeriesMark,AreaSeries.transformerConstructor=AreaSeriesSpecTransformer,mixin(AreaSeries,LineLikeSeriesMixin);const registerAreaSeries=()=>{registerSampleTransform(),registerMarkOverlapTransform(),registerLineMark(),registerAreaMark(),registerSymbolMark(),registerAreaSeriesAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(AreaSeries.type,AreaSeries)};class AreaChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["point","line","area","seriesMark","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","areaLabel"])}transformSpec(e){super.transformSpec(e),setDefaultCrosshairForCartesianChart(e)}}class AreaChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=AreaChartSpecTransformer,this.type="area",this.seriesType=SeriesTypeEnum.area}}AreaChart.type="area",AreaChart.seriesType=SeriesTypeEnum.area,AreaChart.transformerConstructor=AreaChartSpecTransformer,mixin(AreaChart,StackChartMixin);const registerAreaChart=()=>{registerAreaSeries(),Factory$1.registerChart(AreaChart.type,AreaChart)};function barGrowOption(r,e=!0){return(i,n,o)=>{const l=r.direction==="vertical"?r.yField:r.xField,u=i==null?void 0:i[l];return r.direction==="vertical"?{overall:e&&r.growFrom(),orient:u>0?"negative":"positive"}:{overall:!!e&&r.growFrom(),orient:u>0?"positive":"negative"}}}const barGrowIn=(r,e=!0)=>({type:r.direction==="horizontal"?"growWidthIn":"growHeightIn",options:barGrowOption(r,e)}),barGrowOut=(r,e=!0)=>({type:r.direction==="horizontal"?"growWidthOut":"growHeightOut",options:barGrowOption(r,e)}),Appear_FadeIn$7={type:"fadeIn"},Appear_ScaleIn$1={type:"growCenterIn"};function barPresetAnimation(r,e){if(e===!1)return{};switch(e){case"fadeIn":return Appear_FadeIn$7;case"scaleIn":return Appear_ScaleIn$1;default:return barGrowIn(r)}}const registerBarAnimation=()=>{Factory$1.registerAnimation("bar",(r,e)=>({appear:barPresetAnimation(r,e),enter:barGrowIn(r,!1),exit:barGrowOut(r,!1),disappear:barGrowOut(r)}))},registerBar3dAnimation=()=>{Factory$1.registerAnimation("bar3d",(r,e)=>({appear:barPresetAnimation(r,e),enter:barGrowIn(r,!1),exit:barGrowOut(r,!1),disappear:barGrowOut(r)}))};class RectMark extends BaseMark{constructor(){super(...arguments),this.type=RectMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,lineWidth:0})}}RectMark.type="rect";const registerRectMark=()=>{Factory$1.registerMark(RectMark.type,RectMark),registerRectGraphic(),registerVGrammarRectAnimation()},barSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{bar:{name:"bar",type:"rect"},barBackground:{name:"barBackground",type:"rect"}}),bar3dSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{bar3d:{name:"bar3d",type:"rect3d"}});function stackWithMinHeight(r,e,i){var n,o;if(r.values.length>0){let l;if(r.sortDatums.length){let u=r.sortDatums;e&&(u=r.sortDatums.slice().reverse());for(let d=0;d<u.length;d++)l=computeOneDatumY(u[d].datum,l,u[d].series,i,(o=(n=u[d].series[i.axisHelper]).getScale)===null||o===void 0?void 0:o.call(n,0),d===0)}else{let u=r.series;e&&(u=u.slice().reverse()),u.forEach(({s:d,values:f},g)=>{var _,y;const b=(y=(_=d[i.axisHelper]).getScale)===null||y===void 0?void 0:y.call(_,0);for(let S=0;S<f.length;S++){const v=f[e?f.length-1-S:S];l=computeOneDatumY(v,l,d,i,b,S===0&&g===0)}})}}for(const l in r.nodes)stackWithMinHeight(r.nodes[l],e,i)}function computeOneDatumY(r,e,i,n,o,l){const u=i.getSpec().barMinHeight,d=i[n.axisHelper].isInverse(),f=valueInScaleRange(i[n.startMethod](r),o);let g=valueInScaleRange(i[n.endMethod](r),o);l&&(e=f);let _=Math.abs(f-g);_<u&&(_=u);let y=1;return g<f?y=-1:g===f&&(y=n.isVertical?d?1:-1:d?-1:1),g=e+y*_,r[n.start]=e,r[n.end]=g,g}class BarSeriesSpecTransformer extends BaseSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(e){this._addMarkLabelSpec(e,"bar")}}class BarSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.bar,this._barMarkName="bar",this._barMarkType="rect",this.transformerConstructor=BarSeriesSpecTransformer,this._bandPosition=0,this._getBarXStart=(e,i,n)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),e[RECT_X]):this._spec.barMinHeight?this._calculateRectPosition(e,!1,n):valueInScaleRange(this._dataToPosX(e),i,n),this._getBarXEnd=(e,i,n)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),e[RECT_X1]):valueInScaleRange(this._dataToPosX1(e),i,n),this._getBarYStart=(e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),e[RECT_Y]):this._spec.barMinHeight?this._calculateRectPosition(e,!0):valueInScaleRange(this._dataToPosY(e),i),this._getBarYEnd=(e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),e[RECT_Y1]):valueInScaleRange(this._dataToPosY1(e),i),this._getBarBackgroundXStart=e=>{const i=e.range();return Math.min(i[0],i[i.length-1])},this._getBarBackgroundXEnd=e=>{const i=e.range();return Math.max(i[0],i[i.length-1])},this._getBarBackgroundYStart=e=>{const i=e.range();return Math.min(i[0],i[i.length-1])},this._getBarBackgroundYEnd=e=>{const i=e.range();return Math.max(i[0],i[i.length-1])},this._getBarBackgroundPositionXEncoder=()=>{var e;return(e=this._barBackgroundPositionXEncoder)===null||e===void 0?void 0:e.bind(this)},this._setBarBackgroundPositionXEncoder=e=>{this._barBackgroundPositionXEncoder=e.bind(this)},this._getBarBackgroundPositionYEncoder=()=>{var e;return(e=this._barBackgroundPositionYEncoder)===null||e===void 0?void 0:e.bind(this)},this._setBarBackgroundPositionYEncoder=e=>{this._barBackgroundPositionYEncoder=e.bind(this)}}initMark(){var e,i;this._initBarBackgroundMark(),this._barMark=this._createMark(Object.assign(Object.assign({},BarSeries.mark.bar),{name:this._barMarkName,type:this._barMarkType}),{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(e=this._spec.bar)===null||e===void 0?void 0:e.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morphElementKey:this.getDimensionField()[0],morph:shouldMarkDoMorph(this._spec,this._barMarkName),setCustomizedShape:(i=this._spec.bar)===null||i===void 0?void 0:i.customShape})}_initBarBackgroundMark(){this._spec.barBackground&&this._spec.barBackground.visible&&(this._barBackgroundMark=this._createMark(BarSeries.mark.barBackground,{dataView:this._barBackgroundViewData.getDataView(),dataProductId:this._barBackgroundViewData.getProductId(),stateSort:this._spec.barBackground.stateSort},{setCustomizedShape:this._spec.barBackground.customShape,progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold}))}initMarkStyle(){this._barMark&&this.setMarkStyle(this._barMark,{fill:this.getColorAttribute()},"normal",AttributeLevel.Series)}initLabelMarkStyle(e){e&&this.setMarkStyle(e,{fill:this.getColorAttribute(),text:i=>i[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}initTooltip(){super.initTooltip();const{mark:e,group:i}=this._tooltipHelper.activeTriggerSet;this._barMark&&(e.add(this._barMark),i.add(this._barMark))}_statisticViewData(){var e,i;super._statisticViewData();const n=(e=this._spec.barBackground)!==null&&e!==void 0?e:{};if(!n.visible)return;const o=this._getRelatedComponentSpecInfo("axes").some(u=>u.type===ComponentTypeEnum.cartesianBandAxis);let l;if(registerDataSetInstanceTransform(this._option.dataSet,"addVChartProperty",addVChartProperty),o){const u=([d],{scaleDepth:f})=>{var g,_;let y=[{}];const b=this.getDimensionField(),S=isNil(f)?b.length:Math.min(b.length,f);for(let v=0;v<S;v++){const A=b[v],x=(g=d.latestData[A])===null||g===void 0?void 0:g.values;if(!(x!=null&&x.length))continue;const T=[],C=(_=this._spec.dataKey)!==null&&_!==void 0?_:DEFAULT_DATA_KEY;for(let E=0;E<x.length;E++)for(let P=0;P<y.length;P++)T.push(Object.assign(Object.assign({},y[P]),{[A]:x[E],[C]:x[E]}));y=T}return y};registerDataSetInstanceTransform(this._option.dataSet,"dimensionItems",u),l=new DataView(this._option.dataSet).parse([this._viewDataStatistics],{type:"dataview"}).transform({type:"dimensionItems",options:{scaleDepth:isNil(n.fieldLevel)?void 0:n.fieldLevel+1}},!1).transform({type:"addVChartProperty",options:{beforeCall:initKeyMap.bind(this),call:addDataKey}},!1),(i=this._viewDataStatistics)===null||i===void 0||i.target.addListener("change",l.reRunAllTransform)}else{const u=([f])=>{const g=[],[_,y]=this.getDimensionContinuousField(),b={};return d.latestData.forEach(S=>{const v=`${S[_]}-${S[y]}`;b[v]||(b[v]={[_]:S[_],[y]:S[y]},g.push(b[v]))}),g};registerDataSetInstanceTransform(this._option.dataSet,"dimensionItems",u);const d=this.getViewData();l=new DataView(this._option.dataSet).parse([d],{type:"dataview"}).transform({type:"dimensionItems"},!1).transform({type:"addVChartProperty",options:{beforeCall:initKeyMap.bind(this),call:addDataKey}},!1),d==null||d.target.addListener("change",l.reRunAllTransform)}this._barBackgroundViewData=new SeriesData(this._option,l)}init(e){var i,n;super.init(e),this.direction==="vertical"?((i=this._xAxisHelper)===null||i===void 0?void 0:i.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle():((n=this._yAxisHelper)===null||n===void 0?void 0:n.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle()}_shouldDoPreCalculate(){const e=this.getRegion();return this.getStack()&&e.getSeries().filter(i=>i.type===this.type&&i.getSpec().barMinHeight).length}_calculateStackRectPosition(e){const i=this.getRegion();if(i._bar_series_position_calculated)return;let n,o,l,u,d;i._bar_series_position_calculated=!0,e?(n=RECT_Y1,o=RECT_Y,l="_dataToPosY1",u="_dataToPosY",d="_yAxisHelper"):(n=RECT_X1,o=RECT_X,l="_dataToPosX1",u="_dataToPosX",d="_xAxisHelper");const f=getRegionStackGroup(i,!1,g=>g.type===this.type);for(const g in f)for(const _ in f[g].nodes)stackWithMinHeight(f[g].nodes[_],i.getStackInverse(),{isVertical:e,start:n,end:o,startMethod:l,endMethod:u,axisHelper:d})}_calculateRectPosition(e,i,n){var o,l;let u,d,f;i?(u="_dataToPosY1",d="_dataToPosY",f="_yAxisHelper"):(u="_dataToPosX1",d="_dataToPosX",f="_xAxisHelper");const g=(l=(o=this[f]).getScale)===null||l===void 0?void 0:l.call(o,0),_=this[f].isInverse(),y=this._spec.barMinHeight,b=valueInScaleRange(this[u](e),g,n),S=valueInScaleRange(this[d](e),g,n);let v=Math.abs(b-S);v<y&&(v=y);let A=1;return S<b?A=-1:S===b&&(A=i?_?1:-1:_?-1:1),b+A*v}_dataToPosX(e){return this.dataToPositionX(e)}_dataToPosX1(e){return this.dataToPositionX1(e)}_dataToPosY(e){return this.dataToPositionY(e)}_dataToPosY1(e){return this.dataToPositionY1(e)}initBandRectMarkStyle(){var e,i,n,o;const l=(i=(e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale)===null||i===void 0?void 0:i.call(e,0),u=(o=(n=this._yAxisHelper)===null||n===void 0?void 0:n.getScale)===null||o===void 0?void 0:o.call(n,0);this.direction==="horizontal"?this.setMarkStyle(this._barMark,{x:d=>this._getBarXStart(d,l),x1:d=>this._getBarXEnd(d,l),y:d=>this._getPosition(this.direction,d),height:()=>this._getBarWidth(this._yAxisHelper),width:()=>{},y1:()=>{}},"normal",AttributeLevel.Series):this.setMarkStyle(this._barMark,{y:d=>this._getBarYStart(d,u),y1:d=>this._getBarYEnd(d,u),x:d=>this._getPosition(this.direction,d),width:()=>this._getBarWidth(this._xAxisHelper),x1:()=>{},height:()=>{}},"normal",AttributeLevel.Series),this._initStackBarMarkStyle(),this._initBandBarBackgroundMarkStyle()}_initStackBarMarkStyle(){var e,i,n,o;if(!this._spec.stackCornerRadius)return;const l=(i=(e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale)===null||i===void 0?void 0:i.call(e,0),u=(o=(n=this._yAxisHelper)===null||n===void 0?void 0:n.getScale)===null||o===void 0?void 0:o.call(n,0);this._barMark.setMarkConfig({clip:!0,clipPath:()=>{const d=[];return this._forEachStackGroup(f=>{let g=1/0,_=-1/0,y=!1,b=1/0,S=-1/0;f.values.forEach(x=>{const T=x[STACK_FIELD_START],C=x[STACK_FIELD_END],E=x[STACK_FIELD_START_PERCENT],P=x[STACK_FIELD_END_PERCENT];g=Math.min(g,T,C),_=Math.max(_,T,C),isValid(E)&&isValid(P)&&(y=!0,b=Math.min(b,E,P),S=Math.max(S,E,P))});const v=Object.assign(Object.assign(Object.assign({},f.values[0]),{[STACK_FIELD_START]:g,[STACK_FIELD_END]:_}),y?{[STACK_FIELD_START_PERCENT]:b,[STACK_FIELD_END_PERCENT]:S}:void 0),A=this.direction==="horizontal"?{x:this._getBarXStart(v,l),x1:this._getBarXEnd(v,l),y:this._getPosition(this.direction,v),height:this._getBarWidth(this._yAxisHelper)}:{y:this._getBarYStart(v,u),y1:this._getBarYEnd(v,u),x:this._getPosition(this.direction,v),width:this._getBarWidth(this._xAxisHelper)};d.push(createRect(Object.assign(Object.assign({},A),{cornerRadius:isFunction(this._spec.stackCornerRadius)?this._spec.stackCornerRadius(A,v,this._markAttributeContext):this._spec.stackCornerRadius,fill:!0})))}),d}})}initLinearRectMarkStyle(){var e,i,n,o;const l=(i=(e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale)===null||i===void 0?void 0:i.call(e,0),u=(o=(n=this._yAxisHelper)===null||n===void 0?void 0:n.getScale)===null||o===void 0?void 0:o.call(n,0);if(this.direction==="horizontal"){const d=isValid(this._fieldY2)?{y:f=>valueInScaleRange(this._dataToPosY(f),u,!0),y1:f=>valueInScaleRange(this._dataToPosY1(f),u,!0)}:{y:f=>valueInScaleRange(this._dataToPosY(f)-this._getBarWidth(this._yAxisHelper)/2,u,!0),height:f=>this._getBarWidth(this._yAxisHelper)};this.setMarkStyle(this._barMark,Object.assign({x:f=>this._getBarXStart(f,l,!0),x1:f=>this._getBarXEnd(f,l,!0)},d),"normal",AttributeLevel.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign({x:()=>this._getBarBackgroundXStart(l),x1:()=>this._getBarBackgroundXEnd(l)},d),"normal",AttributeLevel.Series)}else{const d=isValid(this._fieldX2)?{x:f=>valueInScaleRange(this._dataToPosX(f),l,!0),x1:f=>valueInScaleRange(this._dataToPosX1(f),l,!0)}:{x:f=>valueInScaleRange(this._dataToPosX(f)-this._getBarWidth(this._xAxisHelper)/2,l,!0),width:f=>this._getBarWidth(this._xAxisHelper)};this.setMarkStyle(this._barMark,Object.assign(Object.assign({},d),{y:f=>this._getBarYStart(f,u),y1:f=>this._getBarYEnd(f,u)}),"normal",AttributeLevel.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign(Object.assign({},d),{y:()=>this._getBarBackgroundYStart(u),y1:()=>this._getBarBackgroundYEnd(u)}),"normal",AttributeLevel.Series)}}_initBandBarBackgroundMarkStyle(){var e,i,n,o,l;if(!this._barBackgroundMark)return;const u=(i=(e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale)===null||i===void 0?void 0:i.call(e,0),d=(o=(n=this._yAxisHelper)===null||n===void 0?void 0:n.getScale)===null||o===void 0?void 0:o.call(n,0),f=(l=this._spec.barBackground)!==null&&l!==void 0?l:{},g=isNil(f.fieldLevel)?void 0:f.fieldLevel+1;this.direction==="horizontal"?this.setMarkStyle(this._barBackgroundMark,{x:()=>this._getBarBackgroundXStart(u),x1:()=>this._getBarBackgroundXEnd(u),y:_=>this._getPosition(this.direction,_,g,"barBackground"),height:()=>this._getBarWidth(this._yAxisHelper,g),width:()=>{},y1:()=>{}},"normal",AttributeLevel.Series):this.setMarkStyle(this._barBackgroundMark,{x:_=>this._getPosition(this.direction,_,g,"barBackground"),y:()=>this._getBarBackgroundYStart(d),y1:()=>this._getBarBackgroundYEnd(d),width:()=>this._getBarWidth(this._xAxisHelper,g),x1:()=>{},height:()=>{}},"normal",AttributeLevel.Series)}initAnimation(){var e,i;const n={yField:this._fieldY[0],xField:this._fieldX[0],direction:this.direction,growFrom:()=>{var u,d;return this.direction==="horizontal"?(u=this._xAxisHelper)===null||u===void 0?void 0:u.getScale(0).scale(0):(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale(0).scale(0)}},o=(e=this._spec.animationAppear)===null||e===void 0?void 0:e.preset,l=getGroupAnimationParams(this);this._barMark.setAnimationConfig(animationConfig((i=Factory$1.getAnimationInKey("bar"))===null||i===void 0?void 0:i(n,o),userAnimationConfig(this._barMarkName,this._spec,this._markAttributeContext),l))}_getBarWidth(e,i){var n,o;const l=this._groups?this._groups.fields.length:1,u=isNil(i)?l:Math.min(l,i),d=(o=(n=e.getBandwidth)===null||n===void 0?void 0:n.call(e,u-1))!==null&&o!==void 0?o:6,f=isValid(this._spec.barWidth)&&u===l,g=isValid(this._spec.barMinWidth),_=isValid(this._spec.barMaxWidth);let y=d;return f&&(y=getActualNumValue(this._spec.barWidth,d)),g&&(y=Math.max(y,getActualNumValue(this._spec.barMinWidth,d))),_&&(y=Math.min(y,getActualNumValue(this._spec.barMaxWidth,d))),y}_getPosition(e,i,n,o){var l,u,d,f,g;let _,y,b;e==="horizontal"?(_=this.getYAxisHelper(),y="height",b=o==="barBackground"?this.dataToBarBackgroundPositionY.bind(this):this.dataToPositionY.bind(this)):(_=this.getXAxisHelper(),y="width",b=o==="barBackground"?this.dataToBarBackgroundPositionX.bind(this):this.dataToPositionX.bind(this));const S=_.getScale(0),v=this._groups?this._groups.fields.length:1,A=isNil(n)?v:Math.min(v,n),x=(u=(l=_.getBandwidth)===null||l===void 0?void 0:l.call(_,A-1))!==null&&u!==void 0?u:6,T=A===v?this._barMark.getAttribute(y,i):x;if(A>1&&isValid(this._spec.barGapInGroup)){const E=this._groups.fields,P=array(this._spec.barGapInGroup);let L=0,R=0;for(let w=E.length-1;w>=1;w--){const D=E[w],I=(f=(d=_.getScale(w))===null||d===void 0?void 0:d.domain())!==null&&f!==void 0?f:[],O=I.length,B=getActualNumValue((g=P[w-1])!==null&&g!==void 0?g:last(P),x),N=I.indexOf(i[D]);w===E.length-1?(L+=O*T+(O-1)*B,R+=N*(T+B)):(R+=N*(L+B),L+=L+(O-1)*B)}return S.scale(i[E[0]])+_.getBandwidth(0)/2-L/2+R}const C=isContinuous(S.type||"band");return b(i,A)+.5*(x-T)+(C?-x/2:0)}dataToBarBackgroundPositionX(e,i){return this._dataToPosition(e,this._xAxisHelper,this.fieldX,i,this._getBarBackgroundPositionXEncoder,this._setBarBackgroundPositionXEncoder)}dataToBarBackgroundPositionY(e,i){return this._dataToPosition(e,this._yAxisHelper,this.fieldY,i,this._getBarBackgroundPositionYEncoder,this._setBarBackgroundPositionYEncoder)}onLayoutEnd(e){super.onLayoutEnd(e),this.getRegion()._bar_series_position_calculated=!1,this._spec.sampling&&this.compile()}compile(){if(super.compile(),this._spec.sampling){const{width:e,height:i}=this._region.getLayoutRect(),n=[],o=this._fieldY,l=this._fieldX;n.push({type:"sampling",size:this._direction==="horizontal"?i:e,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?l[0]:o[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(n)}}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._barMark]}compileData(){var e;super.compileData(),(e=this._barBackgroundViewData)===null||e===void 0||e.compile()}fillData(){var e,i;super.fillData(),(i=(e=this._barBackgroundViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform()}viewDataUpdate(e){var i,n,o;super.viewDataUpdate(e),(n=(i=this._barBackgroundViewData)===null||i===void 0?void 0:i.getDataView())===null||n===void 0||n.reRunAllTransform(),(o=this._barBackgroundViewData)===null||o===void 0||o.updateData()}release(){var e;super.release(),(e=this._barBackgroundViewData)===null||e===void 0||e.release(),this._barBackgroundViewData=null}}BarSeries.type=SeriesTypeEnum.bar,BarSeries.mark=barSeriesMark,BarSeries.transformerConstructor=BarSeriesSpecTransformer;const registerBarSeries=()=>{registerSampleTransform(),registerRectMark(),registerBarAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(BarSeries.type,BarSeries)};class BarChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barMinHeight","sampling","samplingFactor","barBackground","stackCornerRadius"])}transformSpec(e){super.transformSpec(e),setDefaultCrosshairForCartesianChart(e)}_transformAxisSpec(e){var i,n;if(super._transformAxisSpec(e),!e.axes)return;const o=e.series.some(u=>u.direction==="horizontal"),l=(i=e.axes.find(u=>u.type==="band"))!==null&&i!==void 0?i:e.axes.find(u=>(o?["left","right"]:["top","bottom"]).includes(u.orient));if(l&&!l.bandSize&&!l.maxBandSize&&!l.minBandSize&&e.autoBandSize){const u=isObject$1(e.autoBandSize)&&(n=e.autoBandSize.extend)!==null&&n!==void 0?n:0,{barMaxWidth:d,barMinWidth:f,barWidth:g,barGapInGroup:_}=e.series.find(y=>y.type==="bar");this._applyAxisBandSize(l,u,{barMaxWidth:d,barMinWidth:f,barWidth:g,barGapInGroup:_})}}}class BarChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=BarChartSpecTransformer,this.type="bar",this.seriesType=SeriesTypeEnum.bar}}BarChart.type="bar",BarChart.seriesType=SeriesTypeEnum.bar,BarChart.transformerConstructor=BarChartSpecTransformer,mixin(BarChart,StackChartMixin);const registerBarChart=()=>{registerBarSeries(),Factory$1.registerChart(BarChart.type,BarChart)};class Rect3dMark extends BaseMark{constructor(){super(...arguments),this.type=Rect3dMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,length:3})}}Rect3dMark.type="rect3d";const registerRect3dMark=()=>{Factory$1.registerMark(Rect3dMark.type,Rect3dMark),registerRect3dGraphic(),registerVGrammarRectAnimation()};class Bar3dSeriesSpecTransformer extends BarSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"bar3d")}}class Bar3dSeries extends BarSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.bar3d,this._barMarkName="bar3d",this._barMarkType="rect3d",this.transformerConstructor=Bar3dSeriesSpecTransformer}}Bar3dSeries.type=SeriesTypeEnum.bar3d,Bar3dSeries.mark=bar3dSeriesMark,Bar3dSeries.transformerConstructor=Bar3dSeriesSpecTransformer;const registerBar3dSeries=()=>{registerBar3dAnimation(),registerRect3dMark(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(Bar3dSeries.type,Bar3dSeries)};class Bar3dChartSpecTransformer extends BarChartSpecTransformer{_getDefaultSeriesSpec(e){const i=super._getDefaultSeriesSpec(e);return i.barWidth=e.barWidth,i.barMaxWidth=e.barMaxWidth,i.barMinWidth=e.barMinWidth,i.barGapInGroup=e.barGapInGroup,i}}const register3DPlugin=()=>{registerDirectionalLight(),registerOrthoCamera(),registerViewTransform3dPlugin()},registerAnimate=()=>{registerAnimate$1(),registerVGrammarCommonAnimation()};class Bar3dChart extends BarChart{constructor(){super(...arguments),this.transformerConstructor=Bar3dChartSpecTransformer,this.type="bar3d",this.seriesType=SeriesTypeEnum.bar3d}}Bar3dChart.type="bar3d",Bar3dChart.seriesType=SeriesTypeEnum.bar3d,Bar3dChart.transformerConstructor=Bar3dChartSpecTransformer;const registerBar3dChart=()=>{register3DPlugin(),registerBar3dSeries(),Factory$1.registerChart(Bar3dChart.type,Bar3dChart)},SCATTER_DEFAULT_SIZE=10,SCATTER_DEFAULT_RANGE_SIZE=[10,20],SCATTER_DEFAULT_SIZE_SCALE_TYPE=ScaleEnum.Linear,SCATTER_DEFAULT_SHAPE="circle",SCATTER_DEFAULT_SHAPE_SCALE_TYPE=ScaleEnum.Ordinal,SCATTER_DEFAULT_RANGE_SHAPE=["circle","square","triangle","diamond","star"],scatterPresetAnimation=(r,e)=>e==="fadeIn"?{type:"fadeIn"}:{type:"scaleIn"},registerScatterAnimation=()=>{Factory$1.registerAnimation("scatter",(r,e)=>Object.assign({appear:scatterPresetAnimation(0,e)},ScaleInOutAnimation))},scatterSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{point:{name:"point",type:"symbol"}});class ScatterSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"point")}}class ScatterSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.scatter,this.transformerConstructor=ScatterSeriesSpecTransformer,this._invalidType="zero"}setAttrFromSpec(){super.setAttrFromSpec(),this._size=this._spec.size,this._sizeField=this._spec.sizeField,this._shape=this._spec.shape,this._shapeField=this._spec.shapeField}_getSeriesAttribute(e,i,{defaultScaleType:n,defaultRange:o},l){var u,d,f,g;if(isFunction(i))return i;if(isArray(i)){if(isNil(e))return(u=this._option)===null||u===void 0||u.onError(`${l}Field is required.`),i;if(n!=="ordinal"&&i.length>2)return(d=this._option)===null||d===void 0||d.onError(`${l} length is invalid, specify up to 2 ${l}s.`),i;const _=`${PREFIX}_series_scatter_${this.id}_scale_${l}`;return this._option.globalScale.registerModelScale({id:_,type:n,domain:[{dataId:this._rawData.name,fields:[e]}],range:i}),{scale:_,field:e}}if(isObject$1(i)){if(isNil(e))return(f=this._option)===null||f===void 0||f.onError(`${l}Field is required.`),i;const _=`${PREFIX}_series_scatter_${this.id}_scale_${l}`,y=Object.assign({id:_,type:n,domain:[{dataId:this._rawData.name,fields:[e]}],range:o},i);return this._option.globalScale.registerModelScale(y),{scale:y.id,field:e}}return(g=this._option)===null||g===void 0||g.onError(`${l} attribute is invalid.`),i}getSizeAttribute(e,i){return isNil(i)?SCATTER_DEFAULT_SIZE:isNumber(i)?i:isString(i)&&isNumeric(i)?parseFloat(i):this._getSeriesAttribute(e,i,{defaultScaleType:SCATTER_DEFAULT_SIZE_SCALE_TYPE,defaultRange:SCATTER_DEFAULT_RANGE_SIZE},"size")}getShapeAttribute(e,i){return isNil(i)?SCATTER_DEFAULT_SHAPE:isString(i)?i:this._getSeriesAttribute(e,i,{defaultScaleType:SCATTER_DEFAULT_SHAPE_SCALE_TYPE,defaultRange:SCATTER_DEFAULT_RANGE_SHAPE},"shape")}initMark(){var e,i;this._symbolMark=this._createMark(ScatterSeries.mark.point,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(e=this._spec.point)===null||e===void 0?void 0:e.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morph:shouldMarkDoMorph(this._spec,ScatterSeries.mark.point.name),morphElementKey:this.getDimensionField()[0],setCustomizedShape:(i=this._spec.point)===null||i===void 0?void 0:i.customShape})}initMarkStyle(){this.initSymbolMarkStyle()}initAnimation(){var e,i,n;const o=getGroupAnimationParams(this),l=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this._symbolMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("scatter"))===null||n===void 0?void 0:n({},l),userAnimationConfig("point",this._spec,this._markAttributeContext),o))}initSymbolMarkStyle(){const e=this._symbolMark;e&&(this._invalidType!=="zero"&&this.setMarkStyle(e,{visible:this._getInvalidDefined.bind(this)}),this.setMarkStyle(e,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,fill:this.getColorAttribute(),size:isNumber(this._size)||isFunction(this._size)?this._size:SCATTER_DEFAULT_SIZE,symbolType:isString(this._shape)||isFunction(this._shape)?this._shape:SCATTER_DEFAULT_SHAPE},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series),(isValid(this._sizeField)||isValid(this._size))&&this.setMarkStyle(e,{size:this.getSizeAttribute(this._sizeField,this._size)},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.User_Mark),(isValid(this._shapeField)||isValid(this._shape))&&this.setMarkStyle(e,{symbolType:this.getShapeAttribute(this._shapeField,this._shape)},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.User_Mark))}initTooltip(){super.initTooltip(),this._symbolMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._symbolMark)}viewDataStatisticsUpdate(e){super.viewDataStatisticsUpdate(e);const i=[this.getDimensionField()[0],this.getStackValueField()].every(n=>{var o,l,u;return n&&((u=(l=(o=this.getViewDataStatistics())===null||o===void 0?void 0:o.latestData)===null||l===void 0?void 0:l[n])===null||u===void 0?void 0:u.allValid)});this._invalidType==="zero"||i?this.setMarkStyle(this._symbolMark,{visible:!0},"normal",AttributeLevel.Series):this.setMarkStyle(this._symbolMark,{visible:this._getInvalidDefined.bind(this)},"normal",AttributeLevel.Series),this._symbolMark.getProduct()&&this._symbolMark.compileEncode()}initLabelMarkStyle(e){e&&(this._labelMark=e,this.setMarkStyle(e,{fill:this.getColorAttribute(),text:i=>i[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series),this._invalidType!=="zero"&&this.setMarkStyle(e,{visible:this._getInvalidDefined.bind(this)},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series))}handleZoom(e){var i,n;this.getMarksWithoutRoot().forEach(l=>{const u=l.getProduct();!u||!u.elements||!u.elements.length||u.elements.forEach((d,f)=>{const g=d.getGraphicItem(),_=d.getDatum(),y=this.dataToPosition(_);y&&g&&g.translateTo(y.x,y.y)})});const o=(n=(i=this._labelMark)===null||i===void 0?void 0:i.getComponent())===null||n===void 0?void 0:n.getProduct();o&&o.evaluate(null,null)}handlePan(e){this.handleZoom(e)}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._symbolMark]}}ScatterSeries.type=SeriesTypeEnum.scatter,ScatterSeries.mark=scatterSeriesMark,ScatterSeries.transformerConstructor=ScatterSeriesSpecTransformer;const registerScatterSeries=()=>{registerSymbolMark(),registerScatterAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(ScatterSeries.type,ScatterSeries)};class ScatterChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["point","size","shape","shapeField","sizeField"])}}class ScatterChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=ScatterChartSpecTransformer,this.type="scatter",this.seriesType=SeriesTypeEnum.scatter}}ScatterChart.type="scatter",ScatterChart.seriesType=SeriesTypeEnum.scatter,ScatterChart.transformerConstructor=ScatterChartSpecTransformer,mixin(ScatterChart,StackChartMixin);const registerScatterChart=()=>{registerScatterSeries(),Factory$1.registerChart(ScatterChart.type,ScatterChart)};geoPath();const projections={},projectionProperties=["clipAngle","clipExtent","scale","translate","center","rotate","precision","reflectX","reflectY","parallels","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function create$1(r,e){return function i(){const n=e();return n.type=r,n.path=geoPath().projection(n),n.copy=n.copy||function(){const o=i();return projectionProperties.forEach(l=>{n[l]&&o[l](n[l]())}),o.path.pointRadius(n.path.pointRadius()),o},n}}function projection(r,e){r&&isString(r)||error("Projection type must be a name string.");const i=r.toLowerCase();return arguments.length>1&&(projections[i]=create$1(i,e)),projections[i]||null}const builtInProjections={albers:geoAlbers,albersusa:geoAlbersUsa,azimuthalequalarea:geoAzimuthalEqualArea,azimuthalequidistant:geoAzimuthalEquidistant,conicconformal:geoConicConformal,conicequalarea:geoConicEqualArea,conicequidistant:geoConicEquidistant,equalEarth:geoEqualEarth,equirectangular:geoEquirectangular,gnomonic:geoGnomonic,identity:geoIdentity,mercator:geoMercator,naturalEarth1:geoNaturalEarth1,orthographic:geoOrthographic,stereographic:geoStereographic,transversemercator:geoTransverseMercator};Object.keys(builtInProjections).forEach(r=>{projection(r,builtInProjections[r])});const Feature="Feature",FeatureCollection="FeatureCollection";function featurize(r){return r.type===FeatureCollection?r.features:array(r).filter(e=>!isNil(e)).map(e=>e.type===Feature?e:{type:Feature,geometry:e})}function collectGeoJSON(r){const e=array(r);return e.length===1?e[0]:{type:FeatureCollection,features:e.reduce((i,n)=>i.concat(featurize(n)),[])}}function create(r){const e=projection((r||"mercator").toLowerCase());return e||error("Unrecognized projection type: "+r),e()}function set(r,e,i){isFunction(r[e])&&r[e](i)}const projectionOptions=projectionProperties.concat(["pointRadius","fit","extent","size"]);function parseProjection(r,e){let i=[];return r&&Object.keys(r).forEach(n=>{projectionOptions.includes(n)&&(i=i.concat(parseFunctionType(r[n],e)))}),i}let Projection$1=class extends GrammarBase{constructor(e){super(e),this.grammarType="projection"}parse(e){return super.parse(e),this.pointRadius(e.pointRadius),this.size(e.size),this.extent(e.extent),this.fit(e.fit),this.configure(e),this.commit(),this}pointRadius(e){return isNil(this.spec.pointRadius)||this.detach(parseFunctionType(this.spec.pointRadius,this.view)),this.spec.pointRadius=e,this.attach(parseFunctionType(e,this.view)),this.commit(),this}size(e){return isNil(this.spec.size)||this.detach(parseFunctionType(this.spec.size,this.view)),this.spec.size=e,this.attach(parseFunctionType(e,this.view)),this.commit(),this}extent(e){return isNil(this.spec.extent)||this.detach(parseFunctionType(this.spec.extent,this.view)),this.spec.extent=e,this.attach(parseFunctionType(e,this.view)),this.commit(),this}fit(e){return isNil(this.spec.fit)||this.detach(parseFunctionType(this.spec.fit,this.view)),this.spec.fit=e,this.attach(parseFunctionType(e,this.view)),this.commit(),this}configure(e){return this.detach(parseProjection(this.spec,this.view)),isNil(e)?this.spec={type:this.spec.type,fit:this.spec.fit,extent:this.spec.extent,size:this.spec.size,pointRadius:this.spec.pointRadius}:(Object.assign(this.spec,e),this.attach(parseProjection(this.spec,this.view))),this.commit(),this}evaluate(e,i){if(this.projection&&this.projection.type===this.spec.type||(this.projection=create(this.spec.type),this.projection.type=this.spec.type),projectionProperties.forEach(n=>{isNil(this.spec[n])||set(this.projection,n,invokeFunctionType(this.spec[n],i,projection))}),isNil(this.spec.pointRadius)||this.projection.path.pointRadius(invokeFunctionType(this.spec.pointRadius,i,projection)),!(isNil(this.spec.fit)||isNil(this.spec.extent)&&isNil(this.spec.size))){const n=collectGeoJSON(invokeFunctionType(this.spec.fit,i,projection));this.spec.extent?this.projection.fitExtent(invokeFunctionType(this.spec.extent,i,projection),n):this.spec.size&&this.projection.fitSize(invokeFunctionType(this.spec.size,i,projection),n)}return this.projection}output(){return this.projection}};const registerProjection=()=>{Factory.registerGrammar("projection",Projection$1,"projections")},lookup=(r,e)=>{if(!e.from||!e.from())return r;const i=e.fields,n=e.key,o=e.values,l=e.default,u=e.as||[i],d=e.from().reduce(function(g,_){return _[i]&&g.set(_[i],_),g},new Map);let f;if(isFunction(e.set))f=function(g){const _=d.get(g[n]);e.set(g,_)};else if(o){const g=o.length;f=function(_){const y=d.get(_[n]);if(isNil(y))for(let b=0;b<g;++b)_[u[b]]=l;else for(let b=0;b<g;++b)_[u[b]]=y[o[b]]}}else f=function(g){const _=d.get(g[n]);g[u[0]]=isValid(_)?_:l};return r.length===0?[]:r.map(g=>(f(g),g))};class GeoSeries extends BaseSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.geo,this.coordinate="geo",this._nameProperty="name"}getMapViewData(){var e;return(e=this._mapViewData)===null||e===void 0?void 0:e.getDataView()}get nameField(){return this._nameField}set nameField(e){this._nameField=e}get valueField(){return this._valueField}set valueField(e){this._valueField=e}getNameProperty(){return this._nameProperty}getCentroidProperty(){return this._centroidProperty}getCoordinateHelper(){return this._coordinateHelper}setCoordinateHelper(e){this._coordinateHelper=e}getStatisticFields(){const e=[];return e.push({key:this._nameField,operations:["values"]}),e.push({key:this._valueField,operations:["max","min"]}),e}getGroupFields(){return null}dataToPosition(e,i){var n;let o=null;if(!e||i&&!this.isDatumInViewData(e))return o;const{dataToPosition:l,latitudeField:u,longitudeField:d}=this._coordinateHelper;if(o=this.nameToPosition(e),o===null){const f=d?e==null?void 0:e[d]:Number.NaN,g=u?e==null?void 0:e[u]:Number.NaN;o=(n=l==null?void 0:l([f,g]))!==null&&n!==void 0?n:null}return o}nameToPosition(e){const i=this.getDatumName(e);return isNil(i)?null:this.nameValueToPosition(i)}nameValueToPosition(e){var i,n;const o=(n=(i=this.getMapViewData())===null||i===void 0?void 0:i.latestData)===null||n===void 0?void 0:n.filter(f=>this.getDatumName(f)===e)[0];if(isNil(o))return null;const{dataToPosition:l}=this._coordinateHelper,u=this.getDatumCenter(o),d=l==null?void 0:l(u);return isNil(d)||isNaN(d.x)||isNaN(d.y)?null:d}dataToLatitude(e){if(!this._coordinateHelper)return Number.NaN;const{dataToLatitude:i}=this._coordinateHelper;return i(e)}dataToLongitude(e){if(!this._coordinateHelper)return Number.NaN;const{dataToLatitude:i}=this._coordinateHelper;return i(e)}valueToPosition(e,i){return{x:this.dataToLongitude(e),y:this.dataToLatitude(i)}}positionToData(e){}latitudeToData(e){}longitudeToData(e){}dataToPositionX(e){var i;return(i=this._option)===null||i===void 0||i.onError("Method not implemented."),0}dataToPositionY(e){var i;return(i=this._option)===null||i===void 0||i.onError("Method not implemented."),0}dataToPositionZ(e){var i;return(i=this._option)===null||i===void 0||i.onError("Method not implemented."),0}release(){super.release(),this._mapViewData.release(),this._mapViewData=this._mapViewDataStatistics=null}getStackGroupFields(){return[this._nameField]}getStackValueField(){return this._spec.valueField}compileData(){var e;(e=this._mapViewData)===null||e===void 0||e.compile()}initStatisticalData(){if(super.initStatisticalData(),this._mapViewData){const e=`${PREFIX}_series_${this.id}_mapViewDataStatic`;this._mapViewDataStatistics=this.createStatisticalData(e,this._mapViewData.getDataView()),this._mapViewData.getDataView().target.removeListener("change",this._mapViewDataStatistics.reRunAllTransform)}}getSeriesKeys(){var e,i,n,o,l;return this._seriesField?(l=(i=(e=this.getRawDataStatisticsByField(this._seriesField))===null||e===void 0?void 0:e.values)!==null&&i!==void 0?i:(o=(n=this._mapViewDataStatistics)===null||n===void 0?void 0:n.latestData[this._seriesField])===null||o===void 0?void 0:o.values)!==null&&l!==void 0?l:[]:this.name?[this.name]:this.userId?[`${this.userId}`]:[`${this.type}_${this.id}`]}fillData(){var e,i;super.fillData(),(e=this._mapViewData.getDataView())===null||e===void 0||e.reRunAllTransform(),(i=this._mapViewDataStatistics)===null||i===void 0||i.reRunAllTransform()}getActiveMarks(){return[]}}const DEFAULT_MAP_LOOK_UP_KEY=`${PREFIX}_MAP_LOOK_UP_KEY`,map=(r,e)=>(r.features&&r.features.forEach((i,n)=>{var o;i[DEFAULT_DATA_INDEX]=n;const l=(o=i.properties)===null||o===void 0?void 0:o[e.nameProperty];e.nameMap&&e.nameMap[l]?i[DEFAULT_MAP_LOOK_UP_KEY]=e.nameMap[l]:i[DEFAULT_MAP_LOOK_UP_KEY]=l}),r.features);class MapSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.dimensionTooltipTitleCallback=e=>{var i;const n=this.series;return(i=this._getDimensionData(e))!==null&&i!==void 0?i:n.getDatumName(e)}}}class PathMark extends BaseMark{constructor(){super(...arguments),this.type=PathMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0,path:""})}}PathMark.type="path";const registerPathMark=()=>{Factory$1.registerMark(PathMark.type,PathMark),registerPathGraphic()},mapSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{area:{name:"area",type:"path"}});class Projection{constructor(e){this.projection=projection(e.type)()}fit(e,i,n){const o={type:"FeatureCollection",features:n};this.projection.fitExtent([e,i],o)}center(e){var i,n;(n=(i=this.projection)===null||i===void 0?void 0:i.center)===null||n===void 0||n.call(i,e)}project(e){var i;return(i=this.projection)===null||i===void 0?void 0:i.call(this,e)}shape(e){var i,n;return(n=(i=this.projection)===null||i===void 0?void 0:i.path)===null||n===void 0?void 0:n.call(i,e)}invert(e){var i,n;return(n=(i=this.projection)===null||i===void 0?void 0:i.invert)===null||n===void 0?void 0:n.call(i,e)}scale(e){var i;if(!((i=this.projection)===null||i===void 0)&&i.scale){if(e===void 0)return this.projection.scale();this.projection.scale(e)}}translate(e){var i;if(!((i=this.projection)===null||i===void 0)&&i.scale){if(e===void 0)return this.projection.translate();this.projection.translate(e)}}evaluate(e,i,n){const o=this.projection.copy();return o==null?void 0:o.fitExtent([e,i],{type:"FeatureCollection",features:n})}}class DeskTopTrigger{parserScrollEvent(e){return e&&!(e.ctrlKey||e.deltaY===0&&e.deltaX===0)&&(e.scrollX=e.deltaX,e.scrollY=e.deltaY,e)}parserZoomEvent(e){if(!e)return e;const i=Math.pow(1.0005,-e.deltaY*Math.pow(16,e.deltaMode));return e.zoomDelta=i,e.zoomX=e.canvasX,e.zoomY=e.canvasY,e}clearZoom(){}clearScroll(){}clearDrag(){}parserDragEvent(){return!0}}class MobileTrigger{constructor(){this._lastScale=0}clearZoom(){this._lastScale=0,this.pointerId=null}parserDragEvent(e){return!0}parserZoomEvent(e){const i=e.scale;if(this._lastScale===0)return this._lastScale=i,e;e.zoomDelta=i/this._lastScale;const n=e.center;return e.zoomX=n.x,e.zoomY=n.y,this._lastScale=i,e}parserScrollEvent(e){return e}clearScroll(){}clearDrag(){}}function getDefaultTriggerEventByMode(r){return r===RenderModeEnum["desktop-browser"]||r===RenderModeEnum["desktop-miniApp"]?{start:"pointerdown",move:"pointermove",end:["pointerup","pointerupoutside"],zoom:"wheel",zoomEnd:"pointerup",scroll:"wheel",trigger:DeskTopTrigger}:isMobileLikeMode(r)||isMiniAppLikeMode(r)?{start:"pointerdown",move:"pointermove",end:["pointerup","pointerupoutside"],zoom:"pinch",zoomEnd:"pinchend",scroll:"pan",scrollEnd:"panend",trigger:MobileTrigger}:null}const delayMap={debounce,throttle};class Zoomable{constructor(){this._isGestureListener=!1}initZoomable(e,i=RenderModeEnum["desktop-browser"]){this._eventObj=e,this._renderMode=i,this._gestureController=this._option.getChart().getVGrammarView().renderer._gestureController,this._isGestureListener=isMobileLikeMode(this._renderMode)||isMiniAppLikeMode(this._renderMode),getDefaultTriggerEventByMode(this._renderMode)&&(this._clickEnable=!0,this._zoomableTrigger=new(this._getZoomTriggerEvent("trigger")))}_getZoomTriggerEvent(e){return getDefaultTriggerEventByMode(this._renderMode)[e]}_zoomEventDispatch(e,i,n){if(!this._isGestureListener&&!e.event)return;const o=this._isGestureListener?e:e.event.clone();this._zoomableTrigger.parserZoomEvent(o);const{zoomDelta:l,zoomX:u,zoomY:d,path:f}=o;if(!f.some(_=>_.name&&_.name.includes("region"))||isNil(l)||!pointInRect({x:u,y:d},this._getRegionOrSeriesLayout(i),!1))return;let g={};n&&(g=n({zoomDelta:l,zoomX:u,zoomY:d},o)),this._eventObj.emit("zoom",Object.assign(Object.assign({scale:o.zoomDelta,scaleCenter:{x:o.zoomX,y:o.zoomY}},g),{model:this}))}_getRegionOrSeriesLayout(e){e.type!=="region"&&(e=e.getRegion());const{x:i,y:n,width:o,height:l}=e.layout.getLayout();return{x1:i,y1:n,x2:i+o,y2:n+l}}_bindZoomEventAsRegion(e,i,n,o){var l,u;const d=(l=o==null?void 0:o.delayType)!==null&&l!==void 0?l:"throttle",f=(u=o==null?void 0:o.delayTime)!==null&&u!==void 0?u:0,g=this._isGestureListener?this._gestureController:e,_=this._isGestureListener?[this._getZoomTriggerEvent("zoom")]:[this._getZoomTriggerEvent("zoom"),{level:Event_Bubble_Level.chart,consume:!0}],y=this._isGestureListener?[this._getZoomTriggerEvent("zoomEnd")]:[this._getZoomTriggerEvent("zoomEnd"),{level:Event_Bubble_Level.chart,consume:!1}];g.on(...y,delayMap[d](b=>{this._zoomableTrigger.clearZoom()},f)),g.on(..._,delayMap[d](b=>{this._zoomEventDispatch(b,i,n)},f))}initZoomEventOfSeries(e,i,n){this._option.disableTriggerEvent||getDefaultTriggerEventByMode(this._renderMode)&&this._bindZoomEventAsRegion(e.event,e,i,n)}initZoomEventOfRegions(e,i,n,o){this._option.disableTriggerEvent||getDefaultTriggerEventByMode(this._renderMode)&&e.forEach(l=>{i?l.getSeries().forEach(u=>{i(u)&&this._bindZoomEventAsRegion(u.event,u,n,o)}):this._bindZoomEventAsRegion(this._eventObj,l,n,o)})}_scrollEventDispatch(e,i,n){let o=!1;if(!this._isGestureListener&&(!e.event||this._option.disableTriggerEvent))return o;const l=this._isGestureListener?e:e.event;this._zoomableTrigger.parserScrollEvent(l);const{scrollX:u,scrollY:d,canvasX:f,canvasY:g}=l;return isNil(u)&&isNil(d)||pointInRect({x:f,y:g},this._getRegionOrSeriesLayout(i),!1)&&(n&&(o=n({scrollX:u,scrollY:d},l)),this._eventObj.emit("scroll",{scrollX:u,scrollY:d,model:this})),o}_bindScrollEventAsRegion(e,i,n,o){var l,u;const d=(l=o==null?void 0:o.delayType)!==null&&l!==void 0?l:"throttle",f=(u=o==null?void 0:o.delayTime)!==null&&u!==void 0?u:0,g=this._isGestureListener?this._gestureController:e,_=this._isGestureListener?[this._getZoomTriggerEvent("scroll")]:[this._getZoomTriggerEvent("scroll"),{level:Event_Bubble_Level.chart,consume:!0}],y=this._isGestureListener?[this._getZoomTriggerEvent("scrollEnd")]:[this._getZoomTriggerEvent("scrollEnd"),{level:Event_Bubble_Level.chart,consume:!1}];g.on(...y,delayMap[d](b=>{this._zoomableTrigger.clearScroll()},f)),g.on(..._,delayMap[d](b=>this._scrollEventDispatch(b,i,n),f))}initScrollEventOfSeries(e,i,n){getDefaultTriggerEventByMode(this._renderMode)&&this._bindScrollEventAsRegion(e.event,e,i,n)}initScrollEventOfRegions(e,i,n,o){this._option.disableTriggerEvent||getDefaultTriggerEventByMode(this._renderMode)&&e.forEach(l=>{i?l.getSeries().forEach(u=>{i(u)&&this._bindScrollEventAsRegion(u.event,u,n,o)}):this._bindScrollEventAsRegion(this._eventObj,l,n,o)})}_bindDragEventAsRegion(e,i,n,o){e.on(this._getZoomTriggerEvent("start"),{level:Event_Bubble_Level.chart},l=>{if(!l.event)return;const{event:u}=l;pointInRect({x:u.canvasX,y:u.canvasY},this._getRegionOrSeriesLayout(i),!1)&&this._handleDrag(l,n,o)}),e.on("click",{level:Event_Bubble_Level.chart},()=>!this._clickEnable)}initDragEventOfSeries(e,i,n){this._option.disableTriggerEvent||getDefaultTriggerEventByMode(this._renderMode)&&e.event.on(this._getZoomTriggerEvent("start"),{level:Event_Bubble_Level.model,filter:({model:o})=>(o==null?void 0:o.id)===e.id},o=>{this._handleDrag(o,i,n)})}initDragEventOfRegions(e,i,n,o){this._option.disableTriggerEvent||getDefaultTriggerEventByMode(this._renderMode)&&e.forEach(l=>{i?l.getSeries().forEach(u=>{i(u)&&(u.event.on(this._getZoomTriggerEvent("start"),{level:Event_Bubble_Level.model,filter:({model:d})=>(d==null?void 0:d.id)===u.id},d=>{this._handleDrag(d,n)}),u.event.on("click",{level:Event_Bubble_Level.model,filter:({model:d})=>(d==null?void 0:d.id)===u.id},()=>!this._clickEnable))}):this._bindDragEventAsRegion(this._eventObj,l,n,o)})}_handleDrag(e,i,n){var o,l,u;if(this._option.disableTriggerEvent||(this._clickEnable=!1,!this._zoomableTrigger.parserDragEvent(e.event)))return;const d=(o=n==null?void 0:n.delayType)!==null&&o!==void 0?o:"throttle",f=(l=n==null?void 0:n.delayTime)!==null&&l!==void 0?l:0,g=(u=n==null?void 0:n.realTime)===null||u===void 0||u,_=this._getZoomTriggerEvent("move"),y=this._getZoomTriggerEvent("end"),b=e.event;let S=b.canvasX,v=b.canvasY,A=b.canvasX,x=b.canvasY;const T=delayMap[d](E=>{this._clickEnable=!0;const P=E.event,L=[P.canvasX-A,P.canvasY-x];A=P.canvasX,x=P.canvasY,!g&&i&&i(L,E.event),this._eventObj.emit("panend",{delta:L,model:this}),this._zoomableTrigger.pointerId=null,this._eventObj.off(_,{level:Event_Bubble_Level.chart,source:Event_Source_Type.chart},C),y.forEach(R=>{this._eventObj.off(R,{level:Event_Bubble_Level.chart,source:Event_Source_Type.chart},T),this._eventObj.allow(R)})},f),C=delayMap[d](E=>{if(!this._zoomableTrigger.parserDragEvent(E.event))return;this._clickEnable=!1,y.forEach(R=>this._eventObj.prevent(R,T));const P=E.event,L=[P.canvasX-S,P.canvasY-v];S=P.canvasX,v=P.canvasY,g&&i&&i(L,E.event),this._eventObj.emit("panmove",{delta:L,model:this})},f);this._eventObj.on(_,{level:Event_Bubble_Level.chart,source:Event_Source_Type.chart},C),y.forEach(E=>{this._eventObj.on(E,{level:Event_Bubble_Level.chart,source:Event_Source_Type.chart},T)})}}function projectionName(r,e){return`${PREFIX}_${e}_${r}`}class GeoCoordinate extends BaseComponent{constructor(){super(...arguments),this.type=ComponentTypeEnum.geoCoordinate,this.name=ComponentTypeEnum.geoCoordinate,this.layoutType="none",this.layoutZIndex=LayoutZIndex.Mark,this._projectionSpec={name:projectionName(this.type,this.id),type:"mercator"},this._actualScale=1,this._initialScale=1,this.effect={scaleUpdate:()=>{this.coordinateHelper()}},this._handleChartZoom=(e,i)=>{var n,o,l,u,d,f;let g=e.zoomDelta;const _=this._actualScale;return this._actualScale*=g,this._actualScale<((n=this._spec.zoomLimit)===null||n===void 0?void 0:n.min)?(this._actualScale=(o=this._spec.zoomLimit)===null||o===void 0?void 0:o.min,g=((l=this._spec.zoomLimit)===null||l===void 0?void 0:l.min)/_):this._actualScale>((u=this._spec.zoomLimit)===null||u===void 0?void 0:u.max)&&(this._actualScale=(d=this._spec.zoomLimit)===null||d===void 0?void 0:d.max,g=((f=this._spec.zoomLimit)===null||f===void 0?void 0:f.max)/_),this.zoom(g,[e.zoomX,e.zoomY]),{scale:g,totalScale:this._actualScale}},this.pan=(e=[0,0])=>{var i,n,o;const l=(n=(i=this._projection)===null||i===void 0?void 0:i.translate())!==null&&n!==void 0?n:[0,0];let u=l[0],d=l[1];u+=e[0],d+=e[1],(o=this._projection)===null||o===void 0||o.translate([u,d])}}get longitudeField(){return this._longitudeField}get latitudeField(){return this._latitudeField}get projectionSpec(){return this._projectionSpec}setProjection(e){this._projectionSpec=Object.assign(Object.assign({},e),{name:this._projectionSpec.name})}getZoom(){return this._actualScale}static getSpecInfo(e){if(isNil(e))return null;const i=[];return e.region.forEach((n,o)=>{if(n.coordinate==="geo"){const l=Object.assign(Object.assign({},n),{padding:0});i.push({spec:l,regionIndex:o,type:ComponentTypeEnum.geoCoordinate,specInfoPath:["component","geoCoordinate",o]})}}),i}setAttrFromSpec(){var e,i,n;super.setAttrFromSpec(),this._spec.roam&&this.initZoomable(this.event,this._option.mode),this._projectionSpec=mergeSpec(this._projectionSpec,this._spec.projection),this._projectionSpec.zoom>((e=this._spec.zoomLimit)===null||e===void 0?void 0:e.max)&&(this._projectionSpec.zoom=this._spec.zoomLimit.max),this._projectionSpec.zoom<((i=this._spec.zoomLimit)===null||i===void 0?void 0:i.min)&&(this._projectionSpec.zoom=this._spec.zoomLimit.min),this._actualScale=(n=this._projectionSpec.zoom)!==null&&n!==void 0?n:1,this._initialScale=this._actualScale,this._longitudeField=this._spec.longitudeField,this._latitudeField=this._spec.latitudeField}created(){super.created(),this._regions=this._option.getRegionsInIndex([this._option.regionIndex]),this.initProjection(),this.coordinateHelper(),this.initEvent(),this._initCenterCache()}dispatchZoom(e,i){const n=i||{x:this.getLayoutStartPoint().x+this.getLayoutRect().width/2,y:this.getLayoutStartPoint().y+this.getLayoutRect().height/2},{scale:o,totalScale:l}=this._handleChartZoom({zoomDelta:e,zoomX:n.x,zoomY:n.y});o!==1&&this.event.emit("zoom",{scale:o,scaleCenter:n,totalScale:l,model:this})}initEvent(){this.event.on(ChartEvent.scaleUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===this.id},this.effect.scaleUpdate.bind(this));const{roam:e}=this._spec;e&&(this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom),this.initDragEventOfRegions(this._regions,e.blank?null:()=>!0,this.pan),this._regions.forEach(i=>{i.getSeries().forEach(n=>{n.event.on("zoom",o=>(n.handleZoom(o),!0)),n.event.on("panmove",o=>(n.handlePan(o),!0))})}))}initProjection(){var e;this._projection=new Projection(this._projectionSpec),this._projection.projection!==null||(e=this._option)===null||e===void 0||e.onError("unsupported projection type!")}coordinateHelper(){const e={longitudeField:this._longitudeField,latitudeField:this._latitudeField,dataToPosition:this.dataToPosition.bind(this),dataToLongitude:this.dataToLongitude.bind(this),dataToLatitude:this.dataToLatitude.bind(this),shape:this.shape.bind(this),getCoordinateId:()=>this.id};this._regions.forEach(i=>{i.getSeries().forEach(n=>{n.type===SeriesTypeEnum.map||n.type===SeriesTypeEnum.pictogram?n.setCoordinateHelper(e):(n.setXAxisHelper(Object.assign(Object.assign({},e),{isContinuous:!0,dataToPosition:(o,l)=>{var u;let d=o[0];if(isNil(d)&&(l!=null&&l.datum)){const f=l.datum[n.getDimensionField()[0]];d=(u=this._centerCache.get(f))===null||u===void 0?void 0:u.x}return this.dataToLongitude(d)},valueToPosition:(o,l)=>{var u;if(isNil(o)&&(l!=null&&l.datum)){const d=l.datum[n.getDimensionField()[0]];o=(u=this._centerCache.get(d))===null||u===void 0?void 0:u.x}return this.dataToLongitude(o)},getFields:()=>[this._longitudeField],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>!1})),n.setYAxisHelper(Object.assign(Object.assign({},e),{isContinuous:!0,dataToPosition:(o,l)=>{var u;let d=o[0];if(isNil(d)&&(l!=null&&l.datum)){const f=l.datum[n.getDimensionField()[0]];d=(u=this._centerCache.get(f))===null||u===void 0?void 0:u.y}return this.dataToLatitude(d)},valueToPosition:(o,l)=>{var u;if(isNil(o)&&(l!=null&&l.datum)){const d=l.datum[n.getDimensionField()[0]];o=(u=this._centerCache.get(d))===null||u===void 0?void 0:u.y}return this.dataToLatitude(o)},getFields:()=>[this._latitudeField],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>!1})))})})}onLayoutEnd(e){this.setLayoutRect(this._regions[0].getLayoutRect()),this.setLayoutStartPosition(this._regions[0].getLayoutStartPoint());const{width:i,height:n}=this.getLayoutRect(),{translate:o,scale:l,center:u}=this.evaluateProjection([0,0],[i,n]);o&&this._projection.translate(o),l&&this._projection.scale(l),u&&this._projection.center(u),eachSeries(this._regions,d=>{var f,g;if(d.type===SeriesTypeEnum.map||d.type===SeriesTypeEnum.pictogram){(f=d.areaPath)===null||f===void 0||f.clear();const _=(g=d.getRootMark().getProduct())===null||g===void 0?void 0:g.getGroupGraphicItem();_&&_.attribute.postMatrix&&_.setAttributes({postMatrix:new Matrix})}}),this._actualScale=this._initialScale,super.onLayoutEnd(e)}onRender(e){}changeRegions(e){}_getNeedClearVRenderComponents(){return[]}collectFeatures(){const e=[];return this._regions.forEach(i=>{i.getSeries().forEach(n=>{var o,l;n.type!==SeriesTypeEnum.map&&n.type!==SeriesTypeEnum.pictogram||e.push(...(l=(o=n.getMapViewData())===null||o===void 0?void 0:o.latestData)!==null&&l!==void 0?l:[])})}),e}dataToPosition(e=[]){var i;const n=(i=this._projection)===null||i===void 0?void 0:i.project([e[0],e[1]]);return{x:n==null?void 0:n[0],y:n==null?void 0:n[1]}}dataToLatitude(e){var i;const n=(i=this._projection)===null||i===void 0?void 0:i.project([0,e]);return n==null?void 0:n[1]}dataToLongitude(e){var i;const n=(i=this._projection)===null||i===void 0?void 0:i.project([e,0]);return n==null?void 0:n[0]}zoom(e,i=[0,0]){var n,o,l,u,d,f;let g=(o=(n=this._projection)===null||n===void 0?void 0:n.scale())!==null&&o!==void 0?o:0;const _=(u=(l=this._projection)===null||l===void 0?void 0:l.translate())!==null&&u!==void 0?u:[0,0];let y=_[0],b=_[1];g*=e,y-=(i[0]-y)*(e-1),b-=(i[1]-b)*(e-1),(d=this._projection)===null||d===void 0||d.scale(g),(f=this._projection)===null||f===void 0||f.translate([y,b])}shape(e){return this._projection.shape(e)}invert(e){return this._projection.invert(e)}evaluateProjection(e,i){var n;const o=this._projection.evaluate(e,i,this.collectFeatures());let l=o.translate();const u=o.scale()*this._initialScale,d=(n=this._projectionSpec.center)!==null&&n!==void 0?n:o.invert([i[0]/2,i[1]/2]);return d&&(l=[i[0]/2,i[1]/2]),{translate:l,scale:u,center:d}}_initCenterCache(){this._centerCache||(this._centerCache=new Map),this._regions.forEach(e=>{e.getSeries().forEach(i=>{var n,o;i.type==="map"&&((o=(n=i.getMapViewData())===null||n===void 0?void 0:n.latestData)!==null&&o!==void 0?o:[]).forEach((l={})=>{const u=l[i.getDimensionField()[0]]||l[DEFAULT_MAP_LOOK_UP_KEY],d=i.getDatumCenter(l);u&&isValid(d)&&this._centerCache.set(u,{x:d[0],y:d[1]})})})})}_compareSpec(e,i){const n=super._compareSpec(e,i);return n.reMake||(n.reMake=["roam","longitudeField","latitudeField","projection","zoomLimit"].some(o=>!isEqual(i==null?void 0:i[o],e[o]))),n}release(){super.release(),this._centerCache&&this._centerCache.clear(),this._centerCache=null}}GeoCoordinate.type=ComponentTypeEnum.geoCoordinate,mixin(GeoCoordinate,Zoomable);const registerGeoCoordinate=()=>{Factory$1.registerComponent(GeoCoordinate.type,GeoCoordinate)};class MapSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"area",void 0,void 0,!1)}}class MapSeries extends GeoSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.map,this.transformerConstructor=MapSeriesSpecTransformer,this._areaCache=new Map}getNameMap(){return this._nameMap}get areaPath(){return this._areaCache}setAttrFromSpec(){var e,i;super.setAttrFromSpec(),this.map=this._spec.map,this._nameMap=this._spec.nameMap,this._nameField=this._spec.nameField,this._valueField=this._spec.valueField,this._spec.nameProperty&&(this._nameProperty=this._spec.nameProperty),this._spec.centroidProperty&&(this._centroidProperty=this._spec.centroidProperty),this.map||(e=this._option)===null||e===void 0||e.onError(`map type '${this.map}' is not specified !`),geoSourceMap.get(this.map)||(i=this._option)===null||i===void 0||i.onError(`'${this.map}' data is not registered !`)}initData(){var e,i;super.initData(),registerDataSetInstanceTransform(this._dataSet,"copyDataView",copyDataView),registerDataSetInstanceTransform(this._dataSet,"map",map),registerDataSetInstanceTransform(this._dataSet,"lookup",lookup);const n=geoSourceMap.get(this.map);n||(e=this._option)===null||e===void 0||e.onError("no valid map data found!");const o=new DataView(this._dataSet,{name:`map_${this.id}_data`});o.parse([n],{type:"dataview"}).transform({type:"copyDataView",options:{deep:!0},level:TransformLevel.copyDataView}).transform({type:"map",options:{nameMap:this._nameMap,nameProperty:this._nameProperty}}).transform({type:"lookup",options:{from:()=>{var l;return(l=this._data)===null||l===void 0?void 0:l.getLatestData()},key:DEFAULT_MAP_LOOK_UP_KEY,fields:this._nameField,set:(l,u)=>{u&&Object.keys(u).forEach(d=>{d in l||(l[d]=u[d])})}}}),(i=this._data)===null||i===void 0||i.getDataView().target.addListener("change",o.reRunAllTransform),this._mapViewData=new SeriesData(this._option,o)}compileData(){var e;super.compileData(),(e=this._mapViewData)===null||e===void 0||e.compile()}initMark(){this._pathMark=this._createMark(MapSeries.mark.area,{groupKey:this.getDimensionField()[0],isSeriesMark:!0,skipBeforeLayouted:!0,dataView:this._mapViewData.getDataView(),dataProductId:this._mapViewData.getProductId()},{morph:shouldMarkDoMorph(this._spec,MapSeries.mark.area.name),morphElementKey:this.getDimensionField()[0]})}initMarkStyle(){const e=this._pathMark;e&&(this.setMarkStyle(e,{fill:i=>{var n,o,l,u;return isValid(i[(n=this._seriesField)!==null&&n!==void 0?n:DEFAULT_DATA_SERIES_FIELD])?((o=this._option.globalScale.getScale("color"))!==null&&o!==void 0?o:this._getDefaultColorScale()).scale(i[(l=this._seriesField)!==null&&l!==void 0?l:DEFAULT_DATA_SERIES_FIELD]):(u=this._spec)===null||u===void 0?void 0:u.defaultFillColor},path:this.getPath.bind(this)},"normal",AttributeLevel.Series),e.setPostProcess("fill",i=>isValid(i)?i:this._spec.defaultFillColor),this.setMarkStyle(e,{smoothScale:!0},"normal",AttributeLevel.Built_In))}initLabelMarkStyle(e){e&&(this._labelMark=e,this.setMarkStyle(e,{text:i=>this.getDatumName(i),x:i=>{var n;return(n=this.dataToPosition(i))===null||n===void 0?void 0:n.x},y:i=>{var n;return(n=this.dataToPosition(i))===null||n===void 0?void 0:n.y}}))}initAnimation(){var e;this._pathMark.setAnimationConfig(animationConfig((e=Factory$1.getAnimationInKey("fadeInOut"))===null||e===void 0?void 0:e(),userAnimationConfig("area",this._spec,this._markAttributeContext)))}initTooltip(){this._tooltipHelper=new MapSeriesTooltipHelper(this),this._pathMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pathMark)}getPath(e){var i;const n=this._areaCache.get(e[DEFAULT_DATA_INDEX]);if(n)return n.shape;const o=(i=this._coordinateHelper)===null||i===void 0?void 0:i.shape(e);return this._areaCache.set(e[DEFAULT_DATA_INDEX],{shape:o}),o}onEvaluateEnd(){this._mapViewData.updateData()}getDimensionField(){return[this.nameField]}getMeasureField(){return[this.valueField]}release(){super.release(),this._areaCache.clear(),this._nameMap={},this._mapViewData=null}handleZoom(e){var i,n,o;const{scale:l,scaleCenter:u}=e;if(l===1)return;const d=(i=this.getRootMark().getProduct())===null||i===void 0?void 0:i.getGroupGraphicItem();d&&(d.attribute.postMatrix||d.setAttributes({postMatrix:new Matrix}),d.scale(l,l,u));const f=(o=(n=this._labelMark)===null||n===void 0?void 0:n.getComponent())===null||o===void 0?void 0:o.getProduct();f&&f.evaluate(null,null)}handlePan(e){var i,n,o;const{delta:l}=e;if(l[0]===0&&l[1]===0)return;const u=(i=this.getRootMark().getProduct())===null||i===void 0?void 0:i.getGroupGraphicItem();u&&(u.attribute.postMatrix||u.setAttributes({postMatrix:new Matrix}),u.translate(l[0],l[1]));const d=(o=(n=this._labelMark)===null||n===void 0?void 0:n.getComponent())===null||o===void 0?void 0:o.getProduct();d&&d.evaluate(null,null)}getDatumCenter(e){var i,n,o,l;return this._centroidProperty&&(!((i=e.properties)===null||i===void 0)&&i[this._centroidProperty])?(n=e.properties)===null||n===void 0?void 0:n[this._centroidProperty]:isValidNumber(e.centroidX*e.centroidY)?[e.centroidX,e.centroidY]:!((o=e.properties)===null||o===void 0)&&o.center?e.properties.center:!((l=e.properties)===null||l===void 0)&&l.centroid?e.properties.centroid:[Number.NaN,Number.NaN]}getDatumName(e){var i;if(e[this.nameField])return e[this.nameField];const n=(i=e.properties)===null||i===void 0?void 0:i[this._nameProperty];if(n){if(this._spec.nameMap&&this._spec.nameMap[n])return this._spec.nameMap[n];if(this._spec.showDefaultName||!this._spec.nameMap)return n}return""}dataToPositionX(e){var i;return(i=this._option)===null||i===void 0||i.onError("Method not implemented."),0}dataToPositionY(e){var i;return(i=this._option)===null||i===void 0||i.onError("Method not implemented."),0}viewDataUpdate(e){var i,n,o;super.viewDataUpdate(e),(n=(i=this._mapViewData)===null||i===void 0?void 0:i.getDataView())===null||n===void 0||n.reRunAllTransform(),(o=this._mapViewData)===null||o===void 0||o.updateData()}_getDataIdKey(){return DEFAULT_DATA_INDEX}getActiveMarks(){return[this._pathMark]}}MapSeries.type=SeriesTypeEnum.map,MapSeries.mark=mapSeriesMark,MapSeries.transformerConstructor=MapSeriesSpecTransformer;const registerMapSeries=()=>{registerProjection(),registerGeoCoordinate(),registerPathMark(),Factory$1.registerSeries(MapSeries.type,MapSeries),Factory$1.registerImplement("registerMap",registerMapSource),Factory$1.registerImplement("unregisterMap",unregisterMapSource),registerFadeInOutAnimation()},WaterfallDefaultSeriesField=`${PREFIX}_waterfall_default_seriesField`,waterfall=(r,e)=>{if(!r||r.length===0)return r;const{indexField:i,total:n,groupData:o}=e,l=[],{dimensionValues:u,dimensionData:d}=o().latestData,f=Array.from(u[i]);let g={start:0,end:0,positive:0,negative:0,lastIndex:null};return f.forEach((_,y)=>{const b={start:g.end,end:g.end,lastIndex:g.lastIndex,lastEnd:g.end,index:_,isTotal:!1,positive:g.end,negative:g.end},S=d[_];if(S==null||S.forEach((v,A)=>{A===S.length-1?v[STACK_FIELD_TOTAL_TOP]=!0:delete v[STACK_FIELD_TOTAL_TOP]}),S.length>1){const v=A=>{if(n&&n.type!=="end"){if(n.type==="field"||n.type==="custom")return!!A[n.tagField]}else if(y===f.length-1)return!0;return!1};if(S.some(A=>v(A)))return g=computeTotalWithMultipleData(S,_,b,l,g,f,y,e,v),void l.push(b)}g=computeNormalData(S,_,b,l,g,f,y,e),l.push(b)}),l};function computeTotalWithMultipleData(r,e,i,n,o,l,u,d,f){i.isTotal=!0;const{valueField:g,startAs:_,endAs:y,total:b}=d,S=[],v=[];if(r.forEach(L=>{f(L)?v.push(L):S.push(L)}),v.length===r.length){const L=computeNormalData([r[0]],e,i,n,o,l,u,d);return v.forEach(R=>{R[_]=r[0][_],R[y]=r[0][y],R[g]=r[0][g]}),L}const A=v[0];let{start:x,end:T}=getTotalStartEnd(A,i,n,o,b);i.start=x,i.end=T;let C=x,E=x,P=T-x;return S.forEach(L=>{const R=+L[g];R>=0?(L[_]=+C,C=precisionAdd(C,R)):(L[_]=+E,E=precisionAdd(E,R)),L[y]=precisionAdd(L[_],R),x=precisionAdd(x,R),P=precisionSub(P,R)}),v.forEach(L=>{L[_]=+x,L[y]=precisionAdd(L[_],P),L[g]=P}),Object.assign(Object.assign({},i),{lastIndex:e})}function computeNormalData(r,e,i,n,o,l,u,d){const{valueField:f,startAs:g,endAs:_,total:y,seriesField:b,seriesFieldName:S}=d;return r.forEach(v=>{let A=!1;if(y&&y.type!=="end"){if((y.type==="field"||y.type==="custom")&&v[y.tagField]){A=!0;const{start:x,end:T}=getTotalStartEnd(v,i,n,o,y);v[g]=x,v[_]=T,v[f]=T-x,i.start=x,i.end=T}}else u===l.length-1&&(i.start=0,v[g]=i.start,v[_]=i.end,A=!0);if(!A){const x=+v[f];x>=0?(v[g]=+i.positive,i.positive=precisionAdd(i.positive,x)):(v[g]=+i.negative,i.negative=precisionAdd(i.negative,x)),v[_]=precisionAdd(v[g],x),i.end=precisionAdd(i.end,x)}i.isTotal=A,(isNil(b)||b===WaterfallDefaultSeriesField)&&(v[WaterfallDefaultSeriesField]=A?S.total:+v[f]>=0?S.increase:S.decrease)}),Object.assign(Object.assign({},i),{lastIndex:e})}function getTotalStartEnd(r,e,i,n,o){return o&&o.type!=="end"?o.type==="field"||o.type==="custom"?o.type==="custom"?getTotalInCustomType(r,n,o):o.collectCountField&&!isNil(r[o.collectCountField])?getTotalInCollectField(r,i,e,o):getTotalInField(r,e,o):{start:0,end:0}:getTotalInEndType(e)}function getTotalInEndType(r){return{start:0,end:r.end}}function getTotalInCustomType(r,e,i){return i.product(r,e)}function getTotalInCollectField(r,e,i,n){let o=0,l=i.end;const u=e.length-+r[n.collectCountField],d=e.length-1;return u<0?warn("total.collectCountField error"):o=e[u].start,d<0?warn("total.collectCountField error"):l=e[d].end,{start:o,end:l}}function getTotalInField(r,e,i){let n=0,o=e.end;return i.startField&&!isNil(r[i.startField])&&(n=+r[i.startField]),i.valueField&&!isNil(r[i.valueField])&&(o=precisionAdd(n,+r[i.valueField])),{start:n,end:o}}const waterfallFillTotal=(r,e)=>{if(!r)return r;const{indexField:i,valueField:n,total:o,seriesField:l}=e,u={[i]:(o==null?void 0:o.text)||"total",[n]:r.reduce((d,f)=>precisionAdd(d,+f[n]),0)};return l&&(u[l]="total"),r.push(u),r},Appear_FadeIn$6={type:"fadeIn"},Appear_ScaleIn={type:"growCenterIn"};function waterfallPresetAnimation(r,e){switch(e){case"fadeIn":return Appear_FadeIn$6;case"scaleIn":return Appear_ScaleIn;default:return barGrowIn(r,!1)}}const registerWaterfallAnimation=()=>{Factory$1.registerAnimation("waterfall",(r,e)=>({appear:waterfallPresetAnimation(r,e),enter:barGrowIn(r,!1),exit:barGrowOut(r,!1),disappear:barGrowOut(r,!1)}))};class RuleMark extends BaseMark{constructor(){super(...arguments),this.type=RuleMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x1:0,y1:0})}}RuleMark.type="rule";const registerRuleMark=()=>{Factory$1.registerMark(RuleMark.type,RuleMark),registerRuleGraphic()},waterfallSeriesMark=Object.assign(Object.assign({},barSeriesMark),{leaderLine:{name:"leaderLine",type:"rule"},stackLabel:{name:"stackLabel",type:"text"}}),dimensionTree=(r,e)=>{if(!e.fields)return r;const i={};return{dimensionValues:i,dimensionData:groups(r.map(n=>n.latestData).flat(),e.fields,i)}};function groups(r,e,i){if(e.length===0)return r;const n=e[0],o=e.slice(1);i[n]=new Set;const l=groupBy(r,n,i[n]);return o.length?mapValues(l,(u,d)=>groups(u,o,i)):l}function groupBy(r,e,i){const n={};return r.forEach(o=>{const l=o[e];n[l]||(n[l]=[],i.add(l)),n[l].push(o)}),n}function mapValues(r,e){return Object.keys(r).reduce((i,n)=>(i[n]=e(r[n],n),i),{})}class Group{get fields(){return this._fields}get groupData(){return this._groupData}constructor(e){this._fields=[],this._fields=e}initData(e,i){const n=e.name,o=new DataView(i instanceof DataSet?i:e.dataSet);o.name=n,o.parse([e],{type:"dataview"}),registerDataSetInstanceTransform(i,"dimensionTree",dimensionTree),o.transform({type:"dimensionTree",options:{fields:this._fields}},!1),o.target.addListener("change",this.groupDataUpdate.bind(this)),this._groupData=o}groupDataUpdate(){}getGroupValueInField(e){var i,n,o;const l=(o=(n=(i=this.groupData)===null||i===void 0?void 0:i.latestData)===null||n===void 0?void 0:n.dimensionValues)===null||o===void 0?void 0:o[e];return l?Array.from(l):[]}}class WaterfallSeriesSpecTransformer extends BarSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(e){this._addMarkLabelSpec(e,"bar"),this._addMarkLabelSpec(e,"bar","stackLabel","initStackLabelMarkStyle")}}const labelRuleMap={rect:barLabel,symbol:symbolLabel,arc:pieLabel,point:pointLabel,"line-data":lineDataLabel,stackLabel,line:LineLabel,area:LineLabel,rect3d:barLabel,arc3d:pieLabel,treemap:treemapLabel,venn:vennLabel};function defaultLabelConfig(r,e){var i;const{labelSpec:n}=e;n.overlap&&!isObject$1(n.overlap)&&(n.overlap={});const o=(i=labelRuleMap[r])!==null&&i!==void 0?i:labelRuleMap.point;return e.series.type===SeriesTypeEnum.sankey?sankeyLabel(e):o(e)}function textAttribute(r,e,i,n){var o;const{labelMark:l,series:u}=r,d={text:e[u.getMeasureField()[0]],data:e,textType:(o=r.labelSpec.textType)!==null&&o!==void 0?o:"text"},f=Object.keys(l.stateStyle.normal);for(const g of f){const _=l.getAttribute(g,e);d[g]=_}if(u.type!==SeriesTypeEnum.sankey){const{formatFunc:g,args:_}=getFormatFunction(i,n,d.text,e);g&&(d._originText=d.text,d.text=g(..._,{series:u}))}return d}function uniformLabelPosition(r){return isFunction(r)?e=>r(e.data):r}function symbolLabel(r){var e,i,n;const{series:o,labelSpec:l}=r,u=o.direction==="horizontal"?"right":"top",d=(e=uniformLabelPosition(l.position))!==null&&e!==void 0?e:u;let f;return f=l.overlap!==!1&&{strategy:(n=(i=l.overlap)===null||i===void 0?void 0:i.strategy)!==null&&n!==void 0?n:symbolLabelOverlapStrategy(),avoidBaseMark:d!=="center"},{position:d,overlap:f}}function lineDataLabel(r){const e=symbolLabel(r);return isBoolean(e.overlap)||(e.overlap.avoidBaseMark=!1),e}function symbolLabelOverlapStrategy(){return[{type:"position",position:["top","bottom","right","left","top-right","top-left","bottom-left","bottom-right"]}]}function barLabel(r){var e,i,n,o,l,u;const{series:d,labelSpec:f={}}=r,g=(e=uniformLabelPosition(f.position))!==null&&e!==void 0?e:"outside",_=(i=d.direction)!==null&&i!==void 0?i:"vertical",y=d.direction==="horizontal"?(n=d.getXAxisHelper())===null||n===void 0?void 0:n.isInverse():(o=d.getYAxisHelper())===null||o===void 0?void 0:o.isInverse();let b,S=g;S=A=>{var x;const{data:T}=A,C=(x=typeof f.position=="function"?f.position(T):f.position)!==null&&x!==void 0?x:"outside";if(C==="outside"){const E=d.getMeasureField()[0],P={vertical:["top","bottom"],horizontal:["right","left"]},L=(T==null?void 0:T[E])>=0&&y||(T==null?void 0:T[E])<0&&!y?1:0;return P[_][L]}return C},b=f.overlap!==!1&&{strategy:(u=(l=f.overlap)===null||l===void 0?void 0:l.strategy)!==null&&u!==void 0?u:barLabelOverlapStrategy(d)};let v=!1;return isString(g)&&g.includes("inside")&&(v=!0),{position:S,overlap:b,smartInvert:v}}function barLabelOverlapStrategy(r){return[{type:"position",position:e=>{var i,n;const{data:o}=e,l=r.getMeasureField()[0];return(r.direction==="horizontal"?!((i=r.getXAxisHelper())===null||i===void 0)&&i.isInverse():!((n=r.getYAxisHelper())===null||n===void 0)&&n.isInverse())?(o==null?void 0:o[l])>=0?r.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]:r.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:(o==null?void 0:o[l])>=0?r.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:r.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]}}]}function pointLabel(r){const{labelSpec:e}=r;let i;return i=e.overlap!==!1&&{avoidBaseMark:!1},{position:"center",overlap:i}}function pieLabel(r){var e;const{labelSpec:i}=r,n=(e=uniformLabelPosition(i.position))!==null&&e!==void 0?e:"outside",o=n;let l;return l=i.smartInvert?i.smartInvert:isString(n)&&n.includes("inside"),{position:o,smartInvert:l}}function stackLabelX(r,e,i,n){return e.direction==="horizontal"?i==="middle"?.5*(e.totalPositionX(r,"end")+e.totalPositionY(r,"start")):i==="max"?e.totalPositionX(r,r.end>=r.start?"end":"start")+n:i==="min"?e.totalPositionX(r,r.end>=r.start?"start":"end")-n:e.totalPositionX(r,"end")+(r.end>=r.start?n:-n):e.totalPositionX(r,"index",.5)}function stackLabelY(r,e,i,n){return e.direction==="horizontal"?e.totalPositionY(r,"index",.5):i==="middle"?.5*(e.totalPositionY(r,"end")+e.totalPositionY(r,"start")):i==="max"?e.totalPositionY(r,r.end>=r.start?"end":"start")-n:i==="min"?e.totalPositionY(r,r.end>=r.start?"start":"end")+n:e.totalPositionY(r,"end")+(r.end>=r.start?-n:n)}function stackLabel(r,e,i){const n=r.series,o=r.labelSpec||{},l=n.getTotalData();return{customLayoutFunc:u=>u.map(d=>{const f=o.position||"withChange",g=o.offset||0,_=e?e(d.data):d.data,y=textAttribute(r,_,o.formatMethod);return y.x=stackLabelX(_,n,f,g),y.y=stackLabelY(_,n,f,g),n.direction==="horizontal"?y.textAlign=f==="middle"?"center":f==="withChange"&&_.end-_.start>=0||f==="max"?"left":"right":y.textBaseline=f==="middle"?f:f==="withChange"&&_.end-_.start>=0||f==="max"?"bottom":"top",i==null||i(d,_,y),createText(Object.assign(Object.assign({},y),{id:d.id}))}),dataFilter:u=>{const d=[];return l.forEach(f=>{const g=u.find(_=>{var y;return f.index===((y=_.data)===null||y===void 0?void 0:y[n.getDimensionField()[0]])});g&&(g.data=f,d.push(g))}),d},overlap:{strategy:[]}}}function treemapLabel(r){return{customLayoutFunc:(e,i)=>i,overlap:!1}}function vennLabel(r){return{customLayoutFunc:(e,i)=>i,smartInvert:!0}}function LineLabel(r){var e,i,n,o;const{labelSpec:l,series:u}=r,d=(n=(i=(e=u.getViewDataStatistics)===null||e===void 0?void 0:e.call(u).latestData)===null||i===void 0?void 0:i[u.getSeriesField()])===null||n===void 0?void 0:n.values,f=d?d.map((g,_)=>({[u.getSeriesField()]:g,index:_})):[];return{position:(o=l.position)!==null&&o!==void 0?o:"end",data:f}}function sankeyLabel(r){var e,i,n;const{series:o,labelSpec:l={}}=r,u=(e=uniformLabelPosition(l.position))!==null&&e!==void 0?e:"outside",d=o.direction;let f,g=u;return isString(u)&&(d==="vertical"?g=u==="inside-start"?_=>"inside-left":u==="inside-middle"?_=>"center":u==="inside-end"?_=>"inside-right":_=>"bottom":u==="inside-start"?g=_=>"inside-left":u==="inside-middle"?g=_=>"center":u==="inside-end"?g=_=>"inside-right":u==="outside"&&(g=_=>"right")),f=l.overlap!==!1&&(!isString(u)||!u.includes("inside"))&&{strategy:(n=(i=l.overlap)===null||i===void 0?void 0:i.strategy)!==null&&n!==void 0?n:sankeyLabelOverlapStrategy(o)},{position:g,overlap:f,smartInvert:!1,offset:0,syncState:!0}}function sankeyLabelOverlapStrategy(r){return[{type:"position",position:e=>r.direction==="horizontal"?["right","left"]:["bottom","top"]}]}class WaterfallSeries extends BarSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.waterfall,this.transformerConstructor=WaterfallSeriesSpecTransformer,this._leaderLineMark=null,this._stackLabelMark=null,this._labelMark=null}getTotalData(){var e;return(e=this._totalData)===null||e===void 0?void 0:e.getLatestData()}initGroups(){const e=this.getGroupFields();e&&e.length&&(this._groups=new Group(e),this._data&&this._groups.initData(this._data.getDataView(),this._dataSet))}setAttrFromSpec(){super.setAttrFromSpec(),this.setValueFieldToStack(),this._fieldX=[this._fieldX[0]],this._fieldY=[this._fieldY[0]],isNil(this._seriesField)&&(this._seriesField=WaterfallDefaultSeriesField)}getSeriesKeys(){return this._seriesField===WaterfallDefaultSeriesField?[this._theme.seriesFieldName.increase,this._theme.seriesFieldName.decrease,this._theme.seriesFieldName.total]:super.getSeriesKeys()}initData(){var e;super.initData(),registerDataSetInstanceTransform(this._dataSet,"waterfallFillTotal",waterfallFillTotal),registerDataSetInstanceTransform(this._dataSet,"waterfall",waterfall),(isNil(this._spec.total)||this._spec.total.type==="end")&&((e=this._rawData)===null||e===void 0||e.transform({type:"waterfallFillTotal",options:{indexField:this.getGroupFields()[0],valueField:this.getStackValueField(),seriesField:this.getSeriesField(),seriesFieldName:this._theme.seriesFieldName,total:this._spec.total}},!1));const i=dataViewFromDataView(this.getViewData(),this._dataSet,{name:`${PREFIX}_series_${this.id}_totalData`});this.getViewData().target.removeListener("change",i.reRunAllTransform),this._totalData=new SeriesData(this._option,i),i.transform({type:"waterfall",options:{indexField:this.getGroupFields()[0],valueField:this.getStackValueField(),seriesField:this.getSeriesField(),seriesFieldName:this._theme.seriesFieldName,startAs:STACK_FIELD_START,endAs:STACK_FIELD_END,total:this._spec.total,groupData:()=>this.getGroups().groupData}},!1)}compileData(){var e;super.compileData(),(e=this._totalData)===null||e===void 0||e.compile()}initAnimation(){var e,i,n,o;const l={yField:this.direction==="horizontal"?this._fieldY[0]:this.getStackValueField(),xField:this.direction==="horizontal"?this.getStackValueField():this._fieldX[0],direction:this.direction,growFrom:()=>{var f,g;return this.direction==="horizontal"?(f=this._xAxisHelper)===null||f===void 0?void 0:f.getScale(0).scale(0):(g=this._yAxisHelper)===null||g===void 0?void 0:g.getScale(0).scale(0)}},u=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset,d=getGroupAnimationParams(this);this._barMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("waterfall"))===null||n===void 0?void 0:n(l,u),userAnimationConfig("bar",this._spec,this._markAttributeContext),d)),this._leaderLineMark&&this._leaderLineMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("fadeInOut"))===null||o===void 0?void 0:o(),userAnimationConfig("leaderLine",this._spec,this._markAttributeContext)))}viewDataUpdate(e){this._totalData.getDataView().reRunAllTransform(),this._totalData.updateData(),super.viewDataUpdate(e)}addViewDataFilter(e){}reFilterViewData(){}onEvaluateEnd(e){super.onEvaluateEnd(e),this._totalData.updateData()}initMark(){var e,i;super.initMark();const n=this._createMark(WaterfallSeries.mark.leaderLine,{key:"index",stateSort:(e=this._spec.leaderLine)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.leaderLine)===null||i===void 0?void 0:i.customShape});n&&(this._leaderLineMark=n,n.setDataView(this._totalData.getDataView(),this._totalData.getProductId()))}initLabelMarkStyle(e){var i;if(e)return!this._labelMark&&(!((i=this._spec.label)===null||i===void 0)&&i.visible)?(super.initLabelMarkStyle(e),void(this._labelMark=e)):void 0}initStackLabelMarkStyle(e){e&&(this._stackLabelMark=e,e.skipEncode=!0,e.setRule("stackLabel"),e.setDataView(this._totalData.getDataView(),this._totalData.getProductId()),this.setMarkStyle(e,{text:i=>{var n;return((n=this._spec.stackLabel)===null||n===void 0?void 0:n.valueType)==="absolute"?i.end:precisionSub(i.end,i.start)}}))}initTotalLabelMarkStyle(e){this.setMarkStyle(e,{text:i=>{var n;return"end"in i?((n=this._spec.totalLabel)===null||n===void 0?void 0:n.valueType)==="absolute"?i.end:precisionSub(i.end,i.start):this.direction==="horizontal"?i[this._fieldX[0]]:i[this._fieldY[0]]}})}getTotalLabelComponentStyle(e){return stackLabel(Object.assign(Object.assign({},e),{series:this,labelSpec:this._spec.totalLabel}),i=>{const n=this.direction==="vertical"?i[this._fieldX[0]]:i[this._fieldY[0]];return this._totalData.getLatestData().find(o=>o.index===n)})}totalPositionX(e,i,n=.5){const{dataToPosition:o,getBandwidth:l}=this._xAxisHelper;return this._direction==="horizontal"?valueInScaleRange(o([e[i]],{bandPosition:this._bandPosition})):o([e[i]],{bandPosition:this._bandPosition})+.5*l(0)-this._barMark.getAttribute("width",e)*(.5-n)}totalPositionY(e,i,n=.5){const{dataToPosition:o,getBandwidth:l}=this._yAxisHelper;return this._direction==="horizontal"?o([e[i]],{bandPosition:this._bandPosition})+.5*l(0)-this._barMark.getAttribute("height",e)*(.5-n):valueInScaleRange(o([e[i]],{bandPosition:this._bandPosition}))}initMarkStyle(){super.initMarkStyle(),this._leaderLineMark&&(this._direction==="horizontal"?this.setMarkStyle(this._leaderLineMark,{visible:e=>!isNil(e.lastIndex),x:e=>this.totalPositionX(e,"lastEnd",0),x1:e=>this.totalPositionX(e,e.isTotal?"end":"start",0),y:e=>e.lastIndex?this.totalPositionY(e,"lastIndex",1):0,y1:e=>this.totalPositionY(e,"index",0)},"normal",AttributeLevel.Series):this.setMarkStyle(this._leaderLineMark,{visible:e=>!isNil(e.lastIndex),x:e=>e.lastIndex?this.totalPositionX(e,"lastIndex",1):0,x1:e=>this.totalPositionX(e,"index",0),y:e=>this.totalPositionY(e,"lastEnd",0),y1:e=>this.totalPositionY(e,e.isTotal?"end":"start",0)},"normal",AttributeLevel.Series))}}WaterfallSeries.type=SeriesTypeEnum.waterfall,WaterfallSeries.mark=waterfallSeriesMark,WaterfallSeries.transformerConstructor=WaterfallSeriesSpecTransformer;const registerWaterfallSeries=()=>{registerRuleMark(),registerRectMark(),registerWaterfallAnimation(),registerFadeInOutAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(WaterfallSeries.type,WaterfallSeries)},BOX_PLOT_OUTLIER_VALUE_FIELD=`${PREFIX}_BOX_PLOT_OUTLIER_VALUE`;var BOX_PLOT_TOOLTIP_KEYS;(function(r){r.OUTLIER="outlier",r.MAX="max",r.MIN="min",r.MEDIAN="median",r.Q1="q1",r.Q3="q3",r.SERIES_FIELD="seriesField"})(BOX_PLOT_TOOLTIP_KEYS||(BOX_PLOT_TOOLTIP_KEYS={}));const foldOutlierData=(r,e)=>{const i=[],{outliersField:n,dimensionField:o}=e;return(r[0].latestData||[]).forEach(l=>{let u=l[n];isArray(u)||(u=[u]),i.push(...u.map(d=>{const f={[BOX_PLOT_OUTLIER_VALUE_FIELD]:d};return o.forEach(g=>{f[g]=l[g]}),f}))}),i};class BoxPlotSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.getContentKey=e=>i=>{if(this.isOutlierMark(i))return e===BOX_PLOT_TOOLTIP_KEYS.OUTLIER?this.series.getOutliersField():e===BOX_PLOT_TOOLTIP_KEYS.SERIES_FIELD?this.series.getSeriesField():null;switch(e){case BOX_PLOT_TOOLTIP_KEYS.MIN:return this.series.getMinField();case BOX_PLOT_TOOLTIP_KEYS.MAX:return this.series.getMaxField();case BOX_PLOT_TOOLTIP_KEYS.MEDIAN:return this.series.getMedianField();case BOX_PLOT_TOOLTIP_KEYS.Q1:return this.series.getQ1Field();case BOX_PLOT_TOOLTIP_KEYS.Q3:return this.series.getQ3Field();case BOX_PLOT_TOOLTIP_KEYS.SERIES_FIELD:return this.series.getSeriesField()}return null},this.getContentValue=e=>i=>{if(this.isOutlierMark(i))return e===BOX_PLOT_TOOLTIP_KEYS.OUTLIER?i[BOX_PLOT_OUTLIER_VALUE_FIELD]:e===BOX_PLOT_TOOLTIP_KEYS.SERIES_FIELD?i[this.series.getSeriesField()]:null;switch(e){case BOX_PLOT_TOOLTIP_KEYS.MIN:return i[this.series.getMinField()];case BOX_PLOT_TOOLTIP_KEYS.MAX:return i[this.series.getMaxField()];case BOX_PLOT_TOOLTIP_KEYS.MEDIAN:return i[this.series.getMedianField()];case BOX_PLOT_TOOLTIP_KEYS.Q1:return i[this.series.getQ1Field()];case BOX_PLOT_TOOLTIP_KEYS.Q3:return i[this.series.getQ3Field()];case BOX_PLOT_TOOLTIP_KEYS.SERIES_FIELD:return i[this.series.getSeriesField()]}return null},this.shapeColorCallback=e=>this.series.getShaftShape()==="line"?this.series.getMarkInName("boxPlot").getAttribute("stroke",e):this.series.getMarkInName("boxPlot").getAttribute("fill",e),this.getOutlierFillColor=e=>{var i;const n=this.series.getOutliersStyle();return(i=n==null?void 0:n.fill)!==null&&i!==void 0?i:this.series.getMarkInName("outlier").getAttribute("fill",e)},this.isOutlierMark=e=>isValid(e[BOX_PLOT_OUTLIER_VALUE_FIELD])}getDefaultContentList(e){return[{key:this.getContentKey(BOX_PLOT_TOOLTIP_KEYS.OUTLIER),value:this.getContentValue(BOX_PLOT_TOOLTIP_KEYS.OUTLIER),shapeType:this.shapeTypeCallback,shapeColor:this.getOutlierFillColor,shapeStroke:this.getOutlierFillColor},{key:this.getContentKey(BOX_PLOT_TOOLTIP_KEYS.MAX),value:this.getContentValue(BOX_PLOT_TOOLTIP_KEYS.MAX)},{key:this.getContentKey(BOX_PLOT_TOOLTIP_KEYS.Q3),value:this.getContentValue(BOX_PLOT_TOOLTIP_KEYS.Q3)},{key:this.getContentKey(BOX_PLOT_TOOLTIP_KEYS.MEDIAN),value:this.getContentValue(BOX_PLOT_TOOLTIP_KEYS.MEDIAN)},{key:this.getContentKey(BOX_PLOT_TOOLTIP_KEYS.Q1),value:this.getContentValue(BOX_PLOT_TOOLTIP_KEYS.Q1)},{key:this.getContentKey(BOX_PLOT_TOOLTIP_KEYS.MIN),value:this.getContentValue(BOX_PLOT_TOOLTIP_KEYS.MIN)},{key:this.getContentKey(BOX_PLOT_TOOLTIP_KEYS.SERIES_FIELD),value:this.getContentValue(BOX_PLOT_TOOLTIP_KEYS.SERIES_FIELD)}]}}class BoxPlotMark extends BaseMark{constructor(){super(...arguments),this.type=BoxPlotMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:2,boxWidth:30,shaftWidth:20,shaftShape:"line"})}_initProduct(e){const i=this.getStyle("shaftShape"),n=this.getVGrammarView(),o=this.getProductId(),l=i==="bar"?"barBoxplot":"boxplot",u=this.getStyle("direction");this._product=n.glyph(l,e??n.rootMark).id(o).configureGlyph({direction:u}),this._compiledProductId=o}}BoxPlotMark.type="boxPlot";const registerBoxPlotMark=()=>{Factory$1.registerMark(BoxPlotMark.type,BoxPlotMark),registerBoxplotGlyph(),registerBarBoxplotGlyph()},boxPlotSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{boxPlot:{name:"boxPlot",type:"boxPlot"},outlier:{name:"outlier",type:"symbol"}});class BoxPlotSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.boxPlot}getMinField(){return this._minField}getMaxField(){return this._maxField}getQ1Field(){return this._q1Field}getMedianField(){return this._medianField}getQ3Field(){return this._q3Field}getOutliersField(){return this._outliersField}getShaftShape(){return this._shaftShape}getBoxFillColor(){return this._boxFillColor}getStrokeColor(){return this._strokeColor}getOutliersStyle(){return this._outliersStyle}setAttrFromSpec(){var e,i,n,o,l;super.setAttrFromSpec();const u=(i=(e=this._spec.boxPlot)===null||e===void 0?void 0:e.style)!==null&&i!==void 0?i:{};this._minField=this._spec.minField,this._maxField=this._spec.maxField,this._q1Field=this._spec.q1Field,this._medianField=this._spec.medianField,this._q3Field=this._spec.q3Field,this._outliersField=this._spec.outliersField,this._lineWidth=(n=u.lineWidth)!==null&&n!==void 0?n:2,this._boxWidth=u.boxWidth,this._shaftShape=(o=u.shaftShape)!==null&&o!==void 0?o:"line",this._shaftWidth=u.shaftWidth,this._boxFillColor=u.boxFill,this._strokeColor=u.stroke,this._shaftFillOpacity=this._shaftShape==="bar"?(l=u.shaftFillOpacity)!==null&&l!==void 0?l:.5:void 0,this._outliersStyle=this._spec.outliersStyle}initMark(){const e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._boxPlotMark=this._createMark(BoxPlotSeries.mark.boxPlot,{groupKey:this._seriesField,isSeriesMark:!0},e),this._outlierMark=this._createMark(BoxPlotSeries.mark.outlier,{key:DEFAULT_DATA_INDEX,groupKey:this._seriesField,dataView:this._outlierDataView.getDataView(),dataProductId:this._outlierDataView.getProductId()},e)}initMarkStyle(){var e,i,n,o,l;const u=this._boxPlotMark;if(u){const f={direction:this._direction,lineWidth:this._lineWidth,shaftShape:this._shaftShape,fill:(e=this._boxFillColor)!==null&&e!==void 0?e:this._shaftShape==="line"?"#FFF":this.getColorAttribute(),minMaxFillOpacity:this._shaftFillOpacity,stroke:(i=this._strokeColor)!==null&&i!==void 0?i:this._shaftShape==="line"?this.getColorAttribute():"#000"},g=this._direction==="horizontal"?Object.assign(Object.assign({y:this.dataToPositionY.bind(this)},f),{boxHeight:()=>{var _;return(_=this._boxWidth)!==null&&_!==void 0?_:this._getMarkWidth()},ruleHeight:()=>{var _;return(_=this._shaftWidth)!==null&&_!==void 0?_:this._getMarkWidth()},q1q3Height:()=>{var _;return(_=this._boxWidth)!==null&&_!==void 0?_:this._getMarkWidth()},minMaxHeight:()=>{var _;return(_=this._shaftWidth)!==null&&_!==void 0?_:this._getMarkWidth()}}):Object.assign(Object.assign({x:this.dataToPositionX.bind(this)},f),{boxWidth:()=>{var _;return(_=this._boxWidth)!==null&&_!==void 0?_:this._getMarkWidth()},ruleWidth:()=>{var _;return(_=this._shaftWidth)!==null&&_!==void 0?_:this._getMarkWidth()},q1q3Width:()=>{var _;return(_=this._boxWidth)!==null&&_!==void 0?_:this._getMarkWidth()},minMaxWidth:()=>{var _;return(_=this._shaftWidth)!==null&&_!==void 0?_:this._getMarkWidth()}});this.setMarkStyle(u,g,STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}const d=this._outlierMark;d&&this.setMarkStyle(d,{fill:(o=(n=this._outliersStyle)===null||n===void 0?void 0:n.fill)!==null&&o!==void 0?o:this.getColorAttribute(),size:isNumber((l=this._outliersStyle)===null||l===void 0?void 0:l.size)?this._outliersStyle.size:10,symbolType:"circle"},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}initBoxPlotMarkStyle(){var e,i;const n=this._boxPlotMark,o=this._direction==="horizontal"?this._xAxisHelper:this._yAxisHelper;if(n&&o){const{dataToPosition:u}=o,d=(e=o==null?void 0:o.getScale)===null||e===void 0?void 0:e.call(o,0);this.setMarkStyle(n,{min:f=>valueInScaleRange(u(this.getDatumPositionValues(f,this._minField),{bandPosition:this._bandPosition}),d),q1:f=>valueInScaleRange(u(this.getDatumPositionValues(f,this._q1Field),{bandPosition:this._bandPosition}),d),median:f=>valueInScaleRange(u(this.getDatumPositionValues(f,this._medianField),{bandPosition:this._bandPosition}),d),q3:f=>valueInScaleRange(u(this.getDatumPositionValues(f,this._q3Field),{bandPosition:this._bandPosition}),d),max:f=>valueInScaleRange(u(this.getDatumPositionValues(f,this._maxField),{bandPosition:this._bandPosition}),d)},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}const l=this._outlierMark;if(l&&o){const{dataToPosition:u}=o,d=(i=o==null?void 0:o.getScale)===null||i===void 0?void 0:i.call(o,0),f=this._direction==="horizontal"?{y:this.dataToPositionY.bind(this),x:g=>valueInScaleRange(u(this.getDatumPositionValues(g,BOX_PLOT_OUTLIER_VALUE_FIELD),{bandPosition:this._bandPosition}),d)}:{x:this.dataToPositionX.bind(this),y:g=>valueInScaleRange(u(this.getDatumPositionValues(g,BOX_PLOT_OUTLIER_VALUE_FIELD),{bandPosition:this._bandPosition}),d)};this.setMarkStyle(l,f,STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}}initData(){if(super.initData(),!this._data)return;registerDataSetInstanceTransform(this._dataSet,"foldOutlierData",foldOutlierData),registerDataSetInstanceTransform(this._dataSet,"addVChartProperty",addVChartProperty);const e=new DataView(this._dataSet,{name:`${this.type}_outlier_${this.id}_data`});e.parse([this.getViewData()],{type:"dataview"}),e.name=`${PREFIX}_series_${this.id}_outlierData`,e.transform({type:"foldOutlierData",options:{dimensionField:this._direction==="horizontal"?this._fieldY:this._fieldX,outliersField:this._outliersField}}),e.transform({type:"addVChartProperty",options:{beforeCall:initKeyMap.bind(this),call:addDataKey}},!1),this._outlierDataView=new SeriesData(this._option,e)}compileData(){var e;super.compileData(),(e=this._outlierDataView)===null||e===void 0||e.compile()}init(e){super.init(e),this.initBoxPlotMarkStyle()}_getMarkWidth(){if(this._autoBoxWidth)return this._autoBoxWidth;const e=this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper,i=this._direction==="horizontal"?this._fieldY:this._fieldX,n=e.getBandwidth(i.length-1)/i.length;return this._autoBoxWidth=n,this._autoBoxWidth}onLayoutEnd(e){super.onLayoutEnd(e),this._autoBoxWidth=null}_initAnimationSpec(e={}){const i=merge$1({},e);return["appear","enter","update","exit","disappear"].forEach(n=>{i[n]&&i[n].type==="scaleIn"?i[n].type=this._shaftShape==="line"?"boxplotScaleIn":"barBoxplotScaleIn":i[n]&&i[n].type==="scaleOut"&&(i[n].type=this._shaftShape==="line"?"boxplotScaleOut":"barBoxplotScaleOut")}),i}initAnimation(){var e,i,n,o,l,u,d;const f=getGroupAnimationParams(this);if(this._boxPlotMark){const g=this._initAnimationSpec((e=Factory$1.getAnimationInKey("scaleInOut"))===null||e===void 0?void 0:e()),_=this._initAnimationSpec(userAnimationConfig("boxPlot",this._spec,this._markAttributeContext));this._boxPlotMark.setAnimationConfig(animationConfig(g,_,f))}if(this._outlierMark){const g={appear:(i=this._spec.animationAppear)===null||i===void 0?void 0:i.symbol,disappear:(n=this._spec.animationDisappear)===null||n===void 0?void 0:n.symbol,enter:(o=this._spec.animationEnter)===null||o===void 0?void 0:o.symbol,exit:(l=this._spec.animationExit)===null||l===void 0?void 0:l.symbol,update:(u=this._spec.animationUpdate)===null||u===void 0?void 0:u.symbol};this._outlierMark.setAnimationConfig(animationConfig((d=Factory$1.getAnimationInKey("scaleInOut"))===null||d===void 0?void 0:d(),g,f))}}initTooltip(){this._tooltipHelper=new BoxPlotSeriesTooltipHelper(this),this._boxPlotMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._boxPlotMark),this._outlierMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._outlierMark)}getStatisticFields(){const e=super.getStatisticFields(),i=e.find(n=>n.key===this._outliersField);return i&&(i.operations=["array-min","array-max"]),e}onEvaluateEnd(e){super.onEvaluateEnd(e),this._outlierDataView.updateData()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._boxPlotMark]}}BoxPlotSeries.type=SeriesTypeEnum.boxPlot,BoxPlotSeries.mark=boxPlotSeriesMark;const registerBoxplotSeries=()=>{registerBoxPlotMark(),registerSymbolMark(),registerScaleInOutAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(BoxPlotSeries.type,BoxPlotSeries)};class TextMark extends BaseMark{getTextType(){return this._textType}constructor(e,i){super(e,i),this.type=TextMark.type,this._textType="text"}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{angle:0,textAlign:"center",lineWidth:0,textConfig:[]})}initStyleWithSpec(e,i){super.initStyleWithSpec(e,i),e.textType&&(this._textType=e.textType)}compileEncode(){super.compileEncode(),this._textType==="rich"&&this._product.encodeState("group",{textType:this._textType})}}TextMark.type="text";const registerTextMark=()=>{Factory$1.registerMark(TextMark.type,TextMark),registerTextGraphic(),registerRichTextGraphic()};function setRectLabelPos(r,e,i,n,o,l,u,d,f){r.setMarkStyle(e,{textAlign:g=>{if(f()==="vertical")return"center";const _=o(g),y=l(g);if(i==="middle")return"center";if(_>=y){if(i==="start")return"left";if(i==="end")return"right";if(i==="outside")return"left"}else{if(i==="start")return"right";if(i==="end")return"left";if(i==="outside")return"right"}return"center"},textBaseline:g=>{if(f()==="horizontal")return"middle";const _=u(g),y=d(g);if(i==="middle")return"middle";if(y>=_){if(i==="start")return"bottom";if(i==="end")return"top";if(i==="outside")return"bottom"}else{if(i==="start")return"top";if(i==="end")return"bottom";if(i==="outside")return"top"}return"middle"}}),r.setMarkStyle(e,{x:g=>{const _=f(),y=o(g),b=l(g);if(_==="vertical"||i==="middle")return(y+b)/2;if(y>=b){if(i==="start")return b+n;if(i==="end")return y-n;if(i==="outside")return y+n}else{if(i==="start")return b-n;if(i==="end")return y+n;if(i==="outside")return y-n}return(y+b)/2},y:g=>{const _=f(),y=u(g),b=d(g);if(_==="horizontal"||i==="middle")return(y+b)/2;if(y>=b){if(i==="start")return b+n;if(i==="end")return y-n;if(i==="outside")return y+n}else{if(i==="start")return b-n;if(i==="end")return y+n;if(i==="outside")return y-n}return(y+b)/2}},"normal",AttributeLevel.Series)}class RangeColumnSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this._getMeasureData=e=>this.series.getSpec().direction==="horizontal"?e[this.series.getSpec().xField[0]]+"-"+e[this.series.getSpec().xField[1]]:e[this.series.getSpec().yField[0]]+"-"+e[this.series.getSpec().yField[1]]}}const rangeColumnGrowIn=r=>({type:"growCenterIn",options:{direction:r.direction==="horizontal"?"x":"y"}}),Appear_FadeIn$5={type:"fadeIn"},rangeColumnGrowOut=r=>({type:"growCenterOut",options:{direction:r.direction==="horizontal"?"x":"y"}});function rangeColumnPresetAnimation(r,e){return e==="fadeIn"?Appear_FadeIn$5:rangeColumnGrowIn(r)}const registerRangeColumnAnimation=()=>{Factory$1.registerAnimation("rangeColumn",(r,e)=>({appear:rangeColumnPresetAnimation(r,e),enter:rangeColumnGrowIn(r),exit:rangeColumnGrowOut(r),disappear:rangeColumnGrowOut(r)}))},rangeColumnSeriesMark=Object.assign(Object.assign({},barSeriesMark),{minLabel:{name:"minLabel",type:"text"},maxLabel:{name:"maxLabel",type:"text"}}),rangeColumn3dSeriesMark=Object.assign(Object.assign({},bar3dSeriesMark),{minLabel:{name:"minLabel",type:"text"},maxLabel:{name:"maxLabel",type:"text"}});class RangeColumnSeriesSpecTransformer extends BarSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(e){var i;((i=e.label)===null||i===void 0?void 0:i.position)!=="bothEnd"&&this._addMarkLabelSpec(e,"bar")}}class RangeColumnSeries extends BarSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.rangeColumn,this._barMarkType="rect",this._barName=SeriesTypeEnum.bar,this.transformerConstructor=RangeColumnSeriesSpecTransformer}initMark(){var e,i,n,o,l,u,d,f,g,_;this._initBarBackgroundMark();const y=(e=this._spec.label)===null||e===void 0?void 0:e.position;this._barMark=this._createMark(RangeColumnSeries.mark.bar,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(i=this._spec.bar)===null||i===void 0?void 0:i.stateSort},{setCustomizedShape:(n=this._spec.bar)===null||n===void 0?void 0:n.customShape,morph:shouldMarkDoMorph(this._spec,RangeColumnSeries.mark.bar.name),morphElementKey:this.getDimensionField()[0]}),((o=this._spec.label)===null||o===void 0?void 0:o.visible)!==!1&&y==="bothEnd"&&(((u=(l=this._spec.label)===null||l===void 0?void 0:l.minLabel)===null||u===void 0?void 0:u.visible)!==!1&&(this._minLabelMark=this._createMark(RangeColumnSeries.mark.minLabel,{markSpec:(d=this._spec.label)===null||d===void 0?void 0:d.minLabel})),((g=(f=this._spec.label)===null||f===void 0?void 0:f.maxLabel)===null||g===void 0?void 0:g.visible)!==!1&&(this._maxLabelMark=this._createMark(RangeColumnSeries.mark.maxLabel,{markSpec:(_=this._spec.label)===null||_===void 0?void 0:_.maxLabel})))}initMarkStyle(){var e,i;super.initMarkStyle(),this._initLabelMarkPos(this._minLabelMark,(e=this._spec.label)===null||e===void 0?void 0:e.minLabel,0,"end"),this._initLabelMarkPos(this._maxLabelMark,(i=this._spec.label)===null||i===void 0?void 0:i.maxLabel,1,"start")}_initLabelMarkPos(e,i,n,o){var l,u,d,f;if(e){this.setMarkStyle(e,{fill:(u=(l=i==null?void 0:i.style)===null||l===void 0?void 0:l.fill)!==null&&u!==void 0?u:this.getColorAttribute(),text:y=>{const b=this._spec.direction==="horizontal"?y[this._spec.xField[n]]:y[this._spec.yField[n]];return i!=null&&i.formatMethod?i.formatMethod(b,y):b}});const g=(d=i==null?void 0:i.position)!==null&&d!==void 0?d:o,_=(f=i==null?void 0:i.offset)!==null&&f!==void 0?f:this._direction==="vertical"?-20:-25;setRectLabelPos(this,e,g,_,y=>this._barMark.getAttribute("x",y),y=>this._direction==="vertical"?this._barMark.getAttribute("x",y)+this._barMark.getAttribute("width",y):this._barMark.getAttribute("x1",y),y=>this._barMark.getAttribute("y",y),y=>this._direction==="vertical"?this._barMark.getAttribute("y1",y):this._barMark.getAttribute("y",y)+this._barMark.getAttribute("height",y),()=>this._direction)}}initLabelMarkStyle(e){e&&(this.setMarkStyle(e,{text:i=>{let n,o;return this._spec.direction==="horizontal"?(n=i[this._spec.xField[0]],o=i[this._spec.xField[1]]):(n=i[this._spec.yField[0]],o=i[this._spec.yField[1]]),n+"-"+o},z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._labelMark=e)}_dataToPosX(e){return this._xAxisHelper.dataToPosition(this.getDatumPositionValues(e,this._spec.xField[0]),{bandPosition:this._bandPosition})}_dataToPosX1(e){return this._xAxisHelper.dataToPosition(this.getDatumPositionValues(e,this._spec.xField[1]),{bandPosition:this._bandPosition})}_dataToPosY(e){return this._yAxisHelper.dataToPosition(this.getDatumPositionValues(e,this._spec.yField[0]),{bandPosition:this._bandPosition})}_dataToPosY1(e){return this._yAxisHelper.dataToPosition(this.getDatumPositionValues(e,this._spec.yField[1]),{bandPosition:this._bandPosition})}initAnimation(){var e,i,n,o,l;const u=getGroupAnimationParams(this),d=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this._barMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("rangeColumn"))===null||n===void 0?void 0:n({direction:this.direction},d),userAnimationConfig("bar",this._spec,this._markAttributeContext),u)),this._minLabelMark&&this._minLabelMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("fadeInOut"))===null||o===void 0?void 0:o(),userAnimationConfig("label",this._spec,this._markAttributeContext),u)),this._maxLabelMark&&this._maxLabelMark.setAnimationConfig(animationConfig((l=Factory$1.getAnimationInKey("fadeInOut"))===null||l===void 0?void 0:l(),userAnimationConfig("label",this._spec,this._markAttributeContext),u))}initTooltip(){this._tooltipHelper=new RangeColumnSeriesTooltipHelper(this),this._barMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._barMark),this._minLabelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._minLabelMark),this._maxLabelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._maxLabelMark),this._labelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._labelMark)}}RangeColumnSeries.type=SeriesTypeEnum.rangeColumn,RangeColumnSeries.mark=rangeColumnSeriesMark,RangeColumnSeries.transformerConstructor=RangeColumnSeriesSpecTransformer;const registerRangeColumnSeries=()=>{registerRectMark(),registerTextMark(),registerRangeColumnAnimation(),registerFadeInOutAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(RangeColumnSeries.type,RangeColumnSeries)};class RangeColumn3dSeries extends RangeColumnSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.rangeColumn3d,this._barMarkType="rect3d",this._barName=SeriesTypeEnum.bar3d}}RangeColumn3dSeries.type=SeriesTypeEnum.rangeColumn3d,RangeColumn3dSeries.mark=rangeColumn3dSeriesMark;const registerRangeColumn3dSeries=()=>{registerRect3dMark(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(RangeColumn3dSeries.type,RangeColumn3dSeries)};class RangeAreaSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this._getMeasureData=e=>this.series.getSpec().direction==="horizontal"?e[this.series.getSpec().xField[0]]+"-"+e[this.series.getSpec().xField[1]]:e[this.series.getSpec().yField[0]]+"-"+e[this.series.getSpec().yField[1]]}}const rangeAreaSeriesMark=Object.assign({},areaSeriesMark);class RangeAreaSeries extends AreaSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.rangeArea}initMark(){var e;const{customShape:i,stateSort:n}=(e=this._spec.area)!==null&&e!==void 0?e:{};this._areaMark=this._createMark(RangeAreaSeries.mark.area,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:n},{setCustomizedShape:i,morphElementKey:this.getDimensionField()[0]})}initMarkStyle(){this.initAreaMarkStyle()}initAreaMarkStyle(){const e=this._areaMark;e&&(super.initAreaMarkStyle(),this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x1:i=>{if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:n}=this._xAxisHelper;return n(this.getDatumPositionValues(i,this._spec.xField[1]),{bandPosition:this._bandPosition})}},"normal",AttributeLevel.Series):this.setMarkStyle(this._areaMark,{y1:i=>{if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:n}=this._yAxisHelper;return n(this.getDatumPositionValues(i,this._spec.yField[1]),{bandPosition:this._bandPosition})}},"normal",AttributeLevel.Series),this.setMarkStyle(e,{stroke:!1},"normal",AttributeLevel.Series))}initTooltip(){this._tooltipHelper=new RangeAreaSeriesTooltipHelper(this)}_isFieldAllValid(){const e=this.getViewDataStatistics(),i=this.fieldY;return!!(e&&e.latestData&&i.length)&&i.every(n=>e.latestData[n]&&e.latestData[n].allValid)}}RangeAreaSeries.type=SeriesTypeEnum.rangeArea,RangeAreaSeries.mark=rangeAreaSeriesMark;const registerRangeAreaSeries=()=>{registerAreaMark(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(RangeAreaSeries.type,RangeAreaSeries)};class PolarSeries extends BaseSeries{constructor(){super(...arguments),this.coordinate="polar",this._outerRadius=POLAR_DEFAULT_RADIUS,this._innerRadius=0,this._angleField=[],this._radiusField=[],this._sortDataByAxis=!1}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}getAngleField(){return this._angleField}setAngleField(e){return this._angleField=isValid(e)?array(e):[],this._angleField}getRadiusField(){return this._radiusField}setRadiusField(e){return this._radiusField=isValid(e)?array(e):[],this._radiusField}get innerRadiusField(){return this._innerRadiusField}setInnerRadiusField(e){return this._innerRadiusField=array(e),this._innerRadiusField}get radiusScale(){return this._radiusScale}setRadiusScale(e){return this._radiusScale=e,e}get angleScale(){return this._angleScale}setAngleScale(e){return this._angleScale=e,e}get angleAxisHelper(){return this._angleAxisHelper}set angleAxisHelper(e){this._angleAxisHelper=e,this.onAngleAxisHelperUpdate()}get radiusAxisHelper(){return this._radiusAxisHelper}set radiusAxisHelper(e){this._radiusAxisHelper=e,this.onRadiusAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getCenter=()=>this.angleAxisHelper.center(),this._markAttributeContext.getLayoutRadius=()=>this._computeLayoutRadius()}valueToPosition(e,i){if(isNil(e)||isNil(i)||!this.angleAxisHelper||!this.radiusAxisHelper)return{x:Number.NaN,y:Number.NaN};const n=this.radiusAxisHelper.dataToPosition(array(i));if(n<0){if(this._invalidType==="break"||this._invalidType==="link")return{x:Number.NaN,y:Number.NaN};if(this._invalidType==="zero")return this.angleAxisHelper.center()}const o=this.angleAxisHelper.dataToPosition(array(e));return this.angleAxisHelper.coordToPoint({angle:o,radius:n})}dataToPosition(e,i){return e&&this.angleAxisHelper&&this.radiusAxisHelper?i&&!this.isDatumInViewData(e)?null:this.valueToPosition(this.getDatumPositionValues(e,this._angleField),this.getDatumPositionValues(e,this._radiusField)):null}dataToPositionX(e){var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.x}dataToPositionY(e){var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.y}dataToPositionZ(e){return 0}positionToData(e){}radiusToData(e){}angleToData(e){}getStatisticFields(){var e,i;const n=[];return!((e=this.radiusAxisHelper)===null||e===void 0)&&e.getScale&&this._radiusField.forEach(o=>{const l={key:o,operations:[]};isContinuous(this.radiusAxisHelper.getScale(0).type)?l.operations=["max","min"]:l.operations=["values"],n.push(l)}),!((i=this.angleAxisHelper)===null||i===void 0)&&i.getScale&&this._angleField.forEach(o=>{const l={key:o,operations:[]};isContinuous(this.angleAxisHelper.getScale(0).type)?l.operations=["max","min"]:l.operations=["values"],n.push(l)}),n}setAttrFromSpec(){super.setAttrFromSpec(),isValid(this._spec.outerRadius)&&(this._outerRadius=this._spec.outerRadius),isValid(this._spec.radius)&&(this._outerRadius=this._spec.radius),isValid(this._spec.innerRadius)&&(this._innerRadius=this._spec.innerRadius),isValid(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}onRadiusAxisHelperUpdate(){this.onMarkPositionUpdate()}onAngleAxisHelperUpdate(){this.onMarkPositionUpdate()}afterInitMark(){super.afterInitMark()}_computeLayoutRadius(){const e=this._angleAxisHelper||this._radiusAxisHelper;if(e)return e.layoutRadius();const{width:i,height:n}=this._region.getLayoutRect();return Math.min(i/2,n/2)}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(ChartEvent.scaleDomainUpdate,{filter:e=>{var i;return e.model.id===((i=this._angleAxisHelper)===null||i===void 0?void 0:i.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var e,i;!((i=(e=this.getViewData())===null||e===void 0?void 0:e.latestData)===null||i===void 0)&&i.length&&sortDataInAxisHelper(this.angleAxisHelper,this._angleField[0],this.getViewData().latestData)}getInvalidCheckFields(){const e=[];return this.angleAxisHelper.isContinuous&&this._angleField.forEach(i=>{e.push(i)}),this.radiusAxisHelper.isContinuous&&this._radiusField.forEach(i=>{e.push(i)}),e}}function transformInvalidValue(r){return couldBeValidNumber(r)?Number.parseFloat(r):0}const pie=(r,e)=>{const{asStartAngle:i,asEndAngle:n,asMiddleAngle:o,asRadian:l,asRatio:u,asQuadrant:d,asK:f,showAllZero:g,supportNegative:_,showEmptyCircle:y}=e,b=e.angleField(),S=e.startAngle(),v=e.endAngle(),A=e.minAngle(),x=r.map(B=>Object.assign({},B));if(!x||x.length===0||!g&&y&&isDataEmpty(x,b,_))return x;const T=(B,N,$)=>{B[i]=N,B[n]=N+$,B[o]=N+$/2,B[l]=$,B[d]=computeQuadrant(N+$/2)};let C=0,E=-1/0,P=!0;for(let B=0;B<x.length;B++){const N=_?Math.abs(transformInvalidValue(x[B][b])):transformInvalidValue(x[B][b]);C+=N,E=Math.max(N,E),P&&N!==0&&(P=!1),x[B][ARC_TRANSFORM_VALUE]=N}const L=x.map(B=>Number(B[b])),R=v-S;let w=S,D=R,I=0;const O=getPercentValue(L);if(x.forEach((B,N)=>{const $=B[ARC_TRANSFORM_VALUE],H=C?$/C:0;let F=H*R;F<A?(F=A,D-=A):I+=$;const V=w,G=w+F;B[u]=H,B[f]=E?$/E:0,B._percent_=O[N],T(B,V,F),w=G}),D<R)if(D<=.001){const B=R/x.length;x.forEach((N,$)=>{T(N,S+$*B,B)})}else{const B=D/I;w=S,x.forEach(N=>{const $=N[l]===A?A:N[ARC_TRANSFORM_VALUE]*B;T(N,w,$),w+=$})}if(C!==0&&(x[x.length-1][n]=v),P&&g){const B=R/x.length;x.forEach((N,$)=>{T(N,S+$*B,B)})}return x},isDataEmpty=(r,e,i)=>!!isNil(r)||r.length===0||!!r.every(n=>transformInvalidValue(n[e])===0)||!i&&r.reduce((n,o)=>n+transformInvalidValue(o[e]),0)===0;function pieGrowOption(r,e,i){return(n,o,l)=>e?r.growField==="radius"?{overall:0}:{overall:r.growFrom(n,o,i)}:{overall:!1}}const Appear_Grow$4=r=>({type:r.growField==="radius"?"growRadiusIn":"growAngleIn",options:pieGrowOption(r,!0,AnimationStateEnum.appear)}),Appear_FadeIn$4={type:"fadeIn"},pieEnter=r=>({type:r.growField==="radius"?"growRadiusIn":"growAngleIn",easing:"linear",options:pieGrowOption(r,!0,AnimationStateEnum.enter)}),pieExit=r=>({type:r.growField==="radius"?"growRadiusOut":"growAngleOut",easing:"linear",options:pieGrowOption(r,!0,AnimationStateEnum.exit)}),pieDisappear=r=>({type:r.growField==="radius"?"growRadiusOut":"growAngleOut",options:pieGrowOption(r,!0,AnimationStateEnum.exit)});function piePresetAnimation(r,e){if(e===!1)return{};switch(e){case"fadeIn":return Appear_FadeIn$4;case"growRadius":return Appear_Grow$4(Object.assign(Object.assign({},r),{growField:"radius"}));default:return Appear_Grow$4(Object.assign(Object.assign({},r),{growField:"angle"}))}}const registerPieAnimation=()=>{Factory$1.registerAnimation("pie",(r,e)=>({appear:piePresetAnimation(r,e),enter:pieEnter(r),exit:pieExit(r),disappear:pieDisappear(r)}))},registerEmptyCircleAnimation=()=>{Factory$1.registerAnimation("emptyCircle",(r,e)=>({appear:piePresetAnimation(r,e)}))},registerPie3dAnimation=()=>{Factory$1.registerAnimation("pie3d",(r,e)=>({appear:piePresetAnimation(r,e),enter:pieEnter(r),exit:pieExit(r),disappear:pieDisappear(r)}))};function centerOffsetConfig(r,e){var i,n,o,l;const u=(n=(i=e.options)===null||i===void 0?void 0:i.distance)!==null&&n!==void 0?n:10,d=isValidNumber(e.duration)?e.duration/2:1e3,f=(o=e.options.easing)!==null&&o!==void 0?o:"cubicOut";return{oneByOne:e.oneByOne,loop:(l=e.loop)!==null&&l!==void 0&&l,timeSlices:[{duration:d,effects:{easing:f,channel:{x:{from:g=>r.getAttribute("x",g),to:g=>r.getAttribute("x",g)+polarToCartesian({x:0,y:0},u,g[ARC_MIDDLE_ANGLE]).x},y:{from:g=>r.getAttribute("y",g),to:g=>r.getAttribute("y",g)+polarToCartesian({x:0,y:0},u,g[ARC_MIDDLE_ANGLE]).y}}}},{duration:d,effects:{easing:f,channel:{x:{to:g=>r.getAttribute("x",g),from:g=>r.getAttribute("x",g)+polarToCartesian({x:0,y:0},u,g[ARC_MIDDLE_ANGLE]).x},y:{to:g=>r.getAttribute("y",g),from:g=>r.getAttribute("y",g)+polarToCartesian({x:0,y:0},u,g[ARC_MIDDLE_ANGLE]).y}}}}]}}class BaseArcMark extends BaseMark{constructor(e,i){super(e,i),this.type=ArcMark.type,this._unCompileChannel={centerOffset:!0,radiusOffset:!0},this.computeOuterRadius=(n,o,l="normal",u,d)=>{var f;return d+((f=this.getAttribute("radiusOffset",o,l,u))!==null&&f!==void 0?f:0)},this.computeCenter=(n,o,l="normal",u,d)=>polarToCartesian({x:0,y:0},this.getAttribute("centerOffset",o,l,u),o[ARC_MIDDLE_ANGLE])[n]+d,this._computeExChannel.x=this.computeCenter,this._computeExChannel.y=this.computeCenter,this._computeExChannel.outerRadius=this.computeOuterRadius,this._extensionChannel.centerOffset=["x","y"],this._extensionChannel.radiusOffset=["outerRadius"]}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{startAngle:0,endAngle:0,outerRadius:0,innerRadius:0,cornerRadius:0,lineWidth:0,innerPadding:0,outerPadding:0})}}class ArcMark extends BaseArcMark{constructor(){super(...arguments),this.type=ArcMark.type}}ArcMark.type="arc";const registerArcMark=()=>{registerArcGraphic(),registerVGrammarArcAnimation(),Factory$1.registerMark(ArcMark.type,ArcMark)},pieSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{pie:{name:"pie",type:"arc"},labelLine:{name:"labelLine",type:"path"}}),pie3dSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{pie3d:{name:"pie3d",type:"arc3d"},labelLine:{name:"labelLine",type:"path"}});class PieSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"pie")}_mergeThemeToSpec(e,i){const n=this._theme;let o=e;if(this._shouldMergeThemeToSpec()){const l=this._getDefaultSpecFromChart(i);o=mergeSpec({},this._theme,l,e);const u=(d,f)=>mergeSpec({},d==="inside"||d==="inside-center"?this._theme.innerLabel:this._theme.outerLabel,f);isArray(o.label)?o.label=o.label.map(d=>u(d.position,d)):o.label=u(o.label.position,o.label)}return{spec:o,theme:n}}_getDefaultSpecFromChart(e){var i;const n=(i=super._getDefaultSpecFromChart(e))!==null&&i!==void 0?i:{},{centerX:o,centerY:l}=e;return isValid(o)&&(n.centerX=o),isValid(l)&&(n.centerY=l),Object.keys(n).length>0?n:void 0}}const DEFAULT_LABEL_VISIBLE=`${PREFIX}_LABEL_VISIBLE`,getPolarAxisInfo=(r,e)=>{var i,n,o,l,u,d;const f=(i=r.type)!==null&&i!==void 0?i:r.orient==="angle"?"band":"linear",g=`${ComponentTypeEnum.polarAxis}-${f}`,_=(n=r.startAngle)!==null&&n!==void 0?n:e.startAngle,y=(o=r.endAngle)!==null&&o!==void 0?o:e.endAngle;return{axisType:f,componentName:g,startAngle:_??POLAR_START_ANGLE,endAngle:y??(isValid(_)?_+360:POLAR_END_ANGLE),center:isValid(e.center)?e.center:isValid(e==null?void 0:e.centerX)||isValid(e==null?void 0:e.centerY)?{x:e==null?void 0:e.centerX,y:e==null?void 0:e.centerY}:void 0,outerRadius:(d=(u=(l=r.outerRadius)!==null&&l!==void 0?l:r.radius)!==null&&u!==void 0?u:e.outerRadius)!==null&&d!==void 0?d:e.radius,layoutRadius:e.layoutRadius}},computeLayoutRadius=(r,e,i,n)=>{const o=r();if(isNumber(o))return o;if(isFunction(o))return o(e(),i());const l=e();if(o==="auto"&&l.width>0&&l.height>0){const{startAngle:u=0,endAngle:d=2*Math.PI}=n();return calculateMaxRadius(l,i(),u,d)}return Math.min(l.width/2,l.height/2)};class BasePieSeries extends PolarSeries{constructor(){super(...arguments),this.transformerConstructor=PieSeriesSpecTransformer,this._pieMarkName="pie",this._pieMarkType="arc",this.getCenter=()=>{var e,i;const n=this._region.getLayoutRect();return{x:calcLayoutNumber((e=this._spec)===null||e===void 0?void 0:e.centerX,n.width,n,n.width/2),y:calcLayoutNumber((i=this._spec)===null||i===void 0?void 0:i.centerY,n.height,n,n.height/2)}},this._startAngle=POLAR_START_RADIAN,this._endAngle=POLAR_END_RADIAN,this._pieMark=null,this._labelMark=null,this._labelLineMark=null,this._emptyArcMark=null,this.dataToCentralPosition=e=>{const i=e[ARC_MIDDLE_ANGLE];if(isNil(i))return null;const n=this.computeDatumRadius(e),o=this.computeDatumInnerRadius(e),l=this.computeCenter(e);return polarToCartesian(l,(n+o)/2,i)}}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.getCenter().x,y:()=>this.getCenter().y}),this._markAttributeContext.startAngleScale=e=>this.startAngleScale(e),this._markAttributeContext.endAngleScale=e=>this.endAngleScale(e)}setAttrFromSpec(){var e,i,n,o,l,u;super.setAttrFromSpec(),this._centerOffset=(e=this._spec.centerOffset)!==null&&e!==void 0?e:0,this._cornerRadius=(i=this._spec.cornerRadius)!==null&&i!==void 0?i:0;const d=normalizeStartEndAngle(isValid(this._spec.startAngle)?degreeToRadian(this._spec.startAngle):this._startAngle,isValid(this._spec.endAngle)?degreeToRadian(this._spec.endAngle):this._endAngle);this._startAngle=d.startAngle,this._endAngle=d.endAngle,this._padAngle=isValid(this._spec.padAngle)?degreeToRadian(this._spec.padAngle):0,this.setAngleField(this._spec.valueField||this._spec.angleField),this._spec.categoryField&&this.setSeriesField(this._spec.categoryField),this._radiusField=[],this._specAngleField=this._angleField.slice(),this._specRadiusField=[],this._showEmptyCircle=(o=(n=this._spec.emptyPlaceholder)===null||n===void 0?void 0:n.showEmptyCircle)!==null&&o!==void 0&&o,this._showAllZero=(l=this._spec.showAllZero)!==null&&l!==void 0&&l,this._supportNegative=(u=this._spec.supportNegative)!==null&&u!==void 0&&u}initData(){super.initData();const e=this.getViewData();if(!e)return;registerDataSetInstanceTransform(this._dataSet,"pie",pie),e.transform({type:"pie",options:{angleField:()=>this._angleField[0],startAngle:()=>this._startAngle,endAngle:()=>this._endAngle,minAngle:()=>isValid(this._spec.minAngle)?degreeToRadian(this._spec.minAngle):0,asStartAngle:ARC_START_ANGLE,asEndAngle:ARC_END_ANGLE,asRatio:ARC_RATIO,asMiddleAngle:ARC_MIDDLE_ANGLE,asRadian:ARC_RADIAN,asQuadrant:ARC_QUADRANT,asK:ARC_K,showAllZero:this._showAllZero,supportNegative:this._supportNegative,showEmptyCircle:this._showEmptyCircle}},!1);const i=new DataView(this._dataSet,{name:`${PREFIX}_series_${this.id}_viewDataLabel`});i.parse([this.getViewData()],{type:"dataview"}),this._viewDataLabel=new SeriesData(this._option,i)}compileData(){var e;super.compileData(),(e=this._viewDataLabel)===null||e===void 0||e.compile()}initMark(){var e,i;this._pieMark=this._createMark(Object.assign(Object.assign({},BasePieSeries.mark.pie),{name:this._pieMarkName,type:this._pieMarkType}),{key:DEFAULT_DATA_KEY,groupKey:this._seriesField,skipBeforeLayouted:!0,isSeriesMark:!0,stateSort:(e=this._spec.pie)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.pie)===null||i===void 0?void 0:i.customShape,morph:shouldMarkDoMorph(this._spec,this._pieMarkName),morphElementKey:this._seriesField}),this._showEmptyCircle&&(this._emptyArcMark=this._createMark({name:"emptyCircle",type:"arc"},{dataView:!1}))}startAngleScale(e){return field$2(ARC_START_ANGLE)(e)}endAngleScale(e){return field$2(ARC_END_ANGLE)(e)}_computeLayoutRadius(){return computeLayoutRadius(()=>this._spec.layoutRadius,this.getLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}initMarkStyle(){const e={x:()=>this.getCenter().x,y:()=>this.getCenter().y,fill:this.getColorAttribute(),outerRadius:isSpecValueWithScale(this._outerRadius)?this._outerRadius:()=>this._computeLayoutRadius()*this._outerRadius,innerRadius:isSpecValueWithScale(this._innerRadius)?this._innerRadius:()=>this._computeLayoutRadius()*this._innerRadius,cornerRadius:()=>this._computeLayoutRadius()*this._cornerRadius,startAngle:o=>this.startAngleScale(o),endAngle:o=>this.endAngleScale(o),padAngle:this._padAngle,centerOffset:this._centerOffset},i=this._pieMark;i&&this.setMarkStyle(i,e,"normal",AttributeLevel.Series);const n=this._emptyArcMark;n&&this.setMarkStyle(n,Object.assign(Object.assign({},e),{visible:()=>{const o=this.getAngleField()[0];return isDataEmpty(this.getViewData().latestData,o,this._supportNegative)}}),"normal",AttributeLevel.Series)}initInteraction(){this._parseInteractionConfig(this._pieMark?[this._pieMark]:[])}initTooltip(){super.initTooltip(),this._pieMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pieMark)}initMarkStyleWithSpec(e,i,n){if(super.initMarkStyleWithSpec(e,i,n),e.name===this._pieMarkName){const o=this.getSpec()[e.name];if(o)for(const l in o.state||{})this.setMarkStyle(e,this.generateRadiusStyle(o.state[l]),l,AttributeLevel.User_Mark)}e.name==="emptyCircle"&&this.setMarkStyle(e,this.generateRadiusStyle(i.style),"normal",AttributeLevel.User_Mark)}initLabelMarkStyle(e){e&&this.setMarkStyle(e,{visible:field$2(DEFAULT_LABEL_VISIBLE).bind(this),text:i=>i[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:this.dataToPositionZ.bind(this)})}afterInitMark(){super.afterInitMark()}initEvent(){var e;super.initEvent(),(e=this._viewDataLabel.getDataView())===null||e===void 0||e.target.addListener("change",this.viewDataLabelUpdate.bind(this))}initGroups(){}onLayoutEnd(e){this._viewDataLabel.getDataView().reRunAllTransform(),this.onMarkPositionUpdate(),super.onLayoutEnd(e)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return this._specAngleField}viewDataLabelUpdate(){this.event.emit(ChartEvent.viewDataLabelUpdate,{model:this}),this._viewDataLabel.updateData()}generateRadiusStyle(e){if(!e)return;const i={};return e.outerRadius&&(i.outerRadius=()=>this._computeLayoutRadius()*e.outerRadius),e.innerRadius&&(i.innerRadius=()=>this._computeLayoutRadius()*e.innerRadius),e.cornerRadius&&(i.cornerRadius=()=>this._computeLayoutRadius()*e.cornerRadius),i}computeCenter(e){return{x:this._pieMark.getAttribute("x",e,"normal"),y:this._pieMark.getAttribute("y",e,"normal")}}getRadius(e="normal"){var i,n,o,l,u,d,f;const g=e==="normal"?(o=(n=this.getSpec()[((i=this._pieMark)===null||i===void 0?void 0:i.name)||"pie"])===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.outerRadius:(f=(d=(u=this.getSpec()[((l=this._pieMark)===null||l===void 0?void 0:l.name)||"pie"])===null||u===void 0?void 0:u.state)===null||d===void 0?void 0:d[e])===null||f===void 0?void 0:f.outerRadius;return g??this._outerRadius}getInnerRadius(e="normal"){var i,n,o,l,u,d,f;const g=e==="normal"?(o=(n=this.getSpec()[((i=this._pieMark)===null||i===void 0?void 0:i.name)||"pie"])===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.innerRadius:(f=(d=(u=this.getSpec()[((l=this._pieMark)===null||l===void 0?void 0:l.name)||"pie"])===null||u===void 0?void 0:u.state)===null||d===void 0?void 0:d[e])===null||f===void 0?void 0:f.innerRadius;return g??this._innerRadius}computeRadius(e,i){return this._computeLayoutRadius()*e*(isNil(i)?1:i)+this._centerOffset}computeDatumRadius(e,i){return this._computeLayoutRadius()*this.getRadius(i)+this._centerOffset}_compareSpec(e,i,n){n=n??{data:!0};const o=["centerX","centerY","centerOffset","radius","innerRadius","cornerRadius","startAngle","endAngle","padAngle"];o.forEach(u=>{n[u]=!0});const l=super._compareSpec(e,i,n);return e=e??{},o.some(u=>e[u]!==i[u])&&(l.reRender=!0,l.change=!0),l}computeDatumInnerRadius(e,i){return this._computeLayoutRadius()*this.getInnerRadius(i)+this._centerOffset}dataToPosition(e,i){const n=e[ARC_MIDDLE_ANGLE];if(isNil(n)||i&&!this.isDatumInViewData(e))return null;const o=this.computeDatumRadius(e),l=this.computeCenter(e);return polarToCartesian(l,o,n)}initAnimation(){var e,i,n;const o={growFrom:(u,d,f)=>{var g;if(f===AnimationStateEnum.appear)return this._startAngle;if(f===AnimationStateEnum.disappear)return this._endAngle;const _=[AnimationStateEnum.disappear,AnimationStateEnum.exit],y=d.mark.elements,b=u,S=b==null?void 0:b[DEFAULT_DATA_INDEX];if(y.find(A=>{var x;return((x=A.data[0])===null||x===void 0?void 0:x[DEFAULT_DATA_INDEX])<S})===void 0)return this._startAngle;if(y.find(A=>{var x;return((x=A.data[0])===null||x===void 0?void 0:x[DEFAULT_DATA_INDEX])>S})===void 0)return this._endAngle;const v=[...y].reverse().find(A=>{var x;return((x=A.data[0])===null||x===void 0?void 0:x[DEFAULT_DATA_INDEX])<S});return _.includes(f)?(g=v==null?void 0:v.getNextGraphicAttributes())===null||g===void 0?void 0:g.endAngle:v==null?void 0:v.getGraphicAttribute("endAngle",!0)}},l=(e=this._spec.animationAppear)===null||e===void 0?void 0:e.preset;if(this._pieMark){const u=animationConfig((i=Factory$1.getAnimationInKey("pie"))===null||i===void 0?void 0:i(o,l),userAnimationConfig("pie",this._spec,this._markAttributeContext));u.normal&&u.normal.type&&(u.normal=centerOffsetConfig(this._pieMark,u.normal)),this._pieMark.setAnimationConfig(u)}if(this._emptyArcMark){const u=animationConfig((n=Factory$1.getAnimationInKey("emptyCircle"))===null||n===void 0?void 0:n(o,l??"fadeIn"));this._emptyArcMark.setAnimationConfig(u)}}getDefaultShapeType(){return"circle"}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(e,i){return i}getActiveMarks(){return[this._pieMark]}}BasePieSeries.transformerConstructor=PieSeriesSpecTransformer,BasePieSeries.mark=pieSeriesMark;class PieSeries extends BasePieSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.pie}}PieSeries.type=SeriesTypeEnum.pie;const registerPieSeries=()=>{registerArcMark(),registerPieAnimation(),registerEmptyCircleAnimation(),Factory$1.registerSeries(PieSeries.type,PieSeries)};class Arc3dMark extends BaseArcMark{constructor(){super(...arguments),this.type=Arc3dMark.type,this._support3d=!0}}Arc3dMark.type="arc3d";const registerArc3dMark=()=>{registerVGrammarArcAnimation(),registerArc3dGraphic(),Factory$1.registerMark(Arc3dMark.type,Arc3dMark)};class Pie3dSeriesSpecTransformer extends PieSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"pie3d")}}class Pie3dSeries extends BasePieSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.pie3d,this._pieMarkName="pie3d",this._pieMarkType="arc3d",this.transformerConstructor=Pie3dSeriesSpecTransformer}setAttrFromSpec(){var e,i;super.setAttrFromSpec(),this._angle3d=(i=(e=this._spec)===null||e===void 0?void 0:e.angle3d)!==null&&i!==void 0?i:-Math.PI/3}initMarkStyle(){super.initMarkStyle();const e=this._pieMark;e&&this.setMarkStyle(e,{beta:()=>this._angle3d},"normal",AttributeLevel.Series)}initLabelMarkStyle(e,i={}){e&&(super.initLabelMarkStyle(e),this.setMarkStyle(e,{support3d:!0},void 0,AttributeLevel.Mark))}}Pie3dSeries.type=SeriesTypeEnum.pie3d,Pie3dSeries.mark=pie3dSeriesMark,Pie3dSeries.transformerConstructor=Pie3dSeriesSpecTransformer;const registerPie3dSeries=()=>{registerPie3dAnimation(),registerArc3dMark(),Factory$1.registerSeries(Pie3dSeries.type,Pie3dSeries)},Appear_Grow$3=r=>{const e=r.growField==="angle"?0:r.innerRadius;return r.growField==="angle"?{type:r.growField==="angle"?"growAngleIn":"growRadiusIn"}:{channel:{innerRadius:{from:e,to:(i,n)=>{var o;return(o=n.getFinalGraphicAttributes())===null||o===void 0?void 0:o.innerRadius}},outerRadius:{from:e,to:(i,n)=>{var o;return(o=n.getFinalGraphicAttributes())===null||o===void 0?void 0:o.outerRadius}}}}},Appear_FadeIn$3={type:"fadeIn"},roseEnter=r=>({type:r.growField==="angle"?"growAngleIn":"growRadiusIn"}),roseExit=r=>({type:r.growField==="angle"?"growAngleOut":"growRadiusOut"}),roseDisappear=r=>({type:r.growField==="angle"?"growAngleOut":"growRadiusOut"});function rosePresetAnimation(r,e){if(e===!1)return{};switch(e){case"fadeIn":return Appear_FadeIn$3;case"growAngle":return Appear_Grow$3(Object.assign(Object.assign({},r),{growField:"angle"}));default:return Appear_Grow$3(Object.assign(Object.assign({},r),{growField:"radius"}))}}const registerRoseAnimation=()=>{Factory$1.registerAnimation("rose",(r,e)=>({appear:rosePresetAnimation(r,e),enter:roseEnter(r),exit:roseExit(r),disappear:roseDisappear(r)}))};class RoseLikeSeries extends PolarSeries{getStackGroupFields(){return this._angleField}getStackValueField(){return array(this._spec.valueField)[0]||array(this._spec.radiusField)[0]}getGroupFields(){return this._angleField}setAttrFromSpec(){super.setAttrFromSpec(),this.setAngleField(this._spec.categoryField||this._spec.angleField),this.setRadiusField(this._spec.valueField||this._spec.radiusField),this._specAngleField=this._angleField.slice(),this._specRadiusField=this._radiusField.slice(),this.setInnerRadiusField(this._spec.valueField||this._spec.radiusField),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent()}setValueFieldToStack(){this.setRadiusField(STACK_FIELD_END),this.setInnerRadiusField(STACK_FIELD_START)}setValueFieldToPercent(){this.setRadiusField(STACK_FIELD_END_PERCENT),this.setInnerRadiusField(STACK_FIELD_START_PERCENT)}getDimensionField(){return this._specAngleField}getMeasureField(){return this._specRadiusField}getDefaultShapeType(){return"square"}}const roseSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{rose:{name:"rose",type:"arc"}});class RoseSeriesSpecTransformer extends BaseSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(e){this._addMarkLabelSpec(e,"rose")}}var __rest$9=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class PolarAxis extends AxisComponent{get center(){return this._center}get startAngle(){return this._startAngle}get endAngle(){return this._endAngle}getOrient(){return this._orient}getDefaultInteractive(){return this._orient!=="angle"}getGroupScales(){return this._groupScales}static getSpecInfo(e){if(!e[this.specKey])return null;const i=isArray(e[this.specKey]),n=i?e[this.specKey]:[e[this.specKey]],o=[];let l,u;const d=[],f=[];return n.forEach((g,_)=>{if(!isValidPolarAxis(g))return;const{axisType:y,componentName:b,startAngle:S,endAngle:v,center:A,outerRadius:x,layoutRadius:T}=getPolarAxisInfo(g,e);g.center=A,g.startAngle=S,g.endAngle=v,g.outerRadius=x,g.type=y,g.layoutRadius=T;const C={spec:g,specPath:i?[this.specKey,_]:[this.specKey],specInfoPath:["component",this.specKey,_],type:b};o.push(C),g.orient==="radius"?(d.push(C),u=_):(f.push(C),l=_)}),d.forEach(g=>{g.angleAxisIndex=l}),f.forEach(g=>{g.radiusAxisIndex=u}),o}static createComponent(e,i){const{spec:n}=e,o=__rest$9(e,["spec"]),l=Factory$1.getComponentInKey(o.type);return l?new l(n,Object.assign(Object.assign({},i),o)):(i.onError(`Component ${o.type} not found`),null)}constructor(e,i){super(e,i),this.type=ComponentTypeEnum.polarAxis,this.name=ComponentTypeEnum.polarAxis,this._defaultBandPosition=0,this._defaultBandInnerPadding=0,this._defaultBandOuterPadding=0,this.layoutType="absolute",this.layoutZIndex=LayoutZIndex.Axis,this._tick=void 0,this._center=null,this._startAngle=POLAR_START_RADIAN,this._endAngle=POLAR_END_RADIAN,this._orient="radius",this._groupScales=[],this.effect={scaleUpdate:n=>{this.computeData(n==null?void 0:n.value),eachSeries(this._regions,o=>{this.getOrient()==="radius"?shouldUpdateAxis(o.radiusAxisHelper,this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&(o.radiusAxisHelper=this.axisHelper()):shouldUpdateAxis(o.angleAxisHelper,this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&(o.angleAxisHelper=this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=n=>{var o;const l=(o=this.getRegions())===null||o===void 0?void 0:o[0];return l?l.getLayoutStartPoint():n},this.getCenter=()=>{var n,o;const l=this.getRefLayoutRect(),{width:u,height:d}=l;return{x:calcLayoutNumber((n=this._center)===null||n===void 0?void 0:n.x,u,l,u/2),y:calcLayoutNumber((o=this._center)===null||o===void 0?void 0:o.y,d,l,d/2)}},this.getRefLayoutRect=()=>this.getRegions()[0].getLayoutRect(),this._coordinateType="polar"}setAttrFromSpec(){super.setAttrFromSpec(),this.visible&&(this._axisStyle=this._getAxisAttributes(),this._gridStyle=this._getGridAttributes()),this._tick=this._spec.tick,this._orient=this._spec.orient==="angle"?"angle":"radius",this._center=this._spec.center,this._startAngle=degreeToRadian(this._spec.startAngle),this._endAngle=degreeToRadian(this._spec.endAngle),this._inverse=this._spec.inverse}onRender(e){}changeRegions(){}_tickTransformOption(){var e;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimal:(e=this._tick)===null||e===void 0?void 0:e.noDecimals,startAngle:this.startAngle,labelOffset:getAxisLabelOffset(this._spec),getRadius:()=>this.getOuterRadius(),inside:this._spec.inside})}updateScaleRange(){const e=this._scale.range();let i;return i=this.getOrient()==="radius"?this._inverse?[this.computeLayoutOuterRadius(),this.computeLayoutInnerRadius()]:[this.computeLayoutInnerRadius(),this.computeLayoutOuterRadius()]:this._inverse?[this._endAngle,this._startAngle]:[this._startAngle,this._endAngle],(!e||!i||e[0]!==i[0]||e[1]!==i[1])&&(this._scale.range(i),!0)}collectSeriesField(e,i){var n,o;let l;return l=e>0?(o=(n=i.getGroups())===null||n===void 0?void 0:n.fields)===null||o===void 0?void 0:o[e]:this.getOrient()==="radius"?i.getRadiusField():i.getAngleField(),l}updateSeriesScale(){eachSeries(this._regions,e=>{this.getOrient()==="radius"?shouldUpdateAxis(e.radiusAxisHelper,this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&(e.setRadiusScale(this._scale),e.radiusAxisHelper=this.axisHelper()):shouldUpdateAxis(e.angleAxisHelper,this.axisHelper(),isValid(this._seriesUserId)||isValid(this._seriesIndex))&&(e.setAngleScale(this._scale),e.angleAxisHelper=this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getSeriesStatisticsField(e){const i=this.getOrient()==="radius"?e.getRadiusField():e.getAngleField();return isContinuous(this._scale.type)?i:[i[0]]}initGroupScales(){}axisHelper(){return{isContinuous:isContinuous(this._scale.type),dataToPosition:this.dataToPosition.bind(this),coordToPoint:this.coordToPoint.bind(this),pointToCoord:this.pointToCoord.bind(this),center:this.getCenter.bind(this),layoutRadius:this._computeLayoutRadius.bind(this),getScale:(e=0)=>this._scales[e],getAxisId:()=>this.id,getSpec:()=>this._spec}}positionToData(e){const i=this.pointToCoord(e);return this.getOrient()==="radius"?this.invert(i.radius):this.invert(i.angle)}coordToPoint(e){const i=this.getCenter();return polarToCartesian(i,e.radius,e.angle)}pointToCoord(e){const i=this.getCenter(),n=this._startAngle,o=this._endAngle;return cartesianToPolar(e,i,n,o)}getOuterRadius(){return this.computeLayoutOuterRadius()}getInnerRadius(){return this.computeLayoutInnerRadius()}updateLayoutAttribute(){this._visible&&(this.getOrient()==="radius"?this._layoutRadiusAxis():this._layoutAngleAxis()),super.updateLayoutAttribute()}_getNormalizedValue(e,i){return i===0?0:(this.dataToPosition(e)-this._getStartValue())/i}getLabelItems(e){var i;const n=(i=this.getTickData())===null||i===void 0?void 0:i.getLatestData();return n&&n.length?[n.map(o=>getAxisItem(o.value,this._getNormalizedValue([o.value],e)))]:[]}_getStartValue(){return this.getOrient()==="radius"?this.computeLayoutInnerRadius():this._startAngle}_layoutAngleAxis(){var e,i,n;const o=this.getCenter(),l=this.computeLayoutOuterRadius(),u=this.computeLayoutInnerRadius(),d=this._endAngle-this._startAngle,f=this.getLabelItems(d),g=Object.assign(Object.assign({},this.getLayoutStartPoint()),{inside:this._spec.inside,center:o,radius:l,innerRadius:u,startAngle:this._startAngle,endAngle:this._endAngle,sides:!((n=(i=(e=this._getRelatedAxis(this._option.radiusAxisIndex))===null||e===void 0?void 0:e.getSpec())===null||i===void 0?void 0:i.grid)===null||n===void 0)&&n.smooth?void 0:this.getScale().domain().length}),_=Object.assign(Object.assign({},g),{size:this.getRefLayoutRect(),title:{text:this._spec.title.text||this._dataFieldText},items:f,orient:"angle"});this._spec.grid.visible&&(_.grid=Object.assign({type:"line",smoothLink:!0,items:f[0]},g)),this._update(_)}_layoutRadiusAxis(){var e,i,n;const o=this.getCenter(),l=this.computeLayoutOuterRadius(),u=this.computeLayoutInnerRadius(),d=this.coordToPoint({angle:this._startAngle,radius:l}),f=this.coordToPoint({angle:this._startAngle,radius:u}),g=PointService.distancePP(f,d),_=this.getLabelItems(g),y=Object.assign(Object.assign({},this.getLayoutStartPoint()),{start:f,end:d,verticalFactor:-1}),b=Object.assign(Object.assign({},y),{title:{text:this._spec.title.text||this._dataFieldText},items:_,orient:"radius"});!((e=this._spec.grid)===null||e===void 0)&&e.visible&&(b.grid=Object.assign({items:_[0],type:!((i=this._spec.grid)===null||i===void 0)&&i.smooth?"circle":"polygon",center:o,closed:!0,sides:(n=this._getRelatedAxis(this._option.angleAxisIndex))===null||n===void 0?void 0:n.getScale().domain().length,startAngle:this._startAngle,endAngle:this._endAngle},y)),this._update(b)}_getRelatedAxis(e){if(isValid(e))return this._option.getComponentByIndex(this.specKey,e)}_computeLayoutRadius(){return computeLayoutRadius(()=>this._spec.layoutRadius,this.getRefLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}computeLayoutOuterRadius(){var e;const i=(e=this._spec.outerRadius)!==null&&e!==void 0?e:this._spec.radius,n=i??this.getRefSeriesRadius().outerRadius;return this._computeLayoutRadius()*n}computeLayoutInnerRadius(){var e;const i=(e=this._spec.innerRadius)!==null&&e!==void 0?e:this.getRefSeriesRadius().innerRadius;return this._computeLayoutRadius()*i}getRefSeriesRadius(){let e=POLAR_DEFAULT_RADIUS,i=0;const n=this.getChart().getSpec();return eachSeries(this.getRegions(),o=>{const l=o;if(isPolarAxisSeries(l.type)){const{outerRadius:u=n.outerRadius,innerRadius:d=n.innerRadius}=l;isValidNumber(u)&&(e=u),isValidNumber(d)&&(i=d)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),{outerRadius:e,innerRadius:i}}_update(e){const{grid:i}=e,n=__rest$9(e,["grid"]);this._axisMark.getProduct().encode(mergeSpec({},this._axisStyle,n)),this._gridMark&&this._gridMark.getProduct().encode(mergeSpec({},this._gridStyle,i))}invert(e){var i;if(this.getOrient()==="angle"&&this._scale.type==="band"){const n=this._scale.range(),o=n[n.length-1]-n[0],l=((i=this.getSpec().bandPosition)!==null&&i!==void 0?i:this._defaultBandPosition)===.5?0:this._scale.bandwidth()/2;if(n[0]<0){const u=(e+l+Math.abs(n[0]))%o-Math.abs(n[0]);return this._scale.invert(u)}return this._scale.invert((e+l)%o)}return this._scale.invert(e)}}PolarAxis.type=ComponentTypeEnum.polarAxis,PolarAxis.specKey="axes";class PolarLinearAxis extends PolarAxis{constructor(){super(...arguments),this.type=ComponentTypeEnum.polarLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new LinearScale}setAttrFromSpec(){super.setAttrFromSpec(),this.setExtraAttrFromSpec()}initScales(){super.initScales(),this.setScaleNice()}computeDomain(e){return this.computeLinearDomain(e)}axisHelper(){const e=super.axisHelper();return e.setExtendDomain=this.setExtendDomain.bind(this),e}registerTicksTransform(){const e=`${this.type}-ticks`;return registerDataSetInstanceTransform(this._option.dataSet,e,continuousTicks),e}}PolarLinearAxis.type=ComponentTypeEnum.polarLinearAxis,PolarLinearAxis.specKey="axes",mixin(PolarLinearAxis,LinearAxisMixin);const registerPolarLinearAxis=()=>{registerLineAxis(),registerLineGrid(),registerCircleAxis(),registerCircleGrid(),registerAxis(),Factory$1.registerComponent(PolarLinearAxis.type,PolarLinearAxis)};class PolarBandAxis extends PolarAxis{constructor(){super(...arguments),this.type=ComponentTypeEnum.polarBandAxis,this._scale=new BandScale}computeDomain(e){return this.computeBandDomain(e)}updateScaleRange(){const e=super.updateScaleRange();return this.updateGroupScaleRange(),e}axisHelper(){const e=super.axisHelper();return Object.assign(Object.assign({},e),{getBandwidth:i=>e.getScale(i).bandwidth()})}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}registerTicksTransform(){const e=`${this.type}-ticks`;return registerDataSetInstanceTransform(this._option.dataSet,e,polarAngleAxisDiscreteTicks),e}transformScaleDomain(){}}PolarBandAxis.type=ComponentTypeEnum.polarBandAxis,PolarBandAxis.specKey="axes",mixin(PolarBandAxis,BandAxisMixin);const registerPolarBandAxis=()=>{registerLineAxis(),registerLineGrid(),registerCircleAxis(),registerCircleGrid(),registerAxis(),Factory$1.registerComponent(PolarBandAxis.type,PolarBandAxis)};class RoseSeries extends RoseLikeSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.rose,this.transformerConstructor=RoseSeriesSpecTransformer,this._roseMark=null,this._labelMark=null}initMark(){this.initRoseMark()}initMarkStyle(){this.initRoseMarkStyle()}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y}),this._markAttributeContext.startAngleScale=e=>this.startAngleScale(e),this._markAttributeContext.endAngleScale=e=>this.endAngleScale(e)}initRoseMark(){var e,i;this._roseMark=this._createMark(RoseSeries.mark.rose,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(e=this._spec.rose)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.rose)===null||i===void 0?void 0:i.customShape,morph:shouldMarkDoMorph(this._spec,RoseSeries.mark.rose.name),morphElementKey:this.getDimensionField()[0]})}getRoseAngle(){var e,i,n;return(n=(i=(e=this.angleAxisHelper).getBandwidth)===null||i===void 0?void 0:i.call(e,this._groups?this._groups.fields.length-1:0))!==null&&n!==void 0?n:.5}startAngleScale(e){return this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(e,this.getGroupFields()))-.5*this.angleAxisHelper.getBandwidth(this.getGroupFields().length-1)}endAngleScale(e){return this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(e,this.getGroupFields()))+this.getRoseAngle()-.5*this.angleAxisHelper.getBandwidth(this.getGroupFields().length-1)}initRoseMarkStyle(){const e=this._roseMark;e&&this.setMarkStyle(e,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:i=>this.startAngleScale(i),endAngle:i=>this.endAngleScale(i),fill:this.getColorAttribute(),outerRadius:i=>valueInScaleRange(this.radiusAxisHelper.dataToPosition([i[this._radiusField[0]]]),this.radiusAxisHelper.getScale(0)),innerRadius:i=>{var n;if(!this.getStack())return 0;const o=valueInScaleRange(this.radiusAxisHelper.dataToPosition([i[this._innerRadiusField[0]]]),this.radiusAxisHelper.getScale(0));return o<=Number.MIN_VALUE?this._computeLayoutRadius()*((n=this._spec.innerRadius)!==null&&n!==void 0?n:0):o}})}initTooltip(){super.initTooltip(),this._roseMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._roseMark)}initLabelMarkStyle(e){e&&this.setMarkStyle(e,{text:i=>i[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:0})}initAnimation(){var e,i,n;const o=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;if(this._roseMark){const l={innerRadius:()=>{var u;return this._computeLayoutRadius()*((u=this._spec.innerRadius)!==null&&u!==void 0?u:0)}};this._roseMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("rose"))===null||n===void 0?void 0:n(l,o),userAnimationConfig("rose",this._spec,this._markAttributeContext)))}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._roseMark]}}RoseSeries.type=SeriesTypeEnum.rose,RoseSeries.mark=roseSeriesMark,RoseSeries.transformerConstructor=RoseSeriesSpecTransformer;const registerRoseSeries=()=>{Factory$1.registerSeries(RoseSeries.type,RoseSeries),registerArcMark(),registerRoseAnimation(),registerPolarBandAxis(),registerPolarLinearAxis()};class PolarPointUpdate extends ACustomAnimate{constructor(e,i,n,o,l){super(e,i,n,o,l),this._center=i.center,this._prevCenter=e.center,this._center&&this._prevCenter||(this.valid=!1)}getEndProps(){return this.valid===!1?{}:polarToCartesian(this._center,this._toRadius,this._toAngle)}onBind(){const{angle:e,radius:i}=cartesianToPolar(this.from,this._prevCenter),{angle:n,radius:o}=cartesianToPolar(this.to,this._center);isValidNumber(n*o)||(this.valid=!1),this._fromAngle=isValidNumber(e)?e:n,this._fromRadius=isValidNumber(i)?i:o,this._toAngle=n,this._toRadius=o,isClose(this._fromAngle,this._toAngle)&&isClose(this._fromRadius,this._toRadius)&&(this.valid=!1)}onUpdate(e,i,n){if(this.valid===!1)return n.x=this.to.x,void(n.y=this.to.y);if(e){const{x:o,y:l}=this.getEndProps();n.x=o,n.y=l,n.center=this._center}else{const{x:o,y:l}=polarToCartesian({x:this._prevCenter.x+(this._center.x-this._prevCenter.x)*i,y:this._prevCenter.y+(this._center.y-this._prevCenter.y)*i},this._fromRadius+(this._toRadius-this._fromRadius)*i,this._fromAngle+(this._toAngle-this._fromAngle)*i);n.x=o,n.y=l}}}class PolarTagPointsUpdate extends TagPointsUpdate{constructor(e,i,n,o,l){super(e,i,n,o,l),this._center=i.center,this._prevCenter=e.center}onUpdate(e,i,n){this.points=this.points.map((o,l)=>{const u=this.polarPointInterpolation(this.interpolatePoints[l][0],this.interpolatePoints[l][1],i);return e&&(n.center=this._center),u.context=o.context,u}),n.points=this.points}_interpolationSinglePoint(e,i,n){if(!isValidPoint(e)&&!isValidPoint(i))return i;const o=cartesianToPolar(e,this._prevCenter),l=cartesianToPolar(i,this._center);let u=normalizeAngle(o.angle),d=normalizeAngle(l.angle);!isValidNumber(u)&&isValidNumber(d)&&(u=d),isValidNumber(u)&&!isValidNumber(d)&&(d=u);const f=u+(d-u)*n,g=o.radius+(l.radius-o.radius)*n;return polarToCartesian({x:this._prevCenter.x+(this._center.x-this._prevCenter.x)*n,y:this._prevCenter.y+(this._center.y-this._prevCenter.y)*n},g,f)}polarPointInterpolation(e,i,n){const{x:o,y:l}=this._interpolationSinglePoint(e,i,n),{x:u,y:d}=this._interpolationSinglePoint({x:e.x1,y:e.y1},{x:i.x1,y:i.y1},n),f=new Point(o,l,u,d);return f.defined=i.defined,f}}const radarFadeAnimation=r=>({type:r==="in"?"fadeIn":"fadeOut"}),radarGrowAnimation=(r,e)=>({type:e==="in"?"growPointsIn":"growPointsOut",options:()=>({center:r.center()})});function radarPresetAnimation(r,e,i){return e==="fadeIn"?radarFadeAnimation(i):radarGrowAnimation(r,i)}const radarSymbolMoveAnimation=(r,e)=>{const i=()=>{var u;return(u=r.center())===null||u===void 0?void 0:u.x},n=(u,d)=>d.getGraphicAttribute("x"),o=()=>{var u;return(u=r.center())===null||u===void 0?void 0:u.y},l=(u,d)=>d.getGraphicAttribute("y");return e==="in"?{channel:{x:{from:i,to:n},y:{from:o,to:l}}}:{channel:{x:{from:n,to:i},y:{from:l,to:o}}}};function radarSymbolPresetAnimation(r,e,i){return e==="fadeIn"?radarFadeAnimation(i):radarSymbolMoveAnimation(r,i)}const radarGroupClipAnimation=(r,e)=>({custom:ClipAngleAnimate,customParameters:(i,n)=>{var o;return{group:n.getGraphicItem(),startAngle:(o=r.startAngle)!==null&&o!==void 0?o:Math.PI/2,orient:"clockwise",center:r.center(),radius:r.radius(),animationType:e}}}),registerRadarAnimation=()=>{Factory$1.registerAnimation("radar",(r,e)=>({appear:e==="clipIn"?void 0:radarPresetAnimation(r,e,"in"),enter:radarPresetAnimation(r,e,"in"),exit:radarPresetAnimation(r,e,"out"),disappear:e==="clipIn"?void 0:radarPresetAnimation(r,e,"out"),update:[{options:{excludeChannels:["points","defined","center"]}},{channel:["points","center"],custom:PolarTagPointsUpdate,customParameters:r,duration:DEFAULT_ANIMATION_CONFIG.update.duration,easing:DEFAULT_ANIMATION_CONFIG.update.easing}]})),Factory$1.registerAnimation("radarSymbol",(r,e)=>({appear:e==="clipIn"?void 0:radarSymbolPresetAnimation(r,e,"in"),enter:{type:"scaleIn"},exit:{type:"scaleOut"},disappear:e==="clipIn"?void 0:radarSymbolPresetAnimation(r,e,"out"),update:[{options:{excludeChannels:["x","y","center"]}},{channel:["x","y","center"],custom:PolarPointUpdate,customParameters:r,duration:DEFAULT_ANIMATION_CONFIG.update.duration,easing:DEFAULT_ANIMATION_CONFIG.update.easing}]})),Factory$1.registerAnimation("radarGroup",(r,e)=>({appear:radarGroupClipAnimation(r,"in"),disappear:radarGroupClipAnimation(r,"out")})),registerArc()},radarSeriesMark=Object.assign(Object.assign(Object.assign({},baseSeriesMark),lineLikeSeriesMark),{area:{name:"area",type:"area"}});class RadarSeries extends RoseLikeSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.radar,this.transformerConstructor=LineLikeSeriesSpecTransformer,this._sortDataByAxis=!1}initGroups(){}compile(){super.compile(),this.addOverlapCompile()}initMark(){var e,i,n,o;const l={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},u=((e=this._spec.area)===null||e===void 0?void 0:e.visible)!==!1&&((n=(i=this._spec.area)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.visible)!==!1,d=(o=this._spec.seriesMark)!==null&&o!==void 0?o:"area";this.initAreaMark(l,u&&d==="area"),this.initLineMark(l,d==="line"||d==="area"&&!u),this.initSymbolMark(l,d==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initLineMarkStyle(),this.initSymbolMarkStyle(),[this._lineMark,this._symbolMark,this._areaMark].forEach(e=>{e&&this.setMarkStyle(e,{center:()=>{var i;return(i=this.angleAxisHelper)===null||i===void 0?void 0:i.center()}})})}initAreaMark(e,i){var n,o;this._areaMark=this._createMark(RadarSeries.mark.area,{groupKey:this._seriesField,isSeriesMark:i,stateSort:(n=this._spec.area)===null||n===void 0?void 0:n.stateSort},Object.assign(Object.assign({},e),{setCustomizedShape:(o=this._spec.area)===null||o===void 0?void 0:o.customShape}))}initAreaMarkStyle(){const e=this._areaMark;e&&(this.setMarkStyle(e,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),x1:i=>i&&this.angleAxisHelper&&this.radiusAxisHelper?this.valueToPosition(this.getDatumPositionValues(i,this._angleField),this.getStack()?this.getDatumPositionValues(i,this._innerRadiusField):this.radiusScale.domain()[0]).x:Number.NaN,y1:i=>!i||!this.angleAxisHelper||!this.radiusAxisHelper?Number.NaN:this.valueToPosition(this.getDatumPositionValues(i,this._angleField),this.getStack()?this.getDatumPositionValues(i,this._innerRadiusField):this.radiusScale.domain()[0]).y,fill:this.getColorAttribute(),curveType:DEFAULT_LINEAR_INTERPOLATE,closePath:!0},"normal",AttributeLevel.Series),this._invalidType!=="zero"&&this.setMarkStyle(e,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",AttributeLevel.Series),this.event.on(ChartEvent.viewDataStatisticsUpdate,{filter:i=>i.model===this},()=>{this.encodeDefined(e,"defined")}))}initTooltip(){super.initTooltip();const{group:e,mark:i}=this._tooltipHelper.activeTriggerSet;this._lineMark&&e.add(this._lineMark),this._areaMark&&e.add(this._areaMark),this._symbolMark&&(i.add(this._symbolMark),e.add(this._symbolMark))}initAnimation(){var e,i,n,o;const l={center:()=>{var d;return(d=this.angleAxisHelper)===null||d===void 0?void 0:d.center()},radius:()=>{const d=this.getLayoutRect();return Math.min(d.width,d.height)},startAngle:isValid(this._spec.startAngle)?degreeToRadian(this._spec.startAngle):POLAR_START_RADIAN},u=(n=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset)!==null&&n!==void 0?n:"clipIn";u==="clipIn"&&this._rootMark&&this._rootMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("radarGroup"))===null||o===void 0?void 0:o(l,u),userAnimationConfig("group",this._spec,this._markAttributeContext))),[[this._areaMark,"radar"],[this._lineMark,"radar"],[this._symbolMark,"radarSymbol"]].forEach(([d,f])=>{if(isValid(d)){const g=Factory$1.getAnimationInKey(f);d.setAnimationConfig(animationConfig(g==null?void 0:g(l,u),userAnimationConfig(d.name,this._spec,this._markAttributeContext)))}})}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}getSeriesStyle(e){return i=>{var n,o,l,u;let d=(o=(n=this._seriesMark)===null||n===void 0?void 0:n.getAttribute(i,e))!==null&&o!==void 0?o:void 0;return i!=="fill"||d||(i="stroke",d=(u=(l=this._seriesMark)===null||l===void 0?void 0:l.getAttribute(i,e))!==null&&u!==void 0?u:void 0),i==="stroke"&&isArray(d)?d[0]:d}}}RadarSeries.type=SeriesTypeEnum.radar,RadarSeries.mark=radarSeriesMark,RadarSeries.transformerConstructor=LineLikeSeriesSpecTransformer,mixin(RadarSeries,LineLikeSeriesMixin);const registerRadarSeries=()=>{Factory$1.registerSeries(RadarSeries.type,RadarSeries),registerAreaMark(),registerLineMark(),registerSymbolMark(),registerRadarAnimation(),registerPolarBandAxis(),registerPolarLinearAxis()};class DotSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.shapeTypeCallback=()=>"square"}enableByType(e){return e==="mark"}getDefaultTitlePattern(e){return{key:"event info",value:"event info"}}getDefaultContentList(){return[{key:e=>e.type,value:e=>e.id},{key:"event_time",value:e=>TimeUtil.getInstance().timeFormat("%Y%m%d",e.event_time)},{key:"action_type",value:e=>e.action_type},{key:"children",value:e=>e.children}]}getTooltipData(e,i,n,o,l){var u,d,f,g;const _=super.getTooltipData(e,i,n,o,l),y=(f=(d=(u=this.spec)===null||u===void 0?void 0:u[e])===null||d===void 0?void 0:d.updateContent)!==null&&f!==void 0?f:(g=i==null?void 0:i[e])===null||g===void 0?void 0:g.updateContent;return _&&!y&&(_.updateContent=(b,S,v)=>{const A=[],x=b.filter(T=>T.key==="children");return x.length>0&&x[0].value.forEach(T=>{let C=!0;for(const E in T)A.push(Object.assign(Object.assign({},x[0]),{shapeType:"circle",hasShape:C,key:E,value:T[E]+""})),C=!1}),b.concat(A)}),_}}const objFlat=(r,e)=>{var i;const n=!((i=r[0])===null||i===void 0)&&i.latestData?r[0].latestData:r||[],o=[];return n.forEach(l=>{const u={};for(const f in l)f!==e&&(u[f]=l[f]);const d=l[e];d==null||d.forEach(f=>{o.push(Object.assign({},u,f))})}),o},DEFAULT_GRID_BACKGROUND={fill:"#bbb",fillOpacity:.2},dotSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{group:{name:"group",type:"group"},grid:{name:"grid",type:"rule"},gridBackground:{name:"gridBackground",type:"rect"},dot:{name:"dot",type:"symbol"},title:{name:"title",type:"text"},subTitle:{name:"subTitle",type:"text"},symbol:{name:"symbol",type:"symbol"}});class DotSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.dot}getSeriesGroupField(){return this._seriesField}setSeriesGroupField(e){isValid(e)&&(this._seriesGroupField=e)}getTitleField(){return this._titleField}setTitleField(e){isValid(e)&&(this._titleField=e)}getSubTitleField(){return this._subTitleField}setSubTitleField(e){isValid(e)&&(this._subTitleField=e)}getDotTypeField(){return this._dotTypeField}setDotTypeField(e){isValid(e)&&(this._dotTypeField=e)}getHighLightSeriesGroup(){return this._highLightSeriesGroup}setHighLightSeriesGroup(e){isValid(e)&&(this._highLightSeriesGroup=e)}setGridBackground(e){isValid(e)&&(this._gridBackground=e)}initData(){var e;super.initData(),this._xDimensionStatisticsDomain=this.getRawData().latestData.map(i=>i[this._fieldY[0]]),registerDataSetInstanceTransform(this._option.dataSet,"objFlat",objFlat),registerDataSetInstanceTransform(this._option.dataSet,"copyDataView",copyDataView),registerDataSetInstanceParser(this._option.dataSet,"dataview",dataViewParser),(e=this.getViewData())===null||e===void 0||e.transform({type:"objFlat",options:"dots",level:TransformLevel.dotObjFlat},!1)}getStatisticFields(){return[{key:this._fieldY[0],operations:["values"],customize:this._xDimensionStatisticsDomain}]}setAttrFromSpec(){var e;super.setAttrFromSpec(),this.setSeriesGroupField(this._spec.seriesGroupField),this.setTitleField(this._spec.titleField),this.setSubTitleField(this._spec.subTitleField),this.setDotTypeField(this._spec.dotTypeField),this.setHighLightSeriesGroup(this._spec.highLightSeriesGroup),this.setGridBackground(mergeSpec(DEFAULT_GRID_BACKGROUND,((e=this._spec.grid)===null||e===void 0?void 0:e.background)||{}))}initMark(){this._clipMark=this._createMark(DotSeries.mark.group),this._containerMark=this._createMark(DotSeries.mark.group,{parent:this._clipMark,dataView:this.getRawData()}),this._gridBackgroundMark=this._createMark(DotSeries.mark.gridBackground,{parent:this._containerMark,dataView:this.getRawData()}),this._gridMark=this._createMark(DotSeries.mark.grid,{parent:this._containerMark,dataView:this.getRawData()}),this._dotMark=this._createMark(DotSeries.mark.dot,{skipBeforeLayouted:!1,isSeriesMark:!0,parent:this._containerMark}),this._titleMark=this._createMark(DotSeries.mark.title,{parent:this._containerMark,dataView:this.getRawData()}),this._subTitleMark=this._createMark(DotSeries.mark.subTitle,{parent:this._containerMark,dataView:this.getRawData()}),this._symbolMark=this._createMark(DotSeries.mark.symbol,{parent:this._containerMark,dataView:this.getRawData()})}initMarkStyle(){const e=this._clipMark;e&&(this.setMarkStyle(e,{x:-this._spec.leftAppendPadding,y:0,width:1e4,height:this._spec.clipHeight},"normal",AttributeLevel.Series),e.setMarkConfig({interactive:!1,clip:!0}));const i=this._containerMark;i&&(this.setMarkStyle(i,{x:this._spec.leftAppendPadding},"normal",AttributeLevel.Series),i.setMarkConfig({interactive:!1}));const n=this._gridBackgroundMark;n&&this.setMarkStyle(n,{x:this.getRegionRectLeft.bind(this),x1:this.getRegionRectRight.bind(this),y:this.dataToGridBackgroundPositionY.bind(this),y1:this.dataToGridBackgroundPositionY1.bind(this),fill:this._gridBackground.fill,fillOpacity:this.dataToGridBackgroundOpacity.bind(this)},"normal",AttributeLevel.Series);const o=this._gridMark;o&&this.setMarkStyle(o,{stroke:this.getColorAttribute(),x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this),x1:this.getRegionRectRight.bind(this),y1:this.dataToPositionY.bind(this)},"normal",AttributeLevel.Series);const l=this._dotMark;l&&this.setMarkStyle(l,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),fill:this.getDotColorAttribute(),fillOpacity:this.dataToOpacity.bind(this)},"normal",AttributeLevel.Series);const u=this._titleMark;u&&this.setMarkStyle(u,{fill:this.getColorAttribute(),text:g=>g[this.getTitleField()],x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this)},"normal",AttributeLevel.Series);const d=this._subTitleMark;d&&this.setMarkStyle(d,{fill:this.getColorAttribute(),text:g=>g[this.getSubTitleField()],x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this)},"normal",AttributeLevel.Series);const f=this._symbolMark;f&&this.setMarkStyle(f,{x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this),fill:this.getColorAttribute()},"normal",AttributeLevel.Series)}dataToGridBackgroundPositionY(e){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:i,getBandwidth:n}=this._yAxisHelper;return i(this.getDatumPositionValues(e,this._fieldY),{bandPosition:this._bandPosition})-n(0)/2}dataToGridBackgroundPositionY1(e){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:i,getBandwidth:n}=this._yAxisHelper;return i(this.getDatumPositionValues(e,this._fieldY),{bandPosition:this._bandPosition})+n(0)/2}dataToOpacity(e){var i,n,o,l;if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:u,getScale:d}=this._xAxisHelper;return u(this.getDatumPositionValues(e,this._fieldX),{bandPosition:this._bandPosition})<d(0).range()[0]||u(this.getDatumPositionValues(e,this._fieldX),{bandPosition:this._bandPosition})>d(0).range()[1]?0:(l=(o=(n=(i=this._theme)===null||i===void 0?void 0:i.dot)===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.fillOpacity)!==null&&l!==void 0?l:1}dataToGridBackgroundOpacity(e){return e[this._seriesGroupField]===this._highLightSeriesGroup?this._gridBackground.fillOpacity:0}onLayoutEnd(e){var i,n;super.onLayoutEnd(e);const o=(n=(i=this._spec)===null||i===void 0?void 0:i.leftAppendPadding)!==null&&n!==void 0?n:0;this.setMarkStyle(this._clipMark,{width:this.getLayoutRect().width+o},"normal",AttributeLevel.Series)}getDefaultColorDomain(){var e,i;return this._seriesGroupField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesGroupField].values:this._seriesField?(i=this.getViewDataStatistics())===null||i===void 0?void 0:i.latestData[this._seriesField].values:[]}getColorAttribute(){var e,i,n;return{scale:(e=this._option.globalScale.getScale("color"))!==null&&e!==void 0?e:this._getDefaultColorScale(),field:(n=(i=this._seriesGroupField)!==null&&i!==void 0?i:this._seriesField)!==null&&n!==void 0?n:DEFAULT_DATA_SERIES_FIELD}}getDotColorScale(){var e,i,n;const o=this._dotTypeField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._dotTypeField].values:this._seriesGroupField?(i=this.getViewDataStatistics())===null||i===void 0?void 0:i.latestData[this._seriesGroupField].values:this._seriesField?(n=this.getViewDataStatistics())===null||n===void 0?void 0:n.latestData[this._seriesField].values:[],l=this._getDataScheme();return new ColorOrdinalScale().domain(o).range(l)}getDotColorAttribute(){var e,i,n,o;return{scale:(e=this._option.globalScale.getScale("color"))!==null&&e!==void 0?e:this.getDotColorScale(),field:(o=(n=(i=this._dotTypeField)!==null&&i!==void 0?i:this._seriesGroupField)!==null&&n!==void 0?n:this._seriesField)!==null&&o!==void 0?o:DEFAULT_DATA_SERIES_FIELD}}initTooltip(){this._tooltipHelper=new DotSeriesTooltipHelper(this),this._dotMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._dotMark)}onEvaluateEnd(e){super.onEvaluateEnd(e)}onMarkTreePositionUpdate(e){e.forEach(i=>{i.type==="group"?this.onMarkTreePositionUpdate(i.getMarks()):i.updateLayoutState()})}getDotData(){var e;return(e=this._dotMark)===null||e===void 0?void 0:e.getData()}_getDataIdKey(){}getStackValueField(){return null}getActiveMarks(){return[this._dotMark]}}DotSeries.type=SeriesTypeEnum.dot,DotSeries.mark=dotSeriesMark;const registerDotSeries=()=>{registerSymbolMark(),registerRuleMark(),registerRectMark(),registerTextMark(),Factory$1.registerSeries(DotSeries.type,DotSeries)};class LinkSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.shapeTypeCallback=()=>"square"}enableByType(e){return e==="mark"}getDefaultTitlePattern(e){return{key:"link info",value:"link info"}}getDefaultContentList(){return[{key:"time",value:e=>TimeUtil.getInstance().timeFormat("%Y%m%d %H:%M",e.from.split("_")[1])},{key:"type",value:e=>e.action_type},{key:"from",value:e=>e.from},{key:"to",value:e=>e.to}]}}const linkSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{group:{name:"group",type:"group"},link:{name:"link",type:"rule"},arrow:{name:"arrow",type:"symbol"}}),linkDotInfo=(r,e)=>{const{infoKey:i,fields:n,linkData:o,dotData:l}=e,{fromField:u,toField:d,xField:f,yField:g}=n(),_=o(),y=l(),b={};return y.forEach(S=>{const v={};for(const x in S)x!==i&&(v[x]=S[x]);const A=S[i];A==null||A.forEach(x=>{b[x.node_name]=Object.assign({},v,x)})}),_.forEach(S=>{var v,A,x,T;S[u+"_xField"]=(v=b==null?void 0:b[S[u]])===null||v===void 0?void 0:v[f],S[u+"_yField"]=(A=b==null?void 0:b[S[u]])===null||A===void 0?void 0:A[g],S[d+"_xField"]=(x=b==null?void 0:b[S[d]])===null||x===void 0?void 0:x[f],S[d+"_yField"]=(T=b==null?void 0:b[S[d]])===null||T===void 0?void 0:T[g]}),_};class LinkSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.link}getFromField(){return this._fromField}setFromField(e){isValid(e)&&(this._fromField=e)}getToField(){return this._toField}setToField(e){isValid(e)&&(this._toField=e)}getDotTypeField(){return this._dotTypeField}setDotTypeField(e){isValid(e)&&(this._dotTypeField=e)}getDotSeriesSpec(){return this._dotSeriesSpec}setDotSeriesSpec(e){isValid(e)&&(this._dotSeriesSpec=e)}_getDotData(){const e=this._option.getChart().getSeriesInIndex([this._spec.dotSeriesIndex])[0];return e?e.getRawData().latestData:[]}initData(){var e;super.initData(),registerDataSetInstanceTransform(this._option.dataSet,"linkDotInfo",linkDotInfo),(e=this.getViewData())===null||e===void 0||e.transform({type:"linkDotInfo",options:{infoKey:"dots",fields:()=>({fromField:this._fromField,toField:this._toField,xField:this._dotSeriesSpec.xField,yField:this._dotSeriesSpec.yField}),linkData:()=>this._rawData.latestData,dotData:()=>this._getDotData()},level:TransformLevel.linkDotInfo},!1)}setAttrFromSpec(){super.setAttrFromSpec(),this.setFromField(this._spec.fromField),this.setToField(this._spec.toField),this.setDotTypeField(this._spec.dotTypeField),this.setDotSeriesSpec(this._spec.dotSeriesSpec)}initMark(){this._clipMark=this._createMark(LinkSeries.mark.group),this._containerMark=this._createMark(LinkSeries.mark.group,{parent:this._clipMark}),this._linkMark=this._createMark(LinkSeries.mark.link,{skipBeforeLayouted:!1,parent:this._containerMark}),this._arrowMark=this._createMark(LinkSeries.mark.arrow,{skipBeforeLayouted:!1,isSeriesMark:!0,parent:this._containerMark})}initMarkStyle(){var e,i,n,o;const l=this._clipMark;l&&(this.setMarkStyle(l,{x:-this._spec.leftAppendPadding,y:0,width:1e4,height:this._spec.clipHeight},"normal",AttributeLevel.Series),l.setMarkConfig({interactive:!1,clip:!0}));const u=this._containerMark;u&&(this.setMarkStyle(u,{x:this._spec.leftAppendPadding,width:this.getLayoutRect().width},"normal",AttributeLevel.Series),u.setMarkConfig({interactive:!1}));const d=this._linkMark;d&&this.setMarkStyle(d,{stroke:this.getColorAttribute(),strokeOpacity:this.dataToOpacity.bind(this),x:this.dataToPositionXFrom.bind(this),y:this.dataToPositionYFrom.bind(this),x1:this.dataToPositionXTo.bind(this),y1:this.dataToPositionYTo.bind(this)},"normal",AttributeLevel.Series);const f=this._arrowMark;if(f){const g=(o=(n=(i=(e=this._theme)===null||e===void 0?void 0:e.arrow)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.size)!==null&&o!==void 0?o:10;this.setMarkStyle(f,{x:this.dataToPositionXTo.bind(this),y:_=>this.dataToPositionArrowYTo(_,g),fill:this.getColorAttribute(),fillOpacity:this.dataToOpacity.bind(this),size:g,symbolType:_=>this.isPositionYFromHigher(_)?"triangleDown":"triangleUp"},"normal",AttributeLevel.Series)}}afterInitMark(){super.afterInitMark()}dataToPositionXFrom(e){if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:i}=this._xAxisHelper;return i(this.getDatumPositionValues(e,this._fromField+"_xField"),{bandPosition:this._bandPosition})}dataToPositionYFrom(e){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:i}=this._yAxisHelper;return i(this.getDatumPositionValues(e,this._fromField+"_yField"))}dataToPositionXTo(e){if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:i}=this._xAxisHelper;return i(this.getDatumPositionValues(e,this._toField+"_xField"),{bandPosition:this._bandPosition})}dataToPositionYTo(e){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:i}=this._yAxisHelper;return i(this.getDatumPositionValues(e,this._toField+"_yField"),{bandPosition:this._bandPosition})}dataToPositionArrowYTo(e,i){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:n}=this._yAxisHelper,o=this.isPositionYFromHigher(e)?-i/2:i/2;return n(this.getDatumPositionValues(e,this._toField+"_yField"),{bandPosition:this._bandPosition})+o}dataToOpacity(e){return this.isPositionXOuterRange(e,this._fromField+"_xField")||this.isPositionXOuterRange(e,this._toField+"_xField")||e[this._fromField]===e[this._toField]?0:1}isPositionYFromHigher(e){return this.dataToPositionYFrom(e)<this.dataToPositionYTo(e)}isPositionXOuterRange(e,i){if(!this._xAxisHelper)return!1;const{dataToPosition:n,getScale:o}=this._xAxisHelper;return n(this.getDatumPositionValues(e,i),{bandPosition:this._bandPosition})<o(0).range()[0]||n(this.getDatumPositionValues(e,i),{bandPosition:this._bandPosition})>o(0).range()[1]}getDefaultColorDomain(){var e,i;return this._dotTypeField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._dotTypeField].values:this._seriesField?(i=this.getViewDataStatistics())===null||i===void 0?void 0:i.latestData[this._seriesField].values:[]}getColorAttribute(){var e,i,n;return{scale:(e=this._option.globalScale.getScale("color"))!==null&&e!==void 0?e:this._getDefaultColorScale(),field:(n=(i=this._dotTypeField)!==null&&i!==void 0?i:this._seriesField)!==null&&n!==void 0?n:DEFAULT_DATA_SERIES_FIELD}}initInteraction(){const e=[];this._linkMark&&e.push(this._linkMark),this._arrowMark&&e.push(this._arrowMark),this._parseInteractionConfig(e)}initTooltip(){this._tooltipHelper=new LinkSeriesTooltipHelper(this),this._linkMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._linkMark),this._arrowMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._arrowMark)}onMarkTreePositionUpdate(e){e.forEach(i=>{i.type==="group"?this.onMarkTreePositionUpdate(i.getMarks()):i.updateLayoutState()})}getDotInfoData(){var e,i;return(i=(e=this._linkMark)!==null&&e!==void 0?e:this._arrowMark)===null||i===void 0?void 0:i.getData()}getActiveMarks(){return[this._linkMark,this._arrowMark]}}LinkSeries.type=SeriesTypeEnum.link,LinkSeries.mark=linkSeriesMark;const registerLinkSeries=()=>{registerRuleMark(),registerSymbolMark(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(LinkSeries.type,LinkSeries)},progressLikeSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{group:{name:"group",type:"group"}});class ProgressLikeSeries extends PolarSeries{constructor(){super(...arguments),this._arcGroupMark=null,this._getAngleValueStart=e=>{const i=this._getAngleAxis(),{tickMask:n}=this._spec;if(n!=null&&n.forceAlign&&this._isTickMaskVisible(i)){const o=e[this.getStack()?STACK_FIELD_START:SEGMENT_FIELD_START],l=this._getAngleAxisSubTickData(i),u=l[1].value-l[0].value,d=degreeToRadian(n.offsetAngle);let f;if(isValid(o)){const g=binaryFuzzySearch(l,y=>y.value-o),_=g>=l.length||o>l[g].value-u/2?Math.min(g,l.length-1):g>0?g-1:void 0;_!==void 0&&(f=this.angleAxisHelper.dataToPosition([l[_].value-u/2]))}return isNil(f)&&(f=this.angleAxisHelper.dataToPosition([l[0].value-u/2])),f+d}return this._getAngleValueStartWithoutMask(e)},this._getAngleValueEnd=e=>{const i=this._getAngleAxis(),{tickMask:n}=this._spec;if(n!=null&&n.forceAlign&&this._isTickMaskVisible(i)){const o=e[this.getStack()?STACK_FIELD_END:this._angleField[0]],l=this._getAngleAxisSubTickData(i),u=l[1].value-l[0].value,d=degreeToRadian(n.offsetAngle),f=binaryFuzzySearch(l,y=>y.value-o),g=f>=l.length||o>l[f].value-u/2?Math.min(f,l.length-1):f>0?f-1:void 0;let _;return _=g!==void 0?this.angleAxisHelper.dataToPosition([l[g].value+u/2]):this.angleAxisHelper.dataToPosition([l[0].value-u/2]),_+d}return this._getAngleValueEndWithoutMask(e)}}setAttrFromSpec(){var e,i,n;super.setAttrFromSpec();const o=(e=this._option.globalInstance.getChart())===null||e===void 0?void 0:e.getSpec(),l=(i=this._spec.startAngle)!==null&&i!==void 0?i:o==null?void 0:o.startAngle;this._startAngle=isValid(l)?degreeToRadian(l):POLAR_START_RADIAN;const u=(n=this._spec.endAngle)!==null&&n!==void 0?n:o==null?void 0:o.endAngle;this._endAngle=isValid(u)?degreeToRadian(u):POLAR_END_RADIAN,this.setAngleField(this._spec.valueField||this._spec.angleField),this.setRadiusField(this._spec.categoryField||this._spec.radiusField),this._specAngleField=this._angleField.slice(),this._specRadiusField=this._radiusField.slice()}getStackGroupFields(){return this._radiusField}getStackValueField(){var e;return(e=this._angleField)===null||e===void 0?void 0:e[0]}getGroupFields(){return this._angleField}_convertMarkStyle(e){const i=super._convertMarkStyle(e);if(i.fill){const n=e.fill;(n==null?void 0:n.gradient)!=="conical"||isValid(n==null?void 0:n.startAngle)||isValid(n==null?void 0:n.endAngle)||(i.fill=Object.assign(Object.assign({},n),{startAngle:this._startAngle,endAngle:this._endAngle}))}return i}_getAngleValueStartWithoutMask(e){if(this.getStack()){const i=valueInScaleRange(this.angleAxisHelper.dataToPosition([e[STACK_FIELD_START]]),this.angleAxisHelper.getScale(0));if(isValidNumber(i))return i}return this._startAngle}_getAngleValueEndWithoutMask(e){if(this.getStack()){const i=valueInScaleRange(this.angleAxisHelper.dataToPosition([e[STACK_FIELD_END]]),this.angleAxisHelper.getScale(0));if(isValidNumber(i))return i}return this.angleAxisHelper.dataToPosition([e[this._angleField[0]]])}getDimensionField(){return this._specRadiusField}getMeasureField(){return this._specAngleField}initMark(){this._initArcGroupMark()}initMarkStyle(){this._initArcGroupMarkStyle()}_initArcGroupMark(){return this._arcGroupMark=this._createMark(ProgressLikeSeries.mark.group,{skipBeforeLayouted:!1}),this._arcGroupMark}_initArcGroupMarkStyle(){const e=this._arcGroupMark;e.created(),this.setMarkStyle(e,{x:0,y:0},"normal",AttributeLevel.Series),this._arcGroupMark.setMarkConfig({interactive:!1,zIndex:this.layoutZIndex,clip:!0,clipPath:()=>{const i=this._getAngleAxis();if(this._isTickMaskVisible(i)){const{tickMask:l}=this._spec,{angle:u,offsetAngle:d,style:f={}}=l,g=this._getAngleAxisSubTickData(i),{x:_,y}=this.angleAxisHelper.center(),b=this._computeLayoutRadius(),S=f;return g.map(({value:v})=>{const A=this.angleAxisHelper.dataToPosition([v])+degreeToRadian(d),x=degreeToRadian(u)/2;return createArc(Object.assign(Object.assign({},S),{x:_,y,startAngle:A-x,endAngle:A+x,innerRadius:b*this._innerRadius,outerRadius:b*this._outerRadius,fill:!0}))})}const{width:n,height:o}=this.getLayoutRect();return[createRect({width:n,height:o,fill:!0})]}})}_getAngleAxis(){if(!this.angleAxisHelper)return;const e=this.angleAxisHelper.getAxisId();return this._option.getChart().getAllComponents().find(i=>i.id===e)}_getAngleAxisTickData(e){var i;return(i=e==null?void 0:e.getTickData())===null||i===void 0?void 0:i.getLatestData()}_isTickMaskVisible(e){const i=this._getAngleAxisTickData(e),{tickMask:n}=this._spec;return n&&n.visible!==!1&&(i==null?void 0:i.length)>1}_getAngleAxisSubTickData(e){var i;const n=this._getAngleAxisTickData(e),o=[],{subTick:l={},tick:u={}}=(i=e==null?void 0:e.getSpec())!==null&&i!==void 0?i:{},{tickCount:d=4}=l,{alignWithLabel:f}=u;if((n==null?void 0:n.length)>=2){const g=n[1].value-n[0].value;for(let _=0;_<n.length-1;_++){const y=n[_],b=n[_+1];o.push(y);for(let S=0;S<d;S++){const v=(S+1)/(d+1),A=(1-v)*y.value+v*(b?b.value:f?1:y.value+g);o.push({value:A})}}return o.push(n[n.length-1]),o}return n}}ProgressLikeSeries.mark=progressLikeSeriesMark;const circularProgressSeriesMark=Object.assign(Object.assign({},progressLikeSeriesMark),{track:{name:"track",type:"arc"},progress:{name:"progress",type:"arc"}}),Appear_Grow$2=r=>({type:"growAngleIn",options:{overall:r.startAngle}}),Appear_FadeIn$2={type:"fadeIn"};function progressLikePresetAnimation(r,e){return e==="fadeIn"?Appear_FadeIn$2:Appear_Grow$2(r)}const registerProgressLikeAnimation=()=>{Factory$1.registerAnimation("circularProgress",(r,e)=>({appear:progressLikePresetAnimation(r,e),enter:{type:"growAngleIn"},disappear:{type:"growAngleOut"}}))};class CircularProgressSeriesSpecTransformer extends BaseSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!0}}class CircularProgressSeries extends ProgressLikeSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.circularProgress,this.transformerConstructor=CircularProgressSeriesSpecTransformer,this._progressMark=null,this._trackMark=null,this._getRadiusValueStart=e=>{if(this.getGroupFields().length>1){const i=this.radiusAxisHelper.dataToPosition(this.getDatumPositionValues(e,this.getGroupFields()));if(isValidNumber(i))return i}return this.radiusAxisHelper.dataToPosition([e[this._radiusField[0]]])},this._getRadiusValueEnd=e=>{var i,n;if(this.getGroupFields().length>1){const o=this.radiusAxisHelper.dataToPosition(this.getDatumPositionValues(e,this.getGroupFields()))+((n=(i=this.radiusAxisHelper).getBandwidth)===null||n===void 0?void 0:n.call(i,this._groups?this._groups.fields.length-1:0));if(isValidNumber(o))return o}return this.radiusAxisHelper.dataToPosition([e[this._radiusField[0]]])+this.radiusAxisHelper.getScale(0).step()}}getStackGroupFields(){return this.getGroupFields()}getGroupFields(){return this._radiusField}initMark(){super.initMark(),this._initTrackMark(),this._initProgressMark()}initMarkStyle(){super.initMarkStyle(),this._initTrackMarkStyle(),this._initProgressMarkStyle()}_initProgressMark(){var e,i;return this._progressMark=this._createMark(CircularProgressSeries.mark.progress,{parent:this._arcGroupMark,isSeriesMark:!0,stateSort:(e=this._spec.progress)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.progress)===null||i===void 0?void 0:i.customShape}),this._progressMark}_initProgressMarkStyle(){var e;const i=this._progressMark;i&&this.setMarkStyle(i,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._getAngleValueStart,endAngle:this._getAngleValueEnd,innerRadius:this._getRadiusValueStart,outerRadius:this._getRadiusValueEnd,cap:(e=this._spec.roundCap)!==null&&e!==void 0&&e,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:200,forceShowCap:!0},"normal",AttributeLevel.Series)}initInteraction(){const e=[];this._trackMark&&e.push(this._trackMark),this._progressMark&&e.push(this._progressMark),this._parseInteractionConfig(e)}initTooltip(){super.initTooltip(),this._progressMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._progressMark)}_initTrackMark(){var e,i;return this._trackMark=this._createMark(CircularProgressSeries.mark.track,{parent:this._arcGroupMark,stateSort:(e=this._spec.track)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.track)===null||i===void 0?void 0:i.customShape}),this._trackMark}_initTrackMarkStyle(){const e=this._trackMark;e&&this.setMarkStyle(e,{visible:i=>{const n=this.angleAxisHelper.getScale(0).range(),o=Math.min(n[0],n[n.length-1]),l=this._getAngleValueStartWithoutMask(i);return Math.abs(l-o)<=1e-14},x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:()=>{const i=this.getStack()?STACK_FIELD_START:this._angleField[0],n=this.angleAxisHelper.getScale(0).domain();return this._getAngleValueStart({[i]:n[0]})},endAngle:()=>{const i=this.getStack()?STACK_FIELD_END:this._angleField[0],n=this.angleAxisHelper.getScale(0).domain();return this._getAngleValueEnd({[i]:n[n.length-1]})},innerRadius:this._getRadiusValueStart,outerRadius:this._getRadiusValueEnd,cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:100},"normal",AttributeLevel.Series)}initAnimation(){var e,i,n,o;const l=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this._progressMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("circularProgress"))===null||n===void 0?void 0:n({startAngle:this._startAngle},l),userAnimationConfig("progress",this._spec,this._markAttributeContext))),this._trackMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("fadeInOut"))===null||o===void 0?void 0:o(),userAnimationConfig("track",this._spec,this._markAttributeContext)))}getActiveMarks(){return[this._progressMark]}}CircularProgressSeries.type=SeriesTypeEnum.circularProgress,CircularProgressSeries.mark=circularProgressSeriesMark,CircularProgressSeries.transformerConstructor=CircularProgressSeriesSpecTransformer;const registerCircularProgressSeries=()=>{Factory$1.registerSeries(CircularProgressSeries.type,CircularProgressSeries),registerArcMark(),registerProgressLikeAnimation(),registerFadeInOutAnimation(),registerPolarBandAxis(),registerPolarLinearAxis()};function LinearProgressGrowOption(r){return()=>r.direction==="vertical"?{orient:"negative"}:{orient:"positive"}}const Appear_Grow$1=r=>({type:r.direction==="horizontal"?"growWidthIn":"growHeightIn",options:LinearProgressGrowOption(r)}),linearProgressDisappear=r=>({type:r.direction==="horizontal"?"growWidthOut":"growHeightOut",options:LinearProgressGrowOption(r)}),Appear_FadeIn$1={type:"fadeIn"};function linearProgressPresetAnimation(r,e){return e===!1?{}:e==="fadeIn"?Appear_FadeIn$1:Appear_Grow$1(r)}const registerLinearProgressAnimation=()=>{Factory$1.registerAnimation("linearProgress",(r,e)=>({appear:linearProgressPresetAnimation(r,e),enter:{type:"grow"},disappear:linearProgressDisappear(r)}))};class LinearProgressSeriesTooltipHelper extends BaseSeriesTooltipHelper{enableByType(e){return e!=="dimension"}}const linearProgressSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{track:{name:"track",type:"rect"},progress:{name:"progress",type:"rect"},group:{name:"group",type:"group"}});class LinearProgressSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.linearProgress,this._progressMark=null,this._trackMark=null,this._defaultProgressCustomShape=(e,i,n)=>{var o,l;const u=(o=this._spec)===null||o===void 0?void 0:o.cornerRadius,d=isValid(i.width)?i.width:i.x1-i.x,f=isValid(i.height)?i.height:i.y1-i.y,g=Math.min(0,d),_=Math.max(0,d),y=Math.min(0,f),b=Math.max(0,f);if(u>0){let S=u;if(((l=this._spec)===null||l===void 0?void 0:l.direction)==="vertical"){if(S=Math.min(Math.abs(d/2),u),2*S>Math.abs(f)){const v=Math.acos((S-Math.abs(f)/2)/S);return n.moveTo(g+S,y),n.arc(g+S,y+S,S,1.5*Math.PI,1.5*Math.PI-v,!0),n.arc(g+S,b-S,S,v+Math.PI/2,Math.PI/2,!0),n.lineTo(_-u,b),n.arc(_-S,b-S,S,Math.PI/2,Math.PI/2-v,!0),n.arc(_-S,y+S,S,-Math.PI/2+v,-Math.PI/2,!0),n.lineTo(g+S,y),n.closePath(),n}}else if(S=Math.min(Math.abs(f/2),u),2*S>Math.abs(d)){const v=Math.acos((S-Math.abs(d)/2)/S);return n.moveTo(g,y+S),n.arc(g+S,y+S,S,Math.PI,Math.PI+v),n.arc(_-S,y+S,S,-v,0),n.lineTo(_,b-S),n.arc(_-S,b-S,S,0,v),n.arc(g+S,b-S,S,Math.PI-v,Math.PI),n.closePath(),n}n.moveTo(g,y+S),n.arc(g+S,y+S,S,Math.PI,1.5*Math.PI),n.lineTo(_-S,y),n.arc(_-S,y+S,S,-Math.PI/2,0),n.lineTo(_,b-S),n.arc(_-S,b-S,S,0,Math.PI/2),n.lineTo(g+S,b),n.arc(g+S,b-S,S,Math.PI/2,Math.PI),n.closePath()}else n.moveTo(g,y),n.lineTo(_,y),n.lineTo(_,b),n.lineTo(g,b),n.closePath();return n}}initMark(){this._initTrackMark(),this._initProgressMark()}initMarkStyle(){this._initTrackMarkStyle(),this._initProgressMarkStyle()}_initProgressMark(){var e,i,n;return this._progressMark=this._createMark(LinearProgressSeries.mark.progress,{isSeriesMark:!0,stateSort:(e=this._spec.progress)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(n=(i=this._spec.progress)===null||i===void 0?void 0:i.customShape)!==null&&n!==void 0?n:this._defaultProgressCustomShape}),this._progressMark}_initProgressMarkStyle(){var e,i,n,o;const l=this._progressMark;if(l)if(this._spec.direction==="vertical"){const u=this._spec.progress||{},d=(e=u.leftPadding)!==null&&e!==void 0?e:0,f=(i=u.rightPadding)!==null&&i!==void 0?i:0;this.setMarkStyle(l,{x:g=>{var _,y;return valueInScaleRange(this.dataToPositionX(g),(y=(_=this._xAxisHelper)===null||_===void 0?void 0:_.getScale)===null||y===void 0?void 0:y.call(_,0),!0)-this._spec.bandWidth/2+d},y1:g=>{var _,y;return valueInScaleRange(this.dataToPositionY(g),(y=(_=this._yAxisHelper)===null||_===void 0?void 0:_.getScale)===null||y===void 0?void 0:y.call(_,0))},y:()=>{var g;return(g=this._yAxisHelper)===null||g===void 0?void 0:g.dataToPosition([0],{bandPosition:this._bandPosition})},width:this._spec.bandWidth-d-f,cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute()},"normal",AttributeLevel.Series)}else{const u=this._spec.progress||{},d=(n=u.topPadding)!==null&&n!==void 0?n:0,f=(o=u.bottomPadding)!==null&&o!==void 0?o:0;this.setMarkStyle(l,{x1:g=>{var _,y;return valueInScaleRange(this.dataToPositionX(g),(y=(_=this._xAxisHelper)===null||_===void 0?void 0:_.getScale)===null||y===void 0?void 0:y.call(_,0))},y:g=>{var _,y;return valueInScaleRange(this.dataToPositionY(g),(y=(_=this._yAxisHelper)===null||_===void 0?void 0:_.getScale)===null||y===void 0?void 0:y.call(_,0),!0)-this._spec.bandWidth/2+d},height:this._spec.bandWidth-d-f,x:()=>{var g;return(g=this._xAxisHelper)===null||g===void 0?void 0:g.dataToPosition([0],{bandPosition:this._bandPosition})},cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute()},"normal",AttributeLevel.Series)}}_initTrackMark(){var e,i;return this._trackMark=this._createMark(LinearProgressSeries.mark.track,{stateSort:(e=this._spec.track)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.track)===null||i===void 0?void 0:i.customShape}),this._trackMark}_initTrackMarkStyle(){const e=this._trackMark;e&&(this._spec.direction==="vertical"?this.setMarkStyle(e,{x:i=>{var n,o;return valueInScaleRange(this.dataToPositionX(i),(o=(n=this._xAxisHelper)===null||n===void 0?void 0:n.getScale)===null||o===void 0?void 0:o.call(n,0),!0)-this._spec.bandWidth/2},y:0,width:this._spec.bandWidth,height:()=>this._scaleY.range()[0],cornerRadius:this._spec.cornerRadius},"normal",AttributeLevel.Series):this.setMarkStyle(e,{x:0,y:i=>{var n,o;return valueInScaleRange(this.dataToPositionY(i),(o=(n=this._yAxisHelper)===null||n===void 0?void 0:n.getScale)===null||o===void 0?void 0:o.call(n,0),!0)-this._spec.bandWidth/2},height:this._spec.bandWidth,width:()=>this._scaleX.range()[1],cornerRadius:this._spec.cornerRadius},"normal",AttributeLevel.Series))}initInteraction(){const e=[];this._trackMark&&e.push(this._trackMark),this._progressMark&&e.push(this._progressMark),this._parseInteractionConfig(e)}initAnimation(){var e,i,n,o;const l={direction:this.direction},u=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this._progressMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("linearProgress"))===null||n===void 0?void 0:n(l,u),userAnimationConfig("progress",this._spec,this._markAttributeContext))),this._trackMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("fadeInOut"))===null||o===void 0?void 0:o(),userAnimationConfig("track",this._spec,this._markAttributeContext)))}initTooltip(){this._tooltipHelper=new LinearProgressSeriesTooltipHelper(this),this._progressMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._progressMark),this._trackMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._trackMark)}getActiveMarks(){return[this._progressMark]}}LinearProgressSeries.type=SeriesTypeEnum.linearProgress,LinearProgressSeries.mark=linearProgressSeriesMark;const registerLinearProgressSeries=()=>{registerRectMark(),registerLinearProgressAnimation(),registerFadeInOutAnimation(),Factory$1.registerSeries(LinearProgressSeries.type,LinearProgressSeries)},DEFAULT_ROTATE_ANGLES=[0],DEFAULT_DRAW_OUT_OF_BOUND="hidden",DEFAULT_MIN_FONT_SIZE=20,DEFAULT_FONTSIZE_RANGE=[20,40],DEFAULT_FONT_WEIGHT_RANGE=[200,500],DEFAULT_MASK_SHAPE="circle",DEFAULT_ZOOM_TO_FIT={shrink:!1,enlarge:!1,fontSizeLimitMin:0},DEFAULT_RANDOM=!0,DEFAULT_FONT_PADDING=1,SHAPE_TYPE=["triangleForward","triangle","diamond","square","star","cardioid","circle","pentagon","rect"],WORD_CLOUD_TEXT=`${PREFIX}_WORD_CLOUD_TEXT`,wordCloudSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{word:{name:"word",type:"text"},fillingWord:{name:"fillingWord",type:"text"},wordMask:{name:"wordMask",type:"rect"}});class BaseWordCloudSeries extends BaseSeries{constructor(){super(...arguments),this._fontSizeRange=[DEFAULT_MIN_FONT_SIZE,DEFAULT_MIN_FONT_SIZE],this._isWordCloudShape=!1,this._dataChange=!0,this.handleMaskCanvasUpdate=(e,i)=>{this._maskCanvas=e},this.getWordColor=e=>e.isFillingWord?(this._fillingColorCallback&&!this._dataChange||(this._fillingColorCallback=this._wordCloudShapeConfig.fillingColorHexField?i=>i[this._wordCloudShapeConfig.fillingColorHexField]:this.initColorCallback(this._wordCloudShapeConfig.fillingSeriesField,!0)),this._fillingColorCallback(e)):(this._keyWordColorCallback&&!this._dataChange||(this._keyWordColorCallback=this._spec.colorHexField?i=>i[this._spec.colorHexField]:this.initColorCallback(this._seriesField,!1)),this._keyWordColorCallback(e)),this._calculateFontWeight=e=>{const i=this.getRawDataStatisticsByField(this._valueField,!0);return i.min===i.max?this._fontWeightRange[0]:this._fontWeightRange[0]+(this._fontWeightRange[this._fontWeightRange.length-1]-this._fontWeightRange[0])*(e[this._valueField]-i.min)/(i.max-i.min)}}setValueField(e){isValid(e)&&(this._valueField=e)}setFontSizeRange(e){isValid(e)?this._fontSizeRange=e:this._fontSizeRange=DEFAULT_FONTSIZE_RANGE}setAttrFromSpec(){var e,i,n,o,l;super.setAttrFromSpec(),this._padding=this._option.getChart().padding,this._nameField=this._spec.nameField,this._colorMode=(e=this._spec.colorMode)!==null&&e!==void 0?e:"ordinal",this._colorList=this._spec.colorList,this.setValueField(this._spec.valueField),this._fontWeightRange=(i=this._spec.fontWeightRange)!==null&&i!==void 0?i:DEFAULT_FONT_WEIGHT_RANGE,this._rotateAngles=(n=this._spec.rotateAngles)!==null&&n!==void 0?n:DEFAULT_ROTATE_ANGLES,this.setFontSizeRange(this._spec.fontSizeRange),this._maskShape=(o=this._spec.maskShape)!==null&&o!==void 0?o:DEFAULT_MASK_SHAPE,this._textField=!((l=this._spec.word)===null||l===void 0)&&l.formatMethod?WORD_CLOUD_TEXT:this._nameField;const u=this._spec.wordCloudConfig;this._wordCloudConfig=Object.assign({drawOutOfBound:DEFAULT_DRAW_OUT_OF_BOUND,layoutMode:"default",zoomToFit:DEFAULT_ZOOM_TO_FIT},this._spec.wordCloudConfig),u&&!isNil(u.layoutMode)||isTrueBrowser(this._option.mode)||(this._wordCloudConfig.layoutMode="fast"),this._wordCloudShapeConfig=Object.assign({fillingSeriesField:this.getSeriesField(),fillingRotateAngles:DEFAULT_ROTATE_ANGLES,layoutMode:"default"},this._spec.wordCloudShapeConfig),this._isWordCloudShape=!SHAPE_TYPE.includes(this._maskShape)&&!["fast","grid","cloud"].includes(this._wordCloudConfig.layoutMode),this._defaultFontFamily=this._option.getTheme().fontFamily}initData(){var e,i;super.initData(),(i=(e=this.getViewData())===null||e===void 0?void 0:e.target)===null||i===void 0||i.addListener("change",()=>{this._dataChange=!0,this.compile()})}initMark(){var e;!((e=this._spec.wordMask)===null||e===void 0)&&e.visible&&(this._maskMark=this._createMark(BaseWordCloudSeries.mark.wordMask,{dataView:!1})),this._wordMark=this._createMark(BaseWordCloudSeries.mark.word,{key:DEFAULT_DATA_KEY,groupKey:this._seriesField,isSeriesMark:!0},{morphElementKey:this._seriesField})}initMarkStyle(){this.initMarkStyleOfWord(this._wordMark,this._spec.word,this._spec.colorHexField,this._seriesField),this._maskMark&&this.setMarkStyle(this._maskMark,{width:()=>this._region.getLayoutRect().width,height:()=>this._region.getLayoutRect().height,background:()=>this._maskCanvas},"normal",AttributeLevel.Series)}initMarkStyleOfWord(e,i,n,o,l){var u,d;e&&(this.setMarkStyle(e,{text:i!=null&&i.formatMethod?f=>i.formatMethod(f):f=>f[this._textField],x:f=>f.x,y:f=>f.y,fontSize:f=>f.fontSize,fontStyle:f=>f.fontStyle,angle:f=>f.angle,visible:f=>f.visible},"normal",AttributeLevel.Series),this.setMarkStyle(e,{fill:(d=(u=i==null?void 0:i.style)===null||u===void 0?void 0:u.fill)!==null&&d!==void 0?d:this.getWordColor,fontWeight:f=>f.fontWeight,fontFamily:f=>f.fontFamily},"normal",AttributeLevel.User_Mark))}initTooltip(){super.initTooltip(),this._wordMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._wordMark)}initAnimation(){[this._wordMark].forEach(e=>{var i,n;if(e){const o=(n=(i=this._spec)===null||i===void 0?void 0:i.animationAppear)===null||n===void 0?void 0:n.preset,l={animationConfig:()=>{var u,d;return(d=(u=e.getAnimationConfig())===null||u===void 0?void 0:u.appear)===null||d===void 0?void 0:d[0]}};e.setAnimationConfig(animationConfig(Factory$1.getAnimationInKey("wordCloud")(l,o),userAnimationConfig("word",this._spec,this._markAttributeContext)))}})}getWordOrdinalColorScale(e,i){var n,o,l,u,d;const f=i?this._wordCloudShapeConfig.fillingColorList:this._colorList,g=e?(n=this.getViewData())===null||n===void 0?void 0:n.latestData.map(y=>y[e]):[],_=(l=f??((o=this._option.globalScale.getScale("color"))===null||o===void 0?void 0:o.range()))!==null&&l!==void 0?l:this._getDataScheme();return(d=(u=new ColorOrdinalScale().domain(g)).range)===null||d===void 0?void 0:d.call(u,_)}initColorCallback(e,i){var n,o,l,u;if(this._colorMode==="ordinal"){const g=this.getWordOrdinalColorScale(e,i);return _=>g.scale(_[e??DEFAULT_DATA_SERIES_FIELD])}const d=(n=i?this._colorList:this._wordCloudShapeConfig.fillingColorList)!==null&&n!==void 0?n:this._option.globalScale.getScale("color").range();if(d.length===1)return g=>d[0];if(this._valueField){const g=this.getRawDataStatisticsByField(this._valueField,!0);if(g.min===g.max)return d[0];const _=new LinearScale().domain([g.min,g.max]).range(d);return y=>_.scale(y[this._valueField])}const f=new LinearScale().domain([0,(u=(l=(o=this.getViewData())===null||o===void 0?void 0:o.latestData)===null||l===void 0?void 0:l.length)!==null&&u!==void 0?u:1]).range(d);return g=>f.scale(g[DEFAULT_DATA_INDEX])}compile(){super.compile();const{width:e,height:i}=this._region.getLayoutRect();if(!isValidNumber(e)||!isValidNumber(i)||!(i>0&&e>0))return;const n=this._wordMark.getProduct();if(n){const o=[];this._isWordCloudShape?o.push(Object.assign({type:"wordcloudShape"},this._wordCloudShapeTransformOption())):o.push(Object.assign({type:"wordcloud"},this._wordCloudTransformOption())),n.transform(o)}}_getCommonTransformOptions(){var e,i,n,o,l,u;const{width:d,height:f}=this._region.getLayoutRect(),g=(e=this._spec.word)!==null&&e!==void 0?e:{},_=(i=g.style)!==null&&i!==void 0?i:{};return{size:[d,f],shape:isObject$1(this._maskShape)&&this._maskShape.type==="text"&&isNil(this._maskShape.fontFamily)?Object.assign({fontFamily:(n=this._option.getTheme())===null||n===void 0?void 0:n.fontFamily},this._maskShape):this._maskShape,onUpdateMaskCanvas:this.handleMaskCanvasUpdate,dataIndexKey:DEFAULT_DATA_KEY,text:g.formatMethod?y=>g.formatMethod(y):{field:this._textField},fontSize:this._valueField?{field:this._valueField}:this._fontSizeRange[0],fontSizeRange:this._fontSizeRange==="auto"?null:this._fontSizeRange,padding:(l=(o=this._spec.word)===null||o===void 0?void 0:o.padding)!==null&&l!==void 0?l:DEFAULT_FONT_PADDING,fontFamily:isValid(this._spec.fontFamilyField)?{field:this._spec.fontFamilyField}:(u=_.fontFamily)!==null&&u!==void 0?u:this._defaultFontFamily,fontWeight:isValid(this._spec.fontWeightField)?{field:this._spec.fontWeightField}:isValid(_.fontWeight)?_.fontWeight:isValid(this._valueField)?this._calculateFontWeight:"normal",fontStyle:isValid(this._spec.fontStyleField)?{field:this._spec.fontStyleField}:_.fontStyle}}_wordCloudTransformOption(){var e,i;const n=(e=this._wordCloudConfig)!==null&&e!==void 0?e:{};return Object.assign(Object.assign(Object.assign({},n),this._getCommonTransformOptions()),{layoutType:this._wordCloudConfig.layoutMode,rotate:this._rotateAngles,randomVisible:(i=this._spec.random)!==null&&i!==void 0?i:DEFAULT_RANDOM,clip:this._wordCloudConfig.drawOutOfBound==="clip",shrink:this._wordCloudConfig.zoomToFit.shrink,enlarge:this._wordCloudConfig.zoomToFit.enlarge,minFontSize:this._wordCloudConfig.zoomToFit.fontSizeLimitMin,progressiveTime:this._wordCloudConfig.progressiveTime,progressiveStep:this._wordCloudConfig.progressiveStep,repeatFill:this._wordCloudConfig.zoomToFit.repeat})}_wordCloudShapeTransformOption(){var e,i,n,o,l,u;const d=(i=(e=this._spec.fillingWord)===null||e===void 0?void 0:e.style)!==null&&i!==void 0?i:{},f=(n=this._wordCloudShapeConfig)!==null&&n!==void 0?n:{};return Object.assign(Object.assign(Object.assign({},f),this._getCommonTransformOptions()),{rotateList:this._rotateAngles,fillingRotateList:f.fillingRotateAngles,fillingFontFamily:isValid(f.fillingFontFamilyField)?{field:f.fillingFontFamilyField}:(o=d.fontFamily)!==null&&o!==void 0?o:this._defaultFontFamily,fillingPadding:(u=(l=this._spec.fillingWord)===null||l===void 0?void 0:l.padding)!==null&&u!==void 0?u:DEFAULT_FONT_PADDING,fillingFontStyle:isValid(f.fillingFontStyleField)?{field:f.fillingFontStyleField}:d.fontStyle,fillingFontWeight:isValid(f.fillingFontWeightField)?{field:f.fillingFontWeightField}:d.fontWeight})}getStatisticFields(){const e=[];return e.push({key:this._nameField,operations:["values"]}),e.push({key:this._valueField,operations:["max","min"]}),e}dataToPosition(e){return null}dataToPositionX(e){return null}dataToPositionY(e){return null}dataToPositionZ(e){return null}valueToPosition(e,i){return null}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}onLayoutEnd(e){super.onLayoutEnd(e),this.compile(),this._dataChange=!1}getActiveMarks(){return[this._wordMark]}reInit(){super.reInit(),this._keyWordColorCallback&&(this._keyWordColorCallback=null),this._fillingColorCallback&&(this._fillingColorCallback=null)}}BaseWordCloudSeries.mark=wordCloudSeriesMark;const WordCloud3dAnimation=r=>({custom:RotateBySphereAnimate,customParameters:(e,i)=>r,easing:"linear",loop:1/0,duration:6e3});function computeWordDelay(r,e,i){return r*i<e?r+(e-i*r)/(i-1):(e-r)/(i-1)}const WordCloudScaleInAnimation=r=>({channel:{fontSize:{from:0}},duration:200,delay:(e,i,n)=>{const o=r.animationConfig(),l=(o==null?void 0:o.duration)||200,u=(o==null?void 0:o.totalTime)||DEFAULT_ANIMATION_CONFIG.appear.duration,d=n.VGRAMMAR_ANIMATION_PARAMETERS.elementCount;return n.VGRAMMAR_ANIMATION_PARAMETERS.elementIndex*computeWordDelay(l,u,d)}});function wordcloudPresetAnimation(r,e){return e===!1?{}:e==="fadeIn"?{type:"fadeIn"}:WordCloudScaleInAnimation(r)}const registerWordCloudAnimation=()=>{Factory$1.registerAnimation("wordCloud",(r,e)=>({appear:wordcloudPresetAnimation(r,e),enter:{type:"fadeIn"},exit:{type:"fadeOut"},disappear:{type:"fadeOut"}}))},registerWordCloud3dAnimation=()=>{Factory$1.registerAnimation("wordCloud3d",r=>({enter:WordCloud3dAnimation(r)}))},randomHslColor=(r,e)=>"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-r)+r).toFixed()+"%)";function functor$1(r){return isFunction(r)?r:function(){return r}}class BaseLayout{constructor(e){var i,n;switch(this.options=merge$1({},BaseLayout.defaultOptions,e),isFunction(this.options.shape)?this.shape=this.options.shape:this.shape=getShapeFunction(this.options.shape),this.getText=(i=functor$1(this.options.text))!==null&&i!==void 0?i:o=>o,this.getTextFontWeight=functor$1(this.options.fontWeight),this.getTextFontSize=functor$1(this.options.fontSize),this.getTextFontStyle=functor$1(this.options.fontStyle),this.getTextFontFamily=functor$1(this.options.fontFamily),this.outputCallback=(n=this.options.outputCallback)!==null&&n!==void 0?n:o=>o,this.options.color){case"random-dark":this.getTextColor=()=>randomHslColor(10,50);break;case"random-light":this.getTextColor=()=>randomHslColor(50,90);break;default:this.getTextColor=functor$1(this.options.color)}if(isNil(this.options.rotate))if(this.options.useRandomRotate){const o=Math.abs(this.options.maxRotation-this.options.minRotation),l=Math.abs(Math.floor(this.options.rotationSteps)),u=Math.min(this.options.maxRotation,this.options.minRotation);this.getTextRotate=()=>this.options.rotateRatio===0||Math.random()>this.options.rotateRatio?0:o===0?u:l>0?u+Math.floor(Math.random()*l)*o/(l-1):u+Math.random()*o}else this.getTextRotate=()=>0;else this.getTextRotate=isFunction(this.options.rotate)?o=>{var l;return degreeToRadian((l=this.options.rotate(o))!==null&&l!==void 0?l:0)}:(o,l)=>{const u=array(this.options.rotate),d=this.options.random?Math.random():seedRandom(l);return degreeToRadian(u[Math.floor(d*u.length)])}}canRepeat(){return!1}exceedTime(){var e;return this.options.progressiveStep>0?this.progressiveIndex>=(((e=this.currentStepIndex)!==null&&e!==void 0?e:-1)+1)*this.options.progressiveStep:this.options.progressiveTime>0&&new Date().getTime()-this.escapeTime>this.options.progressiveTime}progressiveRun(){var e;if(this.options.progressiveStep>0?this.currentStepIndex=((e=this.currentStepIndex)!==null&&e!==void 0?e:-1)+1:this.options.progressiveTime>0&&(this.escapeTime=Date.now()),this.data&&this.progressiveIndex<this.data.length){this.progressiveResult=[];let i=this.progressiveIndex,n=0;const o=this.options.maxSingleWordTryCount,l=Math.min(this.options.maxFailCount,this.originalData.length);for(;i<this.data.length&&this.failCount<l;){const u=this.layoutWord(i);if(n++,(u||n>o)&&(i++,n=0,this.failCount=u?0:this.failCount+1),this.progressiveIndex=i,this.exceedTime())break;i===this.data.length&&this.failCount<l&&this.options.repeatFill&&this.canRepeat()&&(this.data=[...this.data,...this.originalData.map(d=>Object.assign(Object.assign({},d),{isFill:!0}))],this.isTryRepeatFill=!0)}return this.progressiveResult}return this.result}initProgressive(){this.failCount=0,this.progressiveIndex=0,this.options.progressiveStep>0?this.currentStepIndex=-1:this.options.progressiveTime>0&&(this.escapeTime=Date.now()),this.progressiveResult=[]}output(){return this.result?this.outputCallback(this.result):null}progressiveOutput(){return this.progressiveResult?this.outputCallback(this.progressiveResult):null}unfinished(){return this.data&&this.data.length&&!isNil(this.progressiveIndex)&&this.progressiveIndex<this.data.length}release(){this.data=null,this.result=null,this.progressiveIndex=null,this.progressiveResult=null}}BaseLayout.defaultOptions={fontFamily:'"Trebuchet MS", "Heiti TC", "", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",fontStyle:"normal",minFontSize:12,drawOutOfBound:!1,shrink:!1,minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,rotateRatio:.1,random:!1,shape:"circle",progressiveTime:0,progressiveStep:0,repeatFill:!1,fillTextFontSize:12,maxFailCount:20};const spirals={archimedean:archimedeanSpiral$1,rectangular:rectangularSpiral};function archimedeanSpiral$1(r){const e=r[0]/r[1];return i=>[e*(i*=.1)*Math.cos(i),i*Math.sin(i)]}function rectangularSpiral(r){const e=4*r[0]/r[1];let i=0,n=0;return o=>{const l=o<0?-1:1;switch(Math.sqrt(1+4*l*o)-l&3){case 0:i+=e;break;case 1:n+=4;break;case 2:i-=e;break;default:n-=4}return[i,n]}}class CloudLayout extends BaseLayout{constructor(e){var i;super(merge$1({},CloudLayout.defaultOptions,e)),this.cw=64,this.ch=2048,this._size=[256,256],this._isBoardExpandCompleted=!1,this._placeStatus=0,this._tTemp=null,this._dtTemp=null,this._dy=0,this.cacheMap=new Map,this.options.minFontSize<=CloudLayout.defaultOptions.minFontSize&&(this.options.minFontSize=CloudLayout.defaultOptions.minFontSize),this.spiral=isString(this.options.spiral)?(i=spirals[this.options.spiral])!==null&&i!==void 0?i:spirals.archimedean:this.options.spiral,this.random=this.options.random?Math.random:()=>1,this.getTextPadding=functor$1(this.options.padding)}zoomRatio(){return this._originSize[0]/this._size[0]}dy(){return this._dy}layoutWord(e){const i=this.data[e];if((""+i.text).trim()==="")return!0;const{maxRadius:n,center:o}=getMaxRadiusAndCenter(this.options.shape,this._size);if(i.x=o[0],i.y=o[1],cloudSprite(this.contextAndRatio,i,this.data,e,this.cw,this.ch),this._placeStatus=0,i.hasText&&this.place(this._board,i,this._bounds,n))return this.result.push(i),this._bounds?cloudBounds(this._bounds,i):this._bounds=[{x:i.x+i.x0,y:i.y+i.y0},{x:i.x+i.x1,y:i.y+i.y1}],i.x-=this._size[0]>>1,i.y-=this._size[1]>>1,this._tTemp=null,this._dtTemp=null,!0;if(this.updateBoardExpandStatus(i.fontSize),i.hasText&&this.shouldShrinkContinue()){if(this._placeStatus===1){const l=i.fontSize*this._originSize[0]/this.options.minFontSize,u=Math.max(i.width,i.height);if(u<=l)this.expandBoard(this._board,this._bounds,u/this._size[0]);else{if(!this.options.clip)return!0;this.expandBoard(this._board,this._bounds,l/this._size[0])}}else this._placeStatus,this.expandBoard(this._board,this._bounds);return this.updateBoardExpandStatus(i.fontSize),!1}return this._tTemp=null,this._dtTemp=null,!0}layout(e,i){this.initProgressive(),this.result=[],this._size=[i.width,i.height],this.clearCache(),this._originSize=[...this._size];const n=this.getContext(vglobal.createCanvas({width:1,height:1}));this.contextAndRatio=n,this._board=new Array((this._size[0]>>5)*this._size[1]).fill(0),this._bounds=null,e.length,this.result=[];const o=e.map((l,u)=>({text:this.getText(l),fontFamily:this.getTextFontFamily(l),fontStyle:this.getTextFontStyle(l),fontWeight:this.getTextFontWeight(l),angle:this.getTextRotate(l,u),fontSize:~~this.getTextFontSize(l),padding:this.getTextPadding(l),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:l,x:0,y:0,width:0,height:0})).sort(function(l,u){return u.fontSize-l.fontSize});if(this.originalData=o,this.data=o,this.progressiveRun(),!this.options.clip&&this.options.enlarge&&this._bounds&&this.shrinkBoard(this._bounds),this._bounds&&["cardioid","triangle","triangle-upright"].includes(this.options.shape)){const l=(this._bounds[0].y+this._bounds[1].y)/2;this._dy=-(l-this._originSize[1]/2)}return this.result}formatTagItem(e){const i=this._size,n=this.zoomRatio(),o=this.dy(),l=i[0]>>1,u=i[1]>>1,d=e.length,f=[];let g,_;for(let y=0;y<d;++y)g=e[y],_={},_.datum=g.datum,_.x=(g.x+l)*n,_.y=(g.y+u+o)*n,_.fontFamily=g.fontFamily,_.fontSize=g.fontSize*n,_.fontStyle=g.fontStyle,_.fontWeight=g.fontWeight,_.angle=g.angle,f.push(_);return f}output(){return this.outputCallback?this.outputCallback(this.formatTagItem(this.result)):this.formatTagItem(this.result)}progressiveOutput(){return this.outputCallback?this.outputCallback(this.formatTagItem(this.progressiveResult)):this.formatTagItem(this.progressiveResult)}updateBoardExpandStatus(e){this._isBoardExpandCompleted=e*(this._originSize[0]/this._size[0])<this.options.minFontSize}shouldShrinkContinue(){return!this.options.clip&&this.options.shrink&&!this._isBoardExpandCompleted}shrinkBoard(e){const i=e[0],n=e[1];if(n.x>=this._size[0]||n.y>=this._size[1])return;const o=Math.min(i.x,this._size[0]-n.x),l=Math.min(i.y,this._size[1]-n.y),u=2*Math.min(o/this._size[0],l/this._size[1]);this._size=this._size.map(d=>d*(1-u))}expandBoard(e,i,n){const o=this._size[0]*(n||1.1)-this._size[0]>>5;let l=2*o>2?o:2;l%2!=0&&l++;let u=Math.ceil(this._size[1]*(l<<5)/this._size[0]);u%2!=0&&u++;const d=this._size[0],f=this._size[1],g=new Array(l).fill(0),_=new Array(u/2*(l+(d>>5))).fill(0);this.insertZerosToArray(e,f*(d>>5),_.length+l/2);for(let y=f-1;y>0;y--)this.insertZerosToArray(e,y*(d>>5),g.length);this.insertZerosToArray(e,0,_.length+l/2),this._size=[d+(l<<5),f+u],i&&(i[0].x+=(l<<5)/2,i[0].y+=u/2,i[1].x+=(l<<5)/2,i[1].y+=u/2)}insertZerosToArray(e,i,n){if(this.options.customInsertZerosToArray)return this.options.customInsertZerosToArray(e,i,n);const o=Math.floor(n/6e4),l=n%6e4;for(let u=0;u<o;u++)e.splice(i+6e4*u,0,...new Array(6e4).fill(0));e.splice(i+6e4*o,0,...new Array(l).fill(0))}getContext(e){e.width=1,e.height=1;const i=e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1),n=Math.sqrt(i.data.length>>2);e.width=(this.cw<<5)/n,e.height=this.ch/n;const o=e.getContext("2d",{willReadFrequently:!0});return o.fillStyle=o.strokeStyle="red",o.textAlign="center",{context:o,ratio:n,canvas:e}}place(e,i,n,o){let l=!1;if(this.shouldShrinkContinue()&&(i.width>this._size[0]||i.height>this._size[1]))return this._placeStatus=1,!1;const u=this.random()<.5?1:-1;if(!this.shouldShrinkContinue()&&this.isSizeLargerThanMax(i,u))return null;const d=i.x,f=i.y,g=Math.sqrt(this._size[0]*this._size[0]+this._size[1]*this._size[1]),_=this.spiral(this._size);let y,b,S,v,A=-u;for(this._tTemp=null,this._dtTemp=null;y=_(A+=u);){b=y[0],S=y[1];const x=Math.sqrt(b**2+S**2);let T=Math.atan(S/b);b<0?T+=Math.PI:S<0&&(T=2*Math.PI+T);const C=this.shape(T);if(Math.min(Math.abs(b),Math.abs(S))>=g)break;if(x>=o)l&&this._tTemp===null&&(this._tTemp=A,this._dtTemp=u);else{if(i.x=d+~~(x*C*Math.cos(-T)),i.y=f+~~(x*C*Math.sin(-T)),v=i,this.options.clip)if(this.shouldShrinkContinue()){if(isPartOutside(v,this._size)){l&&this._tTemp===null&&(this._tTemp=A,this._dtTemp=u);continue}}else{if(isFullOutside(v,this._size)){l&&this._tTemp===null&&(this._tTemp=A,this._dtTemp=u);continue}isPartOutside(v,this._size)&&(v=clipInnerTag(v,this._size))}else if(isPartOutside(v,this._size)){l&&this._tTemp===null&&(this._tTemp=A,this._dtTemp=u);continue}if(l=!0,(!n||collideRects(v,n))&&(!n||!cloudCollide(v,e,this._size))){const E=v.sprite,P=v.width>>5,L=this._size[0]>>5,R=v.x-(P<<4),w=127&R,D=32-w,I=v.y1-v.y0;let O,B=(v.y+v.y0)*L+(R>>5);for(let N=0;N<I;N++){O=0;for(let $=0;$<=P;$++)e[B+$]|=O<<D|($<P?(O=E[N*P+$])>>>w:0);B+=L}return i.sprite=null,v.sprite=null,!0}}}return this._tTemp!==null&&(this._placeStatus=3),!this.shouldShrinkContinue()&&this.setCache(v,u),!1}clearCache(){this.cacheMap.clear()}setCache(e,i){const n=`${e.angle}-${i}`,o=e.x1-e.x0,l=e.y1-e.y0;if(!this.cacheMap.has(n))return void this.cacheMap.set(n,{width:o,height:l});const{width:u,height:d}=this.cacheMap.get(n);(o<u&&l<d||o<=u&&l<d)&&this.cacheMap.set(n,{width:o,height:l})}isSizeLargerThanMax(e,i){const n=`${e.angle}-${i}`;if(!this.cacheMap.has(n))return!1;const{width:o,height:l}=this.cacheMap.get(n),u=e.x1-e.x0,d=e.y1-e.y0;return u>=o&&d>=l}}function cloudSprite(r,e,i,n,o,l){if(e.sprite)return;const u=r.context,d=r.ratio;u.setTransform(d,0,0,d,0,0),u.clearRect(0,0,(o<<5)/d,l/d);let f=0,g=0,_=0;const y=i.length;let b,S,v,A,x;for(--n;++n<y;){if(e=i[n],u.save(),u.font=e.fontStyle+" "+e.fontWeight+" "+~~((e.fontSize+1)/d)+"px "+e.fontFamily,b=u.measureText(e.text+"m").width*d,v=e.fontSize<<1,e.angle){const E=Math.sin(e.angle),P=Math.cos(e.angle),L=b*P,R=b*E,w=v*P,D=v*E;b=Math.max(Math.abs(L+D),Math.abs(L-D))+31>>5<<5,v=~~Math.max(Math.abs(R+w),Math.abs(R-w))}else b=b+31>>5<<5;if(v>_&&(_=v),f+b>=o<<5&&(f=0,g+=_,_=0),g+v>=l)break;u.translate((f+(b>>1))/d,(g+(v>>1))/d),e.angle&&u.rotate(e.angle),u.fillText(e.text,0,0),e.padding&&(u.lineWidth=2*e.padding,u.strokeText(e.text,0,0)),u.restore(),e.width=b,e.height=v,e.xoff=f,e.yoff=g,e.x1=b>>1,e.y1=v>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,f+=b}const T=u.getImageData(0,0,(o<<5)/d,l/d).data,C=[];for(;--n>=0;){if(!(e=i[n]).hasText)continue;for(b=e.width,S=b>>5,v=e.y1-e.y0,A=0;A<v*S;A++)C[A]=0;if(f=e.xoff,f==null)return;g=e.yoff;let E=0,P=-1;for(x=0;x<v;x++){for(A=0;A<b;A++){const L=S*x+(A>>5),R=T[(g+x)*(o<<5)+(f+A)<<2]?1<<31-A%32:0;C[L]|=R,E|=R}E?P=x:(e.y0++,v--,x--,g++)}e.y1=e.y0+P,e.sprite=C.slice(0,(e.y1-e.y0)*S)}}function cloudCollide(r,e,i){const n=i[0]>>5,o=r.sprite,l=r.width>>5,u=r.x-(l<<4),d=127&u,f=32-d,g=r.y1-r.y0;let _,y=(r.y+r.y0)*n+(u>>5);for(let b=0;b<g;b++){_=0;for(let S=0;S<=l;S++)if((_<<f|(S<l?(_=o[b*l+S])>>>d:0))&e[y+S])return!0;y+=n}return!1}function cloudBounds(r,e){const i=r[0],n=r[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0),e.y+e.y0<i.y&&(i.y=e.y+e.y0),e.x+e.x1>n.x&&(n.x=e.x+e.x1),e.y+e.y1>n.y&&(n.y=e.y+e.y1)}function collideRects(r,e){return r.x+r.x1>e[0].x&&r.x+r.x0<e[1].x&&r.y+r.y1>e[0].y&&r.y+r.y0<e[1].y}CloudLayout.defaultOptions={enlarge:!1,minFontSize:2,maxSingleWordTryCount:2};const isFullOutside=(r,e)=>r.x+r.x0>e[0]||r.y+r.y0>e[0]||r.x+r.x1<0||r.y+r.y1<0,isPartOutside=(r,e)=>r.x+r.x0<0||r.y+r.y0<0||r.x+r.x1>e[0]||r.y+r.y1>e[1];function clipInnerTag(r,e){const i=r.sprite,n=r.y1-r.y0,o=r.width>>5;let l=0;const u=[],d=Math.max(-(r.y0+r.y),0),f=Math.min(n+(e[1]-(r.y1+r.y)),n),g=Math.max(-(r.x0+r.x),0)>>5,_=Math.min(o+(e[0]-(r.x1+r.x)>>5)+1,o);for(let A=0;A<n;A++){for(let x=0;x<o;x++)A<d||f<=A||x<g||_<=x||u.push(i[l+x]);l+=o}const y=g<<5,b=o-_<<5,S=d,v=n-f;return Object.assign(Object.assign({},r),{width:r.width-y-b,height:r.height-S-v,x0:r.x0+y,x1:r.x1-b,y0:r.y0+S,y1:r.y1-v,x:r.x+y/2-b/2,sprite:u})}let GridLayout$1=class ze extends BaseLayout{constructor(e){super(merge$1({},ze.defaultOptions,e)),this.fillGridAt=(i,n)=>{i>=this.ngx||n>=this.ngy||i<0||n<0||(this.grid[i][n]=!1)},this.updateGrid=(i,n,o,l,u)=>{const d=u.occupied;let f=d.length;for(;f--;){const g=i+d[f][0],_=n+d[f][1];g>=this.ngx||_>=this.ngy||g<0||_<0||this.fillGridAt(g,_)}},this.gridSize=Math.max(Math.floor(this.options.gridSize),4)}getPointsAtRadius(e){if(this.pointsAtRadius[e])return this.pointsAtRadius[e];const i=8*e;let n=i;const o=[];for(e===0&&o.push([this.center[0],this.center[1],0]);n--;){const l=this.shape(n/i*2*Math.PI);o.push([this.center[0]+e*l*Math.cos(-n/i*2*Math.PI),this.center[1]+e*l*Math.sin(-n/i*2*Math.PI)*this.options.ellipticity,n/i*2*Math.PI])}return this.pointsAtRadius[e]=o,o}getTextInfo(e,i=1,n){var o;const l=this.options.clip?1:i,u=Math.max(Math.floor((this.isTryRepeatFill?this.options.fillTextFontSize:this.getTextFontSize(e))*l),this.options.minFontSize);let d=this.getText(e)+"";if(this.options.clip&&(d=d.slice(0,Math.ceil(d.length*i))),!d)return null;const f=this.getTextFontWeight(e),g=this.getTextFontStyle(e),_=this.getTextRotate&&(o=this.getTextRotate(e,n))!==null&&o!==void 0?o:0,y=this.getTextFontFamily(e),b=document.createElement("canvas"),S=b.getContext("2d",{willReadFrequently:!0});S.font=g+" "+f+" "+u.toString(10)+"px "+y;const v=S.measureText(d).width,A=Math.max(u,S.measureText("m").width,S.measureText("").width);let x=v+2*A,T=3*A;const C=Math.ceil(x/this.gridSize),E=Math.ceil(T/this.gridSize);x=C*this.gridSize,T=E*this.gridSize;const P=-v/2,L=.4*-A,R=Math.ceil((x*Math.abs(Math.sin(_))+T*Math.abs(Math.cos(_)))/this.gridSize),w=Math.ceil((x*Math.abs(Math.cos(_))+T*Math.abs(Math.sin(_)))/this.gridSize),D=w*this.gridSize,I=R*this.gridSize;b.setAttribute("width",""+D),b.setAttribute("height",""+I),S.scale(1,1),S.translate(D/2,I/2),S.rotate(-_),S.font=g+" "+f+" "+u.toString(10)+"px "+y,S.fillStyle="#000",S.textBaseline="middle",S.fillText(d,P,L);const O=S.getImageData(0,0,D,I).data;if(this.exceedTime())return null;const B=[];let N,$=w;const H=[R/2,w/2,R/2,w/2],F=(V,G,Y)=>{let J=this.gridSize;for(;J--;){let q=this.gridSize;for(;q--;)if(O[4*((G*this.gridSize+J)*D+(V*this.gridSize+q))+3])return Y.push([V,G]),V<H[3]&&(H[3]=V),V>H[1]&&(H[1]=V),G<H[0]&&(H[0]=G),void(G>H[2]&&(H[2]=G))}};for(;$--;)for(N=R;N--;)F($,N,B);return{datum:e,occupied:B,bounds:H,gw:w,gh:R,fillTextOffsetX:P,fillTextOffsetY:L,fillTextWidth:v,fillTextHeight:A,fontSize:u,fontStyle:g,fontWeight:f,fontFamily:y,angle:_,text:d}}calculateEmptyRate(){const e=this.ngx*this.ngy;let i=0;for(let n=0;n<this.ngx;n++)for(let o=0;o<this.ngy;o++)this.grid[n][o]&&i++;return i/e}canFitText(e,i,n,o,l){let u=l.length;for(;u--;){const d=e+l[u][0],f=i+l[u][1];if(d>=this.ngx||f>=this.ngy||d<0||f<0){if(!this.options.drawOutOfBound)return!1}else if(!this.grid[d][f])return!1}return!0}layoutWord(e,i=1){const n=this.data[e],o=this.getTextInfo(n,i,e);if(!o||this.exceedTime())return!1;if(!this.options.drawOutOfBound&&(!this.options.shrink||o.fontSize<=this.options.minFontSize)&&!this.options.clip){const d=o.bounds;if(d[1]-d[3]+1>this.ngx||d[2]-d[0]+1>this.ngy)return!1}let l=this.maxRadius+1;const u=d=>{const f=Math.floor(d[0]-o.gw/2),g=Math.floor(d[1]-o.gh/2),_=o.gw,y=o.gh;return!!this.canFitText(f,g,_,y,o.occupied)&&(o.distance=this.maxRadius-l,o.theta=d[2],this.outputText(f,g,o),this.updateGrid(f,g,_,y,o),!0)};for(;l--;){let d=this.getPointsAtRadius(this.maxRadius-l);if(this.options.random&&(d=[].concat(d),shuffleArray(d)),d.some(u))return!0}return(this.options.clip||!!(this.options.shrink&&o.fontSize>this.options.minFontSize))&&this.layoutWord(e,.75*i)}outputText(e,i,n){const o=this.getTextColor(n),l={text:n.text,datum:n.datum,color:o,fontStyle:n.fontStyle,fontWeight:n.fontWeight,fontFamily:n.fontFamily,angle:n.angle,width:n.fillTextWidth,height:n.fillTextHeight,x:(e+n.gw/2)*this.gridSize,y:(i+n.gh/2)*this.gridSize+n.fillTextOffsetY+.5*n.fontSize,fontSize:n.fontSize};this.result.push(l),this.progressiveResult&&this.progressiveResult.push(l)}initGrid(e){this.grid=[];const i=this.options.shape;if(isObject$1(i)){const n=generateMaskCanvas(i,e.width,e.height);let o=n.getContext("2d").getImageData(0,0,this.ngx*this.gridSize,this.ngy*this.gridSize);this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(n);let l=generateIsEmptyPixel(i.backgroundColor);const u=(f,g)=>{let _=this.gridSize;for(;_--;){let y=this.gridSize;for(;y--;)if(!l(o,g*this.gridSize+_,f*this.gridSize+y))return void(this.grid[f][g]=!0)}this.grid[f][g]=!1};let d=this.ngx;for(;d--;){this.grid[d]=[];let f=this.ngy;for(;f--;)u(d,f),this.grid[d][f]!==!1&&(this.grid[d][f]=!0)}o=l=void 0}else{let n=this.ngx;for(;n--;){this.grid[n]=[];let o=this.ngy;for(;o--;)this.grid[n][o]=!0}}}canRepeat(){return this.calculateEmptyRate()>.001}layout(e,i){this.initProgressive(),this.drawnCount=0,this.isTryRepeatFill=!1,this.originalData=e,this.data=e,this.pointsAtRadius=[],this.ngx=Math.floor(i.width/this.gridSize),this.ngy=Math.floor(i.height/this.gridSize);const{center:n,maxRadius:o}=getMaxRadiusAndCenter(this.options.shape,[i.width,i.height]);return this.center=i.origin?[i.origin[0]/this.gridSize,i.origin[1]/this.gridSize]:[n[0]/this.gridSize,n[1]/this.gridSize],this.maxRadius=Math.floor(o/this.gridSize),this.initGrid(i),this.result=[],this.progressiveRun()}};GridLayout$1.defaultOptions={gridSize:8,ellipticity:1,maxSingleWordTryCount:1};class FastLayout extends BaseLayout{constructor(e){super(merge$1({},FastLayout.defaultOptions,e)),this.random=this.options.random?Math.random:()=>0,this.aspectRatio=1}fit(e){for(let i=0,n=this.result.length;i<n;i++)if(isOverlap(e,this.result[i]))return!1;return!0}getTextInfo(e,i){const n={datum:e,fontSize:this.getTextFontSize(e),fontWeight:this.getTextFontWeight(e),fontStyle:this.getTextFontStyle(e),fontFamily:this.getTextFontFamily(e),angle:this.getTextRotate(e,i),text:this.getText(e)+"",x:this.center[0],y:this.center[1]},o=getTextBounds(n);return n.width=o.width(),n.height=o.height(),n.top=this.center[1]-n.height+.21*n.height,n.left=this.center[0]-n.width/2,n}layoutWord(e){const i=this.getTextInfo(this.data[e],e);let n=2*Math.PI,o=0,l=i.left,u=i.top;const d=i.width,f=i.height;let g=1,_=this.fit(i);for(;!_&&o<this.maxRadius;)o+=.5,g=this.shape(o/this.maxRadius*2*Math.PI),n+=.5*(this.options.random?this.random()>.5?1:-1:e%2==0?1:-1),l=this.center[0]-d/2+o*g*Math.cos(n)*this.aspectRatio,u=this.center[1]-f/2+o*g*Math.sin(n),i.left=l,i.top=u,i.x=l+d/2,i.y=u+f/2,_=this.fit(i);return!!_&&!!(this.options.clip||i.left>=0&&i.left+i.width<=this.width&&i.top>=0&&i.top+i.height<=this.height)&&(this.result.push(i),!0)}layout(e,i){if(!(e!=null&&e.length))return[];this.initProgressive(),this.result=[],this.maxRadius=Math.sqrt(i.width*i.width+i.height*i.height)/2,this.center=[i.width/2,i.height/2],this.width=i.width,this.height=i.height,this.data=e.sort((o,l)=>this.getTextFontSize(l)-this.getTextFontSize(o));let n=0;for(;n<e.length&&(this.layoutWord(n),n++,this.progressiveIndex=n,!this.exceedTime()););return this.result}}function isOverlap(r,e){return!(r.left+r.width<e.left||r.top+r.height<e.top||r.left>e.left+e.width||r.top>e.top+e.height)}FastLayout.defaultOptions={enlarge:!1};const OUTPUT$1={x:"x",y:"y",z:"z",fontFamily:"fontFamily",fontSize:"fontSize",fontStyle:"fontStyle",fontWeight:"fontWeight",angle:"angle"},transform$3=(r,e)=>{var i,n,o,l,u,d;if(r.size&&(r.size[0]<=0||r.size[1]<=0))return Logger.getInstance().info("Wordcloud size dimensions must be greater than 0"),[];const f=e,g=((i=r.size)!==null&&i!==void 0?i:[500,500]).slice();g[0]=Math.floor(g[0]),g[1]=Math.floor(g[1]);const _=r.fontFamily?field$1(r.fontFamily):"sans-serif",y=r.fontStyle?field$1(r.fontStyle):"normal",b=r.fontWeight?field$1(r.fontWeight):"normal",S=r.rotate?field$1(r.rotate):0,v=field$1(r.text),A=(n=r.spiral)!==null&&n!==void 0?n:"archimedean",x=r.padding?field$1(r.padding):1,T=(o=r.shape)!==null&&o!==void 0?o:"square",C=(l=r.shrink)!==null&&l!==void 0&&l,E=(u=r.enlarge)!==null&&u!==void 0&&u,P=(d=r.clip)!==null&&d!==void 0&&d,L=r.minFontSize,R=r.randomVisible,w=r.as?Object.assign(Object.assign({},OUTPUT$1),r.as):OUTPUT$1,D=r.depth_3d,I=r.postProjection;let O=r.fontSize?field$1(r.fontSize):14;const B=r.fontSizeRange;if(B&&!isNumber(O)){const H=O,F=generateScale(extent$1(H,f),B);O=V=>F(H(V))}let N=CloudLayout;r.layoutType==="fast"?N=FastLayout:r.layoutType==="grid"&&(N=GridLayout$1);const $=new N(Object.assign(Object.assign({},r),{text:v,padding:x,spiral:A,shape:T,rotate:S,fontFamily:_,fontStyle:y,fontWeight:b,fontSize:O,shrink:C,clip:P,enlarge:E,minFontSize:L,random:R,outputCallback:H=>{const F=[];let V,G;for(let Y=0,J=H.length;Y<J;Y++)G=H[Y],V=G.datum,V[w.x]=G.x,V[w.y]=G.y,V[w.fontFamily]=G.fontFamily,V[w.fontSize]=G.fontSize,V[w.fontStyle]=G.fontStyle,V[w.fontWeight]=G.fontWeight,V[w.angle]=G.angle,I==="StereographicProjection"&&stereographicProjection(g,G,V,w,D),r.dataIndexKey&&(V[r.dataIndexKey]=`${Y}`),F.push(V);return F}}));return $.layout(f,{width:g[0],height:g[1]}),r.progressiveStep>0||r.progressiveTime>0?{progressive:$}:$.output()},field$1=r=>isString(r)||isNumber(r)||isFunction(r)||isArray(r)?r:e=>e[r.field],sqrt=r=>r<0?-Math.sqrt(-r):Math.sqrt(r),generateScale=(r,e,i)=>{if(r[0]===r[1])return d=>e[0];const n=sqrt(r[0]),o=sqrt(r[1]),l=Math.min(n,o),u=Math.max(n,o);return d=>(sqrt(d)-l)/(u-l)*(e[1]-e[0])+e[0]},extent$1=(r,e)=>{let i=1/0,n=-1/0;const o=e.length;let l;for(let u=0;u<o;++u)l=toNumber(r(e[u])),l<i&&(i=l),l>n&&(n=l);return e.length===1&&i===n&&(i-=1e4),[i,n]};function stereographicProjection(r,e,i,n,o){const l=Math.max(r[0],r[1])/2,u=_StereographicProjection(r[0],r[1],l,{x:l,y:l,z:o??l},e);i[n.x]=u.x,i[n.y]=u.y,i[n.z]=u.z}function _StereographicProjection(r,e,i,n,o){const{x:l,y:u}=o,d=l/r*Math.PI*2;let f=Math.PI-u/e*Math.PI;return f+=(f<Math.PI/2?1:-1)*Math.pow(Math.min(f-Math.PI/2,1),2)/5,{x:i*Math.sin(f)*Math.cos(d)+n.x,y:i*Math.cos(f)+n.y,z:i*Math.sin(f)*Math.sin(d)+n.z}}const registerWordCloudTransforms=()=>{Factory.registerTransform("wordcloud",{transform:transform$3,markPhase:"beforeJoin"},!0)};var WORDCLOUD_SHAPE_HOOK_EVENT;(function(r){r.BEFORE_WORDCLOUD_SHAPE_LAYOUT="beforeWordcloudShapeLayout",r.AFTER_WORDCLOUD_SHAPE_LAYOUT="afterWordcloudShapeLayout",r.AFTER_WORDCLOUD_SHAPE_DRAW="afterWordcloudShapeDraw"})(WORDCLOUD_SHAPE_HOOK_EVENT||(WORDCLOUD_SHAPE_HOOK_EVENT={}));const colorListEqual=(r,e)=>{if(e.length===1&&e[0]==="#537EF5")return!0;if(!Array.isArray(r)||!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i]!==e[i])return!1;return!0},fakeRandom=()=>{let r=-1;const e=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9];return()=>(r=(r+1)%e.length,e[r])},isChinese=r=>/^[\u4e00-\u9fa5]+$/.test(r),calTextLength=(r,e)=>{if(isNil(r))return 0;let i=0;for(const n of r)isChinese(n)?i+=1:i+=.53;return i};function loadImage(r){return r&&(isValidUrl(r)||isBase64(r)||r.startsWith("<svg"))?new Promise((e,i)=>{var n;const o=createImage({image:r}),l=(n=o.resources)===null||n===void 0?void 0:n.get(r);l&&l.state==="success"&&l.data?e(l.data):(o.successCallback=()=>{var u;if(o){const d=(u=o.resources)===null||u===void 0?void 0:u.get(r);d&&d.state==="success"&&d.data?e(d.data):i(new Error("image load failed"+r))}else i(new Error("image load failed"+r))},o.failCallback=()=>{Logger.getInstance().error("image ",r)})}):null}function functor(r){return typeof r=="function"?r:function(){return r}}function segmentation(r){const{size:e,maskCanvas:i}=r,n=i.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,i.width,i.height),o=new Array(e[0]*e[1]).fill(0);let l=1;const u=[[0,1],[1,0],[-1,0],[0,-1]];let d=[];for(let D=0;D<e[1];D++)for(let I=0;I<e[0];I++)if(o[D*e[0]+I]===0&&!r.isEmptyPixel(n,D,I)){o[D*e[0]+I]=l,d.push([D,I]);for(let O=0;O<d.length;O++)for(let B=0;B<4;B++){let N=d[O][0]+u[B][0],$=d[O][1]+u[B][1];N=N<0?0:N>=e[1]?e[1]-1:N,$=$<0?0:$>=e[0]?e[0]-1:$,o[N*e[0]+$]!==0||r.isEmptyPixel(n,N,$)||(o[N*e[0]+$]=l,d.push([N,$]))}l++,d=[]}const f={},g={},_={},y={},b={},S={},v={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0,width:0,height:0};for(let D=0;D<e[1];D++)for(let I=0;I<e[0];I++){const O=o[D*e[0]+I];O!==0&&(w(D,I)&&(f[O]=f[O]||[],f[O].push([I,D]),y[O]||(y[O]=[1/0,-1/0,1/0,-1/0]),D<y[O][0]&&(y[O][0]=D),D>y[O][1]&&(y[O][1]=D),I<y[O][2]&&(y[O][2]=I),I>y[O][3]&&(y[O][3]=I),I<v.x1&&(v.x1=I),I>v.x2&&(v.x2=I),D<v.y1&&(v.y1=D),D>v.y2&&(v.y2=D)),g[O]=g[O]||0,g[O]++)}const A=[];for(const D in f){const I=f[D],O=~~(I.reduce((V,G)=>V+G[0],0)/I.length),B=~~(I.reduce((V,G)=>V+G[1],0)/I.length);_[D]=[O,B],A.push(...I);const[N,$,H,F]=y[D];b[D]=~~Math.max(Math.sqrt((O-H)**2+(B-N)**2),Math.sqrt((O-F)**2+(B-$)**2),Math.sqrt((O-H)**2+(B-$)**2),Math.sqrt((O-F)**2+(B-N)**2)),S[D]=(F-H)/($-N)}const x=Object.keys(_).map(D=>({label:D-1,boundary:f[D],area:g[D],center:_[D],maxPoint:y[D],maxR:b[D],ratio:S[D]}));v.width=v.x2-v.x1+1,v.height=v.y2-v.y1+1;const T=~~(A.reduce((D,I)=>D+I[0],0)/A.length),C=~~(A.reduce((D,I)=>D+I[1],0)/A.length),E=~~Math.max(Math.sqrt((T-v.x1)**2+(C-v.y1)**2),Math.sqrt((T-v.x2)**2+(C-v.y2)**2),Math.sqrt((T-v.x1)**2+(C-v.y2)**2),Math.sqrt((T-v.x2)**2+(C-v.y1)**2)),P=v.width/v.height,L=Object.keys(g).reduce((D,I)=>D+g[I],0),R={regions:x,labels:o,labelNumber:l-1};return Object.assign(r,{segmentation:R,shapeBounds:v,shapeMaxR:E,shapeRatio:P,shapeCenter:[T,C],shapeArea:L});function w(D,I){const O=[[0,1],[1,0],[-1,0],[0,-1]];if(D===0||I===0||D===e[1]-1||I===e[0]-1)return!0;for(let B=0;B<4;B++){let N=D+O[B][0],$=I+O[B][1];if(N=N<0?0:N>=e[1]?e[1]-1:N,$=$<0?0:$>=e[0]?e[0]-1:$,o[N*e[0]+$]===0)return!0}return!1}}function removeBorder(r,e,i){e.width=r.width,e.height=r.height;const n=e.getContext("2d",{willReadFrequently:!0});n.clearRect(0,0,e.width,e.height),n.drawImage(r,0,0);const o=e.width,l=n.getImageData(0,0,e.width,e.height);let u=0,d=l.height,f=0,g=l.width;const _=(S,v)=>{for(let A=0;A<S;++A)if(!i(l,v,A))return!1;return!0},y=(S,v,A)=>{for(let x=v;x<A;++x)if(!i(l,x,S))return!1;return!0};for(;u<d&&_(o,u);)++u;for(;d-1>u&&_(o,d-1);)--d;for(;f<g&&y(f,u,d);)++f;for(;g-1>f&&y(g-1,u,d);)--g;const b=n.getImageData(f,u,g-f,d-u);return e.width=b.width,e.height=b.height,n.clearRect(0,0,e.width,e.height),n.putImageData(b,0,0),e}function scaleAndMiddleShape(r,e){const i=r.width,n=r.height;let o=e[0]/i;n*o>e[1]&&(o=e[1]/n);const l=Math.floor(o*i),u=Math.floor(o*n);return{x:(e[0]-l)/2,y:(e[1]-u)/2,width:l,height:u,scale:o}}function allocateWords(r,e){const{segmentation:{regions:i}}=e;let n=-1/0,o=0,l=0;i.forEach((g,_)=>{const y=g.area;y>n&&(n=y,l=_),o+=y});let u=0;i.forEach(g=>{const _=g.area,y=Math.ceil(_/o*r.length),b=_/n;g.words=[],g.regionNum=y,g.regionWeight=b,u+=y}),u<r.length&&(i[l].wordsNum+=r.length-u);let d=l;const f=i.map(g=>g.regionNum);r.forEach(g=>{let _=0,y=0;g.regionIndex=-1;do{if(f[d]>0&&g.weight<=i[d].regionWeight){g.regionIndex=d,i[d].words.push(g),f[d]--,d=(d+1)%i.length;break}d=(d+1)%i.length,_++,y++,y>i.length+1&&(i.forEach(b=>{b.regionWeight+=.15}),y=0)}while(g.regionIndex===-1&&_<3*i.length);g.regionIndex===-1&&(g.regionIndex=l,i[l].words.push(g),f[l]--)}),i.forEach(g=>{g.words.sort((_,y)=>y.weight-_.weight)})}function layout(r,e,i){const{size:n,stepFactor:o}=e,{segmentation:{regions:l},tempCanvas:u,boardSize:d,shapeCenter:f,shapeMaxR:g,shapeRatio:_}=i,y=initBoardWithShape(i),b=u.getContext("2d",{willReadFrequently:!0});for(const S of l){const{words:v,center:A,maxR:x,ratio:T}=S;for(let C=0;C<v.length;C++){measureSprite(u,b,r,C);const E=v[C];E.x=A[0],E.y=A[1],E.hasText&&E.sprite&&place$1(y,E,x,T,n,d,o)&&(E.hasPlaced=!0)}}for(let S=0;S<e.textLayoutTimes;S++){const v=r.filter(A=>(A.hasPlaced||(A.hasText=!1,A.sprite=null,A.fontSize=Math.max(~~(A.fontSize*e.fontSizeShrinkFactor),e.minFontSize)),!A.hasPlaced));if(v.length===0)break;for(let A=0;A<v.length;A++){const x=v[A];measureSprite(u,b,v,A),x.x=f[0],x.y=f[1],x.hasText&&place$1(y,x,g,_,n,d,o)&&(x.hasPlaced=!0)}}e.board=y}function layoutGlobalShrink(r,e,i){const{stepFactor:n,importantWordCount:o,globalShinkLimit:l}=e,{size:u,segmentation:{regions:d},tempCanvas:f,boardSize:g,shapeCenter:_,shapeMaxR:y,shapeRatio:b}=i,S=f.getContext("2d",{willReadFrequently:!0}),v=initBoardWithShape(i);let A=v.slice(0);const x=e.fontSizeShrinkFactor;let T=null,C=1,E=1;const P=o;let L=0;r.length>P&&(L=r.sort((R,w)=>w.weight-R.weight)[P].weight);for(let R=0;R<d.length;R++){const w=d[R],{words:D,center:I,maxR:O,ratio:B}=w;let N=!1;for(let $=0;$<D.length;$++){measureSprite(f,S,r,$);const H=D[$];if(H.x=I[0],H.y=I[1],!H.skip&&H.hasText&&H.sprite&&place$1(A,H,O,B,u,g,n))H.hasPlaced=!0;else{if(!H.skip&&H.weight>L&&E>l){const F=H.datum[Symbol.for("vGrammar_id")];F!==T&&(T=F,C=E),E*=x,r.forEach(V=>{V.hasText=!1,V.sprite=null,V.fontSize=V.fontSize*x}),A=v.slice(0),N=!0;break}if(!H.skip&&H.datum[Symbol.for("vGrammar_id")]===T){r.forEach(F=>{F.hasText=!1,F.sprite=null,F.fontSize=F.fontSize/E}),H.skip=!0,E=C,T=null,A=v.slice(0),N=!0;break}}}N&&(R=-1)}for(let R=0;R<e.textLayoutTimes;R++){const w=r.filter(D=>(D.hasPlaced||(D.hasText=!1,D.sprite=null,D.fontSize=Math.max(~~(D.fontSize*e.fontSizeShrinkFactor),e.minFontSize)),!D.hasPlaced));if(w.length===0)break;for(let D=0;D<w.length;D++){const I=w[D];measureSprite(f,S,w,D),I.x=_[0],I.y=_[1],I.hasText&&place$1(A,I,y,b,u,g,n)&&(I.hasPlaced=!0)}}e.board=A}function layoutSelfEnlarge(r,e,i){const{size:n,stepFactor:o,importantWordCount:l}=e,{segmentation:{regions:u},tempCanvas:d,boardSize:f,shapeCenter:g,shapeMaxR:_,shapeRatio:y}=i,b=d.getContext("2d",{willReadFrequently:!0}),S=initBoardWithShape(i);let v=S.slice(0);const A=e.fontSizeEnlargeFactor,x=Math.min(l,r.length);let T=0;r.length>x&&(T=r.sort((L,R)=>R.weight-L.weight)[x-1].weight);let C=0,E=1,P=!1;for(let L=0;L<u.length;L++){const R=u[L],{words:w,center:D,maxR:I,ratio:O}=R;let B=!1;for(let N=0;N<w.length;N++){measureSprite(d,b,r,N);const $=w[N];if($.x=D[0],$.y=D[1],$.hasText&&$.sprite&&place$1(v,$,I,O,n,f,o)){if($.hasPlaced=!0,$.weight>=T&&C++,C>=x&&!P){E*=A,r.forEach(H=>{H.hasText=!1,H.sprite=null,H.fontSize=H.fontSize*A}),v=S.slice(0),B=!0,C=0;break}}else{if($.weight>=T&&E>1){r.forEach(H=>{H.hasText=!1,H.sprite=null,H.fontSize=H.fontSize/A}),E/=A,P=!0,v=S.slice(0),B=!0;break}if($.weight>=T)return layoutGlobalShrink(r,e,i)}}B&&(L=-1)}for(let L=0;L<e.textLayoutTimes;L++){const R=r.filter(w=>(w.hasPlaced||(w.hasText=!1,w.sprite=null,w.fontSize=Math.max(~~(w.fontSize*e.fontSizeShrinkFactor),e.minFontSize)),!w.hasPlaced));if(R.length===0)break;for(let w=0;w<R.length;w++){const D=R[w];measureSprite(d,b,R,w),D.x=g[0],D.y=g[1],D.hasText&&place$1(v,D,_,y,n,f,o)&&(D.hasPlaced=!0)}}e.board=v}function place$1(r,e,i,n,o,l,u){const d=e.x,f=e.y,g=archimedeanSpiral(n),_=1*u;let y,b,S,v=-_;for(;y=g(v+=_);){const{wordSize:A,bounds:{dTop:x,dBottom:T,dLeft:C,dRight:E}}=e;if(b=y[0],S=y[1],Math.min(Math.abs(b),Math.abs(S))>=i)break;if(e.x=~~(d+b),e.y=~~(f+S),!(e.x-C<0||e.x+E>o[0]||e.y-x<0||e.y+T>o[1]||isCollideWithBoard(e,r,l)))return placeWordOnBoard(e,r,l),!0}return!1}function placeWordOnBoard(r,e,i){const{wordSize:n}=r,o=r.sprite,l=n[0]>>5,u=i[0]>>5,d=r.x-(l<<4),f=d%32,g=32-f,_=n[1];let y,b=(r.y-(n[1]>>1))*u+(d>>5);if(f===0)for(let S=0;S<_;S++){for(let v=0;v<l;v++)e[b+v]|=o[S*l+v];b+=u}else for(let S=0;S<_;S++){y=0;for(let v=0;v<=l;v++)e[b+v]|=y<<g|(v<l?(y=o[S*l+v])>>>f:0);b+=u}}function isCollideWithBoard(r,e,i){const{sprite:n,wordSize:o}=r,l=i[0]>>5,u=o[0]>>5,d=r.x-(u<<4),f=d%32,g=32-f,_=o[1];let y,b=(r.y-(o[1]>>1))*l+(d>>5);if(f===0)for(let S=0;S<_;S++){for(let v=0;v<u;v++)if(e[b+v]&n[S*u+v])return!0;b+=l}else for(let S=0;S<_;S++){y=0;for(let v=0;v<=u;v++)if((y<<g|(v<u?(y=n[S*u+v])>>>f:0))&e[b+v])return!0;b+=l}return!1}function archimedeanSpiral(r){return function(e){return[r*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function measureSprite(r,e,i,n){if(i[n].sprite||i[n].fontSize===0)return;const o=2048,l=Math.PI/180,u=i.length;r.width=o,r.height=2048,e.clearRect(0,0,o,2048),e.textAlign="center";let d,f,g=0,_=0,y=0,b=0;const S=n;for(--n;++n<u;){const T=i[n],C=Math.max(T.fontSize,2);if(e.save(),e.font=T.fontStyle+" "+T.fontWeight+" "+C+"px "+T.fontFamily,d=e.measureText(T.text+"m").width+2*T.padding,f=2*C+2*T.padding,T.rotate!==0){const E=Math.sin(T.rotate*l),P=Math.cos(T.rotate*l),L=d*P,R=d*E,w=f*P,D=f*E;d=Math.max(Math.abs(L+D),Math.abs(L-D)),f=~~Math.max(Math.abs(R+w),Math.abs(R-w))}if(d=d+31>>5<<5,f=Math.ceil(f),f>y&&(y=f),g+d>=o&&(g=0,_+=y,y=f),_+f>=2048){if(_===0){T.hasText=!1;continue}break}_+f>=b&&(b=_+f),e.translate(g+(d>>1),_+(f>>1)),T.rotate!==0&&e.rotate(T.rotate*l),e.fillText(T.text,0,0),T.padding&&(e.lineWidth=2*T.padding,e.strokeText(T.text,0,0)),e.restore(),T.LT=[g,_],T.wordSize=[d,f],T.hasText=!0,g+=d}if(b===0)return;const v=e.getImageData(0,0,o,b).data;let A,x;for(;--n>=S;){const T=i[n];if(!T.hasText){T.bounds={dTop:1/0,dBottom:-1/0,dLeft:1/0,dRight:-1/0};break}const{LT:C=[0,0],wordSize:E}=T;[g,_]=C;const P=E[0]>>5,L=new Array(P*E[1]).fill(0);let[R,w,D,I]=[1/0,-1/0,1/0,-1/0];for(x=0;x<E[1];x++){let O;for(A=0;A<E[0];A++)if(v[4*((_+x)*o+(g+A))+3]>0){const B=1<<31-A%32;L[P*x+(A>>5)]|=B,A<D&&(D=A),A>I&&(I=A),O|=B}O&&(x<R&&(R=x),x>w&&(w=x))}T.bounds={dTop:(E[1]>>1)-R,dBottom:w-(E[1]>>1),dLeft:(E[0]>>1)-D,dRight:I-(E[0]>>1)},T.sprite=L,delete T.LT}}function initBoardWithShape(r){const{segmentation:{labels:e},boardSize:i,size:n}=r,o=i[0]>>5,l=new Array(o*n[1]).fill(0);for(let u=0;u<n[1];u++)for(let d=0;d<n[0];d++)if(e[u*n[0]+d]===0){const f=1<<31-d%32;l[o*u+(d>>5)]|=f}if(i[0]>n[0]){const u=(1<<i[0]-n[0])-1;for(let d=0;d<n[1];d++)l[o*d+o-1]|=u}return l}function filling(r,e,i){const{size:n,fillingTimes:o,fillingXStep:l,fillingYStep:u,getFillingFontStyle:d,getFillingFontWeight:f,getFillingFontFamily:g,fillingInitialFontSize:_,fillingDeltaFontSize:y,fillingInitialOpacity:b,fillingDeltaOpacity:S,fillingRotateList:v,getFillingPadding:A,random:x,board:T,minFillFontSize:C}=e,{boardSize:E,shapeBounds:P,tempCanvas:L,randomGenerator:R}=i,w=L.getContext("2d",{willReadFrequently:!0});let D=_,I=b;const O=[];for(let $=0;$<o;$++)B(D,I),D=Math.max(D>y?D-y:y,C),I=I>S?I-S:S;return O;function B($,H){const F=r.map(he=>{const{text:fe,color:pe,fillingColor:me,hasPlaced:ee,datum:Q}=he;return{x:0,y:0,weight:0,text:fe,fontFamily:g(Q),fontStyle:d(Q),fontWeight:f(Q),fontSize:$,rotate:v[~~(R()*v.length)],padding:A(Q),opacity:H,visible:!0,color:pe,fillingColor:me,hasPlaced:ee,datum:Q}});N(F);let V=0;const{x1:G,y1:Y,x2:J,y2:q}=P,[te,de]=[G+~~(R()*l*2),Y+~~(R()*u*2)];for(let he=de;he<=q;he+=u)for(let fe=te;fe<=J;fe+=l){measureSprite(L,w,F,V);const pe=F[V];pe.x=fe,pe.y=he;const{wordSize:me,bounds:ee,hasPlaced:Q}=pe;if(!Q||!ee){++V===F.length&&(V=0,x&&N(F));continue}const{dTop:ie,dBottom:le,dLeft:ce,dRight:z}=ee;pe.x-ce<0||pe.x+z>n[0]||pe.y-ie<0||pe.y+le>n[1]||pe.hasText&&pe.sprite&&!isCollideWithBoard(pe,T,E)&&(placeWordOnBoard(pe,T,E),O.push(Object.assign({},pe)),++V===F.length&&(V=0,x&&N(F)))}}function N($){return $.sort(()=>R()-.5)}}function cloud(r,e,i){allocateWords(r,i),e.layoutMode==="ensureMapping"?layoutGlobalShrink(r,e,i):e.layoutMode==="ensureMappingEnlarge"?layoutSelfEnlarge(r,e,i):layout(r,e,i);const n=filling(r,e,i),o=[],l=[];for(let u=0;u<r.length;u++)r[u].hasPlaced?l.push(r[u]):o.push(r[u]);return o.forEach(u=>u.visible=!1),{fillingWords:n,successedWords:l,failedWords:o}}const OUTPUT={x:"x",y:"y",fontFamily:"fontFamily",fontSize:"fontSize",fontStyle:"fontStyle",fontWeight:"fontWeight",angle:"angle",opacity:"opacity",visible:"visible",isFillingWord:"isFillingWord",color:"color"};class Layout{constructor(e,i){this.progressiveResult=[],this.options=e,this.view=i}layout(e){this.data=e;const i=this.options,n={shapeUrl:i.shape,size:i.size,ratio:i.ratio||.8,tempCanvas:void 0,boardSize:[0,0],random:!1,randomGenerator:void 0},o=vglobal.createCanvas({width:i.size[0],height:i.size[1]}),l=o.getContext("2d",{willReadFrequently:!0});l.textAlign="center",l.textBaseline="middle",n.tempCanvas=o;const u=i.size[0]+31>>5<<5;if(n.boardSize=[u,i.size[1]],n.random?n.randomGenerator=Math.random:n.randomGenerator=fakeRandom(),this.segmentationInput=n,isString(n.shapeUrl)){n.isEmptyPixel=generateIsEmptyPixel();const d=loadImage(n.shapeUrl);d?(this.isImageFinished=!1,this.isLayoutFinished=!1,d.then(f=>{this.isImageFinished=!0;const g=vglobal.createCanvas({width:i.size[0],height:i.size[1],dpr:1});n.maskCanvas=g;const _=g.getContext("2d");i.removeWhiteBorder&&removeBorder(f,g,n.isEmptyPixel);const y=scaleAndMiddleShape(f,i.size);_.clearRect(0,0,i.size[0],i.size[1]),_.drawImage(f,y.x,y.y,y.width,y.height),this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(n.maskCanvas)}).catch(f=>{this.isImageFinished=!0})):(this.isImageFinished=!0,this.isLayoutFinished=!0)}else if(n.shapeUrl&&(n.shapeUrl.type==="text"||n.shapeUrl.type==="geometric")){n.isEmptyPixel=generateIsEmptyPixel(n.shapeUrl.backgroundColor);const d=generateMaskCanvas(n.shapeUrl,i.size[0],i.size[1]);n.maskCanvas=d,this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(d),this.doLayout(),this.isImageFinished=!0,this.isLayoutFinished=!0}}canAnimate(){return!0}unfinished(){return!this.isLayoutFinished}output(){return this.progressiveResult}progressiveRun(){this.isImageFinished&&!this.isLayoutFinished&&(this.segmentationInput.maskCanvas&&this.doLayout(),this.isLayoutFinished=!0)}progressiveOutput(){return this.progressiveResult}doLayout(){var e,i,n,o,l,u,d,f,g,_,y,b,S,v,A,x,T,C,E,P,L,R;const w=this.segmentationInput,D=segmentation(w);if(!D.segmentation.regions.length)return;const I=this.options,O=this.data,B=I.colorMode||"ordinal",N={getText:field(I.text),getFontSize:field(I.fontSize),fontSizeRange:I.fontSizeRange,colorMode:B,getColor:I.colorField?field(I.colorField):field(I.text),getFillingColor:field(I.fillingColorField),colorList:I.colorList||(B==="ordinal"?["#2E62F1"]:["#537EF5","#2E62F1","#2358D8","#184FBF","#0C45A6","#013B8E"]),getColorHex:field(I.colorHexField),getFontFamily:field(I.fontFamily||"sans-serif"),rotateList:I.rotateList||[0],getPadding:field(I.padding||1),getFontStyle:field(I.fontStyle||"normal"),getFontWeight:field(I.fontWeight||"normal"),getFontOpacity:I.fontOpacity?field(I.fontOpacity):()=>1};initFontSizeScale(O,N,D);const $={size:I.size,ratio:I.ratio||.8,shapeUrl:I.shape,random:I.random===void 0||I.random,textLayoutTimes:(e=I.textLayoutTimes)!==null&&e!==void 0?e:3,removeWhiteBorder:I.removeWhiteBorder,layoutMode:(i=I.layoutMode)!==null&&i!==void 0?i:"default",fontSizeShrinkFactor:(n=I.fontSizeShrinkFactor)!==null&&n!==void 0?n:.8,stepFactor:(o=I.stepFactor)!==null&&o!==void 0?o:1,importantWordCount:(l=I.importantWordCount)!==null&&l!==void 0?l:10,globalShinkLimit:I.globalShinkLimit||.2,fontSizeEnlargeFactor:(u=I.fontSizeEnlargeFactor)!==null&&u!==void 0?u:1.5,fillingRatio:(d=I.fillingRatio)!==null&&d!==void 0?d:.7,fillingTimes:(f=I.fillingTimes)!==null&&f!==void 0?f:4,fillingXStep:I.fillingXRatioStep?Math.max(Math.floor(I.size[0]*I.fillingXRatioStep),1):(g=I.fillingXStep)!==null&&g!==void 0?g:4,fillingYStep:I.fillingYRatioStep?Math.max(Math.floor(I.size[1]*I.fillingYRatioStep),1):(_=I.fillingYStep)!==null&&_!==void 0?_:4,fillingInitialFontSize:I.fillingInitialFontSize,fillingDeltaFontSize:I.fillingDeltaFontSize,fillingInitialOpacity:(y=I.fillingInitialOpacity)!==null&&y!==void 0?y:.8,fillingDeltaOpacity:(b=I.fillingDeltaOpacity)!==null&&b!==void 0?b:.05,getFillingFontFamily:field(I.fillingFontFamily||"sans-serif"),getFillingFontStyle:field(I.fillingFontStyle||"normal"),getFillingFontWeight:field(I.fillingFontWeight||"normal"),getFillingPadding:field((S=I.fillingPadding)!==null&&S!==void 0?S:.4),fillingRotateList:(v=I.fillingRotateList)!==null&&v!==void 0?v:[0,90],fillingDeltaFontSizeFactor:(A=I.fillingDeltaFontSizeFactor)!==null&&A!==void 0?A:.2,fillingColorList:I.fillingColorList||["#537EF5"],sameColorList:!1,minInitFontSize:(x=I.minInitFontSize)!==null&&x!==void 0?x:10,minFontSize:(T=I.minFontSize)!==null&&T!==void 0?T:4,minFillFontSize:(C=I.minFillFontSize)!==null&&C!==void 0?C:2},H=colorListEqual(N.colorList,$.fillingColorList);$.sameColorList=H,initColorScale(O,N,$,I),initFillingWordsFontSize(O,N,$,D);const{getText:F,getFontFamily:V,getFontStyle:G,getFontWeight:Y,getPadding:J,getColor:q,getFillingColor:te,getColorHex:de,fontSizeScale:he,colorScale:fe,fillingColorScale:pe,getFontOpacity:me,rotateList:ee}=N,Q=O.map(X=>{var re,ge;return{x:0,y:0,weight:0,text:F(X),fontFamily:V(X),fontWeight:Y(X),fontStyle:G(X),rotate:ee[~~(w.randomGenerator()*ee.length)],fontSize:Math.max($.minInitFontSize,~~he(X)),opacity:me(X),padding:J(X),color:de&&de(X)||fe&&fe(q(X))||"black",fillingColor:!te||((re=I.colorField)===null||re===void 0?void 0:re.field)===((ge=I.fillingColorField)===null||ge===void 0?void 0:ge.field)&&H?void 0:de&&de(X)||pe&&pe(te(X))||"black",datum:X,visible:!0,hasPlaced:!1}}),ie=maxInArray(Q.map(X=>X.fontSize));Q.forEach(X=>X.weight=X.fontSize/ie),Q.sort((X,re)=>re.weight-X.weight);const{fillingWords:le,successedWords:ce,failedWords:z}=cloud(Q,$,D),W=(P=(E=I.text)===null||E===void 0?void 0:E.field)!==null&&P!==void 0?P:"textKey",K=(L=I.dataIndexKey)!==null&&L!==void 0?L:"defaultDataIndexKey",ne=I.as?Object.assign(Object.assign({},OUTPUT),I.as):OUTPUT;let se,ae;const j=[];for(let X=0;X<Q.length;++X)se=Q[X],ae=se.datum,ae[ne.x]=se.x,ae[ne.y]=se.y,ae[ne.fontFamily]=se.fontFamily,ae[ne.fontSize]=se.fontSize,ae[ne.fontStyle]=se.fontStyle,ae[ne.fontWeight]=se.fontWeight,ae[ne.angle]=degreeToRadian(se.rotate),ae[ne.opacity]=se.opacity,ae[ne.visible]=se.visible,ae[ne.isFillingWord]=!1,ae[ne.color]=se.color,ae[K]=`${se.text}_${X}_keyword`,j.push(ae);const U=[];if(le.forEach((X,re)=>{var ge,ue;const Z=Object.assign({},X.datum);Z[ne.x]=X.x,Z[ne.y]=X.y,Z[ne.fontFamily]=X.fontFamily,Z[ne.fontSize]=X.fontSize,Z[ne.fontStyle]=X.fontStyle,Z[ne.fontWeight]=X.fontWeight,Z[ne.angle]=degreeToRadian(X.rotate),Z[ne.opacity]=X.opacity,Z[ne.visible]=X.visible,Z[ne.isFillingWord]=!0,Z[ne.color]=te?((ge=I.colorField)===null||ge===void 0?void 0:ge.field)===((ue=I.fillingColorField)===null||ue===void 0?void 0:ue.field)&&H?X.color:X.fillingColor:$.fillingColorList[~~(w.randomGenerator()*$.fillingColorList.length)],Z[W]=X.text,Z[K]=`${X.text}_${re}_fillingWords`,U.push(Z)}),this.view&&this.view.emit){this.view.emit(WORDCLOUD_SHAPE_HOOK_EVENT.AFTER_WORDCLOUD_SHAPE_LAYOUT,{successedWords:ce,failedWords:z});const X=(R=this.view.renderer)===null||R===void 0?void 0:R.stage();X&&X.hooks.afterRender.tap(WORDCLOUD_SHAPE_HOOK_EVENT.AFTER_WORDCLOUD_SHAPE_DRAW,()=>{this.view.emit(WORDCLOUD_SHAPE_HOOK_EVENT.AFTER_WORDCLOUD_SHAPE_DRAW,{successedWords:ce,failedWords:z}),X.hooks.afterRender.unTap(WORDCLOUD_SHAPE_HOOK_EVENT.AFTER_WORDCLOUD_SHAPE_DRAW)})}this.progressiveResult=j.concat(U)}release(){this.segmentationInput=null,this.data=null,this.progressiveResult=null,this.options=null}}const initColorScale=(r,e,i,n)=>{var o,l,u,d;const{colorMode:f,getColor:g,getFillingColor:_}=e,{sameColorList:y}=i;let b,S,v=e.colorList,A=i.fillingColorList;if(f==="ordinal"){const x=r.map(T=>g(T));if(b=T=>new OrdinalScale().domain(x).range(v).scale(T),_&&(((o=n.colorField)===null||o===void 0?void 0:o.field)!==((l=n.fillingColorField)===null||l===void 0?void 0:l.field)||!y)){const T=r.map(C=>_(C));S=C=>new OrdinalScale().domain(T).range(A).scale(C)}}else{v.length===1&&(v=[v[0],v[0]]);const x=new LinearScale().domain(extent(g,r)).range(v);if(b=T=>x.scale(T),_&&(((u=n.colorField)===null||u===void 0?void 0:u.field)!==((d=n.fillingColorField)===null||d===void 0?void 0:d.field)||!y)){A.length===1&&(A=[A[0],A[0]]);const T=new LinearScale().domain(extent(_,r)).range(A);S=C=>T.scale(C)}}Object.assign(e,{colorScale:b,fillingColorScale:S})},initFontSizeScale=(r,e,i)=>{let{fontSizeRange:n}=e;const{getFontSize:o,getText:l}=e;let u;if(o){if(o&&n){const d=new SqrtScale().domain(extent(o,r)).range(n);u=f=>d.scale(o(f))}else if(o&&isFunction(o)&&!n){const[f,g]=extent(o,r),_=r.map(S=>({text:l(S),value:o(S),weight:g===f?1:(o(S)-f)/(g-f)})),y=getInitialFontSize(_,i,!0);n=[~~(.5*y),~~y];const b=new SqrtScale().domain(extent(o,r)).range(n);u=S=>b.scale(o(S))}}else{const d=r.map(g=>({text:l(g)})),f=getInitialFontSize(d,i,!1);u=functor(f)}Object.assign(e,{getFontSize:o,fontSizeRange:n,fontSizeScale:u})},getInitialFontSize=(r,e,i)=>{const n=e.shapeArea,o=e.ratio,l=e.segmentation.regions,u=Math.ceil(Math.sqrt(n)/12),d=r.reduce((g,_)=>{const y=calTextLength(_.text);return y<u?g+y*(i?(.5+.5*_.weight)**2:1):g},0);if(d===0)return 12;let f=20;if(l.length===1)f=Math.sqrt(o*(n/(1.7*d)));else{const g=[];for(let _=0;_<l.length;_++){const y=l[_].area,b=l[_].ratio,S=y/n;if(S<.1)continue;const v=S*(d*(b<1?2.7-b:1.7)),A=Math.sqrt(o*(y/v));g.push(A)}f=g.length?Math.min(...g):Math.sqrt(o*(n/(1.7*d)))}return f};function initFillingWordsFontSize(r,e,i,n){const{getText:o}=e;let{fillingInitialFontSize:l,fillingDeltaFontSize:u}=i;const{fillingRatio:d}=i,f=Math.ceil(Math.sqrt(n.shapeArea)/4);if(!l||!u){const g=d/100,_=r.reduce((b,S)=>{const v=calTextLength(o(S));return v>f?b:b+v},0)/r.length;let y;if(_===0)y=8;else{const b=.2*n.shapeArea;y=Math.sqrt(g*(b/_))}l=~~y,u=y*i.fillingDeltaFontSizeFactor,Object.assign(i,{fillingInitialFontSize:l,fillingDeltaFontSize:u})}}const extent=(r,e)=>{let i=1/0,n=-1/0;const o=e.length;let l;for(let u=0;u<o;++u)l=toNumber(r(e[u])),l<i&&(i=l),l>n&&(n=l);return e.length===1&&i===n&&(i-=1e4),[i,n]},field=r=>r?typeof r=="string"||typeof r=="number"?()=>r:isFunction(r)?r:e=>e[r.field]:null,transform$2=(r,e,i,n)=>{if(!r.size||isNil(r.size[0])||isNil(r.size[1])||r.size[0]<=0||r.size[1]<=0)return Logger.getInstance().info("Wordcloud size dimensions must be greater than 0"),[];if(r.size=[Math.ceil(r.size[0]),Math.ceil(r.size[1])],r.shape||error("WordcloudShape shape must be specified."),r.text||error("WordcloudShape text must be specified."),n!=null&&n.emit&&n.emit(WORDCLOUD_SHAPE_HOOK_EVENT.BEFORE_WORDCLOUD_SHAPE_LAYOUT),!e||e.length===0)return[];const o=new Layout(r,n);return o.layout(e),o.unfinished()?{progressive:o}:o.output()},registerWordCloudShapeTransforms=()=>{Factory.registerTransform("wordcloudShape",{transform:transform$2,markPhase:"beforeJoin"},!0)};class WordCloudSeries extends BaseWordCloudSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.wordCloud}}WordCloudSeries.type=SeriesTypeEnum.wordCloud;const registerWordCloudSeries=()=>{registerWordCloudTransforms(),registerTextMark(),registerWordCloudAnimation(),Factory$1.registerSeries(WordCloudSeries.type,WordCloudSeries)},registerWordCloudShapeSeries=()=>{registerWordCloudShapeTransforms(),registerWordCloudTransforms(),registerTextMark(),registerWordCloudAnimation(),Factory$1.registerSeries(WordCloudSeries.type,WordCloudSeries)};class WordCloud3dSeries extends BaseWordCloudSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.wordCloud3d}_wordCloudTransformOption(){var e;return Object.assign(Object.assign({},super._wordCloudTransformOption()),{postProjection:(e=this._spec.postProjection)!==null&&e!==void 0?e:"StereographicProjection",depth_3d:this._spec.depth_3d})}_wordCloudShapeTransformOption(){var e;return Object.assign(Object.assign({},super._wordCloudShapeTransformOption()),{postProjection:(e=this._spec.postProjection)!==null&&e!==void 0?e:"StereographicProjection",depth_3d:this._spec.depth_3d})}initMark(){this._wordMark=this._createMark(BaseWordCloudSeries.mark.word,{groupKey:this._seriesField,isSeriesMark:!0},{support3d:!0})}initMarkStyle(){super.initMarkStyle();const e=this._wordMark;e&&this.setMarkStyle(e,{z:i=>{var n;return(n=i.z)!==null&&n!==void 0?n:0}},"normal",AttributeLevel.Series)}initAnimation(){var e,i;const n=(e=this._padding)!==null&&e!==void 0?e:{};this._wordMark&&this._wordMark.setAnimationConfig(animationConfig((i=Factory$1.getAnimationInKey("wordCloud3d"))===null||i===void 0?void 0:i(()=>{var o;const l=this.getCompiler().getVGrammarView(),u=l.width()-n.left||0-n.right||0,d=l.height()-n.top||0-n.bottom||0,f=Math.max(u,d)/2;return{center:{x:f,y:f,z:(o=this._spec.depth_3d)!==null&&o!==void 0?o:f},r:f}}),userAnimationConfig("word",this._spec,this._markAttributeContext)))}}WordCloud3dSeries.type=SeriesTypeEnum.wordCloud3d;const registerWordCloud3dSeries=()=>{registerWordCloudTransforms(),registerTextMark(),registerWordCloud3dAnimation(),Factory$1.registerSeries(WordCloud3dSeries.type,WordCloud3dSeries)},registerWordCloudShape3dSeries=()=>{registerWordCloudShapeTransforms(),registerWordCloudTransforms(),registerTextMark(),registerWordCloud3dAnimation(),Factory$1.registerSeries(WordCloud3dSeries.type,WordCloud3dSeries)},funnel=(r,e)=>{var i,n;const o=r.map(L=>Object.assign({},L));if(!o||o.length===0)return o;const{valueField:l,asTransformRatio:u,asReachRatio:d,asHeightRatio:f,asValueRatio:g,asNextValueRatio:_,asLastValueRatio:y,asLastValue:b,asCurrentValue:S,asNextValue:v,heightVisual:A=!1,isCone:x=!0,range:T}=e,C=o.reduce((L,R)=>Math.max(L,Number.parseFloat(R[l])||-1/0),-1/0),E=o.reduce((L,R)=>Math.min(L,Number.parseFloat(R[l])||1/0),1/0),P=[(i=T==null?void 0:T.min)!==null&&i!==void 0?i:E,(n=T==null?void 0:T.max)!==null&&n!==void 0?n:C];return o.forEach((L,R)=>{var w,D;const I=Number.parseFloat(L[l]),O=Number.parseFloat((w=o[R-1])===null||w===void 0?void 0:w[l]),B=Number.parseFloat((D=o[R+1])===null||D===void 0?void 0:D[l]),N=isValidNumber(B*I)&&I!==0?B/I:0,$=isValidNumber(I*O)&&O!==0?I/O:0;b&&(L[b]=O),v&&(L[v]=B),u&&(L[u]=N),d&&(L[d]=R===0?1:$),f&&(L[f]=A===!0?N:1/o.length),g&&(L[g]=I/P[1]),_&&(L[_]=R===o.length-1?x?0:L[g]:B/P[1]),y&&(L[y]=R===0?1:O/P[1]),S&&(L[S]=I)}),o},funnelTransform=(r,e)=>{var i,n;const o=(n=(i=r[0])===null||i===void 0?void 0:i.latestData)===null||n===void 0?void 0:n.map(l=>Object.assign({},l));return o&&o.length!==0&&(o.shift(),o.forEach(l=>{l[e.asIsTransformLevel]=!0})),o},FUNNEL_TRANSFORM_RATIO=`${PREFIX}_FUNNEL_TRANSFORM_RATIO`,FUNNEL_REACH_RATIO=`${PREFIX}_FUNNEL_REACH_RATIO`,FUNNEL_HEIGHT_RATIO=`${PREFIX}_FUNNEL_HEIGHT_RATIO`,FUNNEL_VALUE_RATIO=`${PREFIX}_FUNNEL_VALUE_RATIO`,FUNNEL_LAST_VALUE_RATIO=`${PREFIX}_FUNNEL_LAST_VALUE_RATIO`,FUNNEL_NEXT_VALUE_RATIO=`${PREFIX}_FUNNEL_NEXT_VALUE_RATIO`,FUNNEL_LAST_VALUE=`${PREFIX}_FUNNEL_LAST_VALUE`,FUNNEL_CURRENT_VALUE=`${PREFIX}_FUNNEL_CURRENT_VALUE`,FUNNEL_NEXT_VALUE=`${PREFIX}_FUNNEL_NEXT_VALUE`,FUNNEL_TRANSFORM_LEVEL=`${PREFIX}_FUNNEL_TRANSFORM_LEVEL`,FUNNEL_LABEL_LINE_LENGTH=20,FUNNEL_LABEL_SPACE_WIDTH=5,FUNNEL_MAX_SIZE="80%",FUNNEL_MIN_SIZE=0;class FunnelSeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.dimensionTooltipTitleCallback=(e,i)=>{var n,o,l;const u=this.series;return((n=i==null?void 0:i.mark)===null||n===void 0?void 0:n.name)==="transform"?"":(o=this._getDimensionData(e))!==null&&o!==void 0?o:(l=e.properties)===null||l===void 0?void 0:l[`${u.getCategoryField()}`]},this.markTooltipValueCallback=(e,i)=>{var n;return((n=i==null?void 0:i.mark)===null||n===void 0?void 0:n.name)==="transform"?`${(100*(e==null?void 0:e[FUNNEL_REACH_RATIO])).toFixed(1)}%`:this._getMeasureData(e)},this.markTooltipKeyCallback=(e,i)=>{var n;if(((n=i==null?void 0:i.mark)===null||n===void 0?void 0:n.name)==="transform")return"";const{dimensionFields:o,seriesFields:l}=this._seriesCacheInfo,u=o[o.length-1];return isValid(l[0])?e==null?void 0:e[l[0]]:e==null?void 0:e[u]}}}class BasePolygonMark extends BaseMark{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{points:[]})}}class PolygonMark extends BasePolygonMark{constructor(){super(...arguments),this.type=PolygonMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}}PolygonMark.type="polygon";const registerPolygonMark=()=>{Factory$1.registerMark(PolygonMark.type,PolygonMark),registerPolygonGraphic(),registerVGrammarPolygonAnimation()},funnelSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{funnel:{name:"funnel",type:"polygon"},transform:{name:"transform",type:"polygon"},transformLabel:{name:"transformLabel",type:"text"},outerLabel:{name:"outerLabel",type:"text"},outerLabelLine:{name:"outerLabelLine",type:"rule"}}),funnel3dSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{funnel3d:{name:"funnel3d",type:"pyramid3d"},transform3d:{name:"transform3d",type:"pyramid3d"},transformLabel:{name:"transformLabel",type:"text"},outerLabel:{name:"outerLabel",type:"text"},outerLabelLine:{name:"outerLabelLine",type:"rule"}});class FunnelSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"funnel"),e.isTransform&&this._addMarkLabelSpec(e,"transform","transformLabel")}}class FunnelSeries extends BaseSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.funnel,this._funnelMarkName="funnel",this._funnelMarkType="polygon",this._transformMarkName="transform",this._transformMarkType="polygon",this.transformerConstructor=FunnelSeriesSpecTransformer,this._funnelMark=null,this._funnelTransformMark=null,this._labelMark=null,this._transformLabelMark=null,this._funnelOuterLabelMark={}}getCategoryField(){return this._categoryField}setCategoryField(e){return this._categoryField=e,this._categoryField}getValueField(){return this._valueField}setValueField(e){return this._valueField=e,this._valueField}setAttrFromSpec(){var e,i,n,o,l;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this._funnelOrient=(e=this._spec.funnelOrient)!==null&&e!==void 0?e:"top",this._shape=(i=this._spec.shape)!==null&&i!==void 0?i:"trapezoid",this._minLabelLineWidth=(l=(o=(n=this._spec.outerLabel)===null||n===void 0?void 0:n.line)===null||o===void 0?void 0:o.minLength)!==null&&l!==void 0?l:FUNNEL_LABEL_LINE_LENGTH,this._isHorizontal()?this._funnelAlign=["top","bottom"].includes(this._spec.funnelAlign)?this._spec.funnelAlign:"center":this._funnelAlign=["left","right"].includes(this._spec.funnelAlign)?this._spec.funnelAlign:"center",!this._seriesField&&this._spec.categoryField&&this.setSeriesField(this._spec.categoryField)}initData(){if(super.initData(),!this._data)return;registerDataSetInstanceTransform(this._dataSet,"funnel",funnel),registerDataSetInstanceTransform(this._dataSet,"funnelTransform",funnelTransform);const e=new DataView(this._dataSet,{name:`${PREFIX}_series_${this.id}_viewDataTransform`});e.parse([this.getViewData()],{type:"dataview"}),this._viewDataTransform=new SeriesData(this._option,e)}compileData(){var e;super.compileData(),(e=this._viewDataTransform)===null||e===void 0||e.compile()}getStatisticFields(){const e=[];return e.push({key:this._categoryField,operations:["values"]}),e.push({key:this._valueField,operations:["max","min"]}),e}_statisticViewData(){var e,i,n,o,l,u,d,f,g;super._statisticViewData(),this._data.getDataView().transform({type:"funnel",options:{valueField:this.getValueField(),isCone:this._spec.isCone,asCurrentValue:FUNNEL_CURRENT_VALUE,asTransformRatio:FUNNEL_TRANSFORM_RATIO,asReachRatio:FUNNEL_REACH_RATIO,asHeightRatio:FUNNEL_HEIGHT_RATIO,asValueRatio:FUNNEL_VALUE_RATIO,asNextValueRatio:FUNNEL_NEXT_VALUE_RATIO,asLastValueRatio:FUNNEL_LAST_VALUE_RATIO,asLastValue:FUNNEL_LAST_VALUE,asNextValue:FUNNEL_NEXT_VALUE,range:{min:(i=(e=this._spec.range)===null||e===void 0?void 0:e.min)!==null&&i!==void 0?i:(o=(n=this.getViewDataStatistics().latestData)===null||n===void 0?void 0:n[this.getValueField()])===null||o===void 0?void 0:o.min,max:(u=(l=this._spec.range)===null||l===void 0?void 0:l.max)!==null&&u!==void 0?u:(f=(d=this.getViewDataStatistics().latestData)===null||d===void 0?void 0:d[this.getValueField()])===null||f===void 0?void 0:f.max}}}),(g=this._viewDataTransform.getDataView())===null||g===void 0||g.transform({type:"funnelTransform",options:{asIsTransformLevel:FUNNEL_TRANSFORM_LEVEL}})}initMark(){var e,i,n,o,l,u,d,f,g,_,y,b;if(this._funnelMark=this._createMark(Object.assign(Object.assign({},FunnelSeries.mark.funnel),{name:this._funnelMarkName,type:this._funnelMarkType}),{themeSpec:(e=this._theme)===null||e===void 0?void 0:e.funnel,groupKey:this._seriesField,isSeriesMark:!0,stateSort:(i=this._spec.funnel)===null||i===void 0?void 0:i.stateSort,noSeparateStyle:!0},{setCustomizedShape:(n=this._spec.funnel)===null||n===void 0?void 0:n.customShape,morph:shouldMarkDoMorph(this._spec,this._funnelMarkName),morphElementKey:this._seriesField}),this._spec.isTransform&&(this._funnelTransformMark=this._createMark(Object.assign(Object.assign({},FunnelSeries.mark.transform),{name:this._transformMarkName,type:this._transformMarkType}),{themeSpec:(o=this._theme)===null||o===void 0?void 0:o.transform,skipBeforeLayouted:!1,dataView:this._viewDataTransform.getDataView(),dataProductId:this._viewDataTransform.getProductId(),stateSort:(l=this._spec.transform)===null||l===void 0?void 0:l.stateSort,noSeparateStyle:!0},{setCustomizedShape:(u=this._spec.transform)===null||u===void 0?void 0:u.customShape})),(f=(d=this._spec)===null||d===void 0?void 0:d.outerLabel)===null||f===void 0?void 0:f.visible){const{line:S}=(g=this._spec.outerLabel)!==null&&g!==void 0?g:{},{line:v}=(y=(_=this._theme)===null||_===void 0?void 0:_.outerLabel)!==null&&y!==void 0?y:{};this._funnelOuterLabelMark.label=this._createMark(FunnelSeries.mark.outerLabel,{themeSpec:(b=this._theme)===null||b===void 0?void 0:b.outerLabel,markSpec:this._spec.outerLabel,skipBeforeLayouted:!0,noSeparateStyle:!0}),this._funnelOuterLabelMark.line=this._createMark(FunnelSeries.mark.outerLabelLine,{themeSpec:v,markSpec:S,depend:[this._funnelOuterLabelMark.label],noSeparateStyle:!0})}}initTooltip(){this._tooltipHelper=new FunnelSeriesTooltipHelper(this),this._funnelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._funnelMark),this._funnelTransformMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._funnelTransformMark)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return[this._valueField]}getGroupFields(){return null}initMarkStyle(){const e=this._funnelMark;e&&this.setMarkStyle(e,{points:l=>this.getPoints(l),visible:l=>isValid(l[this._valueField]),fill:this.getColorAttribute()},"normal",AttributeLevel.Series);const i=this._funnelTransformMark;i&&this.setMarkStyle(i,{points:l=>this.getPoints(l)},"normal",AttributeLevel.Series);const n=this._funnelOuterLabelMark.label;n&&(this.setMarkStyle(n,{text:l=>`${l[this.getCategoryField()]}`,x:l=>this._computeOuterLabelPosition(l).x,y:l=>this._computeOuterLabelPosition(l).y,textAlign:l=>this._computeOuterLabelPosition(l).align,textBaseline:l=>this._computeOuterLabelPosition(l).textBaseline,maxLineWidth:l=>this._computeOuterLabelLimit(l),width:0,height:0},"normal",AttributeLevel.Series),isFunction(this._spec.outerLabel.formatMethod)&&this.setMarkStyle(n,{text:l=>this._spec.outerLabel.formatMethod(`${l[this.getCategoryField()]}`,l)},"normal",AttributeLevel.User_Mark));const o=this._funnelOuterLabelMark.line;o&&n&&this.setMarkStyle(o,{x:l=>this._computeOuterLabelLinePosition(l).x1,y:l=>this._computeOuterLabelLinePosition(l).y1,x1:l=>this._computeOuterLabelLinePosition(l).x2,y1:l=>this._computeOuterLabelLinePosition(l).y2},"normal",AttributeLevel.Series)}initLabelMarkStyle(e){var i,n;if(!e)return;const o=e.getTarget(),l=e.getComponent();o===this._funnelMark?(this._labelMark=e,this.setMarkStyle(e,{text:u=>`${u[this.getCategoryField()]} ${u[this.getValueField()]}`,x:u=>this._computeLabelPosition(u).x,y:u=>this._computeLabelPosition(u).y,maxLineWidth:u=>this._computeLabelLimit(u,this._spec.label),stroke:this.getColorAttribute()},"normal",AttributeLevel.Series),!((i=this._funnelOuterLabelMark)===null||i===void 0)&&i.label&&this._funnelOuterLabelMark.label.setDepend(l),!((n=this._funnelOuterLabelMark)===null||n===void 0)&&n.line&&this._funnelOuterLabelMark.line.setDepend(...this._funnelOuterLabelMark.line.getDepend())):this._funnelTransformMark&&o===this._funnelTransformMark&&(this._transformLabelMark=e,this.setMarkStyle(e,{text:u=>`${(100*field$2(FUNNEL_REACH_RATIO).bind(this)(u)).toFixed(1)}%`,x:u=>this._computeLabelPosition(u).x,y:u=>this._computeLabelPosition(u).y,maxLineWidth:u=>this._computeLabelLimit(u,this._spec.transformLabel)},"normal",AttributeLevel.Series))}initAnimation(){var e,i,n,o,l,u,d;const f=(n=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset)!==null&&n!==void 0?n:"clipIn";f==="clipIn"&&this._rootMark&&this._rootMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("cartesianGroupClip"))===null||o===void 0?void 0:o({direction:()=>this._isHorizontal()?"x":"y",width:()=>{const g=this.getRootMark().getProduct();if(g){const{x1:_,x2:y}=g.getBounds();return Math.max(_,y)}return this.getLayoutRect().width},height:()=>{const g=this.getRootMark().getProduct();if(g){const{y1:_,y2:y}=g.getBounds();return Math.max(_,y)}return this.getLayoutRect().height},orient:()=>this._isReverse()?"negative":"positive"},f),userAnimationConfig("group",this._spec,this._markAttributeContext))),[(l=this._funnelOuterLabelMark)===null||l===void 0?void 0:l.label].forEach(g=>{g&&g.setAnimationConfig(animationConfig(Factory$1.getAnimationInKey("fadeInOut")(),userAnimationConfig(g.name,this._spec,this._markAttributeContext)))}),[this._funnelMark,this._funnelTransformMark].forEach(g=>{g&&g.setAnimationConfig(animationConfig(Factory$1.getAnimationInKey("funnel")({},f),userAnimationConfig(g.name,this._spec,this._markAttributeContext)))}),!((u=this._funnelOuterLabelMark)===null||u===void 0)&&u.line&&this._funnelOuterLabelMark.line.setAnimationConfig(animationConfig((d=Factory$1.getAnimationInKey("fadeInOut"))===null||d===void 0?void 0:d(),userAnimationConfig("outerLabelLine",this._spec,this._markAttributeContext)))}initGroups(){}getStackGroupFields(){return[]}getStackValueField(){return null}initEvent(){var e;super.initEvent(),(e=this._viewDataTransform.getDataView())===null||e===void 0||e.target.addListener("change",i=>{this._viewDataTransform.updateData()})}getPoints(e){const i=this.isTransformLevel(e),n=this._getMainAxisLength(i)/2;let o,l;i?(o=this._shape==="rect"?this._getSecondaryAxisLength(e[FUNNEL_LAST_VALUE_RATIO])/2:this._getSecondaryAxisLength(e[FUNNEL_VALUE_RATIO])/2,l=this._getSecondaryAxisLength(e[FUNNEL_VALUE_RATIO])/2):(o=this._getSecondaryAxisLength(e[FUNNEL_VALUE_RATIO])/2,l=this._shape==="rect"?o:this._getSecondaryAxisLength(e[FUNNEL_NEXT_VALUE_RATIO])/2);const{x:u,y:d}=this._getPositionByData(e),f=this._getPolygonPoints([u,d],o,l,o,l,n);return this._funnelAlign!=="center"&&this._adjustPoints(f),f}isTransformLevel(e){return!!(e!=null&&e[FUNNEL_TRANSFORM_LEVEL])}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getPoints=this.getPoints.bind(this),this._markAttributeContext.isTransformLevel=this.isTransformLevel.bind(this)}valueToPosition(e){var i,n,o;const l=(o=(n=(i=this.getViewData())===null||i===void 0?void 0:i.latestData)===null||n===void 0?void 0:n.find)===null||o===void 0?void 0:o.call(n,u=>u[this._categoryField]===e);return isValid(l)?this._getPolygonCenter(this.getPoints(l)):null}dataToPosition(e,i){return i&&!this.isDatumInViewData(e)?null:this.valueToPosition(e[this._categoryField])}dataToPositionX(e){var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.x}dataToPositionY(e){var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.y}dataToPositionZ(e){return 0}_getMainAxisLength(e=!1){var i;const n=this.getViewData().latestData.length,o=this._isHorizontal()?this.getLayoutRect().width:this.getLayoutRect().height,l=!!this._spec.isTransform,u=l?0:(i=this._spec.gap)!==null&&i!==void 0?i:0,d=l?Math.max(0,n-1):0,f=this._spec.heightRatio||.5,g=(o-u*Math.max(0,n-1))/(n+f*d);return e?l?g*f:0:g}_getSecondaryAxisLength(e){const i=Number.isNaN(e)||!Number.isFinite(e)?0:e,n=this._computeMaxSize(),o=this._computeMinSize();return o+(n-o)*i}_getPositionByData(e){var i;const n=(i=this.getViewData().latestData)===null||i===void 0?void 0:i.findIndex(b=>b[this._categoryField]===e[this._categoryField]&&b[DEFAULT_DATA_KEY]===e[DEFAULT_DATA_KEY]);if(!isValid(n)||n<0)return{};const o=this.isTransformLevel(e),l=this._isHorizontal(),u=l?this.getLayoutRect().height:this.getLayoutRect().width,d=l?this.getLayoutRect().width:this.getLayoutRect().height,f=u/2;let g=0;const _=this._getMainAxisLength(),y=this._getMainAxisLength(!0);return g+=n*(_+y),g+=o?-y/2:_/2,!this._spec.isTransform&&this._spec.gap&&(g+=this._spec.gap*n),this._isReverse()&&(g=d-g),this._isHorizontal()?{x:g,y:f}:{x:f,y:g}}_getPolygonPoints(e,i,n,o,l,u){const d=e[0],f=e[1];switch(this._funnelOrient){case"left":return[{x:d-u,y:f+i},{x:d-u,y:f-o},{x:d+u,y:f-l},{x:d+u,y:f+n}];case"right":return[{x:d+u,y:f-o},{x:d+u,y:f+o},{x:d-u,y:f+n},{x:d-u,y:f-n}];case"bottom":return[{x:d+i,y:f+u},{x:d-o,y:f+u},{x:d-l,y:f-u},{x:d+n,y:f-u}];default:return[{x:d-i,y:f-u},{x:d+o,y:f-u},{x:d+l,y:f+u},{x:d-n,y:f+u}]}}_getPolygonCenter(e){if(this._isHorizontal()){const o=(e[0].x+e[3].x)/2,l=(e[0].y+e[3].y)/2;return{x:(o+(e[1].x+e[2].x)/2)/2,y:(l+(e[1].y+e[2].y)/2)/2}}const i=(e[0].x+e[3].x)/2,n=(e[0].y+e[3].y)/2;return{x:(i+(e[1].x+e[2].x)/2)/2,y:(n+(e[1].y+e[2].y)/2)/2}}_adjustPoints(e){let i,n,o;return this._isHorizontal()?(o="y",this._funnelOrient==="left"?(i=this._funnelAlign==="bottom"?-e[1].y:e[1].y,n=this._funnelAlign==="bottom"?-e[2].y:e[2].y):(i=this._funnelAlign==="bottom"?-e[0].y:e[0].y,n=this._funnelAlign==="bottom"?-e[3].y:e[3].y)):(o="x",this._funnelOrient==="top"?(i=this._funnelAlign==="left"?e[0].x:-e[0].x,n=this._funnelAlign==="left"?e[3].x:-e[3].x):(i=this._funnelAlign==="left"?e[1].x:-e[1].x,n=this._funnelAlign==="left"?e[2].x:-e[2].x)),e[0][o]-=i,e[1][o]-=i,e[2][o]-=n,e[3][o]-=n,e}_computeLabelPosition(e){const i=this.getPoints(e);return this._getPolygonCenter(i)}_computeLabelLimit(e,i){const n=i==null?void 0:i.limit;if(isNumber(n))return n;const o=this.getPoints(e);return n==="shapeSize"?this._isHorizontal()?Math.abs(o[3].x-o[0].x):(Math.abs(o[0].x-o[1].x)+Math.abs(o[2].x-o[3].x))/2:this._isHorizontal()?Math.abs(o[3].x-o[0].x):void 0}_computeOuterLabelPosition(e){var i,n;let o,l,u=(i=this._spec.outerLabel)===null||i===void 0?void 0:i.position,d="center",f="middle";if(u=this._isHorizontal()?["top","bottom"].includes(u)?u:this._funnelAlign==="bottom"?"top":"bottom":["left","right"].includes(u)?u:this._funnelAlign==="left"?"right":"left",((n=this._spec.outerLabel)===null||n===void 0?void 0:n.alignLabel)!==!1)({x:o,y:l}=this._getPositionByData(e)),u==="left"?(o=0,d="left"):u==="right"?(o=this.getLayoutRect().width,d="right"):u==="top"?(l=0,f="top"):u==="bottom"&&(l=this.getLayoutRect().height,f="bottom");else{const{x2:g,y2:_}=this._computeOuterLabelLinePosition(e);o=g,l=_,u==="left"?(o-=FUNNEL_LABEL_SPACE_WIDTH,d="right"):u==="right"?(o+=FUNNEL_LABEL_SPACE_WIDTH,d="left"):u==="top"?(l-=FUNNEL_LABEL_SPACE_WIDTH,f="bottom"):u==="bottom"&&(l+=FUNNEL_LABEL_SPACE_WIDTH,f="top")}return{x:o,y:l,align:d,textBaseline:f}}_computeOuterLabelLimit(e){var i,n,o,l,u,d,f;if(this._isHorizontal())return this._getMainAxisLength(this.isTransformLevel(e));const g=this.getPoints(e),_=(Math.abs(g[0].x-g[1].x)+Math.abs(g[2].x-g[3].x))/2,y=this.getCategoryField(),b=(u=(l=(o=(n=(i=this._labelMark)===null||i===void 0?void 0:i.getComponent())===null||n===void 0?void 0:n.getProduct())===null||o===void 0?void 0:o.getGroupGraphicItem())===null||l===void 0?void 0:l.find(({attribute:x,type:T})=>{var C;return T==="text"&&((C=x.data)===null||C===void 0?void 0:C[y])===e[y]},!0))===null||u===void 0?void 0:u.AABBBounds,S=b?b.x2-b.x1:0,v=this._funnelOuterLabelMark.line?this._minLabelLineWidth:0;let A=this.getLayoutRect().width-Math.max(_,S);return this._funnelAlign==="center"&&(A/=2),A-v-((f=(d=this._spec.outerLabel)===null||d===void 0?void 0:d.spaceWidth)!==null&&f!==void 0?f:FUNNEL_LABEL_SPACE_WIDTH)}_computeOuterLabelLinePosition(e){var i,n,o,l,u,d,f,g,_,y,b,S,v;const A=this.getCategoryField(),x=(u=(l=(o=(n=(i=this._funnelOuterLabelMark)===null||i===void 0?void 0:i.label)===null||n===void 0?void 0:n.getProduct())===null||o===void 0?void 0:o.elements)===null||l===void 0?void 0:l.find(B=>{var N;return((N=B.data[0])===null||N===void 0?void 0:N[A])===e[A]}))===null||u===void 0?void 0:u.getBounds(),T=(y=(_=(g=(f=(d=this._labelMark)===null||d===void 0?void 0:d.getComponent())===null||f===void 0?void 0:f.getProduct())===null||g===void 0?void 0:g.getGroupGraphicItem())===null||_===void 0?void 0:_.find(({attribute:B,type:N})=>{var $;return N==="text"&&(($=B.data)===null||$===void 0?void 0:$[A])===e[A]},!0))===null||y===void 0?void 0:y.AABBBounds,C=(b=this._spec.outerLabel)!==null&&b!==void 0?b:{};let E,P,L,R;if(this._isHorizontal()){const B=(S=C.spaceWidth)!==null&&S!==void 0?S:FUNNEL_LABEL_SPACE_WIDTH,N=this.getPoints(e),$=(Math.abs(N[0].y-N[1].y)+Math.abs(N[2].y-N[3].y))/2;return this._spec.outerLabel.position==="top"||this._funnelAlign==="bottom"?(L=this._getPolygonCenter(N).y-$/2-B,R=C.alignLabel!==!1?(x==null?void 0:x.y2)+B:L-B,E=this._getPolygonCenter(N).x,L-R<this._minLabelLineWidth&&(R=L-this._minLabelLineWidth),P=E):(L=this._getPolygonCenter(N).y+$/2+B,R=C.alignLabel!==!1?(x==null?void 0:x.y1)-B:L+B,E=this._getPolygonCenter(N).x,R-L<this._minLabelLineWidth&&(R=L+this._minLabelLineWidth),P=E),{x1:E,x2:P,y1:L,y2:R}}const w=this.getPoints(e),D=(Math.abs(w[0].x-w[1].x)+Math.abs(w[2].x-w[3].x))/2,I=(T==null?void 0:T.x2)-(T==null?void 0:T.x1)||0,O=(v=C.spaceWidth)!==null&&v!==void 0?v:FUNNEL_LABEL_SPACE_WIDTH;return this._spec.outerLabel.position==="right"||this._funnelAlign==="left"?(E=this._getPolygonCenter(w).x+Math.max(I/2,D/2)+O,P=C.alignLabel!==!1?(x==null?void 0:x.x1)-O:E+O,L=this._getPolygonCenter(w).y,P-E<this._minLabelLineWidth&&(P=E+this._minLabelLineWidth),R=L):(E=this._getPolygonCenter(w).x-Math.max(I/2,D/2)-O,P=C.alignLabel!==!1?(x==null?void 0:x.x2)+O:E-O,L=this._getPolygonCenter(w).y,E-P<this._minLabelLineWidth&&(P=E-this._minLabelLineWidth),R=L),{x1:E,x2:P,y1:L,y2:R}}_computeMaxSize(){var e;const i=this._isHorizontal()?this.getLayoutRect().height:this.getLayoutRect().width,n=(e=this._spec.maxSize)!==null&&e!==void 0?e:FUNNEL_MAX_SIZE;return calcLayoutNumber(n,i)}_computeMinSize(){var e;const i=this._isHorizontal()?this.getLayoutRect().height:this.getLayoutRect().width,n=(e=this._spec.minSize)!==null&&e!==void 0?e:FUNNEL_MIN_SIZE;return calcLayoutNumber(n,i)}_isHorizontal(){return this._funnelOrient==="left"||this._funnelOrient==="right"}_isReverse(){return this._funnelOrient==="bottom"||this._funnelOrient==="right"}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._funnelMark]}}FunnelSeries.type=SeriesTypeEnum.funnel,FunnelSeries.mark=funnelSeriesMark,FunnelSeries.transformerConstructor=FunnelSeriesSpecTransformer;const registerFunnelSeries=()=>{registerPolygonMark(),registerTextMark(),registerRuleMark(),Factory$1.registerSeries(FunnelSeries.type,FunnelSeries),Factory$1.registerAnimation("funnel",(r,e)=>Object.assign({appear:e==="clipIn"?void 0:{type:"fadeIn"}},FadeInOutAnimation)),registerCartesianGroupClipAnimation(),registerFadeInOutAnimation()};class Pyramid3dMark extends BasePolygonMark{constructor(){super(...arguments),this.type=Pyramid3dMark.type}}Pyramid3dMark.type="pyramid3d";const registerPyramid3dMark=()=>{Factory$1.registerMark(Pyramid3dMark.type,Pyramid3dMark),registerPyramid3dGraphic(),registerVGrammarPolygonAnimation()};class Funnel3dSeriesSpecTransformer extends FunnelSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"funnel3d"),e.isTransform&&this._addMarkLabelSpec(e,"transform3d","transformLabel")}}class Funnel3dSeries extends FunnelSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.funnel3d,this._funnelMarkName="funnel3d",this._funnelMarkType="pyramid3d",this._transformMarkName="transform3d",this._transformMarkType="pyramid3d",this.transformerConstructor=Funnel3dSeriesSpecTransformer}initMark(){var e,i,n,o,l,u,d,f;if(this._funnelMark=this._createMark(Object.assign(Object.assign({},Funnel3dSeries.mark.funnel3d),{name:this._funnelMarkName,type:this._funnelMarkType}),{themeSpec:(e=this._theme)===null||e===void 0?void 0:e.funnel3d,key:this._seriesField,isSeriesMark:!0},{support3d:!0}),this._spec.isTransform&&(this._funnelTransformMark=this._createMark(Object.assign(Object.assign({},Funnel3dSeries.mark.transform3d),{name:this._transformMarkName,type:this._transformMarkType}),{themeSpec:(i=this._theme)===null||i===void 0?void 0:i.transform3d,key:this._seriesField,skipBeforeLayouted:!1,dataView:this._viewDataTransform.getDataView(),dataProductId:this._viewDataTransform.getProductId()})),(o=(n=this._spec)===null||n===void 0?void 0:n.outerLabel)===null||o===void 0?void 0:o.visible){const{line:g}=(l=this._spec.outerLabel)!==null&&l!==void 0?l:{},{line:_}=(d=(u=this._theme)===null||u===void 0?void 0:u.outerLabel)!==null&&d!==void 0?d:{};this._funnelOuterLabelMark.label=this._createMark(Funnel3dSeries.mark.outerLabel,{themeSpec:(f=this._theme)===null||f===void 0?void 0:f.outerLabel,key:this._seriesField,markSpec:this._spec.outerLabel}),this._funnelOuterLabelMark.line=this._createMark(Funnel3dSeries.mark.outerLabelLine,{themeSpec:_,key:this._seriesField,markSpec:g,depend:[this._funnelOuterLabelMark.label]})}}initMarkStyle(){super.initMarkStyle();const e=this._funnelMark;e&&this.setMarkStyle(e,{z:i=>{if(this._isHorizontal())return 0;const n=this.getPoints(i),o=Math.max(Math.abs(n[0].x-n[1].x),Math.abs(n[2].x-n[3].x));return(this._computeMaxSize()-o)/2}},"normal",AttributeLevel.Series)}initLabelMarkStyle(e){var i,n;super.initLabelMarkStyle(e),this.setMarkStyle(e,{z:o=>{if(this._isHorizontal())return 0;const l=this.getPoints(o),u=Math.max(Math.abs(l[0].x-l[1].x),Math.abs(l[2].x-l[3].x));return(this._computeMaxSize()-u)/2}},"normal",AttributeLevel.Series),this._labelMark=e,!((i=this._funnelOuterLabelMark)===null||i===void 0)&&i.label&&this._funnelOuterLabelMark.label.setDepend(e.getComponent()),!((n=this._funnelOuterLabelMark)===null||n===void 0)&&n.line&&this._funnelOuterLabelMark.line.setDepend(...this._funnelOuterLabelMark.line.getDepend())}}Funnel3dSeries.type=SeriesTypeEnum.funnel3d,Funnel3dSeries.mark=funnel3dSeriesMark,Funnel3dSeries.transformerConstructor=Funnel3dSeriesSpecTransformer;const registerFunnel3dSeries=()=>{registerPyramid3dMark(),registerTextMark(),registerRuleMark(),Factory$1.registerSeries(Funnel3dSeries.type,Funnel3dSeries)},computeRatio=(r,e)=>{const i=(r-e[0])/(e[1]-e[0]||1);return Math.max(0,Math.min(1,i))},getInnerMostElements=r=>{const e=r.mark.elements.filter(n=>n.diffState===DiffState.update),i=minInArray(e.map(n=>{var o;return(o=n==null?void 0:n.data)===null||o===void 0?void 0:o[0].depth}));return e.filter(n=>{var o;return((o=n==null?void 0:n.data)===null||o===void 0?void 0:o[0].depth)===i})},computeInnerAngleRange$1=(r,e,i)=>isEmpty(r)?[e,i]:[minInArray(r.map(n=>1*n.getGraphicAttribute("startAngle",!1))),maxInArray(r.map(n=>1*n.getGraphicAttribute("endAngle",!1)))],sunburstEnter=r=>({channel:{startAngle:{from:(e,i)=>{const{startAngle:n,endAngle:o}=r.animationInfo(),l=getInnerMostElements(i),u=computeInnerAngleRange$1(l,n,o);return computeRatio(e.startAngle,u)*(o-n)+n},to:e=>e.startAngle},endAngle:{from:(e,i)=>{const{startAngle:n,endAngle:o}=r.animationInfo(),l=getInnerMostElements(i),u=computeInnerAngleRange$1(l,n,o);return computeRatio(e.endAngle,u)*(o-n)+n},to:e=>e.endAngle},outerRadius:{from:e=>e.innerRadius,to:e=>e.outerRadius},innerRadius:{from:e=>e.innerRadius,to:e=>e.innerRadius}}}),computeInnerAngleRange=r=>[minInArray(r.map(e=>1*e.getGraphicAttribute("startAngle",!1))),maxInArray(r.map(e=>1*e.getGraphicAttribute("endAngle",!1)))],sunburstExit=r=>({channel:{startAngle:{from:(e,i)=>i.getGraphicAttribute("startAngle",!1),to:(e,i)=>{const{startAngle:n,endAngle:o}=r.animationInfo(),l=getInnerMostElements(i),u=computeInnerAngleRange(l);return computeRatio(i.getGraphicAttribute("startAngle",!1),u)*(o-n)+n}},endAngle:{from:(e,i)=>i.getGraphicAttribute("endAngle",!1),to:(e,i)=>{const{startAngle:n,endAngle:o}=r.animationInfo(),l=getInnerMostElements(i),u=computeInnerAngleRange(l);return computeRatio(i.getGraphicAttribute("endAngle",!1),u)*(o-n)+n}},outerRadius:{from:(e,i)=>i.getGraphicAttribute("outerRadius",!1),to:()=>r.animationInfo().innerRadius},innerRadius:{from:(e,i)=>i.getGraphicAttribute("innerRadius",!1),to:()=>r.animationInfo().innerRadius}}}),sunburstPresetAnimation=(r,e)=>{switch(e){case"fadeIn":return{type:"fadeIn"};case"growAngle":return{type:"growAngleIn"};default:return{type:"growRadiusIn"}}},registerSunburstAnimation=()=>{Factory$1.registerAnimation("sunburst",(r,e)=>({appear:sunburstPresetAnimation(r,e),enter:sunburstEnter(r),exit:sunburstExit(r),disappear:sunburstExit(r)}))},flattenNodes=(r,e=[],i)=>{const n=(i==null?void 0:i.maxDepth)>=0;return r.forEach(o=>{(!n||o.depth<=i.maxDepth)&&(e.push(i!=null&&i.callback?i.callback(o):o),o.children&&(n&&o.depth===i.maxDepth?(o.children=null,o.isLeaf=!0):flattenNodes(o.children,e,i)))}),e};function binary(r,e,i,n,o){const l=r.children,u=l.length;let d=0;const f=new Array(u+1);f[0]=0;for(let _=0;_<u;++_)d+=l[_].value,f[_+1]=d;const g=(_,y,b,S,v,A,x)=>{if(_>=y-1){const w=l[_];return w.x0=S,w.y0=v,w.x1=A,void(w.y1=x)}const T=f[_],C=b/2+T;let E=_+1,P=y-1;for(;E<P;){const w=E+P>>>1;f[w]<C?E=w+1:P=w}C-f[E-1]<f[E]-C&&_+1<E&&--E;const L=f[E]-T,R=b-L;if(A-S>x-v){const w=b?(S*R+A*L)/b:A;g(_,E,L,S,v,w,x),g(E,y,R,w,v,A,x)}else{const w=b?(v*R+x*L)/b:x;g(_,E,L,S,v,A,w),g(E,y,R,S,w,A,x)}};g(0,u,r.value,e,i,n,o)}function dice(r,e,i,n,o,l={x0:"x0",x1:"x1",y0:"y0",y1:"y1"}){const u=r.children;let d,f=-1;const g=u.length,_=r.value&&(n-e)/r.value;for(;++f<g;)d=u[f],d[l.y0]=i,d[l.y1]=o,d[l.x0]=e,d[l.x1]=e+=d.value*_}function slice(r,e,i,n,o){const l=r.children;let u,d=-1;const f=l.length,g=r.value&&(o-i)/r.value;for(;++d<f;)u=l[d],u.x0=e,u.x1=n,u.y0=i,i+=u.value*g,u.y1=i}function sliceDice(r,e,i,n,o){(r.depth%2==1?slice:dice)(r,e,i,n,o)}function squarifyRatio(r,e,i,n,o,l){const u=[],d=e.children;let f,g,_=0,y=0;const b=d.length;let S,v,A,x,T,C,E,P,L,R=e.value;for(;_<b;){S=o-i,v=l-n;do A=d[y++].value;while(!A&&y<b);for(x=A,T=A,P=Math.max(v/S,S/v)/(R*r),L=A*A*P,E=Math.max(T/L,L/x);y<b;++y){if(g=d[y].value,A+=g,g<x&&(x=g),g>T&&(T=g),L=A*A*P,C=Math.max(T/L,L/x),C>E){A-=g;break}E=C}f=Object.assign({},e,{value:A,children:d.slice(_,y)}),u.push(f),S<v?dice(f,i,n,o,R?n+=v*A/R:l):slice(f,i,n,R?i+=S*A/R:o,l),R-=A,_=y}return u}const generateSquarify=r=>(e,i,n,o,l)=>{squarifyRatio(r,e,i,n,o,l)},calculateNodeValue$1=(r,e,i=0,n=-1,o,l,u="value")=>{let d=0,f=n??-1,g=i;return r.forEach((_,y)=>{var b,S;const v={flattenIndex:++f,key:l?l(_):`${(b=o==null?void 0:o.key)!==null&&b!==void 0?b:""}-${y}`,maxDepth:-1,depth:i,index:y,value:_[u],isLeaf:!0,datum:o?o.datum.concat(_):[_],parentKey:o==null?void 0:o.key};if(!((S=_.children)===null||S===void 0)&&S.length){v.children=[],v.isLeaf=!1;const A=calculateNodeValue$1(_.children,v.children,i+1,f,v,l,u);v.value=isNil(_[u])?A.sum:Math.max(A.sum,toValidNumber$1(_[u])),f=A.flattenIndex,g=Math.max(A.maxDepth,g)}else v.isLeaf=!0,v.value=toValidNumber$1(_[u]);d+=Math.abs(v.value),e.push(v)}),{sum:d,maxDepth:g,flattenIndex:f}},eachBefore=(r,e,i,n)=>{let o=n;return r.forEach((l,u)=>{var d;o=e(l,u,i,o),!((d=l.children)===null||d===void 0)&&d.length&&(o=eachBefore(l.children,e,l,o))}),n},eachAfter=(r,e,i,n)=>{let o=n;return r.forEach((l,u)=>{var d;!((d=l.children)===null||d===void 0)&&d.length&&(o=eachAfter(l.children,e,l,o)),o=e(l,u,i,o)}),o},algorithms={binary,dice,slice,sliceDice};class TreemapLayout{constructor(e){var i;this._filterByArea=(l,u)=>{var d;const f=this._getMinAreaByDepth(l.depth);if(f>0&&l.value*u<f)return!1;if(!((d=l.children)===null||d===void 0)&&d.length){const g=l.children.filter(_=>this._filterByArea(_,u));g.length?g.length!==l.children.length&&(l.children=g):(l.isLeaf=!0,l.children=null)}return!0},this._getMinAreaByDepth=l=>{var u;return l<0?0:(u=isArray(this.options.minVisibleArea)?this.options.minVisibleArea[l]:this.options.minVisibleArea)!==null&&u!==void 0?u:0},this._getGapWidthByDepth=l=>{var u;return l<0?0:(u=isArray(this.options.gapWidth)?this.options.gapWidth[l]:this.options.gapWidth)!==null&&u!==void 0?u:0},this._getPaddingByDepth=l=>{var u;return l<0?0:(u=isArray(this.options.padding)?this.options.padding[l]:this.options.padding)!==null&&u!==void 0?u:0},this._getLabelPaddingByDepth=l=>{var u;return l<0?0:(u=isArray(this.options.labelPadding)?this.options.labelPadding[l]:this.options.labelPadding)!==null&&u!==void 0?u:0},this._layoutNode=l=>{const u=this._getGapWidthByDepth(l.depth);let d=l.x0,f=l.y0,g=l.x1,_=l.y1;if(l.maxDepth=this._maxDepth,u>0&&(d+=u/2,g-=u/2,f+=u/2,_-=u/2,d>g&&(d=(d+g)/2,g=d),f>_&&(f=(f+_)/2,_=f),l.x0=d,l.x1=g,l.y0=f,l.y1=_),l.children){const y=this._getLabelPaddingByDepth(l.depth),b=this._getPaddingByDepth(l.depth);b>0&&b<Math.min(g-d,_-f)/2&&(f+=b,_-=b,d+=b,g-=b),y>0&&(this.options.labelPosition==="top"&&f+y<_?(l.labelRect={x0:d,y0:f,x1:g,y1:f+y},f+=y):this.options.labelPosition==="bottom"&&_-y>f?(l.labelRect={x0:d,y0:_-y,x1:g,y1:_},_-=y):this.options.labelPosition==="left"&&d+y<g?(l.labelRect={x0:d,y0:f,x1:d+y,y1:_},d+=y):this.options.labelPosition==="right"&&g-y>d&&(l.labelRect={x0:g-y,y0:f,x1:g,y1:_},g-=y));const S=this._getGapWidthByDepth(l.depth+1);S>0&&(d-=S/2,g+=S/2,f-=S/2,_+=S/2),this._splitNode(l,d,f,g,_)}},this.options=Object.assign({},TreemapLayout.defaultOpionts,e);const n=this.options.nodeKey,o=isFunction(n)?n:n?field$3(n):null;this._getNodeKey=o,this._splitNode=this.options.splitType==="squarify"?generateSquarify(this.options.aspectRatio):(i=algorithms[this.options.splitType])!==null&&i!==void 0?i:algorithms.binary,this._maxDepth=-1}layout(e,i){var n;if(!e||!e.length)return[];const o="width"in i?{x0:0,x1:i.width,y0:0,y1:i.height,width:i.width,height:i.height}:{x0:Math.min(i.x0,i.x1),x1:Math.max(i.x0,i.x1),y0:Math.min(i.y0,i.y1),y1:Math.max(i.y0,i.y1),width:Math.abs(i.x1-i.x0),height:Math.abs(i.y1-i.y0)},l=[],u=calculateNodeValue$1(e,l,0,-1,null,this._getNodeKey,this.options.valueField);if(this._maxDepth=u.maxDepth,u.sum<=0)return[];const d={flattenIndex:-1,maxDepth:-1,key:"-1",depth:-1,index:-1,value:u.sum,datum:null,x0:o.x0,x1:o.x1,y0:o.y0,y1:o.y1,children:l},f=o.width*o.height/u.sum;return this._filterByArea(d,f),this._layout(d),(n=d.children)!==null&&n!==void 0?n:[]}_filterChildren(e){const i=this.options.maxDepth;if(isNumber(i)&&i>=0&&e.depth>=i)return!1;const n=this.options.minChildrenVisibleArea;if(isNumber(n)&&Math.abs((e.x1-e.x0)*(e.y1-e.y0))<n)return!1;const o=this.options.minChildrenVisibleSize;return!isNumber(o)||!(Math.abs(e.x1-e.x0)<o||Math.abs(e.y1-e.y0)<o)}_layout(e){var i;this._filterChildren(e)||(e.children=null,e.isLeaf=!0),this._layoutNode(e),!((i=e.children)===null||i===void 0)&&i.length&&e.children.forEach(n=>{var o;!((o=n==null?void 0:n.children)===null||o===void 0)&&o.length?this._layout(n):this._layoutNode(n)})}}TreemapLayout.defaultOpionts={aspectRatio:(1+Math.sqrt(5))/2,gapWidth:0,labelPadding:0,labelPosition:"top",splitType:"binary",minVisibleArea:10};const transform$1=(r,e)=>{const i=new TreemapLayout(r).layout(e,"width"in r?{width:r.width,height:r.height}:{x0:r.x0,x1:r.x1,y0:r.y0,y1:r.y1});if(r.flatten){const n=[];return flattenNodes(i,n,{maxDepth:r==null?void 0:r.maxDepth}),n}return i},keyMap={x0:"startAngle",x1:"endAngle",y0:"innerRadius",y1:"outerRadius"};class SunburstLayout{constructor(e){this._layoutNode=o=>{if(o.maxDepth=this._maxDepth,o.children){const l=this._parsedInnerRadius[o.depth+1],u=this._parsedOutterRadius[o.depth+1];dice(o,o.startAngle,Math.min(l,u),o.endAngle,Math.max(l,u),keyMap);const d=isArray(this.options.label)?this.options.label[o.depth+1]:this.options.label;o.children.forEach(f=>{if(f.x=this._parsedCenter[0],f.y=this._parsedCenter[1],d)return this._layoutLabel(f,isBoolean(d)?{align:"center",rotate:"radial"}:d)})}},this.options=e?Object.assign({},SunburstLayout.defaultOpionts,e):Object.assign({},SunburstLayout.defaultOpionts);const i=this.options.nodeKey,n=isFunction(i)?i:i?field$3(i):null;this._getNodeKey=n,this._maxDepth=-1}_parseRadius(e,i){const n=e.x0+toPercent(this.options.center[0],e.width),o=e.y0+toPercent(this.options.center[1],e.height),l=Math.min(e.width/2,e.height/2),u=this.options.innerRadius,d=this.options.outerRadius,f=isArray(u),g=f?u.map(v=>toPercent(v,l)):toPercent(u,l),_=isArray(d),y=this.options.gapRadius,b=_?d.map(v=>toPercent(v,l)):toPercent(d,l),S=range(0,i+1);if(f)this._parsedInnerRadius=S.map((v,A)=>{const x=g[A];return isNil(x)?l:x}),this._parsedOutterRadius=S.map((v,A)=>{var x,T;return _?(x=b[A])!==null&&x!==void 0?x:l:A<i?this._parsedInnerRadius[A+1]-(isArray(y)?(T=y[A])!==null&&T!==void 0?T:0:y):b});else if(_)this._parsedOutterRadius=S.map((v,A)=>isNil(b[A])?l:b[A]),this._parsedInnerRadius=S.map((v,A)=>{var x;return A===0?g:this._parsedOutterRadius[A-1]-(isArray(y)?(x=y[A])!==null&&x!==void 0?x:0:y)});else{const v=toPercent(u,l),A=(b-v)/(i+1);this._parsedInnerRadius=S.map((x,T)=>v+T*A),this._parsedOutterRadius=S.map((x,T)=>{var C;return this._parsedInnerRadius[T]+A-(isArray(y)?(C=y[T])!==null&&C!==void 0?C:0:y)})}this._parsedCenter=[n,o],this._maxRadius=l}layout(e,i){const n="width"in i?{x0:0,x1:i.width,y0:0,y1:i.height,width:i.width,height:i.height}:{x0:Math.min(i.x0,i.x1),x1:Math.max(i.x0,i.x1),y0:Math.min(i.y0,i.y1),y1:Math.max(i.y0,i.y1),width:Math.abs(i.x1-i.x0),height:Math.abs(i.y1-i.y0)};if(!e||!e.length)return[];const o=[],l=calculateNodeValue$1(e,o,0,-1,null,this._getNodeKey);return this._parseRadius(n,l.maxDepth),this._maxDepth=l.maxDepth,this._layout(o,{flattenIndex:-1,maxDepth:-1,key:"-1",depth:-1,index:-1,value:l.sum,datum:null,children:o,startAngle:this.options.startAngle,endAngle:this.options.endAngle}),o}_layout(e,i){this._layoutNode(i),e.forEach(n=>{var o;!((o=n==null?void 0:n.children)===null||o===void 0)&&o.length?this._layout(n.children,n):this._layoutNode(n)})}_layoutLabel(e,i){var n;const o=(e.startAngle+e.endAngle)/2,l=(i.align==="start"?e.innerRadius:i.align==="end"?e.outerRadius:(e.innerRadius+e.outerRadius)/2)+((n=i.offset)!==null&&n!==void 0?n:0),u=polarToCartesian({x:this._parsedCenter[0],y:this._parsedCenter[1]},l,o);if(e.label={x:u.x,y:u.y,textBaseline:"middle"},i.rotate==="tangential")e.label.angle=o-Math.PI/2,e.label.textAlign="center",e.label.maxLineWidth=Math.abs(e.endAngle-e.startAngle)*l;else{const d=o%(2*Math.PI),f=d<0?d+2*Math.PI:d;f>Math.PI/2&&f<1.5*Math.PI?(e.label.angle=f+Math.PI,e.label.textAlign=i.align==="start"?"end":i.align==="end"?"start":"center"):(e.label.angle=f,e.label.textAlign=i.align),e.label.maxLineWidth=e.isLeaf?void 0:Math.abs(e.outerRadius-e.innerRadius)}}}SunburstLayout.defaultOpionts={startAngle:Math.PI/2,endAngle:-3*Math.PI/2,center:["50%","50%"],gapRadius:0,innerRadius:0,outerRadius:"70%"};const a=1664525,c=1013904223,m=4294967296;function randomLCG(r=1){let e=r;return()=>(e=(a*e+c)%m)/m}function packEncloseRandom(r,e){let i=0;const n=shuffleArray(Array.from(r),e),o=n.length;let l,u,d=[];for(;i<o;)l=n[i],u&&enclosesWeak(u,l)?++i:(d=extendBasis(d,l),u=encloseBasis(d),i=0);return u}function extendBasis(r,e){let i,n;if(enclosesWeakAll(e,r))return[e];for(i=0;i<r.length;++i)if(enclosesNot(e,r[i])&&enclosesWeakAll(encloseBasis2(r[i],e),r))return[r[i],e];for(i=0;i<r.length-1;++i)for(n=i+1;n<r.length;++n)if(enclosesNot(encloseBasis2(r[i],r[n]),e)&&enclosesNot(encloseBasis2(r[i],e),r[n])&&enclosesNot(encloseBasis2(r[n],e),r[i])&&enclosesWeakAll(encloseBasis3(r[i],r[n],e),r))return[r[i],r[n],e];Logger.getInstance().error("error when packEncloseRandom")}function enclosesNot(r,e){const i=r.radius-e.radius,n=e.x-r.x,o=e.y-r.y;return i<0||i*i<n*n+o*o}function enclosesWeak(r,e){const i=r.radius-e.radius+1e-9*Math.max(r.radius,e.radius,1),n=e.x-r.x,o=e.y-r.y;return i>0&&i*i>n*n+o*o}function enclosesWeakAll(r,e){for(let i=0;i<e.length;++i)if(!enclosesWeak(r,e[i]))return!1;return!0}function encloseBasis(r){switch(r.length){case 1:return encloseBasis1(r[0]);case 2:return encloseBasis2(r[0],r[1]);case 3:return encloseBasis3(r[0],r[1],r[2])}}function encloseBasis1(r){return{x:r.x,y:r.y,radius:r.radius}}function encloseBasis2(r,e){const i=r.x,n=r.y,o=r.radius,l=e.x,u=e.y,d=e.radius,f=l-i,g=u-n,_=d-o,y=Math.sqrt(f*f+g*g);return{x:(i+l+f/y*_)/2,y:(n+u+g/y*_)/2,radius:(y+o+d)/2}}function encloseBasis3(r,e,i){const n=r.x,o=r.y,l=r.radius,u=e.x,d=e.y,f=e.radius,g=i.x,_=i.y,y=i.radius,b=n-u,S=n-g,v=o-d,A=o-_,x=f-l,T=y-l,C=n*n+o*o-l*l,E=C-u*u-d*d+f*f,P=C-g*g-_*_+y*y,L=S*v-b*A,R=(v*P-A*E)/(2*L)-n,w=(A*x-v*T)/L,D=(S*E-b*P)/(2*L)-o,I=(b*T-S*x)/L,O=w*w+I*I-1,B=2*(l+R*w+D*I),N=R*R+D*D-l*l,$=-(Math.abs(O)>1e-6?(B+Math.sqrt(B*B-4*O*N))/(2*O):N/B);return{x:n+R+w*$,y:o+D+I*$,radius:$}}function place(r,e,i){const n=r.x-e.x;let o,l;const u=r.y-e.y;let d,f;const g=n*n+u*u;g?(l=e.radius+i.radius,l*=l,f=r.radius+i.radius,f*=f,l>f?(o=(g+f-l)/(2*g),d=Math.sqrt(Math.max(0,f/g-o*o)),i.x=r.x-o*n-d*u,i.y=r.y-o*u+d*n):(o=(g+l-f)/(2*g),d=Math.sqrt(Math.max(0,l/g-o*o)),i.x=e.x+o*n-d*u,i.y=e.y+o*u+d*n)):(i.x=e.x+i.radius,i.y=e.y)}function intersects(r,e){const i=r.radius+e.radius-1e-6,n=e.x-r.x,o=e.y-r.y;return i>0&&i*i>n*n+o*o}function score(r){const e=r._,i=r.next._,n=e.radius+i.radius,o=(e.x*i.radius+i.x*e.radius)/n,l=(e.y*i.radius+i.y*e.radius)/n;return o*o+l*l}function getCicleNode(r){return{_:r,next:null,prev:null}}function packSiblingsRandom(r,e){const i=(r=array(r)).length;if(!i)return 0;let n=r[0];if(n.x=0,n.y=0,i===1)return n.radius;const o=r[1];if(n.x=-o.radius,o.x=n.radius,o.y=0,i===2)return n.radius+o.radius;let l=r[2];place(o,n,l);let u,d,f,g,_,y,b,S=getCicleNode(n),v=getCicleNode(o),A=getCicleNode(l);S.next=v,A.prev=v,v.next=A,S.prev=A,A.next=S,v.prev=S;for(let T=3;T<i;++T){b=!1,l=r[T],place(S._,v._,l),A=getCicleNode(l),u=v.next,d=S.prev,f=v._.radius,g=S._.radius;do if(f<=g){if(intersects(u._,A._)){v=u,S.next=v,v.prev=S,--T,b=!0;break}f+=u._.radius,u=u.next}else{if(intersects(d._,A._)){S=d,S.next=v,v.prev=S,--T,b=!0;break}g+=d._.radius,d=d.prev}while(u!==d.next);if(!b){for(A.prev=S,A.next=v,S.next=v.prev=v=A,_=score(S),A=A.next;A!==v;)y=score(A),y<_&&(S=A,_=y),A=A.next;v=S.next}}const x=[v._];for(A=v.next;A!==v;)x.push(A._),A=A.next;l=packEncloseRandom(x,e);for(let T=0;T<i;++T)n=r[T],n.x-=l.x,n.y-=l.y;return l.radius}function radiusLeaf(r){return function(e){e.children||(e.radius=Math.max(0,+r(e)||0))}}function packChildrenRandom(r,e,i){return function(n){const o=n==null?void 0:n.children;if(o){let l;const u=o.length,d=r(n)*e||0;if(d)for(l=0;l<u;++l)o[l].radius+=d;const f=packSiblingsRandom(o,i);if(d)for(l=0;l<u;++l)o[l].radius-=d;n.radius=f+d}}}function translateChild(r,e){return function(i,n,o){i.radius*=r,i.maxDepth=e,o&&(i.x=o.x+r*i.x,i.y=o.y+r*i.y)}}class CirclePackingLayout{constructor(e){this.options=e;const i=e==null?void 0:e.nodeKey,n=isFunction(i)?i:i?field$3(i):null;this._getNodeKey=n,this._getPadding=isNumber(e==null?void 0:e.padding)?o=>e.padding:isArray(e==null?void 0:e.padding)?o=>{var l;return(l=e.padding[o.depth+1])!==null&&l!==void 0?l:0}:()=>0,this._maxDepth=-1}layout(e,i){var n;const o="width"in i?{x0:0,x1:i.width,y0:0,y1:i.height,width:i.width,height:i.height}:{x0:Math.min(i.x0,i.x1),x1:Math.max(i.x0,i.x1),y0:Math.min(i.y0,i.y1),y1:Math.max(i.y0,i.y1),width:Math.abs(i.x1-i.x0),height:Math.abs(i.y1-i.y0)};if(!e||!e.length)return[];const l=[],u=calculateNodeValue$1(e,l,0,-1,null,this._getNodeKey);this._maxDepth=u.maxDepth;const d=randomLCG(),f={flattenIndex:-1,maxDepth:-1,key:"root",depth:-1,index:-1,value:u.sum,datum:null,children:l,x:o.x0+o.width/2,y:o.y0+o.height/2},{nodeSort:g,setRadius:_,padding:y,includeRoot:b}=(n=this.options)!==null&&n!==void 0?n:{};if(g!==!1){const S=isFunction(g)?this.options.nodeKey:CirclePackingLayout.defaultOpionts.nodeSort;eachBefore([f],v=>{v.children&&v.children.length&&v.children.sort(S)})}if(_)eachBefore([f],radiusLeaf(_)),eachAfter([f],packChildrenRandom(this._getPadding,.5,d)),eachBefore([f],translateChild(1,this._maxDepth));else{const S=Math.min(o.width,o.height);eachBefore([f],radiusLeaf(CirclePackingLayout.defaultOpionts.setRadius)),eachAfter([f],packChildrenRandom(zero,1,d)),y&&eachAfter([f],packChildrenRandom(this._getPadding,f.radius/S,d)),eachBefore([f],translateChild(S/(2*f.radius),this._maxDepth))}return b?[f]:l}}CirclePackingLayout.defaultOpionts={setRadius:r=>Math.sqrt(r.value),padding:0,nodeSort:(r,e)=>e.value-r.value};const registerTreemapTransforms=()=>{Factory.registerTransform("treemap",{transform:transform$1,markPhase:"beforeJoin"},!0)},flatten=(r,e={})=>{if(!r)return[];const i=[];return flattenNodes(r,i,e),i},sunburstLayout=(r,e)=>{if(!r)return r;const i=e(),{width:n,height:o}=i;return new SunburstLayout(i).layout(r,{width:n,height:o})},SUNBURST_AUTO_VISIBLE_DEFAULT_THRESHOLD=10;class SunburstTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.markTooltipKeyCallback=e=>e==null?void 0:e[this.series.getDimensionField()[0]]}}var DrillEnum;(function(r){r.DrillDown="drillDown",r.DrillUp="drillUp"})(DrillEnum||(DrillEnum={}));const drillFilter=(r,e)=>{const i=e.info(),n=e.keyField(),o=i==null?void 0:i.key;if(isNil(o))return r;if(i.type===DrillEnum.DrillDown){const l=findHierarchyNode(r,o,n,"children");return array(l)}if(i.type===DrillEnum.DrillUp){const l=findHierarchyNodeParent(r,o,n,"children");if(l)return array(l)}return r};class Drillable{_getDrillTriggerEvent(e){var i;const{mode:n}=this._drillParams;return(i=getDefaultTriggerEventByMode(n))===null||i===void 0?void 0:i[e]}_hideTooltip(){const e=this.getChart().getComponentsByType(ComponentTypeEnum.tooltip)[0];e&&e.hideTooltip()}initDrillable(e){this._drillParams=e}initDrillableData(e){const{getRawData:i}=this._drillParams;registerDataSetInstanceTransform(e,"drillFilter",drillFilter),i().transform({type:"drillFilter",options:{info:()=>this._drillInfo,keyField:()=>this._drillParams.drillField()}})}bindDrillEvent(){const{event:e,getRawData:i,drillField:n}=this._drillParams,o=n();this._getDrillTriggerEvent("start")&&e.on(this._getDrillTriggerEvent("start"),l=>{var u,d,f;if(isNil(l.datum)||isNil((u=l.datum)===null||u===void 0?void 0:u[o]))return void this.drillUp();this._hideTooltip();const g=l.datum[o],_=(f=(d=this._drillInfo)===null||d===void 0?void 0:d.path)!==null&&f!==void 0?f:[],y=findHierarchyPath(i().rawData,g,o,"children");_[_.length-1]===y[y.length-1]?this.drillUp():this.drillDown(y)})}drillDown(e=[]){const{getRawData:i,event:n}=this._drillParams;if(!isArray(e)||isEmpty(e))return e;const o=e[e.length-1];return this._drillInfo={key:o,path:e,type:DrillEnum.DrillDown},i().reRunAllTransform(),n.emit(ChartEvent.drill,{value:{path:e,type:DrillEnum.DrillDown},model:this}),e}drillUp(){var e,i;const{getRawData:n,event:o}=this._drillParams,l=(i=(e=this._drillInfo)===null||e===void 0?void 0:e.path)!==null&&i!==void 0?i:[];if(!isArray(l)||isEmpty(l))return l;const u=l.pop();return this._drillInfo={key:u,path:l,type:DrillEnum.DrillUp},n().reRunAllTransform(),o.emit(ChartEvent.drill,{value:{path:l,type:DrillEnum.DrillUp},model:this}),l}}const sunburstSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{sunburst:{name:"sunburst",type:"arc"}}),appendHierarchyFields=(r,e,i)=>(r.push({key:e,operations:["values"]}),r.push({key:i,operations:["max","min"]}),r.push({key:DEFAULT_HIERARCHY_DEPTH,operations:["max","min","values"]}),r.push({key:DEFAULT_HIERARCHY_ROOT,operations:["values"]}),r);class SunburstSeries extends PolarSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.sunburst}setCategoryField(e){return this._categoryField=e,this._categoryField}getCategoryField(){return this._categoryField}setValueField(e){return this._valueField=e,this._valueField}getValueField(){return this._valueField}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}setAttrFromSpec(){var e;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((e=this._spec.seriesField)!==null&&e!==void 0?e:DEFAULT_HIERARCHY_ROOT),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var i;return(i=this._spec.drillField)!==null&&i!==void 0?i:DEFAULT_DATA_KEY},getRawData:()=>this.getRawData()}),this._startAngle=degreeToRadian(this._spec.startAngle),this._endAngle=degreeToRadian(this._spec.endAngle),this._centerX=this._spec.centerX,this._centerY=this._spec.centerY,this._offsetX=this._spec.offsetX,this._offsetY=this._spec.offsetY,this.__innerRadius=this._spec.innerRadius,this.__outerRadius=this._spec.outerRadius,this._gap=this._spec.gap,this._labelLayout=this._spec.labelLayout,this._sunburst=this._spec.sunburst,this._label=this._spec.label,this._labelAutoVisible=this._spec.labelAutoVisible}initData(){super.initData();const e=this.getRawData();e&&(this._spec.drill&&this.initDrillableData(this._dataSet),registerDataSetInstanceTransform(this._dataSet,"sunburstLayout",sunburstLayout),registerDataSetInstanceTransform(this._dataSet,"flatten",flatten),e.transform({type:"sunburstLayout",options:()=>{const{innerRadius:i,outerRadius:n,gap:o,label:l}=this._computeLevel();return{nodeKey:this._categoryField,width:this.getLayoutRect().width,height:this.getLayoutRect().height,center:[isValid(this._centerX)?this._centerX:this.getLayoutRect().width/2,isValid(this._centerY)?this._centerY:this.getLayoutRect().height/2],startAngle:this._startAngle,endAngle:this._endAngle,innerRadius:i,outerRadius:n,gapRadius:o,label:l}}}),e.transform({type:"flatten",options:{callback:i=>{if(i.datum){const n=i.datum[i.depth];return Object.assign(Object.assign({},i),n)}return i}}}))}getStatisticFields(){return appendHierarchyFields(super.getStatisticFields(),this._categoryField,this._valueField)}_addDataIndexAndKey(){const e=this.getRawData();isNil(e==null?void 0:e.dataSet)||(registerDataSetInstanceTransform(e.dataSet,"addVChartProperty",addVChartProperty),e.transform({type:"addVChartProperty",options:{beforeCall:initHierarchyKeyMap.bind(this),call:addHierarchyDataKey}}))}initMark(){this._initArcMark(),this._initLabelMark()}initMarkStyle(){this._initArcMarkStyle(),this._initLabelMarkStyle()}_initArcMark(){var e,i;if(this._sunburst.visible===!1)return;const n=this._createMark(SunburstSeries.mark.sunburst,{isSeriesMark:!0,stateSort:(e=this._spec.sunburst)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.sunburst)===null||i===void 0?void 0:i.customShape});this._sunburstMark=n}_initArcMarkStyle(){isNil(this._sunburstMark)||this.setMarkStyle(this._sunburstMark,{x:e=>e.x+(isValid(this._offsetX)?this._offsetX:0),y:e=>e.y+(isValid(this._offsetY)?this._offsetY:0),outerRadius:e=>e.outerRadius,innerRadius:e=>e.innerRadius,startAngle:e=>e.startAngle,endAngle:e=>e.endAngle,fill:this.getColorAttribute()},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}_initLabelMark(){if(this._label.visible!==!0)return;const e=this._createMark(SunburstSeries.mark.label,{isSeriesMark:!1});this._labelMark=e}_initLabelMarkStyle(){isNil(this._labelMark)||this.setMarkStyle(this._labelMark,{visible:e=>{var i;const n=this._labelAutoVisible;return isObject$1(n)&&n.enable===!0?(e.endAngle-e.startAngle)*(e.outerRadius-e.innerRadius)>((i=n==null?void 0:n.circumference)!==null&&i!==void 0?i:SUNBURST_AUTO_VISIBLE_DEFAULT_THRESHOLD):this._spec.label.visible},x:e=>{var i;return((i=e.label)===null||i===void 0?void 0:i.x)+(isValid(this._offsetX)?this._offsetX:0)},y:e=>{var i;return((i=e.label)===null||i===void 0?void 0:i.y)+(isValid(this._offsetY)?this._offsetY:0)},textBaseline:e=>{var i;return(i=e.label)===null||i===void 0?void 0:i.textBaseline},textAlign:e=>{var i;return(i=e.label)===null||i===void 0?void 0:i.textAlign},angle:e=>{var i,n;return(n=(i=e.label)===null||i===void 0?void 0:i.angle)!==null&&n!==void 0?n:0},fontSize:10,text:e=>e.name},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}initTooltip(){this._tooltipHelper=new SunburstTooltipHelper(this),this._sunburstMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._sunburstMark),this._labelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._labelMark)}initAnimation(){var e,i;const n={animationInfo:()=>({innerRadius:this._computeRadius(array(this.__innerRadius))[0],outerRadius:this._computeRadius(array(this.__outerRadius))[0],startAngle:array(this._startAngle)[0],endAngle:array(this._endAngle)[0]})},o=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this.getMarksInType("arc").forEach(l=>{var u;l.setAnimationConfig(animationConfig((u=Factory$1.getAnimationInKey("sunburst"))===null||u===void 0?void 0:u(n,o),userAnimationConfig(l.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("text").forEach(l=>{var u;l.setAnimationConfig(animationConfig((u=Factory$1.getAnimationInKey("fadeInOut"))===null||u===void 0?void 0:u(),userAnimationConfig(l.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.drill&&this.bindDrillEvent()}onLayoutEnd(e){super.onLayoutEnd(e),this._rawData.reRunAllTransform()}_computeRadius(e){return isArray(e)?e.map(i=>this._computeLayoutRadius()*i):this._computeLayoutRadius()*e}_computeLevel(){return{innerRadius:this._computeRadius(this.__innerRadius),outerRadius:this._computeRadius(this.__outerRadius),gap:this._gap,label:this._labelLayout}}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(e,i){}getActiveMarks(){return[this._sunburstMark]}getMarkData(e){return e!=null&&e.datum?e.datum[e.datum.length-1]:e}}SunburstSeries.type=SeriesTypeEnum.sunburst,SunburstSeries.mark=sunburstSeriesMark,mixin(SunburstSeries,Drillable);const registerSunBurstSeries=()=>{Factory$1.registerSeries(SunburstSeries.type,SunburstSeries),registerArcMark(),registerTextMark(),registerFadeInOutAnimation(),registerSunburstAnimation()},circlePackingLayout=(r,e)=>{if(!r)return r;const i=e(),{width:n,height:o}=i;return n===0||o===0?r:new CirclePackingLayout(i).layout(r,{width:n,height:o})};class CirclePackingTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.markTooltipKeyCallback=e=>e==null?void 0:e[this.series.getDimensionField()[0]]}}const circlePackingPresetAnimation=r=>r==="fadeIn"?{type:"fadeIn"}:{type:"growRadiusIn"},registerCirclePackingAnimation=()=>{Factory$1.registerAnimation("circlePacking",(r,e)=>({appear:circlePackingPresetAnimation(e),enter:{type:"growRadiusIn"},exit:{type:"growRadiusOut"},disappear:{type:"growRadiusOut"}}))},circlePackingSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{circlePacking:{name:"circlePacking",type:"arc"}});class CirclePackingSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.circlePacking}setCategoryField(e){return this._categoryField=e,this._categoryField}getCategoryField(){return this._categoryField}setValueField(e){return this._valueField=e,this._valueField}getValueField(){return this._valueField}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}setAttrFromSpec(){var e;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((e=this._spec.seriesField)!==null&&e!==void 0?e:DEFAULT_HIERARCHY_ROOT),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var i;return(i=this._spec.drillField)!==null&&i!==void 0?i:DEFAULT_DATA_KEY},getRawData:()=>this.getRawData()}),this._circlePacking=this._spec.circlePacking,this._label=this._spec.label,this._layoutPadding=this._spec.layoutPadding}initData(){super.initData();const e=this.getRawData();isNil(e)||(this._spec.drill&&this.initDrillableData(this._dataSet),registerDataSetInstanceTransform(this._dataSet,"circlePackingLayout",circlePackingLayout),registerDataSetInstanceTransform(this._dataSet,"flatten",flatten),e.transform({type:"circlePackingLayout",options:()=>({nodeKey:this._categoryField,padding:this._layoutPadding,includeRoot:!1,width:this.getLayoutRect().width||1,height:this.getLayoutRect().height||1})}),e.transform({type:"flatten",options:{callback:i=>{if(i.datum){const n=i.datum[i.depth];return Object.assign(Object.assign({},i),n)}return i}}}))}_addDataIndexAndKey(){const e=this.getRawData();isNil(e==null?void 0:e.dataSet)||(registerDataSetInstanceTransform(e.dataSet,"addVChartProperty",addVChartProperty),e.transform({type:"addVChartProperty",options:{beforeCall:initHierarchyKeyMap.bind(this),call:addHierarchyDataKey}}))}initMark(){this._initCirclePackingMark(),this._initLabelMark()}initMarkStyle(){this._initCirclePackingMarkStyle(),this._initLabelMarkStyle()}_initCirclePackingMark(){var e,i;if(((e=this._circlePacking)===null||e===void 0?void 0:e.visible)===!1)return;const n=this._createMark(CirclePackingSeries.mark.circlePacking,{isSeriesMark:!0},{setCustomizedShape:(i=this._spec.circlePacking)===null||i===void 0?void 0:i.customShape});this._circlePackingMark=n}_initCirclePackingMarkStyle(){isNil(this._circlePackingMark)||this.setMarkStyle(this._circlePackingMark,{x:e=>e.x,y:e=>e.y,outerRadius:e=>e.radius,innerRadius:0,startAngle:0,endAngle:2*Math.PI,fill:this.getColorAttribute(),zIndex:e=>e.depth},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}_initLabelMark(){var e;if(((e=this._label)===null||e===void 0?void 0:e.visible)===!1)return;const i=this._createMark(CirclePackingSeries.mark.label,{isSeriesMark:!1});this._labelMark=i}_initLabelMarkStyle(){isNil(this._labelMark)||this.setMarkStyle(this._labelMark,{x:e=>e.x,y:e=>e.y,text:e=>e.key,cursor:"pointer"},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}getStatisticFields(){return appendHierarchyFields(super.getStatisticFields(),this._categoryField,this._valueField)}initTooltip(){this._tooltipHelper=new CirclePackingTooltipHelper(this),this._circlePackingMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._circlePackingMark),this._labelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._labelMark)}initAnimation(){var e;const i=(e=this._spec.animationAppear)===null||e===void 0?void 0:e.preset;this.getMarksInType("arc").forEach(n=>{var o;n.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("circlePacking"))===null||o===void 0?void 0:o(void 0,i),userAnimationConfig(n.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("text").forEach(n=>{var o;n.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("scaleInOut"))===null||o===void 0?void 0:o(),userAnimationConfig(n.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.drill&&this.bindDrillEvent()}onLayoutEnd(e){super.onLayoutEnd(e),this._rawData.reRunAllTransform()}_noAnimationDataKey(e,i){}getActiveMarks(){return[this._circlePackingMark]}getMarkData(e){return e!=null&&e.datum?e.datum[e.datum.length-1]:e}}CirclePackingSeries.type=SeriesTypeEnum.circlePacking,CirclePackingSeries.mark=circlePackingSeriesMark,mixin(CirclePackingSeries,Drillable);const registerCirclePackingSeries=()=>{Factory$1.registerSeries(CirclePackingSeries.type,CirclePackingSeries),registerArcMark(),registerTextMark(),registerScaleInOutAnimation(),registerCirclePackingAnimation()},calculateNodeValue=r=>{let e=0;return r.forEach((i,n)=>{var o;isNil(i.value)&&(!((o=i.children)===null||o===void 0)&&o.length?i.value=calculateNodeValue(i.children):i.value=0),e+=Math.abs(i.value)}),e};function left(r){return r.depth}function right(r,e){return e-1-r.endDepth}function justify(r,e){return r.sourceLinks.length?r.depth:e-1}function center(r,e,i){return r.targetLinks.length?r.depth:r.sourceLinks.length?minInArray(r.sourceLinks.map(n=>i[n.target].depth))-1:0}const ascendingNodeBreadth=(r,e)=>(r==null?void 0:r.y0)-(e==null?void 0:e.y0),calcDivideValue=(r,e)=>{if(isNil(r.value))return null;const i=(e?r.targetLinks:r.sourceLinks).reduce((n,o)=>(isNil(o.value)?n.count+=1:n.sum+=o.value,n),{sum:0,count:0});return i.count>0?(r.value-i.sum)/i.count:null},alignFunctions={left,right,justify,center,start:left,end:right},linkClampe=clamper(0,1);class SankeyLayout{constructor(e){this._ascendingSourceBreadth=(o,l)=>ascendingNodeBreadth(this._nodeMap[o.source],this._nodeMap[l.source])||o.index-l.index,this._ascendingTargetBreadth=(o,l)=>ascendingNodeBreadth(this._nodeMap[o.target],this._nodeMap[l.target])||o.index-l.index,this.options=Object.assign({},SankeyLayout.defaultOptions,e);const i=this.options.nodeKey,n=isFunction(i)?i:i?field$3(i):null;this._getNodeKey=n,this._logger=Logger.getInstance(),this._alignFunc=isFunction(this.options.setNodeLayer)?o=>this.options.setNodeLayer(o.datum):alignFunctions[this.options.nodeAlign]}layout(e,i){if(!e)return null;const n="width"in i?{x0:0,x1:i.width,y0:0,y1:i.height,width:i.width,height:i.height}:{x0:Math.min(i.x0,i.x1),x1:Math.max(i.x0,i.x1),y0:Math.min(i.y0,i.y1),y1:Math.max(i.y0,i.y1),width:Math.abs(i.x1-i.x0),height:Math.abs(i.y1-i.y0)};isVertical$1(this.options.direction)?this._viewBox={x0:n.y0,x1:n.y1,y0:n.x0,y1:n.x1,width:n.height,height:n.width}:this._viewBox=n;const o=this.computeNodeLinks(e),l=o.nodes;let u=o.links;if(this._nodeMap=o.nodeMap,this.computeNodeValues(l),this.computeNodeDepths(l),["right","end","justify"].includes(this.options.nodeAlign)&&this.computeNodeEndDepths(l),this._maxDepth<=1)return null;const d=this.computeNodeBreadths(l);if(this.computeLinkBreadths(l),l.forEach(f=>{f.sourceLinks=f.sourceLinks.filter(g=>!isNil(g.source)&&!isNil(g.target)),f.targetLinks=f.targetLinks.filter(g=>!isNil(g.source)&&!isNil(g.target))}),u=u.filter(f=>!isNil(f.source)&&!isNil(f.target)),isVertical$1(this.options.direction))if(this.options.inverse){const f=this._viewBox.x1;l.forEach(g=>{const{y0:_,y1:y,x0:b,x1:S}=g;g.y0=f-S,g.y1=f-b,g.x0=_,g.x1=y}),u.forEach(g=>{g.vertical=!0;const{x0:_,x1:y,y0:b,y1:S}=g;g.x0=b,g.x1=S,g.y0=f-_,g.y1=f-y})}else l.forEach(f=>{const{y0:g,y1:_}=f;f.y0=f.x0,f.y1=f.x1,f.x0=g,f.x1=_}),u.forEach(f=>{f.vertical=!0;const g=f.x0,_=f.x1;f.x0=f.y0,f.x1=f.y1,f.y0=g,f.y1=_});else this.options.inverse&&(l.forEach(f=>{const{x0:g,x1:_}=f;f.x0=n.x1-_,f.x1=n.x1-g}),u.forEach(f=>{f.x0=n.x1-f.x0,f.x1=n.x1-f.x1}));return u.forEach(f=>{const g=this._nodeMap[f.source],_=this._nodeMap[f.target];f.sourceRect={x0:g.x0,x1:g.x1,y0:g.y0,y1:g.y1},f.targetRect={x0:_.x0,x1:_.x1,y1:_.y1,y0:_.y0}}),{nodes:l,links:u,columns:d}}computeHierarchicNodeLinks(e){const i=[],n=[],o={},l={},u=[];calculateNodeValue(e);const d=(f,g,_)=>{f.forEach((y,b)=>{const S=this._getNodeKey?this._getNodeKey(y):_?`${_[_.length-1].key}-${b}`:`${g}-${b}`,v=isNil(y.value)?0:toValidNumber$1(y.value);if(o[S])o[S].value=void 0;else{const A={depth:g,datum:y,index:b,key:S,value:v,sourceLinks:[],targetLinks:[]};o[S]=A,i.push(A)}_&&u.push({source:_[_.length-1].key,target:S,value:v,parents:_}),y.children&&y.children.length&&d(y.children,g+1,_?_.concat([o[S]]):[o[S]])})};return d(e,0,null),u.forEach((f,g)=>{const _=`${f.source}-${f.target}`,y=pickWithout(f,["parents"]);if(y.parents=f.parents.map(S=>pickWithout(S,["sourceLinks","targetLinks"])),l[_])return l[_].value+=toValidNumber$1(f.value),void l[_].datum.push(y);const b={index:g,key:`${f.source}-${f.target}`,source:f.source,target:f.target,datum:[y],value:f.value,parents:f.parents.map(S=>S.key)};n.push(b),o[f.source].sourceLinks.push(b),o[f.target].targetLinks.push(b),l[_]=b}),{nodes:i,links:n,nodeMap:o}}computeSourceTargetNodeLinks(e){const i=[],n=[],o={};e.nodes&&e.nodes.forEach((u,d)=>{const f={depth:-1,datum:u,index:d,key:this._getNodeKey?this._getNodeKey(u):d,value:u.value,sourceLinks:[],targetLinks:[]};o[f.key]=f,i.push(f)});const l=[];return e.links.forEach((u,d)=>{const f=!isNil(u.source),g=!isNil(u.target);if(e.nodes&&(!o[u.source]||!o[u.target]))return;e.nodes||!f||o[u.source]||(o[u.source]={value:void 0,depth:-1,index:i.length,key:u.source,datum:null,sourceLinks:[],targetLinks:[]},i.push(o[u.source])),e.nodes||!g||o[u.target]||(o[u.target]={value:void 0,depth:-1,index:i.length,key:u.target,datum:null,sourceLinks:[],targetLinks:[]},i.push(o[u.target]));const _={index:d,source:u.source,target:u.target,datum:u,value:u.value};this.options.divideNodeValueToLink&&isNil(u.value)&&l.push(_),n.push(_),f&&o[u.source].sourceLinks.push(_),g&&o[u.target].targetLinks.push(_)}),this.options.divideNodeValueToLink&&l.length&&l.forEach(u=>{const d=[calcDivideValue(o[u.source]),calcDivideValue(o[u.target],!0)].filter(f=>!isNil(f));d.length&&(u.value=minInArray(d))}),{nodeMap:o,nodes:i,links:n}}computeNodeLinks(e){let i;"links"in e?i=this.computeSourceTargetNodeLinks(e):(this._isHierarchic=!0,i=this.computeHierarchicNodeLinks(e.nodes));let n=i.nodes;const o=i.links;if(this.options.linkSortBy)for(let l=0,u=n.length;l<u;l++)n[l].sourceLinks.sort(this.options.linkSortBy),n[l].targetLinks.sort(this.options.linkSortBy);return this.options.dropIsolatedNode&&(n=n.filter(l=>l.targetLinks.length||l.sourceLinks.length)),{nodes:n,links:o,nodeMap:i.nodeMap}}computeNodeValues(e){for(let i=0,n=e.length;i<n;i++){const o=e[i];o.value=Math.max(isNil(o.value)?0:toValidNumber$1(o.value),o.sourceLinks.reduce((l,u)=>{var d;return l+((d=toValidNumber$1(u.value))!==null&&d!==void 0?d:0)},0),o.targetLinks.reduce((l,u)=>{var d;return l+((d=toValidNumber$1(u.value))!==null&&d!==void 0?d:0)},0))}}computeNodeDepths(e){const i=e.length;let n,o,l=e,u=0;for(;l.length&&u<i;){n=[],o={};for(let d=0,f=l.length;d<f;d++){const g=l[d];if(g&&(g.depth=u,g.sourceLinks&&g.sourceLinks.length))for(let _=0,y=g.sourceLinks.length;_<y;_++){const b=g.sourceLinks[_];o[b.target]||(n.push(this._nodeMap[b.target]),o[b.target]=!0)}}l=n,u+=1}u>i&&this._logger.warn("Error: there is a circular link"),this._maxDepth=u}computeNodeEndDepths(e){const i=e.length;let n,o,l=e,u=0;for(;l.length&&u<i;){n=[],o={};for(let d=0,f=l.length;d<f;d++){const g=l[d];if(g){g.endDepth=u;for(let _=0,y=g.targetLinks.length;_<y;_++){const b=g.targetLinks[_];o[b.source]||(n.push(this._nodeMap[b.source]),o[b.source]=!0)}}}l=n,u+=1}u>i&&this._logger.warn("Error: there is a circular link")}computeNodeLayers(e){const i=this.options.nodeWidth,n=this.options.linkWidth,o=this.options.minStepWidth,l=this._viewBox.width;let u=null,d=null,f=!1;if(isString(i)){const _=clamp(parseFloat(i.replace("%",""))/100,0,1);let y=l/(this._maxDepth-1+_);o>0&&(y=Math.max(o,y)),u=y*_,d=y*(1-_),f=!0}else if(isNumber(i)){if(u=i,isNumber(n))d=n;else if(isNil(n)){let _=(l-i)/(this._maxDepth-1);o>0&&(_=Math.max(o,_)),d=_-i}f=!0}else isFunction(i)&&isNumber(n)&&(d=n);const g=[];for(let _=0,y=e.length;_<y;_++){const b=e[_];b.layer=this._isHierarchic?b.depth:clamp(Math.floor(this._alignFunc(b,this._maxDepth,this._nodeMap)),0,this._maxDepth-1);const S=b.layer;S===this._maxDepth-1&&(b.isLastLayer=!0),f&&(b.x0=this._viewBox.x0+S*(u+d),b.x1=b.x0+u),g[S]?g[S].push(b):g[S]=[b]}if(this.options.nodeSortBy)for(let _=0,y=g.length;_<y;_++)g[_].sort(this.options.nodeSortBy);if(!f&&isFunction(i)){let _=this._viewBox.x0;for(let y=0;y<this._maxDepth;y++){const b=g[y];let S=0,v=0;for(let A=0,x=b&&b.length;A<x;A++){const T=b[A],C=i(T);T.x0=_,T.x1=_+C,S=Math.max(u,C);const E=T.sourceLinks;for(let P=0,L=E.length;P<L;P++){const R=E[P],w=isFunction(n)?n(R,this._viewBox):d;v=Math.max(v,w)}}_+=S+v}}return g}initializeNodeBreadths(e){var i,n,o;const l=(i=this.options.minLinkHeight)!==null&&i!==void 0?i:0;let u=(n=this.options.minNodeHeight)!==null&&n!==void 0?n:0;const d=(o=this.options.maxNodeHeight)!==null&&o!==void 0?o:1/0;let f=this.options.maxLinkHeight;(isNil(u)||u<l)&&(u=l),(isNil(f)||f>d)&&(f=d);let g=0,_=null,y=null;if(isFunction(this.options.nodeGap))_=this.options.nodeGap,g=e.reduce((x,T)=>{const C=T.reduce((P,L)=>P+L.value,0),E=T.reduce((P,L)=>P+this.options.nodeGap(L),0);return Math.min(x,(this._viewBox.height-E)/C)},1/0);else{const x=e.reduce((E,P)=>Math.max(E,P.length),0),T=this._viewBox.height/x;let C=Math.min(this.options.nodeGap,T);if(u+C>T&&(C=u>=T?T/2:(T-u)/2,u=Math.min(T-C,u)),_=()=>C,this._gapY=C,this.options.equalNodeHeight)y=this._viewBox.height/x-C;else{const E=u>0?Math.max(C,u):C;g=e.reduce((P,L)=>{const R=L.reduce((w,D)=>w+D.value,0);return Math.min(P,(this._viewBox.height-((L.length-1)*E+u))/R)},1/0)}}const b=this.options.gapPosition==="start",S=!b&&this.options.gapPosition!=="end",v=isNumber(this.options.nodeHeight)?x=>this.options.nodeHeight:isFunction(this.options.nodeHeight)?this.options.nodeHeight:y>0?x=>y:x=>Math.max(x.value*g,0),A=isNumber(this.options.linkHeight)?()=>this.options.linkHeight:isFunction(this.options.linkHeight)?this.options.linkHeight:(x,T,C)=>Math.min(Math.max(T.value?C*linkClampe(x.value/T.value):0,l,0),f);for(let x=0,T=e.length;x<T;x++){const C=e[x];if(!C||!C.length)continue;let E=this._viewBox.y0,P=0,L=0,R=0;for(let D=0,I=C.length;D<I;D++){const O=C[D];P=_(O),b&&(E+=P),R=v(O),L=Math.min(Math.max(R,u),d),O.y0=E,O.y1=E+L,E=b?O.y1:O.y1+P;for(let B=0,N=O.sourceLinks.length;B<N;B++){const $=O.sourceLinks[B];$.thickness=A($,O,R)}}let w=this._viewBox.y1-E+(S?P:0);if(w>0){if(this.options.crossNodeAlign!=="start")if(this.options.crossNodeAlign==="end")for(let D=0,I=C.length;D<I;++D){const O=C[D];O.y0+=w,O.y1+=w}else if(this.options.crossNodeAlign==="parent"){const D=C.reduce((I,O)=>(O.targetLinks&&O.targetLinks.length&&O.targetLinks.forEach(B=>{I[B.source]=!0}),I),{});if(Object.keys(D).length&&e[x-1]&&e[x-1].length){const I=e[x-1].filter(O=>D[O.key]);if(I&&I.length&&I[0].y0!==C[0].y0){const O=I[0].y0-C[0].y0;for(let B=0,N=C.length;B<N;++B){const $=C[B];$.y0+=O,$.y1+=O}}}}else{w/=C.length+1;for(let D=0,I=C.length;D<I;++D){const O=C[D];O.y0+=w*(D+1),O.y1+=w*(D+1)}}}else if(w<0&&C.length>1&&(w/=C.length-1,P+w>=0)){P+=w,this._gapY=Math.min(P);for(let D=1,I=C.length;D<I;++D){const O=C[D];O.y0+=w*D,O.y1+=w*D}}this.reorderLinks(C)}}computeNodeBreadths(e){const i=this.computeNodeLayers(e);this.initializeNodeBreadths(i);const n=this.options.iterations;if(!this._isHierarchic&&!isFunction(this.options.setNodeLayer)&&!isFunction(this.options.nodeGap))for(let o=0;o<n;++o){const l=Math.pow(.99,o),u=Math.max(1-l,(o+1)/n);this.relaxRightToLeft(i,l,u),this.relaxLeftToRight(i,l,u)}return i}relaxLeftToRight(e,i,n){for(let o=1,l=e.length;o<l;++o){const u=e[o];for(let d=0,f=u.length;d<f;d++){const g=u[d];let _=0,y=0;for(let S=0,v=g.targetLinks.length;S<v;S++){const A=g.targetLinks[S],x=A.value*(g.layer-this._nodeMap[A.source].layer);_+=this.targetTop(this._nodeMap[A.source],g)*x,y+=x}if(!(y>0))continue;const b=(_/y-g.y0)*i;g.y0+=b,g.y1+=b,this.reorderNodeLinks(g)}isNil(this.options.nodeSortBy)&&u.sort(ascendingNodeBreadth),this.resolveCollisions(u,n)}}relaxRightToLeft(e,i,n){for(let o=e.length-2;o>=0;--o){const l=e[o];for(let u=0,d=l.length;u<d;u++){const f=l[u];let g=0,_=0;for(let b=0,S=f.sourceLinks.length;b<S;b++){const v=f.sourceLinks[b],A=v.value*(this._nodeMap[v.target].layer-f.layer);g+=this.sourceTop(f,this._nodeMap[v.target])*A,_+=A}if(!(_>0))continue;const y=(g/_-f.y0)*i;f.y0+=y,f.y1+=y,this.reorderNodeLinks(f)}this.options.nodeSortBy===void 0&&l.sort(ascendingNodeBreadth),this.resolveCollisions(l,n)}}resolveCollisions(e,i){const n=e.length>>1,o=e[n];this.resolveCollisionsBottomToTop(e,o.y0-this._gapY,n-1,i),this.resolveCollisionsTopToBottom(e,o.y1+this._gapY,n+1,i),this.resolveCollisionsBottomToTop(e,this._viewBox.y1,e.length-1,i),this.resolveCollisionsTopToBottom(e,this._viewBox.y0,0,i)}resolveCollisionsTopToBottom(e,i,n,o){for(;n<e.length;++n){const l=e[n],u=(i-l.y0)*o;u>1e-6&&(l.y0+=u,l.y1+=u),i=l.y1+this._gapY}}resolveCollisionsBottomToTop(e,i,n,o){for(;n>=0;--n){const l=e[n],u=(l.y1-i)*o;u>1e-6&&(l.y0-=u,l.y1-=u),i=l.y0-this._gapY}}targetTop(e,i){let n,o,l,u=e.y0-(e.sourceLinks.length-1)*this._gapY/2;for(n=0,o=e.sourceLinks.length;n<o&&(l=e.sourceLinks[n],l.target!==i.key);n++)u+=l.thickness+this._gapY;for(n=0,o=i.targetLinks.length;n<o&&(l=i.targetLinks[n],l.source!==e.key);n++)u-=l.thickness;return u}sourceTop(e,i){let n,o,l,u=i.y0-(i.targetLinks.length-1)*this._gapY/2;for(n=0,o=i.targetLinks.length;n<o&&(l=i.targetLinks[n],l.source!==e.key);n++)u+=l.thickness+this._gapY;for(n=0,o=e.sourceLinks.length;n<o&&(l=e.sourceLinks[n],l.target!==i.key);n++)u-=l.thickness;return u}computeLinkBreadthsNoOverlap(e){for(let i=0,n=e.length;i<n;i++){const o=e[i];let l=o.y0,u=!1;for(let f=0,g=o.sourceLinks.length;f<g;f++){const _=o.sourceLinks[f];u||(_.y0=l+_.thickness/2),_.x0=o.x1,l+_.thickness>o.y1||u?(_.y0=o.y1-_.thickness/2,u=!0):l+=_.thickness}let d=o.y0;u=!1;for(let f=0,g=o.targetLinks.length;f<g;f++){const _=o.targetLinks[f];u||(_.y1=d+_.thickness/2),_.x1=o.x0,d+_.thickness>o.y1||u?(_.y1=o.y1-_.thickness/2,u=!0):d+=_.thickness}}}computeLinkBreadthsOverlap(e){const i=this.options.linkOverlap;for(let n=0,o=e.length;n<o;n++){const l=e[n],u=i==="start"?l.y0:i==="end"?l.y1:(l.y0+l.y1)/2,d=i==="start"?.5:i==="end"?-.5:0;for(let f=0,g=l.sourceLinks.length;f<g;f++){const _=l.sourceLinks[f];_.y0=u+d*_.thickness,_.x0=l.x1}for(let f=0,g=l.targetLinks.length;f<g;f++){const _=l.targetLinks[f];_.y1=u+d*_.thickness,_.x1=l.x0}}}computeLinkBreadths(e){this.options.linkOverlap?this.computeLinkBreadthsOverlap(e):this.computeLinkBreadthsNoOverlap(e)}reorderNodeLinks(e){if(isNil(this.options.linkSortBy)){const i=e.targetLinks,n=e.sourceLinks;for(let o=0,l=i.length;o<l;o++){const u=i[o];this._nodeMap[u.source].sourceLinks.sort(this._ascendingTargetBreadth)}for(let o=0,l=n.length;o<l;o++){const u=n[o];this._nodeMap[u.target].targetLinks.sort(this._ascendingSourceBreadth)}}}reorderLinks(e){if(isNil(this.options.linkSortBy))for(let i=0,n=e.length;i<n;i++){const o=e[i];o.sourceLinks.sort(this._ascendingTargetBreadth),o.targetLinks.sort(this._ascendingSourceBreadth)}}}SankeyLayout.defaultOptions={iterations:6,nodeAlign:"justify",direction:"horizontal",nodeWidth:24,nodeGap:8,crossNodeAlign:"middle",dropIsolatedNode:!0};const transform=(r,e)=>{const i=new SankeyLayout(r).layout(Array.isArray(e)?e[0]:e,"width"in r?{width:r.width,height:r.height}:{x0:r.x0,x1:r.x1,y0:r.y0,y1:r.y1});return i?[i]:[]},registerSankeyTransforms=()=>{Factory.registerTransform("sankey",{transform,markPhase:"beforeJoin"},!0)},collectHierarchyField=(r,e,i)=>{e.forEach(n=>{isNil(n[i])||r.add(n[i]),n.children&&n.children.length>0&&collectHierarchyField(r,n.children,i)})},sankeyFormat=r=>{var e;if(!r||!isArray(r))return[];if(r.length>1){const i={links:[],nodes:[]};return r.forEach(n=>{n.id!=="links"&&n.id!=="nodes"||(i[n.id]=n.values)}),[i]}return!((e=r[0])===null||e===void 0)&&e.latestData?r[0].latestData:r},sankeyLayout=(r,e)=>{if(!r||!(e!=null&&e.view)||!r.length)return[];const i=e.view();if(i.x1-i.x0==0||i.y1-i.y0==0||i.x1-i.x0==-1/0||i.x1-i.x0==1/0||i.y1-i.y0==-1/0||i.y1-i.y0==1/0)return[];const n=r[0];if((e.sourceField!=="source"||e.targetField!=="target"||e.valueField!=="value")&&n.links){const u=[];n.links.forEach(d=>{const f={};for(const g in d)g===e.sourceField?f.source=d[e.sourceField]:g===e.targetField?f.target=d[e.targetField]:g===e.valueField?f.value=d[e.valueField]:f[g]=d[g];u.push(f)}),n.links=u}const o=new SankeyLayout(e),l=[];return l.push(o.layout(n,i)),l},sankeyNodes=r=>{var e,i;return r&&isArray(r)&&(!((e=r[0])===null||e===void 0)&&e.latestData)&&r[0].latestData.length&&r[0].latestData[0]&&(i=r[0].latestData[0].nodes)!==null&&i!==void 0?i:[]},sankeyLinks=r=>{var e,i;return r&&isArray(r)&&(!((e=r[0])===null||e===void 0)&&e.latestData)&&r[0].latestData.length&&r[0].latestData[0]&&(i=r[0].latestData[0].links)!==null&&i!==void 0?i:[]};class SankeySeriesTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this._getDimensionData=e=>{if(e.source){if(isNumber(e.source)){const i=this.series.getSeriesKeys();return i[e.source]+" => "+i[e.target]}return e.source+" => "+e.target}return e.datum?e.datum[this.series.getSpec().categoryField]:e.key},this.markTooltipValueCallback=e=>e.value}}const sankeyGrowIn=(r,e=!0)=>({type:r.direction==="horizontal"?"growWidthIn":"growHeightIn",options:{overall:e&&r.growFrom(),orient:"positive"}}),sankeyNodePresetAnimation=(r,e)=>e==="fadeIn"?{type:"fadeIn"}:sankeyGrowIn(r),sankeyLinkPresetAnimation=r=>r==="fadeIn"?{type:"fadeIn"}:{type:"linkPathGrowIn"},registerSankeyAnimation=()=>{Factory$1.registerAnimation("sankeyNode",(r,e)=>Object.assign({appear:sankeyNodePresetAnimation(r,e)},FadeInOutAnimation)),Factory$1.registerAnimation("sankeyLinkPath",(r,e)=>({appear:sankeyLinkPresetAnimation(e),enter:{type:"linkPathGrowIn"},exit:{type:"linkPathGrowOut"},disappear:{type:"linkPathGrowOut"}}))};class LinkPathMark extends BaseMark{constructor(){super(...arguments),this.type=LinkPathMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x:0,y:0,x0:0,y0:0,x1:100,y1:100,thickness:1,round:!0})}_initProduct(e){const i=this.getVGrammarView(),n=this.getProductId(),o=this.getStyle("direction");this._product=i.glyph("linkPath",e??i.rootMark).id(n).configureGlyph({direction:o}),this._compiledProductId=n}}LinkPathMark.type="linkPath";const registerLinkPathMark=()=>{registerLinkPathGlyph(),Factory$1.registerMark(LinkPathMark.type,LinkPathMark)},sankeySeriesMark=Object.assign(Object.assign({},baseSeriesMark),{node:{name:"node",type:"rect"},link:{name:"link",type:"linkPath"}});class SankeySeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"node")}}class SankeySeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.sankey,this.transformerConstructor=SankeySeriesSpecTransformer,this._nodeLayoutZIndex=LayoutZIndex.Node,this._labelLayoutZIndex=LayoutZIndex.Label,this._viewBox=new Bounds,this._fillByNode=e=>{var i,n,o,l,u;if(e&&e.sourceRect&&e.targetRect)return this._fillByLink(e);const d=(n=(i=this._spec.node)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.fill;if(isValid(d))return d;if(isValid(this._spec.seriesField)){const f=(l=(o=this._option)===null||o===void 0?void 0:o.globalScale)===null||l===void 0?void 0:l.getScale("color"),g=e!=null&&e.datum?e.datum:e;return f==null?void 0:f.scale(g==null?void 0:g[this._spec.seriesField])}return(u=this._colorScale)===null||u===void 0?void 0:u.scale(this._getNodeNameFromData(e))},this._fillByLink=e=>{var i,n,o,l,u,d,f;const g=(n=(i=this._spec.link)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.fill;if(g)return g;if(isValid(this._spec.seriesField)){const y=(l=(o=this._nodesSeriesData)===null||o===void 0?void 0:o.getLatestData())===null||l===void 0?void 0:l.find(v=>e.source===v.key),b=y==null?void 0:y.datum,S=(d=(u=this._option)===null||u===void 0?void 0:u.globalScale)===null||d===void 0?void 0:d.getScale("color");return S==null?void 0:S.scale(b==null?void 0:b[this._spec.seriesField])}const _=isNumber(e.source)?this.getNodeList()[e.source]:e.source;return(f=this._colorScale)===null||f===void 0?void 0:f.scale(_)},this._handleEmphasisElement=e=>{var i,n,o,l,u;const d=(i=this._spec.emphasis)!==null&&i!==void 0?i:{},f=e.item;d.effect==="adjacency"?f&&f.mark===((n=this._nodeMark)===null||n===void 0?void 0:n.getProduct())?this._handleNodeAdjacencyClick(f):f&&f.mark===((o=this._linkMark)===null||o===void 0?void 0:o.getProduct())?this._handleLinkAdjacencyClick(f):this._handleClearEmpty():d.effect==="related"&&(f&&f.mark===((l=this._nodeMark)===null||l===void 0?void 0:l.getProduct())?this._handleNodeRelatedClick(f):f&&f.mark===((u=this._linkMark)===null||u===void 0?void 0:u.getProduct())?this._handleLinkRelatedClick(f):this._handleClearEmpty())},this._handleClearEmpty=()=>{var e,i;if(!this._needClear)return;const n=(e=this._nodeMark)===null||e===void 0?void 0:e.getProductElements();if(!n||!n.length)return;const o=(i=this._linkMark)===null||i===void 0?void 0:i.getProductElements();if(!o||!o.length)return;const l=[STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE];n.forEach(u=>{u.removeState(l)}),o.forEach(u=>{u.removeState(l)}),this._needClear=!1},this._handleNodeAdjacencyClick=e=>{const i=e.getDatum(),n=[i.key];if(this._linkMark){const o=this._linkMark.getProductElements();if(!o||!o.length)return;o.forEach((l,u)=>{const d=l.getDatum();d.source===i.key?(n.includes(d.target)||n.push(d.target),l.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),l.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS)):d.target===i.key?(n.includes(d.source)||n.push(d.source),l.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),l.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS)):(l.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS),l.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),n),this._needClear=!0},this._handleLinkAdjacencyClick=e=>{const i=e.getDatum(),n=[i.source,i.target];if(this._linkMark){const o=this._linkMark.getProductElements();if(!o||!o.length)return;o.forEach(l=>{l===e?(l.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),l.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,{ratio:1})):(l.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS),l.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),n),this._needClear=!0},this._handleNodeRelatedClick=e=>{var i;const n=e.getDatum(),o=this._nodeMark.getProductElements();if(!o||!o.length)return;const l=this._linkMark.getProductElements();if(!l||!l.length)return;const u=!((i=l[0].getDatum())===null||i===void 0)&&i.parents?"parents":"source";if(u==="source"){const d=[n.key],f=[];if(l.forEach((g,_)=>{var y,b,S,v;const A=g.getDatum(),x=A!=null&&A.parents?"parents":"source";if(array(A[x]).includes(n.key)){if(f.includes((y=A.key)!==null&&y!==void 0?y:A.index)||f.push((b=A.key)!==null&&b!==void 0?b:A.index),d.includes(A.source)||d.push(A.source),!d.includes(A.target)){d.push(A.target);let T=o.find(C=>C.data[0].key===A.target).data[0].sourceLinks;for(;(T==null?void 0:T.length)>0;){const C=[];return T.forEach(E=>{var P,L;if(!f.includes((P=E.key)!==null&&P!==void 0?P:E.index)&&(f.push((L=E.key)!==null&&L!==void 0?L:E.index),!d.includes(E.target))){d.push(E.target);const R=o.find(w=>w.data[0].key===E.target);C.push(R.data[0].targetLinks)}}),void(T=C)}}}else if(A.target===n.key&&(f.includes((S=A.key)!==null&&S!==void 0?S:A.index)||f.push((v=A.key)!==null&&v!==void 0?v:A.index),!d.includes(A.source))){d.push(A.source);let T=o.find(C=>C.data[0].key===A.source).data[0].targetLinks;for(;(T==null?void 0:T.length)>0;){const C=[];return T.forEach(E=>{var P,L;if(!f.includes((P=E.key)!==null&&P!==void 0?P:E.index)&&(f.push((L=E.key)!==null&&L!==void 0?L:E.index),!d.includes(E.source))){d.push(E.source);const R=o.find(w=>w.data[0].key===E.source);C.push(R.data[0].targetLinks)}}),void(T=C)}}}),this._linkMark){const g=this._linkMark.getProductElements();if(!g||!g.length)return;g.forEach((_,y)=>{var b;f.includes((b=_.getDatum().key)!==null&&b!==void 0?b:_.getDatum().index)?(_.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),_.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS)):(_.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS),_.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),d)}else{const d=[n.key],f=n.targetLinks.reduce((g,_)=>(array(_.datum).forEach(y=>{const b=y.parents,S=b.length;for(let v=0;v<S;v++){const A=b[v].key,x=b[v+1]?b[v+1].key:n.key,T=y.value,C=g.find(E=>E.source===A&&E.target===x);C?C.value+=T:g.push({source:A,target:x,value:T})}}),g),[]);l.forEach((g,_)=>{const y=g.getDatum(),b=y.datum,S=b?b.filter(A=>A[u].some(x=>x.key===n.key)):null,v=f.find(A=>A.source===y.source&&A.target===y.target);if(S&&S.length){d.includes(y.source)||d.push(y.source),d.includes(y.target)||d.push(y.target);const A=S.reduce((x,T)=>x+T.value,0)/y.value;return g.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),void g.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,{ratio:A})}if(v)return d.includes(y.source)||d.push(y.source),d.includes(y.target)||d.push(y.target),g.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),void g.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,{ratio:v.value/y.value});g.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS),g.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE)}),this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),d)}this._needClear=!0},this._handleLinkRelatedClick=e=>{var i;const n=this._nodeMark.getProductElements();if(!n||!n.length)return;const o=this._linkMark.getProductElements();if(!(!o||!o.length)){if((!((i=e.getDatum())===null||i===void 0)&&i.parents?"parents":"source")=="source"){const l=[STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE];this._linkMark&&o.forEach(u=>{u.removeState(l)}),this._nodeMark&&n.forEach(u=>{u.removeState(l)})}else{const l=e.getDatum(),u=[l.source,l.target],d=[];array(l.datum).forEach(f=>{const g=f.parents,_=g.length;for(let y=0;y<_-1;y++){const b=g[y].key,S=g[y+1].key,v=f.value,A=d.find(x=>x.source===b&&x.target===S);d.push({source:g[y].key,target:g[y+1].key,value:f.value}),A?A.value+=v:d.push({source:b,target:S,value:v})}}),o.forEach(f=>{const g=f.getDatum(),_=g.datum;if(g.source===l.source&&g.target===l.target)return f.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),void f.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,{ratio:1});const y=_?_.filter(S=>{const v=S.parents.map(A=>A.key);return v.includes(l.source)&&v.includes(l.target)}):null;if(y&&y.length){u.includes(g.source)||u.push(g.source),u.includes(g.target)||u.push(g.target);const S=y.filter(A=>A.parents.some((x,T)=>{var C;return x.key===l.source&&((C=A.parents[T+1])===null||C===void 0?void 0:C.key)===l.target})).reduce((A,x)=>A+x.value,0),v=S/g.value;return f.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),void f.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,{ratio:v})}const b=d.find(S=>S.source===g.source&&S.target===g.target);if(b)return u.includes(g.source)||u.push(g.source),u.includes(g.target)||u.push(g.target),f.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE),void f.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS,{ratio:b.value/g.value});f.removeState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS),f.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE)}),this._highLightElements(n,u)}this._needClear=!0}}}get direction(){var e;return(e=this._spec.direction)!==null&&e!==void 0?e:"horizontal"}getCategoryField(){return this._categoryField}setCategoryField(e){return this._categoryField=e,this._categoryField}getValueField(){return this._valueField}setValueField(e){return this._valueField=e,this._valueField}setAttrFromSpec(){var e;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((e=this._spec.seriesField)!==null&&e!==void 0?e:this._spec.categoryField)}initData(){var e,i,n,o;super.initData();const l=this.getViewData(),u=this.getRawData();if(u&&l){registerDataSetInstanceTransform(this._dataSet,"sankeyLayout",sankeyLayout),registerDataSetInstanceTransform(this._dataSet,"sankeyFormat",sankeyFormat),u.transform({type:"sankeyFormat"},!1),l.transform({type:"sankeyLayout",options:{view:()=>({x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2}),sourceField:this._spec.sourceField,targetField:this._spec.targetField,valueField:this._spec.valueField,direction:this.direction,crossNodeAlign:this._spec.crossNodeAlign,nodeAlign:(e=this._spec.nodeAlign)!==null&&e!==void 0?e:"justify",nodeGap:(i=this._spec.nodeGap)!==null&&i!==void 0?i:8,nodeWidth:(n=this._spec.nodeWidth)!==null&&n!==void 0?n:10,linkWidth:this._spec.linkWidth,minStepWidth:this._spec.minStepWidth,minNodeHeight:(o=this._spec.minNodeHeight)!==null&&o!==void 0?o:4,maxNodeHeight:this._spec.maxNodeHeight,minLinkHeight:this._spec.minLinkHeight,maxLinkHeight:this._spec.maxLinkHeight,iterations:this._spec.iterations,nodeKey:this._spec.nodeKey,linkSortBy:this._spec.linkSortBy,nodeSortBy:this._spec.nodeSortBy,setNodeLayer:this._spec.setNodeLayer,dropIsolatedNode:this._spec.dropIsolatedNode,nodeHeight:this._spec.nodeHeight,linkHeight:this._spec.linkHeight,equalNodeHeight:this._spec.equalNodeHeight,linkOverlap:this._spec.linkOverlap,inverse:this._spec.inverse},level:TransformLevel.sankeyLayout});const{dataSet:d}=this._option;registerDataSetInstanceTransform(d,"sankeyNodes",sankeyNodes),registerDataSetInstanceTransform(d,"flatten",flatten);const f=new DataView(d,{name:`sankey-node-${this.id}-data`});f.parse([this.getViewData()],{type:"dataview"}),f.transform({type:"sankeyNodes"}),f.transform({type:"flatten",options:{callback:_=>{if(_.datum){const y=_.datum[_.depth];return Object.assign(Object.assign({},_),y)}return _}}},!1),f.transform({type:"addVChartProperty",options:{beforeCall:initKeyMap.bind(this),call:addDataKey}},!1),this._nodesSeriesData=new SeriesData(this._option,f),registerDataSetInstanceTransform(d,"sankeyLinks",sankeyLinks);const g=new DataView(d,{name:`sankey-link-${this.id}-data`});g.parse([this.getViewData()],{type:"dataview"}),g.transform({type:"sankeyLinks"}),g.transform({type:"addVChartProperty",options:{beforeCall:initKeyMap.bind(this),call:addDataKey}},!1),this._linksSeriesData=new SeriesData(this._option,g)}}compileData(){var e,i;super.compileData(),(e=this._linksSeriesData)===null||e===void 0||e.compile(),(i=this._nodesSeriesData)===null||i===void 0||i.compile()}initMark(){var e,i,n,o;this._rootMark.setMarkConfig({overflow:this._spec.overflow,interactive:!!this._spec.overflow});const l=this._createMark(SankeySeries.mark.node,{isSeriesMark:!0,dataView:this._nodesSeriesData.getDataView(),dataProductId:this._nodesSeriesData.getProductId(),stateSort:(e=this._spec.node)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.node)===null||i===void 0?void 0:i.customShape});l&&(l.setMarkConfig({zIndex:this._nodeLayoutZIndex}),this._nodeMark=l);const u=this._createMark(SankeySeries.mark.link,{dataView:this._linksSeriesData.getDataView(),dataProductId:this._linksSeriesData.getProductId(),stateSort:(n=this._spec.link)===null||n===void 0?void 0:n.stateSort},{setCustomizedShape:(o=this._spec.link)===null||o===void 0?void 0:o.customShape});u&&(this._linkMark=u)}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToNode=this.valueToNode.bind(this),this._markAttributeContext.valueToLink=this.valueToLink.bind(this)}valueToNode(e){const i=this._nodesSeriesData.getLatestData(),n=array(e)[0];return i&&i.find(o=>o.key===n)}valueToLink(e){const i=this._linksSeriesData.getLatestData(),n=array(e);return i&&i.find(o=>o&&o.source===n[0]&&o.target===n[1])}valueToPositionX(e){const i=this.valueToNode(e);return i==null?void 0:i.x0}valueToPositionY(e){const i=this.valueToNode(e);return i==null?void 0:i.y0}initMarkStyle(){this._initNodeMarkStyle(),this._initLinkMarkStyle()}_initNodeMarkStyle(){var e,i;const n=this._nodeMark;n&&(this.setMarkStyle(n,{x:o=>o.x0,x1:o=>o.x1,y:o=>o.y0,y1:o=>o.y1},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Mark),this.setMarkStyle(n,{fill:(i=(e=this._spec.node.style)===null||e===void 0?void 0:e.fill)!==null&&i!==void 0?i:this._fillByNode},"normal",AttributeLevel.User_Mark))}_initLinkMarkStyle(){var e,i;const n=this._linkMark;n&&(this.setMarkStyle(n,{x0:o=>o.x0,x1:o=>o.x1,y0:o=>o.y0,y1:o=>o.y1,thickness:o=>o.thickness,direction:this.direction},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series),this.setMarkStyle(n,{fill:(i=(e=this._spec.link.style)===null||e===void 0?void 0:e.fill)!==null&&i!==void 0?i:this._fillByLink},"normal",AttributeLevel.User_Mark))}initLabelMarkStyle(e,i){if(!e)return;const n=i.position;n&&n.includes("inside")?this.setMarkStyle(e,{fill:"#ffffff",text:o=>this._createText(o,i),maxLineWidth:o=>{var l;return(l=i.limit)!==null&&l!==void 0?l:o.x1-o.x0}}):this.setMarkStyle(e,{fill:this._fillByNode,text:o=>this._createText(o,i),maxLineWidth:i.limit}),e.setMarkConfig({zIndex:this._labelLayoutZIndex})}_createText(e,i){if(isNil(e)||isNil(e.datum))return"";let n=e.datum[this._spec.categoryField]||"";const{formatMethod:o,formatter:l}=i||{},{formatFunc:u,args:d}=getFormatFunction(o,l,n,e.datum);return u&&(n=u(...d,{series:this})),n}initAnimation(){var e,i,n,o;const l={direction:this.direction,growFrom:()=>{var d,f;return this.direction==="horizontal"?(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale(0).scale(0):(f=this._yAxisHelper)===null||f===void 0?void 0:f.getScale(0).scale(0)}},u=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this._nodeMark&&this._nodeMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("sankeyNode"))===null||n===void 0?void 0:n(l,u),userAnimationConfig("node",this._spec,this._markAttributeContext))),this._linkMark&&this._linkMark.setAnimationConfig(animationConfig((o=Factory$1.getAnimationInKey("sankeyLinkPath"))===null||o===void 0?void 0:o(l,u),userAnimationConfig("link",this._spec,this._markAttributeContext)))}initEvent(){var e,i,n;super.initEvent(),(e=this._nodesSeriesData.getDataView())===null||e===void 0||e.target.addListener("change",this.nodesSeriesDataUpdate.bind(this)),(i=this._linksSeriesData.getDataView())===null||i===void 0||i.target.addListener("change",this.linksSeriesDataUpdate.bind(this));const o=(n=this._spec.emphasis)!==null&&n!==void 0?n:{};if(this._option.disableTriggerEvent!==!0&&o.enable&&(o.effect==="adjacency"||o.effect==="related")){const l=o.trigger==="hover"?"pointerover":"pointerdown";this.event.on(l,{level:Event_Bubble_Level.chart},this._handleEmphasisElement)}}nodesSeriesDataUpdate(){this._nodesSeriesData.updateData(),this._nodeList=null,this._setNodeOrdinalColorScale()}linksSeriesDataUpdate(){this._linksSeriesData.updateData()}_highLightElements(e,i){e&&e.length&&e.forEach(n=>{n.removeState([STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE,STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS]),i.includes(n.getDatum().key)?n.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS):n.addState(STATE_VALUE_ENUM.STATE_SANKEY_EMPHASIS_REVERSE)})}initTooltip(){this._tooltipHelper=new SankeySeriesTooltipHelper(this),this._nodeMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nodeMark),this._linkMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._linkMark)}_setNodeOrdinalColorScale(){var e,i,n,o,l;const u=(i=(e=this._option)===null||e===void 0?void 0:e.globalScale)===null||i===void 0?void 0:i.getScale("color");if(u!=null&&u._specified)return void(this._colorScale=u);let d,f;u&&(d=u.domain(),f=u.range()),f||(f=this._getDataScheme()),d&&!isNil(d[0])||(d=this.getNodeList(),d.length>10&&(f=(n=this._getDataScheme()[1])===null||n===void 0?void 0:n.scheme));const g=new ColorOrdinalScale;(l=(o=g.domain(d)).range)===null||l===void 0||l.call(o,f),this._colorScale=g}getNodeList(){var e,i;if(this._nodeList)return this._nodeList;const n=this._rawData.latestData[0],o=n!=null&&n.nodes?!((e=n.nodes[0])===null||e===void 0)&&e.children?Array.from(this.extractNamesFromTree(n.nodes,this._spec.categoryField)):n.nodes.map((l,u)=>l[this._spec.categoryField]):n!=null&&n.links?Array.from(this.extractNamesFromLink(n.links)):(i=n==null?void 0:n.values)===null||i===void 0?void 0:i.map((l,u)=>l[this._spec.categoryField]);return this._nodeList=o,o}_getNodeNameFromData(e){var i;return e!=null&&e.datum?e.datum[this._spec.categoryField]:(i=e.key)!==null&&i!==void 0?i:e[this._spec.categoryField]}extractNamesFromTree(e,i){const n=new Set;return e.forEach(o=>{n.add(o[i]),o.children&&this.extractNamesFromTree(o.children,i).forEach(l=>n.add(l))}),n}extractNamesFromLink(e){const i=new Set,{sourceField:n,targetField:o}=this._spec;return e.forEach(l=>{isValid(l[n])&&i.add(l[n]),isValid(l[o])&&i.add(l[o])}),i}getDimensionField(){return[this._spec.categoryField]}getMeasureField(){return[this._valueField]}getRawDataStatisticsByField(e,i){var n;return this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[e]&&(this._viewDataStatistics&&this.getViewData().transformsArr.length<=1&&(!((n=this._viewDataStatistics.latestData)===null||n===void 0)&&n[e])?this._rawStatisticsCache[e]=this._viewDataStatistics.latestData[e]:this._rawData&&(this._rawStatisticsCache[e]={values:this._collectByField(e)})),this._rawStatisticsCache[e]}_collectByField(e){var i,n,o;const l=[],u=(n=(i=this.getRawData())===null||i===void 0?void 0:i.latestData)===null||n===void 0?void 0:n[0];if(!u)return[];if(u.links)!((o=u.nodes)===null||o===void 0)&&o.length&&u.nodes.forEach(d=>{d[this._seriesField]&&l.push(d[this._seriesField])});else if(u.nodes){const d=new Set;return collectHierarchyField(d,u.nodes,this._seriesField),Array.from(d)}return l}onLayoutEnd(e){super.onLayoutEnd(e),this._viewBox.set(0,0,this._region.getLayoutRect().width,this._region.getLayoutRect().height),this.getViewData().reRunAllTransform()}getDefaultShapeType(){return"square"}_noAnimationDataKey(e,i){}getActiveMarks(){return[this._nodeMark,this._linkMark]}getMarkData(e){return e.datum?isArray(e.datum)?e.datum[e.datum.length-1]:e.datum:e}}SankeySeries.type=SeriesTypeEnum.sankey,SankeySeries.transformerConstructor=SankeySeriesSpecTransformer,SankeySeries.mark=sankeySeriesMark;const registerSankeySeries=()=>{registerSankeyTransforms(),registerRectMark(),registerLinkPathMark(),registerTextMark(),registerSankeyAnimation(),registerFadeInOutAnimation(),Factory$1.registerSeries(SankeySeries.type,SankeySeries)},hierarchyDimensionStatistics=(r,e)=>{let i={},n=e.fields;if(isFunction(n)&&(n=n()),!(n!=null&&n.length)||!(r!=null&&r.length)||!r[0].latestData)return i;const o=r[0].latestData,l=flatten(o);return i=dimensionStatistics([{latestData:l}],e),i};class TreemapTooltipHelper extends BaseSeriesTooltipHelper{constructor(){super(...arguments),this.markTooltipKeyCallback=e=>{var i,n;return(n=(i=this.series)===null||i===void 0?void 0:i.getMarkData(e))===null||n===void 0?void 0:n[this.series.getDimensionField()[0]]},this.markTooltipValueCallback=e=>{var i,n;const{measureFields:o}=this._seriesCacheInfo,l=(i=this.series)===null||i===void 0?void 0:i.getMarkData(e);if(o[0]&&l)return(n=l[o[0]])!==null&&n!==void 0?n:e.value},this.dimensionTooltipTitleCallback=e=>{var i;const{dimensionFields:n}=this._seriesCacheInfo,o=(i=this.series)===null||i===void 0?void 0:i.getMarkData(e);if(n[0]&&o)return o[n[0]]}}get defaultShapeType(){return"square"}}const treemapSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{nonLeaf:{name:"nonLeaf",type:"rect"},leaf:{name:"leaf",type:"rect"},nonLeafLabel:{name:"nonLeafLabel",type:"text"}}),treemapPresetAnimation=r=>r==="fadeIn"?{type:"fadeIn"}:{type:"growCenterIn"},registerTreemapAnimation=()=>{Factory$1.registerAnimation("treemap",(r,e)=>({appear:treemapPresetAnimation(e),enter:{type:"growCenterIn"},exit:{type:"growCenterOut"},disappear:{type:"growCenterOut"}}))};class TreemapSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"nonLeaf","nonLeafLabel","initNonLeafLabelMarkStyle"),this._addMarkLabelSpec(e,"leaf")}}class TreemapSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.treemap,this.transformerConstructor=TreemapSeriesSpecTransformer,this._categoryField="name",this._valueField="value",this._viewBox=new Bounds,this._enableAnimationHook=this.enableMarkAnimation.bind(this),this.isHierarchyData=()=>!0}getCategoryField(){return this._categoryField}setCategoryField(e){return this._categoryField=e,this._categoryField}getValueField(){return this._valueField}setValueField(e){return this._valueField=e,this._valueField}setAttrFromSpec(){var e;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((e=this._spec.seriesField)!==null&&e!==void 0?e:DEFAULT_HIERARCHY_ROOT),this._spec.roam&&(this.initZoomable(this.event,this._option.mode),this._matrix=new Matrix),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var i,n;return(n=(i=this._spec.drillField)!==null&&i!==void 0?i:this._categoryField)!==null&&n!==void 0?n:DEFAULT_DATA_KEY},getRawData:()=>this.getRawData()}),isValidNumber(this._spec.maxDepth)&&(this._maxDepth=this._spec.maxDepth-1)}initData(){super.initData(),this.getViewData()&&this._spec.drill&&this.initDrillableData(this._dataSet)}compile(){super.compile(),this._runTreemapTransform()}_runTreemapTransform(e=!1){var i,n,o,l;const u=this._data.getProduct();u&&u.transform([{type:"treemap",nameField:this._categoryField,valueField:this._valueField,x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2,maxDepth:this._maxDepth,gapWidth:this._spec.gapWidth,padding:this._spec.nodePadding,splitType:this._spec.splitType,aspectRatio:this._spec.aspectRatio,labelPadding:!((i=this._spec.nonLeafLabel)===null||i===void 0)&&i.visible?(n=this._spec.nonLeafLabel)===null||n===void 0?void 0:n.padding:0,labelPosition:(o=this._spec.nonLeafLabel)===null||o===void 0?void 0:o.position,minVisibleArea:(l=this._spec.minVisibleArea)!==null&&l!==void 0?l:10,minChildrenVisibleArea:this._spec.minChildrenVisibleArea,minChildrenVisibleSize:this._spec.minChildrenVisibleSize,flatten:!0},{type:"map",callback:d=>(d&&[DEFAULT_HIERARCHY_ROOT,"name"].forEach(f=>{d[f]=d.datum[d.depth][this._categoryField]}),d)}]),e&&this.getCompiler().renderNextTick()}_addDataIndexAndKey(){var e;!((e=this._rawData)===null||e===void 0)&&e.dataSet&&(registerDataSetInstanceTransform(this._rawData.dataSet,"addVChartProperty",addVChartProperty),this._rawData.transform({type:"addVChartProperty",options:{beforeCall:initHierarchyKeyMap.bind(this),call:addHierarchyDataKey}}))}getRawDataStatisticsByField(e,i){var n;if(this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[e]&&this._rawData){const o=hierarchyDimensionStatistics([this._rawData],{fields:[{key:e,operations:i?["min","max"]:["values"]}]})[e];this._rawStatisticsCache[e]=merge$1((n=this._rawStatisticsCache[e])!==null&&n!==void 0?n:{},o)}return this._rawStatisticsCache[e]}_createHierarchyDataStatistics(e,i){registerDataSetInstanceTransform(this._dataSet,"hierarchyDimensionStatistics",hierarchyDimensionStatistics),registerDataSetInstanceTransform(this._dataSet,"flatten",flatten);const n=new DataView(this._dataSet,{name:e});return n.parse(i,{type:"dataview"}),n.transform({type:"hierarchyDimensionStatistics",options:{fields:()=>{const o=this.getStatisticFields();return this._seriesField&&this._seriesField!==this._categoryField&&o.push({key:this._seriesField,operations:["values"]}),o}}},!1),n}getStatisticFields(){return appendHierarchyFields(super.getStatisticFields(),this._categoryField,this._valueField)}initMark(){var e,i,n,o;const l=this._createMark(TreemapSeries.mark.nonLeaf,{isSeriesMark:!0,stateSort:(e=this._spec.nonLeaf)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.nonLeaf)===null||i===void 0?void 0:i.customShape});l&&(l.setTransform([{type:"filter",callback:d=>!this._shouldFilterElement(d,"nonLeaf")}]),this._nonLeafMark=l);const u=this._createMark(TreemapSeries.mark.leaf,{isSeriesMark:!0,stateSort:(n=this._spec.leaf)===null||n===void 0?void 0:n.stateSort},{setCustomizedShape:(o=this._spec.leaf)===null||o===void 0?void 0:o.customShape});u&&(u.setTransform([{type:"filter",callback:d=>!this._shouldFilterElement(d,"leaf")}]),this._leafMark=u)}initMarkStyle(){this._initLeafMarkStyle(),this._initNonLeafMarkStyle()}_initLeafMarkStyle(){this._leafMark&&this.setMarkStyle(this._leafMark,{x:e=>e.x0,y:e=>e.y0,x1:e=>e.x1,y1:e=>e.y1,fill:this.getColorAttribute()},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}_initNonLeafMarkStyle(){this._nonLeafMark&&this.setMarkStyle(this._nonLeafMark,{x:e=>e.x0,y:e=>e.y0,x1:e=>e.x1,y1:e=>e.y1,fill:this.getColorAttribute()},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}_initRichStyleOfLabelMark(e){e.getTextType()==="rich"&&this.setMarkStyle(e,{maxWidth:i=>Math.abs(i.x0-i.x1),maxHeight:i=>Math.abs(i.y0-i.y1),ellipsis:!0},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}initLabelMarkStyle(e){e&&(this._labelMark=e,e.setRule("treemap"),this.setMarkStyle(e,{x:i=>(i.x0+i.x1)/2,y:i=>(i.y0+i.y1)/2,text:i=>{var n;return(n=i.datum[i.depth])===null||n===void 0?void 0:n[this.getDimensionField()[0]]},maxLineWidth:i=>i.x1===i.x0?Number.MIN_VALUE:i.x1-i.x0},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series),this._initRichStyleOfLabelMark(e))}initNonLeafLabelMarkStyle(e){e&&(this._nonLeafLabelMark=e,e.setRule("treemap"),this.setMarkStyle(e,{x:i=>i.labelRect?(i.labelRect.x0+i.labelRect.x1)/2:(i.x0+i.x1)/2,y:i=>i.labelRect?(i.labelRect.y0+i.labelRect.y1)/2:(i.y0+i.y1)/2,text:i=>{var n;return(n=i.datum[i.depth])===null||n===void 0?void 0:n[this.getDimensionField()[0]]},maxLineWidth:i=>i.x1===i.x0?Number.MIN_VALUE:i.x1-i.x0},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series),this._initRichStyleOfLabelMark(e))}initAnimation(){this.getMarksInType("rect").forEach(e=>{var i;e.setAnimationConfig(animationConfig((i=Factory$1.getAnimationInKey("treemap"))===null||i===void 0?void 0:i(),userAnimationConfig(e.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.roam&&(this.initDragEventOfSeries(this),this.event.on("panmove",e=>{this.handlePan(e)}),this.initZoomEventOfSeries(this),this.event.on("zoom",e=>{this.handleZoom(e)})),this._spec.drill&&this.bindDrillEvent()}_getDataIdKey(){return"key"}initTooltip(){this._tooltipHelper=new TreemapTooltipHelper(this),this._leafMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._leafMark),this._nonLeafMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nonLeafMark)}_shouldFilterElement(e,i){const n=e.isLeaf;return i==="leaf"?!n:n}handlePan(e){const{delta:i}=e;if(i[0]===0&&i[1]===0)return;this._matrix.reset(),this._matrix.translate(i[0],i[1]);const{a:n,b:o,c:l,d:u,e:d,f}=this._matrix;this._matrix.multiply(n,o,l,u,d,f),this._viewBox.transformWithMatrix(this._matrix),this._runTreemapTransform(!0)}handleZoom(e){const{scale:i,scaleCenter:n}=e;if(i===1)return;this._matrix.reset();const{x:o,y:l}=n;this._matrix.translate(o,l),this._matrix.scale(i,i),this._matrix.translate(-o,-l);const{a:u,b:d,c:f,d:g,e:_,f:y}=this._matrix;this._matrix.multiply(u,d,f,g,_,y),this.disableMarkAnimation(),this.event.on(HOOK_EVENT.AFTER_DO_RENDER,this._enableAnimationHook),this._viewBox.transformWithMatrix(this._matrix),this._runTreemapTransform(!0)}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}onLayoutEnd(e){super.onLayoutEnd(e),this._viewBox.set(0,0,this.getLayoutRect().width,this.getLayoutRect().height),this._runTreemapTransform()}enableMarkAnimation(){this.getMarks().forEach(e=>{var i;(i=e.getProduct().animate)===null||i===void 0||i.enable()}),[this._labelMark,this._nonLeafLabelMark].forEach(e=>{e&&e.getComponent()&&e.getComponent().getProduct().getGroupGraphicItem().enableAnimation()}),this.event.off(HOOK_EVENT.AFTER_DO_RENDER,this._enableAnimationHook)}disableMarkAnimation(){this.getMarks().forEach(e=>{var i;(i=e.getProduct().animate)===null||i===void 0||i.disable()}),[this._labelMark,this._nonLeafLabelMark].forEach(e=>{e&&e.getComponent()&&e.getComponent().getProduct().getGroupGraphicItem().disableAnimation()})}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._nonLeafMark,this._leafMark]}getMarkData(e){return e!=null&&e.datum?e.datum[e.datum.length-1]:e}}TreemapSeries.type=SeriesTypeEnum.treemap,TreemapSeries.mark=treemapSeriesMark,TreemapSeries.transformerConstructor=TreemapSeriesSpecTransformer,mixin(TreemapSeries,Drillable),mixin(TreemapSeries,Zoomable);const registerTreemapSeries=()=>{registerFilterTransform(),registerMapTransform(),registerRectMark(),registerTextMark(),registerTreemapAnimation(),registerFadeInOutAnimation(),registerTreemapTransforms(),Factory$1.registerSeries(TreemapSeries.type,TreemapSeries)},gaugeSeriesMark=Object.assign(Object.assign({},progressLikeSeriesMark),{segment:{name:"segment",type:"arc"},track:{name:"track",type:"arc"}}),gaugePointerSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{pin:{name:"pin",type:"path"},pinBackground:{name:"pinBackground",type:"path"},pointer:{name:"pointer",type:["path","rect"]}}),Appear_Grow=r=>({channel:{angle:{from:r.startAngle+Math.PI/2}}}),Appear_FadeIn={type:"fadeIn"};function gaugePointerPresetAnimation(r,e){return e==="fadeIn"?Appear_FadeIn:Appear_Grow(r)}const registerGaugePointerAnimation=()=>{Factory$1.registerAnimation("gaugePointer",(r,e)=>{const i=gaugePointerPresetAnimation(r,e);return{appear:i,enter:i,disappear:{type:"fadeOut"}}})};class GaugePointerSeriesSpecTransformer extends BaseSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!1}}class GaugePointerTooltipHelper extends BaseSeriesTooltipHelper{enableByType(e){return e!=="dimension"}}class GaugePointerSeries extends ProgressLikeSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.gaugePointer,this.transformerConstructor=GaugePointerSeriesSpecTransformer,this._pinMark=null,this._pointerMark=null,this._pinBackgroundMark=null}setAttrFromSpec(){var e;super.setAttrFromSpec(),this.setRadiusField(this._spec.radiusField),this._pointerType=((e=this._spec.pointer)===null||e===void 0?void 0:e.type)==="rect"?"rect":"path"}initMark(){this._pinBackgroundMark=this._createMark(GaugePointerSeries.mark.pinBackground),this._pointerMark=this._createMark(Object.assign(Object.assign({},GaugePointerSeries.mark.pointer),{type:this._pointerType}),{isSeriesMark:!0}),this._pinMark=this._createMark(GaugePointerSeries.mark.pin)}initMarkStyle(){this.initPinBackgroundMarkStyle(),this.initPointerMarkStyle(),this.initPinMarkStyle()}initGroups(){}initPointerMarkStyle(){const e=this._pointerMark,i=this._spec.pointer;e&&(this.setMarkStyle(e,{x:n=>{var o,l;const{x:u}=this._getPointerAnchor(n,i);return u-this._getPointerWidth()*((l=(o=i==null?void 0:i.center)===null||o===void 0?void 0:o[0])!==null&&l!==void 0?l:0)},y:n=>{var o,l;const{y:u}=this._getPointerAnchor(n,i);return u-this._getPointerHeight(n)*((l=(o=i==null?void 0:i.center)===null||o===void 0?void 0:o[1])!==null&&l!==void 0?l:0)},anchor:n=>{const{x:o,y:l}=this._getPointerAnchor(n,i);return[o,l]},fill:this.getColorAttribute(),zIndex:200}),this._pointerType==="path"?this.setMarkStyle(e,{scaleX:this._getPointerWidth.bind(this),scaleY:this._getPointerHeight.bind(this),angle:n=>this._getPointerAngle(n)+Math.PI/2}):this.setMarkStyle(e,{width:this._getPointerWidth.bind(this),height:this._getPointerHeight.bind(this),angle:n=>this._getPointerAngle(n)-Math.PI/2}))}initTooltip(){this._tooltipHelper=new GaugePointerTooltipHelper(this),this._pointerMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pointerMark)}_getPointerAnchor(e,i){var n;return(n=i.isOnCenter)===null||n===void 0||n?this.angleAxisHelper.center():this.radiusAxisHelper.coordToPoint({radius:this._innerRadius*this._computeLayoutRadius(),angle:this.angleAxisHelper.dataToPosition([e[this._angleField[0]]])})}_getPointerWidth(){return this._spec.pointer.width*this._computeLayoutRadius()}_getPointerHeight(e){var i,n;const o=this._spec.pointer,l=this._radiusField[0];return isValid(this.radiusAxisHelper)&&isValid(l)?this.radiusAxisHelper.dataToPosition([e[l]])-((i=o==null?void 0:o.innerPadding)!==null&&i!==void 0?i:0)-((n=o==null?void 0:o.outerPadding)!==null&&n!==void 0?n:10):o.height*this._computeLayoutRadius()}_getPointerAngle(e){const i=this.angleAxisHelper.getScale().domain(),n=maxInArray(i),o=minInArray(i),l=clamp(e[this._angleField[0]],o,n);return this.angleAxisHelper.dataToPosition([l])}_getRotatedPointerCenterOffset(e){var i,n,o,l;const u=this._spec.pointer,d=this._getPointerWidth()*((n=(i=u==null?void 0:u.center)===null||i===void 0?void 0:i[0])!==null&&n!==void 0?n:0),f=-this._getPointerHeight(e)*((l=(o=u==null?void 0:u.center)===null||o===void 0?void 0:o[1])!==null&&l!==void 0?l:0),g=this._getPointerAngle(e)-Math.PI/2,_=Math.cos(g),y=Math.sin(g);return{x:d*_+f*y,y:-(f*_-d*y)}}initPinBackgroundMarkStyle(){const e=this._pinBackgroundMark,i=this._spec.pinBackground;e&&this.setMarkStyle(e,{x:n=>this._getPointerAnchor(n,i).x,y:n=>this._getPointerAnchor(n,i).y,scaleX:()=>i.width*this._computeLayoutRadius(),scaleY:()=>i.height*this._computeLayoutRadius(),fill:this.getColorAttribute(),zIndex:100})}initPinMarkStyle(){const e=this._pinMark,i=this._spec.pin;e&&this.setMarkStyle(e,{x:n=>this._getPointerAnchor(n,i).x,y:n=>this._getPointerAnchor(n,i).y,scaleX:()=>i.width*this._computeLayoutRadius(),scaleY:()=>i.height*this._computeLayoutRadius(),fill:this.getColorAttribute(),zIndex:300})}initInteraction(){this._parseInteractionConfig(this._pointerMark?[this._pointerMark]:[])}initAnimation(){var e,i,n;const o=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this._pointerMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("gaugePointer"))===null||n===void 0?void 0:n({startAngle:this._startAngle},o),userAnimationConfig("pointer",this._spec,this._markAttributeContext)))}getDefaultShapeType(){return"circle"}getActiveMarks(){return[]}}GaugePointerSeries.type=SeriesTypeEnum.gaugePointer,GaugePointerSeries.mark=gaugePointerSeriesMark,GaugePointerSeries.transformerConstructor=GaugePointerSeriesSpecTransformer;const registerGaugePointerSeries=()=>{Factory$1.registerSeries(GaugePointerSeries.type,GaugePointerSeries),registerPathMark(),registerRectMark(),registerGaugePointerAnimation(),registerPolarBandAxis(),registerPolarLinearAxis()};class GaugeSeriesSpecTransformer extends BaseSeriesSpecTransformer{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(e){this._addMarkLabelSpec(e,"segment")}}class GaugeSeries extends ProgressLikeSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.gauge,this.transformerConstructor=GaugeSeriesSpecTransformer,this._segmentMark=null,this._trackMark=null,this._padAngle=0}setAttrFromSpec(){var e;super.setAttrFromSpec(),this._padAngle=degreeToRadian((e=this._spec.padAngle)!==null&&e!==void 0?e:0)}initData(){var e;super.initData(),registerDataSetInstanceTransform(this._option.dataSet,"spiltSegment",(i,n)=>{const o=i.slice();return o.sort((l,u)=>l[this._angleField[0]]-u[this._angleField[0]]),o.forEach((l,u)=>{l[SEGMENT_FIELD_END]=l[this._angleField[0]],l[SEGMENT_FIELD_START]=u>0?o[u-1][SEGMENT_FIELD_END]:void 0}),o}),(e=this.getViewData())===null||e===void 0||e.transform({type:"spiltSegment"},!1)}initMark(){super.initMark(),this._trackMark=this._createMark(GaugeSeries.mark.track,{parent:this._arcGroupMark,dataView:!1}),this._segmentMark=this._createMark(GaugeSeries.mark.segment,{parent:this._arcGroupMark,isSeriesMark:!0})}initMarkStyle(){super.initMarkStyle(),this.initTrackMarkStyle(),this.initSegmentMarkStyle()}initSegmentMarkStyle(){var e;const i=this._segmentMark;i&&this.setMarkStyle(i,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._getAngleValueStart.bind(this),endAngle:this._getAngleValueEnd.bind(this),innerRadius:()=>{var n;return this._computeLayoutRadius()*((n=this._spec.innerRadius)!==null&&n!==void 0?n:0)},outerRadius:()=>{var n,o;return this._computeLayoutRadius()*((o=(n=this._spec.radius)!==null&&n!==void 0?n:this._spec.outerRadius)!==null&&o!==void 0?o:1)},cap:(e=this._spec.roundCap)!==null&&e!==void 0&&e,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:200,forceShowCap:!0})}generateRadiusStyle(e){if(!e)return;const i={};return e.outerRadius&&(i.outerRadius=()=>this._computeLayoutRadius()*e.outerRadius),e.innerRadius&&(i.innerRadius=()=>this._computeLayoutRadius()*e.innerRadius),i}initMarkStyleWithSpec(e,i,n){if(super.initMarkStyleWithSpec(e,i,n),e&&e.name==="segment"){const o=this.getSpec().segment;if(o)for(const l in o.state||{})this.setMarkStyle(e,this.generateRadiusStyle(o.state[l]),l,AttributeLevel.User_Mark)}}initTooltip(){super.initTooltip(),this._segmentMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._segmentMark)}initTrackMarkStyle(){var e;const i=this._trackMark;i&&this.setMarkStyle(i,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._startAngle,endAngle:this._endAngle,innerRadius:()=>{var n;return this._computeLayoutRadius()*((n=this._spec.innerRadius)!==null&&n!==void 0?n:0)},outerRadius:()=>{var n,o;return this._computeLayoutRadius()*((o=(n=this._spec.radius)!==null&&n!==void 0?n:this._spec.outerRadius)!==null&&o!==void 0?o:1)},cap:(e=this._spec.roundCap)!==null&&e!==void 0&&e,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,zIndex:100})}_getAngleValueStartWithoutMask(e){const i=this._getAngleValueStartWithoutPadAngle(e),n=this._getAngleValueEndWithoutPadAngle(e);return clamper(i,(i+n)/2)(i+(n>i?1:-1)*Math.abs(this._padAngle/2))}_getAngleValueEndWithoutMask(e){const i=this._getAngleValueStartWithoutPadAngle(e),n=this._getAngleValueEndWithoutPadAngle(e);return clamper(n,(i+n)/2)(n-(n>i?1:-1)*Math.abs(this._padAngle/2))}_getAngleValueStartWithoutPadAngle(e){return isValid(e[SEGMENT_FIELD_START])?this.angleAxisHelper.dataToPosition([e[SEGMENT_FIELD_START]]):this._startAngle}_getAngleValueEndWithoutPadAngle(e){return this.angleAxisHelper.dataToPosition([e[SEGMENT_FIELD_END]])}initAnimation(){var e,i,n;const o=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset;this._segmentMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("circularProgress"))===null||n===void 0?void 0:n({startAngle:this._startAngle},o),userAnimationConfig("segment",this._spec,this._markAttributeContext)))}getDefaultShapeType(){return"circle"}getActiveMarks(){return[]}}GaugeSeries.type=SeriesTypeEnum.gauge,GaugeSeries.mark=gaugeSeriesMark,GaugeSeries.transformerConstructor=GaugeSeriesSpecTransformer;const registerGaugeSeries=()=>{Factory$1.registerSeries(GaugeSeries.type,GaugeSeries),registerArcMark(),registerProgressLikeAnimation(),registerPolarLinearAxis()};class CellMark extends BaseSymbolMark{constructor(){super(...arguments),this.type=CellMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{padding:0})}}CellMark.type="cell";const registerCellMark=()=>{Factory$1.registerMark(CellMark.type,CellMark),registerCellGraphic(),registerCellMark$1()};function heatmapPresetAnimation(r){return r===!1?{}:{type:"fadeIn"}}const registerHeatmapAnimation=()=>{Factory$1.registerAnimation("heatmap",(r,e)=>Object.assign(Object.assign({},FadeInOutAnimation),{appear:heatmapPresetAnimation(e)}))};class HeatmapSeriesTooltipHelper extends BaseSeriesTooltipHelper{enableByType(e){return e!=="dimension"}}const heatmapSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{cell:{name:"cell",type:"cell"},cellBackground:{name:"cellBackground",type:"cell"}});class HeatmapSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"cell")}}class HeatmapSeries extends CartesianSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.heatmap,this.transformerConstructor=HeatmapSeriesSpecTransformer}getFieldValue(){return this._fieldValue}setFieldValue(e){this._fieldValue=array(e)}setAttrFromSpec(){super.setAttrFromSpec(),this.setFieldValue(this._spec.valueField)}initMark(){var e,i,n,o;const l={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._cellMark=this._createMark(HeatmapSeries.mark.cell,{isSeriesMark:!0,stateSort:(e=this._spec.cell)===null||e===void 0?void 0:e.stateSort},Object.assign(Object.assign({},l),{setCustomizedShape:(i=this._spec.cell)===null||i===void 0?void 0:i.customShape,morph:shouldMarkDoMorph(this._spec,HeatmapSeries.mark.cell.name),morphElementKey:this.getDimensionField()[0]})),this._backgroundMark=this._createMark(HeatmapSeries.mark.cellBackground,{stateSort:(n=this._spec.cellBackground)===null||n===void 0?void 0:n.stateSort},Object.assign(Object.assign({},l),{setCustomizedShape:(o=this._spec.cellBackground)===null||o===void 0?void 0:o.customShape}))}initMarkStyle(){this.initCellMarkStyle(),this.initCellBackgroundMarkStyle()}initLabelMarkStyle(e){e&&this.setMarkStyle(e,{fill:this.getColorAttribute(),text:i=>i[this.getMeasureField()[0]]})}initCellMarkStyle(){this.setMarkStyle(this._cellMark,{x:e=>this.dataToPositionX(e),y:e=>this.dataToPositionY(e),size:()=>[this.getCellSize(this._xAxisHelper),this.getCellSize(this._yAxisHelper)],fill:this.getColorAttribute()},"normal",AttributeLevel.Series)}initCellBackgroundMarkStyle(){var e,i,n;const o=normalizePadding$1((n=(i=(e=this._spec.cellBackground)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.padding)!==null&&n!==void 0?n:0);this.setMarkStyle(this._backgroundMark,{x:l=>{const u=this.getCellSize(this._xAxisHelper);return this.dataToPositionX(l)-u/2+o[3]},y:l=>{const u=this.getCellSize(this._yAxisHelper);return this.dataToPositionY(l)-u/2+o[0]},width:()=>this.getCellSize(this._xAxisHelper)-o[1]-o[3],height:()=>this.getCellSize(this._yAxisHelper)-o[0]-o[2]},"normal",AttributeLevel.Series)}getColorAttribute(){var e;return{scale:(e=this._option.globalScale.getScale("color"))!==null&&e!==void 0?e:this._getDefaultColorScale(),field:this.getFieldValue[0]}}initInteraction(){this._parseInteractionConfig(this._cellMark?[this._cellMark]:[])}initAnimation(){var e,i,n;const o=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset,l=getGroupAnimationParams(this);this._cellMark.setAnimationConfig(animationConfig((n=Factory$1.getAnimationInKey("heatmap"))===null||n===void 0?void 0:n(o),userAnimationConfig("cell",this._spec,this._markAttributeContext),l))}getCellSize(e){var i,n;return(n=(i=e.getBandwidth)===null||i===void 0?void 0:i.call(e,0))!==null&&n!==void 0?n:6}initTooltip(){this._tooltipHelper=new HeatmapSeriesTooltipHelper(this),this._cellMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._cellMark)}getDefaultShapeType(){return"square"}getDimensionField(){return[].concat(this.fieldX,this.fieldY)}getMeasureField(){return this.getFieldValue()}getActiveMarks(){return[this._cellMark]}}HeatmapSeries.type=SeriesTypeEnum.heatmap,HeatmapSeries.mark=heatmapSeriesMark,HeatmapSeries.transformerConstructor=HeatmapSeriesSpecTransformer;const registerHeatmapSeries=()=>{registerTextMark(),registerCellMark(),registerHeatmapAnimation(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerSeries(HeatmapSeries.type,HeatmapSeries)},correlationSeriesMark=Object.assign(Object.assign({},baseSeriesMark),{nodePoint:{name:"nodePoint",type:"symbol"},ripplePoint:{name:"ripplePoint",type:"ripple"},centerPoint:{name:"centerPoint",type:"symbol"},centerLabel:{name:"centerLabel",type:"text"}}),CORRELATION_X=`${PREFIX}_CORRELATION_X`,CORRELATION_Y=`${PREFIX}_CORRELATION_Y`,CORRELATION_SIZE=`${PREFIX}_CORRELATION_SIZE`,correlation=(r,e)=>{var i,n,o,l,u,d,f,g,_,y,b,S,v,A,x;if(!r||!(e!=null&&e.view)||!isArray(r))return r;const T=e.view();if(T.x1-T.x0==0||T.y1-T.y0==0||T.x1-T.x0==-1/0||T.x1-T.x0==1/0||T.y1-T.y0==-1/0||T.y1-T.y0==1/0)return r;const C=degreeToRadian((i=e.startAngle)!==null&&i!==void 0?i:-90),E=degreeToRadian((n=e.endAngle)!==null&&n!==void 0?n:270),P=Math.max((T.x1-T.x0)/2,(T.y1-T.y0)/2),L=toPercent((o=e.innerRadius)!==null&&o!==void 0?o:0,P),R=toPercent(e.outerRadius,P),w=[isNumber((l=e.center)===null||l===void 0?void 0:l[0])?e.center[0]:T.x0+toPercent((d=(u=e.center)===null||u===void 0?void 0:u[0])!==null&&d!==void 0?d:"50%",T.x1-T.x0),isNumber((f=e.center)===null||f===void 0?void 0:f[1])?e.center[1]:T.y0+toPercent((_=(g=e.center)===null||g===void 0?void 0:g[1])!==null&&_!==void 0?_:"50%",T.y1-T.y0)],D=field$3(e.field),I=r.map(D),[O,B]=extent$2(I),N=O===B?te=>(L+R)/2:te=>L+(R-L)*(te-O)/(B-O),$=isNil(e.radiusField)?D:field$3(e.radiusField),H=(b=(y=e==null?void 0:e.radiusRange)===null||y===void 0?void 0:y[1])!==null&&b!==void 0?b:5;let F=te=>H;if($){const[te,de]=$!==D?extent$2(r.map($)):[O,B],he=(v=(S=e.radiusRange)===null||S===void 0?void 0:S[0])!==null&&v!==void 0?v:5,fe=(x=(A=e.radiusRange)===null||A===void 0?void 0:A[1])!==null&&x!==void 0?x:5;te!==de&&(F=pe=>he+(fe-he)*($(pe)-te)/(de-te))}const V=Math.min(C,E),G=Math.max(C,E),Y=getPartialAngles(V,G,r.length),J=[],q=(G-V)/60;return r.forEach((te,de)=>{const he=N(I[de]),fe=F(te);let pe,me,ee=Y[de];for(let Q=0;Q<60&&(pe=w[0]+he*Math.cos(ee),me=w[1]+he*Math.sin(ee),hasOverlap({x:pe,y:me,size:fe},J)||pe-fe<T.x0||pe+fe>T.x1||me-fe<T.y0||me+fe>T.y1);Q++)Q<59&&(ee+=q,ee>G?ee=V:ee<V&&(ee=G));J.push(Object.assign({[CORRELATION_X]:pe,[CORRELATION_Y]:me,[CORRELATION_SIZE]:fe},te))}),J},getPartialAngles=(r,e,i)=>{let n=0,o=Math.max(Math.ceil(2*(e-r)/Math.PI),2),l=(e-r)/o,u=0,d=1,f=0,g=0;const _=[];let y=r;for(;f<i;)g<o&&(_.push(y+(g%2?Math.floor(g/2)+Math.floor(o/2):g/2)*l*d),g++),f++,g===o&&(g=0,u+=1,d*=-1,n===0?n=l/2:n/=2,y=d===-1?e-n:r+n,u>=2&&(l/=2,o*=2));return _},hasOverlap=(r,e)=>!(!e||!e.length)&&e.some(i=>Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)<Math.pow(r.size+i.size,2)),correlationCenter=(r,e)=>{if(!r||!isArray(r))return[];const{keyword:i,categoryField:n}=e,o=r[0].latestData[0];return{[n]:i,[DEFAULT_DATA_INDEX]:o==null?void 0:o[DEFAULT_DATA_INDEX],[DEFAULT_DATA_SERIES_FIELD]:o==null?void 0:o[DEFAULT_DATA_SERIES_FIELD]}};class RippleMark extends BaseMark{constructor(){super(...arguments),this.type=RippleMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x:0,y:0,ripple:0})}_initProduct(e){const i=this.getVGrammarView(),n=this.getProductId();this._product=i.glyph("ripplePoint",e??i.rootMark).id(n),this._compiledProductId=n}}RippleMark.type="ripple";const registerRippleMark=()=>{Factory$1.registerMark(RippleMark.type,RippleMark),registerRippleGlyph()},correlationPresetAnimation=(r,e)=>e==="fadeIn"?{type:"fadeIn"}:{type:"scaleIn"},registerCorrelationAnimation=()=>{Factory$1.registerAnimation("correlation",(r,e)=>Object.assign({appear:correlationPresetAnimation(0,e)},ScaleInOutAnimation))};class CorrelationSeriesSpecTransformer extends BaseSeriesSpecTransformer{_transformLabelSpec(e){this._addMarkLabelSpec(e,"nodePoint"),this._addMarkLabelSpec(e,"centerPoint","centerLabel")}}class CorrelationSeries extends PolarSeries{constructor(){super(...arguments),this.type=SeriesTypeEnum.correlation,this.transformerConstructor=CorrelationSeriesSpecTransformer,this._viewBox=new Bounds}getCategoryField(){return this._categoryField}setCategoryField(e){return this._categoryField=e,this._categoryField}getValueField(){return this._valueField}setValueField(e){return this._valueField=e,this._valueField}getSeriesField(){return this._seriesField}setSeriesField(e){isValid(e)&&(this._seriesField=e)}getSizeField(){return this._sizeField}setSizeField(e){isValid(e)&&(this._sizeField=e)}getSizeRange(){return this._sizeRange}setSizeRange(e){isValid(e)&&(this._sizeRange=e)}setAttrFromSpec(){super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField(this._spec.seriesField),this.setSizeField(this._spec.sizeField),this.setSizeRange(this._spec.sizeRange)}initData(){var e,i,n;if(super.initData(),!this._data)return;registerDataSetInstanceTransform(this._dataSet,"correlation",correlation);const o=new DataSet;registerDataSetInstanceParser(o,"dataview",dataViewParser),registerDataSetInstanceTransform(o,"correlationCenter",correlationCenter);const l=new DataView(o,{name:`${this.type}_${this.id}_center`});l.parse([this.getViewData()],{type:"dataview"}),l.transform({type:"correlationCenter",options:{keyword:(n=(i=(e=this._spec.centerLabel)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.text)!==null&&n!==void 0?n:"",categoryField:this._spec.categoryField}}),this._centerSeriesData=new SeriesData(this._option,l)}compileData(){var e;super.compileData(),(e=this._centerSeriesData)===null||e===void 0||e.compile()}_statisticViewData(){super._statisticViewData(),this._data.getDataView().transform({type:"correlation",options:{view:()=>({x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2}),field:this._spec.valueField,radiusRange:this._spec.sizeRange,radiusField:this._spec.sizeField,center:[this._spec.centerX,this._spec.centerY],innerRadius:this._spec.innerRadius,outerRadius:this._spec.outerRadius,startAngle:this._spec.startAngle,endAngle:this._spec.endAngle}})}initMark(){var e,i,n,o;const l=this._createMark(CorrelationSeries.mark.nodePoint,{groupKey:this._seriesField,isSeriesMark:!0,key:DEFAULT_DATA_INDEX,stateSort:(e=this._spec.nodePoint)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.nodePoint)===null||i===void 0?void 0:i.customShape});l&&(l.setMarkConfig({zIndex:LayoutZIndex.Node}),this._nodePointMark=l);const u=this._createMark(CorrelationSeries.mark.ripplePoint,{key:DEFAULT_DATA_INDEX,dataView:this._centerSeriesData.getDataView(),dataProductId:this._centerSeriesData.getProductId()});u&&(this._ripplePointMark=u);const d=this._createMark(CorrelationSeries.mark.centerPoint,{key:DEFAULT_DATA_INDEX,dataView:this._centerSeriesData.getDataView(),dataProductId:this._centerSeriesData.getProductId(),stateSort:(n=this._spec.centerPoint)===null||n===void 0?void 0:n.stateSort},{setCustomizedShape:(o=this._spec.centerPoint)===null||o===void 0?void 0:o.customShape});d&&(d.setMarkConfig({zIndex:LayoutZIndex.Node}),this._centerPointMark=d)}initMarkStyle(){this._initNodePointMarkStyle(),this._initRipplePointMarkStyle(),this._initCenterPointMarkStyle()}_initNodePointMarkStyle(){var e,i,n,o;const l=this._nodePointMark;if(!l)return;const u=(i=(e=this._spec.nodePoint)===null||e===void 0?void 0:e.style)!==null&&i!==void 0?i:{};this.setMarkStyle(l,{x:d=>d[CORRELATION_X],y:d=>d[CORRELATION_Y],size:d=>d[CORRELATION_SIZE],fill:(n=u.fill)!==null&&n!==void 0?n:this.getColorAttribute(),fillOpacity:(o=u.fillOpacity)!==null&&o!==void 0?o:1,lineWidth:0},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}_initRipplePointMarkStyle(){var e,i,n,o,l;const u=this._ripplePointMark;if(!u)return;const d=(i=(e=this._spec.ripplePoint)===null||e===void 0?void 0:e.style)!==null&&i!==void 0?i:{};this.setMarkStyle(u,{x:()=>{var f;return(f=this._spec.centerX)!==null&&f!==void 0?f:(this._viewBox.x1+this._viewBox.x2)/2},y:()=>{var f;return(f=this._spec.centerY)!==null&&f!==void 0?f:(this._viewBox.y1+this._viewBox.y2)/2},size:()=>Math.max(this._viewBox.x2-this._viewBox.x1,this._viewBox.y2-this._viewBox.y1)/2,fill:(n=d.fill)!==null&&n!==void 0?n:this.getColorAttribute(),opacity:(o=d.fillOpacity)!==null&&o!==void 0?o:.2,ripple:(l=d.ripple)!==null&&l!==void 0?l:0},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}_initCenterPointMarkStyle(){var e,i,n,o,l,u;const d=this._centerPointMark;d&&this.setMarkStyle(d,{x:()=>{var f;return(f=this._spec.centerX)!==null&&f!==void 0?f:(this._viewBox.x1+this._viewBox.x2)/2},y:()=>{var f;return(f=this._spec.centerY)!==null&&f!==void 0?f:(this._viewBox.y1+this._viewBox.y2)/2},size:()=>.2*Math.max(this._viewBox.x2-this._viewBox.x1,this._viewBox.y2-this._viewBox.y1)/2,fill:(n=(i=(e=this._spec.centerPoint)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.fill)!==null&&n!==void 0?n:this.getColorAttribute(),fillOpacity:(u=(l=(o=this._spec.centerPoint)===null||o===void 0?void 0:o.style)===null||l===void 0?void 0:l.fillOpacity)!==null&&u!==void 0?u:1},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}initTooltip(){super.initTooltip(),this._nodePointMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nodePointMark)}initLabelMarkStyle(e){e&&this.setMarkStyle(e,{fill:this.getColorAttribute(),text:i=>i[this._categoryField],z:this.dataToPositionZ.bind(this)},STATE_VALUE_ENUM.STATE_NORMAL,AttributeLevel.Series)}initAnimation(){var e,i;const n=(e=this._spec.animationAppear)===null||e===void 0?void 0:e.preset;this._nodePointMark.setAnimationConfig(animationConfig((i=Factory$1.getAnimationInKey("correlation"))===null||i===void 0?void 0:i({},n),userAnimationConfig("nodePoint",this._spec,this._markAttributeContext)))}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}getActiveMarks(){return[this._nodePointMark,this._centerPointMark]}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}onLayoutEnd(e){super.onLayoutEnd(e),this._viewBox.set(0,0,this._region.getLayoutRect().width,this._region.getLayoutRect().height),this._rawData.reRunAllTransform(),this.getViewData().reRunAllTransform()}}CorrelationSeries.type=SeriesTypeEnum.correlation,CorrelationSeries.mark=correlationSeriesMark,CorrelationSeries.transformerConstructor=CorrelationSeriesSpecTransformer;const registerCorrelationSeries=()=>{registerSymbolMark(),registerRippleMark(),Factory$1.registerSeries(CorrelationSeries.type,CorrelationSeries),registerCorrelationAnimation()};class MapChartSpecTransformer extends BaseChartSpecTransformer{_isValidSeries(e){return e===SeriesTypeEnum.map}_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["type","nameField","valueField","map","nameProperty","centroidProperty","nameMap","area","defaultFillColor","showDefaultName"])}transformSpec(e){super.transformSpec(e),e.region.forEach(i=>{i.coordinate="geo"}),super.transformSeriesSpec(e)}}class MapChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=MapChartSpecTransformer,this.type="map",this.seriesType=SeriesTypeEnum.map}}MapChart.type="map",MapChart.seriesType=SeriesTypeEnum.map,MapChart.transformerConstructor=MapChartSpecTransformer;const registerMapChart=()=>{registerMapSeries(),Factory$1.registerChart(MapChart.type,MapChart)};class PolarChartSpecTransformer extends BaseChartSpecTransformer{_isValidSeries(e){return!this.seriesType||e===this.seriesType}getIndicatorSpec(e){var i,n,o;const l=array(e.indicator),u=(i=e.innerRadius)!==null&&i!==void 0?i:(o=(n=e.series)===null||n===void 0?void 0:n[0])===null||o===void 0?void 0:o.innerRadius;return isValid(u)&&l.forEach(d=>{isNil(d.limitRatio)&&(d.limitRatio=u)}),l}_getDefaultSeriesSpec(e,i){return super._getDefaultSeriesSpec(e,["radius","outerRadius","innerRadius","startAngle","endAngle","sortDataByAxis"],i)}transformSpec(e){super.transformSpec(e),isArray(e.dataZoom)&&e.dataZoom.length>0&&e.dataZoom.forEach(i=>{i.filterMode==="axis"&&(i.filterMode="filter")}),this.transformSeriesSpec(e),isValid(e.indicator)&&(e.indicator=this.getIndicatorSpec(e))}}class ProgressLikeChartSpecTransformer extends PolarChartSpecTransformer{needAxes(){return!1}_getDefaultSeriesSpec(e){const i=super._getDefaultSeriesSpec(e,["startAngle","endAngle","centerX","centerY"]);return i.categoryField=e.categoryField||e.radiusField,i.valueField=e.valueField||e.angleField,i}_transformProgressAxisSpec(e,i,n,o,l){var u,d;e.axes||(e.axes=[]);let f=((u=e.axes)!==null&&u!==void 0?u:[]).find(y=>y.orient==="radius"),g=((d=e.axes)!==null&&d!==void 0?d:[]).find(y=>y.orient==="angle");g||(g=i,e.axes.push(g)),f||(f=n,e.axes.push(f)),isNil(g.type)&&(g.type="linear"),isNil(f.type)&&(f.type="band");const _=getLinearAxisSpecDomain(g,{min:0,max:1});isNil(g.min)&&(g.min=_.min),isNil(g.max)&&(g.max=_.max),o&&Object.assign(g,mergeSpec({},o,g)),l&&Object.assign(f,mergeSpec({},l,f))}}class RoseLikeChartSpecTransformer extends PolarChartSpecTransformer{needAxes(){return!0}_getDefaultSeriesSpec(e){const i=super._getDefaultSeriesSpec(e);return i.categoryField=e.categoryField||e.angleField,i.valueField=e.valueField||e.radiusField,i}transformSpec(e){var i;if(super.transformSpec(e),this.needAxes()){e.axes||(e.axes=[]);const n={radius:!1,angle:!1};((i=e.axes)!==null&&i!==void 0?i:[]).forEach(o=>{const{orient:l}=o;l==="radius"&&(n.radius=!0),l==="angle"&&(n.angle=!0)}),n.angle||e.axes.push({orient:"angle"}),n.radius||e.axes.push({orient:"radius"})}}}class BasePieChartSpecTransformer extends PolarChartSpecTransformer{needAxes(){return!1}_getDefaultSeriesSpec(e){var i;const n=super._getDefaultSeriesSpec(e,["center","centerOffset","cornerRadius","padAngle","minAngle","emptyPlaceholder","showAllZero","supportNegative","layoutRadius"]);return n.categoryField=e.categoryField||e.seriesField,n.valueField=e.valueField||e.angleField,n.emptyCircle=(i=e.emptyPlaceholder)===null||i===void 0?void 0:i.emptyCircle,n}}class BasePieChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=BasePieChartSpecTransformer}}BasePieChart.transformerConstructor=BasePieChartSpecTransformer;class PieChart extends BasePieChart{constructor(){super(...arguments),this.transformerConstructor=BasePieChartSpecTransformer,this.type="pie",this.seriesType=SeriesTypeEnum.pie}}PieChart.type="pie",PieChart.seriesType=SeriesTypeEnum.pie,PieChart.transformerConstructor=BasePieChartSpecTransformer;const registerPieChart=()=>{registerPieSeries(),Factory$1.registerChart(PieChart.type,PieChart)};class Pie3dChartSpecTransformer extends BasePieChartSpecTransformer{transformSpec(e){super.transformSpec(e),e.series.forEach(i=>{i.type==="pie3d"&&(i.angle3d=e.angle3d)})}}class Pie3dChart extends BasePieChart{constructor(){super(...arguments),this.transformerConstructor=Pie3dChartSpecTransformer,this.type="pie3d",this.seriesType=SeriesTypeEnum.pie3d}}Pie3dChart.type="pie3d",Pie3dChart.seriesType=SeriesTypeEnum.pie3d,Pie3dChart.transformerConstructor=Pie3dChartSpecTransformer;const registerPie3dChart=()=>{register3DPlugin(),registerPie3dSeries(),Factory$1.registerChart(Pie3dChart.type,Pie3dChart)};class RoseChartSpecTransformer extends RoseLikeChartSpecTransformer{_getDefaultSeriesSpec(e){var i,n,o;const l=super._getDefaultSeriesSpec(e);return l.radius=(i=e.radius)!==null&&i!==void 0?i:POLAR_DEFAULT_RADIUS,l.outerRadius=(n=e.outerRadius)!==null&&n!==void 0?n:POLAR_DEFAULT_RADIUS,l.innerRadius=(o=e.innerRadius)!==null&&o!==void 0?o:0,l.stack=e.stack,l.percent=e.percent,l}transformSpec(e){var i;super.transformSpec(e),((i=e.axes)!==null&&i!==void 0?i:[]).forEach(n=>{["domainLine","grid","label","tick"].forEach(o=>{n[o]||(n[o]={visible:!1})}),n.orient==="angle"&&isNil(n.bandPosition)&&(n.bandPosition=.5)}),e.crosshair=array(e.crosshair||{}).map(n=>mergeSpec({categoryField:{visible:!0,line:{visible:!0,type:"rect"}}},n))}}class RoseChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=RoseChartSpecTransformer,this.type="rose",this.seriesType=SeriesTypeEnum.rose}}RoseChart.type="rose",RoseChart.seriesType=SeriesTypeEnum.rose,RoseChart.transformerConstructor=RoseChartSpecTransformer,mixin(RoseChart,StackChartMixin);const registerRoseChart=()=>{registerRoseSeries(),Factory$1.registerChart(RoseChart.type,RoseChart)};class RadarChartSpecTransformer extends RoseLikeChartSpecTransformer{_getDefaultSeriesSpec(e){var i;const n=super._getDefaultSeriesSpec(e);return n.line=e.line,n.point=e.point,n.stack=e.stack,n.percent=e.percent,n.area=mergeSpec({visible:!1},e.area),n.seriesMark=(i=e.seriesMark)!==null&&i!==void 0?i:"area",n.activePoint=e.activePoint,n.pointDis=e.pointDis,n.pointDisMul=e.pointDisMul,n.markOverlap=e.markOverlap,n}transformSpec(e){var i;super.transformSpec(e),((i=e.axes)!==null&&i!==void 0?i:[]).forEach(n=>{n.orient==="radius"&&(["domainLine","label","tick"].forEach(o=>{n[o]||(n[o]={visible:!1})}),n.grid||(n.grid={visible:!0}))}),e.crosshair=array(e.crosshair||{}).map(n=>mergeSpec({categoryField:{visible:!0,line:{visible:!0,type:"line"}}},n))}}class RadarChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=RadarChartSpecTransformer,this.type="radar",this.seriesType=SeriesTypeEnum.radar}}RadarChart.type="radar",RadarChart.seriesType=SeriesTypeEnum.radar,RadarChart.transformerConstructor=RadarChartSpecTransformer,mixin(RadarChart,StackChartMixin);const registerRadarChart=()=>{registerRadarSeries(),Factory$1.registerChart(RadarChart.type,RadarChart)};class CommonChartSpecTransformer extends BaseChartSpecTransformer{_getDefaultSeriesSpec(e){const i=super._getDefaultSeriesSpec(e);return delete i.data,i}_transformAxisSpec(e){e.axes&&e.autoBandSize&&e.series.forEach((i,n)=>{var o;if(i.type==="bar"){const l=this._findBandAxisBySeries(i,n,e.axes);if(l&&!l.bandSize&&!l.maxBandSize&&!l.minBandSize){const u=isObject$1(i.autoBandSize)&&(o=i.autoBandSize.extend)!==null&&o!==void 0?o:0,{barMaxWidth:d,barMinWidth:f,barWidth:g,barGapInGroup:_}=i;this._applyAxisBandSize(l,u,{barMaxWidth:d,barMinWidth:f,barWidth:g,barGapInGroup:_})}}})}transformSpec(e){if(super.transformSpec(e),e.series&&e.series.length){const i=this._getDefaultSeriesSpec(e);e.series.forEach(n=>{this._isValidSeries(n.type)&&Object.keys(i).forEach(o=>{o in n||(n[o]=i[o])})})}e.axes&&e.axes.length&&e.axes.forEach(i=>{get(i,"trimPadding")&&mergeSpec(i,getTrimPaddingConfig(this.type,e))}),this._transformAxisSpec(e)}}class CommonChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=CommonChartSpecTransformer,this.type="common"}}CommonChart.type="common",CommonChart.transformerConstructor=CommonChartSpecTransformer,mixin(CommonChart,StackChartMixin);const registerCommonChart=()=>{Factory$1.registerChart(CommonChart.type,CommonChart)},SCROLL_BAR_DEFAULT_SIZE=12;class SequenceChartSpecTransformer extends BaseChartSpecTransformer{_getSeriesDataLength(e,i){var n,o;if(i.data){const u=array(i.data)[0];return u instanceof DataView?(n=u.latestData)===null||n===void 0?void 0:n.length:(o=u.values)===null||o===void 0?void 0:o.length}const l=array(e.data).find((u,d)=>i.dataId?u instanceof DataView?u.name===i.dataId:u.id===i.dataId:i.dataIndex===d);return l?l instanceof DataView?l.latestData.length:l.values.length:0}addAttrToComponentSpec(e,i,n){return Array.isArray(e)?e[0][i]=n:e[i]=n,e}addPaddingRow(e,i,n){e.push({index:i,size:n})}addOrientAxes(e,i,n,o){e.push({id:`regionAxesRow${n}`}),i.push({modelId:`axesRow${n}`,col:1,row:n}),o.axes[0].id=`axesRow${n}`,o.axes[0].regionIndex=Array.from(Array(o.series.length),(l,u)=>o.axes[0].orient==="top"?u+1:u)}transformSpec(e){var i,n,o,l,u,d,f,g,_,y,b,S,v,A,x;super.transformSpec(e);let T=0;const C=[],E=[],P=[],L=[],R=[],w=(this._option.getCompiler().getVGrammarView().width(),this._option.getCompiler().getVGrammarView().height());let D=0;if(e!=null&&e.legends){C.push({modelId:`legendRow${T}`,col:1,row:T}),this.addAttrToComponentSpec(e.legends,"id",`legendRow${T}`);const H=array(e.legends);let F=(i=H[0].height)!==null&&i!==void 0?i:40;if(H[0].padding){const V=normalizeLayoutPaddingSpec(H[0].padding);F+=Number((n=V==null?void 0:V.bottom)!==null&&n!==void 0?n:0),F+=Number((o=V==null?void 0:V.top)!==null&&o!==void 0?o:0),H[0].offsetY=Number((u=(l=H[0])===null||l===void 0?void 0:l.offsetY)!==null&&u!==void 0?u:0)+Number((d=V==null?void 0:V.top)!==null&&d!==void 0?d:0)}R.push({index:T,size:F}),D+=F,T++}e!=null&&e.dataZoom&&(C.push({modelId:`dataZoomRow${T}`,col:1,row:T}),this.addAttrToComponentSpec(e.dataZoom,"id",`dataZoomRow${T}`),D+=60,T++,this.addPaddingRow(R,T,10),D+=10,T++),D+=60,e.axes!==null&&((g=(f=e==null?void 0:e.axes)===null||f===void 0?void 0:f[0])===null||g===void 0?void 0:g.orient)!=="top"||(this.addOrientAxes(E,C,T,e),T++);const I=e.series.filter(H=>H.type!==SeriesTypeEnum.link).length,O=(w-D-20*I)/I,B=((_=e==null?void 0:e.appendPadding)===null||_===void 0?void 0:_.left)||0,N=((y=e==null?void 0:e.appendPadding)===null||y===void 0?void 0:y.right)||0;(b=e==null?void 0:e.series)===null||b===void 0||b.forEach(H=>{var F,V;if([SeriesTypeEnum.bar,SeriesTypeEnum.line,SeriesTypeEnum.area,SeriesTypeEnum.dot].includes(H.type)){if(C.push({modelId:`${H.type}Row${T}`,col:1,row:T}),C.push({modelId:`axesLeftRow${T}`,col:0,row:T}),E.push({id:`${H.type}Row${T}`,clip:!1}),R.push({index:T,size:(H==null?void 0:H.height)||O}),P.push({orient:"left",id:`axesLeftRow${T}`,type:H.type===SeriesTypeEnum.dot?"band":"linear",visible:H.type!==SeriesTypeEnum.dot,title:{visible:!0,autoRotate:!1,style:{text:H==null?void 0:H.barTitle,dx:-20,textBaseline:"middle",textAlign:"end"}},grid:{visible:typeof((F=H==null?void 0:H.grid)===null||F===void 0?void 0:F.visible)!="boolean"||((V=H==null?void 0:H.grid)===null||V===void 0?void 0:V.visible),style:(G,Y)=>{var J,q,te,de,he;let fe=0;if(Y===0){const pe=(J=H==null?void 0:H.grid)===null||J===void 0?void 0:J.style;fe=(te=(q=pe==null?void 0:pe.lineWidth)!==null&&q!==void 0?q:pe==null?void 0:pe.strokeWidth)!==null&&te!==void 0?te:1}return{lineWidth:fe,stroke:((he=(de=H==null?void 0:H.grid)===null||de===void 0?void 0:de.style)===null||he===void 0?void 0:he.stroke)||"#dfdfdf",lineDash:[0,0]}}},domainLine:{visible:!1},tick:{visible:!1},label:{visible:!1},regionIndex:E.length-1}),H.type===SeriesTypeEnum.dot){C.push({modelId:`scrollBarRightRow${T}`,col:2,row:T});const G=this._getSeriesDataLength(e,H);let Y=0;G&&(Y=((H==null?void 0:H.height)||O)/(30*G)),L.push(Object.assign({orient:"right",visible:H.type===SeriesTypeEnum.dot&&Y<1,id:`scrollBarRightRow${T}`,start:0,end:Math.min(Y,1),filterMode:"axis",regionIndex:E.length-1,axisId:`axesLeftRow${T}`},array(e==null?void 0:e.scrollBar)[0]))}H.regionIndex=E.length-1,T++,this.addPaddingRow(R,T,(H==null?void 0:H.padding)||20),T++,H.leftAppendPadding=B,H.type===SeriesTypeEnum.dot&&(H.title.style.dx=-B,H.subTitle.style.dx=-B)}}),this.addPaddingRow(R,T,20),T++,(S=e==null?void 0:e.series)===null||S===void 0||S.forEach(H=>{if(H.type===SeriesTypeEnum.link){const F=H.dotSeriesIndex+1;C.push({modelId:`${H.type}Row${F}`,col:1,row:F-1}),H.regionIndex=e.series[H.dotSeriesIndex].regionIndex,H.leftAppendPadding=B,H.height=e.series[H.dotSeriesIndex].height,H.clipHeight=e.series[H.dotSeriesIndex].clipHeight}}),e!=null&&e.legends&&this.addAttrToComponentSpec(e.legends,"regionIndex",[E.length-1]),((A=(v=e==null?void 0:e.axes)===null||v===void 0?void 0:v[0])===null||A===void 0?void 0:A.orient)==="bottom"&&(this.addOrientAxes(E,C,T,e),T++);const $={type:"grid",col:4,row:T,colWidth:[{index:0,size:B},{index:2,size:SCROLL_BAR_DEFAULT_SIZE},{index:3,size:N}],rowHeight:R,elements:C};e.layout=$,e.region=E,(x=e.axes)===null||x===void 0||x.push(...P),e.scrollBar=L}}var __rest$8=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class SequenceChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=SequenceChartSpecTransformer,this.type="sequence"}_createSeries(e,i){if(!e)return;const{spec:n}=i,o=__rest$8(i,["spec"]);let l;if(n.type===SeriesTypeEnum.link&&(n.dotSeriesSpec=this._spec.series[n.dotSeriesIndex]),n.regionId&&(l=this.getRegionsInUserId(n.regionId)),l||(l=this.getRegionsInIndex(n.regionIndex?[n.regionIndex]:void 0)[0]),!l)return;const u=new e(n,Object.assign(Object.assign(Object.assign({},this._modelOption),o),{region:l,specKey:"series",globalScale:this._globalScale}));u&&(u.created(),this._series.push(u),l.addSeries(u))}}SequenceChart.type="sequence",SequenceChart.transformerConstructor=SequenceChartSpecTransformer;const registerSequenceChart=()=>{registerDotSeries(),registerLinkSeries(),registerCartesianBandAxis(),registerCartesianLinearAxis(),Factory$1.registerChart(SequenceChart.type,SequenceChart)};class BaseHistogramChartSpecTransformer extends CartesianChartSpecTransformer{transformSpec(e){super.transformSpec(e),e.axes.forEach(i=>i.type="linear")}_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["x2Field","y2Field","barMinHeight","barBackground"])}}class BaseHistogramChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=BaseHistogramChartSpecTransformer}}BaseHistogramChart.transformerConstructor=BaseHistogramChartSpecTransformer,mixin(BaseHistogramChart,StackChartMixin);class HistogramChartSpecTransformer extends BaseHistogramChartSpecTransformer{transformSpec(e){super.transformSpec(e),setDefaultCrosshairForCartesianChart(e)}}class HistogramChart extends BaseHistogramChart{constructor(){super(...arguments),this.transformerConstructor=HistogramChartSpecTransformer,this.type="histogram",this.seriesType=SeriesTypeEnum.bar}}HistogramChart.type="histogram",HistogramChart.seriesType=SeriesTypeEnum.bar,HistogramChart.transformerConstructor=HistogramChartSpecTransformer;const registerHistogramChart=()=>{registerBarSeries(),Factory$1.registerChart(HistogramChart.type,HistogramChart)};class Histogram3dChart extends BaseHistogramChart{constructor(){super(...arguments),this.transformerConstructor=HistogramChartSpecTransformer,this.type="histogram3d",this.seriesType=SeriesTypeEnum.bar3d}}Histogram3dChart.type="histogram3d",Histogram3dChart.seriesType=SeriesTypeEnum.bar3d,Histogram3dChart.transformerConstructor=HistogramChartSpecTransformer;const registerHistogram3dChart=()=>{register3DPlugin(),registerBar3dSeries(),Factory$1.registerChart(Histogram3dChart.type,Histogram3dChart)};class CircularProgressChartSpecTransformer extends ProgressLikeChartSpecTransformer{_getDefaultSeriesSpec(e){var i,n;const o=super._getDefaultSeriesSpec(e);return o.progress=e.progress,o.track=e.track,o.tickMask=e.tickMask,o.cornerRadius=(i=e.cornerRadius)!==null&&i!==void 0?i:0,o.roundCap=(n=e.roundCap)!==null&&n!==void 0&&n,o}transformSpec(e){super.transformSpec(e),this._transformProgressAxisSpec(e,{orient:"angle",visible:!1},{orient:"radius",visible:!1},{forceInitTick:e.tickMask&&e.tickMask.visible!==!1})}}class CircularProgressChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=CircularProgressChartSpecTransformer,this.type="circularProgress",this.seriesType=SeriesTypeEnum.circularProgress}}CircularProgressChart.type="circularProgress",CircularProgressChart.seriesType=SeriesTypeEnum.circularProgress,CircularProgressChart.transformerConstructor=CircularProgressChartSpecTransformer,mixin(CircularProgressChart,StackChartMixin);const registerCircularProgressChart=()=>{registerCircularProgressSeries(),Factory$1.registerChart(CircularProgressChart.type,CircularProgressChart)};class GaugeChartSpecTransformer extends ProgressLikeChartSpecTransformer{_getDefaultSeriesSpec(e){const i=super._getDefaultSeriesSpec(e);return i.radiusField=e.radiusField,i.pin=e.pin,i.pinBackground=e.pinBackground,i.pointer=e.pointer,i}_getDefaultCircularProgressSeriesSpec(e){const i=super._getDefaultSeriesSpec(e);return i.type=SeriesTypeEnum.circularProgress,i}transformSpec(e){var i,n,o,l,u;super.transformSpec(e);let d=(i=e.series)===null||i===void 0?void 0:i.find(f=>f.type===SeriesTypeEnum.gauge||f.type===SeriesTypeEnum.circularProgress);isNil(d)&&(d=(n=e.gauge)!==null&&n!==void 0?n:this._getDefaultCircularProgressSeriesSpec(e),d.type==="circularProgress"&&(isNil(d.radiusField)&&isNil(d.categoryField)&&(d.radiusField=(l=(o=e.radiusField)!==null&&o!==void 0?o:e.categoryField)!==null&&l!==void 0?l:e.seriesField),isNil(d.valueField)&&isNil(d.angleField)&&(d.valueField=(u=e.valueField)!==null&&u!==void 0?u:e.angleField)),e.series.length===1?e.series.push(d):e.series.forEach(f=>{f.type===d.type&&Object.keys(d).forEach(g=>{g in f||(f[g]=d[g])})})),d.type===SeriesTypeEnum.circularProgress?this._transformProgressAxisSpec(e,{orient:"angle",visible:!0,domainLine:{visible:!1},grid:{visible:!1}},{orient:"radius",visible:!1},{zIndex:LayoutZIndex.Region+50}):this._transformGaugeAxisSpec(e)}_transformGaugeAxisSpec(e){var i;e.axes||(e.axes=[]);const n={radius:null,angle:null};((i=e.axes)!==null&&i!==void 0?i:[]).forEach(o=>{const{orient:l}=o;l==="radius"&&(n.radius=o),l==="angle"&&(n.angle=o)}),n.angle||(n.angle={orient:"angle",visible:!0},e.axes.push(n.angle)),n.radius||(n.radius={orient:"radius",visible:!1},e.axes.push(n.radius)),isNil(n.angle.type)&&(n.angle.type="linear"),isNil(n.radius.type)&&(n.radius.type="linear"),isNil(n.angle.zIndex)&&(n.angle.zIndex=LayoutZIndex.Region+50)}}class GaugeChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=GaugeChartSpecTransformer,this.type="gauge",this.seriesType=SeriesTypeEnum.gaugePointer}}GaugeChart.type="gauge",GaugeChart.seriesType=SeriesTypeEnum.gaugePointer,GaugeChart.transformerConstructor=GaugeChartSpecTransformer;const registerGaugeChart=()=>{registerGaugePointerSeries(),registerGaugeSeries(),Factory$1.registerChart(GaugeChart.type,GaugeChart)};class BaseWordCloudChartSpecTransformer extends BaseChartSpecTransformer{transformSpec(e){super.transformSpec(e),this.transformSeriesSpec(e)}_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["nameField","valueField","fontFamilyField","fontWeightField","fontStyleField","colorHexField","colorMode","colorList","rotateAngles","fontWeightRange","fontSizeRange","maskShape","keepAspect","random","wordCloudConfig","wordCloudShapeConfig","word","fillingWord","wordMask"])}}class BaseWordCloudChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=BaseWordCloudChartSpecTransformer,this.type="wordCloud",this.seriesType=SeriesTypeEnum.wordCloud}}BaseWordCloudChart.transformerConstructor=BaseWordCloudChartSpecTransformer;class WordCloudChart extends BaseWordCloudChart{constructor(){super(...arguments),this.transformerConstructor=BaseWordCloudChartSpecTransformer,this.type="wordCloud",this.seriesType=SeriesTypeEnum.wordCloud}}WordCloudChart.type="wordCloud",WordCloudChart.seriesType=SeriesTypeEnum.wordCloud,WordCloudChart.transformerConstructor=BaseWordCloudChartSpecTransformer;const registerWordCloudChart=()=>{registerWordCloudSeries(),Factory$1.registerChart(WordCloudChart.type,WordCloudChart)},registerWordCloudShapeChart=()=>{registerWordCloudShapeSeries(),registerWordCloudSeries(),Factory$1.registerChart(WordCloudChart.type,WordCloudChart)};class WordCloud3dChartSpecTransformer extends BaseWordCloudChartSpecTransformer{_getDefaultSeriesSpec(e){const i=super._getDefaultSeriesSpec(e);return i.depth_3d=e.depth_3d,i}}class WordCloud3dChart extends BaseWordCloudChart{constructor(){super(...arguments),this.transformerConstructor=WordCloud3dChartSpecTransformer,this.type="wordCloud3d",this.seriesType=SeriesTypeEnum.wordCloud3d}}WordCloud3dChart.type="wordCloud3d",WordCloud3dChart.seriesType=SeriesTypeEnum.wordCloud3d,WordCloud3dChart.transformerConstructor=WordCloud3dChartSpecTransformer;const registerWordCloud3dChart=()=>{register3DPlugin(),registerWordCloud3dSeries(),Factory$1.registerChart(WordCloud3dChart.type,WordCloud3dChart)},registerWordCloudShape3dChart=()=>{register3DPlugin(),registerWordCloudShape3dSeries(),register3DPlugin(),registerWordCloud3dSeries(),Factory$1.registerChart(WordCloud3dChart.type,WordCloud3dChart)};class FunnelChartSpecTransformer extends BaseChartSpecTransformer{needAxes(){return!1}_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["categoryField","valueField","funnelAlign","funnelOrient","heightRatio","shape","funnel","transform","outerLabel","transformLabel","isTransform","maxSize","minSize","gap","isCone","range"])}transformSpec(e){super.transformSpec(e),super.transformSeriesSpec(e)}}class FunnelChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=FunnelChartSpecTransformer,this.type="funnel",this.seriesType=SeriesTypeEnum.funnel}}FunnelChart.type="funnel",FunnelChart.seriesType=SeriesTypeEnum.funnel,FunnelChart.transformerConstructor=FunnelChartSpecTransformer;const registerFunnelChart=()=>{registerFunnelSeries(),Factory$1.registerChart(FunnelChart.type,FunnelChart)};class Funnel3dChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=FunnelChartSpecTransformer,this.type="funnel3d",this.seriesType=SeriesTypeEnum.funnel3d}}Funnel3dChart.type="funnel3d",Funnel3dChart.seriesType=SeriesTypeEnum.funnel3d,Funnel3dChart.transformerConstructor=FunnelChartSpecTransformer;const registerFunnel3dChart=()=>{register3DPlugin(),registerFunnel3dSeries(),Factory$1.registerChart(Funnel3dChart.type,Funnel3dChart)};class LinearProgressChartSpecTransformer extends CartesianChartSpecTransformer{needAxes(){return!1}_getDefaultSeriesSpec(e){var i,n;const o=super._getDefaultSeriesSpec(e,["bandWidth","progress","track"]);return o.direction=(i=e.direction)!==null&&i!==void 0?i:"horizontal",o.cornerRadius=(n=e.cornerRadius)!==null&&n!==void 0?n:0,o}transformSpec(e){var i,n;if(super.transformSpec(e),e.axes||(e.axes=[]),e.direction==="vertical"){let o=null,l=null;((i=e.axes)!==null&&i!==void 0?i:[]).forEach(d=>{const{orient:f}=d;f==="left"&&(o=d),f==="bottom"&&(l=d)}),o||(o={orient:"left",visible:!1},e.axes.push(o)),l||(l={orient:"bottom",visible:!1},e.axes.push(l)),isNil(l.type)&&(l.type="band"),isNil(o.type)&&(o.type="linear");const u=getLinearAxisSpecDomain(o,{min:0,max:1});isNil(o.min)&&(o.min=u.min),isNil(o.max)&&(o.max=u.max)}else{let o=null,l=null;((n=e.axes)!==null&&n!==void 0?n:[]).forEach(d=>{const{orient:f}=d;f==="left"&&(o=d),f==="bottom"&&(l=d)}),o||(o={type:"band",orient:"left",visible:!1},e.axes.push(o)),l||(l={orient:"bottom",visible:!1},e.axes.push(l)),isNil(l.type)&&(l.type="linear"),isNil(o.type)&&(o.type="band");const u=getLinearAxisSpecDomain(l,{min:0,max:1});isNil(l.min)&&(l.min=u.min),isNil(l.max)&&(l.max=u.max)}}}class LinearProgressChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=LinearProgressChartSpecTransformer,this.type="linearProgress",this.seriesType=SeriesTypeEnum.linearProgress}}LinearProgressChart.type="linearProgress",LinearProgressChart.seriesType=SeriesTypeEnum.linearProgress,LinearProgressChart.transformerConstructor=LinearProgressChartSpecTransformer,mixin(LinearProgressChart,StackChartMixin);const registerLinearProgressChart=()=>{registerLinearProgressSeries(),Factory$1.registerChart(LinearProgressChart.type,LinearProgressChart)};class RangeColumnChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){var i,n;const o=super._getDefaultSeriesSpec(e,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barBackground","barMinHeight","stackCornerRadius","bar"]);return e.direction==="horizontal"?o.xField=(i=e.xField)!==null&&i!==void 0?i:[e.minField,e.maxField]:o.yField=(n=e.yField)!==null&&n!==void 0?n:[e.minField,e.maxField],o}transformSpec(e){super.transformSpec(e),setDefaultCrosshairForCartesianChart(e)}}class RangeColumnChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=RangeColumnChartSpecTransformer,this.type="rangeColumn",this.seriesType=SeriesTypeEnum.rangeColumn}}RangeColumnChart.type="rangeColumn",RangeColumnChart.seriesType=SeriesTypeEnum.rangeColumn,RangeColumnChart.transformerConstructor=RangeColumnChartSpecTransformer;const registerRangeColumnChart=()=>{registerRangeColumnSeries(),Factory$1.registerChart(RangeColumnChart.type,RangeColumnChart)};class RangeColumn3dChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){var i,n;const o=super._getDefaultSeriesSpec(e,["bar3d","barGapInGroup"]);return e.direction==="horizontal"?o.xField=(i=e.xField)!==null&&i!==void 0?i:[e.minField,e.maxField]:o.yField=(n=e.yField)!==null&&n!==void 0?n:[e.minField,e.maxField],o}}class RangeColumn3dChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=RangeColumn3dChartSpecTransformer,this.type="rangeColumn3d",this.seriesType=SeriesTypeEnum.rangeColumn3d}}RangeColumn3dChart.type="rangeColumn3d",RangeColumn3dChart.seriesType=SeriesTypeEnum.rangeColumn3d,RangeColumn3dChart.transformerConstructor=RangeColumn3dChartSpecTransformer;const registerRangeColumn3dChart=()=>{register3DPlugin(),registerRangeColumn3dSeries(),Factory$1.registerChart(RangeColumn3dChart.type,RangeColumn3dChart)};class SunburstChartSpecTransformer extends BaseChartSpecTransformer{_getDefaultSeriesSpec(e){const i=isValid(e.startAngle)?e.startAngle:POLAR_START_ANGLE,n=isValid(e.endAngle)?e.endAngle:i+radianToDegree(2*Math.PI),o=super._getDefaultSeriesSpec(e,["categoryField","valueField","centerX","centerY","offsetX","offsetY","innerRadius","outerRadius","gap","labelLayout","label","labelAutoVisible","drill","drillField"]);return o.startAngle=i,o.endAngle=n,o}transformSpec(e){super.transformSpec(e),this.transformSeriesSpec(e)}}class SunburstChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=SunburstChartSpecTransformer,this.type="sunburst",this.seriesType=SeriesTypeEnum.sunburst}}SunburstChart.type="sunburst",SunburstChart.seriesType=SeriesTypeEnum.sunburst,SunburstChart.transformerConstructor=SunburstChartSpecTransformer;const registerSunburstChart=()=>{registerSunBurstSeries(),Factory$1.registerChart(SunburstChart.type,SunburstChart)};class CirclePackingChartSpecTransformer extends BaseChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["categoryField","valueField","layoutPadding","circlePacking","drill","drillField"])}transformSpec(e){super.transformSpec(e),this.transformSeriesSpec(e)}}class CirclePackingChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=CirclePackingChartSpecTransformer,this.type="circlePacking",this.seriesType=SeriesTypeEnum.circlePacking}}CirclePackingChart.type="circlePacking",CirclePackingChart.seriesType=SeriesTypeEnum.circlePacking,CirclePackingChart.transformerConstructor=CirclePackingChartSpecTransformer;const registerCirclePackingChart=()=>{registerCirclePackingSeries(),Factory$1.registerChart(CirclePackingChart.type,CirclePackingChart)};class TreemapChartSpecTransformer extends BaseChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["categoryField","valueField","aspectRatio","splitType","maxDepth","gapWidth","nodePadding","minVisibleArea","minChildrenVisibleArea","minChildrenVisibleSize","roam","drill","drillField","leaf","nonLeaf","nonLeafLabel"])}transformSpec(e){super.transformSpec(e),this.transformSeriesSpec(e)}}class TreemapChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=TreemapChartSpecTransformer,this.type="treemap",this.seriesType=SeriesTypeEnum.treemap}}TreemapChart.type="treemap",TreemapChart.seriesType=SeriesTypeEnum.treemap,TreemapChart.transformerConstructor=TreemapChartSpecTransformer;const registerTreemapChart=()=>{registerTreemapSeries(),Factory$1.registerChart(TreemapChart.type,TreemapChart)};class WaterfallChartSpecTransformer extends BarChartSpecTransformer{transformSpec(e){super.transformSpec(e),e.legends&&array(e.legends).forEach(i=>{i.select=!1,i.hover=!1,i.filter=!1}),setDefaultCrosshairForCartesianChart(e)}_getDefaultSeriesSpec(e){const i=super._getDefaultSeriesSpec(e);return i.bar=e.bar,i.stackLabel=e.stackLabel,i.leaderLine=e.leaderLine,i.total=e.total,i}}class WaterfallChart extends BarChart{constructor(){super(...arguments),this.transformerConstructor=WaterfallChartSpecTransformer,this.type="waterfall",this.seriesType=SeriesTypeEnum.waterfall}}WaterfallChart.type="waterfall",WaterfallChart.seriesType=SeriesTypeEnum.waterfall,WaterfallChart.transformerConstructor=WaterfallChartSpecTransformer;const registerWaterfallChart=()=>{registerWaterfallSeries(),Factory$1.registerChart(WaterfallChart.type,WaterfallChart)};class BoxPlotChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){var i;const n=[e.maxField,e.medianField,e.q1Field,e.q3Field,e.minField,e.outliersField],o=super._getDefaultSeriesSpec(e,["boxPlot","minField","maxField","q1Field","medianField","q3Field","outliersField","outliersStyle"]);return o.direction=(i=e.direction)!==null&&i!==void 0?i:"vertical",o[o.direction==="horizontal"?"xField":"yField"]=n,o}transformSpec(e){super.transformSpec(e),e.axes||(e.axes=[{orient:"bottom"},{orient:"left"}]),setDefaultCrosshairForCartesianChart(e)}}class BoxPlotChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=BoxPlotChartSpecTransformer,this.type="boxPlot",this.seriesType=SeriesTypeEnum.boxPlot}}BoxPlotChart.type="boxPlot",BoxPlotChart.seriesType=SeriesTypeEnum.boxPlot,BoxPlotChart.transformerConstructor=BoxPlotChartSpecTransformer;const registerBoxplotChart=()=>{registerBoxplotSeries(),Factory$1.registerChart(BoxPlotChart.type,BoxPlotChart)};class SankeyChartSpecTransformer extends BaseChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["categoryField","valueField","sourceField","targetField","direction","nodeAlign","crossNodeAlign","nodeGap","nodeWidth","linkWidth","minStepWidth","minNodeHeight","maxNodeHeight","minLinkHeight","maxLinkHeight","dropIsolatedNode","nodeHeight","linkHeight","equalNodeHeight","linkOverlap","iterations","nodeKey","linkSortBy","nodeSortBy","setNodeLayer","node","link","emphasis","inverse","overflow"])}transformSpec(e){super.transformSpec(e),this.transformSeriesSpec(e)}}class SankeyChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=SankeyChartSpecTransformer,this.type="sankey",this.seriesType=SeriesTypeEnum.sankey}_setStateInDatum(e,i,n,o,l){const u=isArray(n)?n[0]:n,d=u?Object.keys(u):null;this.getRegionsInQuerier(l).forEach(f=>{if(!u)return void f.interaction.clearEventElement(e,!0);let g=!1;f.getSeries().forEach(_=>{var y,b;let S=null;_.getMarksWithoutRoot().forEach(v=>{if(v.type==="text")return;let A=null;const x=v.getProduct();x&&((!o||isFunction(o)&&o(_,v))&&(A=x.elements.find(T=>d.every(C=>{var E;let P=(E=T.getDatum())===null||E===void 0?void 0:E.datum;return isArray(P)&&(P=P[0]),u[C]==(P==null?void 0:P[C])}))),A&&(g=!0,f.interaction.startInteraction(e,A),(x.id().includes("node")||x.id().includes("link"))&&(S=A)))}),S&&((b=(y=_)._handleEmphasisElement)===null||b===void 0||b.call(y,{item:S}))}),i&&g&&f.interaction.reverseEventElement(e)})}}SankeyChart.type="sankey",SankeyChart.seriesType=SeriesTypeEnum.sankey,SankeyChart.transformerConstructor=SankeyChartSpecTransformer;const registerSankeyChart=()=>{loadScrollbar(),registerSankeySeries(),Factory$1.registerChart(SankeyChart.type,SankeyChart)};class RangeAreaChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){var i,n;const o=super._getDefaultSeriesSpec(e);return o.area=e.area,e.direction==="horizontal"?o.xField=(i=e.xField)!==null&&i!==void 0?i:[e.minField,e.maxField]:o.yField=(n=e.yField)!==null&&n!==void 0?n:[e.minField,e.maxField],o.stack=!1,o}transformSpec(e){super.transformSpec(e),setDefaultCrosshairForCartesianChart(e)}}class RangeAreaChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=RangeAreaChartSpecTransformer,this.type="rangeArea",this.seriesType=SeriesTypeEnum.rangeArea}}RangeAreaChart.type="rangeArea",RangeAreaChart.seriesType=SeriesTypeEnum.rangeArea,RangeAreaChart.transformerConstructor=RangeAreaChartSpecTransformer;const registerRangeAreaChart=()=>{registerRangeAreaSeries(),Factory$1.registerChart(RangeAreaChart.type,RangeAreaChart)};class HeatmapChartSpecTransformer extends CartesianChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["valueField","cell"])}}class HeatmapChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=HeatmapChartSpecTransformer,this.type="heatmap",this.seriesType=SeriesTypeEnum.heatmap}}HeatmapChart.type="heatmap",HeatmapChart.seriesType=SeriesTypeEnum.heatmap,HeatmapChart.transformerConstructor=HeatmapChartSpecTransformer;const registerHeatmapChart=()=>{registerHeatmapSeries(),Factory$1.registerChart(HeatmapChart.type,HeatmapChart)};class CorrelationChartSpecTransformer extends BaseChartSpecTransformer{_getDefaultSeriesSpec(e){return super._getDefaultSeriesSpec(e,["categoryField","valueField","sizeField","sizeRange","centerX","centerY","innerRadius","outerRadius","startAngle","endAngle","ripplePoint","centerPoint","centerLabel","nodePoint"])}transformSpec(e){super.transformSpec(e),this.transformSeriesSpec(e)}}class CorrelationChart extends BaseChart{constructor(){super(...arguments),this.transformerConstructor=CorrelationChartSpecTransformer,this.type="correlation",this.seriesType=SeriesTypeEnum.correlation}}CorrelationChart.type="correlation",CorrelationChart.seriesType=SeriesTypeEnum.correlation,CorrelationChart.transformerConstructor=CorrelationChartSpecTransformer;const registerCorrelationChart=()=>{registerCorrelationSeries(),Factory$1.registerChart(CorrelationChart.type,CorrelationChart)};function transformLegendTitleAttributes(r){var e,i;const n=Object.assign({},r);return isEmpty(r.style)||(n.textStyle=transformToGraphic(r.style)),isEmpty(r.textStyle)||mergeSpec(n.textStyle,transformToGraphic(r.textStyle)),!((e=r.shape)===null||e===void 0)&&e.style&&transformToGraphic(n.shape.style),!((i=r.background)===null||i===void 0)&&i.style&&transformToGraphic(n.background.style),n}var __rest$7=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};function getLegendAttributes(r,e){const{title:i={},item:n={},pager:o={},background:l={},type:u,id:d,visible:f,orient:g,position:_,data:y,filter:b,regionId:S,regionIndex:v,seriesIndex:A,seriesId:x,padding:T}=r,C=__rest$7(r,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(C.title=transformLegendTitleAttributes(i)),isEmpty(n.focusIconStyle)||transformToGraphic(n.focusIconStyle),n.shape&&(n.shape=transformComponentStyle(n.shape)),n.label&&(n.label=transformComponentStyle(n.label)),n.value&&(n.value=transformComponentStyle(n.value)),n.background&&(n.background=transformComponentStyle(n.background)),isPercent(n.maxWidth)&&(n.maxWidth=Number(n.maxWidth.substring(0,n.maxWidth.length-1))*e.width/100),isPercent(n.width)&&(n.width=Number(n.width.substring(0,n.width.length-1))*e.width/100),isPercent(n.height)&&(n.height=Number(n.height.substring(0,n.height.length-1))*e.width/100),C.item=n,o.type==="scrollbar"?(isEmpty(o.railStyle)||transformToGraphic(o.railStyle),isEmpty(o.sliderStyle)||transformToGraphic(o.sliderStyle)):(isEmpty(o.textStyle)||transformToGraphic(o.textStyle),o.handler&&transformComponentStyle(o.handler)),C.pager=o,l.visible&&!isEmpty(l.style)&&(mergeSpec(C,l.style),isValid(l.padding)&&(C.padding=l.padding)),C}const discreteLegendDataMake=(r,e)=>{const i=[],n={},{series:o,seriesField:l}=e;return o().forEach(u=>{const d=l(u);let f;f=d===u.getSeriesField()?u.getSeriesInfoList():u.getSeriesInfoInField(d),f.forEach(g=>{n[g.key]||(n[g.key]=!0,i.push(g))})}),i},discreteLegendFilter=(r,e)=>{var i,n,o;const{series:l,selected:u,field:d,data:f,customFilter:g}=e,_=u(),y=f();if(_.length===0&&y.length)return[];if(_.length===y.length)return r;const b={};_.forEach(v=>{b[v]=!0});const S=(i=d())!==null&&i!==void 0?i:DEFAULT_DATA_SERIES_FIELD;return g?g(r,_,S):(isArray(r)&&(!((n=r[0])===null||n===void 0)&&n.nodes)?(r[0].nodes=r[0].nodes.filter(v=>b[v.key]===!0),!((o=r[0])===null||o===void 0)&&o.links&&(r[0].links=r[0].links.filter(v=>b[v.source]===!0&&b[v.target]===!0))):isValid(S)&&(r=r.filter(v=>b[l.getSeriesFieldValue(v,S)]===!0)),r)};class BaseLegend extends BaseComponent{constructor(){super(...arguments),this.layoutType="normal",this.layoutZIndex=LayoutZIndex.Legend,this.layoutLevel=LayoutLevel.Legend,this.specKey="legends",this._orient="left",this._visible=!0,this._position="middle",this._preSelectedData=[],this._selectedData=[],this.effect={onSelectedDataChange:()=>{eachSeries(this._regions,e=>{var i;(i=e.getViewData())===null||i===void 0||i.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),eachSeries(this._regions,e=>{e.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}get orient(){return this._orient}get visible(){return this._visible}get position(){return this._position}getLegendData(){return this._legendData.getLatestData()}getSelectedData(){return this._selectedData}setAttrFromSpec(){var e;super.setAttrFromSpec(),this._orient=isValidOrient(this._spec.orient)?this._spec.orient:"left",this._position=(e=this._spec.position)!==null&&e!==void 0?e:"middle",this._visible=this._spec.visible!==!1;const{regionId:i,regionIndex:n,seriesId:o,seriesIndex:l}=this._spec;isValid(o)&&(this._seriesUserId=array(o)),isValid(i)&&(this._regionUserId=array(i)),isValid(l)&&(this._seriesIndex=array(l)),isValid(n)&&(this._regionUserIndex=array(n)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionUserIndex)}created(){super.created(),this.initData()}onRender(e){}_compareSpec(e,i){const n=super._compareSpec(e,i);return n.reRender=!0,(e==null?void 0:e.orient)!==(i==null?void 0:i.orient)?(n.reMake=!0,n):(isEqual(i,e)||(n.reCompile=!0),n)}changeRegions(e){}_bindLegendDataChange(){this._preSelectedData=this._selectedData.slice(),this._initSelectedData()}initData(){const e=this._initLegendData();e.target.addListener("change",this._bindLegendDataChange.bind(this)),this._legendData=new CompilableData(this._option,e),this._initSelectedData(),eachSeries(this._regions,i=>{i.event.on(ChartEvent.rawDataUpdate,{filter:({model:n})=>(n==null?void 0:n.id)===i.id},()=>{this._legendData.getDataView().reRunAllTransform()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}setSelectedData(e){var i,n,o;const l=this._selectedData;isNil(e)||JSON.stringify(l)===JSON.stringify(e)||(eachSeries(this._regions,u=>{u.legendSelectedFilter&&(e=u.legendSelectedFilter(this,e))},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._selectedData=[...e],(n=(i=this.effect).onSelectedDataChange)===null||n===void 0||n.call(i),this.event.emit(ChartEvent.legendSelectedDataChange,{model:this}),(o=this._legendComponent)===null||o===void 0||o.setSelected(this._selectedData))}afterSetLayoutStartPoint(e){if(super.afterSetLayoutStartPoint(e),this._legendComponent){const{x:i,y:n}=e;isValidNumber(i*n)&&this._legendComponent.setAttributes({x:i,y:n})}}getBoundsInRect(e,i){if(!this._visible)return this._legendComponent&&this._legendComponent.parent&&(this._legendComponent.parent.removeChild(this._legendComponent),this._legendComponent=null),{x1:0,y1:0,x2:0,y2:0};const n={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0},o=this._getLegendAttributes(e);if(o.disableTriggerEvent=this._option.disableTriggerEvent,this._legendComponent)isEqual(o,this._cacheAttrs)||this._legendComponent.setAttributes(mergeSpec({},o,{defaultSelected:this._selectedData}));else{const d=new(this._getLegendConstructor())(mergeSpec({},o,{defaultSelected:this._selectedData}));d.name="legend",this._legendComponent=d,this.getContainer().add(d),this._option.disableTriggerEvent||this._initEvent(),d.on("*",(f,g)=>this._delegateEvent(this._legendComponent,f,g))}this._cacheAttrs=o;const l=isFinite(this._legendComponent.AABBBounds.width())?this._legendComponent.AABBBounds.width():0,u=isFinite(this._legendComponent.AABBBounds.height())?this._legendComponent.AABBBounds.height():0;if(this.layoutType!=="normal-inline"){const d=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",f=this._position,{width:g,height:_}=i;let y=0,b=0;d==="horizontal"?f==="middle"?y=(g-l)/2:f==="end"&&(y=g-l):f==="middle"?b=(_-u)/2:f==="end"&&(b=_-u),this._legendComponent.setAttributes({dx:y,dy:b})}return n.x2=n.x1+l,n.y2=n.y1+u,n}onDataUpdate(){var e,i,n;if(JSON.stringify(this._preSelectedData)!==JSON.stringify(this._selectedData)){if(this._legendComponent){const o=this._getLegendAttributes(this.getLayoutRect());isEqual(o,this._cacheAttrs)||this._legendComponent.setAttributes(mergeSpec({},o,{defaultSelected:this._selectedData}))}(i=(e=this.effect).onSelectedDataChange)===null||i===void 0||i.call(e),(n=this.getChart())===null||n===void 0||n.setLayoutTag(!0,null,!1),this.event.emit(ChartEvent.legendSelectedDataChange,{model:this})}}_getNeedClearVRenderComponents(){return[this._legendComponent]}clear(){super.clear(),this._cacheAttrs=null,this._preSelectedData=null}}BaseLegend.specKey="legends";class DiscreteLegend extends BaseLegend{constructor(){super(...arguments),this.type=ComponentTypeEnum.discreteLegend,this.name=ComponentTypeEnum.discreteLegend}static getSpecInfo(e){return getSpecInfo(e,this.specKey,this.type,i=>!i.type||i.type==="discrete")}init(e){super.init(e),eachSeries(this._regions,i=>{i.addViewDataFilter({type:"discreteLegendFilter",options:{series:i,selected:()=>this._selectedData,field:()=>this._getSeriesLegendField(i),data:()=>this.getLegendDefaultData(),customFilter:this._spec.customFilter},level:TransformLevel.legendFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}_initLegendData(){registerDataSetInstanceTransform(this._option.dataSet,"discreteLegendFilter",discreteLegendFilter),registerDataSetInstanceTransform(this._option.dataSet,"discreteLegendDataMake",discreteLegendDataMake);const e=new DataView(this._option.dataSet,{name:`${this.type}_${this.id}_data`});return e.transform({type:"discreteLegendDataMake",options:{series:()=>{const i=[];return eachSeries(this._regions,n=>{i.push(n)},{specIndex:this._spec.seriesIndex,userId:this._spec.seriesId}),i},seriesField:i=>this._getSeriesLegendField(i)}}),e}_getSeriesLegendField(e){var i,n,o;const l=e.getSeriesField(),u=(i=this._spec.scaleName)!==null&&i!==void 0?i:this._spec.scale;if(isNil(u)||!e.getRawData())return l;const d=this._option.globalScale.getScaleSpec(u);if(!d)return l;if(this._spec.field)return this._spec.field;if(!isDataDomainSpec(d.domain))return l;const f=d.domain.find(g=>g.dataId===e.getRawData().name);return f&&(o=(n=f.fields)===null||n===void 0?void 0:n[0])!==null&&o!==void 0?o:l}_initSelectedData(){const e=this.getLegendDefaultData();if(this._unselectedData){const i=[],n=[];e.forEach(o=>{this._unselectedData.includes(o)?n.push(o):i.push(o)}),this._selectedData=i,this._unselectedData=n}else this._spec.defaultSelected?this._selectedData=[...this._spec.defaultSelected]:this._selectedData=e}getLegendDefaultData(e){return isFunction(this._spec.data)?this._getLegendItems().map(i=>i.label):this._legendData.getLatestData().map(e?i=>i.originalKey:i=>i.key)}_addDefaultTitleText(e){var i,n,o,l;if(!((i=e.title)===null||i===void 0)&&i.visible&&isNil(e.title.text)&&isNil((n=e.title.style)===null||n===void 0?void 0:n.text)){const u=(l=(o=this._regions)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.getSeries()[0];if(!u)return;e.title.text=getFieldAlias(u.getRawData(),u.getSeriesField())}}_getLegendAttributes(e){const i=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",n=Object.assign(Object.assign({layout:i,items:this._getLegendItems(),zIndex:this.layoutZIndex},getLegendAttributes(this._spec,e)),{maxWidth:e.width,maxHeight:e.height});return this._addDefaultTitleText(n),this._addLegendItemFormatMethods(n),n}_getLegendConstructor(){return DiscreteLegend$1}setSelectedData(e){e&&(this._unselectedData=this.getLegendDefaultData().filter(i=>!e.includes(i))),super.setSelectedData(e)}_initEvent(){if(this._legendComponent){const e=this._spec.filter!==!1;this._legendComponent.addEventListener(LegendEvent.legendItemClick,i=>{const n=get(i,"detail.currentSelected");e&&this.setSelectedData(n),this.event.emit(ChartEvent.legendItemClick,{model:this,value:n,event:i})}),this._legendComponent.addEventListener(LegendEvent.legendItemHover,i=>{const n=get(i,"detail");this.event.emit(ChartEvent.legendItemHover,{model:this,value:n,event:i})}),this._legendComponent.addEventListener(LegendEvent.legendItemUnHover,i=>{const n=get(i,"detail");this.event.emit(ChartEvent.legendItemUnHover,{model:this,value:n,event:i})})}}_getLegendItems(){const e=(this._legendData.getLatestData()||[]).map(i=>{var n,o;const l=i.style("fillOpacity"),u=i.style("strokeOpacity"),d=i.style("opacity"),f=i.style("texture");return{label:i.key,shape:{symbolType:(o=(n=i.style("symbolType"))!==null&&n!==void 0?n:i.shapeType)!==null&&o!==void 0?o:"circle",fillOpacity:isValidNumber(l)?l:1,strokeOpacity:isValidNumber(u)?u:1,opacity:isValidNumber(d)?d:1,texturePadding:f?1:null,textureSize:f?4:null,texture:f,fill:i.style("fill"),stroke:i.style("stroke"),textureColor:i.style("textureColor"),innerBorder:i.style("innerBorder"),outerBorder:i.style("outerBorder"),lineDash:i.style("lineDash"),lineDashOffset:i.style("lineDashOffset"),lineWidth:i.style("lineWidth")}}});return isFunction(this._spec.data)?this._spec.data(e,this._option.globalScale.getScale("color"),this._option.globalScale):e}_addLegendItemFormatMethods(e){var i,n,o,l;const{formatMethod:u,formatter:d}=(n=(i=this._spec.item)===null||i===void 0?void 0:i.label)!==null&&n!==void 0?n:{},{formatMethod:f,formatter:g}=(l=(o=this._spec.item)===null||o===void 0?void 0:o.value)!==null&&l!==void 0?l:{},{formatFunc:_}=getFormatFunction(u,d);d&&!u&&_&&(e.item.label.formatMethod=(b,S)=>_(b,S,d));const{formatFunc:y}=getFormatFunction(f,g);g&&!f&&y&&(e.item.value.formatMethod=(b,S)=>y(g,b,S,d))}}DiscreteLegend.specKey="legends",DiscreteLegend.type=ComponentTypeEnum.discreteLegend;const registerDiscreteLegend=()=>{Factory$1.registerComponent(DiscreteLegend.type,DiscreteLegend)},continuousLegendDataMake=(r,e)=>{const{series:i,field:n,scale:o}=e,l=n();if(n&&l){let u=1/0,d=-1/0;return i().forEach(f=>{const g=f.getRawDataStatisticsByField(l,!0),_=g==null?void 0:g.min,y=g==null?void 0:g.max;isValidNumber(_)&&(u=Math.min(_,u)),isValidNumber(y)&&(d=Math.max(y,d))}),[u,d]}if(o){const u=o();return u?u.domain():[]}return[]},continuousLegendFilter=(r,e)=>{const{selected:i,field:n,data:o,isHierarchyData:l,customFilter:u}=e,d=i(),f=n(),g=l||(_=>_&&_.some(y=>y&&isHierarchyItem(y)));if(d===o())return r;if(f&&!isEmpty(d)){const[_,y]=d;return u?u(r,d,f):g(r)?filterHierarchyDataByRange(r,+_,+y,f):r.filter(b=>b[f]>=_&&b[f]<=y)}return r};var __rest$6=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};function getContinuousLegendAttributes(r){const e=mergeSpec({},r),{title:i={},handler:n={},rail:o={},track:l={},startText:u,endText:d,handlerText:f,sizeBackground:g,background:_={},type:y,id:b,visible:S,orient:v,position:A,data:x,defaultSelected:T,field:C,filter:E,regionId:P,regionIndex:L,seriesIndex:R,seriesId:w,padding:D}=e,I=__rest$6(e,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(I.title=transformLegendTitleAttributes(i)),I.showHandler=n.visible!==!1,isEmpty(n.style)||(I.handlerStyle=transformToGraphic(n.style)),isValid(o.width)&&(I.railWidth=o.width),isValid(o.height)&&(I.railHeight=o.height),isEmpty(o.style)||(I.railStyle=transformToGraphic(o.style)),isEmpty(l.style)||(I.trackStyle=transformToGraphic(l.style)),I.startText=transformComponentStyle(u),I.endText=transformComponentStyle(d),I.handlerText=transformComponentStyle(f),isEmpty(g)||(I.sizeBackground=transformToGraphic(g)),_.visible&&!isEmpty(_.style)&&(mergeSpec(I,_.style),isValid(_.padding)&&(I.padding=_.padding)),I}function isContinuousLegend(r){return r==="color"||r==="size"}const ContinuousLegendMap={color:ColorContinuousLegend,size:SizeContinuousLegend},SINGLE_SEQUENCE=["#C4E7FF","#98CAFF","#75ACFF","#518FF9","#2775DC","#005CBE","#00429F","#00287E"],SIZE=[2,10];class ContinuousLegend extends BaseLegend{static getSpecInfo(e){const i=getSpecInfo(e,this.specKey,this.type,n=>isContinuousLegend(n.type));return i&&i.forEach(n=>{n.type=n.spec.type==="color"?ComponentTypeEnum.colorLegend:ComponentTypeEnum.sizeLegend}),i}constructor(e,i){super(e,i),this.type=ComponentTypeEnum.colorLegend,this.name=ComponentTypeEnum.colorLegend;const n=this._spec.type==="color"?ComponentTypeEnum.colorLegend:ComponentTypeEnum.sizeLegend;this.type=n,this.name=n}setAttrFromSpec(){super.setAttrFromSpec(),this._field=this._spec.field,this._legendType=this._spec.type}init(e){super.init(e),eachSeries(this._regions,i=>{i.addViewDataFilter({type:"continuousLegendFilter",options:{selected:()=>this._selectedData,field:()=>this._field,data:()=>this._legendData.getLatestData(),isHierarchyData:i.isHierarchyData,customFilter:this._spec.customFilter},level:TransformLevel.legendFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}_getScaleInGlobal(){const e=this._option.globalScale;let i=this._spec.scale;return i||(i=this._legendType),e.getScale(i)}_initLegendData(){registerDataSetInstanceTransform(this._option.dataSet,"continuousLegendFilter",continuousLegendFilter),registerDataSetInstanceTransform(this._option.dataSet,"continuousLegendDataMake",continuousLegendDataMake);const e=new DataView(this._option.dataSet,{name:`${this.type}_${this.id}_data`});return e.transform({type:"continuousLegendDataMake",options:{series:()=>getSeries(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}),field:()=>this._field,scale:this._getScaleInGlobal.bind(this)}}),e}_initSelectedData(){this._spec.defaultSelected?this._selectedData=this._spec.defaultSelected.slice():this._selectedData=this._legendData.getLatestData()}_addDefaultTitleText(e){var i,n,o,l;if(!((i=e.title)===null||i===void 0)&&i.visible&&isNil(e.title.text)&&isNil((n=e.title.style)===null||n===void 0?void 0:n.text)){const u=this._field;if(u){const _=(l=(o=this._regions)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.getSeries()[0];return _?void(e.title.text=getFieldAlias(_.getRawData(),u)):void 0}let d=this._spec.scale;d||(d=this._legendType);const f=this._option.globalScale.getScaleSpec(d);if(!isDataDomainSpec(f==null?void 0:f.domain))return;const g=f.domain[0];if(g.fields.length===0)return;e.title.text=getFieldAlias(this._option.dataSet.getDataView(g.dataId),g.fields[0])}}_getLegendAttributes(e){var i,n;const o=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",l=o==="horizontal"?"bottom":this.layoutOrient;let u=[];const d=this._getScaleInGlobal();d&&d.type==="linear"&&(u=d.range()),isEmpty(u)&&(u=this._legendType==="color"?SINGLE_SEQUENCE:SIZE);let f=(i=this._legendData.getLatestData()[0])!==null&&i!==void 0?i:0,g=(n=this._legendData.getLatestData()[1])!==null&&n!==void 0?n:1;this._legendData.getLatestData()[0]===this._legendData.getLatestData()[1]&&(f=Math.min(0,this._legendData.getLatestData()[0]),g=this._legendData.getLatestData()[0]===0?1:Math.max(0,this._legendData.getLatestData()[0]));const _=Object.assign({layout:o,align:l,zIndex:this.layoutZIndex,min:f,max:g,value:this._spec.defaultSelected,[this._legendType==="color"?"colors":"sizeRange"]:u},getContinuousLegendAttributes(this._spec));return this._addDefaultTitleText(_),_}_getLegendConstructor(){return ContinuousLegendMap[this._legendType]}_initEvent(){if(this._legendComponent){const e=this._spec.filter!==!1;this._legendComponent.addEventListener("change",debounce(i=>{const n=get(i,"detail.value");e&&this.setSelectedData(n),this.event.emit(ChartEvent.legendFilter,{model:this,value:n,event:i})},30))}}}ContinuousLegend.specKey="legends",ContinuousLegend.type=ComponentTypeEnum.continuousLegend;const registerContinuousLegend=()=>{Factory$1.registerComponent(ContinuousLegend.type,ContinuousLegend)},getDataArrayFromFieldArray=(r,e)=>isValid(e)?r.map(i=>e[i]):void 0,datumContainsArray=(r,e)=>i=>r.every((n,o)=>i[n]===(e==null?void 0:e[o])),hasData=r=>!isNil(r)&&(isArray(r)?r.length>0&&r.every(isValid):Object.keys(r).length>0);function showTooltip(r,e,i){var n,o,l;const u=Object.assign({regionIndex:0},e),d=i.getOption(),f=d.getRegionsInUserIdOrIndex(isValid(u.regionId)?[u.regionId]:void 0,isValid(u.regionIndex)?[u.regionIndex]:void 0)[0];if(!f)return"none";const g=getMarkInfoList(r,f),_=(n=u.activeType)!==null&&n!==void 0?n:g.length>1?"dimension":"mark",y=f.getLayoutStartPoint(),b=f.getLayoutRect(),S=d.globalInstance.getContainer(),v=Object.assign({x:0,y:0},S?getElementAbsolutePosition(S):{}),A=T=>{var C;const{dimensionFields:E,dimensionData:P,measureFields:L,measureData:R,groupField:w,groupData:D}=T.data;return(C=T.series.getViewData())===null||C===void 0?void 0:C.latestData.find(O=>datumContainsArray(E,P)(O)&&datumContainsArray(L,R)(O)&&(isNil(w)||datumContainsArray([w],[D])(O)))},x=T=>{var C,E;const P=(w=>({x:Math.min(Math.max(w.x,0),b.width),y:Math.min(Math.max(w.y,0),b.height)}))(T),L=(C=u.x)!==null&&C!==void 0?C:y.x+P.x,R=(E=u.y)!==null&&E!==void 0?E:y.y+P.y;return{canvasX:L,canvasY:R,clientX:v.x+L,clientY:v.y+R}};if(_==="dimension"){const T=g[0];if(!T)return"none";const C=new Map;g.forEach(R=>{var w;C.has(R.series)||C.set(R.series,[]),(w=C.get(R.series))===null||w===void 0||w.push(R)});const E=[{value:r[T.data.dimensionFields[0]],data:[...C.keys()].map(R=>{var w,D;return{series:R,datum:(D=(w=C.get(R))===null||w===void 0?void 0:w.map(I=>A(I)))!==null&&D!==void 0?D:[]}})}];isValid(T.dimType)&&(E[0].position=T.pos[T.dimType],E[0].dimType=T.dimType);const P={changePositionOnly:!1,action:"enter",tooltip:null,dimensionInfo:E,chart:(o=d.globalInstance.getChart())!==null&&o!==void 0?o:void 0,datum:void 0,model:void 0,source:Event_Source_Type.chart,event:x({x:g.reduce((R,w)=>R+w.pos.x,0)/g.length,y:g.reduce((R,w)=>R+w.pos.y,0)/g.length}),item:void 0,itemMap:new Map};i.processor.dimension.showTooltip(E,P,!1);const L=d.globalInstance;return VChart.globalConfig.uniqueTooltip&&VChart.hideTooltip(L.id),_}if(_==="mark"){const T=g[0];if(!T)return"none";const C=Object.assign(Object.assign({},A(T)),r),E=[{datum:[C],series:T.series}],P={changePositionOnly:!1,tooltip:null,dimensionInfo:[{value:C[T.data.dimensionFields[0]],data:E}],chart:(l=d.globalInstance.getChart())!==null&&l!==void 0?l:void 0,datum:C,model:T.series,source:Event_Source_Type.chart,event:x(T.pos),item:void 0,itemMap:new Map};i.processor.mark.showTooltip({datum:C,mark:null,series:T.series},P,!1);const L=d.globalInstance;return VChart.globalConfig.uniqueTooltip&&VChart.hideTooltip(L.id),_}return"none"}const getMarkInfoList=(r,e)=>{const i=e.getSeries(),n=[];return i.forEach(o=>{var l,u,d,f,g,_,y;const b=o.getDimensionField(),S=o.getMeasureField(),v=o.getSeriesField(),A=isValid(v)?r[v]:void 0,x=isValid(v)&&(f=(d=(u=(l=o.getViewDataStatistics)===null||l===void 0?void 0:l.call(o))===null||u===void 0?void 0:u.latestData[v])===null||d===void 0?void 0:d.values)!==null&&f!==void 0?f:[],T=getDataArrayFromFieldArray(b,r);let C=getDataArrayFromFieldArray(S,r);const E=hasData(C),P=!E&&isValid(v)&&isNil(A)&&x.length>0,L=()=>{var R;const w=(R=o.getViewData())===null||R===void 0?void 0:R.latestData.find(datumContainsArray(b,T));if(!E&&(C=getDataArrayFromFieldArray(S,w),!hasData(C)))return;const D=o.type===SeriesTypeEnum.pie?o.dataToCentralPosition(w):o.dataToPosition(w);isNil(D)||isNaN(D.x)||isNaN(D.y)||n.push({pos:D,data:{dimensionFields:b,dimensionData:T,measureFields:S,measureData:C,hasMeasureData:E,groupField:v,groupData:A},series:o})};if(o.coordinate==="cartesian"){const R=o,w=isDiscrete((_=(g=o.getYAxisHelper())===null||g===void 0?void 0:g.getScale(0))===null||_===void 0?void 0:_.type)?"y":"x",D=b.map((O,B)=>[O,B]).filter(([,O])=>isNil(T==null?void 0:T[O]));let I=[T??[]];D.length>0&&D.forEach(([O,B])=>{var N,$,H,F;const V=(F=(H=($=(N=o.getViewDataStatistics)===null||N===void 0?void 0:N.call(o))===null||$===void 0?void 0:$.latestData[O])===null||H===void 0?void 0:H.values)!==null&&F!==void 0?F:[],G=[];I.forEach(Y=>{V.forEach(J=>{var q;const te=(q=Y==null?void 0:Y.slice())!==null&&q!==void 0?q:[];te[B]=J,G.push(te)})}),I=G}),I.forEach(O=>{var B,N;if(P){const $=(B=R.getViewData())===null||B===void 0?void 0:B.latestData.filter(datumContainsArray(b,O));x.forEach(H=>{const F=$.find(G=>G[v]===H);if(C=getDataArrayFromFieldArray(S,F),!hasData(C))return;const V=R.dataToPosition(F);isNil(V)||isNaN(V.x)||isNaN(V.y)||n.push({pos:V,data:{dimensionFields:b,dimensionData:O,measureFields:S,measureData:C,hasMeasureData:E,groupField:v,groupData:H},series:o,dimType:w})})}else{const $=(N=R.getViewData())===null||N===void 0?void 0:N.latestData.find(datumContainsArray(b,O));if(!E&&(C=getDataArrayFromFieldArray(S,$),!hasData(C)))return;const H=R.dataToPosition($);if(isNil(H)||isNaN(H.x)||isNaN(H.y))return;n.push({pos:H,data:{dimensionFields:b,dimensionData:O,measureFields:S,measureData:C,hasMeasureData:E,groupField:v,groupData:A},dimType:w,series:o})}})}else if(o.coordinate==="polar")if(o.type===SeriesTypeEnum.pie)L();else{const R=o;if(P){const w=((y=R.getViewData())===null||y===void 0?void 0:y.latestData.filter(datumContainsArray(b,T))).find(D=>D[v]===A);x.forEach(D=>{if(C=getDataArrayFromFieldArray(S,w),!hasData(C))return;const I=R.dataToPosition(w);isNil(I)||isNaN(I.x)||isNaN(I.y)||n.push({pos:I,data:{dimensionFields:b,dimensionData:T,measureFields:S,measureData:C,hasMeasureData:E,groupField:v,groupData:D},series:o})})}else L()}else o.coordinate==="geo"&&L()}),n},pick_keys=["updateTitle","updateContent","updatePosition","maxLineCount","othersLine"],getTooltipSpecForShow=(r,e,i,n,o)=>{var l,u,d;const f={activeType:r};switch(r){case"mark":case"group":if(i){const g=(l=i.getSpec())===null||l===void 0?void 0:l.tooltip;return f.visible=!0,g!=null&&g.handler&&(f.handler=g.handler),!((u=f.handler)===null||u===void 0)&&u.showTooltip?f:(g!=null&&g[r]&&pick_keys.forEach(_=>{isValid(g[r][_])&&(f[_]=g[r][_])}),Object.assign(Object.assign({},f),i.tooltipHelper.getTooltipData(r,e,n,n[0].datum,o)))}break;case"dimension":if(n!=null&&n.length){if(getSeriesListFromDimensionInfo(n).every(_=>{var y;return!isActiveTypeVisible("dimension",(y=_.tooltipHelper)===null||y===void 0?void 0:y.spec)})?f.visible=!1:f.visible=!0,f.handler=e.handler,(d=f.handler)===null||d===void 0?void 0:d.showTooltip)return f;const g=[];return n.forEach(_=>_.data.forEach(y=>{const{series:b}=y,S=b.tooltipHelper.getTooltipData(r,e,n,y.datum,o);S&&g.push(S)})),combineContents(g)}}return null},getSeriesListFromDimensionInfo=r=>{const e=[];return r.forEach(i=>{i.data.forEach(n=>{isValid(n.series)&&e.push(n.series)})}),e},TooltipHandlerType={dom:`${PREFIX}_TOOLTIP_HANDLER_DOM`,canvas:`${PREFIX}_TOOLTIP_HANDLER_CANVAS`},TOOLTIP_EL_CLASS_NAME="vchart-tooltip-element",TOOLTIP_MAX_LINE_COUNT=20,TOOLTIP_OTHERS_LINE={key:"",value:"..."},TOOLTIP_TYPES=["group","mark","dimension"],DEFAULT_SHOW_DELAY=50;class BaseTooltipProcessor{constructor(e){this._showTooltipByHandler=(i,n)=>{var o,l,u;if(isNil(i))return 1;n.changePositionOnly||this.clearCache(),this._updateViewSpec(i,n);const d=this._cacheActiveSpec;if(isNil(d)||d.visible===!1)return 1;n.tooltipSpec=this.component.getSpec(),n.activeTooltipSpec=d;const{title:f,content:g}=d,_=isNil(f==null?void 0:f.key)&&isNil(f==null?void 0:f.value)&&!(g!=null&&g.length);if(this.component.event.emit(ChartEvent.tooltipShow,Object.assign(Object.assign({},n),{isEmptyTooltip:_,tooltipData:i,activeType:this.activeType,tooltip:this.component})),_)return 1;let y;return!((o=d.handler)===null||o===void 0)&&o.showTooltip?y=d.handler.showTooltip.bind(d.handler):!((l=this.component.tooltipHandler)===null||l===void 0)&&l.showTooltip&&(y=this.component.tooltipHandler.showTooltip.bind(this.component.tooltipHandler)),y?(u=y(this.activeType,i,n))!==null&&u!==void 0?u:0:1},this.component=e}_preprocessDimensionInfo(e){const i=[];if(e==null||e.forEach(n=>{const o=Object.assign(Object.assign({},n),{data:n.data.filter(({series:l})=>{var u,d;return((d=(u=l.getSpec())===null||u===void 0?void 0:u.tooltip)===null||d===void 0?void 0:d.visible)!==!1})});o.data.length>0&&i.push(o)}),i.length>0)return i}_updateViewSpec(e,i){var n,o,l,u,d,f,g,_,y;const{changePositionOnly:b,model:S}=i;if(!b||!this._cacheActiveSpec){const v=this.component.getSpec();if(this._cacheActiveSpec=getTooltipSpecForShow(this.activeType,this.component.getSpec(),S,e,i),this._cacheActiveSpec){isNil(this._cacheActiveSpec.handler)&&isValid(v.handler)&&(this._cacheActiveSpec.handler=v.handler);const A=(n=v[this.activeType])!==null&&n!==void 0?n:{},x=(o=this._cacheActiveSpec.updateTitle)!==null&&o!==void 0?o:A.updateTitle,T=(l=this._cacheActiveSpec.updateContent)!==null&&l!==void 0?l:A.updateContent,C=(d=(u=this._cacheActiveSpec.maxLineCount)!==null&&u!==void 0?u:A.maxLineCount)!==null&&d!==void 0?d:TOOLTIP_MAX_LINE_COUNT;if(x&&(this._cacheActiveSpec.title=(f=x(this._cacheActiveSpec.title,e,i))!==null&&f!==void 0?f:this._cacheActiveSpec.title),T)this._cacheActiveSpec.content=(g=T(this._cacheActiveSpec.content,e,i))!==null&&g!==void 0?g:this._cacheActiveSpec.content;else if(C>=1&&((_=this._cacheActiveSpec.content)===null||_===void 0?void 0:_.length)>C){const E=(y=this._cacheActiveSpec.othersLine)!==null&&y!==void 0?y:A.othersLine,P=E?Object.assign(Object.assign({},TOOLTIP_OTHERS_LINE),E):TOOLTIP_OTHERS_LINE;this._cacheActiveSpec.content=[...this._cacheActiveSpec.content.slice(0,C-1),Object.assign(Object.assign({},this._cacheActiveSpec.content[C-1]),P)]}}}}shouldHandleTooltip(e,i){var n,o;return!isNil(i)&&isActiveTypeVisible(this.activeType,(o=(n=e.model)===null||n===void 0?void 0:n.tooltipHelper)===null||o===void 0?void 0:o.spec)}clearCache(){this._cacheActiveSpec=void 0}}class DimensionTooltipProcessor extends BaseTooltipProcessor{constructor(){super(...arguments),this.activeType="dimension"}showTooltip(e,i,n){const o=Object.assign(Object.assign({},i),{dimensionInfo:this._preprocessDimensionInfo(e),changePositionOnly:n,tooltip:this.component});return this._showTooltipByHandler(e,o)}_getDimensionInfo(e){var i,n;let o;const l=this.component.getChart(),u=l.getCompiler().getStage().getLayer(void 0),d={x:e.event.viewX,y:e.event.viewY};if(u.globalTransMatrix.transformPoint({x:e.event.viewX,y:e.event.viewY},d),o=[...(i=getCartesianDimensionInfo(l,d,!0))!==null&&i!==void 0?i:[],...(n=getPolarDimensionInfo(l,d))!==null&&n!==void 0?n:[]],o.length===0)o=void 0;else if(o.length>1){const f=o.filter(g=>{var _;const y=g.axis;if(y.getSpec().hasDimensionTooltip)return!0;if(!isDiscrete(y.getScale().type))return!1;let b;for(const S of(_=y==null?void 0:y.getRegions())!==null&&_!==void 0?_:[]){for(const v of S.getSeries())if(v.coordinate==="cartesian"){b=v;break}if(isValid(b))break}return isValid(b)&&b.getDimensionField()[0]===b.fieldY[0]?y.getOrient()==="left"||y.getOrient()==="right":y.getOrient()==="bottom"||y.getOrient()==="top"});if(o=f.length?f:o.slice(0,1),o.length>1){const g=new Set;o.forEach(_=>{_.data=_.data.filter(({key:y})=>!g.has(y)&&(g.add(y),!0))})}}return o}getMouseEventData(e){return{tooltipInfo:this._getDimensionInfo(e),ignore:!1}}}class MarkTooltipProcessor extends BaseTooltipProcessor{constructor(){super(...arguments),this.activeType="mark"}showTooltip(e,i,n){var o,l,u;const{datum:d,series:f}=e,g=this.component.getSpec(),_=[{datum:[d],series:f}],y=f.tooltipHelper,b=(o=f.getSpec())===null||o===void 0?void 0:o.tooltip,S=(l=b==null?void 0:b.mark)===null||l===void 0?void 0:l.checkOverlap;let v=!1;if(S===!0||((u=g.mark)===null||u===void 0?void 0:u.checkOverlap)===!0&&S!==!1){const x=y==null?void 0:y.activeTriggerSet.mark;if(x){v=!0;const T=this.component.getChart().getCompiler().getStage().getLayer(void 0),C={x:i.event.viewX,y:i.event.viewY};T.globalTransMatrix.transformPoint({x:i.event.viewX,y:i.event.viewY},C),x.forEach(E=>{E.getProductElements().forEach(P=>{const L=P.getGraphicItem();P!==i.item&&L&&L.containsPoint(C.x,C.y,IContainPointMode.GLOBAL,L.stage.getPickerService())&&_[0].datum.push(P.getDatum())})})}}const A=Object.assign(Object.assign({},i),{changePositionOnly:n,tooltip:this.component});if(n&&v){const x=this._cacheActiveSpec&&this._cacheActiveSpec.data;x&&x[0].series===_[0].series&&x[0].datum.length===_[0].datum.length&&!x[0].datum.some((T,C)=>T!==_[0].datum[C])||(A.changePositionOnly=!1)}return this._showTooltipByHandler(_,A)}getMouseEventData(e){var i;let n,o;if(((i=e.model)===null||i===void 0?void 0:i.modelType)==="series"){const l=e.model,u=l.tooltipHelper,d=u==null?void 0:u.activeTriggerSet.mark,f=u==null?void 0:u.ignoreTriggerSet.mark;d!=null&&d.has(e.mark)?n={mark:e.mark,datum:e.datum,series:l}:f!=null&&f.has(e.mark)&&(o=!0)}return{tooltipInfo:n,ignore:o}}}class GroupTooltipProcessor extends BaseTooltipProcessor{constructor(){super(...arguments),this.activeType="group"}showTooltip(e,i,n){const{datum:o,series:l}=e,u=[{datum:array(o),series:l}],d=Object.assign(Object.assign({},i),{groupDatum:this._getGroupDatum(i),changePositionOnly:n,tooltip:this.component});return this._showTooltipByHandler(u,d)}getMouseEventData(e){var i,n;let o;if(((i=e.model)===null||i===void 0?void 0:i.modelType)==="series"){const l=e.model,u=l.tooltipHelper,d=u==null?void 0:u.activeTriggerSet.group;if(d!=null&&d.has(e.mark)){const f=this.component.getSpec()[this.activeType];(f!=null&&f.triggerMark?array(f.triggerMark):[]).includes((n=e.mark)===null||n===void 0?void 0:n.name)&&(o={mark:e.mark,datum:e.datum,series:l})}}return{tooltipInfo:o,ignore:!1}}_getGroupDatum(e){const{model:i,mark:n,datum:o}=e,l=i;if(["line","area"].includes(n.type))return array(o);const u=l.getViewData().latestData,d=l.getSeriesField();if(!d)return u;const f=array(o)[0][d];return u.filter(g=>g[d]===f)}}const isMarkInfo=r=>isValid(r)&&!isArray(r),isDimensionInfo=r=>isValid(r)&&isArray(r);class TooltipSpecTransformer extends BaseComponentSpecTransformer{_shouldMergeThemeToSpec(){return!1}_initTheme(e,i){var n;const{spec:o,theme:l}=super._initTheme(e,i);return o.style=mergeSpec({},this._theme,o.style),o.offset=mergeSpec({},l.offset,e.offset),o.transitionDuration=(n=e.transitionDuration)!==null&&n!==void 0?n:l.transitionDuration,{spec:o,theme:l}}_transformSpecAfterMergingTheme(e,i,n){var o,l,u,d,f,g,_;super._transformSpecAfterMergingTheme(e,i,n),e.visible=(o=e.visible)===null||o===void 0||o,e.activeType=getTooltipActualActiveType(e),e.renderMode=(l=e.renderMode)!==null&&l!==void 0?l:isMiniAppLikeMode(this._option.mode)||!isTrueBrowser(this._option.mode)?"canvas":"html",e.trigger=(u=e.trigger)!==null&&u!==void 0?u:"hover",e.className=(d=e.className)!==null&&d!==void 0?d:TOOLTIP_EL_CLASS_NAME,e.enterable=(f=e.enterable)!==null&&f!==void 0&&f,e.transitionDuration=(g=e.transitionDuration)!==null&&g!==void 0?g:150,e.confine=(_=e.confine)!==null&&_!==void 0?_:e.renderMode==="canvas",isValid(e.parentElement)?isString(e.parentElement)&&(e.parentElement=vglobal.getElementById(e.parentElement)):isTrueBrowser(this._option.mode)&&(e.parentElement=domDocument==null?void 0:domDocument.body)}}class Tooltip extends BaseComponent{constructor(){super(...arguments),this.layoutZIndex=1,this.type=ComponentTypeEnum.tooltip,this.name=ComponentTypeEnum.tooltip,this.transformerConstructor=TooltipSpecTransformer,this.specKey="tooltip",this.layoutType="none",this._isReleased=!1,this._alwaysShow=!1,this._eventList=[],this._isTooltipShown=!1,this._clickLock=!1,this._mountEvent=(e,i,n)=>{this.event.on(e,i,n),this._eventList.push({eventType:e,handler:n})},this._handleClickToLock=e=>{this._clickLock?(this._handleChartMouseOut(e),this._clickLock=!1):this._clickLock=!0},this._getMouseOutHandler=e=>i=>{var n,o,l,u,d;if(this._isReleased||this._alwaysShow||this._clickLock||!this._isTooltipShown&&!(!((o=(n=this.tooltipHandler)===null||n===void 0?void 0:n.isTooltipShown)===null||o===void 0)&&o.call(n)))return;const f=isTrueBrowser((l=this._option)===null||l===void 0?void 0:l.mode),{clientX:g,clientY:_}=i.event;f&&e&&this._isPointerInChart({x:g,y:_})||(this._enterable?this._outTimer=setTimeout(()=>{this._handleChartMouseOut(i)},(d=(u=this._spec)===null||u===void 0?void 0:u.showDelay)!==null&&d!==void 0?d:DEFAULT_SHOW_DELAY):this._handleChartMouseOut(i))},this._handleChartMouseOut=e=>{this._alwaysShow||this._isReleased||this._spec.triggerOff!=="none"&&(this._hideTooltipByHandler(Object.assign(Object.assign({},e),{tooltip:this})),this._handleMouseMove&&this._handleMouseMove.cancel&&this._handleMouseMove.cancel(),this._cacheEnterableRect=null,this._cacheInfo=void 0,this._cacheParams=void 0,this._cacheActiveType=void 0)},this._getMouseMoveHandler=e=>i=>{var n,o,l,u;this._isReleased||(this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),this._alwaysShow||(this._clickLock?e&&(this._handleChartMouseOut(i),this._clickLock=!1):!e&&this._enterable&&(!((o=(n=this.tooltipHandler)===null||n===void 0?void 0:n.isTooltipShown)===null||o===void 0)&&o.call(n))?(this._showTimer&&clearTimeout(this._showTimer),this._showTimer=setTimeout(()=>{this._handleChartMouseMove(i,e)},(u=(l=this._spec)===null||l===void 0?void 0:l.showDelay)!==null&&u!==void 0?u:DEFAULT_SHOW_DELAY)):this._handleChartMouseMove(i,e)))},this._handleChartMouseMove=(e,i)=>{if(this._isReleased)return;const n=this._getMouseEventData(e),{tooltipInfo:{dimension:o},ignore:{mark:l}}=n,u={mark:!1,dimension:!1,group:!1};for(let d=0,f=TOOLTIP_TYPES.length;d<f;d++){const g=TOOLTIP_TYPES[d];if(this.processor[g]&&this._showTooltipByMouseEvent(g,n,e,i)){u[g]=!0;break}}Object.values(u).every(d=>!d)&&!isEmptyPos(e)&&(l&&isMarkInfo(this._cacheInfo)?u.mark=this._showTooltipByMouseEvent("mark",n,e,i,!0):isValid(o)&&(u.dimension=this._showTooltipByMouseEvent("dimension",n,e,i))),u.mark||u.group||u.dimension&&!isNil(o)?this._initEventOfTooltipContent():this._handleChartMouseOut(e)},this._showTooltipByMouseEvent=(e,i,n,o,l)=>{var u;const d=this.processor[e];if(!d.shouldHandleTooltip(n,i.tooltipInfo[e]))return!1;let f;if(this._hideTimer&&clearTimeout(this._hideTimer),l)f=!d.showTooltip(this._cacheInfo,n,!0);else{const _=i.tooltipInfo[e],y=this._isSameAsCache(_,n,e);f=!d.showTooltip(_,n,y),f&&(this._cacheInfo=_,this._cacheParams=n,this._cacheActiveType=e)}f&&(this._isTooltipShown=!0,o&&this._spec.lockAfterClick&&!this._clickLock?this._clickLock=!0:Number.isFinite(this._spec.hideTimer)&&(this._hideTimer=setTimeout(()=>{this._handleChartMouseOut()},this._spec.hideTimer)));const g=(u=this._option)===null||u===void 0?void 0:u.globalInstance;return f&&VChart.globalConfig.uniqueTooltip&&g&&VChart.hideTooltip(g.id),f},this._getMouseEventData=e=>{const i={tooltipInfo:{},ignore:{}};return Object.keys(this.processor).forEach(n=>{const{tooltipInfo:o,ignore:l}=this.processor[n].getMouseEventData(e);i.tooltipInfo[n]=o,i.ignore[n]=l}),i},this._hideTooltipByHandler=e=>{var i,n,o;if(!this._isTooltipShown&&!(!((n=(i=this.tooltipHandler)===null||i===void 0?void 0:i.isTooltipShown)===null||n===void 0)&&n.call(i)))return 0;this.event.emit(ChartEvent.tooltipHide,Object.assign(Object.assign({},e),{source:Event_Source_Type.chart,tooltip:this})),Object.values(this.processor).forEach(u=>{u.clearCache()});const l=(o=this._spec.handler)!==null&&o!==void 0?o:this.tooltipHandler;if(l.hideTooltip){const u=l.hideTooltip.call(l,e);return u||(this._isTooltipShown=!1),u}return 1},this.hideTooltip=()=>{if(this._isReleased)return!1;const e={changePositionOnly:!1,tooltip:this,item:void 0,datum:void 0,source:Event_Source_Type.chart};return this._alwaysShow=!1,!this._hideTooltipByHandler(e)}}isTooltipShown(){return this._isTooltipShown}changeRegions(e){}_getNeedClearVRenderComponents(){return[]}_registerEvent(){}_releaseEvent(){}onLayout(e){}onLayoutEnd(e){}onRender(e){}created(){super.created(),this._regions=this._option.getAllRegions(),this._initEvent()}release(){var e,i;super.release(),this._isReleased=!0,this._hideTimer&&clearTimeout(this._hideTimer),this._eventList.forEach(({eventType:n,handler:o})=>{this.event.off(n,o)}),this._eventList=[],(i=(e=this.tooltipHandler)===null||e===void 0?void 0:e.release)===null||i===void 0||i.call(e),this._isTooltipShown=!1}beforeRelease(){this.event.emit(ChartEvent.tooltipHide,{tooltip:this,chart:this.getChart()}),this.event.emit(ChartEvent.tooltipRelease,{tooltip:this,chart:this.getChart()})}_initHandler(){var e,i,n;const o=(e=this._spec.renderMode)!==null&&e!==void 0?e:"html",l=this._option.globalInstance.getTooltipHandlerByUser();if(l)this.tooltipHandler=l,this._enterable=!1;else{const u=o==="canvas"?TooltipHandlerType.canvas:TooltipHandlerType.dom,d=Factory$1.getComponentPluginInType(u);d||error$1("Can not find tooltip handler: "+u);const f=new d;f.name=`${this._spec.className}-${(i=this._option.globalInstance.id)!==null&&i!==void 0?i:0}-${this.getSpecIndex()}`,(n=this.pluginService)===null||n===void 0||n.load([f]),this.tooltipHandler=f,this._spec.enterable&&o==="html"&&this.tooltipHandler?(this._enterable=!0,this._needInitEventOfTooltip=!0):this._enterable=!1}}_initEventOfTooltipContent(){var e,i;if(!this._needInitEventOfTooltip)return;const n=(i=(e=this.tooltipHandler).getTooltipContainer)===null||i===void 0?void 0:i.call(e),o=n==null?void 0:n.firstChild;o&&(o.addEventListener("pointerenter",()=>{var l;if(!this._enterable)return;const u=(l=o.getBoundingClientRect)===null||l===void 0?void 0:l.call(o);u&&(this._cacheEnterableRect={x:u.x,y:u.y,width:u.width,height:u.height}),this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this._showTimer&&(clearTimeout(this._showTimer),this._showTimer=null)}),o.addEventListener("pointerleave",()=>{var l,u,d;if(this._enterable&&this._cacheEnterableRect){const f=(l=o.getBoundingClientRect)===null||l===void 0?void 0:l.call(o);f&&Object.keys(this._cacheEnterableRect).every(g=>this._cacheEnterableRect[g]===f[g])&&(this._cacheEnterableRect=null,this._outTimer=setTimeout(this.hideTooltip,(d=(u=this._spec)===null||u===void 0?void 0:u.showDelay)!==null&&d!==void 0?d:DEFAULT_SHOW_DELAY))}}),this._needInitEventOfTooltip=!1)}_initProcessor(){const e=this._spec.activeType;this.processor={},e.includes("dimension")&&(this.processor.dimension=new DimensionTooltipProcessor(this)),e.includes("group")&&(this.processor.group=new GroupTooltipProcessor(this)),e.includes("mark")&&(this.processor.mark=new MarkTooltipProcessor(this))}_initEvent(){var e;if(this._option.disableTriggerEvent)return;const i=array((e=this._spec.trigger)!==null&&e!==void 0?e:"hover"),n=array(this._spec.triggerOff),o=this._option.mode;i.forEach(l=>{var u;l==="hover"?(this._handleMouseMove=this._throttle(this._getMouseMoveHandler(!1)),this._mountEvent("pointermove",{source:"chart"},this._handleMouseMove),(isMobileLikeMode(o)||isMiniAppLikeMode(o))&&(this._mountEvent("pointerdown",{source:"chart"},this._getMouseMoveHandler(!1)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))),this._mountEvent("pointerleave",{source:"chart"},this._getMouseOutHandler(!1))):l==="click"?(this._mountEvent("pointertap",{source:"chart"},this._getMouseMoveHandler(!0)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))):isObject$1(l)&&this._mountEvent(l.eventType,{source:(u=l.source)!==null&&u!==void 0?u:"chart",consume:l.consume},this._getMouseMoveHandler(!0))}),n.filter(l=>isObject$1(l)).forEach(l=>{var u,d;this._mountEvent(l.eventType,{source:(u=l.source)!==null&&u!==void 0?u:"chart",consume:l.consume},this._getMouseOutHandler((d=l.checkOutside)!==null&&d!==void 0&&d))}),!i.includes("click")&&this._spec.lockAfterClick&&this._mountEvent("pointertap",{source:"chart"},this._handleClickToLock)}_throttle(e){let i;return i=isNumber(this._spec.throttleInterval)?this._spec.throttleInterval:this._spec.renderMode==="html"&&this._spec.transitionDuration?50:10,throttle(e,i)}reInit(e){var i,n,o;if(super.reInit(e),this.tooltipHandler){const l=(i=this._spec.renderMode)!==null&&i!==void 0?i:"html",u=this._spec.enterable&&l==="html";u&&!this._enterable&&(this._needInitEventOfTooltip=!0),this._enterable=u,(o=(n=this.tooltipHandler).reInit)===null||o===void 0||o.call(n)}else this._initHandler()}showTooltip(e,i){var n;if(this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),!(!((n=this.tooltipHandler)===null||n===void 0)&&n.showTooltip))return!1;const o=showTooltip(e,i,this);return o!=="none"&&(this._alwaysShow=!!(i!=null&&i.alwaysShow)),o}_isSameAsCache(e,i,n){if(n!==this._cacheActiveType)return!1;if(e===this._cacheInfo)return!0;if(isNil(this._cacheInfo)||isNil(e))return!1;if(isDimensionInfo(e)){if(isMarkInfo(this._cacheInfo))return!1;const u=this._cacheInfo;return u.length===e.length&&e.every((d,f)=>isSameDimensionInfo(d,u[f]))}if(isDimensionInfo(this._cacheInfo))return!1;const o=this._cacheInfo;if(!((e==null?void 0:e.datum)===o.datum&&(e==null?void 0:e.mark)===o.mark&&(e==null?void 0:e.series)===o.series))return!1;const l=this._cacheParams;return!isNil(l)&&!isNil(i)&&l.mark===i.mark&&l.model===i.model&&l.datum===i.datum}_isPointerInChart(e){var i;const n=(i=this._option)===null||i===void 0?void 0:i.globalInstance;if(!n||!n.getChart())return!1;const{x:o,y:l}=e,u=n.getCanvas(),{x:d,y:f,width:g,height:_}=u.getBoundingClientRect();return o>=d&&o<=d+g&&l>=f&&l<=f+_}getVisible(){return this._spec.visible!==!1}}Tooltip.type=ComponentTypeEnum.tooltip,Tooltip.transformerConstructor=TooltipSpecTransformer,Tooltip.specKey="tooltip";const registerTooltip=()=>{Factory$1.registerComponent(Tooltip.type,Tooltip)};function getDefaultCrosshairTriggerEventByMode(r){return r===RenderModeEnum["desktop-browser"]||r===RenderModeEnum["desktop-miniApp"]?{click:"pointertap",hover:"pointermove",hoverOut:"pointerleave",clickOut:"pointerleave"}:isMobileLikeMode(r)||isMiniAppLikeMode(r)?{click:"tap",hover:["pointerdown","pointermove"],hoverOut:"pointerleave",clickOut:"pointerleave"}:null}var LayoutType;(function(r){r[r.ALL=3]="ALL",r[r.HORIZONTAL=2]="HORIZONTAL",r[r.VERTICAL=1]="VERTICAL"})(LayoutType||(LayoutType={}));var __rest$5=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const ORIENT_MAP={x:["top","bottom"],y:["left","right"],category:["angle"],value:["radius"]};class BaseCrossHair extends BaseComponent{get enableRemain(){return this.triggerOff==="none"}constructor(e,i){super(e,i),this.specKey="crosshair",this.layoutType="none",this.gridZIndex=LayoutZIndex.CrossHair_Grid,this.labelZIndex=LayoutZIndex.CrossHair,this.trigger="hover",this._handleIn=n=>{if(!this._option)return;const{x:o,y:l}=this.calculateTriggerPoint(n);this.showDefault=!1,this._layoutCrosshair(o,l);const u=this._getNeedClearVRenderComponents();this._hasActive=u.some(d=>d&&d.attribute.visible!==!1)},this._handleClickInEvent=n=>{if(!this._hasActive||!this._spec.lockAfterClick||this._clickLock)return this._clickLock?(this._clickLock=!1,void this._handleOutEvent()):void(this._onlyLockClick||(this._handleIn(n),isNumber(this.triggerOff)&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._handleOutEvent()},this.triggerOff))));this._clickLock=!0},this._handleHoverInEvent=throttle(n=>{this._clickLock||this._handleIn(n)},10),this._handleOutEvent=()=>{this.enableRemain||this._clickLock||!this._hasActive||(this.clearOutEvent(),this.hide())},this._handleTooltipShow=n=>{const o=n.tooltipData;if(n.isEmptyTooltip||!o||!o.length)return void this._handleTooltipHideOrRelease();if(isObject$1(this._spec.followTooltip)&&this._spec.followTooltip[n.activeType]===!1)return void this._handleTooltipHideOrRelease();const{x:l,y:u}=this.calculateTriggerPoint(n);this.showDefault=!1,this._layoutCrosshair(l,u,o,n.activeType);const d=this._getNeedClearVRenderComponents();this._hasActive=d.some(f=>f&&f.attribute.visible!==!1)},this._handleTooltipHideOrRelease=()=>{this.clearOutEvent(),this.hide()},this.enable=!0,this.showDefault=!0}_getLimitBounds(){var e,i;if(!this._limitBounds){const{width:n,height:o}=(i=(e=this._option.globalInstance.getChart())===null||e===void 0?void 0:e.getViewRect())!==null&&i!==void 0?i:{width:0,height:0};this._limitBounds={x1:0,y1:0,x2:n,y2:o}}return this._limitBounds}_showDefaultCrosshair(){this.showDefault&&this._showDefaultCrosshairBySpec()}setAttrFromSpec(){super.setAttrFromSpec(),this._parseCrosshairSpec()}created(){super.created(),this._initEvent()}_compareSpec(e,i){const n=super._compareSpec(e,i);return n.reMake||isEqual(i,e)||(n.reRender=!0,n.reMake=!0),n}_initEvent(){if(!this._option.disableTriggerEvent)if(this._spec.followTooltip)this._registerTooltipEvent();else{const e=this._getTriggerEvent();e&&e.forEach(i=>{this._registerEvent(i.in,!1,i.click),i.out&&this._registerEvent(i.out,!0)})}}_registerEvent(e,i,n){const o=i?this._handleOutEvent:n?this._handleClickInEvent:this._handleHoverInEvent,l=i?{level:Event_Bubble_Level.chart}:{source:Event_Source_Type.chart};isArray(e)?e.forEach(u=>{this.event.on(u,l,o)}):this.event.on(e,l,o)}_eventOff(e,i,n){const o=i?this._handleOutEvent:n?this._handleClickInEvent:this._handleHoverInEvent;isArray(e)?e.forEach(l=>{this.event.off(l,o)}):this.event.off(e,o)}updateLayoutAttribute(){this._limitBounds=null,this._showDefaultCrosshair()}calculateTriggerPoint(e){const{event:i}=e,n=this._option.getCompiler().getStage().getLayer(void 0),o={x:i.viewX,y:i.viewY};return n.globalTransMatrix.transformPoint({x:i.viewX,y:i.viewY},o),{x:o.x-this.getLayoutStartPoint().x,y:o.y-this.getLayoutStartPoint().y}}_getTriggerEvent(){const{mode:e=RenderModeEnum["desktop-browser"]}=this._option,i=getDefaultCrosshairTriggerEventByMode(e);if(i){const n=array(this.trigger||"hover"),o=u=>u==="click"?this.triggerOff==="none"?null:i.clickOut:i.hoverOut;this._spec.lockAfterClick&&!n.includes("click")?(n.push("click"),this._onlyLockClick=!0):this._onlyLockClick=!1;const l=[];return n.forEach(u=>{l.push({click:u==="click",in:i[u],out:o(u)})}),l}return null}_registerTooltipEvent(){this.event.on(ChartEvent.tooltipHide,{source:Event_Source_Type.chart},this._handleTooltipHideOrRelease),this.event.on(ChartEvent.tooltipShow,{source:Event_Source_Type.chart},this._handleTooltipShow),this.event.on(ChartEvent.tooltipRelease,{source:Event_Source_Type.chart},this._handleTooltipHideOrRelease)}_getAxisInfoByField(e){var i,n;const o=(n=(i=this._option).getComponentsByKey)===null||n===void 0?void 0:n.call(i,"axes");if(!(o!=null&&o.length))return null;let l=get(this._spec,`${e}Field.bindingAxesIndex`);if(l||(l=[],o.forEach((S,v)=>{ORIENT_MAP[e].includes(S.getOrient())&&l.push(v)})),!l.length)return null;const u=new Map;let d=1/0,f=1/0,g=-1/0,_=-1/0;const{x:y,y:b}=this.getLayoutStartPoint();return l.forEach(S=>{d=1/0,f=1/0,g=-1/0,_=-1/0;const v=o.find(A=>A.getSpecIndex()===S);v&&(v.getRegions().forEach(A=>{const{x,y:T}=A.getLayoutStartPoint();d=Math.min(d,x-y),f=Math.min(f,T-b),g=Math.max(g,x+A.getLayoutRect().width-y),_=Math.max(_,T+A.getLayoutRect().height-b)}),u.set(S,{x1:d,y1:f,x2:g,y2:_,axis:v}))}),u}changeRegions(e){}onLayoutEnd(e){const i=this._regions[0];this.setLayoutRect(i.getLayoutRect()),this.setLayoutStartPosition(i.getLayoutStartPoint()),super.onLayoutEnd(e)}onRender(e){}_releaseEvent(){this.clearOutEvent();const e=this._getTriggerEvent();e&&e.forEach(i=>{this._eventOff(i.in,!1,i.click),i.out&&this._eventOff(i.out,!0)})}_parseCrosshairSpec(){this._parseFieldInfo();const{trigger:e,triggerOff:i,labelZIndex:n,gridZIndex:o}=this._spec;e&&(this.trigger=e),(i==="none"||isNumber(i)&&i>0)&&(this.triggerOff=i),n!==void 0&&(this.labelZIndex=n),o!==void 0&&(this.gridZIndex=o)}_parseField(e,i){var n,o,l;const u={},{line:d={},label:f={},visible:g}=e;if(u.visible=g,u.type=d.type||"line",d.visible===!1)u.style={visible:!1};else{const _=d.style||{},{stroke:y,fill:b,lineWidth:S}=_,v=_,{strokeOpacity:A,fillOpacity:x,opacity:T}=v,C=__rest$5(v,["strokeOpacity","fillOpacity","opacity"]),E=u.type==="line";let P=E?A:x;if(isNumber(T)&&(P=(P??1)*T),u.style=Object.assign({opacity:P,pickable:!1,visible:!0},C),E)u.style.stroke=y||b,u.style.lineWidth=get(d,"width",S||2);else{u.style.fill=b||y,!((l=(o=(n=this._spec[i])===null||n===void 0?void 0:n.line)===null||o===void 0?void 0:o.style)===null||l===void 0)&&l.stroke&&(u.style.stroke=this._spec[i].line.style.stroke);const L=get(d,"width");if(typeof L=="string"){const R=parseInt(L.substring(0,L.length-1),10)/100;u.style.sizePercent=R}else typeof L!="number"&&typeof L!="function"||(u.style.size=L)}}if(f.visible){const _=f.labelBackground||{},y=f.style||{},b=_.style||{},{fill:S="rgba(47, 59, 82, 0.9)",stroke:v,outerBorder:A}=b,x=__rest$5(b,["fill","stroke","outerBorder"]);u.label={visible:!0,formatMethod:f.formatMethod,formatter:f.formatter,minWidth:_.minWidth,maxWidth:_.maxWidth,padding:_.padding,textStyle:Object.assign(Object.assign({fontSize:14,pickable:!1},y),{fill:y.fill||"#fff",stroke:get(y,"stroke")}),panel:(isBoolean(_.visible)?_.visible:_)?Object.assign({visible:!0,pickable:!1,fill:S,stroke:v,outerBorder:Object.assign({stroke:S,distance:0,lineWidth:3},A)},x):{visible:!1},zIndex:this.labelZIndex,childrenPickable:!1,pickable:!1}}else u.label={visible:!1};return u}_filterAxisByPoint(e,i,n){return e&&e.forEach(o=>{const l=o.axis;if(outOfBounds(o,i,n)&&e.delete(l.getSpecIndex()),l.type.startsWith("polarAxis")){const u=l.getCenter(),d=l.getInnerRadius(),f=l.getOuterRadius(),g=PointService.distancePP({x:i,y:n},u);(g>f||g<d)&&e.delete(l.getSpecIndex())}}),e}clearOutEvent(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._clickLock&&(this._clickLock=null),this._hasActive&&(this._hasActive=null)}}BaseCrossHair.specKey="crosshair";const layoutByValue$1=(r=3,e,i,n,o,l,u,d=!1,f,g)=>{const _=1&r,y=2&r;i||(i={x:0,y:0});let b=null,S=null,v=0,A=0;if(n.size){const O=Array.from(n.values())[0];v=O.axis.getScale().scale(O.value)+O.axis.getLayoutStartPoint().x-i.x,b=O.axis}if(o.size){const O=Array.from(o.values())[0];A=O.axis.getScale().scale(O.value)+O.axis.getLayoutStartPoint().y-i.y,S=O.axis}const x=!!n.size&&Number.isFinite(v),T=!!o.size&&Number.isFinite(A),C=d&&!x&&isValid(f),E=d&&!T&&isValid(g);let P,L,R;_&&(P=C?f:{height:0,leftPos:0,rightPos:0,topPos:0,x:0,bottom:{visible:!1,text:"",dx:0,dy:0},top:{visible:!1,text:"",dx:0,dy:0},visible:x,axis:b}),y&&(L=E?g:{width:0,leftPos:0,topPos:0,bottomPos:0,y:0,left:{visible:!1,text:"",dx:0,dy:0},right:{visible:!1,text:"",dx:0,dy:0},visible:T,axis:S});let w,D=0,I=0;if(l&&n.forEach(({axis:O,value:B})=>{var N;B=B??"";let $=null;const H=O.getScale();if(isDiscrete(H.type))R=H.bandwidth(),R===0&&H.step&&(D=H.step());else if(isContinuous(H.type)){const F=e.fieldX[0],V=e.fieldX2,G=getDatumByValue(e.getViewData().latestData,+B,F,V);if(G){const Y=e.dataToPositionX(G);V?(R=Math.abs(Y-e.dataToPositionX1(G)),B=`${G[F]} ~ ${G[V]}`):R=1,v=Y}$=O.niceLabelFormatter}if(P&&(!((N=l.label)===null||N===void 0)&&N.visible)&&!C){const F=getAxisLabelOffset(O.getSpec());O.getOrient()==="bottom"?(P.bottom.visible=!0,P.bottom.defaultFormatter=$,P.bottom.text=B,P.bottom.dx=0,P.bottom.dy=F):O.getOrient()==="top"&&(P.top.visible=!0,P.top.defaultFormatter=$,P.top.text=B,P.top.dx=0,P.top.dy=-F)}}),u&&o.forEach(({axis:O,value:B})=>{var N;B=B??"";let $=null;const H=O.getScale();if(isDiscrete(H.type))w=H.bandwidth(),w===0&&H.step&&(I=H.step());else if(isContinuous(H.type)){const F=e.fieldY[0],V=e.fieldY2,G=getDatumByValue(e.getViewData().latestData,+B,F,V);if(G){const Y=e.dataToPositionY(G);V?(w=Math.abs(Y-e.dataToPositionY1(G)),B=`${G[F]} ~ ${G[V]}`):w=1,A=Y}$=O.niceLabelFormatter}if(L&&(!((N=u.label)===null||N===void 0)&&N.visible)&&!E){const F=getAxisLabelOffset(O.getSpec());O.getOrient()==="left"?(L.left.visible=!0,L.left.defaultFormatter=$,L.left.text=B,L.left.dx=-F,L.left.dy=0):O.getOrient()==="right"&&(L.right.visible=!0,L.right.defaultFormatter=$,L.right.text=B,L.right.dx=F,L.right.dy=0)}}),P&&!C){const O={x1:1/0,y1:1/0,x2:-1/0,y2:-1/0};if(setRegionArea(O,n),P.leftPos=O.x1,P.rightPos=O.x2,P.topPos=O.y1,P.height=O.y2-O.y1,P.x=v+i.x,l&&l.label){const{top:B,bottom:N}=P;B.visible&&setFormattedCrosshairLabel(B,"top",l.label),N.visible&&setFormattedCrosshairLabel(N,"bottom",l.label)}}if(L&&!E){const O={x1:1/0,y1:1/0,x2:-1/0,y2:-1/0};if(setRegionArea(O,o),L.leftPos=O.x1,L.topPos=O.y1,L.bottomPos=O.y2,L.width=O.x2-O.x1,L.y=A+i.y,u&&u.label){const{left:B,right:N}=L;B.visible&&setFormattedCrosshairLabel(B,"left",u.label),N.visible&&setFormattedCrosshairLabel(N,"right",u.label)}}return{x:_&&P?P:void 0,y:y&&L?L:void 0,offsetWidth:D,offsetHeight:I,bandWidth:R??0,bandHeight:w??0}},setFormattedCrosshairLabel=(r,e,i)=>{const{formatMethod:n,formatter:o}=i,{formatFunc:l,args:u}=getFormatFunction(n,o,r.text,{label:r.text,position:e});l?r.text=l(...u):r.defaultFormatter&&(r.text=r.defaultFormatter(r.text))},setRegionArea=(r,e)=>{e.forEach(({axis:i})=>{i.getRegions().forEach(n=>{r.x1=Math.min(r.x1,n.getLayoutStartPoint().x),r.y1=Math.min(r.y1,n.getLayoutStartPoint().y),r.x2=Math.max(r.x2,n.getLayoutStartPoint().x+n.getLayoutRect().width),r.y2=Math.max(r.y2,n.getLayoutStartPoint().y+n.getLayoutRect().height)})})},layoutVerticalCrosshair=(r,e,i,n)=>{const{x:o,topPos:l,height:u}=e,d=r.type;let f;if(d==="line")f={visible:!0,start:{x:o+i/2,y:l},end:{x:o+i/2,y:l+u}};else if(d==="rect"){const g=getRectSize(r,i,e.axis),{leftPos:_,rightPos:y}=e;f={visible:!0,start:{x:Math.max(o-g/2-n/2,_),y:l},end:{x:Math.min(o+i+g/2+n/2,y),y:l+u}}}return f},layoutHorizontalCrosshair=(r,e,i,n)=>{const{leftPos:o,width:l,y:u}=e,d=r.type;let f;if(d==="line")f={visible:!0,start:{x:o,y:u+i/2},end:{x:o+l,y:u+i/2}};else if(d==="rect"){const g=getRectSize(r,i,e.axis),{topPos:_,bottomPos:y}=e;f={visible:!0,start:{x:o,y:Math.max(u-g/2-n/2,_)},end:{x:o+l,y:Math.min(u+i+g/2+n/2,y)}}}return f},getRectSize=(r,e,i)=>{var n,o,l;let u=0;if(!((n=r.style)===null||n===void 0)&&n.sizePercent)u=(r.style.sizePercent-1)*e;else if(typeof((o=r.style)===null||o===void 0?void 0:o.size)=="number")u=r.style.size-e;else if(typeof((l=r.style)===null||l===void 0?void 0:l.size)=="function"){const d=i.getLayoutRect();u=r.style.size(d,i)-e}return u};class CartesianCrossHair extends BaseCrossHair{static getSpecInfo(e){return getSpecInfo(e,this.specKey,this.type,i=>i.xField&&i.xField.visible!==!1||i.yField&&i.yField.visible!==!1)}constructor(e,i){super(e,i),this.type=ComponentTypeEnum.cartesianCrosshair,this.name=ComponentTypeEnum.cartesianCrosshair,this._currValueX=new Map,this._currValueY=new Map}_showDefaultCrosshairBySpec(){const{xField:e,yField:i}=this._spec;if(e!=null&&e.visible&&e.defaultSelect){const{axisIndex:n,datum:o}=e.defaultSelect;this._defaultCrosshair(n,o,1)}if(i!=null&&i.visible&&i.defaultSelect){const{axisIndex:n,datum:o}=i.defaultSelect;this._defaultCrosshair(n,o,2)}}_defaultCrosshair(e,i,n){const o=this._option.getComponentsByKey("axes").find(l=>l.getSpecIndex()===e);o&&(n===1?(this._currValueX.clear(),this._currValueX.set(e,{axis:o,value:i})):(this._currValueY.clear(),this._currValueY.set(e,{axis:o,value:i})),this.layoutByValue(n))}_findAllAxisContains(e,i){const n=this._getAxisInfoByField("x"),o=this._getAxisInfoByField("y");return{xAxisMap:this._filterAxisByPoint(n,e,i),yAxisMap:this._filterAxisByPoint(o,e,i)}}_getValueAt(e,i){return e.getScale().invert(i)}clearAxisValue(){this._currValueX.clear(),this._currValueY.clear()}setAxisValue(e,i){isXAxis(i.getOrient())?this._currValueX.set(i.getSpecIndex(),{value:e,axis:i}):this._currValueY.set(i.getSpecIndex(),{value:e,axis:i})}_getAllAxisValues(e,i,n,o){let l=!1;return e.forEach(u=>{isDiscrete(u.axis.getScale().type)&&(l?this.enable=!1:l=!0)}),!!this.enable&&(e.forEach((u,d)=>{const f=u.axis;n.set(d,{value:this._getValueAt(f,i-(o?f.getLayoutStartPoint().x-this.getLayoutStartPoint().x:f.getLayoutStartPoint().y-this.getLayoutStartPoint().y)),axis:f})}),!0)}_layoutCrosshair(e,i,n,o){var l;let u=e,d=i;if(n&&n.length){if(o==="dimension"){const _=n[0],y=_.data.findIndex(S=>S.datum.length>0);let b;if(y>-1){const S=_.data[y];b=S.series.dataToPosition(S.datum[0])}(isValid(_.dimType)?_.dimType==="y":isYAxis((l=_==null?void 0:_.axis)===null||l===void 0?void 0:l.getOrient()))?d=b==null?void 0:b.y:u=b==null?void 0:b.x}else if(o==="mark"){const _=n[0],y=_.series.dataToPosition(_.datum[0]);u=y==null?void 0:y.x,d=y==null?void 0:y.y}}const{xAxisMap:f,yAxisMap:g}=this._findAllAxisContains(u,d);if(f&&f.size===0||g&&g.size===0){if(this.enableRemain)return;this.hide()}else this._currValueX.clear(),this._currValueY.clear(),f&&f.size&&this._getAllAxisValues(f,u,this._currValueX,!0),g&&g.size&&this._getAllAxisValues(g,d,this._currValueY,!1),this.layoutByValue(3)}hide(){this._xCrosshair&&this._xCrosshair.hideAll(),this._xTopLabel&&this._xTopLabel.hideAll(),this._xBottomLabel&&this._xBottomLabel.hideAll(),this._yCrosshair&&this._yCrosshair.hideAll(),this._yLeftLabel&&this._yLeftLabel.hideAll(),this._yRightLabel&&this._yRightLabel.hideAll()}layoutByValue(e=3){if(!this.enable)return;const i=getFirstSeries(this._regions,"cartesian");if(!i)return;const{x:n,y:o,offsetWidth:l,offsetHeight:u,bandWidth:d,bandHeight:f}=layoutByValue$1(e,i,this.getLayoutStartPoint(),this._currValueX,this._currValueY,this._xHair,this._yHair,this.enableRemain,this._cacheXCrossHairInfo,this._cacheYCrossHairInfo);this.enableRemain&&(n&&(this._cacheXCrossHairInfo=Object.assign(Object.assign({},n),{_isCache:!0})),o&&(this._cacheYCrossHairInfo=Object.assign(Object.assign({},o),{_isCache:!0}))),n&&this._layoutVertical(n,d,l),o&&this._layoutHorizontal(o,f,u)}_layoutVertical(e,i,n){var o,l;if(e._isCache&&this.enableRemain||!this._xHair)return;const{x:u,topPos:d,height:f,top:g,bottom:_,visible:y}=e;if(y){const b=this._xHair.type,S=layoutVerticalCrosshair(this._xHair,e,i,n);if(this._updateCrosshair("x",b,S),g.visible){const v=Object.assign(Object.assign(Object.assign({x:u+i/2,y:d},g),this._xHair.label),{textStyle:Object.assign(Object.assign({},(o=this._xHair.label)===null||o===void 0?void 0:o.textStyle),{textAlign:"center",textBaseline:"bottom"}),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(this._xTopLabel,v,A=>{A.name="crosshair-x-top-label",this._xTopLabel=A})}else this._xTopLabel&&this._xTopLabel.hideAll();if(_.visible){const v=Object.assign(Object.assign(Object.assign({x:u+i/2,y:d+f},_),this._xHair.label),{textStyle:Object.assign(Object.assign({},(l=this._xHair.label)===null||l===void 0?void 0:l.textStyle),{textAlign:"center",textBaseline:"top"}),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(this._xBottomLabel,v,A=>{A.name="crosshair-x-bottom-label",this._xBottomLabel=A})}else this._xBottomLabel&&this._xBottomLabel.hideAll()}}_layoutHorizontal(e,i,n){var o,l;if(e._isCache&&this.enableRemain||!this._yHair)return;const{leftPos:u,width:d,y:f,left:g,right:_,visible:y}=e;if(y){const b=this._yHair.type,S=layoutHorizontalCrosshair(this._yHair,e,i,n);if(this._updateCrosshair("y",b,S),g.visible){const v=Object.assign(Object.assign(Object.assign({x:u,y:f+i/2},g),this._yHair.label),{textStyle:Object.assign(Object.assign({},(o=this._yHair.label)===null||o===void 0?void 0:o.textStyle),{textAlign:"right",textBaseline:"middle"}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._yLeftLabel,v,A=>{A.name="crosshair-y-left-label",this._yLeftLabel=A})}else this._yLeftLabel&&this._yLeftLabel.hideAll();if(_.visible){const v=Object.assign(Object.assign(Object.assign({x:u+d,y:f+i},_),this._yHair.label),{textStyle:Object.assign(Object.assign({},(l=this._yHair.label)===null||l===void 0?void 0:l.textStyle),{textAlign:"left",textBaseline:"middle"}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._yRightLabel,v,A=>{A.name="crosshair-y-right-label",this._yRightLabel=A})}else this._yRightLabel&&this._yRightLabel.hideAll()}}_parseFieldInfo(){const{xField:e,yField:i}=this._spec;this._parseAndSetCrosshair(e,"x"),this._parseAndSetCrosshair(i,"y")}_parseAndSetCrosshair(e,i){const n=`_${i}Hair`,o=`_${i}Crosshair`;if(e&&e.visible){if(this[n]=this._parseField(e,`${i}Field`),this[o]){const{style:l,type:u}=this[n],d=u==="rect"?"rectStyle":"lineStyle";this[o].setAttributes({[d]:l})}}else this[o]&&this[o].parent&&this[o].parent.removeChild(this[o])}_updateCrosshair(e,i,n){const o=this.getContainer();let l;if(l=e==="x"?this._xCrosshair:this._yCrosshair,l)l.setAttributes(n);else{const u=e==="x"?this._xHair.style:this._yHair.style;i==="line"?l=new LineCrosshair(Object.assign(Object.assign({},n),{lineStyle:u,zIndex:this.gridZIndex+1,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1})):i==="rect"&&(l=new RectCrosshair(Object.assign(Object.assign({},n),{rectStyle:u,zIndex:this.gridZIndex,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1}))),o==null||o.add(l),e==="x"?this._xCrosshair=l:this._yCrosshair=l}}_updateCrosshairLabel(e,i,n){const o=this.getContainer();e?e.setAttributes(i):(n(e=new Tag(i)),o==null||o.add(e)),limitTagInBounds(e,this._getLimitBounds())}_getNeedClearVRenderComponents(){return[this._xCrosshair,this._xTopLabel,this._xBottomLabel,this._yCrosshair,this._yLeftLabel,this._yRightLabel]}}CartesianCrossHair.specKey="crosshair",CartesianCrossHair.type=ComponentTypeEnum.cartesianCrosshair;const registerCartesianCrossHair=()=>{Factory$1.registerComponent(CartesianCrossHair.type,CartesianCrossHair)};var __rest$4=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const layoutByValue=(r,e,i,n,o,l=!1,u,d)=>{let f={x:0,y:0,center:{x:0,y:0},radius:0,distance:0,startAngle:0,endAngle:0,innerRadius:0,visible:!1,label:{visible:!1,text:"",offset:0}},g={x:0,y:0,center:{x:0,y:0},radius:0,distance:0,startAngle:0,endAngle:0,innerRadius:0,visible:!1,sides:r.angleAxisHelper.getScale(0).domain().length,label:{visible:!1,text:"",offset:0}};if(n){f.visible=!!e.size;const _=r.angleAxisHelper.getBandwidth(0);e.forEach(y=>{var b,{axis:S,value:v,coord:A}=y,x=__rest$4(y,["axis","value","coord"]);v=v??"",mergeSpec(f,x);const T=r.angleAxisHelper.dataToPosition([v]);f.angle=T;const C=S.niceLabelFormatter;!((b=n.label)===null||b===void 0)&&b.visible&&(f.label.visible=!0,f.label.defaultFormatter=C,f.label.text=v,f.label.offset=getAxisLabelOffset(S.getSpec())),f.startAngle=T-_/2,f.endAngle=T+_/2})}if(o&&(g.visible=!!i.size,i.forEach(_=>{var y,{axis:b,value:S,coord:v}=_,A=__rest$4(_,["axis","value","coord"]);S=S??"";const x=b.niceLabelFormatter;!((y=o.label)===null||y===void 0)&&y.visible&&(g.label.visible=!0,g.label.defaultFormatter=x,g.label.text=S,g.label.offset=getAxisLabelOffset(b.getSpec())),g.angle=v.angle,g.axis=b,mergeSpec(g,A)})),l&&!f.visible&&isValid(u))f=u;else if(f.label.visible&&n&&n.label){const{label:_}=f,{formatMethod:y,formatter:b}=n.label,{formatFunc:S,args:v}=getFormatFunction(y,b,_.text,{label:_.text,orient:"angle"});S?_.text=S(...v):_.defaultFormatter&&(_.text=_.defaultFormatter(_.text))}if(l&&!g.visible&&isValid(d))g=d;else if(g.label.visible&&o&&o.label){const{label:_}=g,{formatMethod:y,formatter:b}=o.label,{formatFunc:S,args:v}=getFormatFunction(y,b,_.text,{label:_.text,orient:"radius"});S?_.text=S(...v):_.defaultFormatter&&(_.text=_.defaultFormatter(_.text))}return{angle:f,radius:g}},layoutAngleCrosshair=(r,e)=>{const{angle:i,innerRadius:n,radius:o,startAngle:l,endAngle:u,center:d}=e;let f;return f=(r.type==="rect"?"sector":"line")=="sector"?{center:d,innerRadius:n,radius:o,startAngle:l,endAngle:u}:{start:polarToCartesian(d,n,i),end:polarToCartesian(d,o,i)},f},layoutRadiusCrosshair=(r,e)=>{const{center:i,startAngle:n,endAngle:o,distance:l,sides:u,axis:d,point:f,radius:g,innerRadius:_}=e;let y=l;if((r.smooth?"circle":"polygon")=="polygon"){const b=d.getCenter(),S=getAngleByPoint(b,f),v=(o-n)/u,A=Math.floor((S-n)/v),x=A*v+n,T=Math.min((A+1)*v+n,o),C=polarToCartesian(b,l,x),E=polarToCartesian(b,l,T),P=getIntersectPoint([E.x,E.y],[C.x,C.y],[b.x,b.y],[f.x,f.y]);P&&(y=clamp(PointService.distancePN(f,P[0],P[1])+l,_,g))}return{center:i,startAngle:n,endAngle:o,radius:y,sides:u}};class PolarCrossHair extends BaseCrossHair{static getSpecInfo(e){return getSpecInfo(e,this.specKey,this.type,i=>i.categoryField&&i.categoryField.visible!==!1||i.valueField&&i.valueField.visible!==!1)}constructor(e,i){super(e,i),this.type=ComponentTypeEnum.polarCrosshair,this.name=ComponentTypeEnum.polarCrosshair,this._currValueAngle=new Map,this._currValueRadius=new Map}_showDefaultCrosshairBySpec(){const{categoryField:e,valueField:i}=this._spec;if(e!=null&&e.visible&&e.defaultSelect){const{axisIndex:n,datum:o}=e.defaultSelect;this._defaultCrosshair(n,o,1)}if(i!=null&&i.visible&&i.defaultSelect){const{axisIndex:n,datum:o}=i.defaultSelect;this._defaultCrosshair(n,o,2)}}_defaultCrosshair(e,i,n){const o=this._option.getComponentsByKey("axes").find(l=>l.getSpecIndex()===e);if(o){if(n===1){this._currValueAngle.clear();const l={angle:o.valueToPosition(i),radius:o.getOuterRadius()},u=o.coordToPoint(l);this._currValueAngle.set(e,this._getValueByAxis(o,u))}else{this._currValueRadius.clear();const l={angle:o.startAngle,radius:o.valueToPosition(i)},u=o.coordToPoint(l);this._currValueRadius.set(e,this._getValueByAxis(o,u))}this.layoutByValue(3)}}hide(){this._radiusCrosshair&&this._radiusCrosshair.hideAll(),this._radiusLabelCrosshair&&this._radiusLabelCrosshair.hideAll(),this._angleCrosshair&&this._angleCrosshair.hideAll(),this._angleLabelCrosshair&&this._angleLabelCrosshair.hideAll()}_findAllAxisContains(e,i){const n=this._getAxisInfoByField("category"),o=this._getAxisInfoByField("value");return{angleAxisMap:this._filterAxisByPoint(n,e,i),radiusAxisMap:this._filterAxisByPoint(o,e,i)}}_getAllAxisValues(e,i,n){let o=!1;return e.forEach(l=>{isDiscrete(l.axis.getScale().type)&&(o?this.enable=!1:o=!0)}),!!this.enable&&(e.forEach((l,u)=>{const d=l.axis;n.set(u,this._getValueByAxis(d,i))}),!0)}_getValueByAxis(e,i){const{x:n,y:o}=e.getLayoutStartPoint(),{x:l,y:u}=this.getLayoutStartPoint(),d=e.positionToData({x:i.x-(n-l),y:i.y-(o-u)}),f={x:e.getCenter().x+this.getLayoutStartPoint().x,y:e.getCenter().y+this.getLayoutStartPoint().y};return{value:d,axis:e,center:f,innerRadius:e.getInnerRadius(),radius:e.getOuterRadius(),startAngle:e.startAngle,endAngle:e.endAngle,distance:PointService.distancePP(i,e.getCenter()),coord:e.pointToCoord(i),point:i}}_layoutCrosshair(e,i,n,o){let l=e,u=i;if(n&&n.length){if(o==="dimension"){const g=n[0];if(g.axis){const _=g.axis.pointToCoord({x:l,y:u}),y=g.axis.getOrient()==="radius"?{radius:g.position,angle:_.angle}:{radius:_.radius,angle:g.position},b=g.axis.coordToPoint(y);l=b.x,u=b.y}}else if(o==="mark"){const g=n[0],_=g.series.dataToPosition(g.datum[0]);l=_.x,u=_.y}}const{angleAxisMap:d,radiusAxisMap:f}=this._findAllAxisContains(l,u);if(d.size!==0||f.size!==0)this._currValueAngle.clear(),this._currValueRadius.clear(),d&&this._getAllAxisValues(d,{x:l,y:u},this._currValueAngle),f&&this._getAllAxisValues(f,{x:l,y:u},this._currValueRadius),this.layoutByValue(3);else{if(this.enableRemain)return;this.hide()}}layoutByValue(e=3){if(!this.enable)return;const i=getFirstSeries(this._regions,"polar");if(!i)return;const{angle:n,radius:o}=layoutByValue(i,this._currValueAngle,this._currValueRadius,this._angleHair,this._radiusHair,this.enableRemain,this._cacheAngleCrossHairInfo,this._cacheRadiusCrossHairInfo);this.enableRemain&&(this._cacheAngleCrossHairInfo=Object.assign(Object.assign({},n),{_isCache:!0}),this._cacheRadiusCrossHairInfo=Object.assign(Object.assign({},o),{_isCache:!0})),e&&(this._layoutRadius(o),this._layoutAngle(n))}_layoutAngle(e){var i;if(e._isCache&&this.enableRemain)return;const n=this.getContainer(),{angle:o,radius:l,label:u,center:d,visible:f}=e;if(f){const g=this._angleHair.type==="rect"?"sector":"line",_=layoutAngleCrosshair(this._angleHair,e);if(this._angleCrosshair)this._angleCrosshair.setAttributes(_);else{let y;g==="line"?y=new LineCrosshair(Object.assign(Object.assign({},_),{lineStyle:this._angleHair.style,zIndex:this.gridZIndex,pickable:!1})):g==="sector"&&(y=new SectorCrosshair(Object.assign(Object.assign({},_),{sectorStyle:this._angleHair.style,zIndex:this.gridZIndex,pickable:!1}))),this._angleCrosshair=y,n.add(y)}if(u.visible){const y=angleLabelOrientAttribute(o),b=Object.assign(Object.assign(Object.assign(Object.assign({},polarToCartesian(d,l+u.offset,o)),this._angleHair.label),u),{textStyle:Object.assign(Object.assign({},(i=this._angleHair.label)===null||i===void 0?void 0:i.textStyle),{textAlign:y.align,textBaseline:y.baseline}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._angleLabelCrosshair,b,S=>{S.name="crosshair-angle-label",this._angleLabelCrosshair=S})}else this._angleLabelCrosshair&&this._angleLabelCrosshair.hideAll()}}_layoutRadius(e){var i;if(e._isCache&&this.enableRemain)return;const{center:n,startAngle:o,label:l,visible:u}=e,d=this.getContainer();if(u){const f=this._radiusHair.smooth?"circle":"polygon",g=layoutRadiusCrosshair(this._radiusHair,e),_=g.radius;if(this._radiusCrosshair)this._radiusCrosshair.setAttributes(g);else{let y;y=f==="polygon"?new PolygonCrosshair(Object.assign(Object.assign({},g),{lineStyle:this._radiusHair.style,zIndex:this.gridZIndex+1})):new CircleCrosshair(Object.assign(Object.assign({},g),{lineStyle:this._radiusHair.style,zIndex:this.gridZIndex})),this._radiusCrosshair=y,d.add(y)}if(l.visible){const y=radiusLabelOrientAttribute(o),b=Object.assign(Object.assign(Object.assign(Object.assign({},polarToCartesian(n,_,o)),this._radiusHair.label),l),{textStyle:Object.assign(Object.assign({},(i=this._radiusHair.label)===null||i===void 0?void 0:i.textStyle),{textAlign:y.align,textBaseline:y.baseline}),zIndex:this.labelZIndex});this._updateCrosshairLabel(this._radiusLabelCrosshair,b,S=>{S.name="crosshair-radius-label",this._radiusLabelCrosshair=S})}else this._radiusLabelCrosshair&&this._radiusLabelCrosshair.hideAll()}}_parseFieldInfo(){var e;const{categoryField:i,valueField:n}=this._spec;i&&i.visible&&(this._angleHair=this._parseField(i,"categoryField")),n&&n.visible&&(this._radiusHair=this._parseField(n,"valueField"),this._radiusHair.smooth=(e=n==null?void 0:n.line)===null||e===void 0?void 0:e.smooth)}_updateCrosshairLabel(e,i,n){const o=this.getContainer();e?e.setAttributes(i):(e=new Tag(i),o==null||o.add(e),n(e)),limitTagInBounds(e,this._getLimitBounds())}_getNeedClearVRenderComponents(){return[this._radiusCrosshair,this._radiusLabelCrosshair,this._angleCrosshair,this._angleLabelCrosshair]}}PolarCrossHair.specKey="crosshair",PolarCrossHair.type=ComponentTypeEnum.polarCrosshair;const registerPolarCrossHair=()=>{Factory$1.registerComponent(PolarCrossHair.type,PolarCrossHair)},lockStatisticsFilter=(r,e)=>{const{getNewDomain:i,isContinuous:n,field:o,originalFields:l}=e,u=o(),d=i();if(isNil(d)||isNil(u))return r;const f=l(),g=isArray(u)?u[0]:u;return r[g]&&f&&f[g]&&f[g].lockStatisticsByDomain&&!n()&&(r[g].values=d),r},dataFilterWithNewDomain=(r,e)=>{const{getNewDomain:i,isContinuous:n,field:o}=e,l=o(),u=i();if(isNil(u)||isNil(l))return r;if(u.length===0)return[];const d={};u.forEach(g=>{d[g]||(d[g]=1)});let f=null;return f=n()?g=>{let _=!1;return array(l).every(y=>{g[y]>=u[0]&&g[y]<=last(u)&&(_=!0)}),_}:g=>{let _=!1;return array(l).every(y=>{(d[g[y]+""]||d[g[y]])&&(_=!0)}),_},r.filter(f)},dataFilterComputeDomain=(r,e)=>{const{stateFields:i,valueFields:n,dataCollection:o}=e.input,{stateField:l,valueField:u}=e.output,d={},f=[];return o.forEach((g,_)=>{var y;if(isNil(i[_]))return;const b=(y=g.getFields())===null||y===void 0?void 0:y[i[_]];b&&b.lockStatisticsByDomain&&b.domain.forEach(S=>{d[S]=0}),g.latestData.forEach(S=>{array(i[_]).forEach(v=>{isNil(S[v])||(isNil(d[S[v]])&&(d[S[v]]=0),isNil(n[_])||(d[S[v]]+=isNaN(parseFloat(S[n[_]]))?1:parseFloat(S[n[_]])))})})}),Object.keys(d).forEach((g,_)=>{const y={[l]:g};u&&(y[u]=d[g]),f.push(y)}),f};class DataFilterBaseComponent extends BaseComponent{get relatedAxisComponent(){return this._relatedAxisComponent}setStartAndEnd(e,i,n=["percent","percent"]){const[o="percent",l="percent"]=n,u=o==="percent"?e:this.dataToStatePoint(e),d=l==="percent"?i:this.dataToStatePoint(i);this._handleChange(u,d,!0)}enableInteraction(){this._activeRoam=!0}disableInteraction(){this._activeRoam=!1}zoomIn(e){this._handleChartZoom({zoomDelta:1.2,zoomX:e==null?void 0:e.x,zoomY:e==null?void 0:e.y})}zoomOut(e){this._handleChartZoom({zoomDelta:.8,zoomX:e==null?void 0:e.x,zoomY:e==null?void 0:e.y})}_handleChange(e,i,n){var o,l;(l=(o=this._spec)===null||o===void 0?void 0:o.zoomLock)!==null&&l!==void 0&&l||i-e!==this._spanCache&&(i-e<this._minSpan||i-e>this._maxSpan)?this._shouldChange=!1:(this._shouldChange=!0,this._spanCache=i-e)}_isReverse(){const e=this._relatedAxisComponent;if(!e)return!1;const i=e.getScale();return i.range()[0]>i.range()[1]&&(!e.getInverse()||this._isHorizontal)}_updateRangeFactor(e){const i=this._relatedAxisComponent.getScale(),n=this._isReverse(),o=n?[1-this._end,1-this._start]:[this._start,this._end];if(n)switch(e){case"startHandler":i.rangeFactorEnd(o[1]);break;case"endHandler":i.rangeFactorStart(o[0]);break;default:i.rangeFactorStart(o[0],!0),i.rangeFactorEnd(o[1])}else switch(e){case"startHandler":i.rangeFactorStart(o[0]);break;case"endHandler":i.rangeFactorEnd(o[1]);break;default:i.rangeFactorEnd(o[1],!0),i.rangeFactorStart(o[0])}const l=i.rangeFactor();l?(this._start=n?1-l[1]:l[0],this._end=n?1-l[0]:l[1]):(this._start=0,this._end=1)}get visible(){return this._visible}constructor(e,i){super(e,i),this.layoutType="none",this._orient="left",this._cacheVisibility=void 0,this._dataUpdating=!1,this._shouldChange=!0,this._stateField="x",this._activeRoam=!0,this._zoomAttr={enable:!0,rate:1,focus:!0},this._dragAttr={enable:!0,rate:1,reverse:!0},this._scrollAttr={enable:!0,rate:1,reverse:!0},this.effect={onZoomChange:n=>{var o,l;const u=this._relatedAxisComponent;if(u&&this._filterMode==="axis"){const d=u.getScale(),f=u.getSpec();this._auto&&this._getAxisBandSize(f)&&this._spec.ignoreBandSize&&(d.bandwidth("auto"),d.maxBandwidth("auto"),d.minBandwidth("auto")),this._updateRangeFactor(n),this._auto&&((l=(o=this._component)===null||o===void 0?void 0:o.setStartAndEnd)===null||l===void 0||l.call(o,this._start,this._end)),u.effect.scaleUpdate({value:"force"})}else eachSeries(this._regions,d=>{var f;(f=d.getViewData())===null||f===void 0||f.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),eachSeries(this._regions,d=>{d.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._visible=!0,this._handleStateChange=(n,o,l)=>{var u,d;return this._startValue=n,this._endValue=o,this._newDomain=this._parseDomainFromState(this._startValue,this._endValue),(d=(u=this.effect).onZoomChange)===null||d===void 0||d.call(u,l),!0},this._handleChartZoom=n=>{var o,l;if(!this._activeRoam)return;const{zoomDelta:u,zoomX:d,zoomY:f}=n,{x:g,y:_}=this._regions[0].getLayoutStartPoint(),{width:y,height:b}=this._regions[0].getLayoutRect(),S=Math.abs(this._start-this._end),v=(l=(o=this._spec.roamZoom)===null||o===void 0?void 0:o.rate)!==null&&l!==void 0?l:1;if(S>=1&&u<1||S<=.01&&u>1)return;const A=this._isHorizontal?d:f,x=S*(u-1)*v;let T=x/2,C=x/2;if(A){const L=this._isHorizontal?g:_,R=this._isHorizontal?y:b;T=Math.abs(L-A)/Math.abs(R-L)*x,C=Math.abs(R-A)/Math.abs(R-L)*x}const E=clamp(this._start+T,0,1),P=clamp(this._end-C,0,1);this._handleChange(Math.min(E,P),Math.max(E,P),!0)},this._handleChartScroll=(n,o)=>{var l;if(!this._activeRoam)return!1;const{scrollX:u,scrollY:d}=n;let f=this._isHorizontal?u:d;const g=this._isHorizontal?abs$1(u/d)>=.5:abs$1(d/u)>=.5;this._scrollAttr.reverse||(f=-f),g&&this._handleChartMove(f,(l=this._scrollAttr.rate)!==null&&l!==void 0?l:1);const _=this._start!==0&&this._end!==1;return g&&_},this._handleChartDrag=(n,o)=>{var l;if(!this._activeRoam)return;const[u,d]=n;let f=this._isHorizontal?u:d;this._dragAttr.reverse&&(f=-f),this._handleChartMove(f,(l=this._dragAttr.rate)!==null&&l!==void 0?l:1)},this._handleChartMove=(n,o)=>{const l=this._isHorizontal?this.getLayoutRect().width:this.getLayoutRect().height;if(Math.abs(n)>=1e-6){if(n>0&&this._end<1){const u=Math.min(1-this._end,n/l)*o;this._handleChange(this._start+u,this._end+u,!0)}else if(n<0&&this._start>0){const u=Math.max(-this._start,n/l)*o;this._handleChange(this._start+u,this._end+u,!0)}}return!1},this._orient=getOrient(e),this._isHorizontal=getDirectionByOrient(this._orient)==="horizontal"}created(){super.created(),this._setAxisFromSpec(),this._setRegionsFromSpec(),this._initEvent(),this._initData(),this._initStateScale(),this._setStateFromSpec()}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}_setAxisFromSpec(){if(isValid(this._spec.axisId)?this._relatedAxisComponent=this._option.getComponentByUserId(this._spec.axisId):isValid(this._spec.axisIndex)&&(this._relatedAxisComponent=this._option.getComponentByIndex("axes",this._spec.axisIndex)),isNil(this._spec.field)&&!this._relatedAxisComponent){const e=this._option.getComponentsByKey("axes"),i=e.find(n=>n._orient===this._orient);if(i)this._relatedAxisComponent=i;else{const n=e.find(o=>!isContinuous(o.getScale().type));this._relatedAxisComponent=n}}this._relatedAxisComponent&&this._filterMode==="axis"&&(this._relatedAxisComponent.autoIndentOnce=!0)}_setRegionsFromSpec(){var e,i;this._regions=this._relatedAxisComponent?this._relatedAxisComponent.getRegions():this._option.getAllRegions();const n=this._relatedAxisComponent?(i=(e=this._relatedAxisComponent).getBindSeriesFilter)===null||i===void 0?void 0:i.call(e):null;if(isValid(n)&&(isValid(n.userId)&&(this._seriesUserId=array(n.userId)),isValid(n.specIndex)&&(this._seriesIndex=array(n.specIndex))),isValid(this._spec.seriesId)){const o=array(this._spec.seriesId);this._seriesUserId?this._seriesUserId=this._seriesUserId.filter(l=>o.includes(l)):this._seriesUserId=o}if(isValid(this._spec.seriesIndex)){const o=array(this._spec.seriesIndex);this._seriesIndex?this._seriesIndex=this._seriesIndex.filter(l=>o.includes(l)):this._seriesIndex=o}if(isValid(this._spec.regionIndex)){const o=this._option.getRegionsInIndex(array(this._spec.regionIndex));this._regions=this._regions.filter(l=>o.includes(l))}else if(isValid(this._spec.regionId)){const o=array(this._spec.regionId);this._regions=o.length?this._regions.filter(l=>o.includes(l.id)):[]}}onDataUpdate(){var e;const i=this._computeDomainOfStateScale(isContinuous(this._stateScale.type));this._stateScale.domain(i,!1),this._handleChange(this._start,this._end,!0),this._spec.auto&&!isEqual(this._domainCache,i)&&(this._domainCache=i,this._dataUpdating=!0,(e=this.getChart())===null||e===void 0||e.setLayoutTag(!0,null,!1))}_computeDomainOfStateScale(e){if(this._spec.customDomain)return this._spec.customDomain;const i=this._data.getLatestData().map(n=>n[this._stateField]);if(e){const n=i.map(o=>1*o);return i.length?[minInArray(n),maxInArray(n)]:[-1/0,1/0]}return i}_initEvent(){this._initCommonEvent()}_initData(){const e=[],i=[],n=[];if(this._relatedAxisComponent){const u={};eachSeries(this._regions,d=>{var f,g;const _=d.coordinate==="cartesian"?d.getXAxisHelper():d.coordinate==="polar"?d.angleAxisHelper:null,y=d.coordinate==="cartesian"?d.getYAxisHelper():d.coordinate==="polar"?d.radiusAxisHelper:null;if(!_||!y)return;const b=_.getAxisId()===this._relatedAxisComponent.id?_:y.getAxisId()===this._relatedAxisComponent.id?y:this._isHorizontal?_:y,S=b===_?y:_,v=isContinuous(S.getScale(0).type),A=isContinuous(b.getScale(0).type);e.push(d.getRawData());const x=d.getSpec(),T=d.coordinate==="cartesian"?array(x.xField):array((f=x.angleField)!==null&&f!==void 0?f:x.categoryField),C=d.coordinate==="cartesian"?array(x.yField):array((g=x.radiusField)!==null&&g!==void 0?g:x.valueField);if(u[d.id]=d.type==="link"?["from_xField"]:b===_?T:C,A?i.push(u[d.id]):i.push(u[d.id][0]),this._valueField){const E=d.type==="link"?["from_yField"]:S===_?T:C;v&&n.push(...E)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._originalStateFields=u}else eachSeries(this._regions,u=>{e.push(u.getRawData()),i.push(this._field),this._valueField&&n.push(this._spec.valueField)},{userId:this._seriesUserId,specIndex:this._seriesIndex});const{dataSet:o}=this._option;registerDataSetInstanceParser(o,"dataview",dataViewParser),registerDataSetInstanceTransform(o,"dataFilterComputeDomain",dataFilterComputeDomain);const l=new DataView(o,{name:`${this.type}_${this.id}_data`});l.transform({type:"dataFilterComputeDomain",options:{input:{dataCollection:e,stateFields:i,valueFields:n},output:{stateField:this._stateField,valueField:this._valueField}}},!1),this._data=new CompilableData(this._option,l),l.reRunAllTransform(),o.multipleDataViewAddListener(e,"change",this._handleDataCollectionChange.bind(this))}setAttrFromSpec(){var e;super.setAttrFromSpec(),this._spec.roamZoom===!0||this._spec.roamZoom?this._zoomAttr=merge$1({},this._zoomAttr,this._spec.roamZoom):this._zoomAttr.enable=!1,this._spec.roamDrag===!0||this._spec.roamDrag?this._dragAttr=merge$1({},this._dragAttr,this._spec.roamDrag):this._dragAttr.enable=!1,this._spec.roamScroll===!0||this._spec.roamScroll?this._scrollAttr=merge$1({},this._scrollAttr,this._spec.roamScroll):this._scrollAttr.enable=!1,this._field=this._spec.field,this._width=this._computeWidth(),this._height=this._computeHeight(),this._visible=(e=this._spec.visible)===null||e===void 0||e}_statePointToData(e){const i=this._stateScale,n=i.domain();if(isContinuous(i.type))return this._isReverse()?n[0]+(last(n)-n[0])*(1-e):n[0]+(last(n)-n[0])*e;let o=i.range();this._isReverse()&&(o=o.slice().reverse());const l=o[0]+(last(o)-o[0])*e;return i.invert(l)}dataToStatePoint(e){const i=this._stateScale,n=i.scale(e);let o=i.range();return!this._isHorizontal&&isContinuous(i.type)&&(o=o.slice().reverse()),(n-o[0])/(last(o)-o[0])}_modeCheck(e,i){return e==="start"?i==="percent"&&isValid(this._spec.start)||i==="value"&&isValid(this._spec.startValue):i==="percent"&&isValid(this._spec.end)||i==="value"&&isValid(this._spec.endValue)}_setStateFromSpec(){var e,i;let n,o;if(this._auto=!!this._spec.auto,this._spec.rangeMode){const[l,u]=this._spec.rangeMode;this._modeCheck("start",l)&&this._modeCheck("end",u)&&(n=l==="percent"?this._spec.start:this.dataToStatePoint(this._spec.startValue),o=u==="percent"?this._spec.end:this.dataToStatePoint(this._spec.endValue))}else n=this._spec.start?this._spec.start:this._spec.startValue?this.dataToStatePoint(this._spec.startValue):0,o=this._spec.end?this._spec.end:this._spec.endValue?this.dataToStatePoint(this._spec.endValue):1;this._startValue=this._statePointToData(n),this._endValue=this._statePointToData(o),this._start=n,this._end=o,this._minSpan=(e=this._spec.minSpan)!==null&&e!==void 0?e:0,this._maxSpan=(i=this._spec.maxSpan)!==null&&i!==void 0?i:1,isContinuous(this._stateScale.type)&&this._stateScale.domain()[0]!==last(this._stateScale.domain())&&(this._spec.minValueSpan&&(this._minSpan=this._spec.minValueSpan/(last(this._stateScale.domain())-this._stateScale.domain()[0])),this._spec.maxValueSpan&&(this._maxSpan=this._spec.maxValueSpan/(last(this._stateScale.domain())-this._stateScale.domain()[0]))),this._minSpan=Math.max(0,this._minSpan),this._maxSpan=Math.min(this._maxSpan,1),this._relatedAxisComponent&&this._filterMode==="axis"||this._start===0&&this._end===1||(this._newDomain=this._parseDomainFromState(this._startValue,this._endValue))}_parseFieldOfSeries(e){var i;return(i=this._originalStateFields)===null||i===void 0?void 0:i[e.id]}_initStateScale(){const e=[0,1];if(this._relatedAxisComponent){const i=this._relatedAxisComponent.getScale(),n=isContinuous(i.type),o=this._computeDomainOfStateScale(n);if(this._stateScale=i.clone(),n){const l=o.map(u=>1*u);this._stateScale.domain(o.length?[minInArray(l),maxInArray(l)]:[0,1],!0).range(e)}else this._stateScale.domain(o,!0).range(e)}else this._stateScale=new BandScale,this._stateScale.domain(this._computeDomainOfStateScale(),!0).range(e)}init(e){super.init(e),this._addTransformToSeries(),this._start===0&&this._end===1||this.effect.onZoomChange()}_addTransformToSeries(){this._relatedAxisComponent&&this._filterMode==="axis"||(registerDataSetInstanceTransform(this._option.dataSet,"dataFilterWithNewDomain",dataFilterWithNewDomain),registerDataSetInstanceTransform(this._option.dataSet,"lockStatisticsFilter",lockStatisticsFilter),eachSeries(this._regions,e=>{e.getViewDataStatistics().transform({type:"lockStatisticsFilter",options:{originalFields:()=>e.getViewDataStatistics().getFields(),getNewDomain:()=>this._newDomain,field:()=>{var i;return(i=this._field)!==null&&i!==void 0?i:this._parseFieldOfSeries(e)},isContinuous:()=>isContinuous(this._stateScale.type)},level:1},!1),e.addViewDataFilter({type:"dataFilterWithNewDomain",options:{getNewDomain:()=>this._newDomain,field:()=>{var i;return(i=this._field)!==null&&i!==void 0?i:this._parseFieldOfSeries(e)},isContinuous:()=>isContinuous(this._stateScale.type)},level:TransformLevel.dataZoomFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex}))}onRender(e){}_compareSpec(e,i){const n=super._compareSpec(e,i);return n.reMake||isEqual(i,e)||(n.reRender=!0,n.reMake=!0),n}reInit(e){super.reInit(e),this._marks.forEach(i=>{i.getMarks().forEach(n=>{this.initMarkStyleWithSpec(n,this._spec[n.name])})})}changeRegions(){}update(e){}resize(e){}_parseDomainFromState(e,i){if(isContinuous(this._stateScale.type))return[Math.min(i,e),Math.max(i,e)];const n=this._stateScale.domain(),o=n.indexOf(e),l=n.indexOf(i);return n.slice(Math.min(o,l),Math.max(o,l)+1)}_initCommonEvent(){var e,i,n,o,l,u,d;const f={delayType:(i=(e=this._spec)===null||e===void 0?void 0:e.delayType)!==null&&i!==void 0?i:"throttle",delayTime:isValid((n=this._spec)===null||n===void 0?void 0:n.delayType)?(l=(o=this._spec)===null||o===void 0?void 0:o.delayTime)!==null&&l!==void 0?l:30:0,realTime:(d=(u=this._spec)===null||u===void 0?void 0:u.realTime)===null||d===void 0||d};this._zoomAttr.enable&&this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom,f),this._scrollAttr.enable&&this.initScrollEventOfRegions(this._regions,null,this._handleChartScroll,f),this._dragAttr.enable&&this.initDragEventOfRegions(this._regions,null,this._handleChartDrag,f)}updateLayoutAttribute(){this._visible&&this._createOrUpdateComponent(),super.updateLayoutAttribute()}_autoVisible(e){if(!this._auto)return;e?this.show():this.hide();const i=this._isHorizontal?"height":"width";this.layout.setLayoutRect({[i]:e?this[`_${i}`]:0},{[i]:AttributeLevel.Built_In})}onLayoutStart(e,i,n){super.onLayoutStart(e,i,n);const o=this._autoUpdate(e);this._autoVisible(o),this._dataUpdating=!1}onLayoutEnd(e){const i=!(this._start===0&&this._end===1);this._autoVisible(i),super.onLayoutEnd(e)}getBoundsInRect(e){const i={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0};return this._isHorizontal?(i.y2=i.y1+this._height,i.x2=i.x1+e.width):(i.x2=i.x1+this._width,i.y2=i.y1+e.height),i}hide(){var e;(e=this._component)===null||e===void 0||e.hideAll()}show(){var e;(e=this._component)===null||e===void 0||e.showAll()}_getAxisBandSize(e){const i=e==null?void 0:e.bandSize,n=e==null?void 0:e.maxBandSize,o=e==null?void 0:e.minBandSize;if(i||o||n)return{bandSize:i,maxBandSize:n,minBandSize:o}}_autoUpdate(e){var i,n,o,l,u,d;if(!this._auto)return this._cacheVisibility=void 0,!0;const f=this._relatedAxisComponent,g=f==null?void 0:f.getSpec(),_=f==null?void 0:f.getScale(),y=this._getAxisBandSize(g);if(!this._dataUpdating&&isDiscrete(_.type)&&(e==null?void 0:e.height)===((i=this._cacheRect)===null||i===void 0?void 0:i.height)&&(e==null?void 0:e.width)===((n=this._cacheRect)===null||n===void 0?void 0:n.width)&&this._fixedBandSize===(y==null?void 0:y.bandSize))return this._cacheVisibility;let b=!0;if(this._isHorizontal&&(e==null?void 0:e.width)!==((o=this._cacheRect)===null||o===void 0?void 0:o.width)?_.range(f.getInverse()?[e.width,0]:[0,e.width]):(e==null?void 0:e.height)!==((l=this._cacheRect)===null||l===void 0?void 0:l.height)&&_.range(f.getInverse()?[0,e.height]:[e.height,0]),this._cacheRect={width:e==null?void 0:e.width,height:e==null?void 0:e.height},this._fixedBandSize=y==null?void 0:y.bandSize,isDiscrete(_.type)){y&&(this._start||this._end)&&(this.type===ComponentTypeEnum.scrollBar&&(this._start=0,this._end=1),this._updateRangeFactor());const[S,v]=(u=_.rangeFactor())!==null&&u!==void 0?u:[];b=(!isNil(S)||!isNil(v))&&!(S===0&&v===1)}else{const[S,v]=(d=_.rangeFactor())!==null&&d!==void 0?d:[this._start,this._end];b=!(S===0&&v===1)}return this.setStartAndEnd(this._start,this._end),this._cacheVisibility=b,b}_getNeedClearVRenderComponents(){return[this._component]}}mixin(DataFilterBaseComponent,Zoomable);class DataZoomSpecTransformer extends BaseComponentSpecTransformer{_mergeThemeToSpec(e,i){const n=this._theme;let o=e;if(this._shouldMergeThemeToSpec()){const l=d=>{const f=mergeSpec({selectedBackgroundChart:{line:{},area:{}}},this._theme,d),{selectedBackgroundChart:g={}}=d,{line:_,area:y}=g;return _&&_.visible!==!1&&(f.selectedBackgroundChart.line.style=Object.assign(Object.assign({},f.selectedBackgroundChart.line.style),{visible:!0})),y&&y.visible!==!1&&(f.selectedBackgroundChart.area.style=Object.assign(Object.assign({},f.selectedBackgroundChart.area.style),{visible:!0})),f},u=e;o=isArray(u)?u.map(d=>l(d)):l(u)}return this._adjustPadding(o),{spec:o,theme:n}}}class DataZoom extends DataFilterBaseComponent{constructor(e,i){var n;super(e,i),this.type=ComponentTypeEnum.dataZoom,this.name=ComponentTypeEnum.dataZoom,this.transformerConstructor=DataZoomSpecTransformer,this.specKey="dataZoom",this.layoutZIndex=LayoutZIndex.DataZoom,this.layoutLevel=LayoutLevel.DataZoom,this.layoutType="region-relative",this._isReverseCache=!1,this._dataToPositionX=o=>{const l=this._orient==="left"?this._middleHandlerSize:0,u=this._isHorizontal?this._startHandlerSize/2:0,d=this._isHorizontal?this._stateScale:this._valueScale,f=this._isHorizontal?this._stateField:this._valueField;return d.scale(o[f])+this.getLayoutStartPoint().x+l+u},this._dataToPositionX2=o=>{const l=this._orient==="left"?this._middleHandlerSize:0,u=this._isHorizontal?this._startHandlerSize/2:0,d=this._isHorizontal?this._stateScale:this._valueScale,f=d.domain()[0];return d.scale(f)+this.getLayoutStartPoint().x+l+u},this._dataToPositionY=o=>{const l=this._isHorizontal?this._middleHandlerSize:0,u=this._isHorizontal?0:this._startHandlerSize/2,d=this._isHorizontal?this._valueScale:this._stateScale,f=this._isHorizontal?this._valueField:this._stateField;return d.scale(o[f])+this.getLayoutStartPoint().y+l+u},this._dataToPositionY2=o=>{const l=this._isHorizontal?this._middleHandlerSize:0,u=this._isHorizontal?0:this._startHandlerSize/2,d=this._isHorizontal?this._valueScale:this._stateScale,f=d.domain()[0];return d.scale(f)+this.getLayoutStartPoint().y+l+u},this._valueField="y",this._filterMode=(n=e.filterMode)!==null&&n!==void 0?n:"filter"}created(){super.created(),this._initValueScale()}setAttrFromSpec(){var e,i,n,o,l,u,d,f,g,_;super.setAttrFromSpec(),isBoolean(this._spec.roam)&&(this._zoomAttr.enable=this._spec.roam,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode),this._backgroundSize=(i=(e=this._spec.background)===null||e===void 0?void 0:e.size)!==null&&i!==void 0?i:30,this._middleHandlerSize=this._computeMiddleHandlerSize(),this._width=this._computeWidth(),this._height=this._computeHeight(),isNil((l=(o=(n=this._spec)===null||n===void 0?void 0:n.startHandler)===null||o===void 0?void 0:o.style)===null||l===void 0?void 0:l.size)&&(this._spec.startHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize),isNil((f=(d=(u=this._spec)===null||u===void 0?void 0:u.endHandler)===null||d===void 0?void 0:d.style)===null||f===void 0?void 0:f.size)&&(this._spec.endHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize);const y=(g=this._spec.startHandler.style.visible)===null||g===void 0||g,b=(_=this._spec.endHandler.style.visible)===null||_===void 0||_;this._startHandlerSize=y?this._spec.startHandler.style.size:0,this._endHandlerSize=b?this._spec.endHandler.style.size:0}onLayoutEnd(e){this._updateScaleRange(),this._isReverse()&&!this._isReverseCache&&(this._isReverseCache=this._isReverse(),this.effect.onZoomChange()),this._cacheVisibility!==!1&&super.onLayoutEnd(e)}_initValueScale(){const e=this._computeDomainOfValueScale();if(e){const i=new LinearScale;i.domain(e),this._valueScale=i}}_updateScaleRange(){var e,i;const n=this._startHandlerSize+this._endHandlerSize;if(!this._stateScale||!this._valueScale)return;let o;const l=this._isHorizontal?this.getLayoutRect().width-n:this.getLayoutRect().height-n,u=(i=(e=this._relatedAxisComponent)===null||e===void 0?void 0:e.getScale().range())!==null&&i!==void 0?i:[this._startHandlerSize/2,l+this._startHandlerSize/2],d=this._computeWidth(),f=this._computeHeight();this._isHorizontal?(o=this._visible?[this._startHandlerSize/2,d-n+this._startHandlerSize/2]:u,this._stateScale.range(o),this._valueScale.range([f-this._middleHandlerSize,0])):(o=this._visible?[this._startHandlerSize/2,f-n+this._startHandlerSize/2]:u,this._stateScale.range(o),this.layoutOrient==="left"?this._valueScale.range([d-this._middleHandlerSize,0]):this._valueScale.range([0,d-this._middleHandlerSize])),this._component&&this._cacheVisibility!==!1&&this._component.setAttributes({size:{width:d,height:f},position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y}})}_computeDomainOfValueScale(){const e=this._data.getLatestData().map(n=>n[this._valueField]),i=e.map(n=>1*n);return e.length?[minInArray(i),maxInArray(i)]:null}_computeMiddleHandlerSize(){var e,i,n,o;let l=0;if(!((i=(e=this._spec)===null||e===void 0?void 0:e.middleHandler)===null||i===void 0)&&i.visible){const u=(n=this._spec.middleHandler.icon.style.size)!==null&&n!==void 0?n:8,d=(o=this._spec.middleHandler.background.size)!==null&&o!==void 0?o:40;l+=Math.max(u,d)}return l}_computeWidth(){return this._visible===!1?0:isNumber(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:this._backgroundSize+this._middleHandlerSize}_computeHeight(){return this._visible===!1?0:isNumber(this._spec.height)?this._spec.height:this._isHorizontal?this._backgroundSize+this._middleHandlerSize:this.getLayoutRect().height}_isScaleValid(e){if(!e||!e.domain())return!1;const i=e.domain();return(!isContinuous(e.type)||i[0]!==last(i))&&(!isDiscrete(e.type)||uniqArray(i).length!==1)}_getAttrs(e){var i,n,o,l,u;const d=(i=this._spec)!==null&&i!==void 0?i:{};return Object.assign({zIndex:this.layoutZIndex,start:this._start,end:this._end,position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y},orient:this._orient,size:{width:this._computeWidth(),height:this._computeHeight()},showDetail:d.showDetail,brushSelect:(n=d.brushSelect)!==null&&n!==void 0&&n,zoomLock:(o=d.zoomLock)!==null&&o!==void 0&&o,minSpan:this._minSpan,maxSpan:this._maxSpan,delayType:d.delayType,delayTime:isValid(d.delayType)?(l=d.delayTime)!==null&&l!==void 0?l:30:0,realTime:(u=d.realTime)===null||u===void 0||u,previewData:e&&this._data.getLatestData(),previewPointsX:e&&this._dataToPositionX,previewPointsY:e&&this._dataToPositionY,tolerance:this._spec.tolerance},this._getComponentAttrs(e))}_createOrUpdateComponent(){if(this._visible){const e=this._isHorizontal?this._stateScale:this._valueScale,i=this._isHorizontal?this._valueScale:this._stateScale,n=this._isScaleValid(e)&&this._isScaleValid(i)&&this._spec.showBackgroundChart!==!1,o=this._getAttrs(n);if(this._component)this._component.setAttributes(o);else{const l=this.getContainer();this._component=new DataZoom$1(o),this._isHorizontal?n&&this._component.setPreviewPointsY1(this._dataToPositionY2):n&&this._component.setPreviewPointsX1(this._dataToPositionX2),this._component.setStatePointToData(u=>this._statePointToData(u)),this._component.addEventListener("change",u=>{const{start:d,end:f,tag:g}=u.detail;this._handleChange(d,f,void 0,g)}),l.add(this._component),this._updateScaleRange()}}}_handleChange(e,i,n,o){if(super._handleChange(e,i,n),this._shouldChange){n&&this._component&&this._component.setStartAndEnd(e,i),this._start=e,this._end=i;const l=this._statePointToData(e),u=this._statePointToData(i);(isFunction(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(e,i,l,u):this._handleStateChange(l,u,o))&&this.event.emit(ChartEvent.dataZoomChange,{model:this,value:{filterData:this._filterMode!=="axis",start:e,end:i,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){var e;const i=this._data.getDataView();if(i.reRunAllTransform(),(e=this._component)===null||e===void 0||e.setPreviewData(i.latestData),this._valueScale){const n=this._computeDomainOfValueScale();n&&this._valueScale.domain(n)}}_getComponentAttrs(e){var i,n,o,l,u,d,f,g,_,y,b;const{middleHandler:S={},startText:v={},endText:A={},backgroundChart:x={},selectedBackgroundChart:T={}}=this._spec;return{backgroundStyle:transformToGraphic((i=this._spec.background)===null||i===void 0?void 0:i.style),startHandlerStyle:transformToGraphic((n=this._spec.startHandler)===null||n===void 0?void 0:n.style),middleHandlerStyle:S.visible?{visible:!0,icon:transformToGraphic((o=S.icon)===null||o===void 0?void 0:o.style),background:{size:(l=S.background)===null||l===void 0?void 0:l.size,style:transformToGraphic((u=S.background)===null||u===void 0?void 0:u.style)}}:{visible:!1},endHandlerStyle:transformToGraphic((d=this._spec.endHandler)===null||d===void 0?void 0:d.style),startTextStyle:{padding:v.padding,formatMethod:this._getHandlerTextFormatMethod(v),textStyle:transformToGraphic(v.style)},endTextStyle:{padding:A.padding,formatMethod:this._getHandlerTextFormatMethod(A),textStyle:transformToGraphic(A.style)},selectedBackgroundStyle:transformToGraphic(this._spec.selectedBackground.style),dragMaskStyle:transformToGraphic((f=this._spec.dragMask)===null||f===void 0?void 0:f.style),backgroundChartStyle:e?{line:mergeSpec(transformToGraphic((g=x.line)===null||g===void 0?void 0:g.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},transformToGraphic((_=x.area)===null||_===void 0?void 0:_.style))}:{line:{visible:!1},area:{visible:!1}},selectedBackgroundChartStyle:e?{line:mergeSpec(transformToGraphic((y=T.line)===null||y===void 0?void 0:y.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},transformToGraphic((b=T.area)===null||b===void 0?void 0:b.style))}:{line:{visible:!1},area:{visible:!1}},disableTriggerEvent:this._option.disableTriggerEvent}}_getHandlerTextFormatMethod(e){const{formatMethod:i,formatter:n}=e,{formatFunc:o}=getFormatFunction(i,n);return o?l=>o(l,{label:l},n):void 0}_getNeedClearVRenderComponents(){return[this._component]}clear(){if(this._component){const e=this.getContainer();this._component.removeAllChild(),e&&e.removeChild(this._component),this._component=null}super.clear()}}DataZoom.type=ComponentTypeEnum.dataZoom,DataZoom.transformerConstructor=DataZoomSpecTransformer,DataZoom.specKey="dataZoom";const registerDataZoom=()=>{Factory$1.registerComponent(DataZoom.type,DataZoom)};class ScrollBar extends DataFilterBaseComponent{constructor(e,i){var n;super(e,i),this.type=ComponentTypeEnum.scrollBar,this.name=ComponentTypeEnum.scrollBar,this.specKey="scrollBar",this.layoutZIndex=LayoutZIndex.DataZoom,this.layoutLevel=LayoutLevel.DataZoom,this.layoutType="region-relative",this._filterMode=(n=e.filterMode)!==null&&n!==void 0?n:"axis"}setAttrFromSpec(){super.setAttrFromSpec(),isBoolean(this._spec.roam)&&(this._zoomAttr.enable=!1,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode)}onLayoutEnd(e){var i,n;this._updateScaleRange(),(n=(i=this.effect).onZoomChange)===null||n===void 0||n.call(i),super.onLayoutEnd(e)}_updateScaleRange(){this._component&&this._component.setAttributes({x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height})}_computeWidth(){return isNumber(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:SCROLL_BAR_DEFAULT_SIZE}_computeHeight(){return isNumber(this._spec.height)?this._spec.height:this._isHorizontal?SCROLL_BAR_DEFAULT_SIZE:this.getLayoutRect().height}_getAttrs(){var e,i,n,o,l,u;return Object.assign({zIndex:this.layoutZIndex,x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height,range:[this._start,this._end],direction:this._isHorizontal?"horizontal":"vertical",delayType:(e=this._spec)===null||e===void 0?void 0:e.delayType,delayTime:isValid((i=this._spec)===null||i===void 0?void 0:i.delayType)?(o=(n=this._spec)===null||n===void 0?void 0:n.delayTime)!==null&&o!==void 0?o:30:0,realTime:(u=(l=this._spec)===null||l===void 0?void 0:l.realTime)===null||u===void 0||u},this._getComponentAttrs())}_createOrUpdateComponent(){const e=this._getAttrs();if(this._component)this._component.setAttributes(e);else{const i=this.getContainer();this._component=new ScrollBar$1(e),this._component.addEventListener("scrollDrag",n=>{const o=n.detail.value;this._handleChange(o[0],o[1])}),i.add(this._component)}}_handleChange(e,i,n){super._handleChange(e,i,n);const o=isClose(this._start,e)&&isClose(this._end,i);if(this._shouldChange&&!o){n&&this._component&&this._component.setAttribute("range",[e,i]),this._start=e,this._end=i;const l=this._statePointToData(e),u=this._statePointToData(i);(isFunction(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(e,i,l,u):this._handleStateChange(this._statePointToData(e),this._statePointToData(i)))&&this.event.emit(ChartEvent.scrollBarChange,{model:this,value:{filterData:this._filterMode!=="axis",start:this._start,end:this._end,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){this._spec.auto&&this._data.getDataView().reRunAllTransform()}_initCommonEvent(){super._initCommonEvent(),this._component&&this._component.on("scrollDrag",e=>{const i=e.detail.value;this._handleChange(i[0],i[1])})}_getComponentAttrs(){const{rail:e,slider:i,innerPadding:n}=this._spec,o={};return isNil(n)||(o.padding=n),isEmpty(e==null?void 0:e.style)||(o.railStyle=transformToGraphic(e.style)),isEmpty(i==null?void 0:i.style)||(o.sliderStyle=transformToGraphic(i.style)),o.disableTriggerEvent=this._option.disableTriggerEvent,o}_getNeedClearVRenderComponents(){return[this._component]}}ScrollBar.type=ComponentTypeEnum.scrollBar,ScrollBar.specKey="scrollBar";const registerScrollBar=()=>{Factory$1.registerComponent(ScrollBar.type,ScrollBar)},indicatorMapper=(r,e)=>{const{datum:i,title:n,content:o}=e,l=[],u=i.call(null);return n.visible&&l.push({type:"title",index:0,datum:u,spec:n}),array(o).forEach((d,f)=>{d.visible&&l.push({type:"content",index:f,datum:u,spec:d})}),l};var __rest$3=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class Indicator extends BaseComponent{constructor(){super(...arguments),this.type=ComponentTypeEnum.indicator,this.name=ComponentTypeEnum.indicator,this.specKey="indicator",this.layoutType="none",this.layoutZIndex=LayoutZIndex.Indicator,this.layoutLevel=LayoutLevel.Indicator,this._gap=0,this._activeDatum=null}static getSpecInfo(e){return getSpecInfo(e,this.specKey,this.type,i=>i&&i.visible!==!1)}created(){super.created(),this.initData(),this.initEvent()}setAttrFromSpec(){super.setAttrFromSpec(),this._gap=this._spec.gap||0,this._title=this._spec.title,this._content=array(this._spec.content),this._regions=this._option.getRegionsInUserIdOrIndex(array(this._spec.regionId),array(this._spec.regionIndex))}onRender(e){}changeRegions(e){}initEvent(){var e;if(this._option.disableTriggerEvent||this._spec.trigger==="none")return;const i=(e=this.getCompiler())===null||e===void 0?void 0:e.getVGrammarView();i&&(this._spec.trigger==="hover"?(i.addEventListener("element-highlight:start",n=>{this.isRelativeModel(n.options.regionId)&&this.updateDatum(n.elements[0].getDatum())}),i.addEventListener("element-highlight:reset",n=>{this.isRelativeModel(n.options.regionId)&&this.updateDatum(null)})):(i.addEventListener("element-select:start",n=>{this.isRelativeModel(n.options.regionId)&&this.updateDatum(n.elements[0].getDatum())}),i.addEventListener("element-select:reset",n=>{this.isRelativeModel(n.options.regionId)&&this.updateDatum(null)})))}updateDatum(e){this._activeDatum=e,this._displayData.updateData();const i=this._getIndicatorAttrs();this._createOrUpdateIndicatorComponent(i)}initData(){registerDataSetInstanceTransform(this._option.dataSet,"indicatorFilter",indicatorMapper);const e=new DataView(this._option.dataSet,{name:`${this.type}_${this.id}_data`});e.transform({type:"indicatorFilter",options:{title:this._title,content:this._content,datum:()=>this._activeDatum}}),e.target.addListener("change",this.updateDatum.bind(this)),this._displayData=new CompilableData(this._option,e)}updateLayoutAttribute(){const e=this._getIndicatorAttrs();this._createOrUpdateIndicatorComponent(e),super.updateLayoutAttribute()}_getIndicatorAttrs(){if(this._spec.visible===!1||this._spec.fixed===!1&&this._activeDatum===null)return{visible:!1};const e=this._regions[0],{width:i,height:n}=e.getLayoutRect(),{x:o,y:l}=e.getLayoutStartPoint(),u=this._spec,{content:d,offsetX:f,offsetY:g,limitRatio:_,title:y}=u,b=__rest$3(u,["content","offsetX","offsetY","limitRatio","title"]),S=[];return array(d).forEach(v=>{const A=mergeSpec({},this._theme.content,v);S.push({visible:A.visible!==!1&&(!A.field||this._activeDatum!==null),space:A.space||this._gap,autoLimit:A.autoLimit,autoFit:A.autoFit,fitPercent:A.fitPercent,fitStrategy:A.fitStrategy,style:Object.assign(Object.assign({},transformIndicatorStyle(pickWithout(A.style,["text"]),this._activeDatum)),{text:this._createText(A.field,A.style.text)})})}),Object.assign({visible:!0,size:{width:i,height:n},zIndex:this.layoutZIndex,x:o,y:l,dx:f?getActualNumValue(f,this._computeLayoutRadius()):0,dy:g?getActualNumValue(g,this._computeLayoutRadius()):0,limitRatio:_||1/0,title:{visible:y.visible!==!1&&(!isValid(y.field)||this._activeDatum!==null),space:y.space||this._gap,autoLimit:y.autoLimit,autoFit:y.autoFit,fitPercent:y.fitPercent,fitStrategy:y.fitStrategy,style:Object.assign(Object.assign({},transformIndicatorStyle(pickWithout(y.style,["text"]),this._activeDatum)),{text:this._createText(y.field,y.style.text)})},content:S},b)}_createOrUpdateIndicatorComponent(e){if(e.visible===!1)return this._indicatorComponent&&this._indicatorComponent.parent&&this._indicatorComponent.parent.removeChild(this._indicatorComponent),void(this._indicatorComponent=null);if(this._indicatorComponent)isEqual(e,this._cacheAttrs)||this._indicatorComponent.setAttributes(e);else{const i=this.getContainer(),n=new Indicator$1(e);n.name="indicator",i.add(n),this._indicatorComponent=n,this._indicatorComponent.on("*",(o,l)=>this._delegateEvent(this._indicatorComponent,o,l))}this._cacheAttrs=e}_createText(e,i){var n;return e?this._activeDatum?this._activeDatum[e]:"":isFunction(i)?(n=i(this._activeDatum,void 0))!==null&&n!==void 0?n:"":i??""}_computeLayoutRadius(){const e=this._regions[0],{width:i,height:n}=e.getLayoutRect();return Math.min(i/2,n/2)}isRelativeModel(e){return this._regions.some(i=>i.id===e)}_getNeedClearVRenderComponents(){return[this._indicatorComponent]}clear(){this._cacheAttrs=null,super.clear()}getIndicatorComponent(){return this._indicatorComponent}}Indicator.type=ComponentTypeEnum.indicator,Indicator.specKey="indicator";const registerIndicator=()=>{Factory$1.registerComponent(Indicator.type,Indicator)},AGGR_TYPE=["sum","average","min","max","variance","standardDeviation","median"];var __rest$2=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};function isNeedExtendDomain(r,e,i){if(!i)return!1;const n=r.map(u=>1*u),o=minInArray(n),l=maxInArray(n);return e<o||e>l}function getXValue(r,e,i,n,o,l){var u,d;const{relativeSeries:f}=n;let g;return isNumber(r.x)&&isNeedExtendDomain(e,r.x,i)&&((d=f==null?void 0:(u=f.getXAxisHelper()).setExtendDomain)===null||d===void 0||d.call(u,"marker_xAxis_extend",r.x)),g=isPercent(r.x)?convertPercentToValue(r.x,o)+l.x:f.getXAxisHelper().dataToPosition([r.x])+l.x,g}function getYValue(r,e,i,n,o,l){var u,d;const{relativeSeries:f}=n;let g;return isNumber(r.y)&&isNeedExtendDomain(e,r.y,i)&&((d=(u=f.getYAxisHelper())===null||u===void 0?void 0:u.setExtendDomain)===null||d===void 0||d.call(u,"marker_yAxis_extend",r.y)),g=isPercent(r.y)?convertPercentToValue(r.y,o)+l.y:f.getYAxisHelper().dataToPosition([r.y])+l.y,g}function getAngleValue(r,e,i,n){var o,l;const{relativeSeries:u}=n;return isNumber(r.angle)&&isNeedExtendDomain(e,r.angle,i)&&((l=(o=u.angleAxisHelper)===null||o===void 0?void 0:o.setExtendDomain)===null||l===void 0||l.call(o,"marker_angleAxis_extend",r.angle)),u.angleAxisHelper.dataToPosition([r.angle])}function getRadiusValue(r,e,i,n){var o,l;const{relativeSeries:u}=n;return isNumber(r.radius)&&isNeedExtendDomain(e,r.radius,i)&&((l=(o=u.radiusAxisHelper)===null||o===void 0?void 0:o.setExtendDomain)===null||l===void 0||l.call(o,"marker_radiusAxis_extend",r.radius)),u.radiusAxisHelper.dataToPosition([r.radius])}function convertPercentToValue(r,e){return Number(r.substring(0,r.length-1))*e/100}function isAggrSpec(r){return AGGR_TYPE.includes(r)}function xyLayout(r,e,i,n,o){const l=e.getRegion(),u=l.getLayoutStartPoint(),d=i.getRegion(),f=d.getLayoutStartPoint(),g=Math.abs(Math.min(u.x,f.x)-Math.max(u.x+l.getLayoutRect().width,f.x+d.getLayoutRect().width)),_=Math.abs(Math.min(u.y,f.y)-Math.max(u.y+l.getLayoutRect().height,f.y+d.getLayoutRect().height)),y={relativeSeries:n},b=[],S=r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData,v=n.getXAxisHelper().getScale(0).domain(),A=n.getYAxisHelper().getScale(0).domain();return S.forEach(x=>{const T=isValid(x.x),C=isValid(x.y);if(T&&C){const E=getXValue(x,v,o,y,g,u),P=getYValue(x,A,o,y,_,u);b.push([{x:E,y:P}])}else if(T){const E=getXValue(x,v,o,y,g,u),P=Math.max(u.y+l.getLayoutRect().height,f.y+d.getLayoutRect().height),L=Math.min(u.y,f.y);b.push([{x:E,y:P},{x:E,y:L}])}else if(C){const E=Math.min(u.x,f.x),P=getYValue(x,A,o,y,_,u),L=Math.max(u.x+l.getLayoutRect().width,f.x+d.getLayoutRect().width);b.push([{x:E,y:P},{x:L,y:P}])}}),b}function polarLayout(r,e,i,n,o){const l={relativeSeries:n},u=[],d=r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData,f=n.angleAxisHelper.getScale(0).domain(),g=n.radiusAxisHelper.getScale(0).domain(),_=Math.min(n.getRegion().getLayoutRect().width/2,n.getRegion().getLayoutRect().height/2);return d.forEach(y=>{const b=isValid(y.angle),S=isValid(y.radius);if(b&&S){const v=getAngleValue(y,f,o,l),A=getRadiusValue(y,g,o,l);u.push([{angle:v,radius:A}])}else if(b){const v=getAngleValue(y,f,o,l);u.push([{angle:v,radius:-_},{angle:v,radius:_}])}else if(S){const v=getRadiusValue(y,g,o,l);u.push([{radius:v,angle:0},{radius:v,angle:2*Math.PI}])}}),u}function geoLayout(r,e){const i=[];return(r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData).forEach(n=>{isValid(n.areaName)&&i.push([{x:e.nameValueToPosition(n.areaName).x+e.getRegion().getLayoutStartPoint().x,y:e.nameValueToPosition(n.areaName).y+e.getRegion().getLayoutStartPoint().y}])}),i}function cartesianCoordinateLayout(r,e,i,n){const o=[],l=r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData,u=isArray(n);return l.forEach((d,f)=>{var g,_,y,b;const S=d!=null&&d.getRefRelativeSeries?d.getRefRelativeSeries():e,v=S.getRegion(),A=v.getLayoutStartPoint(),{width:x,height:T}=v.getLayoutRect();let C=0,E=0;if(n){const D=u?n[f]:n,I=D.x,O=D.y;I&&(C=isPercent(I)?Number(I.substring(0,I.length-1))*x/100:I),O&&(E=isPercent(O)?Number(O.substring(0,O.length-1))*T/100:O)}const P=S.getXAxisHelper().getScale(0).domain(),L=S.getYAxisHelper().getScale(0).domain(),R=array(d.x),w=array(d.y);R.length===1&&isNumber(R[0])&&isNeedExtendDomain(P,R[0],i)&&((_=(g=S.getXAxisHelper())===null||g===void 0?void 0:g.setExtendDomain)===null||_===void 0||_.call(g,"marker_xAxis_extend",R[0])),w.length===1&&isNumber(w[0])&&isNeedExtendDomain(L,w[0],i)&&((b=(y=S.getYAxisHelper())===null||y===void 0?void 0:y.setExtendDomain)===null||b===void 0||b.call(y,"marker_yAxis_extend",w[0])),o.push({x:S.getXAxisHelper().dataToPosition(R)+A.x+C,y:S.getYAxisHelper().dataToPosition(w)+A.y+E})}),o}function polarCoordinateLayout(r,e,i){const n=[];return(r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData).forEach(o=>{var l,u,d,f;const g=o!=null&&o.getRefRelativeSeries?o.getRefRelativeSeries():e,_=g.angleAxisHelper.getScale(0).domain(),y=g.radiusAxisHelper.getScale(0).domain(),b=array(o.angle),S=array(o.radius);b.length===1&&isNumber(b[0])&&isNeedExtendDomain(_,b[0],i)&&((u=(l=g.angleAxisHelper)===null||l===void 0?void 0:l.setExtendDomain)===null||u===void 0||u.call(l,"marker_xAxis_extend",b[0])),S.length===1&&isNumber(S[0])&&isNeedExtendDomain(y,S[0],i)&&((f=(d=g.radiusAxisHelper)===null||d===void 0?void 0:d.setExtendDomain)===null||f===void 0||f.call(d,"marker_yAxis_extend",S[0])),n.push({angle:g.angleAxisHelper.dataToPosition(b),radius:g.radiusAxisHelper.dataToPosition(S)})}),n}function convertPosition(r,e,i){let{x:n,y:o}=r;return isPercent(n)&&(n=convertPercentToValue(n,e)),isPercent(o)&&(o=convertPercentToValue(o,i)),{x:n,y:o}}function positionLayout(r,e,i){let n;if(n=isFunction(r)?array(r(e.getData().getLatestData(),e)):array(r),i){const u=e.getRegion(),{x:d,y:f}=u.getLayoutStartPoint(),{width:g,height:_}=u.getLayoutRect();return n.map(y=>{let{x:b,y:S}=convertPosition(y,g,_);return b+=d,S+=f,{x:b,y:S}})}const{width:o,height:l}=e.getOption().getChart().getViewRect();return n.map(u=>convertPosition(u,o,l))}function computeClipRange(r){let e=1/0,i=-1/0,n=1/0,o=-1/0;return r.forEach(l=>{const u=l.getLayoutStartPoint(),d=l.getLayoutRect();u.x<e&&(e=u.x),u.x+d.width>i&&(i=u.x+d.width),u.y<n&&(n=u.y),u.y+d.height>o&&(o=u.y+d.height)}),{minX:e,maxX:i,minY:n,maxY:o}}function transformLabelAttributes(r,e,i){const{labelBackground:n={},style:o,shape:l}=r,u=__rest$2(r,["labelBackground","style","shape"]);if(r.visible!==!1){const d=u;return l!=null&&l.visible?d.shape=Object.assign({visible:!0},transformToGraphic(l.style)):d.shape={visible:!1},n.visible!==!1?(d.panel=Object.assign({visible:!0,customShape:n.customShape},transformStyle(transformToGraphic(n.style),e,i)),isValid(n.padding)&&(d.padding=normalizePadding$1(n.padding))):(d.panel={visible:!1},d.padding=0),o&&(d.textStyle=transformStyle(transformToGraphic(o),e,i)),d}return{visible:!1}}function transformState(r,e,i){for(const n in r)isFunction(r[n])&&(r[n]=r[n](e,i));return r}function transformStyle(r,e,i){return isFunction(r)?r(e,i):r}function transformOffset(r,e){return isFunction(r)?r(e):r}function computeOffsetFromRegion(r,e,i){return isValid(r)?e==="regionLeft"?i.getLayoutStartPoint().x-r.x:e==="regionRight"?i.getLayoutStartPoint().x+i.getLayoutRect().width-r.x:e==="regionTop"?i.getLayoutStartPoint().y-r.y:e==="regionBottom"?i.getLayoutStartPoint().y+i.getLayoutRect().height-r.y:e:e}function getMarkLineProcessInfo(r){const e="x"in r,i="y"in r,n="x1"in r,o="y1"in r,l="angle"in r,u="radius"in r,d="angle1"in r,f="radius1"in r;return{doXProcess:e&&!i&&!o,doXYY1Process:e&&i&&o,doYProcess:i&&!e&&!n,doYXX1Process:i&&e&&n,doXYProcess:e&&i&&n&&o,doAngleProcess:l&&!d&&!u&&!f,doRadiusProcess:u&&!f&&!l&&!d,doAngRadRad1Process:l&&!d&&u&&f,doRadAngAng1Process:u&&l&&d&&!f,doRadAngProcess:l&&u&&d&&f,doCoordinatesProcess:"coordinates"in r&&(!("process"in r)||"process"in r&&"xy"in r.process)}}function getMarkAreaProcessInfo(r){const e="x"in r,i="x1"in r,n="y"in r,o="y1"in r,l="angle"in r,u="radius"in r,d="angle1"in r,f="radius1"in r;return{doXProcess:e&&i&&!n&&!o,doYProcess:n&&o&&!e&&!i,doXYProcess:e&&i&&n&&o,doAngleProcess:l&&d&&!u&&!f,doRadiusProcess:u&&f&&!l&&!d,doRadAngProcess:l&&u&&d&&f,doCoordinatesProcess:"coordinates"in r}}function getMarkPointProcessInfo(r){return{doXYProcess:isValid(r.x)&&isValid(r.y),doPolarProcess:isValid(r.angle)&&isValid(r.radius),doGeoProcess:isValid(r.areaName)}}function getInsertPoints(r,e,i,n=0){const o=[],l=r.y-e.y,u=r.x-e.x;switch(i){case"top":o.push(r),o.push({x:r.x,y:l>0?r.y-n-Math.abs(l):r.y-n}),o.push({x:e.x,y:l>0?e.y-n:e.y-n-Math.abs(l)}),o.push(e);break;case"bottom":o.push(r),o.push({x:r.x,y:l<0?r.y+n+Math.abs(l):r.y+n}),o.push({x:e.x,y:l<0?e.y+n:e.y+n+Math.abs(l)}),o.push(e);break;case"left":o.push(r),o.push({x:u>0?r.x-n-Math.abs(u):r.x-n,y:r.y}),o.push({x:u>0?e.x-n:e.x-n-Math.abs(u),y:e.y}),o.push(e);break;case"right":o.push(r),o.push({x:u>0?r.x+n:r.x+n+Math.abs(u),y:r.y}),o.push({x:u>0?e.x+n+Math.abs(u):e.x+n,y:e.y}),o.push(e)}return o}function getTextOffset(r,e,i,n=0){const o=r.y-e.y,l=r.x-e.x;return i==="bottom"?{dx:l>0?-l/2:Math.abs(l/2),dy:o>0?n:Math.abs(o)+n}:i==="top"?{dx:l>0?-Math.abs(l/2):+Math.abs(l/2),dy:o>0?-(Math.abs(o)+n):-n}:i==="left"?{dx:l>0?-l-n:-n,dy:o>0?-o/2:Math.abs(o/2)}:i==="right"?{dx:l>0?n:Math.abs(l)+n,dy:o>0?-o/2:Math.abs(o/2)}:{}}var __rest$1=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};const markerMin=(r,e)=>{const i=r[0].latestData;return min(i,e.field)},markerMax=(r,e)=>{const i=r[0].latestData;return max(i,e.field)};function markerSum(r,e){const i=r[0].latestData;return sum$1(i,e.field)}function markerAverage(r,e){const i=r[0].latestData;return average$1(i,e.field)}function markerVariance(r,e){const i=r[0].latestData;return variance(i,e.field)}function markerStandardDeviation(r,e){const i=r[0].latestData;return standardDeviation(i,e.field)}function markerMedian(r,e){const i=r[0].latestData;return median(i,e.field)}function markerAggregation(r,e){let i;if(e.coordinates){const o=e,{coordinates:l,coordinateType:u,getSeriesByIdOrIndex:d}=o,f=__rest$1(o,["coordinates","coordinateType","getSeriesByIdOrIndex"]);let g,_;if(isFunction(l)){const y=e.getRelativeSeries();g=l(y.getData().getLatestData(),y)}else g=l;g=array(g),i=g.map(y=>{const b=d(y.refRelativeSeriesId,y.refRelativeSeriesIndex);if(u==="cartesian"){const{xField:S,yField:v}=b.getSpec(),{xFieldDim:A,xFieldIndex:x,yFieldDim:T,yFieldIndex:C}=y;let E=S;isValid(x)&&(E=array(S)[x]),A&&array(S).includes(A)&&(E=A);let P=v;isValid(C)&&(P=array(v)[C]),T&&array(v).includes(T)&&(P=T),_=Object.assign({x:void 0,y:void 0},f),isString(y[E])&&isAggrSpec(y[E])?_.x={field:E,aggrType:y[E]}:_.x=array(E).map(L=>y[L]),isString(y[P])&&isAggrSpec(y[P])?_.y={field:P,aggrType:y[P]}:_.y=array(P).map(L=>y[L])}else if(u==="polar"){const{valueField:S,categoryField:v}=b.getSpec(),{angleFieldDim:A,angleFieldIndex:x}=y;let T=v;isValid(x)&&(T=array(v)[x]),A&&array(v).includes(A)&&(T=A);const C=S;_=Object.assign({angle:void 0,radius:void 0},f),isString(y[T])&&isAggrSpec(y[T])?_.angle={field:T,aggrType:y[T]}:_.angle=array(T).map(E=>y[E]),isString(y[C])&&isAggrSpec(y[C])?_.radius={field:C,aggrType:y[C]}:_.radius=array(C).map(E=>y[E])}return _.getRefRelativeSeries=()=>b,_})}else i=e;const n=[];return i.forEach(o=>{const l={x:null,y:null,angle:null,radius:null,areaName:null};if(isValid(o.x)){const u=o.x;isArray(u)?l.x=u.map(d=>getFinalValue(d,r,o)):l.x=getFinalValue(u,r,o)}if(isValid(o.y)){const u=o.y;isArray(u)?l.y=u.map(d=>getFinalValue(d,r,o)):l.y=getFinalValue(u,r,o)}if(isValid(o.angle)){const u=o.angle;isArray(u)?l.angle=u.map(d=>getFinalValue(d,r,o)):l.angle=getFinalValue(u,r,o)}if(isValid(o.radius)){const u=o.radius;isArray(u)?l.radius=u.map(d=>getFinalValue(d,r,o)):l.radius=getFinalValue(u,r,o)}if(isValid(o.areaName)){const u=o.areaName;l.areaName=getFinalValue(u,r,o)}o.getRefRelativeSeries&&(l.getRefRelativeSeries=o.getRefRelativeSeries),n.push(l)}),n}const aggrMap={min:markerMin,max:markerMax,sum:markerSum,average:markerAverage,variance:markerVariance,standardDeviation:markerStandardDeviation,median:markerMedian};function getFinalValue(r,e,i){const n=i.getRelativeSeries(),o=i.getStartRelativeSeries(),l=i.getEndRelativeSeries(),u=n.getData().getLatestData(),d=o.getData().getLatestData(),f=l.getData().getLatestData();if(isFunction(r))return r(u,d,f,n,o,l);if(isPlainObject(r)){const{aggrType:g,field:_}=r;return aggrMap[g](e,{field:_})}return r}function markerFilter(r,e){if(e&&e.getRelativeSeries){const i=e.getRelativeSeries();if(i){const n=i.getViewData();return n&&n.latestData&&n.latestData.length?r:[]}}return r}class BaseMarker extends BaseComponent{constructor(){super(...arguments),this.layoutType="none",this._layoutOffsetX=0,this._layoutOffsetY=0}getRelativeSeries(){return this._relativeSeries}getMarkerData(){return this._markerData}static _getMarkerCoordinateType(e){return"cartesian"}static getSpecInfo(e){return getSpecInfo(e,this.specKey,this.type,i=>i.visible!==!1&&this._getMarkerCoordinateType(i)===this.coordinateType)}getMarkAttributeContext(){return this._markAttributeContext}_buildMarkerAttributeContext(){this._markAttributeContext={relativeSeries:this._relativeSeries,startRelativeSeries:this._startRelativeSeries,endRelativeSeries:this._endRelativeSeries,vchart:this._option.globalInstance}}created(){super.created(),this._bindSeries(),this._initDataView(),this.initEvent(),this._buildMarkerAttributeContext()}_getAllRelativeSeries(){return{getRelativeSeries:()=>this._relativeSeries,getStartRelativeSeries:()=>this._startRelativeSeries,getEndRelativeSeries:()=>this._endRelativeSeries}}_getFieldInfoFromSpec(e,i,n){const o={x:"xField",y:"yField",radius:"valueField",angle:"categoryField",areaName:"nameField"};return isString(i)&&isAggrSpec(i)?{field:n.getSpec()[o[e]],aggrType:i}:i}_processSpecByDims(e){const i=this._relativeSeries,n={};return e.forEach(o=>n[o.dim]=this._getFieldInfoFromSpec(o.dim,o.specValue,i)),Object.assign(Object.assign({},n),this._getAllRelativeSeries())}_processSpecCoo(e){return Object.assign(Object.assign({coordinates:e.coordinates||e.coordinate},this._getAllRelativeSeries()),{getSeriesByIdOrIndex:(i,n)=>this._getSeriesByIdOrIndex(i,n),coordinateType:this.coordinateType})}_getRelativeDataView(){if(this._specifiedDataSeries){let e=[];array(this._specifiedDataSeries).forEach(n=>{e=e.concat(n.getViewData().latestData)});const i=new DataSet;return i.registerParser("array",arrayParser),new DataView(i).parse(e,{type:"array"})}return this._relativeSeries.getViewData()}updateLayoutAttribute(){var e,i,n;if((e=this._spec.visible)===null||e===void 0||e){if(!this._markerComponent){const o=this._createMarkerComponent();o.name=(i=this._spec.name)!==null&&i!==void 0?i:this.type,o.id=(n=this._spec.id)!==null&&n!==void 0?n:`${this.type}-${this.id}`,this._markerComponent=o,this.getContainer().add(this._markerComponent),this._markerComponent.on("*",(l,u)=>{this._delegateEvent(this._markerComponent,l,u,null,this.getMarkerData.bind(this))})}this._markerLayout()}super.updateLayoutAttribute()}_getSeriesByIdOrIndex(e,i){var n,o;let l;return l=(n=this._option.getSeriesInUserIdOrIndex(isValid(e)?[e]:[],[i]))===null||n===void 0?void 0:n[0],l||(l=(o=this._relativeSeries)!==null&&o!==void 0?o:this._getFirstSeries()),l}_bindSeries(){const e=this._spec;this._relativeSeries=this._getSeriesByIdOrIndex(e.relativeSeriesId,e.relativeSeriesIndex),this._startRelativeSeries=this._getSeriesByIdOrIndex(e.startRelativeSeriesId,e.startRelativeSeriesIndex),this._endRelativeSeries=this._getSeriesByIdOrIndex(e.endRelativeSeriesId,e.endRelativeSeriesIndex),e.specifiedDataSeriesIndex&&e.specifiedDataSeriesIndex==="all"||e.specifiedDataSeriesId&&e.specifiedDataSeriesId==="all"?this._specifiedDataSeries=this._option.getAllSeries():(e.specifiedDataSeriesIndex||e.specifiedDataSeriesId)&&(this._specifiedDataSeries=this._getSeriesByIdOrIndex(e.specifiedDataSeriesId,e.specifiedDataSeriesIndex))}initEvent(){this._relativeSeries.coordinate!=="cartesian"&&(this._relativeSeries.event.on("zoom",this._markerLayout.bind(this)),this._relativeSeries.event.on("panmove",this._markerLayout.bind(this)),this._relativeSeries.event.on("scroll",this._markerLayout.bind(this)))}onRender(e){}changeRegions(e){}clear(){super.clear(),this._firstSeries=null}_getFirstSeries(){var e;if(this._firstSeries)return this._firstSeries;const i=getFirstSeries(this._regions);return i?(this._firstSeries=i,i):((e=this._option)===null||e===void 0||e.onError("need at least one series"),null)}_getNeedClearVRenderComponents(){return[this._markerComponent]}onLayoutStart(e,i,n){isNil(this._spec.offsetX)||(this._layoutOffsetX=calcLayoutNumber(this._spec.offsetX,i.width,i)),isNil(this._spec.offsetY)||(this._layoutOffsetY=calcLayoutNumber(this._spec.offsetY,i.height,i)),super.onLayoutStart(e,i,n)}_compareSpec(e,i){const n=super._compareSpec(e,i);return isEqual(i,e)||(n.reRender=!0,n.reMake=!0,n.change=!0),n}_initCommonDataView(){const{options:e}=this._computeOptions(),i=this._getRelativeDataView();registerDataSetInstanceTransform(this._option.dataSet,"markerAggregation",markerAggregation),registerDataSetInstanceTransform(this._option.dataSet,"markerFilter",markerFilter);const n=new DataView(this._option.dataSet,{name:`${this.type}_${this.id}_data`});n.parse([i],{type:"dataview"}),n.transform({type:"markerAggregation",options:e}),n.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),n.target.on("change",()=>{this._markerLayout()}),this._markerData=n}}function markerRegression(r,e){const i=r[0].latestData;return regression(i,e.fieldX,e.fieldY)}class BaseMarkLine extends BaseMarker{constructor(){super(...arguments),this.specKey="markLine",this.layoutZIndex=LayoutZIndex.MarkLine}static _getMarkerCoordinateType(e){const{doAngleProcess:i,doRadiusProcess:n,doAngRadRad1Process:o,doRadAngAng1Process:l,doRadAngProcess:u}=getMarkLineProcessInfo(e);return e.coordinateType==="polar"||i||n||o||l||u?"polar":"cartesian"}_createMarkerComponent(){var e,i,n,o,l,u,d,f,g,_,y,b,S,v,A,x,T,C,E;const{label:P={},startSymbol:L={},endSymbol:R={}}=this._spec,w={zIndex:this.layoutZIndex,interactive:(e=this._spec.interactive)===null||e===void 0||e,hover:(i=this._spec.interactive)===null||i===void 0||i,select:(n=this._spec.interactive)===null||n===void 0||n,points:[{x:0,y:0},{x:0,y:0}],center:{x:0,y:0},radius:0,startAngle:0,endAngle:0,lineStyle:transformStyle(transformToGraphic((o=this._spec.line)===null||o===void 0?void 0:o.style),this._markerData,this._markAttributeContext),clipInRange:(l=this._spec.clip)!==null&&l!==void 0&&l,label:transformLabelAttributes(P,this._markerData,this._markAttributeContext),state:{line:transformState((d=(u=this._spec.line)===null||u===void 0?void 0:u.state)!==null&&d!==void 0?d:{},this._markerData,this._markAttributeContext),lineStartSymbol:transformState((g=(f=this._spec.startSymbol)===null||f===void 0?void 0:f.state)!==null&&g!==void 0?g:{},this._markerData,this._markAttributeContext),lineEndSymbol:transformState((y=(_=this._spec.endSymbol)===null||_===void 0?void 0:_.state)!==null&&y!==void 0?y:{},this._markerData,this._markAttributeContext),label:transformState((v=(S=(b=this._spec)===null||b===void 0?void 0:b.label)===null||S===void 0?void 0:S.state)!==null&&v!==void 0?v:{},this._markerData,this._markAttributeContext),labelBackground:transformState((C=(T=(x=(A=this._spec)===null||A===void 0?void 0:A.label)===null||x===void 0?void 0:x.labelBackground)===null||T===void 0?void 0:T.state)!==null&&C!==void 0?C:{},this._markerData,this._markAttributeContext)},animation:(E=this._spec.animation)!==null&&E!==void 0&&E,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return L.visible?w.startSymbol=Object.assign(Object.assign({},L),{visible:!0,style:transformStyle(transformToGraphic(L.style),this._markerData,this._markAttributeContext)}):w.startSymbol={visible:!1},R.visible?w.endSymbol=Object.assign(Object.assign({},R),{visible:!0,style:transformStyle(transformToGraphic(R.style),this._markerData,this._markAttributeContext)}):w.endSymbol={visible:!1},this._newMarkLineComponent(w)}_getUpdateMarkerAttrs(){var e,i,n,o;const l=this._spec,u=this._markerData,d=this._startRelativeSeries,f=this._endRelativeSeries,g=this._relativeSeries,_=this._computePointsAttr(),y=g.getViewData().latestData,b=u.latestData[0]&&u.latestData[0].latestData?u.latestData[0].latestData:u.latestData;let S;if(l.clip||!((e=l.label)===null||e===void 0)&&e.confine){const{minX:x,maxX:T,minY:C,maxY:E}=computeClipRange([d.getRegion(),f.getRegion(),g.getRegion()]);S={x,y:C,width:T-x,height:E-C}}const v=(n=(i=this._markerComponent)===null||i===void 0?void 0:i.attribute)!==null&&n!==void 0?n:{},A=Object.assign(Object.assign({},v.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(b,y):(o=v.label)===null||o===void 0?void 0:o.text});return Object.assign(Object.assign({},_),{label:A,limitRect:S,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}_markerLayout(){var e;const i=this._getUpdateMarkerAttrs();(e=this._markerComponent)===null||e===void 0||e.setAttributes(i)}_initDataView(){const e=this._spec,i="coordinates"in e,{doXProcess:n,doYProcess:o,doXYY1Process:l,doYXX1Process:u,doXYProcess:d,doAngleProcess:f,doRadiusProcess:g,doAngRadRad1Process:_,doRadAngAng1Process:y,doRadAngProcess:b}=getMarkLineProcessInfo(e);if(this._markerData=this._getRelativeDataView(),!(n||o||l||u||d||f||g||_||y||b||i))return;registerDataSetInstanceTransform(this._option.dataSet,"markerAggregation",markerAggregation),registerDataSetInstanceTransform(this._option.dataSet,"markerRegression",markerRegression),registerDataSetInstanceTransform(this._option.dataSet,"markerFilter",markerFilter);const{options:S,needAggr:v,needRegr:A,processData:x}=this._computeOptions(),T=new DataView(this._option.dataSet);T.parse([x],{type:"dataview"}),v&&T.transform({type:"markerAggregation",options:S}),A&&T.transform({type:"markerRegression",options:S}),T.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),T.target.on("change",()=>{this._markerLayout()}),this._markerData=T}}BaseMarkLine.specKey="markLine";class CartesianMarkLine extends BaseMarkLine{constructor(){super(...arguments),this.type=ComponentTypeEnum.markLine,this.name=ComponentTypeEnum.markLine,this.coordinateType="cartesian"}_newMarkLineComponent(e){return new MarkLine(e)}_computePointsAttr(){var e;const i=this._spec,n=this._markerData,o=this._startRelativeSeries,l=this._endRelativeSeries,u=this._relativeSeries,d=isValid(i.coordinates),f=isValid(i.process),g=f&&isValid(i.process.x),_=f&&isValid(i.process.y),y=isValid(i.positions),b=(e=i.autoRange)!==null&&e!==void 0&&e,{doXProcess:S,doYProcess:v,doXYY1Process:A,doYXX1Process:x,doXYProcess:T,doCoordinatesProcess:C}=getMarkLineProcessInfo(i);let E=[];if(S||A||v||x||T||d&&g||d&&_){const P=xyLayout(n,o,l,u,b);E=P.length===1?P[0]:P.map(L=>L[0])}else C?E=cartesianCoordinateLayout(n,u,b,i.coordinatesOffset):y&&(E=positionLayout(i.positions,u,i.regionRelative));return{points:E}}_markerLayout(){var e,i,n,o,l,u,d,f;const g=this._getUpdateMarkerAttrs();if(this._spec.type==="type-step"){const _=this._startRelativeSeries,y=this._endRelativeSeries,{multiSegment:b,mainSegmentIndex:S}=this._spec.line||{},{connectDirection:v,expandDistance:A=0}=this._spec;let x;if(isPercent(A)){const w=_.getRegion(),D=w.getLayoutStartPoint(),I=y.getRegion(),O=I.getLayoutStartPoint();if(v==="bottom"||v==="top"){const B=Math.abs(Math.min(D.y,O.y)-Math.max(D.y+w.getLayoutRect().height,O.y+I.getLayoutRect().height));x=Number(A.substring(0,A.length-1))*B/100}else{const B=Math.abs(Math.min(D.x,O.x)-Math.max(D.x+w.getLayoutRect().width,O.x+I.getLayoutRect().width));x=Number(A.substring(0,A.length-1))*B/100}}else x=A;const{points:T,label:C,limitRect:E}=g,P=getInsertPoints(T[0],T[1],v,x);let L;L=b&&isValid(S)?{position:"middle",autoRotate:!1,refX:0,refY:0}:Object.assign(Object.assign({position:"start",autoRotate:!1},getTextOffset(T[0],T[1],v,x)),{refX:0,refY:0}),isValidNumber((e=this._spec.label)===null||e===void 0?void 0:e.refX)&&(L.refX+=this._spec.label.refX),isValidNumber((i=this._spec.label)===null||i===void 0?void 0:i.refY)&&(L.refY+=this._spec.label.refY),isValidNumber((n=this._spec.label)===null||n===void 0?void 0:n.dx)&&(L.dx=(L.dx||0)+this._spec.label.dx),isValidNumber((o=this._spec.label)===null||o===void 0?void 0:o.dy)&&(L.dy=(L.dy||0)+this._spec.label.dy);const R=(u=(l=this._markerComponent)===null||l===void 0?void 0:l.attribute)!==null&&u!==void 0?u:{};(d=this._markerComponent)===null||d===void 0||d.setAttributes({points:b?[[P[0],P[1]],[P[1],P[2]],[P[2],P[3]]]:P,label:Object.assign(Object.assign(Object.assign({},C),L),{textStyle:Object.assign(Object.assign({},R.label.textStyle),{textAlign:"center",textBaseline:"middle"})}),limitRect:E,multiSegment:b,mainSegmentIndex:S,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}else(f=this._markerComponent)===null||f===void 0||f.setAttributes(g)}_computeOptions(){let e,i=this._getRelativeDataView(),n=!0,o=!1;const l=this._spec,u=this._relativeSeries,{doXProcess:d,doYProcess:f,doXYY1Process:g,doYXX1Process:_,doXYProcess:y,doCoordinatesProcess:b}=getMarkLineProcessInfo(l);if(y)e=[this._processSpecByDims([{dim:"x",specValue:l.x},{dim:"y",specValue:l.y}]),this._processSpecByDims([{dim:"x",specValue:l.x1},{dim:"y",specValue:l.y1}])];else if(d)e=[this._processSpecByDims([{dim:"x",specValue:l.x}])];else if(f)e=[this._processSpecByDims([{dim:"y",specValue:l.y}])];else if(g)e=[this._processSpecByDims([{dim:"x",specValue:l.x},{dim:"y",specValue:l.y}]),this._processSpecByDims([{dim:"x",specValue:l.x},{dim:"y",specValue:l.y1}])];else if(_)e=[this._processSpecByDims([{dim:"x",specValue:l.x},{dim:"y",specValue:l.y}]),this._processSpecByDims([{dim:"x",specValue:l.x1},{dim:"y",specValue:l.y}])];else if(b){if(e=this._processSpecCoo(l),n=!1,i=new DataView(this._option.dataSet,{name:`${this.type}_${this.id}_data`}).parse([u.getViewData()],{type:"dataview"}).transform({type:"markerAggregation",options:e}),l.process&&"x"in l.process&&(e=[this._processSpecByDims([{dim:"x",specValue:l.process.x}])],n=!0),l.process&&"y"in l.process&&(e=e=[this._processSpecByDims([{dim:"y",specValue:l.process.y}])],n=!0),l.process&&"xy"in l.process){const{xField:S,yField:v}=u.getSpec();e={fieldX:S,fieldY:v},o=!0}}else n=!1;return{options:e,needAggr:n,needRegr:o,processData:i}}}CartesianMarkLine.type=ComponentTypeEnum.markLine,CartesianMarkLine.coordinateType="cartesian";const registerMarkLine=()=>{Factory$1.registerComponent(CartesianMarkLine.type,CartesianMarkLine),registerMarkLineAnimate()};class PolarMarkLine extends BaseMarkLine{constructor(){super(...arguments),this.type=ComponentTypeEnum.polarMarkLine,this.name=ComponentTypeEnum.polarMarkLine,this.coordinateType="polar"}_newMarkLineComponent(e){const{doRadiusProcess:i,doRadAngAng1Process:n}=getMarkLineProcessInfo(this._spec);return i||n?new MarkArcLine(e):new MarkLine(e)}_computePointsAttr(){var e;const i=this._spec,n=this._markerData,o=this._startRelativeSeries,l=this._endRelativeSeries,u=this._relativeSeries,d=(e=i.autoRange)!==null&&e!==void 0&&e,{doAngleProcess:f,doRadiusProcess:g,doAngRadRad1Process:_,doRadAngAng1Process:y,doRadAngProcess:b,doCoordinatesProcess:S}=getMarkLineProcessInfo(i);let v=[],A={};const x={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};if(f||g||_||y||b){const T=polarLayout(n,o,l,u,d);v=T.length===1?T[0]:T.map(C=>C[0]),A=v[0].radius===v[1].radius?{radius:v[0].radius,startAngle:v[0].angle,endAngle:v[1].angle,center:x}:{points:v.map(C=>polarToCartesian(x,C.radius,C.angle))}}else S&&(v=polarCoordinateLayout(n,u,d),A={points:v.map(T=>polarToCartesian(x,T.radius,T.angle))});return A}_computeOptions(){const e=this._spec,{doAngleProcess:i,doRadiusProcess:n,doAngRadRad1Process:o,doRadAngAng1Process:l,doRadAngProcess:u,doCoordinatesProcess:d}=getMarkLineProcessInfo(e);let f;const g=this._getRelativeDataView();return u?f=[this._processSpecByDims([{dim:"angle",specValue:e.angle},{dim:"radius",specValue:e.radius}]),this._processSpecByDims([{dim:"angle",specValue:e.angle1},{dim:"radius",specValue:e.radius1}])]:i?f=[this._processSpecByDims([{dim:"angle",specValue:e.angle}])]:n?f=[this._processSpecByDims([{dim:"radius",specValue:e.radius}])]:o?f=[this._processSpecByDims([{dim:"angle",specValue:e.angle},{dim:"radius",specValue:e.radius}]),this._processSpecByDims([{dim:"angle",specValue:e.angle},{dim:"radius",specValue:e.radius1}])]:l?f=[this._processSpecByDims([{dim:"angle",specValue:e.angle},{dim:"radius",specValue:e.radius}]),this._processSpecByDims([{dim:"angle",specValue:e.angle1},{dim:"radius",specValue:e.radius}])]:d&&(f=this._processSpecCoo(e)),{options:f,needAggr:!0,needRegr:!1,processData:g}}}PolarMarkLine.type=ComponentTypeEnum.polarMarkLine,PolarMarkLine.coordinateType="polar";const registerPolarMarkLine=()=>{Factory$1.registerComponent(PolarMarkLine.type,PolarMarkLine),registerMarkArcLineAnimate(),registerMarkLineAnimate()};class Title extends BaseComponent{get orient(){return this._orient}constructor(e,i){super(e,i),this.type=ComponentTypeEnum.title,this.specKey=ComponentTypeEnum.title,this.layoutType="normal",this.layoutZIndex=LayoutZIndex.Title,this.layoutLevel=LayoutLevel.Title,this._orient="top",this._orient=isValidOrient(e.orient)?e.orient:"top"}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}static getSpecInfo(e){return getSpecInfo(e,this.specKey,ComponentTypeEnum.title,i=>i.visible!==!1)}onRender(e){}_compareSpec(e,i){const n=super._compareSpec(e,i);return(i==null?void 0:i.orient)===(e==null?void 0:e.orient)&&(i==null?void 0:i.visible)===e.visible||(n.reMake=!0),n.change=!0,n.reRender=!0,n}changeRegions(e){}update(e){}resize(e){}afterSetLayoutStartPoint(e){isValidNumber(e.x)&&this._titleComponent&&this._titleComponent.setAttribute("x",e.x),isValidNumber(e.y)&&this._titleComponent&&this._titleComponent.setAttribute("y",e.y),super.afterSetLayoutStartPoint(e)}getBoundsInRect(e){let i={};this.setLayoutRect(e);const n=this._getTitleAttrs();this._createOrUpdateTitleComponent(n),i=this._getTitleLayoutRect();const{x:o,y:l}=this.getLayoutStartPoint();return{x1:o,y1:l,x2:o+i.width,y2:l+i.height}}_getTitleLayoutRect(){const e=this._titleComponent.AABBBounds;return{width:this._spec.width?this._spec.width:isValidNumber(e.width())?e.width():0,height:this._spec.height?this._spec.height:isValidNumber(e.height())?e.height():0}}_getTitleAttrs(){var e,i,n,o,l,u,d,f;if(this._spec.visible===!1)return{visible:!1};const g=this.getLayoutRect(),_=calcLayoutNumber(this._spec.width,g.width,null,g.width),y=calcLayoutNumber(this._spec.maxWidth,g.width,null,g.width),b=Math.max(Math.min(_,y,g.width),0),S=Object.assign(Object.assign({},pickWithout(this._spec,["padding"])),{textType:(e=this._spec.textType)!==null&&e!==void 0?e:"text",text:(i=this._spec.text)!==null&&i!==void 0?i:"",subtextType:(n=this._spec.subtextType)!==null&&n!==void 0?n:"text",subtext:(o=this._spec.subtext)!==null&&o!==void 0?o:"",x:(l=this._spec.x)!==null&&l!==void 0?l:0,y:(u=this._spec.y)!==null&&u!==void 0?u:0,height:this._spec.height,minWidth:this._spec.minWidth,maxWidth:b,minHeight:this._spec.minHeight,maxHeight:this._spec.maxHeight,padding:this._spec.innerPadding,align:(d=this._spec.align)!==null&&d!==void 0?d:"left",verticalAlign:(f=this._spec.verticalAlign)!==null&&f!==void 0?f:"top",textStyle:Object.assign({width:b,maxLineWidth:b},this._spec.textStyle),subtextStyle:Object.assign({maxLineWidth:b},this._spec.subtextStyle)});return isValid(this._spec.width)&&(S.textStyle.width=Math.max(_,g.width),S.subtextStyle.width=S.textStyle.width),S}_createOrUpdateTitleComponent(e){if(this._titleComponent)isEqual(e,this._cacheAttrs)||this._titleComponent.setAttributes(e);else{const i=this.getContainer(),n=new Title$1(e);n.name="title",i.add(n),this._titleComponent=n,n.on("*",(o,l)=>this._delegateEvent(n,o,l))}return this._cacheAttrs=e,this._titleComponent}_getNeedClearVRenderComponents(){return[this._titleComponent]}clear(){super.clear(),this._cacheAttrs=null}}Title.type=ComponentTypeEnum.title,Title.specKey=ComponentTypeEnum.title;const registerTitle=()=>{Factory$1.registerComponent(Title.type,Title)};class BaseMarkArea extends BaseMarker{constructor(){super(...arguments),this.specKey="markArea",this.layoutZIndex=LayoutZIndex.MarkArea}static _getMarkerCoordinateType(e){const{doAngleProcess:i,doRadiusProcess:n,doRadAngProcess:o}=getMarkAreaProcessInfo(e);return e.coordinateType==="polar"||i||n||o?"polar":"cartesian"}_createMarkerComponent(){var e,i,n,o,l,u,d,f,g,_,y,b;const S=(e=this._spec.label)!==null&&e!==void 0?e:{},v={zIndex:this.layoutZIndex,interactive:(i=this._spec.interactive)===null||i===void 0||i,hover:(n=this._spec.interactive)===null||n===void 0||n,select:(o=this._spec.interactive)===null||o===void 0||o,points:[{x:0,y:0}],center:{x:0,y:0},innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,areaStyle:transformStyle(transformToGraphic((l=this._spec.area)===null||l===void 0?void 0:l.style),this._markerData,this._markAttributeContext),clipInRange:(u=this._spec.clip)!==null&&u!==void 0&&u,label:transformLabelAttributes(S,this._markerData,this._markAttributeContext),state:{area:transformState((d=this._spec.area)===null||d===void 0?void 0:d.state,this._markerData,this._markAttributeContext),label:transformState((f=this._spec.label)===null||f===void 0?void 0:f.state,this._markerData,this._markAttributeContext),labelBackground:transformState((y=(_=(g=this._spec)===null||g===void 0?void 0:g.label)===null||_===void 0?void 0:_.labelBackground)===null||y===void 0?void 0:y.state,this._markerData,this._markAttributeContext)},animation:(b=this._spec.animation)!==null&&b!==void 0&&b,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return this._newMarkAreaComponent(v)}_markerLayout(){var e,i,n,o;const l=this._spec,u=this._markerData,d=this._startRelativeSeries,f=this._endRelativeSeries,g=this._relativeSeries,_=this._computePointsAttr(),y=this._getRelativeDataView().latestData,b=u?u.latestData[0]&&u.latestData[0].latestData?u.latestData[0].latestData:u.latestData:y;let S;if(l.clip||!((e=l.label)===null||e===void 0)&&e.confine){const{minX:v,maxX:A,minY:x,maxY:T}=computeClipRange([d.getRegion(),f.getRegion(),g.getRegion()]);S={x:v,y:x,width:A-v,height:T-x}}this._markerComponent&&this._markerComponent.setAttributes(Object.assign(Object.assign({},_),{label:Object.assign(Object.assign({},(i=this._markerComponent.attribute)===null||i===void 0?void 0:i.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(b,y):(o=(n=this._markerComponent.attribute)===null||n===void 0?void 0:n.label)===null||o===void 0?void 0:o.text}),limitRect:S,dx:this._layoutOffsetX,dy:this._layoutOffsetY}))}_initDataView(){const e=this._spec,{doXProcess:i,doYProcess:n,doXYProcess:o,doAngleProcess:l,doRadiusProcess:u,doRadAngProcess:d,doCoordinatesProcess:f}=getMarkAreaProcessInfo(e);if(!(i||n||o||l||u||d||f))return null;this._initCommonDataView()}}BaseMarkArea.specKey="markArea";class CartesianMarkArea extends BaseMarkArea{constructor(){super(...arguments),this.type=ComponentTypeEnum.markArea,this.name=ComponentTypeEnum.markArea,this.coordinateType="cartesian"}_newMarkAreaComponent(e){return new MarkArea(e)}_computePointsAttr(){var e;const i=this._spec,n=this._markerData,o=this._startRelativeSeries,l=this._endRelativeSeries,u=this._relativeSeries,{doXProcess:d,doYProcess:f,doXYProcess:g,doCoordinatesProcess:_}=getMarkAreaProcessInfo(i),y=isValid(i.positions),b=(e=i.autoRange)!==null&&e!==void 0&&e;let S=[],v=[];if(g){v=xyLayout(n,o,l,u,b);const[A,x]=v;A&&A.length&&x&&x.length&&(S=[{x:A[0].x,y:x[0].y},A[0],{x:x[0].x,y:A[0].y},x[0]])}else if(d||f){v=xyLayout(n,o,l,u,b);const[A,x]=v;A&&A.length&&x&&x.length&&(S=[...A,x[1],x[0]])}else _?S=cartesianCoordinateLayout(n,u,b,i.coordinatesOffset):y&&(S=positionLayout(i.positions,u,i.regionRelative));return{points:S}}_computeOptions(){const e=this._spec,{doXProcess:i,doYProcess:n,doXYProcess:o,doCoordinatesProcess:l}=getMarkAreaProcessInfo(e);let u;return o?u=[this._processSpecByDims([{dim:"x",specValue:e.x},{dim:"y",specValue:e.y}]),this._processSpecByDims([{dim:"x",specValue:e.x1},{dim:"y",specValue:e.y1}])]:i?u=[this._processSpecByDims([{dim:"x",specValue:e.x}]),this._processSpecByDims([{dim:"x",specValue:e.x1}])]:n?u=[this._processSpecByDims([{dim:"y",specValue:e.y}]),this._processSpecByDims([{dim:"y",specValue:e.y1}])]:l&&(u=this._processSpecCoo(e)),{options:u}}}CartesianMarkArea.type=ComponentTypeEnum.markArea,CartesianMarkArea.coordinateType="cartesian";const registerMarkArea=()=>{Factory$1.registerComponent(CartesianMarkArea.type,CartesianMarkArea),registerMarkAreaAnimate()};class PolarMarkArea extends BaseMarkArea{constructor(){super(...arguments),this.type=ComponentTypeEnum.polarMarkArea,this.name=ComponentTypeEnum.polarMarkArea,this.coordinateType="polar"}_newMarkAreaComponent(e){const{doRadiusProcess:i,doAngleProcess:n,doRadAngProcess:o}=getMarkAreaProcessInfo(this._spec);return n||i||o?new MarkArcArea(e):new MarkArea(e)}_computePointsAttr(){var e;const i=this._spec,n=this._markerData,o=this._startRelativeSeries,l=this._endRelativeSeries,u=this._relativeSeries,{doAngleProcess:d,doRadiusProcess:f,doRadAngProcess:g,doCoordinatesProcess:_}=getMarkAreaProcessInfo(i),y=(e=i.autoRange)!==null&&e!==void 0&&e;let b,S={};const v={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};if(d||f||g){const A=polarLayout(n,o,l,u,y);g?S={innerRadius:A[0][0].radius,outerRadius:A[1][0].radius,startAngle:A[0][0].angle,endAngle:A[1][0].angle,center:v}:d?S={innerRadius:0,outerRadius:Math.abs(A[0][0].radius),startAngle:A[0][1].angle,endAngle:A[1][1].angle,center:v}:f&&(S={innerRadius:A[0][0].radius,outerRadius:A[1][0].radius,startAngle:A[0][0].angle,endAngle:A[1][1].angle,center:v})}else _&&(b=polarCoordinateLayout(n,u,y),S={points:b.map(A=>polarToCartesian(v,A.radius,A.angle))});return S}_computeOptions(){const e=this._spec,{doAngleProcess:i,doRadiusProcess:n,doRadAngProcess:o,doCoordinatesProcess:l}=getMarkAreaProcessInfo(e);let u;return o?u=[this._processSpecByDims([{dim:"angle",specValue:e.angle},{dim:"radius",specValue:e.radius}]),this._processSpecByDims([{dim:"angle",specValue:e.angle1},{dim:"radius",specValue:e.radius1}])]:i?u=[this._processSpecByDims([{dim:"angle",specValue:e.angle},{dim:"radius",specValue:e.radius}]),this._processSpecByDims([{dim:"angle",specValue:e.angle1},{dim:"radius",specValue:e.radius}])]:n?u=[this._processSpecByDims([{dim:"radius",specValue:e.radius}]),this._processSpecByDims([{dim:"radius",specValue:e.radius1}])]:l&&(u=this._processSpecCoo(e)),{options:u}}}PolarMarkArea.type=ComponentTypeEnum.polarMarkArea,PolarMarkArea.coordinateType="polar";const registerPolarMarkArea=()=>{Factory$1.registerComponent(PolarMarkArea.type,PolarMarkArea),registerMarkArcAreaAnimate(),registerMarkAreaAnimate()},rectToAttribute=r=>{const e=Object.assign({},r);return transformToGraphic(e)},symbolToAttribute=r=>{const e=Object.assign({},r);return transformToGraphic(e)},baseToAttribute=r=>Object.assign(Object.assign({},r),{style:Object.assign({},transformToGraphic(r.style))}),transformToAttrs=r=>{var e,i,n,o,l,u,d,f,g,_,y,b,S,v,A;const x=rectToAttribute((i=(e=r==null?void 0:r.slider)===null||e===void 0?void 0:e.trackStyle)!==null&&i!==void 0?i:{}),T=rectToAttribute((o=(n=r==null?void 0:r.slider)===null||n===void 0?void 0:n.railStyle)!==null&&o!==void 0?o:{}),C=symbolToAttribute((u=(l=r==null?void 0:r.slider)===null||l===void 0?void 0:l.handlerStyle)!==null&&u!==void 0?u:{}),E=baseToAttribute((f=(d=r==null?void 0:r.controller)===null||d===void 0?void 0:d.start)!==null&&f!==void 0?f:{}),P=baseToAttribute((_=(g=r==null?void 0:r.controller)===null||g===void 0?void 0:g.pause)!==null&&_!==void 0?_:{}),L=baseToAttribute((b=(y=r==null?void 0:r.controller)===null||y===void 0?void 0:y.backward)!==null&&b!==void 0?b:{}),R=baseToAttribute((v=(S=r==null?void 0:r.controller)===null||S===void 0?void 0:S.forward)!==null&&v!==void 0?v:{}),w=Object.assign(Object.assign({},r),{direction:r.direction,interval:r.interval,visible:r.visible,orient:(A=r.orient)!==null&&A!==void 0?A:"bottom",slider:Object.assign(Object.assign({},r.slider),{trackStyle:x,railStyle:T,handlerStyle:C}),controller:Object.assign(Object.assign({},r.controller),{start:E,pause:P,backward:L,forward:R})});return r.visible||(w.controller.visible=!1,w.slider.visible=!1),w},transformContinuousSpecToAttrs=(r,e)=>Object.assign(Object.assign({},transformToAttrs(r)),{data:e,type:"continuous"}),transformDiscreteSpecToAttrs=(r,e)=>Object.assign(Object.assign({},transformToAttrs(r)),{data:e,type:"discrete"}),isVertical=r=>r==="left"||r==="right",isHorizontal=r=>r==="top"||r==="bottom";class Player extends BaseComponent{constructor(){super(...arguments),this.layoutZIndex=LayoutZIndex.Player,this.layoutLevel=LayoutLevel.Player,this.specKey="player",this.type=ComponentTypeEnum.player,this._orient="bottom",this._getPlayerAttrs=()=>{var e,i,n,o,l,u;const d=this._spec.type,f={size:{width:this._width,height:this._height},dx:(e=this._spec.dx)!==null&&e!==void 0?e:0+this._dx,dy:(i=this._spec.dy)!==null&&i!==void 0?i:0+this._dy};return d==="discrete"?Object.assign(Object.assign(Object.assign({},transformDiscreteSpecToAttrs(this._spec,this._specs)),f),{disableTriggerEvent:this._option.disableTriggerEvent,loop:(o=(n=this._spec)===null||n===void 0?void 0:n.loop)===null||o===void 0||o}):Object.assign(Object.assign(Object.assign({},transformContinuousSpecToAttrs(this._spec,this._specs)),f),{disableTriggerEvent:this._option.disableTriggerEvent,loop:(u=(l=this._spec)===null||l===void 0?void 0:l.loop)===null||u===void 0||u})},this._createOrUpdatePlayerComponent=()=>{const e=Object.assign({},this._getPlayerAttrs()),i=this.getContainer();this._playerComponent?isEqual(e,this._cacheAttrs)||(this._cacheAttrs=e,this._playerComponent.setAttributes(e),this._playerComponent._initAttributes(),this._playerComponent.render()):(e.type==="discrete"?this._playerComponent=new DiscretePlayer(e):this._playerComponent=new ContinuousPlayer(e),this._cacheAttrs=e,this._playerComponent.name="player",i.add(this._playerComponent),this._initEvent())},this._maxSize=()=>{var e,i,n,o,l,u,d,f,g;return Math.max(...array((i=(e=this._spec.controller.start)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.size),...array((o=(n=this._spec.controller.pause)===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.size),...array((u=(l=this._spec.controller.backward)===null||l===void 0?void 0:l.style)===null||u===void 0?void 0:u.size),...array((f=(d=this._spec.controller.forward)===null||d===void 0?void 0:d.style)===null||f===void 0?void 0:f.size),(g=isVertical(this._orient)?this._spec.slider.railStyle.width:this._spec.slider.railStyle.height)!==null&&g!==void 0?g:10)},this._sliderExceededSize=()=>{var e,i,n,o,l,u,d,f,g;const _=(e=isVertical(this._orient)?this._spec.slider.railStyle.width:this._spec.slider.railStyle.height)!==null&&e!==void 0?e:10,y=Math.max(...array((n=(i=this._spec.controller.start)===null||i===void 0?void 0:i.style)===null||n===void 0?void 0:n.size),...array((l=(o=this._spec.controller.pause)===null||o===void 0?void 0:o.style)===null||l===void 0?void 0:l.size),...array((d=(u=this._spec.controller.backward)===null||u===void 0?void 0:u.style)===null||d===void 0?void 0:d.size),...array((g=(f=this._spec.controller.forward)===null||f===void 0?void 0:f.style)===null||g===void 0?void 0:g.size));return _>=y?_-y:0},this._initEvent=()=>{this._option.disableTriggerEvent||(this._option.globalInstance.on(ChartEvent.rendered,()=>{var e;!((e=this._spec)===null||e===void 0)&&e.auto&&this._playerComponent.play()}),this._playerComponent.addEventListener(PlayerEventEnum.end,()=>{var e;this.event.emit(ChartEvent.playerEnd,{model:this}),this._alternate&&this._spec.type==="discrete"&&(this._direction=this._direction==="default"?"reverse":"default",this._playerComponent.setAttributes({direction:this._direction,dataIndex:this._direction==="reverse"?this._specs.length-2:1})),!((e=this._spec)===null||e===void 0)&&e.loop&&this._playerComponent.play()}),this._playerComponent.addEventListener(PlayerEventEnum.change,e=>{const{index:i}=e.detail;this.changePlayerIndex(i)}),this._playerComponent.addEventListener(PlayerEventEnum.backward,e=>{const{index:i}=e.detail,n=this._specs[i];this.event.emit(ChartEvent.playerBackward,{model:this,value:{spec:n,index:i,specs:this._specs}})}),this._playerComponent.addEventListener(PlayerEventEnum.forward,e=>{const{index:i}=e.detail,n=this._specs[i];this.event.emit(ChartEvent.playerForward,{model:this,value:{spec:n,index:i,specs:this._specs}})}),this._playerComponent.addEventListener(PlayerEventEnum.play,e=>{const{index:i}=e.detail,n=this._specs[i];this.event.emit(ChartEvent.playerPlay,{model:this,value:{spec:n,index:i,specs:this._specs}})}),this._playerComponent.addEventListener(PlayerEventEnum.pause,e=>{const{index:i}=e.detail,n=this._specs[i];this.event.emit(ChartEvent.playerPause,{model:this,value:{spec:n,index:i,specs:this._specs}})}))}}get orient(){return this._orient}set layoutOrient(e){this._orient=e}setAttrFromSpec(){var e,i,n,o,l,u,d,f;super.setAttrFromSpec(),this._orient=(e=this._spec.orient)!==null&&e!==void 0?e:"bottom",this._specs=(i=this._spec.specs)!==null&&i!==void 0?i:[],this._direction=(n=this._spec.direction)!==null&&n!==void 0?n:"default",this._alternate=(o=this._spec.alternate)!==null&&o!==void 0&&o,this._dx=(l=this._spec.dx)!==null&&l!==void 0?l:0,this._dy=(u=this._spec.dy)!==null&&u!==void 0?u:0,this._position=(d=this._spec.position)!==null&&d!==void 0?d:"middle",this._visible=(f=this._spec.visible)===null||f===void 0||f}afterSetLayoutStartPoint(e){if(super.afterSetLayoutStartPoint(e),isValidNumber(e.x)){const i=isVertical(this._orient)?e.x+this._sliderExceededSize()/2:e.x;this._playerComponent&&this._playerComponent.setAttribute("x",i)}if(isValidNumber(e.y)){const i=isHorizontal(this._orient)?e.y+this._sliderExceededSize()/2:e.y;this._playerComponent&&this._playerComponent.setAttribute("y",i)}}getBoundsInRect(e,i){this._width=this._computeWidth(e),this._height=this._computeHeight(e),this._dx=this._computeDx(i),this._dy=this._computeDy(i);const n=this._computeLayoutRect(e,this._width,this._height);return this._createOrUpdatePlayerComponent(),n}changeRegions(e){}onRender(e){}_getNeedClearVRenderComponents(){return[this._playerComponent]}_computeLayoutRect(e,i,n){if(this._visible===!1)return{x1:0,x2:0,y1:0,y2:0};switch(this._orient){case"top":case"left":return{x1:0,y1:0,x2:i,y2:n};case"right":return{x1:e.width-i,y1:0,x2:e.width,y2:e.height};default:return{x1:0,y1:e.height-n,x2:e.width,y2:e.height}}}_computeWidth(e){return isNumber(this._spec.width)?Math.min(e.width,Number(this._spec.width)):isVertical(this._orient)?this._maxSize():e.width}_computeHeight(e){return isNumber(this._spec.height)?(this._height=this._spec.height,Math.min(e.height,Number(this._spec.height))):isHorizontal(this._orient)?this._maxSize():e.height}_computeDx(e){return isVertical(this._orient)||this._position==="start"?0:this._position==="middle"?(e.width-this._width)/2:e.width-this._width}_computeDy(e){return isHorizontal(this._orient)||this._position==="start"?0:this._position==="middle"?(e.height-this._height)/2:e.height-this._height}changePlayerIndex(e){const i=this._specs[e];array(i.data).forEach(n=>{var o,l;(l=(o=this._option)===null||o===void 0?void 0:o.globalInstance)===null||l===void 0||l.updateData(n.id,n.values)}),this.event.emit(ChartEvent.playerChange,{model:this,value:{spec:i,index:e,specs:this._specs}})}}Player.specKey="player",Player.type=ComponentTypeEnum.player;const registerPlayer=()=>{Factory$1.registerComponent(Player.type,Player)};class BaseLabelComponent extends BaseComponent{constructor(e,i){super(e,i),this.type=ComponentTypeEnum.label,this.name=ComponentTypeEnum.label,this.layoutType="none",this.layoutZIndex=LayoutZIndex.Label,this._regions=i.getRegionsInIndex(i.regionIndexes)}_interactiveConfig(e){const{interactive:i}=e,n={hover:!1,select:!1,state:e.state};if(i!==!0)return n;const{hover:o,select:l}=this._option.getChart().getSpec();return o===!1&&o.enable===!1||(n.hover=!0),l===!1&&l.enable===!1||(n.select=!0),n}_compareSpec(e,i){const n=super._compareSpec(e,i);return n.reRender=!0,isEqual(i,e)||(n.reMake=!0),n}onRender(e){}changeRegions(e){}_getNeedClearVRenderComponents(){return[]}}BaseLabelComponent.type=ComponentTypeEnum.label;class LabelMark extends TextMark{constructor(){super(...arguments),this.skipEncode=!1}getRule(){return this._rule}setRule(e){this._rule=e}getTarget(){return this._target}setTarget(e){this._target=e,this._rule||this.setRule(e.type)}getComponent(){return this._component}setComponent(e){this._component=e}}LabelMark.type="text",LabelMark.constructorType="label";const registerLabelMark=()=>{Factory$1.registerMark(LabelMark.constructorType,LabelMark),registerTextGraphic()};class LabelSpecTransformer extends BaseComponentSpecTransformer{_initTheme(e,i){return{spec:e,theme:this._theme}}}class Label extends BaseLabelComponent{constructor(e,i){super(e,i),this.type=ComponentTypeEnum.label,this.name=ComponentTypeEnum.label,this.specKey="label",this.transformerConstructor=LabelSpecTransformer,this.layoutZIndex=LayoutZIndex.Label,this._layoutRule=e.labelLayout||"series"}static getSpecInfo(e,i){const n=[];return((i==null?void 0:i.region)||[]).forEach((l,u)=>{(l.seriesIndexes||[]).some(d=>{const f=i.series[d],{markLabelSpec:g={}}=f;return Object.values(g).some(_=>Array.isArray(_)&&(y=>y.some(b=>b.visible))(_))})&&n.push({spec:e,type:ComponentTypeEnum.label,specInfoPath:["component",this.specKey,u],regionIndexes:[u]})}),n}init(e){super.init(e),this.initEvent(),this._initTextMark(),this._initLabelComponent(),this._initTextMarkStyle()}reInit(e){super.reInit(e),this._labelInfoMap&&this._labelInfoMap.clear(),this._initTextMark(),this._initTextMarkStyle()}initEvent(){this.event.on(ChartEvent.dataZoomChange,()=>{this._labelComponentMap.forEach((i,n)=>{const o=n.getProduct().getGroupGraphicItem();o&&o.disableAnimation()}),this.event.on(HOOK_EVENT.AFTER_MARK_RENDER_END,e)});const e=()=>{this._labelComponentMap.forEach((i,n)=>{const o=n.getProduct().getGroupGraphicItem();o&&o.enableAnimation()}),this.event.off(HOOK_EVENT.AFTER_MARK_RENDER_END,e)}}_initTextMark(){this._labelInfoMap||(this._labelInfoMap=new Map),this._labelComponentMap||(this._labelComponentMap=new Map),eachSeries(this._regions,e=>{const{markLabelSpec:i={}}=e.getSpecInfo(),n=Object.keys(i),o=e.getRegion();this._labelInfoMap.get(o)||this._labelInfoMap.set(o,[]);for(let l=0;l<n.length;l++){const u=n[l],d=e.getMarkInName(u);d&&i[u].forEach((f,g)=>{if(f.visible){const _=this._labelInfoMap.get(o),y=this._createMark({type:"label",name:`${u}-label-${g}`},{noSeparateStyle:!0,attributeContext:e.getMarkAttributeContext()});y.setTarget(d),_.push({labelMark:y,baseMark:d,series:e,labelSpec:f})}})}})}_initLabelComponent(){this._labelInfoMap.forEach((e,i)=>{if(this._layoutRule==="region"){const n=this._createMark({type:"component",name:`${i.getGroupMark().name}-label-component`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});n&&(n.setSkipBeforeLayouted(!0),e[0]&&isValid(e[0].labelSpec.zIndex)&&n.setMarkConfig({zIndex:e[0].labelSpec.zIndex}),this._marks.addMark(n),this._labelComponentMap.set(n,()=>this._labelInfoMap.get(i)))}else e.forEach((n,o)=>{const l=this._createMark({type:"component",name:`${n.labelMark.name}-component`},{componentType:"label",noSeparateStyle:!0},{support3d:n.baseMark.getMarkConfig().support3d});l&&(isValid(n.labelSpec.zIndex)&&l.setMarkConfig({zIndex:n.labelSpec.zIndex}),l.setSkipBeforeLayouted(!0),this._marks.addMark(l),this._labelComponentMap.set(l,()=>this._labelInfoMap.get(i)[o]))})})}_initTextMarkStyle(){this._labelComponentMap.forEach((e,i)=>{array(e()).forEach(({labelMark:n})=>{n.setComponent(i)})}),this._labelInfoMap.forEach(e=>{e.forEach(i=>{var n,o;const{labelMark:l,labelSpec:u,series:d}=i;if(this.initMarkStyleWithSpec(l,u,void 0),isFunction(u==null?void 0:u.getStyleHandler)){const f=u.getStyleHandler(d);f==null||f.call(d,l,u)}!((o=(n=l.stateStyle)===null||n===void 0?void 0:n.normal)===null||o===void 0)&&o.lineWidth&&l.setAttribute("stroke",d.getColorAttribute(),"normal",AttributeLevel.Base_Series)})})}updateLayoutAttribute(){super.updateLayoutAttribute(),this._labelComponentMap.forEach((e,i)=>{const n=e();isArray(n)?this._updateMultiLabelAttribute(n,i):this._updateSingleLabelAttribute(n,i)})}_updateMultiLabelAttribute(e,i){this._updateLabelComponentAttribute(i.getProduct(),e.map(({baseMark:n})=>n.getProduct()),e)}_updateSingleLabelAttribute(e,i){const{baseMark:n}=e;this._updateLabelComponentAttribute(i.getProduct(),n.getProduct(),[e])}_updateLabelComponentAttribute(e,i,n){const o=this._option.getComponentsByType("totalLabel");e.target(i).configure({interactive:!1}).depend(o.map(l=>l.getMarks()[0].getProduct())).labelStyle((l,u)=>{var d,f;const g=n[u.labelIndex];if(g){const{labelSpec:_,labelMark:y,series:b}=g,S=y.getRule(),v=this._interactiveConfig(_),A=(f=(d=this._spec)===null||d===void 0?void 0:d.centerOffset)!==null&&f!==void 0?f:0;let x=mergeSpec({textStyle:Object.assign({pickable:_.interactive===!0},_.style),overlap:{avoidMarks:o.map(T=>T.getMarks()[0].getProductId())}},defaultLabelConfig(S,g),Object.assign(Object.assign(Object.assign({},pickWithout(_,["position","style","state","type","stackDataFilterType","getStyleHandler"])),v),{centerOffset:A}),_.stackDataFilterType?{dataFilter:_.stackDataFilterType==="min"?T=>T.filter(C=>C.data[STACK_FIELD_TOTAL_BOTTOM]):T=>T.filter(C=>C.data[STACK_FIELD_TOTAL_TOP])}:{});return b&&b.parseLabelStyle&&(x=b.parseLabelStyle(x,_,y)),S!=="line"&&S!=="area"||(x.type=S),x}}).encode((l,u,d)=>{if(n[d.labelIndex]){const{labelSpec:f,labelMark:g}=n[d.labelIndex];return g.skipEncode?{data:l}:textAttribute(n[d.labelIndex],l,f.formatMethod,f.formatter)}}).size(()=>n[0].series.getRegion().getLayoutRect())}compileMarks(){this.getMarks().forEach(e=>{const i=this._labelComponentMap.get(e)();let n;n=isArray(i)?i[0].series.getRegion().getGroupMark().getProduct():i.series.getRegion().getGroupMark().getProduct(),e.compile({group:n,context:{model:this,labelInfo:i}})})}getVRenderComponents(){const e=[];return this._labelComponentMap.forEach((i,n)=>{const o=n.getProduct().getGroupGraphicItem();o&&e.push(o)}),e}}Label.type=ComponentTypeEnum.label,Label.specKey="label",Label.transformerConstructor=LabelSpecTransformer;const registerLabel=()=>{registerLabel$1(),registerLabelMark(),registerComponentMark(),Factory$1.registerComponent(Label.type,Label,!0)};class TotalLabel extends BaseLabelComponent{constructor(){super(...arguments),this.type=ComponentTypeEnum.totalLabel,this.name=ComponentTypeEnum.totalLabel,this.specKey="totalLabel",this.layoutZIndex=LayoutZIndex.Label}static getSpecInfo(e,i){var n;const o=[];return(n=i==null?void 0:i.region)===null||n===void 0||n.forEach((l,u)=>{var d;(d=l.seriesIndexes)===null||d===void 0||d.forEach(f=>{const{spec:g}=i.series[f],_=g[this.specKey];_!=null&&_.visible&&o.push({spec:_,type:ComponentTypeEnum.totalLabel,specPath:["series",f,this.specKey],specInfoPath:["component",this.specKey,f],regionIndexes:[u],seriesIndexes:[f]})})}),o}init(e){super.init(e),this._initTextMark(),this._initLabelComponent()}reInit(e){super.reInit(e),this._initTextMark()}_initTextMark(){var e;const i=this._getSeries();if(!((e=i.getSpec().totalLabel)===null||e===void 0)&&e.visible){const n=i.getSeriesMark();if(n){const o=this._createMark({type:"label",name:`${n.name}-total-label`});this._baseMark=n,this._textMark=o,this._initTextMarkStyle()}}}_initTextMarkStyle(){var e;super.initMarkStyleWithSpec(this._textMark,this._spec),this.setMarkStyle(this._textMark,{text:n=>n[STACK_FIELD_TOTAL]},"normal",AttributeLevel.Default);const i=this._getSeries();(e=i.initTotalLabelMarkStyle)===null||e===void 0||e.call(i,this._textMark)}_initLabelComponent(){const e=this._getSeries(),i=this._createMark({type:"component",name:`${e.name}-total-label-component`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});i&&this._marks.addMark(i)}updateLayoutAttribute(){super.updateLayoutAttribute();const e=this._getSeries();this._marks.forEach((i,n)=>{i.getProduct().target(this._baseMark.getProduct()).configure({interactive:!1}).labelStyle(()=>{var o,l;if(this._baseMark){const{offset:u,animation:d,overlap:f}=this._spec,g=this._interactiveConfig(this._spec);return mergeSpec({textStyle:{pickable:this._spec.interactive===!0},position:totalLabelPosition(e,this._baseMark.type),x:0,y:0},(l=(o=e.getTotalLabelComponentStyle)===null||o===void 0?void 0:o.call(e,{baseMark:this._baseMark,labelMark:this._textMark}))!==null&&l!==void 0?l:{},Object.assign({offset:u,animation:d,overlap:f,dataFilter:_=>_.filter(y=>y.data[STACK_FIELD_TOTAL_TOP])},g))}}).encode(o=>textAttribute({baseMark:this._baseMark,labelMark:this._textMark,series:e,labelSpec:e.getSpec().totalLabel},o,this._spec.formatMethod)).size(()=>this._regions[0].getLayoutRect())})}compileMarks(){this.getMarks().forEach(e=>{const i=this._regions[0].getGroupMark().getProduct();e.compile({group:i,context:{model:this}})})}getVRenderComponents(){const e=[];return this.getMarks().forEach(i=>{const n=i.getProduct().getGroupGraphicItem();n&&e.push(n)}),e}_getSeries(){return this._option.getSeriesInIndex([this.getSpecPath()[1]])[0]}}TotalLabel.type=ComponentTypeEnum.totalLabel,TotalLabel.specKey="totalLabel";function totalLabelPosition(r,e){var i,n;let o;const{direction:l}=r,u={vertical:["top","bottom"],horizontal:["right","left"]},d=(l==="horizontal"?!((i=r.getXAxisHelper())===null||i===void 0)&&i.isInverse():!((n=r.getYAxisHelper())===null||n===void 0)&&n.isInverse())?1:0;switch(e){case"rect":case"symbol":o=u[l][d];break;default:o="top"}return o}const registerTotalLabel=()=>{registerLabel$1(),registerLabelMark(),registerComponentMark(),Factory$1.registerComponent(TotalLabel.type,TotalLabel,!0)};var __rest=function(r,e){var i={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(i[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(i[n[o]]=r[n[o]])}return i};class BaseMarkPoint extends BaseMarker{constructor(){super(...arguments),this.specKey="markPoint",this.layoutZIndex=LayoutZIndex.MarkPoint}static _getMarkerCoordinateType(e){const{doPolarProcess:i,doGeoProcess:n}=getMarkPointProcessInfo(e);return e.coordinateType==="polar"||i?"polar":e.coordinateType==="geo"||n?"geo":"cartesian"}_createMarkerComponent(){var e,i,n,o,l,u,d,f,g,_,y,b,S,v,A,x,T,C,E,P,L,R,w,D,I,O,B,N;const{itemContent:$={},itemLine:H={},targetSymbol:F={}}=this._spec,{text:V={},symbol:G,image:Y,richText:J}=$,q=__rest($,["text","symbol","image","richText"]),te={zIndex:this.layoutZIndex,interactive:(e=this._spec.interactive)===null||e===void 0||e,hover:(i=this._spec.interactive)===null||i===void 0||i,select:(n=this._spec.interactive)===null||n===void 0||n,position:{x:0,y:0},clipInRange:(o=this._spec.clip)!==null&&o!==void 0&&o,itemContent:Object.assign({offsetX:transformOffset($.offsetX,this._relativeSeries.getRegion()),offsetY:transformOffset($.offsetX,this._relativeSeries.getRegion())},q),targetSymbol:{offset:(l=F.offset)!==null&&l!==void 0?l:0,visible:(u=F.visible)!==null&&u!==void 0&&u,size:(d=F.size)!==null&&d!==void 0?d:20,style:transformStyle(F.style,this._markerData,this._markAttributeContext)},state:{line:transformState((g=(f=this._spec.itemLine.line)===null||f===void 0?void 0:f.state)!==null&&g!==void 0?g:{},this._markerData,this._markAttributeContext),lineStartSymbol:transformState((y=(_=this._spec.itemLine.startSymbol)===null||_===void 0?void 0:_.state)!==null&&y!==void 0?y:{},this._markerData,this._markAttributeContext),lineEndSymbol:transformState((S=(b=this._spec.itemLine.endSymbol)===null||b===void 0?void 0:b.state)!==null&&S!==void 0?S:{},this._markerData,this._markAttributeContext),symbol:transformState((A=(v=this._spec.itemContent.symbol)===null||v===void 0?void 0:v.state)!==null&&A!==void 0?A:{},this._markerData,this._markAttributeContext),image:transformState((T=(x=this._spec.itemContent.image)===null||x===void 0?void 0:x.state)!==null&&T!==void 0?T:{},this._markerData,this._markAttributeContext),text:transformState((E=(C=this._spec.itemContent.text)===null||C===void 0?void 0:C.state)!==null&&E!==void 0?E:{},this._markerData,this._markAttributeContext),textBackground:transformState((L=(P=this._spec.itemContent.text)===null||P===void 0?void 0:P.labelBackground)===null||L===void 0?void 0:L.state,this._markerData,this._markAttributeContext),richText:transformState((w=(R=this._spec.itemContent.richText)===null||R===void 0?void 0:R.state)!==null&&w!==void 0?w:{},this._markerData,this._markAttributeContext),customMark:transformState((I=(D=this._spec.itemContent.customMark)===null||D===void 0?void 0:D.state)!==null&&I!==void 0?I:{},this._markerData,this._markAttributeContext),targetItem:transformState((B=(O=this._spec.targetSymbol)===null||O===void 0?void 0:O.state)!==null&&B!==void 0?B:{},this._markerData,this._markAttributeContext)},animation:(N=this._spec.animation)!==null&&N!==void 0&&N,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};G!=null&&G.style&&(te.itemContent.symbolStyle=transformToGraphic(transformStyle(G.style,this._markerData,this._markAttributeContext))),Y!=null&&Y.style&&(te.itemContent.imageStyle=transformStyle(Y.style,this._markerData,this._markAttributeContext)),V&&(te.itemContent.textStyle=transformLabelAttributes(V,this._markerData,this._markAttributeContext)),J!=null&&J.style&&(te.itemContent.richTextStyle=transformStyle(J.style,this._markerData,this._markAttributeContext));const{visible:de,line:he={}}=H,fe=__rest(H,["visible","line"]);return te.itemLine=de!==!1?Object.assign(Object.assign({},fe),{visible:!0,lineStyle:transformToGraphic(he.style)}):{visible:!1},new MarkPoint(te)}_markerLayout(){var e,i,n,o,l;const u=this._spec,d=this._markerData,f=this._relativeSeries,{point:g}=this._computePointsAttr(),_=this._getRelativeDataView().latestData,y=d?d.latestData[0]&&d.latestData[0].latestData?d.latestData[0].latestData:d.latestData:_;let b;if(u.clip||!((e=u.itemContent)===null||e===void 0)&&e.confine){const{minX:S,maxX:v,minY:A,maxY:x}=computeClipRange([f.getRegion()]);b={x:S,y:A,width:v-S,height:x-A}}if(this._markerComponent){const S=(i=this._markerComponent.attribute)!==null&&i!==void 0?i:{},v=(o=(n=S.itemContent)===null||n===void 0?void 0:n.textStyle)!==null&&o!==void 0?o:{};this._markerComponent.setAttributes({position:g===void 0?{x:null,y:null}:g,itemContent:Object.assign(Object.assign({},S.itemContent),{textStyle:Object.assign(Object.assign({},v),{text:!((l=this._spec.itemContent.text)===null||l===void 0)&&l.formatMethod?this._spec.itemContent.text.formatMethod(y,_):v.text}),offsetX:computeOffsetFromRegion(g,S.itemContent.offsetX,this._relativeSeries.getRegion()),offsetY:computeOffsetFromRegion(g,S.itemContent.offsetY,this._relativeSeries.getRegion())}),limitRect:b,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}}_initDataView(){const e=this._spec,{doXYProcess:i,doPolarProcess:n,doGeoProcess:o}=getMarkPointProcessInfo(e);(isValid(e.coordinate)||i||n||o)&&this._initCommonDataView()}}BaseMarkPoint.specKey="markPoint";class CartesianMarkPoint extends BaseMarkPoint{constructor(){super(...arguments),this.type=ComponentTypeEnum.markPoint,this.name=ComponentTypeEnum.markPoint,this.coordinateType="cartesian"}_computePointsAttr(){var e;const i=this._spec,n=this._markerData,o=this._relativeSeries,l="x"in i&&"y"in i,u="coordinate"in i,d="position"in i,f=(e=i==null?void 0:i.autoRange)!==null&&e!==void 0&&e;let g;return l?g=xyLayout(n,o,o,o,f)[0][0]:u?g=cartesianCoordinateLayout(n,o,f,i.coordinatesOffset)[0]:d&&(g=positionLayout(i.position,o,i.regionRelative)[0]),{point:g}}_computeOptions(){const e=this._spec,{doXYProcess:i}=getMarkPointProcessInfo(e),n=isValid(e.coordinate);let o;return i?o=[this._processSpecByDims([{dim:"x",specValue:e.x},{dim:"y",specValue:e.y}])]:n&&(o=this._processSpecCoo(e)),{options:o}}}CartesianMarkPoint.type=ComponentTypeEnum.markPoint,CartesianMarkPoint.coordinateType="cartesian";const registerMarkPoint=()=>{Factory$1.registerComponent(CartesianMarkPoint.type,CartesianMarkPoint),registerMarkPointAnimate()};class PolarMarkPoint extends BaseMarkPoint{constructor(){super(...arguments),this.type=ComponentTypeEnum.polarMarkPoint,this.name=ComponentTypeEnum.polarMarkPoint,this.coordinateType="polar"}_computePointsAttr(){var e,i;const n=this._markerData,o=this._relativeSeries,l=(i=(e=this._spec)===null||e===void 0?void 0:e.autoRange)!==null&&i!==void 0&&i,u=polarLayout(n,o,o,o,l)[0][0],d={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};return{point:polarToCartesian(d,u.radius,u.angle)}}_computeOptions(){const e=this._spec;return{options:[this._processSpecByDims([{dim:"radius",specValue:e.radius},{dim:"angle",specValue:e.angle}])]}}}PolarMarkPoint.type=ComponentTypeEnum.polarMarkPoint,PolarMarkPoint.coordinateType="polar";const registerPolarMarkPoint=()=>{Factory$1.registerComponent(PolarMarkPoint.type,PolarMarkPoint),registerMarkPointAnimate()};class GeoMarkPoint extends BaseMarkPoint{constructor(){super(...arguments),this.type=ComponentTypeEnum.geoMarkPoint,this.name=ComponentTypeEnum.geoMarkPoint,this.coordinateType="geo"}_computePointsAttr(){const e=this._markerData,i=this._relativeSeries;return{point:geoLayout(e,i)[0][0]}}_computeOptions(){const e=this._spec;return{options:[this._processSpecByDims([{dim:"areaName",specValue:e.areaName}])]}}}GeoMarkPoint.type=ComponentTypeEnum.geoMarkPoint,GeoMarkPoint.coordinateType="geo";const registerGeoMarkPoint=()=>{Factory$1.registerComponent(GeoMarkPoint.type,GeoMarkPoint),registerMarkPointAnimate()};class Brush extends BaseComponent{constructor(){super(...arguments),this.layoutType="none",this.type=ComponentTypeEnum.brush,this.name=ComponentTypeEnum.brush,this.specKey="brush",this.layoutZIndex=LayoutZIndex.Brush,this._linkedSeries=[],this._itemMap={},this._linkedItemMap={},this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._needInitOutState=!0,this._cacheInteractiveRangeAttrs=[],this._needDisablePickable=!1,this._releatedAxes=[],this._regionAxisMap={},this._axisDataZoomMap={},this._zoomRecord=[]}init(){const e=this._transformBrushedMarkAttr(this._spec.inBrush),i=this._transformBrushedMarkAttr(this._spec.outOfBrush);this._option.getAllSeries().forEach(n=>{n.getActiveMarks().forEach(o=>{o&&(n.setMarkStyle(o,Object.assign({},e),"inBrush",AttributeLevel.Series),n.setMarkStyle(o,Object.assign({},i),"outOfBrush",AttributeLevel.Series))})})}static getSpecInfo(e){return getSpecInfo(e,this.specKey,this.type,i=>i.visible!==!1)}created(){super.created(),this.initEvent(),this._bindRegions(),this._bindLinkedSeries(),this._initRegionAxisMap(),this._initAxisDataZoomMap(),this._initNeedOperatedItem()}_extendDataInBrush(e){var i,n;const o=[];for(const l in e)for(const u in e[l])o.push(Object.assign({},(n=(i=e[l][u])===null||i===void 0?void 0:i.data)===null||n===void 0?void 0:n[0]));return o}_extendDatumOutOfBrush(e){var i;const n=[];for(const o in e)n.push((i=e[o].data)===null||i===void 0?void 0:i[0]);return n}_getBrushInteractiveAttr(e){const i=e.getLayoutStartPoint(),n=e.getLayoutRect(),o=i.x,l=o+n.width,u=i.y,d=u+n.height;return{interactiveRange:{minY:u,maxY:d,minX:o,maxX:l},xRange:[o,l],yRange:[u,d]}}_updateBrushComponent(e,i){const n=this._getBrushInteractiveAttr(e),o=this._brushComponents[i];o.setAttributes(n),this._initMarkBrushState(i,""),o.children[0].removeAllChild(),this._needInitOutState=!0}_createBrushComponent(e,i){var n,o;const l=this._getBrushInteractiveAttr(e),u=new Brush$1(Object.assign(Object.assign(Object.assign({zIndex:this.layoutZIndex,brushStyle:transformToGraphic((n=this._spec)===null||n===void 0?void 0:n.style)},l),this._spec),{disableTriggerEvent:this._option.disableTriggerEvent}));u.id=(o=this._spec.id)!==null&&o!==void 0?o:`brush-${this.id}`,this.getContainer().add(u);const{brushMode:d="single"}=this._spec;this._brushComponents.push(u),this._cacheInteractiveRangeAttrs.push(l),u.addEventListener(IOperateType.drawStart,f=>{this._emitEvent(ChartEvent.brushStart,e)}),u.addEventListener(IOperateType.moveStart,f=>{this._emitEvent(ChartEvent.brushStart,e)}),u.addEventListener(IOperateType.drawing,f=>{this._needInitOutState&&d==="single"&&this._initMarkBrushState(i,"outOfBrush"),this._needInitOutState=!1,this._needDisablePickable=!0,this._handleBrushChange(ChartEvent.brushChange,e,f),this._emitEvent(ChartEvent.brushChange,e)}),u.addEventListener(IOperateType.moving,f=>{this._handleBrushChange(ChartEvent.brushChange,e,f),this._emitEvent(ChartEvent.brushChange,e)}),u.addEventListener(IOperateType.brushClear,f=>{this._initMarkBrushState(i,""),this._needInitOutState=!0,this._needDisablePickable=!1,this._handleBrushChange(ChartEvent.brushChange,e,f),this._handleBrushChange(ChartEvent.brushClear,e,f),this._emitEvent(ChartEvent.brushChange,e),this._emitEvent(ChartEvent.brushClear,e)}),u.addEventListener(IOperateType.drawEnd,f=>{this._needInitOutState=!0,this._needDisablePickable=!1;const{operateMask:g}=f.detail;this._handleBrushChange(ChartEvent.brushEnd,e,f);const _=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&_.length>0&&this._setAxisAndDataZoom(g,e),this._emitEvent(ChartEvent.brushEnd,e)}),u.addEventListener(IOperateType.moveEnd,f=>{const{operateMask:g}=f.detail;this._handleBrushChange(ChartEvent.brushEnd,e,f);const _=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&_.length>0&&this._setAxisAndDataZoom(g,e),this._emitEvent(ChartEvent.brushEnd,e)})}_handleBrushChange(e,i,n){const{operateMask:o}=n.detail;this._reconfigItem(o,i),this._reconfigLinkedItem(o,i)}_emitEvent(e,i){this.event.emit(e,{model:this,value:{operateType:e,operateRegion:i,inBrushData:this._extendDataInBrush(this._inBrushElementsMap),outOfBrushData:this._extendDatumOutOfBrush(this._outOfBrushElementsMap),linkInBrushData:this._extendDataInBrush(this._linkedInBrushElementsMap),linkOutOfBrushData:this._extendDatumOutOfBrush(this._linkedOutOfBrushElementsMap),inBrushElementsMap:this._inBrushElementsMap,outOfBrushElementsMap:this._outOfBrushElementsMap,linkedInBrushElementsMap:this._linkedInBrushElementsMap,linkedOutOfBrushElementsMap:this._linkedOutOfBrushElementsMap,zoomRecord:this._zoomRecord}})}_transformBrushedMarkAttr(e){const i={};return e!=null&&e.symbol&&(i.symbolType=e.symbol),e!=null&&e.symbolSize&&(i.size=e.symbolSize),e!=null&&e.color&&(i.fill=e.color),e!=null&&e.colorAlpha&&(i.fillOpacity=e.colorAlpha),Object.assign(Object.assign({},transformToGraphic(e)),i)}_reconfigItem(e,i){this._itemMap[i.id].forEach(n=>{const o=n.getProduct();!o||!o.elements||!o.elements.length||o.elements.forEach(l=>{var u,d,f;const g=l.getGraphicItem(),_=n.id+"_"+l.key;!((u=this._outOfBrushElementsMap)===null||u===void 0)&&u[_]&&this._isBrushContainItem(e,g)?(l.addState("inBrush"),this._inBrushElementsMap[e==null?void 0:e.name]||(this._inBrushElementsMap[e==null?void 0:e.name]={}),this._inBrushElementsMap[e==null?void 0:e.name][_]=l,delete this._outOfBrushElementsMap[_]):!((f=(d=this._inBrushElementsMap)===null||d===void 0?void 0:d[e==null?void 0:e.name])===null||f===void 0)&&f[_]&&!this._isBrushContainItem(e,g)&&(l.removeState("inBrush"),l.addState("outOfBrush"),this._outOfBrushElementsMap[_]=l,delete this._inBrushElementsMap[e.name][_]),g.setAttribute("pickable",!this._needDisablePickable)})})}_reconfigLinkedItem(e,i){const n=i.getLayoutStartPoint(),o=i.getSeries().map(l=>l.id);this._linkedSeries.forEach(l=>{if(!o.includes(l.id)){const u=l.getRegion().getLayoutStartPoint(),d=u.x-n.x,f=u.y-n.y;this._linkedItemMap[l.id].forEach(g=>{const _=g.getProduct();!_||!_.elements||!_.elements.length||_.elements.forEach(y=>{var b,S,v;const A=y.getGraphicItem(),x=g.id+"_"+y.key;!((b=this._linkedOutOfBrushElementsMap)===null||b===void 0)&&b[x]&&this._isBrushContainItem(e,A,{dx:d,dy:f})?(y.addState("inBrush"),this._linkedInBrushElementsMap[e==null?void 0:e.name]||(this._linkedInBrushElementsMap[e==null?void 0:e.name]={}),this._linkedInBrushElementsMap[e==null?void 0:e.name][x]=y,delete this._linkedOutOfBrushElementsMap[x]):!((v=(S=this._linkedInBrushElementsMap)===null||S===void 0?void 0:S[e==null?void 0:e.name])===null||v===void 0)&&v[x]&&!this._isBrushContainItem(e,A,{dx:d,dy:f})&&(y.removeState("inBrush"),y.addState("outOfBrush"),this._linkedOutOfBrushElementsMap[x]=y),A.setAttribute("pickable",!this._needDisablePickable)})})}})}_isBrushContainItem(e,i,n){var o,l,u;if(!(e!=null&&e.globalTransMatrix)||!(!((o=e==null?void 0:e.attribute)===null||o===void 0)&&o.points))return!1;const d=(u=(l=e==null?void 0:e.attribute)===null||l===void 0?void 0:l.points)!==null&&u!==void 0?u:[],{a:f,b:g,c:_,d:y,e:b,f:S}=e.globalTransMatrix,v=(n==null?void 0:n.dx)||0,A=(n==null?void 0:n.dy)||0,x=d.map(P=>({x:f*P.x+_*P.y+b+v,y:g*P.x+y*P.y+S+A}));e.globalAABBBounds.clone().set(e.globalAABBBounds.x1+v,e.globalAABBBounds.y1+A,e.globalAABBBounds.x2+v,e.globalAABBBounds.y2+A);const T=i.globalTransMatrix.e,C=i.globalTransMatrix.f;let E=[];if(i.type==="symbol"){const{size:P=0}=i==null?void 0:i.attribute,L=array(P)[0]/2;return E=[{x:T-L,y:C-L},{x:T+L,y:C-L},{x:T+L,y:C+L},{x:T-L,y:C+L}],polygonIntersectPolygon(x,E)}if(i.type==="rect"){const{x1:P,x2:L,y1:R,y2:w}=i==null?void 0:i.AABBBounds,D=Math.abs(P-L),I=Math.abs(R-w);return E=[{x:T,y:C},{x:T+D,y:C},{x:T+D,y:C+I},{x:T,y:C+I}],polygonIntersectPolygon(x,E)}return e.globalAABBBounds.intersects(i.globalAABBBounds)}_stateClamp(e){return Math.min(Math.max(0,e),1)}_setAxisAndDataZoom(e,i){var n;if(this._zoomRecord=[],this._spec.zoomAfterBrush){const o=e.AABBBounds;(n=this._regionAxisMap["region_"+i.id])===null||n===void 0||n.forEach(l=>{var u,d;const f=l.layoutOrient==="bottom"||l.layoutOrient==="top",g=(u=this._spec.axisRangeExpand)!==null&&u!==void 0?u:0,{x1:_,x2:y,y1:b,y2:S}=o,v=f?"x":"y",A=f?_:b,x=f?y:S;if(this._axisDataZoomMap[l.id]){const T=this._axisDataZoomMap[l.id],C=T.relatedAxisComponent,E=C.getScale().invert(A-i.getLayoutStartPoint()[v]),P=C.getScale().invert(x-i.getLayoutStartPoint()[v]),L=T.dataToStatePoint(E),R=T.dataToStatePoint(P),w=this._stateClamp(L-g),D=this._stateClamp(R+g);T.setStartAndEnd(Math.min(w,D),Math.max(w,D),["percent","percent"]),this._zoomRecord.push({operateComponent:T,start:w,end:D})}else{const T=l.getScale().range(),C=(d=l.getScale().rangeFactor())!==null&&d!==void 0?d:[0,1],E=last(T)<T[0],P=A-i.getLayoutStartPoint()[v],L=x-i.getLayoutStartPoint()[v],R=E?Math.min(P,L):Math.max(P,L),w=((E?Math.max(P,L):Math.min(P,L))-T[0])/(last(T)-T[0])*(C[1]-C[0])+C[0],D=(R-T[0])/(last(T)-T[0])*(C[1]-C[0])+C[0],I=this._stateClamp(w-g),O=this._stateClamp(D+g);l.getScale().rangeFactor([I,O]),l.effect.scaleUpdate(),this._zoomRecord.push({operateComponent:l,start:I,end:O})}})}}_bindRegions(){isValid(this._spec.regionId)&&isValid(this._spec.regionIndex)&&(this._relativeRegions=this._option.getAllRegions()),this._relativeRegions=this._option.getRegionsInUserIdOrIndex(array(this._spec.regionId),array(this._spec.regionIndex))}_bindLinkedSeries(){isValid(this._spec.brushLinkSeriesId)&&isValid(this._spec.brushLinkSeriesIndex)||(this._linkedSeries=this._option.getSeriesInUserIdOrIndex(array(this._spec.brushLinkSeriesId),array(this._spec.brushLinkSeriesIndex)))}_initRegionAxisMap(){isValid(this._spec.axisId)?array(this._spec.axisId).forEach(e=>{this._releatedAxes.push(this._option.getComponentByUserId(e))}):isValid(this._spec.axisIndex)?array(this._spec.axisIndex).forEach(e=>{this._releatedAxes.push(this._option.getComponentByIndex("axes",e))}):this._releatedAxes=this._option.getComponentsByKey("axes"),this._releatedAxes.forEach(e=>{e==null||e.getRegions().forEach(i=>{this._regionAxisMap["region_"+i.id]?this._regionAxisMap["region_"+i.id].push(e):this._regionAxisMap["region_"+i.id]=[e]})})}_initAxisDataZoomMap(){this._option.getComponentsByKey("dataZoom").forEach(e=>{e.relatedAxisComponent&&(this._axisDataZoomMap[e.relatedAxisComponent.id]=e)})}_initNeedOperatedItem(){const e=this._spec.seriesId,i=this._spec.seriesIndex;this._relativeRegions.forEach(n=>{const o=[];n.getSeries().forEach(l=>{(e&&array(e).includes(l.userId.toString())||i&&array(i).includes(l.getSpecIndex())||!i&&!e)&&o.push(...l.getMarksWithoutRoot()),this._itemMap[n.id]=o})}),this._linkedSeries.forEach(n=>{this._linkedItemMap[n.id]=n.getMarksWithoutRoot()})}_initMarkBrushState(e,i){this._brushComponents.forEach((n,o)=>{o!==e&&n.children[0].removeAllChild()}),this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._option.getAllSeries().forEach(n=>{n.getMarksWithoutRoot().forEach(o=>{const l=o.getProduct();!l||!l.elements||!l.elements.length||l.elements.forEach(u=>{const d=o.id+"_"+u.key;u.removeState("inBrush"),u.removeState("outOfBrush"),u.addState(i),this._outOfBrushElementsMap[d]=u,this._linkedOutOfBrushElementsMap[d]=u})})})}initEvent(){}onRender(e){}changeRegions(e){}_getNeedClearVRenderComponents(){return this._brushComponents}_compareSpec(e,i){this._brushComponents&&this._relativeRegions.forEach((o,l)=>{this._updateBrushComponent(o,l)});const n=super._compareSpec(e,i);return isEqual(i,e)||(n.reRender=!0,n.reMake=!0),n}onLayoutEnd(e){var i;super.onLayoutEnd(e),!this._option.disableTriggerEvent&&((i=this._spec.visible)===null||i===void 0||i)&&(this._brushComponents?this._relativeRegions.forEach((n,o)=>{this._updateBrushComponent(n,o)}):(this._brushComponents=[],this._relativeRegions.forEach((n,o)=>{this._createBrushComponent(n,o)})))}clearGraphic(){this._brushComponents&&this._brushComponents.forEach(e=>{e._container.incrementalClearChild()})}clear(){if(this._brushComponents){const e=this.getContainer();this._brushComponents.forEach(i=>{i.removeAllChild(),i.releaseBrushEvents(),e&&e.removeChild(i)}),this._brushComponents=null}}}Brush.type=ComponentTypeEnum.brush,Brush.specKey="brush";const registerBrush=()=>{Factory$1.registerComponent(Brush.type,Brush)};class CustomMark extends BaseComponent{constructor(){super(...arguments),this.type=ComponentTypeEnum.customMark,this.specKey="customMark",this.layoutType="none",this.layoutZIndex=LayoutZIndex.CustomMark,this.layoutLevel=LayoutLevel.CustomMark}created(){super.created(),this.initMarks(),this.initEvent()}getMarkAttributeContext(){return this._markAttributeContext}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(e,i)=>{var n;return(n=this._option.globalScale.getScale(e))===null||n===void 0?void 0:n.scale(i)}}}initMarks(){if(!this._spec)return;const e=this._option&&this._option.getAllSeries(),i=this._option.animation!==!1,n=[];e&&e.length&&e.forEach(l=>{const u=l&&l.getMarksWithoutRoot();u&&u.length&&u.forEach(d=>{n.push(d)})});let o=null;if(this._spec.parent){const l=this.getChart().getAllMarks().find(u=>u.getUserId()===this._spec.parent);l.type==="group"&&(o=l)}this._createExtensionMark(this._spec,o,`${PREFIX}_series_${this.id}_extensionMark`,0,{depend:n,hasAnimation:i})}_createExtensionMark(e,i,n,o=0,l){var u;const d=this._createMark({type:e.type,name:isValid(e.name)?`${e.name}`:`${n}_${o}`},{skipBeforeLayouted:!0,attributeContext:this._getMarkAttributeContext(),componentType:e.componentType,key:e.dataKey});if(d){if(isValid(e.id)&&d.setUserId(e.id),l.hasAnimation&&e.animation){const f=animationConfig({},userAnimationConfig(e.type,e,this._markAttributeContext));d.setAnimationConfig(f)}if(l.depend&&l.depend.length&&d.setDepend(...l.depend),isNil(i)?this._marks.addMark(d):i&&i.addMark(d),this.initMarkStyleWithSpec(d,e),e.type==="group"&&(n=`${n}_${o}`,(u=e.children)===null||u===void 0||u.forEach((f,g)=>{this._createExtensionMark(f,d,n,g,l)})),isValid(e.dataId)||isValidNumber(e.dataIndex)){const f=this.getChart().getSeriesData(e.dataId,e.dataIndex);f&&(f.target.addListener("change",()=>{d.getData().updateData()}),d.setDataView(f))}}}initEvent(){}_compareSpec(e,i){const n=super._compareSpec(e,i);return isEqual(i,e)||(n.reMake=!0),n.change=!0,n.reRender=!0,n}changeRegions(e){}_getNeedClearVRenderComponents(){return[]}onRender(e){}_getMarkAttributeContext(){return{vchart:this._option.globalInstance,chart:this.getChart(),globalScale:(e,i)=>{var n;return(n=this._option.globalScale.getScale(e))===null||n===void 0?void 0:n.scale(i)},getLayoutBounds:()=>{const{x:e,y:i}=this.getLayoutStartPoint(),{width:n,height:o}=this.getLayoutRect();return new Bounds().set(e,i,e+n,i+o)}}}_getLayoutRect(){const e=new Bounds;return this.getMarks().forEach(i=>{const n=i.getProduct();n&&e.union(n.getBounds())}),e.empty()?{width:0,height:0}:{width:e.width(),height:e.height()}}getBoundsInRect(e){this.setLayoutRect(e);const i=this._getLayoutRect(),{x:n,y:o}=this.getLayoutStartPoint();return{x1:n,y1:o,x2:n+i.width,y2:o+i.height}}}CustomMark.type=ComponentTypeEnum.customMark,CustomMark.specKey="customMark";const registerCustomMark=()=>{Factory$1.registerComponent(CustomMark.type,CustomMark)};function overlap(r,e,i=0){return i>Math.max(e.x1-r.x2,r.x1-e.x2,e.y1-r.y2,r.y1-e.y2)}function bound(r){return{x1:r.x,x2:r.x+r.width,y1:r.y,y2:r.y+r.height}}function toRect(r){return{x:r.x1,y:r.y1,width:r.x2-r.x1,height:r.y2-r.y1}}function layoutByPosition(r){var e;if(!r||r.length===0)return[];if(r.length===1)return[r[0].rect];const i=r.map(o=>{var l;return Object.assign(Object.assign({},o),{bound:bound(o.rect),anchorCandidates:candidatesByOrient((l=o.anchors)!==null&&l!==void 0?l:[],o.point,o.rect,o.offset)})}),n=[];n.push(i[0].bound);for(let o=1;o<=i.length-1;o++){const l=i[o],u=l.bound;let d=n.some(f=>overlap(f,u));if(l.anchorCandidates)if(d&&((e=l.anchorCandidates)===null||e===void 0?void 0:e.length)>0){for(let f=0;f<l.anchorCandidates.length;f++){const g=l.anchorCandidates[f],_={x1:g.x,y1:g.y,x2:g.x+u.x2-u.x1,y2:g.y+u.y2-u.y1,anchor:g};if(!n.some(y=>overlap(y,_))){n.push(_),d=!1;break}}d&&n.push(l.bound)}else n.push(l.bound)}return n.map(o=>toRect(o))}function layoutOuter(r,e,i){const n=r.map(g=>g.pointCoord),{x1:o,x2:l,y1:u,y2:d}=getAABBFromPoints(n),f=i([(o+l)/2,(u+d)/2]);return f?layoutByPosition(r.map(g=>{const _=g.rect,y=isPointWithinFeatures(e,g.pointCoord)?i(nearestPoint(e,[g.pointCoord.x,g.pointCoord.y],uniformDegree(lineDegree(g.point,f)))):g.point;y&&(_.x=y.x,_.y=y.y);const b=uniformDegree(lineDegree(g.point,f));let S;const v=[];return b>=-45&&b<45?(S="top",v.push("left","right")):b>=45&&b<135?S="right":b>=-135&&b<-45?(S="left",v.push("left")):(S="bottom",v.push("left","right")),g.anchors=v,g.offset=20,g.rect=placeRectByOrient(g.rect,S,0),g})):[]}function uniformDegree(r){return r>180?r-360:r}function lineDegree(r,e){return 180*Math.atan2(r.y-e.y,r.x-e.x)/Math.PI+90}function nearestPoint(r,e,i,n=200){const o=5621/n;let l=e;for(let u=1;u<=o;u++){const d=destination(l,n,i);if(!isPointWithinFeatures(r,d))return[d.x,d.y];l=[d.x,d.y]}return e}function isPointWithinFeatures(r,e){for(let i=0;i<r.length;i++)if(isPointInPolygon(e,r[i]))return!0;return!1}function placeRectByOrient(r,e,i=0){const n=Object.assign({},r);return e==="top"?(n.x-=r.width/2,n.y-=i+r.height/2):e==="bottom"?(n.x-=r.width/2,n.y+=i-r.height/2):e==="left"?(n.x-=i+r.width,n.y-=r.height/2):e==="right"&&(n.x+=i,n.y-=r.height/2),n}function candidatesByOrient(r,e,i,n=0){const o=[];return r.forEach(l=>{const{x:u,y:d}=placeRectByOrient(Object.assign(Object.assign({},e),{width:i.width,height:i.height}),l,n);o.push({x:u,y:d})}),o}class MapLabelComponent extends BaseComponent{constructor(){super(...arguments),this.type=ComponentTypeEnum.mapLabel,this.name=ComponentTypeEnum.mapLabel,this.specKey="mapLabel",this.layoutType="none",this.layoutZIndex=LayoutZIndex.MarkPoint,this._activeDatum=[]}static getSpecInfo(e){return getSpecInfo(e,this.specKey,this.type,i=>i.visible&&isValid(i.seriesId))}setAttrFromSpec(){var e,i,n,o;this.nameField=(e=this._spec.nameField)!==null&&e!==void 0?e:(i=this._series)===null||i===void 0?void 0:i.getDimensionField()[0],this.valueField=(n=this._spec.valueField)!==null&&n!==void 0?n:(o=this._series)===null||o===void 0?void 0:o.getMeasureField()[0]}created(){super.created(),this._spec.visible&&(this.initRelatedInfo(),this.initData(),this.initEvent())}initRelatedInfo(){var e,i,n,o,l,u,d,f;this._series=this._option.getSeriesInUserIdOrIndex([this._spec.seriesId])[0],this._spec.position==="outer"&&(this._map=(i=(e=this._regions[0].getSeriesInType("map")[0])===null||e===void 0?void 0:e.getMapViewData())===null||i===void 0?void 0:i.latestData,this._longitudeField=(l=(o=(n=this._regions[0]).getSpec)===null||o===void 0?void 0:o.call(n))===null||l===void 0?void 0:l.longitudeField,this._latitudeField=(f=(d=(u=this._regions[0]).getSpec)===null||d===void 0?void 0:d.call(u))===null||f===void 0?void 0:f.latitudeField)}initData(){const e=this._series;if(!e)return;const i=e.getViewData();if(i){const n=new DataView(this._option.dataSet,{name:`${this.name}_data`});n.parse([i],{type:"dataview"}),n.transform({type:"copyDataView",level:TransformLevel.copyDataView},!1),this._data=new CompilableData(this._option,n),n.target.addListener("change",()=>{this._spec.trigger!=="hover"&&this._spec.trigger!=="click"&&(this._activeDatum=this._data.getLatestData())})}}initEvent(){var e;this.event.on("zoom",{filter:o=>this._isRelativeModel(o.model)},o=>(this.handleZoom(o),!0)),this.event.on("panmove",{filter:o=>this._isRelativeModel(o.model)},o=>(this.handlePan(o),!0));const i=this._spec.trigger;if(i==="none")return;const n=(e=this.getCompiler())===null||e===void 0?void 0:e.getVGrammarView();n&&(i==="hover"?(n.addEventListener("element-highlight:start",o=>{this._isRelativeSeries(o.options.seriesId)&&this._updateDatum(o.elements[0].getDatum())}),n.addEventListener("element-highlight:reset",o=>{this._isRelativeSeries(o.options.seriesId)&&this._updateDatum(null)})):i==="click"&&(n.addEventListener("element-select:start",o=>{this._isRelativeSeries(o.options.seriesId)&&this._updateDatum(o.elements[0].getDatum())}),n.addEventListener("elementSelectReset",o=>{this._isRelativeSeries(o.options.seriesId)&&this._updateDatum([])})))}handlePan(e){const{delta:i}=e;this._markerComponents.forEach(n=>{n.translate(i[0],i[1])})}handleZoom(e){this._updateMarkerLayoutAttribute()}_updateDatum(e){this._activeDatum=e,this._markerComponents.forEach((i,n)=>{var o;const l=(o=this._data)===null||o===void 0?void 0:o.getLatestData()[n];this._activeDatum.includes(l)?i.setAttribute("visible",!0):i.setAttribute("visible",!1)})}dataToPosition(e){return this._series.dataToPosition(e)}updateLayoutAttribute(){var e;const i=(e=this._data)===null||e===void 0?void 0:e.getLatestData();i&&i.length!==0&&(super.updateLayoutAttribute(),this._updateMarkerLayoutAttribute())}_updateMarkerLayoutAttribute(){var e;const i=[],n=[];this._markerComponents||(this._markerComponents=(e=this._data)===null||e===void 0?void 0:e.getLatestData().map((l,u)=>{var d;const f=new MarkPoint({position:void 0,animation:!1});return f&&(f.name=`${this.name}_marker_${u}`,f.id=(d=this._spec.id)!==null&&d!==void 0?d:`${this.name}_marker_${this.id}`,f.setAttribute("zIndex",this.layoutZIndex)),f})),this._markerComponents.forEach((l,u)=>{l.removeAllChild();const{pairInfo:d,contentMarks:f}=this._evaluateMarker(this._data.getLatestData()[u],u);d&&i.push(d),f&&n.push(f)});const o=this._layoutLabels(i);this._layoutMarkers(o,n),this._renderMarkers()}_evaluateMarker(e,i){var n,o,l,u,d,f,g,_,y,b,S,v;let A=0,x=0,T=0,C=0,E=0;const P=this._spec.position||"top",L=this._spec.offset,R=normalizeLayoutPaddingSpec((n=this._spec.background)===null||n===void 0?void 0:n.padding),w=this._spec.space||0;x+=((R==null?void 0:R.left)||0)+((R==null?void 0:R.right)||0),T+=((R==null?void 0:R.top)||0)+((R==null?void 0:R.bottom)||0);const D={},I=this.dataToPosition(e),O=createGroup({});if(O.name=`${this.name}_marker_itemContainer_${i}`,D.container=O,(o=this._spec.background)===null||o===void 0?void 0:o.visible){const F=createRect(transformToGraphic(Object.assign({},this._spec.background.style)));F.setAttributes(I),D.labelBackground=F,O.appendChild(F)}if(!((l=this._spec.icon)===null||l===void 0)&&l.visible){const F=createSymbol(transformToGraphic(Object.assign({},this._spec.icon.style)));F.setAttributes(I),F.setAttribute("symbolType",(u=this._spec.icon.style)===null||u===void 0?void 0:u.shape);const V=F.AABBBounds,G=(d=(V==null?void 0:V.y2)-(V==null?void 0:V.y1))!==null&&d!==void 0?d:0,Y=(f=(V==null?void 0:V.x2)-(V==null?void 0:V.x1))!==null&&f!==void 0?f:0;D.icon=F,O.appendChild(F),E=G,C+=Y,A++}if(!((g=this._spec.nameLabel)===null||g===void 0)&&g.visible){const F=createText(transformToGraphic(Object.assign({},this._spec.nameLabel.style)));F.setAttributes(I),F.setAttribute("text",e[this.nameField]);const V=F.AABBBounds,G=(_=(V==null?void 0:V.y2)-(V==null?void 0:V.y1))!==null&&_!==void 0?_:0,Y=(y=(V==null?void 0:V.x2)-(V==null?void 0:V.x1))!==null&&y!==void 0?y:0;D.nameLabel=F,O.appendChild(F),E=Math.max(E,G),C+=Y,A++}if(!((b=this._spec.valueLabel)===null||b===void 0)&&b.visible&&isValid(e[this.valueField])){const F=createText(transformToGraphic(Object.assign({},this._spec.valueLabel.style)));F.setAttributes(I),F.setAttribute("text",e[this.valueField]);const V=F.AABBBounds,G=(S=(V==null?void 0:V.y2)-(V==null?void 0:V.y1))!==null&&S!==void 0?S:0,Y=(v=(V==null?void 0:V.x2)-(V==null?void 0:V.x1))!==null&&v!==void 0?v:0;D.valueLabel=F,O.appendChild(F),E=Math.max(E,G),C+=Y,A++}const B=Object.values(D).find(F=>!!F&&F.type!=="group"),N={x:B==null?void 0:B.getComputedAttribute("x"),y:B==null?void 0:B.getComputedAttribute("y")},$={x:N.x,y:N.y,width:0,height:0};$.width=x+C+(A-1)*w,$.height=T+E;const H={rect:$,point:N,index:i};if(P!=="outer"){const F=["top","right","left","bottom"].filter(V=>V!==P);H.rect=placeRectByOrient($,P,L),H.anchors=F,H.offset=L}else H.pointCoord={x:+(e==null?void 0:e[this._longitudeField]),y:+(e==null?void 0:e[this._latitudeField])};return{pairInfo:H,contentMarks:D}}_layoutMarkers(e,i){var n,o,l;for(let u=0;u<i.length;u++){if(!e[u]||!i[u])return;const{icon:d,nameLabel:f,valueLabel:g,labelBackground:_,container:y}=i[u],b=e[u],S=normalizeLayoutPaddingSpec((n=this._spec.background)===null||n===void 0?void 0:n.padding),v=this._spec.space||0,A=b.height/2;let x=(S==null?void 0:S.left)||0;[d,f,g].forEach((L,R)=>{var w,D;if(L){const I=L.AABBBounds;let O=0;L.type==="symbol"&&(O+=((w=I.x2-I.x1)!==null&&w!==void 0?w:0)/2),L.setAttributes({x:x+O,y:A}),x+=(D=I.x2-I.x1)!==null&&D!==void 0?D:0,R!==2&&(x+=v)}}),_==null||_.setAttributes({x:0,y:0,width:b.width,height:b.height}),y==null||y.setAttributes({dx:-b.width/2,dy:-b.height/2});const T=this._data.getLatestData()[u],C=this.dataToPosition(T),E=this.getRegions()[0].getLayoutStartPoint(),P=!(!(!((o=this._spec.leader)===null||o===void 0)&&o.visible)||!(d||f||g));this._markerComponents[u].setAttributes({x:E.x,y:E.y,position:C,visible:this._activeDatum.includes(T),itemContent:{refX:0,type:"custom",renderCustomCallback:()=>y,autoRotate:!1,offsetX:b.x+b.width/2-C.x,offsetY:b.y+b.height/2-C.y},itemLine:{visible:P,type:"type-po",lineStyle:transformToGraphic(Object.assign({},(l=this._spec.leader)===null||l===void 0?void 0:l.style)),startSymbol:{visible:!1}}})}}_renderMarkers(){if(this._markerComponents&&this._markerComponents.length)for(let e=0;e<this._markerComponents.length;e++)this.getContainer().add(this._markerComponents[e])}_layoutLabels(e){return this._spec.position==="outer"&&this._map?layoutOuter(e,this._map,i=>this._series.dataToPosition({[this._longitudeField]:i[0],[this._latitudeField]:i[1]})):layoutByPosition(e)}_isRelativeModel(e){var i,n,o;const l=(n=(i=this._series.getXAxisHelper())===null||i===void 0?void 0:i.getAxisId())!==null&&n!==void 0?n:(o=this._series.getCoordinateHelper())===null||o===void 0?void 0:o.getCoordinateId();return(e==null?void 0:e.id)===l}_isRelativeSeries(e){return(e==null?void 0:e.id)===this._series.id}onRender(e){}changeRegions(){}_getNeedClearVRenderComponents(){return this._markerComponents}}MapLabelComponent.type=ComponentTypeEnum.mapLabel,MapLabelComponent.specKey="mapLabel";const registerMapLabel=()=>{Factory$1.registerComponent(MapLabelComponent.type,MapLabelComponent)};class GridLayout{constructor(e,i){this._chartLayoutRect={x:0,y:0,width:1,height:1},this._col=1,this._row=1,this._elementMap=new Map,this.standardizationSpec(e),this._gridInfo=e,this._col=e.col,this._row=e.row,this._colSize=new Array(this._col).fill(null),this._rowSize=new Array(this._row).fill(null),this._colElements=new Array(this._col).fill([]),this._rowElements=new Array(this._row).fill([]),this._onError=i==null?void 0:i.onError,this.initUserSetting()}standardizationSpec(e){var i,n,o;e.col=(i=e.col)!==null&&i!==void 0?i:1,e.row=(n=e.row)!==null&&n!==void 0?n:1,e.elements=(o=e.elements)!==null&&o!==void 0?o:[]}initUserSetting(){this._gridInfo.colWidth&&this.setSizeFromUserSetting(this._gridInfo.colWidth,this._colSize,this._col,this._chartLayoutRect.width),this._gridInfo.rowHeight&&this.setSizeFromUserSetting(this._gridInfo.rowHeight,this._rowSize,this._row,this._chartLayoutRect.height),this._colSize.forEach((e,i)=>{e||(this._colSize[i]={value:0,isUserSetting:!1,isLayoutSetting:!1})}),this._rowSize.forEach((e,i)=>{e||(this._rowSize[i]={value:0,isUserSetting:!1,isLayoutSetting:!1})})}setSizeFromUserSetting(e,i,n,o){e.forEach(l=>{l.index<0&&l.index>=n||(isValidNumber(l.size)?i[l.index]={value:+l.size,isUserSetting:!0,isLayoutSetting:!1}:isFunction(l.size)&&(i[l.index]={value:l.size(o),isUserSetting:!0,isLayoutSetting:!1}))})}clearLayoutSize(){this._colSize.forEach(e=>{e.isLayoutSetting=!1,e.isUserSetting||(e.value=0)}),this._rowSize.forEach(e=>{e.isLayoutSetting=!1,e.isUserSetting||(e.value=0)})}getItemGridInfo(e){var i;const n=this._elementMap.get(e);if(n)return n;let o;return o=(i=this._gridInfo.elements)===null||i===void 0?void 0:i.find(l=>{var u;if("modelId"in l&&isValid(l.modelId)){if(isValid(e.model.userId)&&e.model.userId===l.modelId)return!0}else if("modelKey"in l&&isValid(l.modelKey)&&"modelIndex"in l&&isValid(l.modelIndex)&&((u=e.model.specKey)!==null&&u!==void 0?u:e.model.type)===l.modelKey&&e.model.getSpecIndex()===l.modelIndex)return!0;return!1}),o||(o={col:0,colSpan:1,row:0,rowSpan:1}),this._elementMap.set(e,o),o}getSizeFromGrid(e,i){var n;const o=i==="col"?this._colSize:this._rowSize;let l=0;for(let u=e[i];u<e[i]+((n=e[`${i}Span`])!==null&&n!==void 0?n:1);u++)l+=o[u].value;return l}getSizeFromUser(e,i){var n,o;const l=i==="col"?this._colSize:this._rowSize;if(!(!((n=l[e[i]])===null||n===void 0)&&n.isUserSetting))return;let u=0;for(let d=e[i];d<e[i]+((o=e[`${i}Span`])!==null&&o!==void 0?o:1);d++){if(!l[d].isUserSetting)return;u+=l[d].value}return u}setItemLayoutSizeToGrid(e,i){if(isColItem(e)){if(i.colSpan&&i.colSpan>1||this._colSize[i.col].isUserSetting)return;this._colSize[i.col].value=Math.max(this._colSize[i.col].value,e.getLayoutRect().width+e.layoutPaddingLeft+e.layoutPaddingRight),this._colSize[i.col].isLayoutSetting=!0}else{if(i.rowSpan&&i.rowSpan>1||this._rowSize[i.row].isUserSetting)return;this._rowSize[i.row].value=Math.max(this._rowSize[i.row].value,e.getLayoutRect().height+e.layoutPaddingTop+e.layoutPaddingBottom),this._rowSize[i.row].isLayoutSetting=!0}}layoutGrid(e){const i=e==="col"?this._colSize:this._rowSize;let n=e==="col"?this._chartLayoutRect.width:this._chartLayoutRect.height;const o=[];i.forEach(l=>{l.isUserSetting||l.isLayoutSetting?n-=l.value:o.push(l)}),n<0&&console.warn(`layout content ${e} size bigger than chart`),o.forEach(l=>l.value=n/o.length)}getItemPosition(e){const i=this.getItemGridInfo(e),n={x:this._chartLayoutRect.x,y:this._chartLayoutRect.y};for(let o=0;o<i.col;o++)n.x+=this._colSize[o].value;for(let o=0;o<i.row;o++)n.y+=this._rowSize[o].value;return n.x+=e.layoutPaddingLeft+e.layoutOffsetX,n.y+=e.layoutPaddingTop+e.layoutOffsetY,n}getItemLayoutRect(e){var i,n;const o=this.getItemGridInfo(e);return{width:((i=this.getSizeFromGrid(o,"col"))!==null&&i!==void 0?i:this._chartLayoutRect.width)-e.layoutPaddingLeft-e.layoutPaddingRight,height:((n=this.getSizeFromGrid(o,"row"))!==null&&n!==void 0?n:this._chartLayoutRect.height)-e.layoutPaddingTop-e.layoutPaddingBottom}}layoutItems(e,i,n,o){this._chartLayoutRect=n,this._chartViewBox=o,this.clearLayoutSize(),i.sort((y,b)=>b.layoutLevel-y.layoutLevel);const l=i.filter(y=>y.layoutType==="normal"&&y.getModelVisible()!==!1),u=l.filter(y=>isColItem(y)),d=l.filter(y=>!isColItem(y));l.forEach(y=>{this.layoutOneItem(y,"user",!1)});const f=i.filter(y=>y.layoutType==="region-relative"),g=f.filter(y=>isColItem(y)),_=f.filter(y=>!isColItem(y));g.forEach(y=>this.layoutOneItem(y,"user",!1)),this.layoutGrid("col"),d.forEach(y=>this.layoutOneItem(y,"colGrid",!1)),_.forEach(y=>{this.layoutOneItem(y,"colGrid",!1)}),this.layoutGrid("row"),_.forEach(y=>{this.layoutOneItem(y,"grid",!1)}),u.forEach(y=>this.layoutOneItem(y,"grid",!1)),g.forEach(y=>{this.layoutOneItem(y,"grid",!0)}),this.layoutGrid("col"),i.filter(y=>y.layoutType==="region").forEach(y=>this.layoutOneItem(y,"grid",!1)),this.layoutAbsoluteItems(i.filter(y=>y.layoutType==="absolute")),i.filter(y=>y.layoutType!=="absolute").forEach(y=>{y.setLayoutStartPosition(this.getItemPosition(y))})}layoutAbsoluteItems(e){e.forEach(i=>{i.absoluteLayoutInRect(this._chartLayoutRect)})}layoutOneItem(e,i,n){var o,l;const u=i==="rowGrid"||i==="grid"?this.getSizeFromGrid.bind(this):this.getSizeFromUser.bind(this),d=i==="colGrid"||i==="grid"?this.getSizeFromGrid.bind(this):this.getSizeFromUser.bind(this),f=this.getItemGridInfo(e),g={width:((o=d(f,"col"))!==null&&o!==void 0?o:this._chartLayoutRect.width)-e.layoutPaddingLeft-e.layoutPaddingRight,height:((l=u(f,"row"))!==null&&l!==void 0?l:this._chartLayoutRect.height)-e.layoutPaddingTop-e.layoutPaddingBottom},_=e.computeBoundsInRect(g);isValidNumber(_.width)||(_.width=g.width),isValidNumber(_.height)||(_.height=g.height),e.setLayoutRect(i!=="grid"?_:g),this.setItemLayoutSizeToGrid(e,f)}}function isColItem(r){return r.layoutOrient==="left"||r.layoutOrient==="right"}GridLayout.type="grid";const registerGridLayout=()=>{Factory$1.registerLayout(GridLayout.type,GridLayout)};class Layout3d extends Layout$1{layoutItems(e,i,n,o){this._layoutInit(e,i,n,o),this._layoutNormalItems(i);const l={left:this.leftCurrent,top:this.topCurrent,right:this.rightCurrent,bottom:this.bottomCurrent},u=i.filter(T=>T.layoutType==="absolute"),d=u.filter(T=>T.layoutOrient==="z");let f={width:0,height:0};d.length&&(f=d[0].getLayoutRect()),this.leftCurrent+=f.width/8,this.rightCurrent-=f.width/8,this.topCurrent+=f.height/8,this.bottomCurrent-=f.height/8;const{regionItems:g,relativeItems:_,relativeOverlapItems:y,allRelatives:b,overlapItems:S}=this._groupItems(i);this.layoutRegionItems(g,_,y,S),this._processAutoIndent(g,_,y,S,b,l);const v=u.filter(T=>T.layoutOrient!=="z");this.layoutAbsoluteItems(v);const A=_.filter(T=>T.model.specKey==="axes"&&isXAxis(T.layoutOrient))[0],x=_.filter(T=>T.model.specKey==="axes"&&isYAxis(T.layoutOrient))[0];if(A&&d.length){const T=A.getLayoutStartPoint(),C=A.getLayoutRect(),E={x:x.layoutOrient==="left"?T.x+C.width:T.x,y:T.y,width:this._chartLayoutRect.width,height:this._chartLayoutRect.height};d[0].model.directionStr=x.layoutOrient==="left"?"r2l":"l2r";const P=A.getLayoutRect(),L=x.getLayoutRect(),R={length:d[0].getLayoutRect().width,width:P.width,height:L.height};A.model.setLayout3dBox&&A.model.setLayout3dBox(R),x.model.setLayout3dBox&&x.model.setLayout3dBox(R),d[0].model.setLayout3dBox&&d[0].model.setLayout3dBox(R),this.layoutZAxisItems(d,E)}}layoutZAxisItems(e,i){e.forEach(n=>{n.absoluteLayoutInRect(i)})}getItemComputeLayoutRect(e,i){return i||(i={offsetLeft:0,offsetRight:0,offsetTop:0,offsetBottom:0}),{width:this.rightCurrent-this.leftCurrent-e.layoutPaddingLeft-e.layoutPaddingRight-(i.offsetLeft+i.offsetRight),height:this.bottomCurrent-this.topCurrent-e.layoutPaddingTop-e.layoutPaddingBottom-(i.offsetTop+i.offsetBottom)}}_checkAutoIndent(e){const i={top:0,left:0,bottom:0,right:0},n=this._chartViewBox.x2-this._chartViewBox.x1-this.rightCurrent,o=this._chartViewBox.y2-this._chartViewBox.y1-this.bottomCurrent;return e.forEach(l=>{if(!l.getModelVisible()||!l.autoIndent)return;const u=l.layoutOrient==="left"||l.layoutOrient==="right",d=l.getLastComputeOutBounds();u?(i.top=Math.max(i.top,d.y1-this.topCurrent),i.bottom=Math.max(i.bottom,d.y2-o)):(i.left=Math.max(i.left,d.x1-this.leftCurrent),i.right=Math.max(i.right,d.x2-n))}),i}}Layout3d.type="layout3d";const registerLayout3d=()=>{Factory$1.registerLayout(Layout3d.type,Layout3d)},registerPoptip=()=>{loadPoptip()},TOOLTIP_PREFIX="vchart-tooltip",TOOLTIP_CONTAINER_EL_CLASS_NAME=`${TOOLTIP_PREFIX}-container`,TOOLTIP_TITLE_CLASS_NAME=`${TOOLTIP_PREFIX}-title`,TOOLTIP_CONTENT_BOX_CLASS_NAME=`${TOOLTIP_PREFIX}-content-box`,TOOLTIP_EMPTY_STRING="",DEFAULT_OPTIONS={offsetX:10,offsetY:10},DEFAULT_TOOLTIP_Z_INDEX="99999999999999";function escapeHTML(r){return String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\(/g,"&#40;").replace(/  /g," &nbsp;")}const getScale=(r,e)=>r?(e||(e=r.getBoundingClientRect()),r.offsetWidth>0?e.width/r.offsetWidth:r.offsetHeight>0?e.height/r.offsetHeight:1):1,formatContent=r=>isString(r)&&(r==null?void 0:r.trim())!==""||isNumber(r)?escapeHTML(r):TOOLTIP_EMPTY_STRING,getActualTooltipPositionValue=(r,e)=>{let i;if(isValid(r)){if(isNumber(r))i=r;else if(isFunction(r)){const n=r(e);isNumber(n)&&(i=n)}}return i},positionType={left:[-2,0],right:[2,0],top:[0,-2],lt:[-2,-2],tl:[-2,-2],rt:[2,-2],tr:[2,-2],bottom:[0,2],bl:[-2,2],lb:[-2,2],br:[2,2],rb:[2,2],inside:[0,0],center:[0,0],centerBottom:[0,1],centerTop:[0,-1],centerLeft:[-1,0],centerRight:[1,0]},getPositionType=(r,e,i=2)=>{var n,o;return(o=(n=positionType[r])===null||n===void 0?void 0:n[e==="x"?0:1])!==null&&o!==void 0?o:i},getCartesianCrosshairRect=(r,e)=>{var i;const n=new Map,o=new Map,{series:l,datum:u}=r,d=l.direction==="horizontal",f=(d?l.getYAxisHelper():l.getXAxisHelper()).getAxisId(),g=l.getChart().getComponentsByKey("axes").find(C=>C.id===f);if(!g)return;(d?o:n).set(g.getSpecIndex(),{value:(i=l.getDatumPositionValues(u[0],l.getDimensionField()))===null||i===void 0?void 0:i[0],axis:g});const _={visible:!!n.size,type:"rect"},y={visible:!!o.size,type:"rect"},{x:b,y:S,offsetWidth:v,offsetHeight:A,bandWidth:x,bandHeight:T}=layoutByValue$1(3,l,e,n,o,_,y);return b?layoutVerticalCrosshair(_,b,x,v):S?layoutHorizontalCrosshair(y,S,T,A):void 0},isGlobalTooltipPositionPattern=r=>isObject$1(r)&&(isValid(r.left)||isValid(r.right)||isValid(r.top)||isValid(r.bottom)),isFixedTooltipPositionPattern=r=>isObject$1(r)&&(isValid(r.x)||isValid(r.y));class BaseTooltipHandler extends BasePlugin{constructor(){super(...arguments),this._visible=!0,this._isReleased=!1,this.showTooltip=(e,i,n)=>{const{changePositionOnly:o}=n;return o?this.changeTooltipPosition(n,i):this.changeTooltip(!0,n,i)},this.changeTooltip=(e,i,n)=>this._isReleased?1:e?this.changeTooltipPosition(i,n):(this._updateTooltip(!1,i),0),this.changeTooltipPosition=(e,i)=>{var n,o,l,u,d;if(this._isReleased)return 1;const f=e.event,{tooltipSpec:g,activeTooltipSpec:_,changePositionOnly:y}=e;if(!_)return 1;const b=_.activeType;if(_.handler)return(l=(o=(n=_.handler).showTooltip)===null||o===void 0?void 0:o.call(n,b,i,e))!==null&&l!==void 0?l:0;const S=_,v=this._getActualTooltipPosition(_,e,this._getTooltipBoxSize(_,y));_.position=v;const A=(u=_.updatePosition)!==null&&u!==void 0?u:(d=g[b])===null||d===void 0?void 0:d.updatePosition;A&&(_.position=A(_.position,i,e));let x=(S==null?void 0:S.visible)!==!1;return i&&f.type!=="pointerout"&&_.visible&&(_.title||_.content)||(x=!1),this._updateTooltip(x,Object.assign(Object.assign({},e),{changePositionOnly:y})),0},this._getActualTooltipPosition=(e,i,n)=>{var o,l,u,d,f,g,_,y,b;const{tooltipSpec:S}=i,v={x:1/0,y:1/0};if(!S)return v;const A=i.event,{activeType:x,data:T}=e,C=x==="dimension"?(l=(o=T[0])===null||o===void 0?void 0:o.data)===null||l===void 0?void 0:l[0]:T==null?void 0:T[0],{offsetX:E,offsetY:P}=this._option,L=S[x],R=getTooltipPatternValue(L==null?void 0:L.position,T,i),w=(u=getTooltipPatternValue(L==null?void 0:L.positionMode,T,i))!==null&&u!==void 0?u:x==="mark"?"mark":"pointer",{width:D=0,height:I=0}=n??{},O=S.renderMode==="canvas",B=(d=i==null?void 0:i.chart)===null||d===void 0?void 0:d.getCanvasRect(),N=(f=B==null?void 0:B.width)!==null&&f!==void 0?f:DEFAULT_CHART_WIDTH,$=(g=B==null?void 0:B.height)!==null&&g!==void 0?g:DEFAULT_CHART_HEIGHT;let H=!1;const F={width:0,height:0};let V,G={x:0,y:0},Y={x:0,y:0},J=1,q=1;const te=isTrueBrowser(this._env);if(te&&!S.confine?(F.width=window.innerWidth,F.height=window.innerHeight):(F.width=N,F.height=$),te&&!O){const ie=this._getParentElement(S);Y=(y=(_=ie==null?void 0:ie.getBoundingClientRect)===null||_===void 0?void 0:_.call(ie))!==null&&y!==void 0?y:v;const le=(b=this._compiler.getCanvas())!==null&&b!==void 0?b:this._chartContainer;V=le==null?void 0:le.getBoundingClientRect(),G={x:V.x-Y.x,y:V.y-Y.y},J=getScale(le,V),q=getScale(ie,Y)}const de=q/J,he={},fe={x:R,y:R},pe={x:["left","right"],y:["top","bottom"]},me=({orient:ie,mode:le,offset:ce},z)=>{var W;let K,ne;const se=i.model,ae=se==null?void 0:se.getLayoutStartPoint(),j=ce??(z==="x"?E:P);if(le==="mark"){H=!0;const U=i.item,X=U==null?void 0:U.getBounds();X&&ae&&(K=(z==="x"?X.x1:X.y1)+ae[z],ne=(z==="x"?X.x2:X.y2)+ae[z])}else if(le==="crosshair"&&((W=C==null?void 0:C.series)===null||W===void 0?void 0:W.coordinate)==="cartesian"&&C.datum&&C.datum.length){H=!0;const U=getCartesianCrosshairRect(C,ae);U&&(K=U.start[z],ne=U.end[z])}else fe[z]=ie;if(H){const U=pe[z][0],X=z==="x"?D:I;switch(getPositionType(ie,z)){case-2:he[U]=K-X*de-j;break;case 0:he[U]=(K+ne)/2-X*de/2;break;case-1:he[U]=(K+ne)/2-X*de-j;break;case 1:he[U]=(K+ne)/2+j;break;case 2:he[U]=ne+j}}},ee=["x","y"];if(isObject$1(R))if(isGlobalTooltipPositionPattern(R)){const{left:ie,right:le,top:ce,bottom:z}=R;he.left=getActualTooltipPositionValue(ie,A),he.top=getActualTooltipPositionValue(ce,A),he.right=getActualTooltipPositionValue(le,A),he.bottom=getActualTooltipPositionValue(z,A)}else isFixedTooltipPositionPattern(R)&&ee.forEach(ie=>{const le=R[ie];isNumber(le)||isFunction(le)?he[pe[ie][0]]=getActualTooltipPositionValue(le,A):me(le,ie)});else isValid(R)&&(me({orient:R,mode:w},"x"),me({orient:R,mode:w},"y"));const Q={x:null,y:null};return ee.forEach(ie=>{var le;const ce=ie==="x"?D:I,z=ie==="x"?N:$,W=ie==="x"?E:P,K=getPositionType(fe[ie],ie);if(isValidNumber(he[pe[ie][0]]))Q[ie]=he[pe[ie][0]];else if(isValidNumber(he[pe[ie][1]]))Q[ie]=z-ce*de-he[pe[ie][1]];else{const j=ie==="x"?A.canvasX:A.canvasY;Q[ie]=K>0?j+W:K===0?j-ce*de/2:j-ce*de-W}Q[ie]*=J,te&&(Q[ie]+=G[ie]),Q[ie]/=q;const ne=ie==="x"?F.width:F.height,se=S.confine?-(Y[ie]-((le=V==null?void 0:V[ie])!==null&&le!==void 0?le:0)/J)/q:-Y[ie]/q,ae=ne/q+se-ce;K!==2&&Q[ie]<se?H?Q[ie]=se:(Q[ie]+=K===0?W+ce/2:2*W+ce,Q[ie]>ae&&(Q[ie]=ae)):K!==-2&&Q[ie]>ae&&(H?Q[ie]=ae:(Q[ie]-=K===0?W+ce/2:2*W+ce,Q[ie]<se&&(Q[ie]=se)))}),Q}}get env(){return this._env}onAdd(e){super.onAdd(e);const i=e.component;this._component=i,this._chartOption=i.getOption(),this._env=this._chartOption.mode,this._chartContainer=this._chartOption.globalInstance.getContainer(),this._compiler=i.getCompiler(),this._initFromSpec()}hideTooltip(e){return this.changeTooltip(!1,e)}release(){var e,i,n;const o=(e=this._component.getSpec())!==null&&e!==void 0?e:{};o.handler?(n=(i=o.handler).release)===null||n===void 0||n.call(i):(this._removeTooltip(),this._isReleased=!0)}_getDefaultOption(){var e,i;const{offset:n}=this._component.getSpec();return n?{offsetX:(e=n.x)!==null&&e!==void 0?e:DEFAULT_OPTIONS.offsetX,offsetY:(i=n.y)!==null&&i!==void 0?i:DEFAULT_OPTIONS.offsetY}:DEFAULT_OPTIONS}_getParentElement(e){return e.parentElement}getTooltipContainer(){return this._container}_initFromSpec(){this._option=this._getDefaultOption()}reInit(){this._initFromSpec()}}BaseTooltipHandler.specKey="tooltip";const getPixelPropertyStr=(r,e)=>isValid(r)?isArray(r)?r.map(i=>`${i}px`).join(" "):`${r}px`:e??"initial",getTextStyle=(r={},e={})=>{var i,n;isValid(r.fontFamily)&&(e.fontFamily=r.fontFamily);const o=(i=r.fill)!==null&&i!==void 0?i:r.fontColor;return isValid(o)&&(e.color=o),isValid(r.fontWeight)&&(e.fontWeight=r.fontWeight),isValid(r.textAlign)&&(e.textAlign=r.textAlign),isValid(r.fontSize)&&(e.fontSize=getPixelPropertyStr(r.fontSize)),isValid(r.maxWidth)&&(e.maxWidth=getPixelPropertyStr(r.maxWidth)),r.multiLine?(e.whiteSpace="initial",e.wordBreak=(n=r.wordBreak)!==null&&n!==void 0?n:"break-word"):(e.wordBreak="normal",e.whiteSpace="nowrap"),e},getLineHeight=(r={})=>{const{lineHeight:e}=r;return r.fontSize?calcLayoutNumber(e,r.fontSize):0},getDomStyle=(r={})=>{var e,i,n,o;const{style:l={},enterable:u,transitionDuration:d}=r,{panel:f={},titleLabel:g,shape:_,keyLabel:y,valueLabel:b,spaceRow:S,align:v}=l,{panelStyle:A,panelPadding:x}=getPanelStyle(f),T={marginTop:"0px",marginBottom:"0px"};A.pointerEvents=u?"auto":"none",d&&(A.transitionDuration=d?`${d}ms`:"initial",A.transitionProperty=d?"transform":"initial",A.transitionTimingFunction=d?"ease-out":"initial"),isValidNumber(S)&&(T.marginBottom=`${S}px`);const C={width:getPixelPropertyStr((e=_==null?void 0:_.size)!==null&&e!==void 0?e:8)},E=getTextStyle(g),P=getTextStyle(y),L=getTextStyle(b),R=v==="right"?"marginLeft":"marginRight";v==="right"?(A.direction="rtl",E.textAlign="right",P.textAlign="right",L.textAlign="left"):(E.textAlign="left",P.textAlign="left",L.textAlign="right"),C[R]=getPixelPropertyStr((i=_.spacing)!==null&&i!==void 0?i:8),P[R]=getPixelPropertyStr((n=y.spacing)!==null&&n!==void 0?n:26),L[R]=getPixelPropertyStr((o=b.spacing)!==null&&o!==void 0?o:0);const w=Math.max(getLineHeight(b),getLineHeight(y));return T.lineHeight=w>0?`${w}px`:"20px",{panelPadding:x,row:T,panel:A,title:E,shape:C,key:P,value:L}},getPanelStyle=r=>{var e;const{backgroundColor:i,border:n,shadow:o,padding:l}=r,u={borderWidth:`${(e=n==null?void 0:n.width)!==null&&e!==void 0?e:0}px`};let d=null;n!=null&&n.color&&(u.borderColor=n.color),i&&(u.backgroundColor=i),u.boxShadow=o?`${o.x}px ${o.y}px ${o.blur}px ${o.spread}px ${o.color}`:"initial";const{radius:f}=n??{};return isValid(f)&&(u.borderRadius=isValidNumber(f)?`${f}px`:`${f}`),l&&(d=normalizePadding$1(l),u.padding=getPixelPropertyStr(d)),{panelStyle:u,panelPadding:d}};function setStyleToDom(r,e){r&&r.style&&e&&Object.keys(e).forEach(i=>{r.style[i]=e[i]})}const registerComponentPlugin=r=>{Factory$1.registerComponentPlugin(r.type,r)};function getSvgHtml(r,e){var i,n,o,l,u,d;if(!r||!r.hasShape||!r.shapeType)return"";const f='style="display:inline-block;vertical-align:middle;"',{shapeType:g,shapeFill:_,shapeStroke:y,shapeHollow:b=!1}=r,S=(i=r.shapeSize)!==null&&i!==void 0?i:8,v=r.shapeLineWidth?escapeHTML(r.shapeLineWidth)+"px":"0px";let A="currentColor";const x=()=>y?escapeHTML(y):A,T=S,C=D=>new Symbol$1({symbolType:D,size:T,fill:!0});let E=C(g);const P=E.getParsedPath();let L,R;if(!P.path&&P.pathStr&&(E=C(P.pathStr)),E.getParsedPath().path){const D=E.getParsedPath().path;R=D.toString(),L=D.bounds}else P.isSvg&&P.svgCache&&(R=P.svgCache.map(D=>D.path.toString()).join(),L=P.svgCache.reduce((D,I)=>D.union(I.path.bounds),new Bounds));let w=`${L.x1} ${L.y1} ${L.width()} ${L.height()}`;if(v!=="0px"){const[D,I,O,B]=w.split(" ").map($=>Number($)),N=Number(v.slice(0,-2));w=`${D-N/2} ${I-N/2} ${O+N} ${B+N}`}if(!_||isString(_)||b)return A=b?"none":_?escapeHTML(_):"currentColor",`
    <svg ${f} width="${S}" height="${S}" viewBox="${w}">
      <path
        d="${R}"
        style="fill: ${A}; stroke: ${x()}; stroke-width: ${v}"
      >
      </path>
    </svg>`;if(isObject$1(_)){A="gradientColor"+(e??"");let D="";const I=((n=_.stops)!==null&&n!==void 0?n:[]).map(O=>`<stop offset="${escapeHTML(O.offset.toString())}" stop-color="${escapeHTML(O.color)}"/>`).join("");return _.gradient==="radial"?D=`<radialGradient id="${A}" cx="50%" cy="50%" r="50%" fx="0%" fy="0%">
      ${I}
      </radialGradient>`:_.gradient==="linear"&&(D=`<linearGradient id="${A}" x1="${100*((o=_.x0)!==null&&o!==void 0?o:0)}%" y1="${100*((l=_.y0)!==null&&l!==void 0?l:0)}%" x2="${100*((u=_.x1)!==null&&u!==void 0?u:0)}%" y2="${100*((d=_.y1)!==null&&d!==void 0?d:0)}%">
      ${I}
      </linearGradient>`),`
    <svg ${f} width="${S}" height="${S}" viewBox="-0.5 -0.5 1 1">
      ${D}
      <path
        d="${R}"
        style="fill: url(#${A}); stroke: ${x()}; stroke-width: ${v}"
      >
      </path>
    </svg>`}return""}class DomTooltipHandler extends BaseTooltipHandler{getVisibility(){return!!this._rootDom&&this._rootDom.style.visibility==="visible"}setVisibility(e){e!==this.getVisibility()&&this._rootDom&&(this._rootDom.style.visibility=e?"visible":"hidden")}constructor(){super(DomTooltipHandler.type),this.type=TooltipHandlerType.dom,this._tooltipContainer=domDocument==null?void 0:domDocument.body}onAdd(e){super.onAdd(e),this._initStyle(),this.initEl()}initEl(){const e=this._component.getSpec().parentElement;if(domDocument&&e&&e.children&&e.children.length){for(let i=0;i<e.children.length;i++)if(e.children[i].classList.contains(TOOLTIP_CONTAINER_EL_CLASS_NAME)){this._container=e.children[i];break}this._container||(this._container=domDocument.createElement("div"),this._container.style.position="relative",this._container.style.zIndex=DEFAULT_TOOLTIP_Z_INDEX,this._container.classList.add(TOOLTIP_CONTAINER_EL_CLASS_NAME),e.appendChild(this._container))}}initRootDom(){var e,i,n;const o=this._component.getSpec(),l=document.createElement("div"),u=(i=(e=this._chartOption)===null||e===void 0?void 0:e.getTheme())!==null&&i!==void 0?i:{};setStyleToDom(l,Object.assign({left:"0",top:"0",pointerEvents:"none",padding:"12px",position:"absolute",zIndex:DEFAULT_TOOLTIP_Z_INDEX,fontFamily:(n=u==null?void 0:u.fontFamily)!==null&&n!==void 0?n:token.fontFamily,fontSize:"11px",borderRadius:"3px",borderStyle:"solid",lineHeight:"initial",background:"#fff",boxShadow:"2px 2px 4px rgba(0, 0, 0, 0.1)",maxWidth:"100wh",maxHeight:"100vh",visibility:"hidden"},this._domStyle.panel)),l.classList.add(o.className),l.setAttribute("vchart-tooltip-id",`${this.id}`),this._container.appendChild(l),this._rootDom=l}_getTooltipBoxSize(e,i){var n;this._rootDom||this.initRootDom(),i||this._updateDomStringByCol(e),this._updateDomStyle("height");const o=(n=this._rootDom)===null||n===void 0?void 0:n.getBoundingClientRect();return{width:o==null?void 0:o.width,height:o==null?void 0:o.height}}_removeTooltip(){this._rootDom&&this._rootDom.parentNode&&(this._rootDom.parentNode.removeChild(this._rootDom),this._rootDom=null),this._container=null}_updateTooltip(e,i){var n,o,l;if(e&&this._rootDom){const{tooltipSpec:u,activeTooltipSpec:d}=i;i.changePositionOnly||(this._tooltipActual=d);const f=this.getVisibility(),g=this._rootDom;if(g){const{x:_=0,y=0}=(n=d.position)!==null&&n!==void 0?n:{};if(u.updateElement){this._updatePosition((o=this._cacheCustomTooltipPosition)!==null&&o!==void 0?o:{x:_,y}),u.updateElement(g,d,i);const b=this._getActualTooltipPosition(d,i,{width:g.offsetWidth,height:g.offsetHeight});this._updatePosition(b),this._cacheCustomTooltipPosition=b}else this._rootDom.style.transitionDuration=f?(l=this._domStyle.panel.transitionDuration)!==null&&l!==void 0?l:"initial":"0ms",this._updatePosition({x:_,y})}this.setVisibility(e)}else this.setVisibility(e),this._cacheCustomTooltipPosition=void 0}_initStyle(){const e=this._component.getSpec();this._domStyle=getDomStyle(e)}_updateDomStringByCol(e){var i;const{title:n={},content:o}=e,l=o&&o.length,u=this._domStyle.row,d=[...this._rootDom.children];let f=d.find(y=>y.className.includes(TOOLTIP_TITLE_CLASS_NAME));if(!f&&n.visible!==!1){f=document.createElement("h2");const y=document.createElement("span");f.appendChild(y),f.classList.add(TOOLTIP_TITLE_CLASS_NAME),this._rootDom.appendChild(f)}f&&n.visible!==!1?(setStyleToDom(f,Object.assign(Object.assign(Object.assign({},this._domStyle.title),l?u:{marginBottom:"0px"}),{marginTop:"0px"})),f.firstChild.innerHTML=`${(i=n.value)!==null&&i!==void 0?i:""}`):f&&n.visible===!1&&f.parentNode.removeChild(f);let g=d.find(y=>y.className.includes(TOOLTIP_CONTENT_BOX_CLASS_NAME));const _=["shape","key","value"];if(!g&&l&&(g=document.createElement("div"),_.forEach(y=>{const b=document.createElement("div");b.classList.add(`${TOOLTIP_PREFIX}-column`),b.classList.add(`${TOOLTIP_PREFIX}-${y}-column`),b.setAttribute("data-col",y),g.appendChild(b)}),g.classList.add(TOOLTIP_CONTENT_BOX_CLASS_NAME),this._rootDom.appendChild(g)),g&&l){const y=[...g.children];setStyleToDom(g,{whiteSpace:"nowrap"}),y.forEach((b,S)=>{const v=b.getAttribute("data-col");if(v&&_.includes(v)){const A=v==="shape"&&o.every(T=>!T.hasShape||!T.shapeType);setStyleToDom(b,Object.assign(Object.assign({},this._domStyle[v]),{display:A?"none":"inline-block",verticalAlign:"top"}));const x=[...b.children];x.slice(o.length).forEach(T=>{T.parentNode.removeChild(T)}),o.forEach((T,C)=>{let E=x[C];E||(E=document.createElement("div"),E.classList.add(`${TOOLTIP_PREFIX}-${v}`),b.appendChild(E));const P=Object.assign({},u);C===o.length-1&&(P.marginBottom="0px"),P.display=T.visible===!1?"none":"block",P.height="initial",v==="key"?(E.innerHTML=formatContent(T.key),T.keyStyle&&getTextStyle(T.keyStyle,P)):v==="value"?(E.innerHTML=formatContent(T.value),T.valueStyle&&getTextStyle(T.valueStyle,P)):v==="shape"&&(E.innerHTML=getSvgHtml(T,`${this.id}_${C}`)),setStyleToDom(E,P)})}})}else g&&!l&&g.parentNode.removeChild(g)}_updateDomStyle(e="width"){var i,n,o,l;const u=this._rootDom,d=[...u.children].find(f=>f.className.includes(TOOLTIP_CONTENT_BOX_CLASS_NAME));if(d){const f=this._component.getSpec(),g={};if(isValid((i=f==null?void 0:f.style)===null||i===void 0?void 0:i.maxContentHeight)){const b=u.children[0],S=b&&b.className.includes(TOOLTIP_TITLE_CLASS_NAME)?b.getBoundingClientRect().height+((n=f.style.spaceRow)!==null&&n!==void 0?n:0):0,v=this._chartOption.getChartViewRect(),A=calcLayoutNumber(f.style.maxContentHeight,Math.min(v.height,document.body.clientHeight)-S-(this._domStyle.panelPadding?this._domStyle.panelPadding[0]+this._domStyle.panelPadding[1]:0));A>0&&(g.maxHeight=`${A}px`,g.overflowY="auto",g.width=`calc(100% + ${this._domStyle.panelPadding?this._domStyle.panelPadding[1]+"px":"10px"})`,setStyleToDom(d,g))}const _=d.children,y=[];if(_){for(let b=0;b<_.length;b++){const S=(o=_[b].children)!==null&&o!==void 0?o:[];for(let v=0;v<S.length;v++){const A=S[v].getBoundingClientRect()[e];(y[v]===void 0||y[v]<A)&&(y[v]=A)}}for(let b=0;b<_.length;b++){const S=(l=_[b].children)!==null&&l!==void 0?l:[];for(let v=0;v<S.length;v++)S[v].style[e]=`${y[v]}px`}}}}_getParentElement(e){var i;return(i=this._container)!==null&&i!==void 0?i:super._getParentElement(e)}isTooltipShown(){return this.getVisibility()}reInit(){super.reInit(),this._initStyle(),this._rootDom&&setStyleToDom(this._rootDom,this._domStyle.panel),this.getVisibility()&&(this._updateDomStringByCol(this._tooltipActual),this._updateDomStyle("height"))}_updatePosition({x:e,y:i}){this._rootDom&&(this._rootDom.style.transform=`translate3d(${e}px, ${i}px, 0)`)}}DomTooltipHandler.type=TooltipHandlerType.dom;const registerDomTooltipHandler=()=>{registerComponentPlugin(DomTooltipHandler)},DEFAULT_TEXT_ATTRIBUTES={fontFamily:token.fontFamily,spacing:10,wordBreak:"break-word"},measureTooltipText=(r,e)=>{var i;let n,o;(r==null?void 0:r.type)!=="rich"&&(r==null?void 0:r.type)!=="html"?(r=(r??"").toString(),e.multiLine?(n=r.split(`
`),n=n.map((u,d)=>d<n.length-1?u+`
`:u)):n=[r],o=n.map(u=>Object.assign(Object.assign({},e),{text:u}))):(o=r.text,n=r);const l=getRichTextBounds({wordBreak:(i=e.wordBreak)!==null&&i!==void 0?i:"break-word",maxWidth:e.maxWidth?e.maxWidth:void 0,width:0,height:0,textConfig:o});return{width:l.width(),height:l.height(),text:n}};function getTextAttributes(r={},e,i){var n,o;return Object.assign(Object.assign({},i??DEFAULT_TEXT_ATTRIBUTES),{fill:(n=r.fill)!==null&&n!==void 0?n:r.fontColor,textAlign:r.textAlign,textBaseline:r.textBaseline,fontFamily:(o=r.fontFamily)!==null&&o!==void 0?o:e==null?void 0:e.fontFamily,fontSize:r.fontSize,fontWeight:r.fontWeight,lineHeight:r.lineHeight,spacing:r.spacing,multiLine:r.multiLine,maxWidth:r.maxWidth,wordBreak:r.wordBreak,autoWidth:r.autoWidth})}const getPanelAttributes=r=>{var e;const{backgroundColor:i,border:n,shadow:o}=r,l={lineWidth:(e=n==null?void 0:n.width)!==null&&e!==void 0?e:0,shadow:!!o};n!=null&&n.color&&(l.stroke=n.color),i&&(l.fill=i),o&&(l.shadowColor=o.color,l.shadowBlur=o.blur,l.shadowOffsetX=o.x,l.shadowOffsetY=o.y,l.shadowSpread=o.spread);const{radius:u}=n??{};return isValid(u)&&(l.cornerRadius=[u,u,u,u]),l},getTooltipAttributes=(r,e,i)=>{var n,o,l,u,d;const{style:f={},enterable:g,transitionDuration:_}=e,{panel:y={},titleLabel:b,shape:S,keyLabel:v,valueLabel:A,spaceRow:x,align:T}=f,C=normalizePadding$1(y.padding),E=normalizeLayoutPaddingSpec(y.padding),P=getTextAttributes(Object.assign({textAlign:T==="right"?"right":"left"},b),i),L=getTextAttributes(Object.assign({textAlign:T==="right"?"right":"left"},v),i),R=getTextAttributes(A,i),w={fill:!0,size:(n=S==null?void 0:S.size)!==null&&n!==void 0?n:8,spacing:(o=S==null?void 0:S.spacing)!==null&&o!==void 0?o:6},D={panel:getPanelAttributes(y),padding:C,title:{},content:[],titleStyle:{value:P,spaceRow:x},contentStyle:{shape:w,key:L,value:R,spaceRow:x},hasContentShape:!1,keyWidth:0,valueWidth:0,enterable:g,transitionDuration:_,align:T},{title:I={},content:O=[]}=r;let B=E.left+E.right,N=E.top+E.bottom,$=0;const H=!!O.length;let F=0,V=0,G=0,Y=0;if(H){const Q=[],ie=[],le=[],ce=[];let z=0;D.content=O.map((W,K)=>{let ne=0;const{hasShape:se,key:ae,shapeType:j="",shapeFill:U,shapeStroke:X,shapeLineWidth:re,shapeSize:ge,value:ue,isKeyAdaptive:Z,spaceRow:oe,keyStyle:_e,valueStyle:ye,shapeHollow:Se}=W,Ae={height:0,spaceRow:oe??x};if(isValid(ae)){const ve=mergeSpec({},L,getTextAttributes(_e,void 0,{})),{width:xe,height:Te,text:Me}=measureTooltipText(ae,ve);Ae.key=Object.assign(Object.assign({width:xe,height:Te},ve),{text:Me}),Z?ie.push(xe):Q.push(xe),ne=Math.max(ne,Te)}if(isValid(ue)){const ve=mergeSpec({},R,getTextAttributes(ye,void 0,{})),{width:xe,height:Te,text:Me}=measureTooltipText(ue,ve);Ae.value=Object.assign(Object.assign({width:xe,height:Te},ve),{text:Me}),le.push(xe),ne=Math.max(ne,Te)}if(se){const ve={visible:!0,symbolType:j};Se?ve.stroke=U:ve.fill=U,ve.stroke=X??U,ve.lineWidth=re,Ae.shape=ve;const xe=ge??w.size;ne=Math.max(xe,ne),ce.push(xe)}else Ae.shape={visible:!1};return Ae.height=ne,z+=ne,K<O.length-1&&(z+=Ae.spaceRow),Ae}),N+=z,F=Q.length?maxInArray(Q):0,V=ie.length?maxInArray(ie):0,G=le.length?maxInArray(le):0,Y=ce.length?maxInArray(ce)+w.spacing:0,$=Math.max(Y+F+L.spacing+G+R.spacing,Y+V,$),D.hasContentShape=!!ce.length,D.keyWidth=F,D.valueWidth=G}let J=0,q=0,te=0;const{visible:de=!0,value:he="",valueStyle:fe,spaceRow:pe}=I;D.title.visible=de,D.title.spaceRow=pe??x;let me={};const ee=()=>me.autoWidth&&me.multiLine!==!1;if(de){me=mergeSpec({},P,getTextAttributes(fe,void 0,{})),ee()&&(me.multiLine=(l=me.multiLine)===null||l===void 0||l,me.maxWidth=(u=me.maxWidth)!==null&&u!==void 0?u:H?Math.ceil($):void 0);const{text:Q,width:ie,height:le}=measureTooltipText(he,me);D.title.value=Object.assign(Object.assign({width:ee()?Math.min(ie,(d=me.maxWidth)!==null&&d!==void 0?d:Number.MAX_VALUE):ie,height:le},me),{text:Q}),J=D.title.value.width,q=D.title.value.height,te=q+(H?D.title.spaceRow:0)}return N+=te,D.title.width=J,D.title.height=q,ee()?B+=$||J:B+=Math.max(J,$),H&&D.content.forEach(Q=>{var ie;const le=Q.value;le&&((ie=le.autoWidth)===null||ie===void 0||ie)&&(le.width=B-E.left-E.right-Y-F-L.spacing-R.spacing,le.maxWidth||(le.maxWidth=Math.ceil(le.width)),D.valueWidth=Math.max(D.valueWidth,le.width))}),D.panel.width=B,D.panel.height=N,D};class CanvasTooltipHandler extends BaseTooltipHandler{constructor(){super(CanvasTooltipHandler.type),this.type=TooltipHandlerType.canvas,this._attributes=null}onAdd(e){var i;super.onAdd(e),this._tooltipCanvasId=(i=this._chartOption.modeParams)===null||i===void 0?void 0:i.tooltipCanvasId}_initTooltipComponent(e){const i=this._getLayer(e);this._tooltipComponent=new Tooltip$1({autoCalculatePosition:!1,autoMeasure:!1}),i.add(this._tooltipComponent)}_getLayer(e){if(this._layer)return this._layer;this._layer=e.createLayer(this._tooltipCanvasId);const i=this._layer.layerHandler.canvas.nativeCanvas;return i&&i.style&&(i.style.touchAction="none",i.style.pointerEvents="none"),this._layer}_getTooltipBoxSize(e,i){var n,o,l;if(!i||isNil(this._attributes)){const d=(o=(n=this._chartOption)===null||n===void 0?void 0:n.getTheme())!==null&&o!==void 0?o:{};this._attributes=getTooltipAttributes(e,this._component.getSpec(),d)}const{panel:u}=(l=this._attributes)!==null&&l!==void 0?l:{};return{width:u.width+u.lineWidth,height:u.height+u.lineWidth}}_removeTooltip(){this._layer&&this._layer.removeAllChild(),this._attributes=null}_updateTooltip(e,i){this._visible=e;const n=this._compiler.getStage();if(!n)return;if(!e)return void(this._tooltipComponent&&this._tooltipComponent.attribute.visible&&(this._tooltipComponent.hideAll(),this._tooltipComponent.setAttributes({visibleAll:!1})));this._tooltipComponent||this._initTooltipComponent(n);const{activeTooltipSpec:o}=i,l=o.position;i.changePositionOnly?isValid(l)&&this._tooltipComponent.setAttributes(l):this._tooltipComponent.setAttributes(Object.assign(Object.assign({},this._attributes),l)),this._tooltipComponent.attribute.visible||(this._tooltipComponent.showAll(),this._tooltipComponent.setAttributes({visibleAll:!0}))}isTooltipShown(){var e;return(e=this._tooltipComponent)===null||e===void 0?void 0:e.attribute.visibleAll}release(){var e;super.release(),(e=this._layer)===null||e===void 0||e.release()}}CanvasTooltipHandler.type=TooltipHandlerType.canvas;const registerCanvasTooltipHandler=()=>{registerComponentPlugin(CanvasTooltipHandler)},registerChartPlugin=r=>{Factory$1.registerChartPlugin(r.type,r)},bracketReg=/\{([^}]+)\}/,bracketGReg=/\{([^}]+)\}/g,semicolonReg=/:/;class FormatterPlugin extends BasePlugin{constructor(){super(FormatterPlugin.type),this.type="formatterPlugin",this._timeModeFormat={utc:TimeUtil.getInstance().timeUTCFormat,local:TimeUtil.getInstance().timeFormat},this._formatter=this._format,this._timeFormatter=this._timeModeFormat.local,this._numericFormatter=NumberUtil.getInstance().format,this._numericSpecifier=NumberUtil.getInstance().formatter,this._numericFormatterCache=new Map,this._isNumericFormatterCache=new Map}onInit(e,i){var n;const{globalInstance:o}=e;if(!o)return;this._spec=(n=i==null?void 0:i[FormatterPlugin.specKey])!==null&&n!==void 0?n:{};const{timeMode:l,customFormatter:u,numericFormatter:d,timeFormatter:f}=this._spec;isFunction(u)?this._formatter=u:(this._formatter=this._format.bind(this),isFunction(f)?this._timeFormatter=f:l&&this._timeModeFormat[l]&&(this._timeFormatter=this._timeModeFormat[l]),d&&(this._numericFormatter=d,this._numericSpecifier=null,this._numericFormatterCache=null)),Factory$1.registerFormatter(this._formatter)}_format(e,i,n){return isArray(e)?e.map((o,l)=>{const u=isArray(n)?n[l]:n;return u?this._formatSingleLine(o,i,u):o}):isArray(n)?n.map(o=>this._formatSingleLine(e,i,o)):this._formatSingleLine(e,i,n)}_formatSingleLine(e,i,n){let o;return this._isNumericFormatterCache&&(this._isNumericFormatterCache.get(n)?o=this._isNumericFormatterCache.get(n):(o=bracketReg.test(n),this._isNumericFormatterCache.set(n,o))),o?n.replace(bracketGReg,(l,u)=>{if(!semicolonReg.test(u)){const _=i[u.trim()];return _!==void 0?_:l}const d=u.split(":"),f=i[d.shift()],g=d.join(":");return this._formatSingleText(f,g)}):this._formatSingleText(e,n)}_formatSingleText(e,i){if(numberSpecifierReg.test(i)&&this._numericFormatter){let n;return this._numericFormatterCache&&this._numericSpecifier?(this._numericFormatterCache.get(i)?n=this._numericFormatterCache.get(i):(n=this._numericSpecifier(i),this._numericFormatterCache.set(i,n)),n(Number(e))):this._numericFormatter(i,Number(e))}return i.includes("%")&&this._timeFormatter?this._timeFormatter(i,e):e}release(){super.release(),this._format=null,this._timeFormatter=null,this._numericFormatter=null,this._numericSpecifier=null,this._numericFormatterCache=null,this._isNumericFormatterCache=null}}FormatterPlugin.pluginType="chart",FormatterPlugin.specKey="formatter",FormatterPlugin.type="formatterPlugin";const registerFormatPlugin=()=>{registerChartPlugin(FormatterPlugin)};class ImageMark extends BaseMark{constructor(){super(...arguments),this.type=ImageMark.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,lineWidth:0})}}ImageMark.type="image";const registerImageMark=()=>{Factory$1.registerMark(ImageMark.type,ImageMark),registerImageGraphic()},registerAllMarks=()=>{registerGroupMark(),registerLineMark(),registerSymbolMark(),registerRuleMark(),registerTextMark(),registerAreaMark(),registerRectMark(),registerPathMark(),registerArcMark(),registerPolygonMark(),registerImageMark(),registerRippleMark(),registerComponentMark(),registerArc3dMark(),registerRect3dMark(),registerPyramid3dMark()};VChart.useRegisters([registerLineChart,registerAreaChart,registerBarChart,registerScatterChart,registerPieChart,registerRoseChart,registerRadarChart,registerHistogramChart,registerMapChart,registerGaugeChart,registerWordCloudChart,registerWordCloudShapeChart,registerFunnelChart,registerWaterfallChart,registerBoxplotChart,registerCircularProgressChart,registerLinearProgressChart,registerRangeColumnChart,registerRangeAreaChart,registerSunburstChart,registerCirclePackingChart,registerTreemapChart,registerSankeyChart,registerHeatmapChart,registerSequenceChart,registerCorrelationChart,registerCommonChart,registerBar3dChart,registerPie3dChart,registerHistogram3dChart,registerFunnel3dChart,registerRangeColumn3dChart,registerWordCloud3dChart,registerWordCloudShape3dChart,registerCartesianLinearAxis,registerCartesianBandAxis,registerCartesianTimeAxis,registerCartesianLogAxis,registerCartesianSymlogAxis,registerPolarBandAxis,registerPolarLinearAxis,registerDiscreteLegend,registerContinuousLegend,registerTooltip,registerCartesianCrossHair,registerPolarCrossHair,registerDataZoom,registerScrollBar,registerIndicator,registerGeoCoordinate,registerMarkLine,registerMarkArea,registerMarkPoint,registerPolarMarkLine,registerPolarMarkArea,registerPolarMarkPoint,registerGeoMarkPoint,registerTitle,registerPlayer,registerLabel,registerTotalLabel,registerBrush,registerCustomMark,registerMapLabel,registerPoptip,registerGridLayout,registerLayout3d,registerAllMarks,registerDomTooltipHandler,registerCanvasTooltipHandler,registerFormatPlugin,registerElementActive,registerElementActiveByLegend,registerElementHighlightByLegend,registerElementHighlightByName,registerElementHighlightByGroup,registerElementHighlightByKey,registerAnimate,registerReactAttributePlugin,registerHtmlAttributePlugin]);const _hoisted_1$1={class:"service_banner_1"},_hoisted_2$1={class:"service_title_1"},_hoisted_3$1={class:"service_title_2"},_hoisted_4={class:"trapezoidal-horizintal",style:{position:"relative",bottom:"0px",width:"100%",height:"10vw"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"none"},_hoisted_5={class:"service_banner_2"},_hoisted_6={class:"abbbox"},_hoisted_7={class:"abb_2",ref:"parentElement"},_hoisted_8={class:"abb_1"},_hoisted_9={class:"abb_1txt1"},_hoisted_10={class:"abb_1txt2"},_hoisted_11={class:"abbbox"},_hoisted_12={class:"abb_1"},_hoisted_13={class:"abb_1txt1"},_hoisted_14={class:"abb_1txt2"},_hoisted_15={class:"abbbox"},_hoisted_16={class:"abb_1"},_hoisted_17={class:"abb_1txt1"},_hoisted_18={class:"abb_1txt2"},_hoisted_19={class:"abbbox"},_hoisted_20={class:"abb_1"},_hoisted_21={class:"abb_1txt1"},_hoisted_22={class:"abb_1txt2"},_hoisted_23={class:"trapezoidal-horizintal",style:{width:"100%",height:"10vw",display:"block"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"none"},_hoisted_24={class:"service_banner_3"},_hoisted_25={class:"left3box"},_hoisted_26={class:"left3left"},_hoisted_27={style:{"margin-bottom":"15px","font-size":"23px"}},_hoisted_28={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_29={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_30={class:"left3right"},_hoisted_31={class:"imgbox2"},_hoisted_32={class:"animate__animated animate__bounce animated-text"},_hoisted_33={class:"left3box"},_hoisted_34={class:"left3left",style:{"background-color":"#103169"}},_hoisted_35={style:{"margin-bottom":"15px","font-size":"23px"}},_hoisted_36={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_37={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_38={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_39={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_40={class:"left3right"},_hoisted_41={class:"imgbox2"},_hoisted_42={class:"animate__animated animate__bounce animated-text"},_hoisted_43={class:"left3box"},_hoisted_44={class:"left3left",style:{"background-color":"#103169"}},_hoisted_45={style:{"margin-bottom":"15px","font-size":"23px"}},_hoisted_46={style:{display:"flex","align-items":"center",margin:"3px 0"}},_hoisted_47={style:{display:"flex","align-items":"center",margin:"3px 0"}},_hoisted_48={style:{display:"flex","align-items":"center",margin:"3px 0"}},_hoisted_49={style:{display:"flex","align-items":"center",margin:"3px 0"}},_hoisted_50={style:{display:"flex","align-items":"center",margin:"3px 0"}},_hoisted_51={style:{display:"flex","align-items":"center",margin:"3px 0"}},_hoisted_52={class:"left3right"},_hoisted_53={class:"imgbox2"},_hoisted_54={class:"animate__animated animate__bounce animated-text"},_hoisted_55={class:"left3box"},_hoisted_56={class:"left3left",style:{"background-color":"#103169"}},_hoisted_57={style:{"margin-bottom":"15px","font-size":"23px"}},_hoisted_58={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_59={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_60={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_61={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_62={class:"left3right"},_hoisted_63={class:"imgbox2"},_hoisted_64={class:"animate__animated animate__bounce animated-text"},_hoisted_65={class:"left3box"},_hoisted_66={class:"left3left",style:{"background-color":"#103169"}},_hoisted_67={style:{"margin-bottom":"15px","font-size":"23px"}},_hoisted_68={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_69={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_70={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_71={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_72={style:{display:"flex","align-items":"center",margin:"10px 0"}},_hoisted_73={class:"left3right"},_hoisted_74={class:"imgbox2"},_hoisted_75={class:"animate__animated animate__bounce animated-text"},_sfc_main$2={__name:"Service",setup(__props){const{t,locale}=useI18n();let numx=!0;const box1=ref(null),box2=ref(null),box3=ref(null),box4=ref(null),box5=ref(null),box6=ref(null),box7=ref(null),box8=ref(null),onMouseEnter=box=>{if(numx)if(numx=!1,box=="box3"){const el=eval(box).value;el.classList.remove("animate__bounce"),el.offsetWidth,el.classList.add("animate__bounce"),setTimeout(()=>{numx=!0},500)}else if(box=="box4"||box=="box5"||box=="box6"||box=="box7"||box=="box8"){console.log(eval(box),"el");const el=eval(box).value;el.classList.remove("animate__headShake"),el.offsetWidth,el.classList.add("animate__headShake"),setTimeout(()=>{numx=!0},500)}else{const el=eval(box).value;el.classList.remove("animate__flipInX"),el.offsetWidth,el.classList.add("animate__flipInX"),setTimeout(()=>{numx=!0},500)}},updateBeforeContent=()=>{const r=document.createElement("style");r.textContent=`
    .service_banner_2 .abbbox .abb_2::before {
      content: "${t("honetitle3")}";
    }
  `,console.log(document,"style"),document.head.appendChild(r)};watch(()=>t("honetitle3"),updateBeforeContent);const data=[{type:t("tb1"),value:"20",formula:"Formation",texture:"circle"},{type:t("tb2"),value:"20",formula:"Implementation",texture:"horizontal-line"},{type:t("tb3"),value:"20",formula:"Provision",texture:"vertical-line"},{type:t("tb4"),value:"20",formula:"Identification",texture:"rect"},{type:t("tb5"),value:"20",formula:"Expansion",texture:"grid"}],spec={type:"pie",data:[{id:"id0",values:data}],outerRadius:.8,innerRadius:.5,padAngle:.6,valueField:"value",categoryField:"type",background:{visible:!0,fill:"#1e232b"},pie:{style:{cornerRadius:10,texture:r=>r.texture},state:{hover:{outerRadius:.85,stroke:"#000",lineWidth:1},selected:{outerRadius:.85,stroke:"#000",lineWidth:1}}},indicator:{visible:!0,trigger:"hover",limitRatio:.5,title:{visible:!0,autoFit:!0,fitStrategy:"inscribed",style:{fontWeight:"bolder",fontFamily:"Times New Roman",fill:"#888",text:r=>(r??data[0]).formula}},content:[{visible:!0,autoFit:!0,fitStrategy:"inscribed",style:{fill:"orange",fontWeight:"bolder",fontFamily:"Times New Roman",text:r=>(r??data[0].type).type}}]},legends:{visible:!0,orient:"left",item:{shape:{style:{symbolType:"circle",texture:r=>r.texture}}}},tooltip:{mark:{content:[{key:r=>r.type}]}}},chartContainer=ref(null);let vchart=null;return onMounted(()=>{updateBeforeContent(),vchart=new VChart(spec,{dom:chartContainer.value}),vchart.renderSync()}),onBeforeUnmount(()=>{vchart&&(vchart=null)}),(r,e)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",{ref_key:"box1",ref:box1,class:"animate__animated animate__flipInX txt_1",onMouseover:e[0]||(e[0]=i=>onMouseEnter("box1"))},toDisplayString$1(r.$t("service1")),545),createBaseVNode("div",{ref_key:"box2",ref:box2,class:"animate__animated animate__flipInX txt_2",onMouseover:e[1]||(e[1]=i=>onMouseEnter("box2"))},toDisplayString$1(r.$t("service2")),545)]),createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",{ref_key:"chartContainer",ref:chartContainer,class:"chart-container"},null,512)])]),createBaseVNode("div",null,[(openBlock(),createElementBlock("svg",_hoisted_4,e[8]||(e[8]=[createBaseVNode("polygon",{fill:"#212428",points:"100,0 0,50 0,0"},null,-1)])))]),createBaseVNode("div",_hoisted_5,[createBaseVNode("h2",{ref_key:"box3",ref:box3,class:"animate__animated animate__bounce txt_2",onMouseover:e[2]||(e[2]=i=>onMouseEnter("box3"))},toDisplayString$1(r.$t("choose1")),545),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,e[9]||(e[9]=[createBaseVNode("img",{src:_imports_0$1,alt:""},null,-1)]),512),createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,toDisplayString$1(r.$t("choose2")),1),createBaseVNode("div",_hoisted_10,toDisplayString$1(r.$t("choose3")),1)])]),createBaseVNode("div",_hoisted_11,[e[10]||(e[10]=createBaseVNode("div",{class:"abb_2"},[createBaseVNode("img",{src:_imports_1,alt:""})],-1)),createBaseVNode("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,toDisplayString$1(r.$t("choose4")),1),createBaseVNode("div",_hoisted_14,toDisplayString$1(r.$t("choose5")),1)])]),createBaseVNode("div",_hoisted_15,[e[11]||(e[11]=createBaseVNode("div",{class:"abb_2"},[createBaseVNode("img",{src:_imports_2,alt:""})],-1)),createBaseVNode("div",_hoisted_16,[createBaseVNode("div",_hoisted_17,toDisplayString$1(r.$t("choose6")),1),createBaseVNode("div",_hoisted_18,toDisplayString$1(r.$t("choose7")),1)])]),createBaseVNode("div",_hoisted_19,[e[12]||(e[12]=createBaseVNode("div",{class:"abb_2"},[createBaseVNode("img",{src:_imports_2,alt:""})],-1)),createBaseVNode("div",_hoisted_20,[createBaseVNode("div",_hoisted_21,toDisplayString$1(r.$t("choose8")),1),createBaseVNode("div",_hoisted_22,toDisplayString$1(r.$t("choose9")),1)])])]),(openBlock(),createElementBlock("svg",_hoisted_23,e[13]||(e[13]=[createBaseVNode("polygon",{fill:"#1578d4",points:"0,100 100,50 100,100"},null,-1)]))),createBaseVNode("div",_hoisted_24,[createBaseVNode("div",_hoisted_25,[createBaseVNode("div",_hoisted_26,[createBaseVNode("h2",{ref_key:"box4",ref:box4,class:"animate__animated animate__headShake zxzxcc",onMouseover:e[3]||(e[3]=i=>onMouseEnter("box4"))},toDisplayString$1(r.$t("service3")),545),createBaseVNode("div",_hoisted_27,toDisplayString$1(r.$t("service3_0")),1),createBaseVNode("div",_hoisted_28,[e[14]||(e[14]=createBaseVNode("span",{style:{"padding-right":"10px"}},[createBaseVNode("svg",{viewBox:"0 0 1024 1024",class:"icon",version:"1.1",xmlns:"http://www.w3.org/2000/svg",fill:"#000000",winth:"30",height:"30"},[createBaseVNode("g",{id:"SVGRepo_bgCarrier","stroke-width":"0"}),createBaseVNode("g",{id:"SVGRepo_tracerCarrier","stroke-linecap":"round","stroke-linejoin":"round"}),createBaseVNode("g",{id:"SVGRepo_iconCarrier"},[createBaseVNode("path",{d:"M512 192m-128 0a128 128 0 1 0 256 0 128 128 0 1 0-256 0Z",fill:"#fff"}),createBaseVNode("path",{d:"M110.021808 743.473457a128 128 0 1 0 221.702503-128 128 128 0 1 0-221.702503 128Z",fill:"#fff"}),createBaseVNode("path",{d:"M739.582127 791.504295a128 128 0 1 0 128-221.702504 128 128 0 1 0-128 221.702504Z",fill:"#fff"}),createBaseVNode("path",{d:"M181.7 509.3c-4.2 0-8.4-0.4-12.7-1.3-34.7-7-57.1-40.7-50.2-75.3 9.1-45.2 25.4-87.6 48.6-125.8 22.9-37.7 51.9-70.7 86.3-98.1 34.3-27.3 73.2-48.5 115.6-62.9C412.2 131.4 457.8 124 505 124c35.3 0 64 28.7 64 64s-28.7 64-64 64c-133.2 0-235.5 80.8-260.7 205.9-6.1 30.4-32.8 51.4-62.6 51.4zM512 913c-71.5 0-140.8-18.3-200.5-53.1-58.2-33.8-107.2-83.2-141.9-142.8-17.8-30.6-7.4-69.7 23.1-87.5 30.6-17.8 69.7-7.4 87.5 23.1C329.2 736.8 413.6 785 512 785c27.7 0 54.9-4.1 81-12.2 33.8-10.5 69.6 8.4 80.1 42.2 10.5 33.8-8.4 69.6-42.2 80.1C592.5 907 552.5 913 512 913zM807.9 738c-10.9 0-21.9-2.8-32-8.6-30.6-17.7-41-56.9-23.3-87.5C775 603.3 785 563.2 785 512c0-72.9-28.4-141.5-80-193-25-25-25-65.5 0-90.5s65.5-25 90.5 0c36.8 36.8 65.7 79.7 85.9 127.4 20.9 49.5 31.5 102 31.5 156.1 0 74-15.8 135.7-49.6 194.1-11.8 20.5-33.3 31.9-55.4 31.9z",fill:"#fff"})])])],-1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service3_1")),1)]),createBaseVNode("div",_hoisted_29,[e[15]||(e[15]=createBaseVNode("span",{style:{"padding-right":"10px"}},[createBaseVNode("svg",{viewBox:"0 0 1024 1024",class:"icon",version:"1.1",xmlns:"http://www.w3.org/2000/svg",fill:"#000000",winth:"30",height:"30"},[createBaseVNode("g",{id:"SVGRepo_bgCarrier","stroke-width":"0"}),createBaseVNode("g",{id:"SVGRepo_tracerCarrier","stroke-linecap":"round","stroke-linejoin":"round"}),createBaseVNode("g",{id:"SVGRepo_iconCarrier"},[createBaseVNode("path",{d:"M344.1664 235.1872c31.744 0 61.3888 12.16 83.712 33.9968l4.608 4.736 0.256-0.256a119.168 119.168 0 0 1 75.4944-37.8368l6.2208-0.4864 6.3232-0.1536h154.624c28.5952 0 52.1216 22.4256 54.0928 50.688l0.1536 3.8912 2.9696 199.424-50.9952-14.8992-2.816-177.0752a11.4688 11.4688 0 0 0-9.1392-11.0592l-1.9456-0.1792h-141.952c-32.9728 0-65.1776 26.0352-67.6864 56.8832l-0.1536 3.8656v386.6112l3.4048-1.5616 2.4064-1.3312 2.3296-1.408 4.5568-3.1744a5.4272 5.4272 0 0 1 7.936 1.28 6.912 6.912 0 0 1 1.1264 3.7376c0.1024 1.5104-0.0512 3.5584-0.4096 6.1696l-1.024 6.3232c-0.6144 3.4816-1.4336 7.424-2.3808 11.52l-2.1504 9.0368c-3.4304 13.696-6.272 20.7104-10.368 21.76a123.648 123.648 0 0 1-112.9984-26.3936l-3.2-2.9184H188.9024a54.4512 54.4512 0 0 1-53.6832-46.7456l-0.4352-3.9936-0.128-3.8912v-411.904c0-28.8256 22.272-52.5056 50.3808-54.528l3.8656-0.128h155.264z m-5.632 50.4576H196.5568a11.392 11.392 0 0 0-10.9056 9.2672l-0.1792 1.9968v395.4176c0 5.376 4.0704 10.0864 9.1392 11.0592l1.9456 0.2048h160.3584c8.5504 0 16.8704 3.4304 22.8864 9.3184l2.432 2.6624c5.9392 6.9632 13.0816 12.5696 20.992 16.5632l3.1232 1.408V346.4192c0-31.232-30.848-58.496-63.6928-60.6464l-4.1216-0.128z",fill:"#FFFFFF"}),createBaseVNode("path",{d:"M331.3408 502.4256h-80.64a20.1728 20.1728 0 0 1 0-40.32h80.64a20.1472 20.1472 0 1 1 0 40.32z m0-100.8128h-80.64a20.1728 20.1728 0 0 1 0-40.32h80.64a20.1472 20.1472 0 1 1 0 40.32z m-80.64 161.3056h80.64a20.1472 20.1472 0 1 1 0 40.3456h-80.64a20.1472 20.1472 0 1 1 0-40.3456zM613.632 401.6128H512.768a20.1728 20.1728 0 0 1 0-40.32h100.8384a20.1472 20.1472 0 1 1 0 40.32z",fill:"#FFFFFF"}),createBaseVNode("path",{d:"M645.4784 482.9696a112.256 112.256 0 0 1 74.0864 196.5824l1.024-0.9984 3.072 1.792a164.5824 164.5824 0 0 1 48.6912 44.1088l4.7616 6.8096 1.8688 2.9696 54.016-77.312a25.1904 25.1904 0 0 1 29.5424-9.1392l2.8928 1.28 2.6368 1.5872c11.264 7.8848 14.1312 23.3472 6.4 34.8416l-73.3184 104.9856 0.3328 1.6896c0.8704 4.7872 1.536 9.6256 1.9456 14.5152l0.512 7.424 0.1536 7.2448a25.1904 25.1904 0 0 1-50.3808 0.384l-0.1024-5.4272a113.4336 113.4336 0 0 0-226.7648 3.072v1.9712a25.1904 25.1904 0 0 1-50.3808 0 163.84 163.84 0 0 1 89.6256-146.0736l0.4864-0.2304-3.3536-3.4304a112 112 0 0 1-29.3376-64.2816l-0.512-6.0672-0.1536-6.0416a112.256 112.256 0 0 1 112.256-112.256z m0 39.04a73.216 73.216 0 1 0 0 146.432 73.216 73.216 0 0 0 0-146.432z m211.84 36.2496a20.0704 20.0704 0 0 1 0.2304 40.1408h-52.224a20.0704 20.0704 0 0 1-0.2304-40.1152z",fill:"#FFFFFF"}),createBaseVNode("path",{d:"M857.3184 497.2032h-88.6016a20.096 20.096 0 0 0 0.2304 40.1152h88.576a20.096 20.096 0 0 0-0.2048-40.1152z",fill:"#FFF"})])])],-1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service3_2")),1)])]),createBaseVNode("div",_hoisted_30,[e[16]||(e[16]=createBaseVNode("div",{class:"imgbox1"},[createBaseVNode("img",{src:_imports_3,alt:""})],-1)),createBaseVNode("div",_hoisted_31,[createBaseVNode("div",_hoisted_32,toDisplayString$1(r.$t("honetitle3")),1)])])]),createBaseVNode("div",_hoisted_33,[createBaseVNode("div",_hoisted_34,[createBaseVNode("h2",{ref_key:"box5",ref:box5,class:"animate__animated animate__headShake zxzxcc",onMouseover:e[4]||(e[4]=i=>onMouseEnter("box5"))},toDisplayString$1(r.$t("service4")),545),createBaseVNode("div",_hoisted_35,toDisplayString$1(r.$t("service4_0")),1),createBaseVNode("div",_hoisted_36,[e[17]||(e[17]=createBaseVNode("span",{style:{"padding-right":"10px"}},[createBaseVNode("svg",{winth:"30",height:"30",viewBox:"0 0 1024 1024",class:"icon",version:"1.1",xmlns:"http://www.w3.org/2000/svg",fill:"#000000",stroke:"#000000"},[createBaseVNode("g",{id:"SVGRepo_bgCarrier","stroke-width":"0"}),createBaseVNode("g",{id:"SVGRepo_tracerCarrier","stroke-linecap":"round","stroke-linejoin":"round"}),createBaseVNode("g",{id:"SVGRepo_iconCarrier"},[createBaseVNode("path",{d:"M523.9 788.3H166.4V169c0-4.3 3.4-7.7 7.6-7.7h490.8c4.2 0 7.6 3.5 7.6 7.7v190h45.8V169c0-29.9-24-54.2-53.4-54.2H174c-29.5 0-53.4 24.3-53.4 54.2v689c0 29.9 24 54.2 53.4 54.2h359.1c-5.9-11.6-9.3-24.8-9.3-38.7v-85.2z m-102.6 96.2c-17 0-30.9-14-30.9-31.3s13.8-31.3 30.9-31.3c17 0 30.9 14 30.9 31.3-0.1 17.3-13.9 31.3-30.9 31.3z m442.9-479H607.9c-21.1 0-38.2 17.4-38.2 38.7v429.3c0 21.3 17.1 38.7 38.2 38.7h256.3c21.1 0 38.2-17.4 38.2-38.7V444.2c0-21.4-17.1-38.7-38.2-38.7zM736.1 888.9c-12.7 0-22.9-10.4-22.9-23.2 0-12.8 10.3-23.2 22.9-23.2 12.6 0 22.9 10.4 22.9 23.2 0 12.8-10.3 23.2-22.9 23.2z m120.5-69.7H615.5V451.9h241.1v367.3z",fill:"#FFF"})])])],-1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service4_1")),1)]),createBaseVNode("div",_hoisted_37,[e[18]||(e[18]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg fill="#fff" height="30" width="30" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><g data-v-a2e620a5><g data-v-a2e620a5><path d="M401.819,206.077c-8.33-8.331-21.838-8.331-30.17,0l-85.48,85.481l-45.254-45.257c-4.001-4.001-9.426-6.249-15.086-6.249 c-5.658,0-11.083,2.247-15.084,6.249L110.18,346.869c-8.331,8.33-8.331,21.838,0,30.17c4.166,4.166,9.626,6.248,15.084,6.248 c5.46,0,10.92-2.084,15.084-6.248l85.481-85.478l45.254,45.254c4.001,4.001,9.427,6.248,15.086,6.248 c5.658,0,11.083-2.247,15.084-6.248l100.567-100.567C410.15,227.917,410.15,214.409,401.819,206.077z" data-v-a2e620a5></path></g></g><g data-v-a2e620a5><g data-v-a2e620a5><path d="M469.333,42.667H334.222V21.333C334.222,9.552,324.671,0,312.889,0H199.111c-11.782,0-21.333,9.552-21.333,21.333v21.333 H42.667c-11.782,0-21.333,9.552-21.333,21.333v426.667c0,11.782,9.552,21.333,21.333,21.333h426.667 c11.782,0,21.333-9.552,21.333-21.333V64C490.667,52.218,481.115,42.667,469.333,42.667z M220.444,42.667h71.111v21.249 c0,0.028-0.004,0.055-0.004,0.084s0.004,0.055,0.004,0.084v21.249h-71.111V42.667z M448,469.333H64v-384h113.778v21.333 c0,11.782,9.552,21.333,21.333,21.333h113.778c11.782,0,21.333-9.552,21.333-21.333V85.333H448V469.333z" data-v-a2e620a5></path></g></g></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service4_2")),1)]),createBaseVNode("div",_hoisted_38,[e[19]||(e[19]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M206.613915 531.8173m-47.488825 0a47.488825 47.488825 0 1 0 94.97765 0 47.488825 47.488825 0 1 0-94.97765 0Z" fill="#ffffff" data-v-a2e620a5></path><path d="M420.314141 531.8173m-47.488825 0a47.488825 47.488825 0 1 0 94.97765 0 47.488825 47.488825 0 1 0-94.97765 0Z" fill="#ffffff" data-v-a2e620a5></path><path d="M634.013343 531.8173m-47.488826 0a47.488825 47.488825 0 1 0 94.977651 0 47.488825 47.488825 0 1 0-94.977651 0Z" fill="#ffffff" data-v-a2e620a5></path><path d="M800.224743 341.861999m-47.488825 0a47.488825 47.488825 0 1 0 94.97765 0 47.488825 47.488825 0 1 0-94.97765 0Z" fill="#ffffff" data-v-a2e620a5></path><path d="M956.638584 591.804694c-3.744349-17.228918-4.451853-34.375926-4.451853-59.987394V189.900011c0-34.040092-27.698146-61.738237-61.738237-61.738237H434.562529c-34.040092 0-61.738237 27.698146-61.738237 61.738237v80.728239H135.380165c-39.280337 0-71.23375 31.953413-71.233749 71.233749v379.910602c0 39.280337 31.953413 71.23375 71.233749 71.23375H626.569696c8.208489 0 15.837458 4.429328 20.417297 11.849425 20.799206 33.71552 47.001456 59.279889 87.592366 85.458589 5.959013 3.861072 12.649079 5.762427 19.32686 5.762426 7.60542 0 15.188315-2.469611 21.657222-7.385284 12.046011-9.147391 16.950422-24.346969 12.486281-38.712081-8.115315-26.132625-11.570928-50.271746-11.570928-80.716975V555.561201h51.036588c4.846049 0 9.425888 2.562785 11.941575 6.67778 16.718 27.280401 35.732574 47.697698 61.656326 66.201354 6.237509 4.451853 13.46102 6.690067 20.707057 6.690066 6.794503 0 13.587982-1.970979 19.581807-5.912937 12.418705-8.172653 18.401267-22.862335 15.236437-37.41277zM734.579359 832.147439c-20.208425-15.987969-34.990257-32.474571-47.175516-52.230438-13.298223-21.541523-36.045883-34.399475-60.833123-34.399475H135.380165c-13.08935 0-23.744925-10.654551-23.744924-23.743901V341.861999c0-13.08935 10.654551-23.743901 23.744924-23.7439h569.865903c13.08935 0 23.744925 10.654551 23.744925 23.7439v427.400452c0 23.093734 1.739581 43.151647 5.588366 62.884988z m145.376358-294.718223c-11.095845-18.10946-31.187547-29.355816-52.439311-29.355816h-51.036588V341.861999c0-39.280337-31.953413-71.23375-71.23375-71.233749H420.314141v-80.728239c0-7.860368 6.388021-14.249412 14.249412-14.249412h455.885965c7.860368 0 14.249412 6.388021 14.249412 14.249412v341.917289c0 13.032012 0.127986 25.923753 1.112963 38.82778-9.705409-9.657286-17.983522-20.358936-25.856176-33.215864z" fill="#ffffff" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service4_3")),1)]),createBaseVNode("div",_hoisted_39,[e[20]||(e[20]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path opacity="0.4" d="M22 15C22 18.87 18.87 22 15 22L16.05 20.25" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path opacity="0.4" d="M2 9C2 5.13 5.13 2 9 2L7.95 3.75" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path d="M13.6992 4.4502L17.6792 6.75018L21.6192 4.46021" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path d="M17.6797 10.8203V6.74023" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path d="M16.7396 2.21L14.3396 3.53996C13.7996 3.83996 13.3496 4.59995 13.3496 5.21995V7.75999C13.3496 8.37999 13.7896 9.13998 14.3396 9.43998L16.7396 10.77C17.2496 11.06 18.0896 11.06 18.6096 10.77L21.0096 9.43998C21.5496 9.13998 21.9996 8.37999 21.9996 7.75999V5.21995C21.9996 4.59995 21.5596 3.83996 21.0096 3.53996L18.6096 2.21C18.0996 1.93 17.2596 1.93 16.7396 2.21Z" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path d="M2.34961 15.4502L6.31961 17.7502L10.2696 15.4602" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path d="M6.32031 21.8203V17.7402" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path d="M5.39 13.21L2.99001 14.54C2.45001 14.84 2 15.5999 2 16.2199V18.76C2 19.38 2.44001 20.14 2.99001 20.44L5.39 21.77C5.9 22.06 6.73999 22.06 7.25999 21.77L9.66 20.44C10.2 20.14 10.65 19.38 10.65 18.76V16.2199C10.65 15.5999 10.21 14.84 9.66 14.54L7.25999 13.21C6.73999 12.93 5.9 12.93 5.39 13.21Z" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service4_4")),1)])]),createBaseVNode("div",_hoisted_40,[e[21]||(e[21]=createBaseVNode("div",{class:"imgbox1"},[createBaseVNode("img",{src:_imports_4,alt:""})],-1)),createBaseVNode("div",_hoisted_41,[createBaseVNode("div",_hoisted_42,toDisplayString$1(r.$t("honetitle3")),1)])])]),createBaseVNode("div",_hoisted_43,[createBaseVNode("div",_hoisted_44,[createBaseVNode("h2",{ref_key:"box6",ref:box6,class:"animate__animated animate__headShake zxzxcc",onMouseover:e[5]||(e[5]=i=>onMouseEnter("box6"))},toDisplayString$1(r.$t("service5")),545),createBaseVNode("div",_hoisted_45,toDisplayString$1(r.$t("service5_0")),1),createBaseVNode("div",_hoisted_46,[e[22]||(e[22]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><title data-v-a2e620a5>/svg/ic-shuffle</title><desc data-v-a2e620a5>Created with Sketch.</desc><defs data-v-a2e620a5></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-a2e620a5><g id="ic-shuffle" stroke="#ffffff" stroke-width="2" data-v-a2e620a5><path d="M2,17.9999998 C2,19.1082887 2.89479504,19.9999998 4.0093689,19.9999998 L5.9906311,19.9999998 C6.8646376,19.9999998 7.8774291,19.4961382 8.39914483,18.7962726 L10.5549209,15.9043651 L11.0034256,15.3027099 L10.5510882,14.7039309 L9.28791415,13.0318115 L8.48166843,11.9645484 L7.68611114,13.0398025 L5.78620656,15.607663 C5.64814673,15.794261 5.23905036,15.9999998 5.00104344,15.9999998 L3.99895656,15.9999998 C2.8939935,15.9999998 2,16.8925469 2,17.9999998 Z M17,7.99999982 L17,9.00104326 C17,10.4426117 18.3902669,11.0239464 19.4130188,10.0011945 L22.0011947,7.41301865 C22.7819993,6.6322141 22.7833444,5.36913063 22.0011947,4.58698098 L19.4130188,1.99880509 C18.393426,0.979212222 17,1.5514083 17,2.99895638 L17,3.99999982 L15.9989566,3.99999982 C15.1354804,3.99999982 14.1173241,4.51067434 13.6048397,5.19673291 L11.4612982,8.06627426 L11.0137506,8.66540254 L11.4619396,9.26405117 L12.6968029,10.9134652 L13.4938682,11.97811 L14.2953367,10.916776 L16.1921918,8.40489069 C16.3390468,8.2104199 16.7595316,7.99999982 17,7.99999982 Z M17.0007853,20 C17.0004763,20.0002262 17,20.0014156 17,20.0066442 L17,21.4736462 C17,22.9303154 18.4207045,23.510591 19.4064778,22.4064533 L22.0854405,19.4058206 C22.8003941,18.6050206 22.7640332,17.3498197 22.0011947,16.5869812 L19.4130188,13.9988053 C18.3902669,12.9760534 17,13.5573881 17,14.9989566 L17,16 C16.760894,16 16.3418715,15.789162 16.1955096,15.5940128 L8.40449038,5.20598718 C7.88075638,4.50767518 6.86328205,4 5.9906311,4 L4.0093689,4 C2.89479504,4 2,4.89171112 2,6 C2,7.1074529 2.8939935,8 3.99895656,8 L5.00104344,8 C5.23990997,8 5.65788701,8.21051601 5.80449038,8.40598718 L13.5955096,18.7940128 C14.1186685,19.4915579 15.1311017,20 15.9989566,20 L17.0004762,20 L17.0007853,20 Z" id="Combined-Shape" data-v-a2e620a5></path></g></g></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service5_1")),1)]),createBaseVNode("div",_hoisted_47,[e[23]||(e[23]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30" viewBox="0 0 512 512" xml:space="preserve" fill="#fff" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><g data-v-a2e620a5><polygon class="st0" points="204.344,155.188 249.469,200.297 409.344,40.422 268.031,40.422 316.063,88.453 249.469,155.031 204.953,110.516 41.906,264.969 63.906,288.219 " data-v-a2e620a5></polygon><polygon class="st0" points="512,102.313 276.031,330.281 212.656,266.906 0,471.578 512,471.578 " data-v-a2e620a5></polygon></g></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service5_2")),1)]),createBaseVNode("div",_hoisted_48,[e[24]||(e[24]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><title data-v-a2e620a5>report-text</title><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-a2e620a5><g id="add" fill="#ffffff" transform="translate(42.666667, 85.333333)" data-v-a2e620a5><path d="M341.333333,1.42108547e-14 L426.666667,85.3333333 L426.666667,341.333333 L3.55271368e-14,341.333333 L3.55271368e-14,1.42108547e-14 L341.333333,1.42108547e-14 Z M330.666667,42.6666667 L42.6666667,42.6666667 L42.6666667,298.666667 L384,298.666667 L384,96 L330.666667,42.6666667 Z M149.333333,234.666667 L149.333333,266.666667 L85.3333333,266.666667 L85.3333333,234.666667 L149.333333,234.666667 Z M341.333333,234.666667 L341.333333,266.666667 L192,266.666667 L192,234.666667 L341.333333,234.666667 Z M149.333333,170.666667 L149.333333,202.666667 L85.3333333,202.666667 L85.3333333,170.666667 L149.333333,170.666667 Z M341.333333,170.666667 L341.333333,202.666667 L192,202.666667 L192,170.666667 L341.333333,170.666667 Z M149.333333,106.666667 L149.333333,138.666667 L85.3333333,138.666667 L85.3333333,106.666667 L149.333333,106.666667 Z M341.333333,106.666667 L341.333333,138.666667 L192,138.666667 L192,106.666667 L341.333333,106.666667 Z" id="Combined-Shape" data-v-a2e620a5></path></g></g></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service5_3")),1)]),createBaseVNode("div",_hoisted_49,[e[25]||(e[25]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M18 13H16M18 8H10M18 16H16M10.2 20H17.8C18.9201 20 19.4802 20 19.908 19.782C20.2843 19.5903 20.5903 19.2843 20.782 18.908C21 18.4802 21 17.9201 21 16.8V7.2C21 6.0799 21 5.51984 20.782 5.09202C20.5903 4.71569 20.2843 4.40973 19.908 4.21799C19.4802 4 18.9201 4 17.8 4H10.2C9.07989 4 8.51984 4 8.09202 4.21799C7.71569 4.40973 7.40973 4.71569 7.21799 5.09202C7 5.51984 7 6.07989 7 7.2V16.8C7 17.9201 7 18.4802 7.21799 18.908C7.40973 19.2843 7.71569 19.5903 8.09202 19.782C8.51984 20 9.07989 20 10.2 20ZM13 14.5C13 15.3284 12.3284 16 11.5 16C10.6716 16 10 15.3284 10 14.5C10 13.6716 10.6716 13 11.5 13C12.3284 13 13 13.6716 13 14.5ZM5 20C3.89543 20 3 19.1046 3 18V6C3 4.89543 3.89543 4 5 4C6.10457 4 7 4.89543 7 6V18C7 19.1046 6.10457 20 5 20Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service5_4")),1)]),createBaseVNode("div",_hoisted_50,[e[26]||(e[26]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg height="30" width="30" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 367.509 367.509" xml:space="preserve" fill="#000000" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><g data-v-a2e620a5><path style="fill:#ffffff;" d="M329.451,166.652h38.058c-2.292-24.808-9.51-48.194-20.671-69.199l-20.59,11.9l-6.852-11.851 l20.476-11.827c-14.656-23.231-34.286-42.951-57.469-57.68l-12.063,20.72l-11.827-6.885l12.144-20.85 C249.507,9.64,225.909,2.341,200.873,0.024V38.66H166.66V0.016c-25.036,2.317-48.633,9.616-69.784,20.947l12.144,20.85 l-11.827,6.885l-12.063-20.72c-23.183,14.729-42.813,34.449-57.469,57.68l20.476,11.827l-6.852,11.851l-20.59-11.9 c-11.161,21.004-18.379,44.39-20.671,69.207h38.058v34.213H0c2.292,24.808,9.51,48.194,20.671,69.207l20.598-11.9l6.852,11.851 L27.645,281.85c14.656,23.231,34.286,42.951,57.469,57.68l12.063-20.72l11.827,6.885l-12.144,20.85 c21.151,11.331,44.748,18.639,69.784,20.947v-38.635h34.213v38.635c25.036-2.317,48.633-9.616,69.784-20.947l-12.144-20.85 l11.827-6.885l12.063,20.72c23.183-14.729,42.813-34.441,57.469-57.68l-20.476-11.827l6.852-11.851l20.59,11.9 c11.161-21.004,18.379-44.39,20.671-69.207h-38.058v-34.213H329.451z M179.739,234.152c0,7.681-6.251,13.932-13.932,13.932H82.936 c-4.056,0-7.933-1.813-10.364-4.845c-2.26-2.821-3.105-6.462-2.325-10.014c1.219-5.487,3.333-10.722,6.275-15.558 c4.463-8.535,14.68-17.379,31.084-26.759c13.111-7.527,21.646-12.933,25.369-16.07c4.999-4.276,7.446-8.698,7.446-13.485 c0-3.739-1.236-6.747-3.78-9.177c-2.601-2.495-6.422-3.707-11.705-3.707c-7.178,0-11.786,1.87-14.111,5.706 c-0.764,1.276-1.39,3.146-1.845,5.552c-1.211,6.43-7.527,11.274-14.68,11.274h-9.73c-4.024,0-7.755-1.707-10.234-4.69 c-2.309-2.78-3.251-6.43-2.585-10.023c1.219-6.552,3.398-12.258,6.495-16.981c8.657-13.185,23.898-19.874,45.309-19.874 c16.639,0,30.181,3.829,40.22,11.38c10.461,7.836,15.769,18.395,15.769,31.352c0,10.006-3.739,18.964-11.12,26.654 c-4.682,4.918-11.965,10.144-22.24,15.973l-11.681,6.633c-4.934,2.812-8.803,5.088-11.575,6.812h42.895 c7.682,0,13.932,6.251,13.932,13.932v1.983H179.739z M284.516,222.528c-2.057,0-3.731,2.089-3.731,4.641v6.982 c0,7.681-6.251,13.932-13.932,13.932h-9.933c-7.682,0-13.932-6.251-13.932-13.932v-6.982c0-2.56-2.081-4.641-4.641-4.641h-40.074 c-7.681,0-13.932-6.251-13.932-13.932v-1.829c0-6.17,2.804-14.55,6.527-19.492l43.268-57.282c3.983-5.267,11.973-9.25,18.59-9.25 h14.119c7.682,0,13.932,6.251,13.932,13.932v55.648c0,2.561,1.674,4.641,3.731,4.641c7.186,0,13.022,6.178,13.022,13.778 C297.538,216.342,291.702,222.528,284.516,222.528z" data-v-a2e620a5></path><path style="fill:#ffffff;" d="M219.74,194.964c0.065,0,0.13,0,0.203,0h18.411c2.56,0,4.641-2.089,4.641-4.641v-27.531 l-23.142,32.01C219.813,194.858,219.78,194.915,219.74,194.964z" data-v-a2e620a5></path></g></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service5_5")),1)]),createBaseVNode("div",_hoisted_51,[e[27]||(e[27]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path fill-rule="evenodd" clip-rule="evenodd" d="M19.186 2.09c.521.25 1.136.612 1.625 1.101.49.49.852 1.104 1.1 1.625.313.654.11 1.408-.401 1.92l-7.214 7.213c-.31.31-.688.541-1.105.675l-4.222 1.353a.75.75 0 0 1-.943-.944l1.353-4.221a2.75 2.75 0 0 1 .674-1.105l7.214-7.214c.512-.512 1.266-.714 1.92-.402zm.211 2.516a3.608 3.608 0 0 0-.828-.586l-6.994 6.994a1.002 1.002 0 0 0-.178.241L9.9 14.102l2.846-1.496c.09-.047.171-.107.242-.178l6.994-6.994a3.61 3.61 0 0 0-.586-.828zM4.999 5.5A.5.5 0 0 1 5.47 5l5.53.005a1 1 0 0 0 0-2L5.5 3A2.5 2.5 0 0 0 3 5.5v12.577c0 .76.082 1.185.319 1.627.224.419.558.754.977.978.442.236.866.318 1.627.318h12.154c.76 0 1.185-.082 1.627-.318.42-.224.754-.559.978-.978.236-.442.318-.866.318-1.627V13a1 1 0 1 0-2 0v5.077c0 .459-.021.571-.082.684a.364.364 0 0 1-.157.157c-.113.06-.225.082-.684.082H5.923c-.459 0-.57-.022-.684-.082a.363.363 0 0 1-.157-.157c-.06-.113-.082-.225-.082-.684V5.5z" fill="#ffffff" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service5_6")),1)])]),createBaseVNode("div",_hoisted_52,[e[28]||(e[28]=createBaseVNode("div",{class:"imgbox1"},[createBaseVNode("img",{src:_imports_5,alt:""})],-1)),createBaseVNode("div",_hoisted_53,[createBaseVNode("div",_hoisted_54,toDisplayString$1(r.$t("honetitle3")),1)])])]),createBaseVNode("div",_hoisted_55,[createBaseVNode("div",_hoisted_56,[createBaseVNode("h2",{ref_key:"box7",ref:box7,class:"animate__animated animate__headShake zxzxcc",onMouseover:e[6]||(e[6]=i=>onMouseEnter("box7"))},toDisplayString$1(r.$t("service6")),545),createBaseVNode("div",_hoisted_57,toDisplayString$1(r.$t("service6_0")),1),createBaseVNode("div",_hoisted_58,[e[29]||(e[29]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg fill="#fff" width="30" height="30" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M11,3a1,1,0,0,0-1-1H3A1,1,0,0,0,2,3V22h9ZM9,18H4V16H9Zm0-4H4V12H9Zm0-4H4V8H9ZM9,6H4V4H9ZM21,8H14a1,1,0,0,0-1,1V22h9V9A1,1,0,0,0,21,8ZM17,20H15V18h2Zm0-4H15V14h2Zm0-4H15V10h2Zm3,8H18V18h2Zm0-4H18V14h2Zm0-4H18V10h2Z" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service6_1")),1)]),createBaseVNode("div",_hoisted_59,[e[30]||(e[30]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><rect width="48" height="48" fill="white" fill-opacity="0.01" data-v-a2e620a5></rect><rect width="48" height="48" fill="white" fill-opacity="0.01" data-v-a2e620a5></rect><path d="M9 15V9.56389C9 8.67237 9.08702 8.34908 9.25044 8.02315C9.41385 7.69723 9.65365 7.44144 9.95921 7.26713C10.2648 7.09283 10.5678 7 11.4036 7H36.5964C37.4322 7 37.7352 7.09283 38.0408 7.26713C38.3463 7.44144 38.5862 7.69723 38.7496 8.02315C38.913 8.34908 39 8.67237 39 9.56389V15" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path><path d="M5 15H43V41H5V15Z" stroke="#ffffff" stroke-width="4" stroke-linejoin="round" data-v-a2e620a5></path><path fill-rule="evenodd" clip-rule="evenodd" d="M13 26C14.6569 26 16 24.6569 16 23C16 21.3431 14.6569 20 13 20C11.3431 20 10 21.3431 10 23C10 24.6569 11.3431 26 13 26Z" fill="#ffffff" data-v-a2e620a5></path><path d="M5.56885 40.39L14.9999 30L19.9999 34L25.9999 27L42.3937 40.39" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service6_2")),1)]),createBaseVNode("div",_hoisted_60,[e[31]||(e[31]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M5 19V6.2C5 5.0799 5 4.51984 5.21799 4.09202C5.40973 3.71569 5.71569 3.40973 6.09202 3.21799C6.51984 3 7.0799 3 8.2 3H15.8C16.9201 3 17.4802 3 17.908 3.21799C18.2843 3.40973 18.5903 3.71569 18.782 4.09202C19 4.51984 19 5.0799 19 6.2V17H7C5.89543 17 5 17.8954 5 19ZM5 19C5 20.1046 5.89543 21 7 21H19M18 17V21M14.5 8V7.91667C14.5 6.85812 13.6419 6 12.5833 6H11.5C10.3954 6 9.5 6.89543 9.5 8C9.5 9.10457 10.3954 10 11.5 10H12.5C13.6046 10 14.5 10.8954 14.5 12C14.5 13.1046 13.6046 14 12.5 14H11.4583C10.3768 14 9.5 13.1232 9.5 12.0417V12" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service6_3")),1)]),createBaseVNode("div",_hoisted_61,[e[32]||(e[32]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg fill="#fff" width="30" height="30" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><title data-v-a2e620a5>book</title><path d="M0 23.008v-17.984q0-1.024 0.48-1.888t1.28-1.44q1.024-0.672 2.24-0.672 0.736 0 1.472 0.256l10.016 4q0.064 0.032 0.512 0.32 0.448-0.288 0.512-0.32l10.016-4q0.736-0.256 1.472-0.256 1.248 0 2.24 0.672 0.832 0.576 1.312 1.44t0.448 1.888v17.984q0 1.248-0.672 2.24t-1.856 1.472l-9.984 4q-0.736 0.288-1.472 0.288-1.024 0-2.016-0.576-0.992 0.576-1.984 0.576-0.768 0-1.504-0.288l-9.984-4q-1.152-0.448-1.824-1.472t-0.704-2.24zM4 23.008l10.016 4v-17.984l-10.016-4v17.984zM6.016 21.824v-2.016l5.984 2.4v2.016zM6.016 17.824v-2.016l5.984 2.4v2.016zM6.016 13.824v-2.016l5.984 2.4v2.016zM6.016 9.824v-2.016l5.984 2.4v2.016zM18.016 27.008l9.984-4v-17.984l-9.984 4v17.984zM20 24.224v-2.016l6.016-2.4v2.016zM20 20.224v-2.016l6.016-2.4v2.016zM20 16.224v-2.016l6.016-2.4v2.016zM20 12.224v-2.016l6.016-2.4v2.016z" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service6_4")),1)])]),createBaseVNode("div",_hoisted_62,[e[33]||(e[33]=createBaseVNode("div",{class:"imgbox1"},[createBaseVNode("img",{src:_imports_6,alt:""})],-1)),createBaseVNode("div",_hoisted_63,[createBaseVNode("div",_hoisted_64,toDisplayString$1(r.$t("honetitle3")),1)])])]),createBaseVNode("div",_hoisted_65,[createBaseVNode("div",_hoisted_66,[createBaseVNode("h2",{ref_key:"box8",ref:box8,class:"animate__animated animate__headShake zxzxcc",onMouseover:e[7]||(e[7]=i=>onMouseEnter("box8"))},toDisplayString$1(r.$t("service7")),545),createBaseVNode("div",_hoisted_67,toDisplayString$1(r.$t("service7_0")),1),createBaseVNode("div",_hoisted_68,[e[34]||(e[34]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M4 19L4 5M20 19L20 5M19 12H14M14 12L16 10M14 12L16 14M5 12H10M10 12L8 14M10 12L8 10" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service7_1")),1)]),createBaseVNode("div",_hoisted_69,[e[35]||(e[35]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M5 6H19M5 10H15M5 14H19M5 18H15" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service7_2")),1)]),createBaseVNode("div",_hoisted_70,[e[36]||(e[36]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg fill="#fff" width="30" height="30" viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M408 242q0 38 27 64.5t65 26.5 65-26.5 27-64.5-27-65-65-27-65 27-27 65zM58 559q20 19 47 24.5t53-5 41.5-33.5 15.5-51-15.5-51-41-34-53-5.5T58 429q-27 27-27 65t27 65zm442-171q-29 0-55-11-10-4-18 2l-45 30q-5 4-7.5 10t-.5 12l107 385q3 10 11 13.5t16.5 0T519 816l107-385q2-6-.5-12t-7.5-10l-45-30q-8-6-18-2-26 11-55 11zM328 526l-57 11q-8 2-11 9-11 28-32 50t-49 33q-6 3-8 9l-11 58q-1 5 1.5 9.5t6.5 6.5l233 117q9 5 16.5-1.5T422 812l-76-275q-2-6-7-9t-11-2zm614 33q-20 19-47 24.5t-53-5-41.5-33.5-15.5-51 15.5-51 41-34 53-5.5T942 429q27 27 27 65t-27 65zm-270-33l57 11q8 2 11 9 11 28 32 49.5t48 33.5q8 3 9 11l11 58q1 4-1 7.5t-5 5.5L599 829q-9 5-16.5-1.5T578 812l76-275q2-6 7-9t11-2z" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service7_3")),1)]),createBaseVNode("div",_hoisted_71,[e[37]||(e[37]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><path d="M12 3L12.4892 2.12785C12.1854 1.95738 11.8146 1.95738 11.5108 2.12785L12 3ZM13.3976 3.784L12.9084 4.65615C13.0542 4.73792 13.2181 4.78185 13.3852 4.78392L13.3976 3.784ZM15 3.80385L15.8598 3.29316C15.6818 2.99359 15.3608 2.80824 15.0124 2.80392L15 3.80385ZM15.8184 5.18162L14.9586 5.69231C15.044 5.83601 15.164 5.95603 15.3077 6.04139L15.8184 5.18162ZM17.1962 6L18.1961 5.98761C18.1918 5.63921 18.0064 5.31817 17.7068 5.14023L17.1962 6ZM17.216 7.60238L16.2161 7.61476C16.2181 7.78189 16.2621 7.94584 16.3438 8.09161L17.216 7.60238ZM18 9L18.8722 9.48924C19.0426 9.18535 19.0426 8.81465 18.8722 8.51076L18 9ZM17.216 10.3976L16.3438 9.90839C16.2621 10.0542 16.2181 10.2181 16.2161 10.3852L17.216 10.3976ZM17.1962 12L17.7068 12.8598C18.0064 12.6818 18.1918 12.3608 18.1961 12.0124L17.1962 12ZM15.8184 12.8184L15.3077 11.9586C15.164 12.044 15.044 12.164 14.9586 12.3077L15.8184 12.8184ZM15 14.1962L15.0124 15.1961C15.3608 15.1918 15.6818 15.0064 15.8598 14.7068L15 14.1962ZM13.3976 14.216L13.3852 13.2161C13.2181 13.2181 13.0542 13.2621 12.9084 13.3438L13.3976 14.216ZM12 15L11.5108 15.8722C11.8146 16.0426 12.1854 16.0426 12.4892 15.8722L12 15ZM10.6024 14.216L11.0916 13.3438C10.9458 13.2621 10.7819 13.2181 10.6148 13.2161L10.6024 14.216ZM9 14.1962L8.14023 14.7068C8.31817 15.0064 8.63921 15.1918 8.98761 15.1961L9 14.1962ZM8.18162 12.8184L9.04139 12.3077C8.95603 12.164 8.83602 12.044 8.69231 11.9586L8.18162 12.8184ZM6.80385 12L5.80392 12.0124C5.80824 12.3608 5.99359 12.6818 6.29316 12.8598L6.80385 12ZM6.784 10.3976L7.78392 10.3852C7.78185 10.2181 7.73792 10.0542 7.65615 9.90839L6.784 10.3976ZM6 9L5.12785 8.51076C4.95738 8.81465 4.95738 9.18535 5.12785 9.48924L6 9ZM6.784 7.60238L7.65615 8.09161C7.73792 7.94584 7.78185 7.78189 7.78392 7.61476L6.784 7.60238ZM6.80385 6L6.29316 5.14023C5.99359 5.31817 5.80824 5.63921 5.80392 5.98762L6.80385 6ZM8.18162 5.18162L8.69231 6.04139C8.83602 5.95603 8.95603 5.83602 9.04139 5.69231L8.18162 5.18162ZM9 3.80385L8.98762 2.80392C8.63921 2.80824 8.31817 2.99359 8.14023 3.29316L9 3.80385ZM10.6024 3.784L10.6148 4.78392C10.7819 4.78185 10.9458 4.73792 11.0916 4.65615L10.6024 3.784ZM8.5 21H7.5C7.5 21.3565 7.68976 21.686 7.99807 21.8649C8.30639 22.0438 8.68664 22.0451 8.99614 21.8682L8.5 21ZM12 19L12.4961 18.1318C12.1887 17.9561 11.8113 17.9561 11.5039 18.1318L12 19ZM15.5 21L15.0039 21.8682C15.3134 22.0451 15.6936 22.0438 16.0019 21.8649C16.3102 21.686 16.5 21.3565 16.5 21H15.5ZM11.5108 3.87215L12.9084 4.65615L13.8869 2.91185L12.4892 2.12785L11.5108 3.87215ZM13.3852 4.78392L14.9876 4.80377L15.0124 2.80392L13.41 2.78408L13.3852 4.78392ZM14.1402 4.31454L14.9586 5.69231L16.6781 4.67094L15.8598 3.29316L14.1402 4.31454ZM15.3077 6.04139L16.6855 6.85977L17.7068 5.14023L16.3291 4.32186L15.3077 6.04139ZM16.1962 6.01239L16.2161 7.61476L18.2159 7.58999L18.1961 5.98761L16.1962 6.01239ZM16.3438 8.09161L17.1278 9.48924L18.8722 8.51076L18.0882 7.11314L16.3438 8.09161ZM17.1278 8.51076L16.3438 9.90839L18.0882 10.8869L18.8722 9.48924L17.1278 8.51076ZM16.2161 10.3852L16.1962 11.9876L18.1961 12.0124L18.2159 10.41L16.2161 10.3852ZM14.9876 13.1962L13.3852 13.2161L13.41 15.2159L15.0124 15.1961L14.9876 13.1962ZM10.6148 13.2161L9.01239 13.1962L8.98761 15.1961L10.59 15.2159L10.6148 13.2161ZM7.80377 11.9876L7.78392 10.3852L5.78408 10.41L5.80392 12.0124L7.80377 11.9876ZM7.65615 9.90839L6.87215 8.51076L5.12785 9.48924L5.91185 10.8869L7.65615 9.90839ZM6.87215 9.48924L7.65615 8.09161L5.91185 7.11314L5.12785 8.51076L6.87215 9.48924ZM7.78392 7.61476L7.80377 6.01238L5.80392 5.98762L5.78408 7.58999L7.78392 7.61476ZM7.31454 6.85977L8.69231 6.04139L7.67094 4.32186L6.29316 5.14023L7.31454 6.85977ZM9.04139 5.69231L9.85977 4.31454L8.14023 3.29316L7.32186 4.67094L9.04139 5.69231ZM9.01238 4.80377L10.6148 4.78392L10.59 2.78408L8.98762 2.80392L9.01238 4.80377ZM11.0916 4.65615L12.4892 3.87215L11.5108 2.12785L10.1131 2.91185L11.0916 4.65615ZM16.6855 11.1402L15.3077 11.9586L16.3291 13.6781L17.7068 12.8598L16.6855 11.1402ZM8.69231 11.9586L7.31454 11.1402L6.29316 12.8598L7.67094 13.6781L8.69231 11.9586ZM12.9084 13.3438L11.5108 14.1278L12.4892 15.8722L13.8869 15.0882L12.9084 13.3438ZM12.4892 14.1278L11.0916 13.3438L10.1131 15.0882L11.5108 15.8722L12.4892 14.1278ZM8.99614 21.8682L12.4961 19.8682L11.5039 18.1318L8.00386 20.1318L8.99614 21.8682ZM11.5039 19.8682L15.0039 21.8682L15.9961 20.1318L12.4961 18.1318L11.5039 19.8682ZM16.5 21V13.3544H14.5V21H16.5ZM14.9586 12.3077L14.6402 12.8437L16.3598 13.8651L16.6781 13.3291L14.9586 12.3077ZM14.6402 12.8437L14.1402 13.6855L15.8598 14.7068L16.3598 13.8651L14.6402 12.8437ZM7.5 13.3544V21H9.5V13.3544H7.5ZM9.85977 13.6855L9.35977 12.8437L7.64023 13.8651L8.14023 14.7068L9.85977 13.6855ZM9.35977 12.8437L9.04139 12.3077L7.32186 13.3291L7.64023 13.8651L9.35977 12.8437ZM13 9C13 9.55228 12.5523 10 12 10V12C13.6569 12 15 10.6569 15 9H13ZM12 10C11.4477 10 11 9.55228 11 9H9C9 10.6569 10.3431 12 12 12V10ZM11 9C11 8.44772 11.4477 8 12 8V6C10.3431 6 9 7.34315 9 9H11ZM12 8C12.5523 8 13 8.44772 13 9H15C15 7.34315 13.6569 6 12 6V8Z" fill="#ffffff" data-v-a2e620a5></path></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service7_4")),1)]),createBaseVNode("div",_hoisted_72,[e[38]||(e[38]=createStaticVNode('<span style="padding-right:10px;" data-v-a2e620a5><svg width="30" height="30" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" data-v-a2e620a5><g id="SVGRepo_bgCarrier" stroke-width="0" data-v-a2e620a5></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-v-a2e620a5></g><g id="SVGRepo_iconCarrier" data-v-a2e620a5><title data-v-a2e620a5>earth_fill</title><g id="-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-a2e620a5><g id="Map" transform="translate(-96.000000, -48.000000)" data-v-a2e620a5><g id="earth_fill" transform="translate(96.000000, 48.000000)" data-v-a2e620a5><path d="M24,0 L24,24 L0,24 L0,0 L24,0 Z M12.5934901,23.257841 L12.5819402,23.2595131 L12.5108777,23.2950439 L12.4918791,23.2987469 L12.4918791,23.2987469 L12.4767152,23.2950439 L12.4056548,23.2595131 C12.3958229,23.2563662 12.3870493,23.2590235 12.3821421,23.2649074 L12.3780323,23.275831 L12.360941,23.7031097 L12.3658947,23.7234994 L12.3769048,23.7357139 L12.4804777,23.8096931 L12.4953491,23.8136134 L12.4953491,23.8136134 L12.5071152,23.8096931 L12.6106902,23.7357139 L12.6232938,23.7196733 L12.6232938,23.7196733 L12.6266527,23.7031097 L12.609561,23.275831 C12.6075724,23.2657013 12.6010112,23.2592993 12.5934901,23.257841 L12.5934901,23.257841 Z M12.8583906,23.1452862 L12.8445485,23.1473072 L12.6598443,23.2396597 L12.6498822,23.2499052 L12.6498822,23.2499052 L12.6471943,23.2611114 L12.6650943,23.6906389 L12.6699349,23.7034178 L12.6699349,23.7034178 L12.678386,23.7104931 L12.8793402,23.8032389 C12.8914285,23.8068999 12.9022333,23.8029875 12.9078286,23.7952264 L12.9118235,23.7811639 L12.8776777,23.1665331 C12.8752882,23.1545897 12.8674102,23.1470016 12.8583906,23.1452862 L12.8583906,23.1452862 Z M12.1430473,23.1473072 C12.1332178,23.1423925 12.1221763,23.1452606 12.1156365,23.1525954 L12.1099173,23.1665331 L12.0757714,23.7811639 C12.0751323,23.7926639 12.0828099,23.8018602 12.0926481,23.8045676 L12.108256,23.8032389 L12.3092106,23.7104931 L12.3186497,23.7024347 L12.3186497,23.7024347 L12.3225043,23.6906389 L12.340401,23.2611114 L12.337245,23.2485176 L12.337245,23.2485176 L12.3277531,23.2396597 L12.1430473,23.1473072 Z" id="MingCute" fill-rule="nonzero" data-v-a2e620a5></path><path d="M11.9999,3.00008 C12.1107,3.00008 12.3642,3.06519 12.7351,3.4655 C13.0971,3.85632 13.4788,4.47391 13.8261,5.31188 C14.0485,5.84857 14.2493,6.45733 14.4193,7.12446 C13.6398,7.04338 12.8298,7.00008 11.9999,7.00008 C11.17,7.00008 10.36,7.04338 9.58057,7.12446 C9.75056,6.45733 9.95129,5.84857 10.1737,5.31188 C10.521,4.47391 10.9028,3.85632 11.2648,3.4655 C11.6356,3.06519 11.8891,3.00008 11.9999,3.00008 Z M9.18526,9.18543 C10.0701,9.0665 11.0153,9.00008 11.9999,9.00008 C12.9845,9.00008 13.9297,9.0665 14.8146,9.18543 C14.9335,10.0703 14.9999,11.0155 14.9999,12.0001 C14.9999,12.9847 14.9335,13.9299 14.8146,14.8147 C13.9297,14.9337 12.9845,15.0001 11.9999,15.0001 C11.0153,15.0001 10.0701,14.9337 9.18526,14.8147 C9.06634,13.9299 8.99992,12.9847 8.99992,12.0001 C8.99992,11.0155 9.06634,10.0703 9.18526,9.18543 Z M7.12429,14.4194 C7.04321,13.64 6.99992,12.83 6.99992,12.0001 C6.99992,11.1702 7.04321,10.3602 7.12429,9.58073 C6.45716,9.75073 5.84841,9.95145 5.31171,10.1739 C4.47374,10.5212 3.85615,10.9029 3.46533,11.2649 C3.06503,11.6358 2.99992,11.8893 2.99992,12.0001 C2.99992,12.1109 3.06503,12.3644 3.46533,12.7352 C3.85615,13.0972 4.47374,13.479 5.31171,13.8263 C5.84841,14.0487 6.45716,14.2494 7.12429,14.4194 Z M9.58057,16.8757 C10.36,16.9568 11.17,17.0001 11.9999,17.0001 C12.8298,17.0001 13.6398,16.9568 14.4193,16.8757 C14.2493,17.5428 14.0485,18.1516 13.8261,18.6883 C13.4788,19.5263 13.0971,20.1438 12.7351,20.5347 C12.3642,20.935 12.1107,21.0001 11.9999,21.0001 C11.8891,21.0001 11.6356,20.935 11.2648,20.5347 C10.9028,20.1438 10.521,19.5263 10.1737,18.6883 C9.95129,18.1516 9.75056,17.5428 9.58057,16.8757 Z M16.8755,14.4194 C16.9566,13.64 16.9999,12.83 16.9999,12.0001 C16.9999,11.1702 16.9566,10.3602 16.8755,9.58073 C17.5427,9.75073 18.1514,9.95145 18.6881,10.1739 C19.5261,10.5212 20.1437,10.9029 20.5345,11.2649 C20.9348,11.6358 20.9999,11.8893 20.9999,12.0001 C20.9999,12.1109 20.9348,12.3644 20.5345,12.7352 C20.1437,13.0972 19.5261,13.479 18.6881,13.8263 C18.1514,14.0487 17.5427,14.2494 16.8755,14.4194 Z M16.5472,7.45285 C16.3239,6.37847 16.0264,5.3972 15.6737,4.54615 C15.3072,3.6617 14.8656,2.88066 14.3553,2.27905 C17.9862,3.15569 20.8443,6.01376 21.7209,9.64473 C21.1193,9.13442 20.3383,8.69283 19.4539,8.32628 C18.6028,7.97356 17.6215,7.6761 16.5472,7.45285 Z M16.5472,16.5473 C16.3239,17.6217 16.0264,18.603 15.6737,19.454 C15.3072,20.3385 14.8656,21.1195 14.3553,21.7211 C17.9862,20.8445 20.8443,17.9864 21.7209,14.3554 C21.1193,14.8657 20.3383,15.3073 19.4539,15.6739 C18.6028,16.0266 17.6215,16.3241 16.5472,16.5473 Z M9.64456,21.7211 C9.13425,21.1195 8.69267,20.3385 8.32611,19.454 C7.9734,18.603 7.67593,17.6217 7.45268,16.5473 C6.3783,16.3241 5.39704,16.0266 4.54598,15.6739 C3.66154,15.3073 2.88049,14.8657 2.27888,14.3554 C3.15552,17.9864 6.01359,20.8445 9.64456,21.7211 Z M7.45268,7.45285 C7.67593,6.37846 7.9734,5.3972 8.32611,4.54615 C8.69267,3.6617 9.13425,2.88066 9.64457,2.27905 C6.01359,3.15569 3.15552,6.01376 2.27888,9.64473 C2.88049,9.13442 3.66154,8.69283 4.54598,8.32628 C5.39704,7.97356 6.3783,7.6761 7.45268,7.45285 Z" id="" fill="#ffffff" data-v-a2e620a5></path></g></g></g></g></svg></span>',1)),createBaseVNode("span",null,toDisplayString$1(r.$t("service7_5")),1)])]),createBaseVNode("div",_hoisted_73,[e[39]||(e[39]=createBaseVNode("div",{class:"imgbox1"},[createBaseVNode("img",{src:_imports_7,alt:""})],-1)),createBaseVNode("div",_hoisted_74,[createBaseVNode("div",_hoisted_75,toDisplayString$1(r.$t("honetitle3")),1)])])])])],64))}},Service=_export_sfc(_sfc_main$2,[["__scopeId","data-v-a2e620a5"]]),_imports_0=""+new URL("manager-CRYQHmK3.jpg",import.meta.url).href,_hoisted_1={class:"Manager_banner_1"},_hoisted_2={class:"title_1"},_hoisted_3={class:"txt_1"},_sfc_main$1={__name:"Manager",setup(r){const{t:e,locale:i}=useI18n();return(n,o)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,toDisplayString$1(n.$t("m1")),1)]),o[0]||(o[0]=createBaseVNode("div",{class:"vfverq32"},[createBaseVNode("h2",{class:"h2"},""),createBaseVNode("div",{class:"txt"},"")],-1))]),o[1]||(o[1]=createStaticVNode('<div class="mbox" data-v-6cc0f41f><div class="mt" data-v-6cc0f41f><h2 data-v-6cc0f41f></h2></div><div class="mc" data-v-6cc0f41f><div class="cbox" data-v-6cc0f41f><div class="name" data-v-6cc0f41f>  </div><div class="position" data-v-6cc0f41f>  </div><div class="photo" data-v-6cc0f41f><img src="'+_imports_0+'" alt="" data-v-6cc0f41f></div><div class="resume" data-v-6cc0f41f><ul data-v-6cc0f41f><li data-v-6cc0f41f> 7 </li><li data-v-6cc0f41f>2023  9  [*] </li><li data-v-6cc0f41f>2021 </li><li data-v-6cc0f41f>2016  2021 </li><li data-v-6cc0f41f>2022  8  2023  6 572</li><li data-v-6cc0f41f>2015 </li></ul></div></div><div class="cbox" data-v-6cc0f41f><div class="name" data-v-6cc0f41f>  </div><div class="position" data-v-6cc0f41f>  </div><div class="photo" data-v-6cc0f41f><img src="'+_imports_0+'" alt="" data-v-6cc0f41f></div><div class="resume" data-v-6cc0f41f><ul data-v-6cc0f41f><li data-v-6cc0f41f> 7 </li><li data-v-6cc0f41f>2023  9  [*] </li><li data-v-6cc0f41f>2021 </li><li data-v-6cc0f41f>2016  2021 </li><li data-v-6cc0f41f>2022  8  2023  6 572</li><li data-v-6cc0f41f>2015 </li></ul></div></div><div class="cbox" data-v-6cc0f41f><div class="name" data-v-6cc0f41f>  </div><div class="position" data-v-6cc0f41f>  </div><div class="photo" data-v-6cc0f41f><img src="'+_imports_0+'" alt="" data-v-6cc0f41f></div><div class="resume" data-v-6cc0f41f><ul data-v-6cc0f41f><li data-v-6cc0f41f> 7 </li><li data-v-6cc0f41f>2023  9  [*] </li><li data-v-6cc0f41f>2021 </li><li data-v-6cc0f41f>2016  2021 </li><li data-v-6cc0f41f>2022  8  2023  6 572</li><li data-v-6cc0f41f>2015 </li></ul></div></div></div></div>',1))],64))}},Manager=_export_sfc(_sfc_main$1,[["__scopeId","data-v-6cc0f41f"]]),_sfc_main={__name:"NotFound",setup(r){return(e,i)=>(openBlock(),createElementBlock("div",null,i[0]||(i[0]=[createBaseVNode("h1",null,"404 - ",-1),createBaseVNode("p",null,"",-1)])))}},NotFound=_export_sfc(_sfc_main,[["__scopeId","data-v-a9765eda"]]),routes=[{path:"/",name:"Home",component:Home},{path:"/about",name:"About",component:About},{path:"/choose",name:"Choose",component:Choose},{path:"/service",name:"Service",component:Service},{path:"/manager",name:"Manager",component:Manager},{path:"/:pathMatch(.*)*",name:"NotFound",component:NotFound}],router=createRouter({history:createWebHashHistory(),routes}),i18n=createI18n({legacy:!1,locale:"en",messages:{en:{about_Us:"About us",about_t1:"A capital market financial services firm composed of professionals proficient in the Hong Kong and US stock markets",honetitle1:"Global Vision, Worldwide Insight",honetitle2:"Financial Expertise, Professional Stewardship",honetitle3:"Chengxin Investment",abouttitle1:"Etoiles Financial Group Limited is a financial services firm specializing in capital markets, led by a team of seasoned professionals with deep expertise in the Hong Kong and U.S. stock markets. With over a decade of industry experience.",abouttitle2:"our founding team is committed to delivering tailored solutions that drive success.",abouttitle3:"We provide one-stop financial services for listed companies, including fundraising advisory, strategic planning, value enhancement, and financial communications. Our strong connections with domestic and international institutional investors.",abouttitle4:"high-net-worth individuals, and an extensive media network allow us to offer a wide range of services, such as value-driven communication strategies, targeted roadshows, media and investor relations, in-depth research, brand promotion, crisis management, and event planning.",abouttitle5:"At Etoiles, we excel in matching the right investors and maximizing capital efficiency. From IPO success to post-listing growth, we deliver strategic capital operations and comprehensive public relations and investor relations services.",abouttitle6:"ensuring businesses achieve their full potential in the global market.",ppt1:"Global Investor Resource Library",ppt2:"Securities Firm Partners",ppt3:"Media Cooperation Channels",ppt4:"Work Experience in Hong Kong Stock Market",service1:"Capital Market Value Operations Expert",service2:"We specialize in analyzing and showcasing the full investment potential of enterprises. Through diverse platforms across public and private domains, we amplify visibility, highlight unique strengths, and showcase comprehensive capabilities. This approach attracts attention, fosters collaboration, and enhances market position and brand image.",service3:"Establishing a Professional Financial IR/PR Team",service3_0:" Build efficient IR & PR systems to drive business growth:",service3_1:"Develop a comprehensive IR + PR structure",service3_2:"Offer specialized training",service4:"Digitized Investor Relations",service4_0:" Modernizing investor relations management:",service4_1:"Set up a tailored IR digital platform",service4_2:"Create investor profiles",service4_3:"Digitally track investor communications",service4_4:"Measure conversion rates",service5:"Professional Financial PR Services",service5_0:" Targeted marketing and service enhancements to all stakeholders",service5_1:"Match investors with tailored roadshow services",service5_2:"Analyze stock price movements",service5_3:"Provide shareholder verification reports",service5_4:"Manage trading terminal services",service5_5:"Monitor media sentiment and handle crisis PR",service5_6:"Develop communication strategies and write press releases",service6:"Value Proposition",service6_0:" Provide a solid foundation for decision-making and external communications:",service6_1:"Assess the companys capital market value",service6_2:"Build a comprehensive communications materials library",service6_3:"Produce detailed research reports and coverage",service6_4:"Develop investor pitch decks and performance presentations",service6_5:"Create investor Q&A lists",service7:"Other Professional Services",service7_0:" Boost brand visibility and market presence:",service7_1:"Fundraising and M&A advisory",service7_2:"ESG reporting",service7_3:"Organize large-scale events",service7_4:"Coordinate forums, summits, and award submissions",service7_5:"Facilitate international roadshows",choose1:"How We Differentiate from Our Peers",choose2:"Unveiling Corporate Value, Redefining Capital Narratives",choose3:"We cut through market noise to uncover hidden potential, weaving compelling value stories through the lens of seasoned capital market expertise.",choose4:"Addressing Client Pain Points with Tailored Precision",choose5:"We identify both explicit and latent client needs with pinpoint accuracy. Backed by a team of financial thought leaders, we reject cookie-cutter approaches, crafting unique, bespoke solutions for each client.",choose6:"Winning Through Cross-Boundary Communication and Amplified Branding",choose7:"Leveraging a global media network and capital market connections, we design strategies to maximize brand visibility and investment appeal. By integrating public and private domains, we enhance corporate influence and ignite investor enthusiasm.",choose8:"Trailblazing Financial Expertise with Professional Guidance",choose9:"Our team of dynamic young professionals, seasoned in navigating financial markets, combines fearless innovation with exceptional execution to chart new paths for growth and success.",touyzi1:"Strategic Insights for Global Financial Excellence",touyzi2:"Connecting Value, Amplifying Growth",nav1:"Home Page",nav2:"About Us",nav3:"Services",nav4:"Investor Relations",nav5:"manager",m1:"Manager",tb1:"Financial IR/PR Team",tb2:"Digitized IR",tb3:"Professional PR Services",tb4:"Value Proposition",tb5:"Other Services"},zh:{about_Us:"",about_t1:"",honetitle1:"",honetitle2:"",honetitle3:"",abouttitle1:"",abouttitle2:"10",abouttitle3:"",abouttitle4:"",abouttitle5:"IPO",abouttitle6:"",ppt1:"",ppt2:"",ppt3:"",ppt4:"",service1:"",service2:"",service3:"/",service3_0:" &",service3_1:"IR+PR",service3_2:"",service4:"IR",service4_0:" ",service4_1:"IR",service4_2:"",service4_3:"",service4_4:"",service5:"",service5_0:" ",service5_1:"",service5_2:"",service5_3:"",service5_4:"",service5_5:"",service5_6:"",service6:"",service6_0:" /",service6_1:"",service6_2:"",service6_3:"/",service6_4:"",service6_5:"",service7:"",service7_0:"",service7_1:"",service7_2:"ESG ",service7_3:"",service7_4:"",service7_5:"",choose1:"",choose2:" ",choose3:"",choose4:" ",choose5:"",choose6:" ",choose7:"",choose8:" ",choose9:"",touyzi1:"",touyzi2:"",nav1:"",nav2:"",nav3:"",nav4:"",nav5:"",m1:"",tb1:"",tb2:"IR",tb3:"",tb4:"",tb5:""}}}),app=createApp(_sfc_main$6);app.use(router);app.use(i18n);app.mount("#app");
